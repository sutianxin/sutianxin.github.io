<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆå…«ï¼‰</title>
      <link href="posts/695513415.html"/>
      <url>posts/695513415.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€TreeNodeçš„å®šä¹‰"><a href="#1ã€TreeNodeçš„å®šä¹‰" class="headerlink" title="1ã€TreeNodeçš„å®šä¹‰"></a>1ã€<code>TreeNode</code>çš„å®šä¹‰</h2><blockquote><p>ä»¥ä¸‹é¢˜è§£ä¸­<code>TreeNode</code>çš„å®šä¹‰ä»£ç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line">    TreeNode() &#123;&#125;</span><br><span class="line">    TreeNode(<span class="keyword">int</span> val) &#123; <span class="keyword">this</span>.val = val; &#125;</span><br><span class="line">    TreeNode(<span class="keyword">int</span> val, TreeNode left, TreeNode right) &#123;</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€æœ€å¤§äºŒå‰æ ‘"><a href="#2ã€æœ€å¤§äºŒå‰æ ‘" class="headerlink" title="2ã€æœ€å¤§äºŒå‰æ ‘"></a>2ã€æœ€å¤§äºŒå‰æ ‘</h2><h3 id="2-1ã€é¢˜ç›®ä»‹ç»"><a href="#2-1ã€é¢˜ç›®ä»‹ç»" class="headerlink" title="2.1ã€é¢˜ç›®ä»‹ç»"></a>2.1ã€é¢˜ç›®ä»‹ç»</h3><blockquote><p>è¿™æ˜¯ <a href="https://leetcode-cn.com/problems/maximum-binary-tree/">åŠ›æ‰£ç¬¬654é¢˜</a>ï¼Œé¢˜ç›®å…·ä½“è¦æ±‚å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327160848.png" alt="image-20210327160848365"></p><h3 id="2-2ã€è§£é¢˜æ€è·¯"><a href="#2-2ã€è§£é¢˜æ€è·¯" class="headerlink" title="2.2ã€è§£é¢˜æ€è·¯"></a>2.2ã€è§£é¢˜æ€è·¯</h3><ul><li>é‡è½½æ‰€ç»™çš„æ–¹æ³• <code>buildTree</code>ï¼Œè¯¥æ–¹æ³•æœ‰3ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºæ‰€ç»™æ•°ç»„ã€æœå¯»å·¦è¾¹ç•Œå’Œæœå¯»å³è¾¹ç•Œ</li><li>åœ¨é‡è½½çš„<code>buildTree</code>ä¸­ï¼Œæ‰¾åˆ°æ•°ç»„æœ€å¤§å…ƒç´  <code>maxValue</code> ï¼Œå¹¶è®°å½•å…¶ä¸‹æ ‡ä¸º index</li><li>ä»¥ <code>maxValue</code> æ„é€ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> </li><li>é€’å½’é‡è½½çš„ <code>buildTree</code> æ–¹æ³•ï¼Œè®©å³è¾¹ç•Œä¸º <code>index - 1</code>ï¼Œå¾—åˆ°æ ¹èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</li><li>é€’å½’é‡è½½çš„ <code>buildTree</code>æ–¹æ³•ï¼Œè®©å·¦è¾¹ç•Œä¸º <code>index + 1</code>ï¼Œå¾—åˆ°æ ¹èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327162207.png" alt="image-20210327162206973"></p><h3 id="2-3ã€ä»£ç "><a href="#2-3ã€ä»£ç " class="headerlink" title="2.3ã€ä»£ç "></a>2.3ã€ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">constructMaximumBinaryTree</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> buildTree(nums,<span class="number">0</span>,nums.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœå¯»èŒƒå›´å·¦è¾¹ç•Œä¸¥æ ¼å¤§äºå³è¾¹ç•Œï¼Œæ­¤æ—¶é€€å‡ºé€’å½’</span></span><br><span class="line">        <span class="keyword">if</span>(nums == <span class="keyword">null</span> || nums.length == <span class="number">0</span> || left &gt; right) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æœå¯»èŒƒå›´ä¸­çš„æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">int</span> maxValue = Integer.MIN_VALUE;</span><br><span class="line">        <span class="comment">// æœ€å¤§å€¼ä¸‹æ ‡</span></span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°èŒƒå›´ä¸­çš„æ•°ç»„æœ€å¤§å€¼ï¼Œå¹¶ç»™ä¸Šé¢çš„å˜é‡ä¸€ä¸€èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = left; i &lt;= right; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; maxValue) &#123;</span><br><span class="line">                maxValue = nums[i];</span><br><span class="line">                index = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ„é€ æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        TreeNode root = <span class="keyword">new</span> TreeNode(maxValue);</span><br><span class="line">        <span class="comment">// é€’å½’æ„é€ æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œè¿™é‡Œçš„å³è¾¹ç•Œä¸º index - 1</span></span><br><span class="line">        root.left = buildTree(nums,left,index - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// é€’å½’æ„é€ æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œè¿™é‡Œçš„å·¦è¾¹ç•Œä¸º index + 1</span></span><br><span class="line">        root.right = buildTree(nums, index + <span class="number">1</span>,right);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€äºŒå‰æ ‘çš„é•œåƒ"><a href="#3ã€äºŒå‰æ ‘çš„é•œåƒ" class="headerlink" title="3ã€äºŒå‰æ ‘çš„é•œåƒ"></a>3ã€äºŒå‰æ ‘çš„é•œåƒ</h2><h3 id="3-1ã€é¢˜ç›®ä»‹ç»"><a href="#3-1ã€é¢˜ç›®ä»‹ç»" class="headerlink" title="3.1ã€é¢˜ç›®ä»‹ç»"></a>3.1ã€é¢˜ç›®ä»‹ç»</h3><blockquote><p>è¿™æ˜¯<a href="https://leetcode-cn.com/problems/er-cha-shu-de-jing-xiang-lcof/">å‰‘æŒ‡offerçš„ç¬¬27é“é¢˜</a>ï¼Œé¢˜ç›®å…·ä½“è¦æ±‚å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327165241.png" alt="image-20210327165240756"></p><h3 id="3-1ã€è§£é¢˜æ€è·¯"><a href="#3-1ã€è§£é¢˜æ€è·¯" class="headerlink" title="3.1ã€è§£é¢˜æ€è·¯"></a>3.1ã€è§£é¢˜æ€è·¯</h3><blockquote><p>è¿™é“é¢˜è¿˜ç®—ç®€å•ï¼Œä½¿ç”¨ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œäº¤æ¢æ ¹èŠ‚ç‚¹çš„å·¦å³å­æ ‘ï¼Œç„¶åå‘å·¦å³å­æ ‘åˆ†åˆ«é€’å½’å³å¯ã€‚</p></blockquote><h3 id="3-2ã€ä»£ç "><a href="#3-2ã€ä»£ç " class="headerlink" title="3.2ã€ä»£ç "></a>3.2ã€ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution02</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">mirrorTree</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//é€’å½’é€€å‡ºæ¡ä»¶ï¼Œå¦‚æœä¼ å…¥çš„rootä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥ç›´æ¥è¿”å›null</span></span><br><span class="line">        <span class="keyword">if</span>(root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ©ç”¨tempèŠ‚ç‚¹äº¤æ¢ä¸€ä¸ªèŠ‚ç‚¹ä¸‹çš„å·¦å³å­æ ‘</span></span><br><span class="line">        TreeNode temp = root.left;</span><br><span class="line">        root.left = root.right;</span><br><span class="line">        root.right = temp;</span><br><span class="line">        <span class="comment">//åˆ†åˆ«å‘å·¦å‘å³é€’å½’</span></span><br><span class="line">        mirrorTree(root.left);</span><br><span class="line">        mirrorTree(root.right);</span><br><span class="line">        <span class="comment">//è¿”å›æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€æ ¹æ®å‰åºéå†ç»“æœå’Œä¸­åºéå†ç»“æœè¿˜åŸäºŒå‰æ ‘"><a href="#4ã€æ ¹æ®å‰åºéå†ç»“æœå’Œä¸­åºéå†ç»“æœè¿˜åŸäºŒå‰æ ‘" class="headerlink" title="4ã€æ ¹æ®å‰åºéå†ç»“æœå’Œä¸­åºéå†ç»“æœè¿˜åŸäºŒå‰æ ‘"></a>4ã€æ ¹æ®å‰åºéå†ç»“æœå’Œä¸­åºéå†ç»“æœè¿˜åŸäºŒå‰æ ‘</h2><h3 id="4-1ã€é¢˜ç›®ä»‹ç»"><a href="#4-1ã€é¢˜ç›®ä»‹ç»" class="headerlink" title="4.1ã€é¢˜ç›®ä»‹ç»"></a>4.1ã€é¢˜ç›®ä»‹ç»</h3><blockquote><p>åŠ›æ‰£çš„<a href="https://leetcode-cn.com/problems/construct-binary-tree-from-preorder-and-inorder-traversal/">ç¬¬105é“é¢˜</a>ï¼Œé¢˜ç›®ä»‹ç»å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327174038.png" alt="image-20210327174038558"></p><h3 id="4-2ã€è§£é¢˜æ€è·¯"><a href="#4-2ã€è§£é¢˜æ€è·¯" class="headerlink" title="4.2ã€è§£é¢˜æ€è·¯"></a>4.2ã€è§£é¢˜æ€è·¯</h3><blockquote><p>åœ¨å‰åºéå†ä¸­ï¼Œé¡ºåºç¬¬ä¸€ä¸ªç»“æœä¾¿æ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹</p><p>åœ¨ä¸­åºéå†ä¸­ï¼Œæ ¹èŠ‚ç‚¹å·¦è¾¹çš„èŠ‚ç‚¹å…ƒç´ ï¼ˆå¯èƒ½æœ‰0ä¸ªæˆ–å¤šä¸ªï¼‰æ˜¯è¯¥èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œæ ¹èŠ‚ç‚¹å³è¾¹çš„èŠ‚ç‚¹å…ƒç´ ï¼ˆå¯èƒ½æœ‰0ä¸ªæˆ–å¤šä¸ªï¼‰æ˜¯è¯¥èŠ‚ç‚¹çš„å³å­æ ‘</p></blockquote><ul><li>æ ¹æ®å‰åºéå†ç»“æœï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºäºŒå‰æ ‘çš„æ ¹ç»“ç‚¹ï¼›</li><li>è§‚å¯Ÿä¸­åºéå†ç»“æœï¼Œæ ¹ç»“ç‚¹å·¦ä¾§çš„ä¸ºå·¦å­æ ‘ï¼Œè‹¥å·¦å­æ ‘æ ¹ç»“ç‚¹å‰ï¼ˆåï¼‰å†æ— ä»»ä½•å…ƒç´ ï¼Œåˆ™å·¦ï¼ˆå³ï¼‰å­æ ‘çš„å·¦åˆ†æ”¯ä¸ºç©ºï¼›æ ¹ç»“ç‚¹å³ä¾§çš„ä¸ºå³å­æ ‘ï¼Œè‹¥å³å­æ ‘æ ¹ç»“ç‚¹å‰ï¼ˆåï¼‰å†æ— ä»»ä½•å…ƒç´ ï¼Œåˆ™å·¦ï¼ˆå³ï¼‰å­æ ‘çš„å·¦åˆ†æ”¯ä¸ºç©ºï¼›</li><li>ä¸Šé¢çš„è¿‡ç¨‹æ˜¯é€’å½’çš„ã€‚å…ˆæ‰¾åˆ°å½“å‰æ ‘çš„æ ¹ç»“ç‚¹ï¼Œç„¶ååˆ’åˆ†ä¸ºå·¦å³å­æ ‘ï¼Œå†è¿›å…¥å·¦å­æ ‘é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œæœ€åè¿›å…¥å³å­æ ‘é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆè¿˜åŸä¸€æ£µæ ‘ã€‚</li></ul><blockquote><p>ä¾‹å¦‚ï¼š</p><p>å·²çŸ¥å‰åºéå†ï¼šABDECFG</p><p>â€‹         ä¸­åºéå†ï¼šDBEAFCG</p></blockquote><ul><li>å‰åºéå†ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥<code>A</code>æ˜¯äºŒå‰æ ‘æ ¹èŠ‚ç‚¹</li><li>è§‚å¯Ÿä¸­éœ€éå†ç»“æœï¼ŒäºŒå‰æ ‘æ ¹èŠ‚ç‚¹å·¦è¾¹çš„å…ƒç´ ä»¬æ„æˆè¯¥èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œæ•…ï¼ˆDBEï¼‰æ„æˆAçš„å·¦å­æ ‘ï¼Œï¼ˆFCGï¼‰æ„æˆAçš„å³å­æ ‘</li><li>è§‚å¯Ÿå‰åºéå†ç»“æœï¼Œå‘ç°å‰åºéå†ä¸­Aå·¦å­æ ‘èŠ‚ç‚¹çš„å‡ºç°é¡ºåºä¸º ï¼ˆBDEï¼‰ï¼Œæ•…Bä¸ºAçš„å·¦å­èŠ‚ç‚¹ï¼ŒåŒç†Cä¸ºAçš„å³å­èŠ‚ç‚¹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327170248.png" alt="image-20210327170248036"></p><ul><li>åœ¨ä¸­åºéå†ä¸­ï¼ŒDEåˆ†åˆ«å‡ºç°åœ¨Bçš„å·¦å³ï¼Œæ•…Dä¸ºBçš„å·¦å­èŠ‚ç‚¹ï¼ŒEä¸ºBçš„å³å­èŠ‚ç‚¹ï¼ŒåŒç†å¯å¾—Fä¸ºCçš„å·¦å­èŠ‚ç‚¹ï¼ŒGä¸ºCçš„å³å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶äºŒå‰æ ‘æ„é€ å®Œæ¯•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327170454.png" alt="image-20210327170454885"></p><ul><li>åœ¨å‰åºéå†ã€ä¸­åºéå†çš„ç»“æœæ•°ç»„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½œå›¾å¦‚ä¸‹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327170922.png" alt="image-20210327170921862"></p><ul><li>ä¸ºæ•°ç»„ä¸­çš„å…ƒç´ æ ‡è®°ä¸‹æ ‡ï¼Œå…¶ä¸­ä¸­åºéå†ä¸­æ ¹èŠ‚ç‚¹çš„ä¸‹æ ‡è®¾ç½®<code>pIndex</code></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327171550.png" alt="image-20210327171544846"></p><ul><li>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ±‚å‡ºå‰åºéå†ä¸­å·¦å­æ•°ç»„çš„å³è¾¹ç•Œå’Œå³å­æ•°ç»„çš„å·¦è¾¹ç•Œï¼Œç”±äºå‰åºéå†å’Œä¸­åºéå†ä¸­å·¦å­æ•°ç»„çš„é•¿åº¦ç›¸ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å‡ºä¸€ä¸ªå¼å­ï¼Œè¿™é‡Œè®¾å·¦å­æ ‘ç»„çš„å³è¾¹ç•Œä¸º<code>X</code></li></ul><blockquote><p><code>X - (preLeft + 1) = (pIndex - 1) - inLeft</code>  </p><p>å¯ä»¥è§£å¾— <code>X</code> çš„å€¼ä¸º <code>pIndex - inLeft + preLeft</code></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327172130.png" alt="image-20210327172129974"></p><ul><li>å…ˆéå†ä¸­åºéå†æ•°ç»„ï¼Œæ‰¾å‡ºæœ€å¤§å€¼ï¼Œä»¥è¯¥å€¼æ„é€ æ ¹èŠ‚ç‚¹</li><li>é€’å½’å·¦å³å­æ ‘ï¼Œæ ¹æ®ä¸Šé¢çš„è§„åˆ™æ„é€ å‡ºå·¦å­æ ‘å’Œå³å­æ ‘</li></ul><h3 id="4-3ã€è§£é¢˜ä»£ç "><a href="#4-3ã€è§£é¢˜ä»£ç " class="headerlink" title="4.3ã€è§£é¢˜ä»£ç "></a>4.3ã€è§£é¢˜ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] preorder, <span class="keyword">int</span>[] inorder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> preLen = preorder.length;</span><br><span class="line">        <span class="keyword">int</span> inLen = inorder.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> buildTree(preorder,<span class="number">0</span>,preLen - <span class="number">1</span>,inorder,<span class="number">0</span>,inLen - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] preorder, <span class="keyword">int</span> preLeft, <span class="keyword">int</span> preRight, <span class="keyword">int</span>[] inorder, <span class="keyword">int</span> inLeft, <span class="keyword">int</span> inRight)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å½“ä¼ å…¥çš„è¾¹ç•Œå€¼æ„ä¸æˆåŒºé—´æ—¶ï¼Œé€€å‡ºé€’å½’</span></span><br><span class="line">        <span class="keyword">if</span>(preLeft &gt; preRight || inLeft &gt; inRight) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ ¹èŠ‚ç‚¹ä¸ºå‰åºéå†ä¸­çš„å·¦è¾¹ç•Œå€¼</span></span><br><span class="line">        <span class="keyword">int</span> rootValue = preorder[preLeft];</span><br><span class="line">        <span class="comment">//æ„é€ æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        TreeNode root = <span class="keyword">new</span> TreeNode(rootValue);</span><br><span class="line">        <span class="comment">//ä¸­åºéå†ä¸­æ ¹èŠ‚ç‚¹çš„å‡ºç°ä½ç½®</span></span><br><span class="line">        <span class="keyword">int</span> pIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//éå†ä¸­åºæ•°ç»„ï¼Œæ‰¾åˆ°rootValueå¯¹åº”çš„ä¸‹æ ‡ï¼Œå³æ ¹èŠ‚ç‚¹çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = inLeft; i &lt;= inRight; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(inorder[i] == rootValue) &#123;</span><br><span class="line">                pIndex = i;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€’å½’ï¼Œæ„é€ å·¦å­æ ‘ï¼Œè¿™é‡Œéœ€è¦ä¼ å…¥å‰åºéå†ä¸­å·¦å­æ•°ç»„çš„å·¦å³è¾¹ç•Œå’Œä¸­åºéå†ä¸­å·¦å³æ•°ç»„çš„å·¦å³è¾¹ç•Œ</span></span><br><span class="line">        root.left = buildTree(preorder,preLeft + <span class="number">1</span>,pIndex - inLeft + preLeft,inorder,inLeft,pIndex - <span class="number">1</span>);</span><br><span class="line">        root.right = buildTree(preorder,pIndex - inLeft + preLeft + <span class="number">1</span>,preRight,inorder,pIndex + <span class="number">1</span>,inRight);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æäº¤ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327173642.png" alt="image-20210327173642170"></p><h3 id="4-4ã€æ”¹è¿›"><a href="#4-4ã€æ”¹è¿›" class="headerlink" title="4.4ã€æ”¹è¿›"></a>4.4ã€æ”¹è¿›</h3><blockquote><p>ä½¿ç”¨ä¸€ä¸ª <code>HashMap</code> ä¿å­˜ä¸­åºæ•°ç»„ä¸­çš„æ•°ç»„å€¼åŠä¸‹æ ‡ï¼Œä»¥æ•°ç»„å€¼ä¸ºé”®ï¼Œä¸‹æ ‡ä¸ºå€¼ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿæ ¹æ® <code>preorder(preLeft)</code> è·å¾—ä¸­åºç»“æœä¸­æ ¹èŠ‚ç‚¹çš„æ•°ç»„ä¸‹æ ‡ <code>pIndex</code></p></blockquote><ul><li>æ”¹è¿›åçš„ä»£ç å¦‚ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] preorder, <span class="keyword">int</span>[] inorder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> preLen = preorder.length;</span><br><span class="line">        <span class="keyword">int</span> inLen = inorder.length;</span><br><span class="line"></span><br><span class="line">        Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿™é‡Œä»¥æ•°ç»„å€¼ä¸ºé”®ï¼Œæ•°ç»„ä¸‹æ ‡ä¸ºå€¼ï¼Œå°†ä¸­åºéå†æ•°ç»„çš„æ•°æ®æ”¾å…¥mapä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; inLen; i++) &#123;</span><br><span class="line">            map.put(inorder[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buildTree(preorder,<span class="number">0</span>,preLen - <span class="number">1</span>,map,<span class="number">0</span>,inLen - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TreeNode <span class="title">buildTree</span><span class="params">(<span class="keyword">int</span>[] preorder, <span class="keyword">int</span> preLeft, <span class="keyword">int</span> preRight, Map&lt;Integer, Integer&gt; inOrderMap, <span class="keyword">int</span> inLeft, <span class="keyword">int</span> inRight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preLeft &gt; preRight || inLeft &gt; inRight) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> rootValue = preorder[preLeft];</span><br><span class="line">        TreeNode root = <span class="keyword">new</span> TreeNode(rootValue);</span><br><span class="line">        <span class="keyword">int</span> pIndex = inOrderMap.get(rootValue);</span><br><span class="line">        root.left = buildTree(preorder,preLeft + <span class="number">1</span>,pIndex - inLeft + preLeft,inOrderMap,inLeft,pIndex - <span class="number">1</span>);</span><br><span class="line">        root.right = buildTree(preorder,pIndex - inLeft + preLeft + <span class="number">1</span>,preRight,inOrderMap,pIndex + <span class="number">1</span>,inRight);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210327173927.png" alt="image-20210327173927388"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåº”ç”¨å­¦ä¹ ï¼ˆå…­ï¼‰-RabbitMQå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰</title>
      <link href="posts/1280028895.html"/>
      <url>posts/1280028895.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="äº”ã€Spring-æ•´åˆ-RabbitMQ"><a href="#äº”ã€Spring-æ•´åˆ-RabbitMQ" class="headerlink" title="äº”ã€Spring æ•´åˆ RabbitMQ"></a>äº”ã€Spring æ•´åˆ RabbitMQ</h1><blockquote><p>éœ€æ±‚ï¼šä½¿ç”¨ Spring æ•´åˆ RabbitMQ</p></blockquote><h2 id="5-1ã€æ­å»ºç”Ÿäº§è€…å·¥ç¨‹"><a href="#5-1ã€æ­å»ºç”Ÿäº§è€…å·¥ç¨‹" class="headerlink" title="5.1ã€æ­å»ºç”Ÿäº§è€…å·¥ç¨‹"></a>5.1ã€æ­å»ºç”Ÿäº§è€…å·¥ç¨‹</h2><h3 id="1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–"><a href="#1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–" class="headerlink" title="1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–"></a>1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€ç¼–å†™é…ç½®æ–‡ä»¶"><a href="#2ã€ç¼–å†™é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€ç¼–å†™é…ç½®æ–‡ä»¶"></a>2ã€ç¼–å†™é…ç½®æ–‡ä»¶</h3><blockquote><p>åœ¨ <strong>resource</strong> ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ <code>rabbitmq.properties</code>ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">rabbitmq.host</span>=<span class="string">192.168.56.101</span></span><br><span class="line"><span class="meta">rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="meta">rabbitmq.username</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">rabbitmq.password</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">rabbitmq.virtual-host</span>=<span class="string">/wuhu</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»º <code>Spring</code> æ ¸å¿ƒé…ç½®æ–‡ä»¶ <strong>spring-rabbitmq-producer.xml</strong></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:rabbit</span>=<span class="string">&quot;http://www.springframework.org/schema/rabbit&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:properties/rabbitmq.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">host</span>=<span class="string">&quot;$&#123;rabbitmq.host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">port</span>=<span class="string">&quot;$&#123;rabbitmq.port&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">username</span>=<span class="string">&quot;$&#123;rabbitmq.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">password</span>=<span class="string">&quot;$&#123;rabbitmq.password&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">virtual-host</span>=<span class="string">&quot;$&#123;rabbitmq.virtual-host&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰ç®¡ç†äº¤æ¢æœºã€é˜Ÿåˆ—--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:admin</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»ºï¼›ä¸ç»‘å®šåˆ°äº¤æ¢æœºåˆ™ç»‘å®šåˆ°é»˜è®¤äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">    é»˜è®¤äº¤æ¢æœºç±»å‹ä¸ºdirectï¼Œåå­—ä¸ºï¼š&quot;&quot;ï¼Œè·¯ç”±é”®ä¸ºé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;spring_queue&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_queue&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~å¹¿æ’­ï¼›æ‰€æœ‰é˜Ÿåˆ—éƒ½èƒ½æ”¶åˆ°æ¶ˆæ¯~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;spring_fanout_queue_1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_fanout_queue_1&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;spring_fanout_queue_2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_fanout_queue_2&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰å¹¿æ’­ç±»å‹äº¤æ¢æœºï¼›å¹¶ç»‘å®šä¸Šè¿°ä¸¤ä¸ªé˜Ÿåˆ—--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:fanout-exchange</span> <span class="attr">id</span>=<span class="string">&quot;spring_fanout_exchange&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_fanout_exchange&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">queue</span>=<span class="string">&quot;spring_fanout_queue_1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">queue</span>=<span class="string">&quot;spring_fanout_queue_2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:fanout-exchange</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~é€šé…ç¬¦ï¼›*åŒ¹é…ä¸€ä¸ªå•è¯ï¼Œ#åŒ¹é…å¤šä¸ªå•è¯ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;spring_topic_queue_star&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_topic_queue_star&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;spring_topic_queue_well&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_topic_queue_well&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰å¹¿æ’­äº¤æ¢æœºä¸­çš„æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;spring_topic_queue_well2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_topic_queue_well2&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">id</span>=<span class="string">&quot;spring_topic_exchange&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring_topic_exchange&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;heima.*&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;spring_topic_queue_star&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;heima.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;spring_topic_queue_well&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;itcast.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;spring_topic_queue_well2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰rabbitTemplateå¯¹è±¡æ“ä½œå¯ä»¥åœ¨ä»£ç ä¸­æ–¹ä¾¿å‘é€æ¶ˆæ¯--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:template</span> <span class="attr">id</span>=<span class="string">&quot;rabbitTemplate&quot;</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•"><a href="#3ã€åˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•" class="headerlink" title="3ã€åˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•"></a>3ã€åˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•</h3><ul><li>ä½¿ç”¨<code>RabbitTemplate</code>å‘é€æ¶ˆæ¯ï¼Œç®€å•æ¨¡å¼çš„ routing key å¿…é¡»å’Œé˜Ÿåˆ—åç§°ç›¸åŒ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:spring-rabbitmq-producer.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 æ³¨å…¥RabbitTemplate</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHelloWorld</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//2 å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;spring_queue&quot;</span>,<span class="string">&quot;hello,world Spring...!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨ <code>testHelloWorld</code>æ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321162509.png" alt="image-20210321162508832"> </p><ul><li>ä½¿ç”¨ <code>RabbitTemplate</code> å‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯ç±»å‹ä¸º <code>Fanout</code> å¹¿æ’­ç±»å‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFanout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;spring_fanout_exchange&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;Spring fanout...!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ <code>RabbitMQ</code> æ§åˆ¶å°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321163720.png" alt="image-20210321163720570"></p><ul><li>ä½¿ç”¨ <code>RabbitTemplate</code> å‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯ç±»å‹ä¸º <code>Topic</code> å¹¿æ’­ç±»å‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTopic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œçš„routing key è®¾ç½®ä¸º heima.hehe.haha åï¼Œåªæœ‰heima.#å¯ä»¥åŒ¹é…åˆ°</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;spring_topic_exchange&quot;</span>,<span class="string">&quot;heima.hehe.haha&quot;</span>,<span class="string">&quot;Spring Topic...!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œæ–¹æ³•åï¼Œå¯ä»¥çœ‹åˆ°åªæœ‰wellé˜Ÿåˆ—æ”¶åˆ°æ¶ˆæ¯ï¼Œè¿™æ˜¯å› ä¸ºå…¶ä»–ä¸¤ä¸ªé˜Ÿåˆ—çš„é€šé…ç¬¦ä¸åŒ¹é…</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321164625.png" alt="image-20210321164625313"></p><blockquote><p>ä¸‰ä¸ªé˜Ÿåˆ—çš„åŒ¹é…è§„åˆ™å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321164657.png" alt="image-20210321164657913"></p><h2 id="5-2ã€æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹"><a href="#5-2ã€æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹" class="headerlink" title="5.2ã€æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹"></a>5.2ã€æ­å»ºæ¶ˆè´¹è€…å·¥ç¨‹</h2><h3 id="1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–-1"><a href="#1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–-1" class="headerlink" title="1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–"></a>1ã€åˆ›å»ºæ¨¡å—ï¼Œå¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€ç¼–å†™é…ç½®æ–‡ä»¶-1"><a href="#2ã€ç¼–å†™é…ç½®æ–‡ä»¶-1" class="headerlink" title="2ã€ç¼–å†™é…ç½®æ–‡ä»¶"></a>2ã€ç¼–å†™é…ç½®æ–‡ä»¶</h3><blockquote><p>åœ¨ <strong>resource</strong> ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ <code>rabbitmq.properties</code>ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">rabbitmq.host</span>=<span class="string">192.168.56.101</span></span><br><span class="line"><span class="meta">rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="meta">rabbitmq.username</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">rabbitmq.password</span>=<span class="string">admin</span></span><br><span class="line"><span class="meta">rabbitmq.virtual-host</span>=<span class="string">/wuhu</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»º <code>Spring</code> æ ¸å¿ƒé…ç½®æ–‡ä»¶ <strong>spring-rabbitmq-consumer.xml</strong></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:rabbit</span>=<span class="string">&quot;http://www.springframework.org/schema/rabbit&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:rabbitmq.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">host</span>=<span class="string">&quot;$&#123;rabbitmq.host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">port</span>=<span class="string">&quot;$&#123;rabbitmq.port&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">username</span>=<span class="string">&quot;$&#123;rabbitmq.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">password</span>=<span class="string">&quot;$&#123;rabbitmq.password&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">virtual-host</span>=<span class="string">&quot;$&#123;rabbitmq.virtual-host&#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;springQueueListener&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hzx.rabbitmq.listener.SpringQueueListener&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fanoutListener1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hzx.rabbitmq.listener.FanoutListener1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fanoutListener2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hzx.rabbitmq.listener.FanoutListener2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;topicListenerStar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hzx.rabbitmq.listener.TopicListenerStar&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;topicListenerWell&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hzx.rabbitmq.listener.TopicListenerWell&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;topicListenerWell2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hzx.rabbitmq.listener.TopicListenerWell2&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">auto-declare</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;springQueueListener&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;spring_queue&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;fanoutListener1&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;spring_fanout_queue_1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;fanoutListener2&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;spring_fanout_queue_2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;topicListenerStar&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;spring_topic_queue_star&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;topicListenerWell&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;spring_topic_queue_well&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;topicListenerWell2&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;spring_topic_queue_well2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºæ¶ˆæ¯ç›‘å¬å™¨"><a href="#3ã€åˆ›å»ºæ¶ˆæ¯ç›‘å¬å™¨" class="headerlink" title="3ã€åˆ›å»ºæ¶ˆæ¯ç›‘å¬å™¨"></a>3ã€åˆ›å»ºæ¶ˆæ¯ç›‘å¬å™¨</h3><blockquote><p>åˆ›å»ºçš„ç›‘å¬å™¨å¿…é¡»å’Œä¸Šé¢ bean ä¸­é…ç½®çš„classè·¯å¾„ä¸€è‡´ï¼Œåˆ›å»ºçš„ç›‘å¬å™¨å¿…é¡»å®ç°ä¸€ä¸ª <code>MessageListener</code> æ¥å£ï¼Œå®ç° <code>onMessage</code> æ–¹æ³•</p></blockquote><ul><li>é˜Ÿåˆ—ç›‘å¬å™¨</li></ul><blockquote><p>åˆ›å»ºç¬¬ä¸€ä¸ªç›‘å¬å™¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringQueueListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¹¿æ’­é˜Ÿåˆ—ç›‘å¬å™¨ä¸€</li></ul><blockquote><p>ç”±äºå¹¿æ’­é˜Ÿåˆ—äºŒçš„ç›‘å¬å™¨ä»£ç å·®ä¸å¤šï¼Œæ‰€ä»¥ä¸å†èµ˜è¿°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutListener1</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¹¿æ’­é˜Ÿåˆ—ä¸€æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>topicé˜Ÿåˆ—ç›‘å¬å™¨ä¸€</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicListenerStar</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;topicé˜Ÿåˆ—ä¸€æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ä½¿ç”¨æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•"><a href="#4ã€ä½¿ç”¨æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•" class="headerlink" title="4ã€ä½¿ç”¨æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•"></a>4ã€ä½¿ç”¨æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œåªéœ€è¦åŠ è½½Springé…ç½®æ–‡ä»¶å’Œç›‘å¬å™¨ï¼Œæ¶ˆè´¹è€…å³å¯æ”¶åˆ°ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:spring-rabbitmq-consumer.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321171601.png" alt="image-20210321171600419"></p><h3 id="5ã€å°ç»“"><a href="#5ã€å°ç»“" class="headerlink" title="5ã€å°ç»“"></a>5ã€å°ç»“</h3><blockquote><p>æ¶ˆè´¹è€…åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨beanæ ‡ç­¾é…ç½®ç›‘å¬å™¨å¯¹è±¡å¹¶åˆ›å»ºç›‘å¬å™¨ç±»å³å¯ã€‚</p><p>ç›‘å¬å™¨ç±»å¿…é¡»å®ç° <code>MessageListener</code> æ¥å£ï¼Œé‡å†™ <code>onMessage</code> æ–¹æ³•</p></blockquote><h1 id="å…­ã€Spring-Bootæ•´åˆRabbitMQ"><a href="#å…­ã€Spring-Bootæ•´åˆRabbitMQ" class="headerlink" title="å…­ã€Spring Bootæ•´åˆRabbitMQ"></a>å…­ã€Spring Bootæ•´åˆRabbitMQ</h1><h2 id="6-1ã€ç”Ÿäº§è€…"><a href="#6-1ã€ç”Ÿäº§è€…" class="headerlink" title="6.1ã€ç”Ÿäº§è€…"></a>6.1ã€ç”Ÿäº§è€…</h2><h3 id="1ã€æ•´åˆæ­¥éª¤"><a href="#1ã€æ•´åˆæ­¥éª¤" class="headerlink" title="1ã€æ•´åˆæ­¥éª¤"></a>1ã€æ•´åˆæ­¥éª¤</h3><ul><li><p>åˆ›å»ºç”Ÿäº§è€…Spring Bootå·¥ç¨‹</p></li><li><p>å¼•å…¥ä¾èµ–åæ ‡</p></li><li><p>ç¼–å†™ é…ç½®æ–‡ä»¶ ï¼Œè¿›è¡ŒåŸºæœ¬ä¿¡æ¯é…ç½®ã€‚</p></li><li><p>å®šä¹‰äº¤æ¢æœºï¼Œé˜Ÿåˆ—åŠç»‘å®šå…³ç³»çš„é…ç½®ç±»</p></li><li><p>æ³¨å…¥<code>RabbitTemplate</code> ï¼Œè°ƒç”¨æ–¹æ³•å®Œæˆæ¶ˆæ¯å‘é€</p></li></ul><h3 id="2ã€å¼•å…¥ä¾èµ–"><a href="#2ã€å¼•å…¥ä¾èµ–" class="headerlink" title="2ã€å¼•å…¥ä¾èµ–"></a>2ã€å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€ç¼–å†™ä¸»å¯åŠ¨ç±»å’Œé…ç½®ç±»"><a href="#3ã€ç¼–å†™ä¸»å¯åŠ¨ç±»å’Œé…ç½®ç±»" class="headerlink" title="3ã€ç¼–å†™ä¸»å¯åŠ¨ç±»å’Œé…ç½®ç±»"></a>3ã€ç¼–å†™ä¸»å¯åŠ¨ç±»å’Œé…ç½®ç±»</h3><blockquote><p>ä¸‹é¢ç»™å‡ºé…ç½®ç±»çš„ä»£ç </p></blockquote><ul><li>åœ¨é…ç½®ç±»ä¸­åˆ›å»ºä¸€ä¸ªäº¤æ¢æœºå¯¹è±¡</li></ul><blockquote><p>ä½¿ç”¨ <code>ExchangeBuilder</code>.topicExchange(äº¤æ¢æœºå)æ¥åˆ›å»ºä¸€ä¸ª<strong>é€šé…ç¬¦äº¤æ¢æœº</strong>ï¼Œä½¿ç”¨.durable(true)æ–¹æ³•æ¥æŒä¹…åŒ–è¯¥äº¤æ¢æœºï¼Œæœ€ç»ˆä½¿ç”¨build()æ–¹æ³•åˆ›å»ºè¯¥äº¤æ¢æœºã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;boot_topic_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;boot_topic_queue&quot;</span>;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 1 äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;bootExchange&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Exchange <span class="title">bootExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.topicExchange(EXCHANGE_NAME)</span><br><span class="line">                              .durable(<span class="keyword">true</span>)</span><br><span class="line">                              .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><ul><li>åœ¨é…ç½®ç±»ä¸­åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å¯¹è±¡</li></ul><blockquote><p>ä½¿ç”¨<code>QueueBuilder</code>çš„durableæ–¹æ³•æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä½¿ç”¨buildæ–¹æ³•åˆ›å»ºè¯¥é˜Ÿåˆ—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;boot_topic_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;boot_topic_queue&quot;</span>;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 2 Queueé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;bootQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">bootQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><ul><li>åœ¨é…ç½®ç±»ä¸­ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºï¼Œå¹¶æŒ‡å®šrouting key</li></ul><blockquote><p>å…¶ä¸­ bind æ–¹æ³•ä¸­å¡«å†™è¦ç»‘å®šçš„é˜Ÿåˆ—ï¼Œtoæ–¹æ³•æ·»åŠ è¦ç»‘å®šçš„äº¤æ¢æœºï¼Œwithæ–¹æ³•æŒ‡å®š routing keyï¼Œnoargsè¡¨ç¤ºæ²¡æœ‰å…¶ä»–å‚æ•°ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;boot_topic_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;boot_topic_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 3 é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®šå…³ç³»ï¼Œbinding</span></span><br><span class="line"><span class="comment">     *      3.1 éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     *      3.2 éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     *      3.3 è®¾ç½®routing key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindQueueExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;bootQueue&quot;)</span> Queue queue,<span class="meta">@Qualifier(&quot;bootExchange&quot;)</span> Exchange exchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue)</span><br><span class="line">                             .to(exchange)</span><br><span class="line">                             .with(<span class="string">&quot;boot.#&quot;</span>)</span><br><span class="line">                             .noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>é…ç½®ç±»å…¨éƒ¨ä»£ç å¦‚ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hzx.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.AMQP;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;boot_topic_exchange&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;boot_topic_queue&quot;</span>;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 1 äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;bootExchange&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Exchange <span class="title">bootExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.topicExchange(EXCHANGE_NAME)</span><br><span class="line">                              .durable(<span class="keyword">true</span>)</span><br><span class="line">                              .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 2 Queueé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;bootQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">bootQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 3 é˜Ÿåˆ—å’Œäº¤æ¢æœºç»‘å®šå…³ç³»ï¼Œbinding</span></span><br><span class="line"><span class="comment">     *      3.1 éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     *      3.2 éœ€è¦çŸ¥é“æ˜¯å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     *      3.3 è®¾ç½®routing key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindQueueExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;bootQueue&quot;)</span> Queue queue,<span class="meta">@Qualifier(&quot;bootExchange&quot;)</span> Exchange exchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue)</span><br><span class="line">                             .to(exchange)</span><br><span class="line">                             .with(<span class="string">&quot;boot.#&quot;</span>)</span><br><span class="line">                             .noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ç¼–å†™æµ‹è¯•ç±»ä»£ç ï¼Œå‘é€æ¶ˆæ¯"><a href="#4ã€ç¼–å†™æµ‹è¯•ç±»ä»£ç ï¼Œå‘é€æ¶ˆæ¯" class="headerlink" title="4ã€ç¼–å†™æµ‹è¯•ç±»ä»£ç ï¼Œå‘é€æ¶ˆæ¯"></a>4ã€ç¼–å†™æµ‹è¯•ç±»ä»£ç ï¼Œå‘é€æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 æ³¨å…¥RabbitTemplate</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(RabbitMQConfig.EXCHANGE_NAME,<span class="string">&quot;boot.wuhu&quot;</span>,<span class="string">&quot;Spring Boot With MQ èŠœæ¹–&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿è¡Œä¸Šè¿°çš„ <code>testSend</code> æ–¹æ³•ï¼Œç„¶åæŸ¥çœ‹ MQ æ§åˆ¶å°</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321200802.png" alt="image-20210321200801250"></p><ul><li>åœ¨ Queues ä¸­ç‚¹å‡» <code>getMessages</code> å¯ä»¥æŸ¥çœ‹åˆ°æˆ‘ä»¬å‘é€çš„æ¶ˆæ¯</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321200945.png" alt="image-20210321200945203"></p><h2 id="6-2ã€æ¶ˆè´¹è€…"><a href="#6-2ã€æ¶ˆè´¹è€…" class="headerlink" title="6.2ã€æ¶ˆè´¹è€…"></a>6.2ã€æ¶ˆè´¹è€…</h2><h3 id="1ã€æ•´åˆæ­¥éª¤-1"><a href="#1ã€æ•´åˆæ­¥éª¤-1" class="headerlink" title="1ã€æ•´åˆæ­¥éª¤"></a>1ã€æ•´åˆæ­¥éª¤</h3><ul><li>åˆ›å»ºå·¥ç¨‹</li><li>å¼•å…¥ä¾èµ–</li><li>ç¼–å†™ é…ç½®æ–‡ä»¶ï¼Œé…ç½®åŸºæœ¬ä¿¡æ¯</li><li>å®šä¹‰ç›‘å¬ç±»ï¼Œä½¿ç”¨ <code>@RabbitListener</code> æ³¨è§£å®Œæˆé˜Ÿåˆ—ç›‘å¬</li></ul><h3 id="2ã€åˆ›å»ºå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–"><a href="#2ã€åˆ›å»ºå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–" class="headerlink" title="2ã€åˆ›å»ºå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–"></a>2ã€åˆ›å»ºå·¥ç¨‹ï¼Œå¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºç›‘å¬å™¨ç±»"><a href="#3ã€åˆ›å»ºç›‘å¬å™¨ç±»" class="headerlink" title="3ã€åˆ›å»ºç›‘å¬å™¨ç±»"></a>3ã€åˆ›å»ºç›‘å¬å™¨ç±»</h3><blockquote><p>ä½¿ç”¨ <code>@RabbitListener</code> æ³¨è§£å®Œæˆé˜Ÿåˆ—ç›‘å¬</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQListener</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨<span class="doctag">@RabbitListener</span>æ³¨è§£ç›‘å¬ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     * ç„¶åå°†æ¶ˆæ¯å°è£…åˆ°æ–¹æ³•å‚æ•° message ä¸­</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;boot_topic_queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ListenQueue</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ"><a href="#4ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ" class="headerlink" title="4ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ"></a>4ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ</h3><blockquote><p>æ¶ˆè´¹è€…ç«¯æ¥æ”¶åˆ°äº†æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321204810.png" alt="image-20210321204808938"></p><h2 id="6-3ã€Spring-Bootæ•´åˆMQâ€“Fanoutæ¨¡å¼"><a href="#6-3ã€Spring-Bootæ•´åˆMQâ€“Fanoutæ¨¡å¼" class="headerlink" title="6.3ã€Spring Bootæ•´åˆMQâ€“Fanoutæ¨¡å¼"></a>6.3ã€Spring Bootæ•´åˆMQâ€“Fanoutæ¨¡å¼</h2><blockquote><p>åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…å·¥ç¨‹</p></blockquote><h3 id="1ã€é€šè¿‡-Spring-Initializr-å¿«é€Ÿæ„å»ºä¸€ä¸ªSpring-Booté¡¹ç›®"><a href="#1ã€é€šè¿‡-Spring-Initializr-å¿«é€Ÿæ„å»ºä¸€ä¸ªSpring-Booté¡¹ç›®" class="headerlink" title="1ã€é€šè¿‡ Spring Initializr å¿«é€Ÿæ„å»ºä¸€ä¸ªSpring Booté¡¹ç›®"></a>1ã€é€šè¿‡ <code>Spring Initializr</code> å¿«é€Ÿæ„å»ºä¸€ä¸ªSpring Booté¡¹ç›®</h3><ul><li>æ·»åŠ æ¨¡å—</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322195552.png" alt="image-20210322195551672"></p><ul><li>å¼•å…¥ä¾èµ–</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322195630.png" alt="image-20210322195630695"></p><h3 id="2ã€ç¼–å†™-yml-é…ç½®æ–‡ä»¶"><a href="#2ã€ç¼–å†™-yml-é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€ç¼–å†™ yml é…ç½®æ–‡ä»¶"></a>2ã€ç¼–å†™ <code>yml</code> é…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®RabbitMQçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ipã€ç«¯å£ã€ç”¨æˆ·è´¦å·å¯†ç </span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="comment"># é…ç½®IP</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span></span><br><span class="line">    <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="comment"># è´¦å·</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="comment"># å¯†ç </span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="comment"># è™šæ‹Ÿæœº</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><h3 id="3ã€ç¼–å†™-OrderService-æœåŠ¡ç±»"><a href="#3ã€ç¼–å†™-OrderService-æœåŠ¡ç±»" class="headerlink" title="3ã€ç¼–å†™ OrderService æœåŠ¡ç±»"></a>3ã€ç¼–å†™ <code>OrderService</code> æœåŠ¡ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿç”¨æˆ·ä¸‹å•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> productId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nums</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeOrder</span><span class="params">(String userId,String productId,<span class="keyword">int</span> nums)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1 æ ¹æ®å•†å“idæŸ¥è¯¢åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">        <span class="comment">//2 ä¿å­˜è®¢å•</span></span><br><span class="line">        String orderId = UUID.randomUUID().toString();</span><br><span class="line">        System.out.println(<span class="string">&quot;è®¢å•ç”ŸæˆæˆåŠŸï¼š&quot;</span> + orderId);</span><br><span class="line">        <span class="comment">//3 é€šè¿‡MQå®Œæˆæ¶ˆæ¯çš„åˆ†å‘ï¼Œå‚æ•°1ï¼šäº¤æ¢æœºã€å‚æ•°2ï¼šè·¯ç”±key/queueåç§°ã€å‚æ•°3ï¼šæ¶ˆæ¯å†…å®¹</span></span><br><span class="line">        String exchangeName = <span class="string">&quot;fanout_order_exchange&quot;</span>;</span><br><span class="line">        <span class="comment">//å¹¿æ’­æ¨¡å¼ä¸‹è·¯ç”±keyä¸ºç©º</span></span><br><span class="line">        String routingKey = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(exchangeName,routingKey,orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºé˜Ÿåˆ—ä¸äº¤æ¢æœº"><a href="#4ã€ç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºé˜Ÿåˆ—ä¸äº¤æ¢æœº" class="headerlink" title="4ã€ç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºé˜Ÿåˆ—ä¸äº¤æ¢æœº"></a>4ã€ç¼–å†™é…ç½®ç±»ï¼Œåˆ›å»ºé˜Ÿåˆ—ä¸äº¤æ¢æœº</h3><ul><li>åˆ›å»º fanout æ¨¡å¼çš„äº¤æ¢æœº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 1 å£°æ˜æ³¨å†Œ fanout æ¨¡å¼çš„äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªåä¸º fanout_order_exchange çš„äº¤æ¢æœºï¼ŒæŒä¹…åŒ–ï¼Œä¸è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(<span class="string">&quot;fanout_order_exchange&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸‰ä¸ªé˜Ÿåˆ—</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 2 å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> *      sms.fanout.queue</span></span><br><span class="line"><span class="comment"> *      email.fanout.queue</span></span><br><span class="line"><span class="comment"> *      duanxin.fanout.queue</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue <span class="title">smsQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;sms.fanout.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue <span class="title">emailQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;email.fanout.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue <span class="title">duanxinQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;duanxin.fanout.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®Œæˆå¹¿æ’­äº¤æ¢æœºä¸ä¸‰ä¸ªé˜Ÿåˆ—çš„ç»‘å®š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 3 å®Œæˆé˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Binding <span class="title">smsBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(smsQueue()).to(fanoutExchange());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Binding <span class="title">emailBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(emailQueue()).to(fanoutExchange());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Binding <span class="title">duanxinBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(duanxinQueue()).to(fanoutExchange());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é…ç½®ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitMQConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 1 å£°æ˜æ³¨å†Œ fanout æ¨¡å¼çš„äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåä¸º fanout_order_exchange çš„äº¤æ¢æœºï¼ŒæŒä¹…åŒ–ï¼Œä¸è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(<span class="string">&quot;fanout_order_exchange&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 2 å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     *      sms.fanout.queue</span></span><br><span class="line"><span class="comment">     *      email.fanout.queue</span></span><br><span class="line"><span class="comment">     *      duanxin.fanout.queue</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">smsQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;sms.fanout.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">emailQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;email.fanout.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">duanxinQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;duanxin.fanout.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 3 å®Œæˆé˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">smsBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(smsQueue()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">emailBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(emailQueue()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">duanxinBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(duanxinQueue()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€åœ¨æµ‹è¯•ç±»ä¸­å‘é€æ¶ˆæ¯"><a href="#5ã€åœ¨æµ‹è¯•ç±»ä¸­å‘é€æ¶ˆæ¯" class="headerlink" title="5ã€åœ¨æµ‹è¯•ç±»ä¸­å‘é€æ¶ˆæ¯"></a>5ã€åœ¨æµ‹è¯•ç±»ä¸­å‘é€æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">orderService.makeOrder(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="number">12</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322203456.png" alt="image-20210322203454380"></p><ul><li>æŸ¥çœ‹æ§åˆ¶å°</li></ul><blockquote><p>å¯ä»¥çœ‹åˆ°åˆ›å»ºçš„ä¸‰ä¸ªé˜Ÿåˆ—éƒ½æœ‰æ¶ˆæ¯ç­‰å¾…æ¶ˆè´¹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322203540.png" alt="image-20210322203540517"></p><h3 id="6ã€æ„å»ºé¡¹ç›®"><a href="#6ã€æ„å»ºé¡¹ç›®" class="headerlink" title="6ã€æ„å»ºé¡¹ç›®"></a>6ã€æ„å»ºé¡¹ç›®</h3><blockquote><p>ä½¿ç”¨ <code>Spring Initializr</code> åˆ›å»ºé¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–</p></blockquote><h3 id="7ã€ç¼–å†™-yml-é…ç½®æ–‡ä»¶"><a href="#7ã€ç¼–å†™-yml-é…ç½®æ–‡ä»¶" class="headerlink" title="7ã€ç¼–å†™ yml é…ç½®æ–‡ä»¶"></a>7ã€ç¼–å†™ <code>yml</code> é…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®RabbitMQçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ipã€ç«¯å£ã€ç”¨æˆ·è´¦å·å¯†ç </span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="comment"># é…ç½®IP</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.56</span><span class="number">.101</span></span><br><span class="line">    <span class="comment"># ç«¯å£</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="comment"># è´¦å·</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="comment"># å¯†ç </span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="comment"># è™šæ‹Ÿæœº</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span></span><br></pre></td></tr></table></figure><h3 id="8ã€åˆ›å»ºConsumerç±»ï¼Œç»‘å®šé˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯"><a href="#8ã€åˆ›å»ºConsumerç±»ï¼Œç»‘å®šé˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯" class="headerlink" title="8ã€åˆ›å»ºConsumerç±»ï¼Œç»‘å®šé˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯"></a>8ã€åˆ›å»ºConsumerç±»ï¼Œç»‘å®šé˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯</h3><ul><li>åˆ›å»º <code>FanoutDuanxinConsumer</code> ç±»ï¼Œç»‘å®š <code>duanxin.fanout.queue</code> é˜Ÿåˆ—</li></ul><blockquote><p>ä½¿ç”¨ <code>@RabbitListener</code> çš„queueså±æ€§ç»‘å®šé˜Ÿåˆ—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;duanxin.fanout.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutDuanxinConsumer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;duanxin fanout ---æ¥æ”¶åˆ°çš„å¹¿æ’­ä¿¡æ¯ä¸ºï¼š&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨éœ€è¦æ¥æ”¶æ¶ˆæ¯çš„æ–¹æ³•ä¸Šä½¿ç”¨ <code>@RabbitHandler</code> æ³¨è§£ï¼Œç„¶åä½¿ç”¨ message å‚æ•°æ¥æ”¶æ¶ˆæ¯</p></blockquote><h3 id="9ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ"><a href="#9ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ" class="headerlink" title="9ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ"></a>9ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ</h3><blockquote><p>å¯ä»¥çœ‹åˆ°æ”¶åˆ°äº†æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322210803.png" alt="image-20210322210801958"></p><h2 id="6-4ã€Spring-Bootæ•´åˆMQâ€“Directæ¨¡å¼"><a href="#6-4ã€Spring-Bootæ•´åˆMQâ€“Directæ¨¡å¼" class="headerlink" title="6.4ã€Spring Bootæ•´åˆMQâ€“Directæ¨¡å¼"></a>6.4ã€Spring Bootæ•´åˆMQâ€“Directæ¨¡å¼</h2><h3 id="1ã€åˆ›å»º-DirectRabbitMQConfiguration-é…ç½®ç±»"><a href="#1ã€åˆ›å»º-DirectRabbitMQConfiguration-é…ç½®ç±»" class="headerlink" title="1ã€åˆ›å»º DirectRabbitMQConfiguration é…ç½®ç±»"></a>1ã€åˆ›å»º <code>DirectRabbitMQConfiguration</code> é…ç½®ç±»</h3><blockquote><p>åˆ›å»ºäº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼Œå®Œæˆç»‘å®š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectRabbitMQConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 1 å£°æ˜æ³¨å†Œ direct æ¨¡å¼çš„äº¤æ¢æœº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">directExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåä¸º direct_order_exchange çš„äº¤æ¢æœºï¼ŒæŒä¹…åŒ–ï¼Œä¸è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(<span class="string">&quot;direct_order_exchange&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 2 å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">     *      sms.direct.queue</span></span><br><span class="line"><span class="comment">     *      email.direct.queue</span></span><br><span class="line"><span class="comment">     *      duanxin.direct.queue</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">smsDirectQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;sms.direct.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">emailDirectQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;email.direct.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">duanxinDirectQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;duanxin.direct.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 3 å®Œæˆé˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">smsBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(smsDirectQueue()).to(directExchange()).with(<span class="string">&quot;sms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">emailBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(emailDirectQueue()).to(directExchange()).with(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">duanxinBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(duanxinDirectQueue()).to(directExchange()).with(<span class="string">&quot;duanxin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€å‘é€æ¶ˆæ¯"><a href="#2ã€å‘é€æ¶ˆæ¯" class="headerlink" title="2ã€å‘é€æ¶ˆæ¯"></a>2ã€å‘é€æ¶ˆæ¯</h3><blockquote><p>ç»™çŸ­ä¿¡å’Œemailå‘é€æ¶ˆæ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeOrderDirect</span><span class="params">(String userId,String productId,<span class="keyword">int</span> nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 æ ¹æ®å•†å“idæŸ¥è¯¢åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="comment">//2 ä¿å­˜è®¢å•</span></span><br><span class="line">    String orderId = UUID.randomUUID().toString();</span><br><span class="line">    System.out.println(<span class="string">&quot;è®¢å•ç”ŸæˆæˆåŠŸï¼š&quot;</span> + orderId);</span><br><span class="line">    <span class="comment">//3 é€šè¿‡MQå®Œæˆæ¶ˆæ¯çš„åˆ†å‘ï¼Œå‚æ•°1ï¼šäº¤æ¢æœºã€å‚æ•°2ï¼šè·¯ç”±key/queueåç§°ã€å‚æ•°3ï¼šæ¶ˆæ¯å†…å®¹</span></span><br><span class="line">    String exchangeName = <span class="string">&quot;direct_order_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//å¹¿æ’­æ¨¡å¼ä¸‹è·¯ç”±keyä¸ºç©º</span></span><br><span class="line">    String routingKey = <span class="string">&quot;sms&quot;</span>;</span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName,<span class="string">&quot;email&quot;</span>,orderId);</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName,routingKey,orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€æŸ¥çœ‹ç»“æœ"><a href="#3ã€æŸ¥çœ‹ç»“æœ" class="headerlink" title="3ã€æŸ¥çœ‹ç»“æœ"></a>3ã€æŸ¥çœ‹ç»“æœ</h3><blockquote><p>æ§åˆ¶å°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322212659.png" alt="image-20210322212657794"></p><blockquote><p><code>rabbitMQ</code>æ§åˆ¶å°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322212824.png" alt="image-20210322212824711"></p><h3 id="4ã€åˆ›å»ºConsumerç±»"><a href="#4ã€åˆ›å»ºConsumerç±»" class="headerlink" title="4ã€åˆ›å»ºConsumerç±»"></a>4ã€åˆ›å»ºConsumerç±»</h3><blockquote><p>ä»¥ <code>email.direct.queue</code> é˜Ÿåˆ—ä¸ºä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;email.direct.queue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectEmailConsumer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;email direct ---æ¥æ”¶åˆ°çš„ä¿¡æ¯ä¸ºï¼š&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ"><a href="#5ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ" class="headerlink" title="5ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ"></a>5ã€å¯åŠ¨æ¶ˆè´¹è€…ä¸»å¯åŠ¨ç±»ï¼ŒæŸ¥çœ‹ç»“æœ</h3><blockquote><p>å¯ä»¥çœ‹åˆ°åªæœ‰ <code>email</code> å’Œ <code>sms</code> æ”¶åˆ°äº†æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322213248.png" alt="image-20210322213248111"></p><h2 id="6-5ã€Spring-Bootæ•´åˆTTL"><a href="#6-5ã€Spring-Bootæ•´åˆTTL" class="headerlink" title="6.5ã€Spring Bootæ•´åˆTTL"></a>6.5ã€Spring Bootæ•´åˆTTL</h2><h3 id="1ã€é˜Ÿåˆ—è¿‡æœŸæ—¶é—´çš„é…ç½®"><a href="#1ã€é˜Ÿåˆ—è¿‡æœŸæ—¶é—´çš„é…ç½®" class="headerlink" title="1ã€é˜Ÿåˆ—è¿‡æœŸæ—¶é—´çš„é…ç½®"></a>1ã€é˜Ÿåˆ—è¿‡æœŸæ—¶é—´çš„é…ç½®</h3><ul><li>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»</li></ul><blockquote><p>è¿™ä¸ªé…ç½®ç±»ç”¨äºåˆ›å»º TTL ç”¨åˆ°çš„äº¤æ¢æœºã€é˜Ÿåˆ—</p><p>ä½¿ç”¨Mapæ¥ä¼ é€’å‚æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TTLRabbitMQConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">directExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(<span class="string">&quot;ttl_direct_exchange&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">directTTLQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        args.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;ttl.direct.queue&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">directTTLBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directTTLQueue()).to(directExchange()).with(<span class="string">&quot;ttl&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å‘é€æ¶ˆæ¯</li></ul><blockquote><p>åœ¨ç”Ÿäº§è€…ç«¯ç¼–å†™æ–¹æ³•å‘é€æ¶ˆæ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeOrderDirectTTL</span><span class="params">(String userId,String productId,<span class="keyword">int</span> nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 æ ¹æ®å•†å“idæŸ¥è¯¢åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="comment">//2 ä¿å­˜è®¢å•</span></span><br><span class="line">    String orderId = UUID.randomUUID().toString();</span><br><span class="line">    System.out.println(<span class="string">&quot;è®¢å•ç”ŸæˆæˆåŠŸï¼š&quot;</span> + orderId);</span><br><span class="line">    <span class="comment">//3 é€šè¿‡MQå®Œæˆæ¶ˆæ¯çš„åˆ†å‘ï¼Œå‚æ•°1ï¼šäº¤æ¢æœºã€å‚æ•°2ï¼šè·¯ç”±key/queueåç§°ã€å‚æ•°3ï¼šæ¶ˆæ¯å†…å®¹</span></span><br><span class="line">    String exchangeName = <span class="string">&quot;ttl_direct_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//å¹¿æ’­æ¨¡å¼ä¸‹è·¯ç”±keyä¸ºç©º</span></span><br><span class="line">    String routingKey = <span class="string">&quot;ttl&quot;</span>;</span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName,routingKey,orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç»“æœ</li></ul><blockquote><p>å¯ä»¥çœ‹åˆ°åœ¨<code>ttl.direct.queue</code>é˜Ÿåˆ—ä¸­å‡ºç°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œ5såæ¶ˆå¤±</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322215610.png" alt="image-20210322215609134"></p><h3 id="2ã€æ¶ˆæ¯è¿‡æœŸæ—¶é—´çš„é…ç½®"><a href="#2ã€æ¶ˆæ¯è¿‡æœŸæ—¶é—´çš„é…ç½®" class="headerlink" title="2ã€æ¶ˆæ¯è¿‡æœŸæ—¶é—´çš„é…ç½®"></a>2ã€æ¶ˆæ¯è¿‡æœŸæ—¶é—´çš„é…ç½®</h3><ul><li>åˆ›å»ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue <span class="title">directTTLMessageQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;ttlmsg.direct.queue&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Binding <span class="title">directTTLMessageBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(directTTLMessageQueue()).to(directExchange()).with(<span class="string">&quot;ttlmsg&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨å‘é€æ¶ˆæ¯æ—¶ç»™æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeOrderDirectTTLMsg</span><span class="params">(String userId,String productId,<span class="keyword">int</span> nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 æ ¹æ®å•†å“idæŸ¥è¯¢åº“å­˜æ˜¯å¦å……è¶³</span></span><br><span class="line">    <span class="comment">//2 ä¿å­˜è®¢å•</span></span><br><span class="line">    String orderId = UUID.randomUUID().toString();</span><br><span class="line">    System.out.println(<span class="string">&quot;è®¢å•ç”ŸæˆæˆåŠŸï¼š&quot;</span> + orderId);</span><br><span class="line">    <span class="comment">//3 é€šè¿‡MQå®Œæˆæ¶ˆæ¯çš„åˆ†å‘ï¼Œå‚æ•°1ï¼šäº¤æ¢æœºã€å‚æ•°2ï¼šè·¯ç”±key/queueåç§°ã€å‚æ•°3ï¼šæ¶ˆæ¯å†…å®¹</span></span><br><span class="line">    String exchangeName = <span class="string">&quot;ttl_direct_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//å¹¿æ’­æ¨¡å¼ä¸‹è·¯ç”±keyä¸ºç©º</span></span><br><span class="line">    String routingKey = <span class="string">&quot;ttl&quot;</span>;</span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯ï¼Œè¿™é‡Œéœ€è¦ç»™æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    MessagePostProcessor messagePostProcessor = <span class="keyword">new</span> MessagePostProcessor() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Message <span class="title">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException </span>&#123;</span><br><span class="line">            message.getMessageProperties().setExpiration(<span class="string">&quot;5000&quot;</span>);</span><br><span class="line">            message.getMessageProperties().setContentEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName,routingKey,orderId,messagePostProcessor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-6ã€Spring-Bootæ•´åˆæ­»ä¿¡é˜Ÿåˆ—"><a href="#6-6ã€Spring-Bootæ•´åˆæ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="6.6ã€Spring Bootæ•´åˆæ­»ä¿¡é˜Ÿåˆ—"></a>6.6ã€Spring Bootæ•´åˆæ­»ä¿¡é˜Ÿåˆ—</h2><h3 id="1ã€æ–°å¢ä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº"><a href="#1ã€æ–°å¢ä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº" class="headerlink" title="1ã€æ–°å¢ä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº"></a>1ã€æ–°å¢ä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºä¸€ä¸ªåä¸º dead_direct_exchange çš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DirectExchange <span class="title">deadDirectExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(<span class="string">&quot;dead_direct_exchange&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºä¸€ä¸ªåä¸º dead.direct.queue çš„æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue <span class="title">deadQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;dead.direct.queue&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº"><a href="#2ã€ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº" class="headerlink" title="2ã€ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº"></a>2ã€ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Binding <span class="title">deadBinding</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> BindingBuilder.bind(deadQueue()).to(deadDirectExchange()).with(<span class="string">&quot;dead&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€è®©æ­£å¸¸çš„TTLé˜Ÿåˆ—ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šå…³ç³»"><a href="#3ã€è®©æ­£å¸¸çš„TTLé˜Ÿåˆ—ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šå…³ç³»" class="headerlink" title="3ã€è®©æ­£å¸¸çš„TTLé˜Ÿåˆ—ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šå…³ç³»"></a>3ã€è®©æ­£å¸¸çš„TTLé˜Ÿåˆ—ä¸æ­»ä¿¡äº¤æ¢æœºç»‘å®šå…³ç³»</h3><blockquote><p>ä½¿ç”¨Mapä¼ å…¥å‚æ•°ï¼Œç»‘å®šæ­»ä¿¡äº¤æ¢æœº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue <span class="title">directTTLQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    Map&lt;String, Object&gt; args = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    args.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">5000</span>);</span><br><span class="line">    args.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,<span class="string">&quot;dead_direct_exchange&quot;</span>);</span><br><span class="line">    args.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;dead&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;ttl.direct.queue&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-7ã€å°ç»“"><a href="#6-7ã€å°ç»“" class="headerlink" title="6.7ã€å°ç»“"></a>6.7ã€å°ç»“</h2><ul><li>Spring Bootæä¾›äº†å¿«é€Ÿæ•´åˆ Rabbit MQ çš„æ–¹å¼</li><li>åŸºæœ¬ä¿¡æ¯åœ¨<code>yml</code>é…ç½®ï¼Œé˜Ÿåˆ—äº¤äº’æœºä»¥åŠç»‘å®šå…³ç³»åœ¨é…ç½®ç±»ä¸­ä½¿ç”¨Beançš„æ–¹å¼é…ç½®</li><li>ç”Ÿäº§ç«¯ç›´æ¥æ³¨å…¥ <code>RabbitTemplate</code> å®Œæˆæ¶ˆæ¯å‘é€</li><li>æ¶ˆè´¹ç«¯ç›´æ¥ä½¿ç”¨ <code>@RabbitListener</code> æ³¨è§£å®Œæˆæ¶ˆæ¯æ¥æ”¶ã€‚</li></ul><h1 id="ä¸ƒã€RabbitMQ-é«˜çº§ç‰¹æ€§"><a href="#ä¸ƒã€RabbitMQ-é«˜çº§ç‰¹æ€§" class="headerlink" title="ä¸ƒã€RabbitMQ é«˜çº§ç‰¹æ€§"></a>ä¸ƒã€RabbitMQ é«˜çº§ç‰¹æ€§</h1><h2 id="7-1ã€æ¶ˆæ¯çš„å¯é æŠ•é€’"><a href="#7-1ã€æ¶ˆæ¯çš„å¯é æŠ•é€’" class="headerlink" title="7.1ã€æ¶ˆæ¯çš„å¯é æŠ•é€’"></a>7.1ã€æ¶ˆæ¯çš„å¯é æŠ•é€’</h2><blockquote><p>åœ¨ä½¿ç”¨  RabbitMQ  çš„æ—¶å€™ï¼Œä½œä¸ºæ¶ˆæ¯å‘é€æ–¹å¼å¸Œæœ›æœç»ä»»ä½•æ¶ˆæ¯ä¸¢å¤±æˆ–è€…æŠ•é€’å¤±è´¥çš„åœºæ™¯ã€‚ RabbitMQ ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼æ¥æ§åˆ¶æ¶ˆæ¯çš„æŠ•é€’å¯é æ€§æ¨¡å¼ã€‚</p></blockquote><ul><li>confirm  ç¡®è®¤æ¨¡å¼</li><li>return  é€€å›æ¨¡å¼</li></ul><blockquote><p>RabbitMQ æ•´ä¸ªæ¶ˆæ¯æŠ•é€’çš„è·¯å¾„ä¸ºï¼š</p><p>producer â€“&gt; <code>rabbitmq broker</code> â€“&gt; exchange â€“&gt; queue â€“&gt; consumer</p></blockquote><ul><li>confirmæ¨¡å¼ï¼šæ¶ˆæ¯ä»  producer  åˆ°  exchange  åˆ™ä¼šè¿”å›ä¸€ä¸ª  <code>confirmCallback</code>ï¼ˆä¸ç®¡æŠ•é€’å¤±è´¥ä¸å¦éƒ½ä¼šè¿”å›ï¼Œä½†è¿”å›çš„å€¼æœ‰æ‰€ä¸åŒï¼‰</li><li>returnæ¨¡å¼ï¼šæ¶ˆæ¯ä» exchangeâ€“&gt;queue æŠ•é€’å¤±è´¥åˆ™ä¼šè¿”å›ä¸€ä¸ª <code>returnCallback</code> ï¼ˆåªæœ‰æŠ•é€’å¤±è´¥æ‰ä¼šè¿”å›ï¼‰</li></ul><blockquote><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„ä¸¤ä¸ª <code>callBack</code>  æ§åˆ¶æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’</p></blockquote><h3 id="1ã€confirmä»£ç æ¼”ç¤º"><a href="#1ã€confirmä»£ç æ¼”ç¤º" class="headerlink" title="1ã€confirmä»£ç æ¼”ç¤º"></a>1ã€confirmä»£ç æ¼”ç¤º</h3><ul><li>é…ç½®æ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:rabbit</span>=<span class="string">&quot;http://www.springframework.org/schema/rabbit&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:rabbitmq.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">host</span>=<span class="string">&quot;$&#123;rabbitmq.host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">port</span>=<span class="string">&quot;$&#123;rabbitmq.port&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">username</span>=<span class="string">&quot;$&#123;rabbitmq.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">password</span>=<span class="string">&quot;$&#123;rabbitmq.password&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">virtual-host</span>=<span class="string">&quot;$&#123;rabbitmq.virtual-host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">publisher-confirms</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:admin</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:template</span> <span class="attr">id</span>=<span class="string">&quot;rabbitTemplate&quot;</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ¶ˆæ¯çš„å¯é æ€§æŠ•é€’ï¼ˆåœ¨ç”Ÿäº§ç«¯ï¼‰ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;test_queue_confirm&quot;</span> <span class="attr">name</span>=<span class="string">&quot;test_queue_confirm&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rabbit:queue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:direct-exchange</span> <span class="attr">name</span>=<span class="string">&quot;test_exchange_confirm&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">queue</span>=<span class="string">&quot;test_queue_confirm&quot;</span> <span class="attr">key</span>=<span class="string">&quot;confirm&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rabbit:binding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:direct-exchange</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºæµ‹è¯•ç±»</li></ul><blockquote><p>ç¡®è®¤æ¨¡å¼å¼€å¯æ­¥éª¤ï¼š</p><ol><li>åœ¨connection-factoryï¼ˆé…ç½®æ–‡ä»¶ï¼‰ä¸­å¼€å¯ publisher-confirms=â€trueâ€</li><li>åœ¨<code>rabbitTemplate</code>ä¸­å®šä¹‰<code>ConfirmCallBack</code>å›è°ƒå‡½æ•°ï¼ˆå‡½æ•°å¼ç¼–ç¨‹ï¼‰</li><li>å‘é€æ¶ˆæ¯ï¼Œå¯ä»¥çœ‹åˆ°å›è°ƒå‡½æ•°è¢«æ‰§è¡Œ</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:spring-rabbitmq-producer.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ç¡®è®¤æ¨¡å¼</span></span><br><span class="line"><span class="comment">     *  æ­¥éª¤:</span></span><br><span class="line"><span class="comment">     *      1 ç¡®è®¤æ¨¡å¼å¼€å¯ï¼Œåœ¨connection-factoryï¼ˆé…ç½®æ–‡ä»¶ï¼‰ä¸­å¼€å¯</span></span><br><span class="line"><span class="comment">     *          publisher-confirms=&quot;true&quot;</span></span><br><span class="line"><span class="comment">     *      2 åœ¨rabbitTemplateä¸­å®šä¹‰ConfirmCallBackå›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConfirm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="keyword">new</span> RabbitTemplate.ConfirmCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">confirm</span><span class="params">(CorrelationData correlationData, <span class="keyword">boolean</span> b, String s)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;confirmæ–¹æ³•è¢«æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_confirm&quot;</span>,<span class="string">&quot;confirm&quot;</span>,<span class="string">&quot;message confirm...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321214141.png" alt="image-20210321214139793"></p><h3 id="2ã€confirmæ–¹æ³•çš„å‚æ•°è¯´æ˜"><a href="#2ã€confirmæ–¹æ³•çš„å‚æ•°è¯´æ˜" class="headerlink" title="2ã€confirmæ–¹æ³•çš„å‚æ•°è¯´æ˜"></a>2ã€confirmæ–¹æ³•çš„å‚æ•°è¯´æ˜</h3><ul><li>confirmæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">confirm</span><span class="params">(CorrelationData correlationData, <span class="keyword">boolean</span> ack, String cause)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;confirmæ–¹æ³•è¢«æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å‚æ•°è¯´æ˜</p></blockquote><ul><li><code>CorrelationData</code></li></ul><blockquote><p>ç›¸å…³é…ç½®ä¿¡æ¯</p></blockquote><ul><li>ack</li></ul><blockquote><p><strong>å…³é”®å‚æ•°</strong>ï¼Œè¡¨ç¤º <code>exchange</code> äº¤æ¢æœºæ˜¯å¦æˆåŠŸæ”¶åˆ°äº†æ¶ˆæ¯</p><p>trueè¡¨ç¤ºæˆåŠŸï¼Œfalseè¡¨ç¤ºå¤±è´¥</p></blockquote><ul><li>cause</li></ul><blockquote><p>å¤±è´¥çš„åŸå› </p></blockquote><ul><li>é‡æ–°ä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼Œæ·»åŠ  <code>ack</code> åˆ¤æ–­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">confirm</span><span class="params">(CorrelationData correlationData, <span class="keyword">boolean</span> ack, String cause)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;confirmæ–¹æ³•è¢«æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(ack) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿¡æ¯æˆåŠŸæŠ•é€’åˆ°exchangeä¸­ï¼&quot;</span> + cause);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿¡æ¯æ— æ³•æ­£ç¡®æŠ•é€’åˆ°exchangeä¸­ï¼å¤±è´¥åŸå› ï¼š&quot;</span> + cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é‡æ–°æ‰§è¡Œç»“æœå¦‚ä¸‹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321215616.png" alt="image-20210321215616593"></p><blockquote><p>å¦‚æœæŠ•é€’å¤±è´¥ï¼Œä»¥åå¯èƒ½ä¼šè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä¿è¯æ¶ˆæ¯å†æ¬¡æŠ•é€’</p></blockquote><h3 id="3ã€returnä»£ç æ¼”ç¤º"><a href="#3ã€returnä»£ç æ¼”ç¤º" class="headerlink" title="3ã€returnä»£ç æ¼”ç¤º"></a>3ã€returnä»£ç æ¼”ç¤º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å›é€€æ¨¡å¼ï¼šæ¶ˆæ¯å‘é€åˆ°exchangeåï¼ŒExchangeè·¯ç”±åˆ°Queueå¤±è´¥æ—¶æ‰ä¼šæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> *  ReturnCallBack</span></span><br><span class="line"><span class="comment"> *  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment"> *      1 å¼€å¯å›é€€æ¨¡å¼</span></span><br><span class="line"><span class="comment"> *          publisher-returns=&quot;true&quot;</span></span><br><span class="line"><span class="comment"> *      2 è®¾ç½®ReturnCallBack</span></span><br><span class="line"><span class="comment"> *      3 è®¾ç½®Exchangeå¤„ç†æ¶ˆæ¯çš„æ¨¡å¼</span></span><br><span class="line"><span class="comment"> *          3.1 å¦‚æœæ¶ˆæ¯æ²¡æœ‰è·¯ç”±åˆ°Queueï¼Œåˆ™ä¸¢å¼ƒ</span></span><br><span class="line"><span class="comment"> *          3.2 å¦‚æœæ¶ˆæ¯æ²¡æœ‰è·¯ç”±åˆ°Queueï¼Œè¿”å›ç»™æ¶ˆæ¯å‘é€æ–¹ReturnCallBack</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testReturn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®äº¤æ¢æœºå¤„ç†å¤±è´¥æ¶ˆæ¯çš„æ¨¡å¼ï¼šè¿™é‡Œè®¾ç½®ä¸ºè¿”å›</span></span><br><span class="line">    rabbitTemplate.setMandatory(<span class="keyword">true</span>);</span><br><span class="line">    rabbitTemplate.setReturnCallback(<span class="keyword">new</span> RabbitTemplate.ReturnCallback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnedMessage</span><span class="params">(Message message, <span class="keyword">int</span> i, String s, String s1, String s2)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;return æ–¹æ³•æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3 å‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_confirm&quot;</span>,<span class="string">&quot;confirm&quot;</span>,<span class="string">&quot;message confirm...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€returnå¤„ç†æ–¹å¼è¯´æ˜"><a href="#4ã€returnå¤„ç†æ–¹å¼è¯´æ˜" class="headerlink" title="4ã€returnå¤„ç†æ–¹å¼è¯´æ˜"></a>4ã€returnå¤„ç†æ–¹å¼è¯´æ˜</h3><ul><li>éœ€è¦åœ¨connection-factoryä¸­å¼€å¯å›é€€æ¨¡å¼</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">host</span>=<span class="string">&quot;$&#123;rabbitmq.host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">port</span>=<span class="string">&quot;$&#123;rabbitmq.port&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">username</span>=<span class="string">&quot;$&#123;rabbitmq.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">password</span>=<span class="string">&quot;$&#123;rabbitmq.password&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">virtual-host</span>=<span class="string">&quot;$&#123;rabbitmq.virtual-host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">publisher-confirms</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">publisher-returns</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®äº¤æ¢æœºå¤„ç†å¤±è´¥æ¶ˆæ¯çš„æ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆé»˜è®¤ä¸¢å¼ƒä¿¡æ¯ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä¿¡æ¯å¤„ç†å¤±è´¥è¿”å›æç¤ºï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è®¾ç½®äº¤æ¢æœºå¤„ç†å¤±è´¥æ¶ˆæ¯çš„æ–¹å¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®äº¤æ¢æœºå¤„ç†å¤±è´¥æ¶ˆæ¯çš„æ¨¡å¼ï¼šè¿™é‡Œè®¾ç½®ä¸ºè¿”å›</span></span><br><span class="line">rabbitTemplate.setMandatory(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure><ul><li>å°†ä¸Šè¿°ä»£ç ä¸­çš„ routing Key æ•…æ„å†™é”™ï¼Œé‡æ–°å¯åŠ¨ç¨‹åºæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321222218.png" alt="image-20210321222218150"></p><h3 id="5ã€returnæ–¹æ³•å‚æ•°è¯´æ˜"><a href="#5ã€returnæ–¹æ³•å‚æ•°è¯´æ˜" class="headerlink" title="5ã€returnæ–¹æ³•å‚æ•°è¯´æ˜"></a>5ã€returnæ–¹æ³•å‚æ•°è¯´æ˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">returnedMessage</span><span class="params">(Message message, <span class="keyword">int</span> replyCode, String replyText, String exchange, String routingKey)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;return æ–¹æ³•æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">    System.out.println(<span class="string">&quot;é”™è¯¯ç ä¸ºï¼š&quot;</span> + replyCode);</span><br><span class="line">    System.out.println(<span class="string">&quot;é”™è¯¯æ–‡æœ¬ä¸ºï¼š&quot;</span> + replyText);</span><br><span class="line">    System.out.println(<span class="string">&quot;äº¤æ¢æœºä¸ºï¼š&quot;</span> + exchange);</span><br><span class="line">    System.out.println(<span class="string">&quot;è·¯ç”±é”®ä¸ºï¼š&quot;</span> + routingKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>messageï¼šæ¶ˆæ¯å¯¹è±¡</li><li><code>replyCode</code>ï¼šé”™è¯¯ç </li><li><code>replyText</code>ï¼šé”™è¯¯ä¿¡æ¯</li><li>exchangeï¼šäº¤æ¢æœº</li><li><code>routingKey</code>ï¼šè·¯ç”±é”®</li></ul><blockquote><p>å†æ¬¡æ‰§è¡Œä¸Šé¢äº§ç”Ÿé”™è¯¯çš„ä»£ç </p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321222916.png" alt="image-20210321222916150"></p><h3 id="6ã€æ¶ˆæ¯å¯é æŠ•é€’å°ç»“"><a href="#6ã€æ¶ˆæ¯å¯é æŠ•é€’å°ç»“" class="headerlink" title="6ã€æ¶ˆæ¯å¯é æŠ•é€’å°ç»“"></a>6ã€æ¶ˆæ¯å¯é æŠ•é€’å°ç»“</h3><ul><li>è®¾ç½®<code>ConnectionFactory</code>çš„publisher-confirms=â€trueâ€ å¼€å¯ ç¡®è®¤æ¨¡å¼ã€‚</li><li>ä½¿ç”¨<code>rabbitTemplate.setConfirmCallback</code>è®¾ç½®å›è°ƒå‡½æ•°ã€‚</li></ul><blockquote><p>å½“æ¶ˆæ¯å‘é€åˆ°exchangeåå›è°ƒconfirmæ–¹æ³•ã€‚åœ¨æ–¹æ³•ä¸­åˆ¤æ–­ackï¼Œå¦‚æœä¸ºtrueï¼Œåˆ™å‘é€æˆåŠŸï¼Œå¦‚æœä¸ºfalseï¼Œåˆ™å‘é€å¤±è´¥ï¼Œéœ€è¦å¤„ç†ã€‚</p></blockquote><ul><li>è®¾ç½®<code>ConnectionFactory</code>çš„publisher-returns=â€trueâ€ å¼€å¯ å›é€€ æ¨¡å¼ã€‚</li><li>ä½¿ç”¨<code>rabbitTemplate.setReturnCallback</code>è®¾ç½®é€€å›å‡½æ•°ï¼Œå½“æ¶ˆæ¯ä»exchangeè·¯ç”±åˆ°queueå¤±è´¥åï¼Œå¦‚æœè®¾ç½®äº†<code>rabbitTemplate.setMandatory(true)</code>å‚æ•°ï¼Œåˆ™ä¼šå°†æ¶ˆæ¯é€€å›ç»™producerã€‚å¹¶æ‰§è¡Œå›è°ƒå‡½æ•°<code>returnedMessage</code>ã€‚</li><li>åœ¨RabbitMQä¸­ä¹Ÿæä¾›äº†äº‹åŠ¡æœºåˆ¶ï¼Œä½†æ˜¯æ€§èƒ½è¾ƒå·®ï¼Œæ­¤å¤„ä¸åšè®²è§£ã€‚</li></ul><blockquote><p>ä½¿ç”¨channelä¸‹åˆ—æ–¹æ³•ï¼Œå®Œæˆäº‹åŠ¡æ§åˆ¶ï¼š</p><ol><li>txSelect(), ç”¨äºå°†å½“å‰channelè®¾ç½®æˆtransactionæ¨¡å¼</li><li><code>txCommit()</code>ï¼Œç”¨äºæäº¤äº‹åŠ¡</li><li><code>txRollback()</code>ï¼Œç”¨äºå›æ»šäº‹åŠ¡</li></ol></blockquote><h2 id="7-2ã€Consumer-Ack"><a href="#7-2ã€Consumer-Ack" class="headerlink" title="7.2ã€Consumer Ack"></a>7.2ã€Consumer Ack</h2><h3 id="1ã€ackè¯´æ˜"><a href="#1ã€ackè¯´æ˜" class="headerlink" title="1ã€ackè¯´æ˜"></a>1ã€ackè¯´æ˜</h3><blockquote><p><code>ack</code> æŒ‡çš„æ˜¯ <code>Acknowledge</code>ï¼Œç¡®è®¤ã€‚è¡¨ç¤ºæ¶ˆè´¹ç«¯æ”¶åˆ°æ¶ˆæ¯åçš„ç¡®è®¤æ–¹å¼ã€‚</p><p>æœ‰ä¸‰ç§ç¡®è®¤æ–¹å¼ï¼š</p></blockquote><ul><li>è‡ªåŠ¨ç¡®è®¤ï¼šacknowledge = â€œnoneâ€</li></ul><blockquote><p>æ”¶åˆ°æ¶ˆæ¯åç›´æ¥è¿›è¡Œç¡®è®¤ï¼Œå¹¶ä¸ç®¡æ¶ˆæ¯çš„å¤„ç†ç»“æœå¦‚ä½•ï¼Œå¦‚æœæ¶ˆè´¹è€…åœ¨å¤„ç†è¿™æ¡æ¶ˆæ¯è¿›è¡Œä¸šåŠ¡å¤„ç†çš„è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºè¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰å‘æŒ¥ä½œç”¨ï¼ˆç›¸å½“äºæ¶ˆæ¯ä¸¢å¤±äº†ï¼‰</p></blockquote><ul><li>æ‰‹åŠ¨ç¡®è®¤ï¼šacknowledge = â€œmanualâ€</li></ul><blockquote><p>æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯åå¹¶ä¸ç›´æ¥ç¡®è®¤ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç­‰å¾…ä¸šåŠ¡å¤„ç†ï¼Œå¦‚æœä¸šåŠ¡å¤„ç†æˆåŠŸï¼Œé‚£ä¹ˆç›´æ¥å‘Šè¯‰ <code>Broker</code> æ¥æ”¶æˆåŠŸã€‚</p><p>å¦‚æœä¸šåŠ¡å¤„ç†å¤±è´¥ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›å…¶ä»–çš„å¤„ç†ï¼ˆæ¯”å¦‚è®©Brokerå†å‘ä¸€æ¬¡æ¶ˆæ¯ï¼‰ã€‚</p></blockquote><ul><li>æ ¹æ®å¼‚å¸¸æƒ…å†µç¡®è®¤ï¼šacknowledge = â€œautoâ€ï¼Œè¿™ç§æ–¹å¼ä½¿ç”¨è¿‡äºéº»çƒ¦ï¼Œæˆ‘ä»¬ä¸åšè®²è§£</li></ul><blockquote><p>å…¶ä¸­è‡ªåŠ¨ç¡®è®¤æ˜¯æŒ‡ï¼Œå½“æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¥æ”¶åˆ°ï¼Œåˆ™è‡ªåŠ¨ç¡®è®¤æ”¶åˆ°ï¼Œå¹¶å°†ç›¸åº” message ä» RabbitMQ çš„æ¶ˆæ¯ç¼“å­˜ä¸­ç§»é™¤ã€‚ä½†æ˜¯åœ¨å®é™…ä¸šåŠ¡å¤„ç†ä¸­ï¼Œå¾ˆå¯èƒ½æ¶ˆæ¯æ¥æ”¶åˆ°ï¼Œä¸šåŠ¡å¤„ç†å‡ºç°å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚</p><p>å¦‚æœè®¾ç½®äº†æ‰‹åŠ¨ç¡®è®¤æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨ä¸šåŠ¡å¤„ç†æˆåŠŸåï¼Œè°ƒç”¨<code>channel.basicAck()</code>ï¼Œæ‰‹åŠ¨ç­¾æ”¶ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨<code>channel.basicNack()</code>æ–¹æ³•ï¼Œè®©å…¶è‡ªåŠ¨é‡æ–°å‘é€æ¶ˆæ¯ã€‚</p></blockquote><h3 id="2ã€ä»£ç æ¼”ç¤º"><a href="#2ã€ä»£ç æ¼”ç¤º" class="headerlink" title="2ã€ä»£ç æ¼”ç¤º"></a>2ã€ä»£ç æ¼”ç¤º</h3><blockquote><p>åœ¨æ¶ˆè´¹è€…æ¨¡å—ä¸­å¼•å…¥ç¼–å†™é…ç½®æ–‡ä»¶</p></blockquote><ul><li><code>spring-rabbitmq-consumer.xml</code></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:rabbit</span>=<span class="string">&quot;http://www.springframework.org/schema/rabbit&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/rabbit/spring-rabbit.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŠ è½½é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:rabbitmq.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰rabbitmq connectionFactory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:connection-factory</span> <span class="attr">id</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">host</span>=<span class="string">&quot;$&#123;rabbitmq.host&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">port</span>=<span class="string">&quot;$&#123;rabbitmq.port&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">username</span>=<span class="string">&quot;$&#123;rabbitmq.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">password</span>=<span class="string">&quot;$&#123;rabbitmq.password&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">virtual-host</span>=<span class="string">&quot;$&#123;rabbitmq.virtual-host&#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰åŒ…æ‰«æï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦åœ¨listeneråŒ…ä¸‹ç±»ä¸Šæ·»åŠ @Conponentæ³¨è§£å³å¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hzx.listener&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;ackListener&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;test_queue_confirm&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ç±» <code>AckListener </code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AckListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸º:&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»åŠ è½½é…ç½®æ–‡ä»¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:spring-rabbitmq-consumer.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨æ–¹æ³•ï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321225552.png" alt="image-20210321225552003"></p><blockquote><p>ä¸Šé¢æƒ…å†µæ¼”ç¤ºçš„å°±æ˜¯è‡ªåŠ¨ç­¾æ”¶</p></blockquote><h3 id="3ã€è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæ¶ˆè´¹è€…ç«¯ï¼‰"><a href="#3ã€è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæ¶ˆè´¹è€…ç«¯ï¼‰" class="headerlink" title="3ã€è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæ¶ˆè´¹è€…ç«¯ï¼‰"></a>3ã€è®¾ç½®æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæ¶ˆè´¹è€…ç«¯ï¼‰</h3><ul><li>åœ¨ <code>rabbitMQ</code> çš„ ç›‘å¬å™¨å®¹å™¨ä¸­é…ç½®æ‰‹åŠ¨ç­¾æ”¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">acknowledge</span>=<span class="string">&quot;manual&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;ackListener&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;test_queue_confirm&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>è®©ç›‘å¬å™¨ä¸å†å®ç° <code>MessageListener</code> æ¥å£ï¼Œè€Œæ˜¯å®ç° <code>ChannelAwareMessageListener</code> æ¥å£ï¼ˆè¿™ä¸ªæ¥å£æ˜¯å‰è€…çš„å­æ¥å£ï¼‰ï¼Œå¹¶é‡å†™ <code>onMessage</code>æ–¹æ³•ï¼Œå’Œä¸Šä¸€ä¸ªæ¥å£çš„ <code>onMessage</code> æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œè¿™ä¸ª <code>onMessage</code> æ–¹æ³•æœ‰ä¸€ä¸ª <code>Channel</code> å¯¹è±¡ï¼Œå¯ä»¥ç”¨äºæ¶ˆæ¯çš„æ‰‹åŠ¨ç­¾æ”¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœæ¶ˆæ¯æˆåŠŸå¤„ç†ï¼Œè°ƒç”¨ Channel å¯¹è±¡çš„ <code>basicAck()</code> è¿›è¡Œç­¾æ”¶ï¼›å¦‚æœæ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œåˆ™è°ƒç”¨ Channel å¯¹è±¡çš„ <code>basicNack()</code> è¿›è¡Œæ‹’æ”¶ï¼Œæ­¤æ—¶å¯ä»¥è®©brokeré‡æ–°å‘é€æ¶ˆæ¯ç»™ consumer</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//è·å–æ¶ˆæ¯çš„deliveryTag</span></span><br><span class="line">    <span class="keyword">long</span> deliveryTag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1 æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">        <span class="comment">//2 å¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å¤„ç†ä¸šåŠ¡é€»è¾‘...&quot;</span>);</span><br><span class="line">        <span class="comment">//3 æ‰‹åŠ¨ç­¾æ”¶</span></span><br><span class="line">        <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°ï¼šç­¾æ”¶å¤šæ¡æ¶ˆæ¯</span></span><br><span class="line">        channel.basicAck(deliveryTag,<span class="keyword">true</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="comment">//4 å‡ºç°å¼‚å¸¸æ—¶æ‹’ç»ç­¾æ”¶ï¼Œè®©æ¶ˆæ¯é‡æ–°å‘é€</span></span><br><span class="line">        <span class="comment">//ç¬¬ä¸‰ä¸ªå‚æ•°requeue:é‡å›é˜Ÿåˆ—ï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¶ˆæ¯é‡å›åˆ°queueï¼Œbrokerä¼šé‡æ–°å‘é€è¯¥æ¶ˆæ¯ç»™æ¶ˆè´¹è€…</span></span><br><span class="line">        channel.basicNack(deliveryTag,<span class="keyword">true</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæˆåŠŸï¼‰"><a href="#4ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæˆåŠŸï¼‰" class="headerlink" title="4ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæˆåŠŸï¼‰"></a>4ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆæˆåŠŸï¼‰</h3><blockquote><p>ä¿®æ”¹ç”Ÿäº§è€…ç«¯çš„ä»£ç ï¼Œä½¿ä¹‹èƒ½æ­£ç¡®å‘é€æ¶ˆæ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3 å‘é€æ¶ˆæ¯</span></span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_confirm&quot;</span>,<span class="string">&quot;confirm&quot;</span>,<span class="string">&quot;æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶...&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆå¯åŠ¨æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯ï¼Œç„¶åå¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œå¯ä»¥çœ‹åˆ°æ¶ˆè´¹ç«¯æ¥æ”¶åˆ°äº†æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322104228.png" alt="image-20210322104227341"></p><h3 id="5ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆå¤±è´¥ï¼‰"><a href="#5ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆå¤±è´¥ï¼‰" class="headerlink" title="5ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆå¤±è´¥ï¼‰"></a>5ã€æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶ï¼ˆå¤±è´¥ï¼‰</h3><blockquote><p>ä¿®æ”¹ç›‘å¬å™¨ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">//è·å–æ¶ˆæ¯çš„deliveryTag</span></span><br><span class="line">    <span class="keyword">long</span> deliveryTag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1 æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">        <span class="comment">//2 å¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å¤„ç†ä¸šåŠ¡é€»è¾‘...&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">3</span>/<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//3 æ‰‹åŠ¨ç­¾æ”¶</span></span><br><span class="line">        <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°ï¼šç­¾æ”¶å¤šæ¡æ¶ˆæ¯</span></span><br><span class="line">        channel.basicAck(deliveryTag,<span class="keyword">true</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿¡æ¯ç­¾æ”¶æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿¡æ¯ç­¾æ”¶å¤±è´¥ï¼Œæ­£åœ¨é‡æ–°å‘é€ï¼&quot;</span>);</span><br><span class="line">        <span class="comment">//4 å‡ºç°å¼‚å¸¸æ—¶æ‹’ç»ç­¾æ”¶ï¼Œè®©æ¶ˆæ¯é‡æ–°å‘é€</span></span><br><span class="line">        <span class="comment">//ç¬¬ä¸‰ä¸ªå‚æ•°requeue:é‡å›é˜Ÿåˆ—ï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¶ˆæ¯é‡å›åˆ°queueï¼Œbrokerä¼šé‡æ–°å‘é€è¯¥æ¶ˆæ¯ç»™æ¶ˆè´¹è€…</span></span><br><span class="line">        channel.basicNack(deliveryTag,<span class="keyword">true</span>,<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‡æ–°å¯åŠ¨æ¶ˆè´¹è€…ï¼Œç„¶åå¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</p><p>æ‰§è¡Œç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322104853.png" alt="image-20210322104853086"></p><h3 id="6ã€Consumer-Ack-å°ç»“"><a href="#6ã€Consumer-Ack-å°ç»“" class="headerlink" title="6ã€Consumer Ack å°ç»“"></a>6ã€Consumer Ack å°ç»“</h3><ul><li>åœ¨<code>rabbit:listener-container</code>æ ‡ç­¾ä¸­è®¾ç½®acknowledgeå±æ€§ï¼Œè®¾ç½®ackæ–¹å¼ noneï¼šè‡ªåŠ¨ç¡®è®¤ï¼Œmanualï¼šæ‰‹åŠ¨ç¡®è®¤</li><li>å¦‚æœåœ¨æ¶ˆè´¹ç«¯æ²¡æœ‰å‡ºç°å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨<code>channel.basicAck(deliveryTag,false);</code>æ–¹æ³•ç¡®è®¤ç­¾æ”¶æ¶ˆæ¯</li><li>å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™åœ¨catchä¸­è°ƒç”¨ <code>basicNack</code>æˆ– <code>basicReject</code>ï¼Œæ‹’ç»æ¶ˆæ¯ï¼Œè®©MQé‡æ–°å‘é€æ¶ˆæ¯ã€‚</li></ul><h2 id="7-3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“"><a href="#7-3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“" class="headerlink" title="7.3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“"></a>7.3ã€æ¶ˆæ¯å¯é æ€§æ€»ç»“</h2><ul><li>æŒä¹…åŒ–<ul><li>exchangeè¦æŒä¹…åŒ–</li><li>queueè¦æŒä¹…åŒ–</li><li>messageè¦æŒä¹…åŒ–</li></ul></li><li>ç”Ÿäº§æ–¹ç¡®è®¤Confirm</li><li>æ¶ˆè´¹æ–¹ç¡®è®¤Ack</li><li>Brokeré«˜å¯ç”¨</li></ul><h2 id="7-4ã€æ¶ˆè´¹ç«¯é™æµ"><a href="#7-4ã€æ¶ˆè´¹ç«¯é™æµ" class="headerlink" title="7.4ã€æ¶ˆè´¹ç«¯é™æµ"></a>7.4ã€æ¶ˆè´¹ç«¯é™æµ</h2><h3 id="1ã€æ¶ˆè´¹ç«¯é™æµæ­¥éª¤"><a href="#1ã€æ¶ˆè´¹ç«¯é™æµæ­¥éª¤" class="headerlink" title="1ã€æ¶ˆè´¹ç«¯é™æµæ­¥éª¤"></a>1ã€æ¶ˆè´¹ç«¯é™æµæ­¥éª¤</h3><ul><li>ç¡®ä¿ackæœºåˆ¶ä¸ºæ‰‹åŠ¨ç­¾æ”¶</li></ul><blockquote><p>acknowledge=â€manualâ€</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">acknowledge</span>=<span class="string">&quot;manual&quot;</span> <span class="attr">prefetch</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;qosListener&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;test_queue_confirm&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>listener-container</code>é…ç½®å±æ€§ <code>prefetch = num</code></li></ul><blockquote><p>è¡¨ç¤ºæ¶ˆè´¹ç«¯ä¸€æ¬¡æœ€å¤šä»MQä¸­æ‹‰å–<code>num</code>æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œç›´åˆ°æ‰‹åŠ¨ç¡®è®¤è¿™äº›æ¶ˆæ¯æ¶ˆè´¹å®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­æ‹‰å–</p></blockquote><h3 id="2ã€åœ¨æ¶ˆè´¹ç«¯ç¼–å†™-QosListener"><a href="#2ã€åœ¨æ¶ˆè´¹ç«¯ç¼–å†™-QosListener" class="headerlink" title="2ã€åœ¨æ¶ˆè´¹ç«¯ç¼–å†™ QosListener"></a>2ã€åœ¨æ¶ˆè´¹ç«¯ç¼–å†™ <code>QosListener</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * Consumer é™æµæœºåˆ¶</span></span><br><span class="line"><span class="comment"> *  æ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment"> *      1 ç¡®ä¿ackæœºåˆ¶ä¸ºæ‰‹åŠ¨ç­¾æ”¶</span></span><br><span class="line"><span class="comment"> *          acknowledge=&quot;manual&quot;</span></span><br><span class="line"><span class="comment"> *      2 åœ¨listener-containeré…ç½®å±æ€§ prefetch = num</span></span><br><span class="line"><span class="comment"> *          è¡¨ç¤ºæ¶ˆè´¹ç«¯ä¸€æ¬¡æœ€å¤šä»MQä¸­æ‹‰å– num æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line"><span class="comment"> *          ç›´åˆ°æ‰‹åŠ¨ç¡®è®¤è¿™äº›æ¶ˆæ¯æ¶ˆè´¹å®Œæ¯•åï¼Œæ‰ä¼šç»§ç»­æ‹‰å–</span></span><br><span class="line"><span class="comment"> *          prefetch=&quot;1&quot;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QosListener</span> <span class="keyword">implements</span> <span class="title">ChannelAwareMessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> deliveryTag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">        System.out.println(<span class="string">&quot;å¤„ç†ä¸šåŠ¡é€»è¾‘...&quot;</span>);</span><br><span class="line">        channel.basicAck(deliveryTag,<span class="keyword">true</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;--------------------------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€ç¼–å†™ç”Ÿäº§è€…ç«¯ä»£ç ï¼Œå‘é€å¤šæ¡æ¶ˆæ¯"><a href="#3ã€ç¼–å†™ç”Ÿäº§è€…ç«¯ä»£ç ï¼Œå‘é€å¤šæ¡æ¶ˆæ¯" class="headerlink" title="3ã€ç¼–å†™ç”Ÿäº§è€…ç«¯ä»£ç ï¼Œå‘é€å¤šæ¡æ¶ˆæ¯"></a>3ã€ç¼–å†™ç”Ÿäº§è€…ç«¯ä»£ç ï¼Œå‘é€å¤šæ¡æ¶ˆæ¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//å‘é€å¤šæ¡æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_confirm&quot;</span>,<span class="string">&quot;confirm&quot;</span>,<span class="string">&quot;æµ‹è¯•æ‰‹åŠ¨ç­¾æ”¶...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åŒæ—¶æ³¨é‡Šæ‰ç›‘å¬å™¨ä¸­ç”¨äºç­¾æ”¶æ¶ˆæ¯çš„ä»£ç ï¼Œè¿™æ ·åœ¨ç¬¬ä¸€æ¡æ¶ˆæ¯æ²¡æœ‰è¢«ç­¾æ”¶çš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…ä¸ä¼šä»MQä¸­å†æ¬¡æ‹‰å–æ¶ˆæ¯æ¶ˆè´¹ï¼Œæ‰€ä»¥æ§åˆ¶å°ä¸­åªæœ‰ä¸€æ¡æ¶ˆæ¯è¢«æ‰“å°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//channel.basicAck(deliveryTag,true);</span></span><br></pre></td></tr></table></figure><h3 id="4ã€æµ‹è¯•"><a href="#4ã€æµ‹è¯•" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h3><blockquote><p>å…ˆå¯åŠ¨æ¶ˆè´¹è€…ï¼Œç„¶åå¯åŠ¨ç”Ÿäº§è€…</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè´¹è€…åªæ‹‰å–äº†ä¸€æ¡æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œæ²¡æœ‰å¤„ç†ç”Ÿäº§è€…ä¸­å‘é€çš„å…¶ä½™9æ¡æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322112312.png" alt="image-20210322112310933"></p><blockquote><p>å¦‚æœæ·»åŠ ç­¾æ”¶ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…ä¼šæ‹‰å–ä¸€æ¡ï¼Œæ¶ˆè´¹ä¸€æ¡ï¼Œç­¾æ”¶ä¸€æ¡ï¼Œç„¶åå†è¿›è¡Œæ‹‰å–</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322112842.png" alt="image-20210322112842161"></p><h3 id="5ã€æ¶ˆè´¹ç«¯é™æµå°ç»“"><a href="#5ã€æ¶ˆè´¹ç«¯é™æµå°ç»“" class="headerlink" title="5ã€æ¶ˆè´¹ç«¯é™æµå°ç»“"></a>5ã€æ¶ˆè´¹ç«¯é™æµå°ç»“</h3><ul><li>åœ¨ &lt; <code>rabbit:listener-container</code> &gt; ä¸­é…ç½® prefetchå±æ€§è®¾ç½®æ¶ˆè´¹ç«¯ä¸€æ¬¡æ‹‰å–å¤šå°‘æ¶ˆæ¯</li><li>æ¶ˆè´¹ç«¯çš„ç¡®è®¤æ¨¡å¼ä¸€å®šä¸º<strong>æ‰‹åŠ¨ç¡®è®¤</strong>ã€‚acknowledge=â€manualâ€</li></ul><h2 id="7-5ã€TTL"><a href="#7-5ã€TTL" class="headerlink" title="7.5ã€TTL"></a>7.5ã€TTL</h2><h3 id="1ã€æ¦‚å¿µè¯´æ˜"><a href="#1ã€æ¦‚å¿µè¯´æ˜" class="headerlink" title="1ã€æ¦‚å¿µè¯´æ˜"></a>1ã€æ¦‚å¿µè¯´æ˜</h3><blockquote><ul><li>TTL å…¨ç§° Time To Liveï¼ˆå­˜æ´»æ—¶é—´/è¿‡æœŸæ—¶é—´ï¼‰ã€‚</li><li>å½“æ¶ˆæ¯åˆ°è¾¾å­˜æ´»æ—¶é—´åï¼Œè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚</li><li><code>RabbitMQ</code>å¯ä»¥å¯¹æ¶ˆæ¯è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å¯¹æ•´ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322113201.png" alt="image-20210322113201168"></p><blockquote><p>ç”¨æˆ·åœ¨è®¢å•ç³»ç»Ÿä¸‹è®¢å•åï¼Œè®¢å•ç³»ç»Ÿä¼šå‘é€ä¸€ä¸ªæ¶ˆæ¯ç»™æ”¯ä»˜ç³»ç»Ÿï¼Œå¦‚æœä¸‹è®¢å•çš„ä¸‰ååˆ†é’Ÿå†…æ”¯ä»˜ç³»ç»Ÿè¿˜æ²¡æœ‰å–èµ°æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼ˆç”¨æˆ·æ²¡æœ‰ä»˜æ¬¾ï¼‰çš„è¯ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯ä¼šä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¢«æ¸…é™¤ã€‚</p></blockquote><h3 id="2ã€ä»£ç å®ç°"><a href="#2ã€ä»£ç å®ç°" class="headerlink" title="2ã€ä»£ç å®ç°"></a>2ã€ä»£ç å®ç°</h3><blockquote><p>åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼Œè®¾ç½®é˜Ÿåˆ—å†…æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰ä¸º10s</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ttl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">name</span>=<span class="string">&quot;test-queue-ttl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test-queue-ttl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- x-message-ttlæŒ‡é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-message-ttl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">value-type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:queue</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;test_exchange_ttl&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;ttl.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;test-queue-ttl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™ä»£ç ï¼Œå‘é€æ¶ˆæ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTtl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_ttl&quot;</span>,<span class="string">&quot;ttl.hehe&quot;</span>,<span class="string">&quot;message ttl...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶æŸ¥çœ‹æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ° <code>test_queue_ttl</code> é˜Ÿåˆ—ä¸­æœ‰åæ¡æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="C:/Users/caibighead/AppData/Roaming/Typora/typora-user-images/image-20210322141344751.png" alt="image-20210322141344751"></p><blockquote><p>åç§’åå†æŸ¥çœ‹ï¼Œå‘ç°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å…¨éƒ¨æ¶ˆå¤±ï¼Œè¿™æ˜¯ç”±äºæ¶ˆæ¯çš„å­˜æ´»æ—¶é—´åˆ°æœŸ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="C:/Users/caibighead/AppData/Roaming/Typora/typora-user-images/image-20210322141448263.png" alt="image-20210322141448263"></p><h3 id="3ã€è®¾ç½®æ¶ˆæ¯å•ç‹¬è¿‡æœŸ"><a href="#3ã€è®¾ç½®æ¶ˆæ¯å•ç‹¬è¿‡æœŸ" class="headerlink" title="3ã€è®¾ç½®æ¶ˆæ¯å•ç‹¬è¿‡æœŸ"></a>3ã€è®¾ç½®æ¶ˆæ¯å•ç‹¬è¿‡æœŸ</h3><blockquote><p>éœ€è¦åˆ›å»ºä¸€ä¸ª <code>MessagePostProcessor</code> å¯¹è±¡æ¥æŒ‡å®šï¼Œå¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTtl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="comment">/***</span></span><br><span class="line"><span class="comment">         * æ¶ˆæ¯çš„åå¤„ç†å¯¹è±¡ï¼Œç”¨äºè®¾ç½®ä¸€äº›æ¶ˆæ¯çš„å‚æ•°ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        MessagePostProcessor messagePostProcessor = <span class="keyword">new</span> MessagePostProcessor() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Message <span class="title">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException </span>&#123;</span><br><span class="line">                <span class="comment">//1 è®¾ç½®messageçš„ä¿¡æ¯ï¼Œè®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</span></span><br><span class="line">                message.getMessageProperties().setExpiration(<span class="string">&quot;5000&quot;</span>);</span><br><span class="line">                <span class="comment">//2 è¿”å›è¯¥ä¿¡æ¯</span></span><br><span class="line">                <span class="keyword">return</span> message;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_ttl&quot;</span>,<span class="string">&quot;ttl.hehe&quot;</span>,<span class="string">&quot;message ttl...&quot;</span>,messagePostProcessor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶é‡æ–°å‘é€æ¶ˆæ¯ï¼Œå¯ä»¥çœ‹åˆ°æ¶ˆæ¯åœ¨äº”ç§’é’Ÿåè¿‡æœŸ</p></blockquote><h3 id="4ã€è¿‡æœŸæ—¶é—´è¯´æ˜"><a href="#4ã€è¿‡æœŸæ—¶é—´è¯´æ˜" class="headerlink" title="4ã€è¿‡æœŸæ—¶é—´è¯´æ˜"></a>4ã€è¿‡æœŸæ—¶é—´è¯´æ˜</h3><ul><li>å¦‚æœæ—¢è®¾ç½®äº†é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿè®¾ç½®äº†æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆä»¥æ—¶é—´æ®µçš„ä¸ºå‡†</li><li>é˜Ÿåˆ—è¿‡æœŸåï¼Œä¼šå°†é˜Ÿåˆ—ä¸­æ‰€æœ‰æ¶ˆæ¯å…¨éƒ¨ç§»é™¤</li><li>æ¶ˆæ¯è¿‡æœŸåï¼Œåªæœ‰æ¶ˆæ¯åœ¨é˜Ÿåˆ—é¡¶ç«¯ï¼Œæ‰ä¼šåˆ¤æ–­æ˜¯å¦è¿‡æœŸï¼ˆç§»é™¤æ‰ï¼‰</li></ul><h3 id="5ã€TTLå°ç»“"><a href="#5ã€TTLå°ç»“" class="headerlink" title="5ã€TTLå°ç»“"></a>5ã€TTLå°ç»“</h3><ul><li>è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ä½¿ç”¨å‚æ•°ï¼š<code>x-message-ttl</code>ï¼Œå•ä½ï¼š<code>ms</code>(æ¯«ç§’)ï¼Œä¼šå¯¹æ•´ä¸ªé˜Ÿåˆ—æ¶ˆæ¯ç»Ÿä¸€è¿‡æœŸã€‚</li><li>è®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´ä½¿ç”¨å‚æ•°ï¼šexpirationã€‚å•ä½ï¼š<code>ms</code>(æ¯«ç§’)ï¼Œå½“è¯¥æ¶ˆæ¯åœ¨é˜Ÿåˆ—å¤´éƒ¨æ—¶ï¼ˆæ¶ˆè´¹æ—¶ï¼‰ï¼Œä¼šå•ç‹¬åˆ¤æ–­è¿™ä¸€æ¶ˆæ¯æ˜¯å¦è¿‡æœŸã€‚</li><li>å¦‚æœä¸¤è€…éƒ½è¿›è¡Œäº†è®¾ç½®ï¼Œä»¥æ—¶é—´çŸ­çš„ä¸ºå‡†ã€‚</li></ul><h2 id="7-6ã€æ­»ä¿¡é˜Ÿåˆ—"><a href="#7-6ã€æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="7.6ã€æ­»ä¿¡é˜Ÿåˆ—"></a>7.6ã€æ­»ä¿¡é˜Ÿåˆ—</h2><h3 id="1ã€æ¦‚å¿µè¯´æ˜-1"><a href="#1ã€æ¦‚å¿µè¯´æ˜-1" class="headerlink" title="1ã€æ¦‚å¿µè¯´æ˜"></a>1ã€æ¦‚å¿µè¯´æ˜</h3><blockquote><p>æ­»ä¿¡é˜Ÿåˆ—ï¼Œè‹±æ–‡ç¼©å†™ï¼šDLX  ã€‚Dead Letter Exchangeï¼ˆæ­»ä¿¡äº¤æ¢æœºï¼‰ï¼Œå½“æ¶ˆæ¯æˆä¸ºDead messageåï¼Œå¯ä»¥è¢«é‡æ–°å‘é€åˆ°å¦ä¸€ä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºå°±æ˜¯DLXã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322143915.png" alt="image-20210322143915389"></p><blockquote><p>ç”Ÿäº§è€…å°†ä¸€ä¸ªå¸¦æœ‰è¿‡æœŸæ—¶é—´çš„æ¶ˆæ¯æŠ•é€åˆ°äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºå‘é€åˆ°ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ä¸­ï¼Œå½“æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œè¿™ä¸ªæ¶ˆæ¯å°±æˆä¸ºäº† <strong>æ­»ä¿¡</strong> ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå­˜æ”¾æ­»ä¿¡çš„é˜Ÿåˆ—å¯ä»¥å°†æ­»ä¿¡å‘é€åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œæ­»ä¿¡äº¤æ¢æœºå¯ä»¥å°†è¯¥æ­»ä¿¡å‘é€ç»™ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ï¼Œè¿™æ ·å¯ä»¥è®©æ­»ä¿¡ä¸ºå…¶ä»–æ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li>é˜Ÿåˆ—å¦‚ä½•ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼Ÿ</li><li>æ¶ˆæ¯å¦‚ä½•æˆä¸ºæ­»ä¿¡ï¼Ÿ</li></ul><h3 id="2ã€æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ"><a href="#2ã€æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ" class="headerlink" title="2ã€æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ"></a>2ã€æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µ</h3><ul><li>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶ï¼ˆé˜Ÿåˆ—æœ€å¤šèƒ½å­˜å‚¨10ä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆç¬¬åä¸€ä¸ªæ¶ˆæ¯å°±ä¼šæˆä¸ºæ­»ä¿¡ï¼‰ï¼›</li><li>æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œ<code>basicNack/basicReject</code>,å¹¶ä¸”ä¸æŠŠæ¶ˆæ¯é‡æ–°æ”¾å…¥åŸç›®æ ‡é˜Ÿåˆ—,requeue=falseï¼›</li><li>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼›</li></ul><h3 id="3ã€é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº"><a href="#3ã€é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº" class="headerlink" title="3ã€é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº"></a>3ã€é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº</h3><blockquote><p>ç»™é˜Ÿåˆ—è®¾ç½®å‚æ•°ï¼š x-dead-letter-exchange å’Œ x-dead-letter-routing-key</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322145020.png" alt="image-20210322145019954"></p><h3 id="4ã€æ­»ä¿¡é˜Ÿåˆ—æ¼”ç¤ºæ­¥éª¤"><a href="#4ã€æ­»ä¿¡é˜Ÿåˆ—æ¼”ç¤ºæ­¥éª¤" class="headerlink" title="4ã€æ­»ä¿¡é˜Ÿåˆ—æ¼”ç¤ºæ­¥éª¤"></a>4ã€æ­»ä¿¡é˜Ÿåˆ—æ¼”ç¤ºæ­¥éª¤</h3><ul><li>å£°æ˜æ­£å¸¸çš„é˜Ÿåˆ—ï¼ˆtest_queue_dlxï¼‰å’Œäº¤æ¢æœºï¼ˆtest_exchange_dlxï¼‰</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    1. å£°æ˜æ­£å¸¸çš„é˜Ÿåˆ—ï¼ˆtest_queue_dlxï¼‰å’Œäº¤æ¢æœºï¼ˆtest_exchange_dlxï¼‰</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">name</span>=<span class="string">&quot;test_queue_dlx&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test_queue_dlx&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;test_exchange_dlx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;test.dlx.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;test_queue_dlx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å£°æ˜æ­»ä¿¡é˜Ÿåˆ—ï¼ˆqueue_dlxï¼‰å’Œæ­»ä¿¡äº¤æ¢æœºï¼ˆexchange_dlxï¼‰</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    2. å£°æ˜æ­»ä¿¡é˜Ÿåˆ—ï¼ˆqueue_dlxï¼‰å’Œæ­»ä¿¡äº¤æ¢æœºï¼ˆexchange_dlxï¼‰</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">name</span>=<span class="string">&quot;queue_dlx&quot;</span> <span class="attr">id</span>=<span class="string">&quot;queue_dlx&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;exchange_dlx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;dlx.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;queue_dlx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºï¼Œè®¾ç½®ä¸¤ä¸ªå‚æ•°</li></ul><blockquote><ol><li>x-dead-letter-exchangeï¼šæ­»ä¿¡äº¤æ¢æœºåç§°</li><li>x-dead-letter-routing-keyï¼šå‘é€ç»™æ­»ä¿¡äº¤æ¢æœºçš„routing key</li></ol><p>ä¸ºä¸Šé¢çš„æ­£å¸¸é˜Ÿåˆ—è®¾ç½®å‚æ•°ï¼Œç»‘å®šæ­»ä¿¡äº¤æ¢æœº</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">name</span>=<span class="string">&quot;test_queue_dlx&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test_queue_dlx&quot;</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 3 æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- 3.1 x-dead-letter-exchangeï¼šæ­»ä¿¡äº¤æ¢æœºåç§° --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-exchange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;exchange_dlx&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 3.2 x-dead-letter-routing-keyï¼šå‘é€ç»™æ­»ä¿¡äº¤æ¢æœºçš„routing key --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-routing-key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dlx.hehe&quot;</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">rabbit:queue</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>è®©æ­£å¸¸é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æˆä¸ºæ­»ä¿¡</li></ul><blockquote><p>æ–¹æ³•ä¸€ï¼šè®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3.1 x-dead-letter-exchangeï¼šæ­»ä¿¡äº¤æ¢æœºåç§° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-exchange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;exchange_dlx&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3.2 x-dead-letter-routing-keyï¼šå‘é€ç»™æ­»ä¿¡äº¤æ¢æœºçš„routing key --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-routing-key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dlx.hehe&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 4.1 è®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ ttl --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-message-ttl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">value-type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ–¹æ³•äºŒï¼šè®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3.1 x-dead-letter-exchangeï¼šæ­»ä¿¡äº¤æ¢æœºåç§° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-exchange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;exchange_dlx&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3.2 x-dead-letter-routing-keyï¼šå‘é€ç»™æ­»ä¿¡äº¤æ¢æœºçš„routing key --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-routing-key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dlx.hehe&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 4.2 è®¾ç½®é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶ max-length --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-max-length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> <span class="attr">value-type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å‘é€æµ‹è¯•æ­»ä¿¡æ¶ˆæ¯</li></ul><ol><li>æµ‹è¯•è¿‡æœŸæ—¶é—´çš„æ­»ä¿¡æ¶ˆæ¯</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 æµ‹è¯•è¿‡æœŸæ—¶é—´ï¼Œä¿¡æ¯æ¶ˆæ¯</span></span><br><span class="line">MessagePostProcessor messagePostProcessor = <span class="keyword">new</span> MessagePostProcessor() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Message <span class="title">postProcessMessage</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException </span>&#123;</span><br><span class="line">        <span class="comment">//1 è®¾ç½®messageçš„ä¿¡æ¯ï¼Œè®¾ç½®æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</span></span><br><span class="line">        message.getMessageProperties().setExpiration(<span class="string">&quot;5000&quot;</span>);</span><br><span class="line">        <span class="comment">//2 è¿”å›è¯¥ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_dlx&quot;</span>,<span class="string">&quot;test.dlx.wuhu&quot;</span>,<span class="string">&quot;è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œå®ƒä¼šæˆä¸ºæ­»ä¿¡ï¼Œåˆ°è¾¾æ­»ä¿¡é˜Ÿåˆ—ä¸­...&quot;</span>,messagePostProcessor);</span><br></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨ç¨‹åºåï¼Œæ­£å¸¸é˜Ÿåˆ—ä¸­ä¼šå‡ºç°ä¸€æ¡ä¿¡æ¯ï¼Œåœ¨å­˜æ´»5såï¼Œè¿™æ¡æ¶ˆæ¯ä¼šè¿‡æœŸï¼Œç„¶åç»ç”±æ­»ä¿¡äº¤æ¢æœºè·‘åˆ°æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç°æ­£å¸¸é˜Ÿåˆ—ä¸­æœ‰ä¸€æ¡æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322151924.png" alt="image-20210322151923962"></p><blockquote><p>5såï¼Œå‘ç°æ­£å¸¸é˜Ÿåˆ—çš„æ¶ˆæ¯æ¶ˆå¤±äº†ï¼Œè€Œæ­»ä¿¡é˜Ÿåˆ—ä¸­å‡ºç°äº†ä¸€æ¡ä¿¡æ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322152145.png" alt="image-20210322152145353"></p><blockquote><p>åœ¨æ­»ä¿¡é˜Ÿåˆ—ä¸­æŸ¥çœ‹è¯¥æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322152438.png" alt="image-20210322152438057"></p><ol start="2"><li>æµ‹è¯•é•¿åº¦é™åˆ¶åï¼Œæ¶ˆæ¯æ­»ä¿¡</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDlx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//2 æµ‹è¯•æ¶ˆæ¯ä¸ªæ•°è¶…è¿‡é˜Ÿåˆ—é•¿åº¦åï¼Œæ¶ˆæ¯æˆä¸ºæ­»ä¿¡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_dlx&quot;</span>,<span class="string">&quot;test.dlx.wuhu&quot;</span>,<span class="string">&quot;è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œè¶…è¿‡10åçš„æ¶ˆæ¯ä¼šæˆä¸ºæ­»ä¿¡ï¼Œå½“å‰ä¸ºç¬¬ï¼š&quot;</span> + (i + <span class="number">1</span>) + <span class="string">&quot;æ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨ç¨‹åºåï¼Œ æœ‰åæ¡æ¶ˆæ¯ä¼šè¿›å…¥æ­£å¸¸é˜Ÿåˆ—ï¼Œè€Œå‰©ä¸‹çš„åæ¡æ¶ˆæ¯ä¼šè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œç„¶åæ­»ä¿¡é˜Ÿåˆ—ä¸­ä¼šæ‹¥æœ‰11æ¡æ¶ˆæ¯ï¼›</p><p>ç­‰åˆ°é˜Ÿåˆ—è¿‡æœŸåï¼Œæ­£å¸¸é˜Ÿåˆ—ä¸­çš„å‰©ä¸‹åæ¡æ¶ˆæ¯ä¹Ÿå…¨å˜ä¸ºæ­»ä¿¡ï¼Œæ­¤æ—¶æ­»ä¿¡é˜Ÿåˆ—æœ‰21æ¡æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322153049.png" alt="image-20210322153049236"></p><blockquote><p>é˜Ÿåˆ—è¿‡æœŸåï¼Œæ­»ä¿¡é˜Ÿåˆ—æœ‰21æ¡æ¶ˆæ¯</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322153113.png" alt="image-20210322153112939"></p><ol start="3"><li>æ‹’æ”¶æ¶ˆæ¯ä½¿æ¶ˆæ¯æˆä¸ºæ­»ä¿¡</li></ol><blockquote><p>åœ¨æ¶ˆè´¹è€…æ¨¡å—ä¸­ç¼–å†™ä¸€ä¸ª <code>DlxListener</code> ç›‘å¬å™¨ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DlxListener</span> <span class="keyword">implements</span> <span class="title">ChannelAwareMessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//è·å–æ¶ˆæ¯çš„deliveryTag</span></span><br><span class="line">        <span class="keyword">long</span> deliveryTag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">            System.out.println(<span class="string">&quot;æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">            <span class="comment">//2 å¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            System.out.println(<span class="string">&quot;å¤„ç†ä¸šåŠ¡é€»è¾‘...&quot;</span>);</span><br><span class="line">            <span class="comment">//æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸ªå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">3</span>/<span class="number">0</span>;</span><br><span class="line">            channel.basicAck(deliveryTag,<span class="keyword">true</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;ä¿¡æ¯ç­¾æ”¶æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‡ºç°å¼‚å¸¸ï¼Œæ‹’ç»æ¥æ”¶&quot;</span>);</span><br><span class="line">            channel.basicNack(deliveryTag,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ­¤ç›‘å¬å™¨</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">acknowledge</span>=<span class="string">&quot;manual&quot;</span> <span class="attr">prefetch</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ä»¤ç›‘å¬å™¨ç›‘å¬æ­£å¸¸é˜Ÿåˆ— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;dlxListener&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;test_queue_dlx&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨æ¶ˆè´¹è€…ï¼Œç„¶åä½¿ç”¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDlx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;test_exchange_dlx&quot;</span>,<span class="string">&quot;test.dlx.wuhu&quot;</span>,<span class="string">&quot;è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œå®ƒä¼šè¢«æ‹’æ”¶ï¼Œç„¶åè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å‘é€æ¶ˆæ¯åï¼Œæ­»ä¿¡é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æ•°ç›®ä¼šç›´æ¥å˜ä¸º22</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322154348.png" alt="image-20210322154348127"></p><blockquote><p>ideaæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322154408.png" alt="image-20210322154408776"></p><ul><li>ä¸Šè¿°å®Œæ•´ä»£ç å¦‚ä¸‹</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    1. å£°æ˜æ­£å¸¸çš„é˜Ÿåˆ—ï¼ˆtest_queue_dlxï¼‰å’Œäº¤æ¢æœºï¼ˆtest_exchange_dlxï¼‰</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">name</span>=<span class="string">&quot;test_queue_dlx&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test_queue_dlx&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3 æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 3.1 x-dead-letter-exchangeï¼šæ­»ä¿¡äº¤æ¢æœºåç§° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-exchange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;exchange_dlx&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 3.2 x-dead-letter-routing-keyï¼šå‘é€ç»™æ­»ä¿¡äº¤æ¢æœºçš„routing key --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-routing-key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dlx.hehe&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 4.1 è®¾ç½®é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ ttl --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-message-ttl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">value-type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 4.2 è®¾ç½®é˜Ÿåˆ—çš„é•¿åº¦é™åˆ¶ max-length --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-max-length&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> <span class="attr">value-type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:queue</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;test_exchange_dlx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;test.dlx.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;test_queue_dlx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    2. å£°æ˜æ­»ä¿¡é˜Ÿåˆ—ï¼ˆqueue_dlxï¼‰å’Œæ­»ä¿¡äº¤æ¢æœºï¼ˆexchange_dlxï¼‰</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">name</span>=<span class="string">&quot;queue_dlx&quot;</span> <span class="attr">id</span>=<span class="string">&quot;queue_dlx&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;exchange_dlx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;dlx.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;queue_dlx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5ã€å°ç»“-1"><a href="#5ã€å°ç»“-1" class="headerlink" title="5ã€å°ç»“"></a>5ã€å°ç»“</h3><ul><li>æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—å’Œæ™®é€šçš„æ²¡æœ‰åŒºåˆ«</li><li>å½“æ¶ˆæ¯æˆä¸ºæ­»ä¿¡åï¼Œå¦‚æœè¯¥é˜Ÿåˆ—ç»‘å®šäº†æ­»ä¿¡äº¤æ¢æœºï¼Œåˆ™æ¶ˆæ¯ä¼šè¢«æ­»ä¿¡äº¤æ¢æœºé‡æ–°è·¯ç”±åˆ°æ­»ä¿¡é˜Ÿåˆ—</li><li>æ¶ˆæ¯æˆä¸ºæ­»ä¿¡çš„ä¸‰ç§æƒ…å†µï¼š</li></ul><blockquote><ol><li>é˜Ÿåˆ—æ¶ˆæ¯é•¿åº¦åˆ°è¾¾é™åˆ¶ï¼›</li><li>æ¶ˆè´¹è€…æ‹’æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸é‡å›é˜Ÿåˆ—ï¼›</li><li>åŸé˜Ÿåˆ—å­˜åœ¨æ¶ˆæ¯è¿‡æœŸè®¾ç½®ï¼Œæ¶ˆæ¯åˆ°è¾¾è¶…æ—¶æ—¶é—´æœªè¢«æ¶ˆè´¹ï¼›</li></ol></blockquote><h2 id="7-7ã€å»¶è¿Ÿé˜Ÿåˆ—"><a href="#7-7ã€å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="7.7ã€å»¶è¿Ÿé˜Ÿåˆ—"></a>7.7ã€å»¶è¿Ÿé˜Ÿåˆ—</h2><h3 id="1ã€æ¦‚å¿µè¯´æ˜-2"><a href="#1ã€æ¦‚å¿µè¯´æ˜-2" class="headerlink" title="1ã€æ¦‚å¿µè¯´æ˜"></a>1ã€æ¦‚å¿µè¯´æ˜</h3><blockquote><p>å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå³æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åä¸ä¼šç«‹å³è¢«æ¶ˆè´¹ï¼Œ<strong>åªæœ‰åˆ°è¾¾æŒ‡å®šæ—¶é—´åï¼Œæ‰ä¼šè¢«æ¶ˆè´¹ã€‚</strong></p></blockquote><ul><li>éœ€æ±‚ï¼š</li></ul><blockquote><ol><li><p>ä¸‹å•åï¼Œ30åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œå–æ¶ˆè®¢å•ï¼Œå›æ»šåº“å­˜ã€‚</p></li><li><p>æ–°ç”¨æˆ·æ³¨å†ŒæˆåŠŸ7å¤©åï¼Œå‘é€çŸ­ä¿¡é—®å€™ã€‚</p></li></ol></blockquote><ul><li>å®ç°æ–¹å¼ï¼š</li></ul><blockquote><ol><li>å®šæ—¶å™¨ï¼ˆä¸ä¼˜é›…ï¼‰</li><li>å»¶è¿Ÿé˜Ÿåˆ—</li></ol></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322155500.png" alt="image-20210322155500743"></p><blockquote><p>å¾ˆå¯æƒœï¼Œåœ¨<code>RabbitMQ</code>ä¸­å¹¶æœªç›´æ¥æä¾›å»¶è¿Ÿé˜Ÿåˆ—çš„åŠŸèƒ½</p><p>ä¸è¿‡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>TTL</code> + <code>æ­»ä¿¡é˜Ÿåˆ—</code> ç»„åˆçš„æ–¹å¼æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœ</p></blockquote><h3 id="2ã€RabbitMQå®ç°å»¶è¿Ÿé˜Ÿåˆ—"><a href="#2ã€RabbitMQå®ç°å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="2ã€RabbitMQå®ç°å»¶è¿Ÿé˜Ÿåˆ—"></a>2ã€<code>RabbitMQ</code>å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h3><blockquote><p><code>RabbitMQ</code> ä½¿ç”¨ <code>TTL</code> + <code>æ­»ä¿¡é˜Ÿåˆ—</code> ç»„åˆçš„æ–¹å¼æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœ</p><p>è®¢å•ç³»ç»Ÿå‘äº¤æ¢æœºå‘é€ä¸€æ¡å­˜æ´»æ—¶é•¿ä¸º30minçš„æ¶ˆæ¯åï¼Œæ¶ˆæ¯åœ¨æ­£å¸¸é˜Ÿåˆ—ä¸­å­˜æ´»30minï¼Œåœ¨30minåï¼Œæ¶ˆæ¯ä»æ­£å¸¸é˜Ÿåˆ—è·‘åˆ°æ­»ä¿¡äº¤æ¢æœºï¼Œæ­»ä¿¡äº¤æ¢æœºåˆå°†æ¶ˆæ¯å‘é€ç»™æ­»ä¿¡é˜Ÿåˆ—ï¼Œæ­¤æ—¶ï¼Œç»‘å®šæ­»ä¿¡é˜Ÿåˆ—çš„åº“å­˜ç³»ç»Ÿå°±å¯ä»¥åœ¨è®¢å•ç³»ç»Ÿå‘é€æ¶ˆæ¯çš„30minåæ‹¿åˆ°æ¶ˆæ¯ã€‚</p><p>è¿™æ ·å’Œå»¶è¿Ÿé˜Ÿåˆ—çš„æ•ˆæœä¸€è‡´ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322160120.png" alt="image-20210322160120416"></p><blockquote><p>ä»¥ä¸‹æ˜¯å…³äºå»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°</p></blockquote><h3 id="3ã€ä½¿ç”¨-TTL-æ­»ä¿¡é˜Ÿåˆ—-å®ç°å»¶è¿Ÿé˜Ÿåˆ—"><a href="#3ã€ä½¿ç”¨-TTL-æ­»ä¿¡é˜Ÿåˆ—-å®ç°å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="3ã€ä½¿ç”¨ TTL + æ­»ä¿¡é˜Ÿåˆ— å®ç°å»¶è¿Ÿé˜Ÿåˆ—"></a>3ã€ä½¿ç”¨ TTL + æ­»ä¿¡é˜Ÿåˆ— å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h3><ul><li>å®šä¹‰æ­£å¸¸çš„äº¤æ¢æœºï¼ˆorder_exchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆorder_queueï¼‰</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1 å®šä¹‰æ­£å¸¸çš„äº¤æ¢æœºï¼ˆorder_exchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆorder_queueï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;order_queue&quot;</span> <span class="attr">name</span>=<span class="string">&quot;order_queue&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;order_exchange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;order_exchange&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;order.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;order_queue&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰æ­»ä¿¡äº¤æ¢æœºï¼ˆorder_exchange_dlxï¼‰å’Œé˜Ÿåˆ—ï¼ˆorder_queue_dlxï¼‰</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2 å®šä¹‰æ­»ä¿¡äº¤æ¢æœºï¼ˆorder_exchange_dlxï¼‰å’Œé˜Ÿåˆ—ï¼ˆorder_queue_dlxï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;order_queue_dlx&quot;</span> <span class="attr">name</span>=<span class="string">&quot;order_queue_dlx&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;order_exchange_dlx&quot;</span> <span class="attr">id</span>=<span class="string">&quot;order_exchange_dlx&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;dlx.order.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;order_queue_dlx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>ç»‘å®šï¼Œè®¾ç½®æ­£å¸¸é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ä¸º30min</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;order_queue&quot;</span> <span class="attr">name</span>=<span class="string">&quot;order_queue&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3 ç»‘å®šï¼Œè®¾ç½®æ­£å¸¸é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ä¸º30min --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-exchange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;order_exchange_dlx&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-routing-key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dlx.order.cancel&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-message-ttl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">value-type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:queue</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å…¨éƒ¨é…ç½®ä¸ºï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1 å®šä¹‰æ­£å¸¸çš„äº¤æ¢æœºï¼ˆorder_exchangeï¼‰å’Œé˜Ÿåˆ—ï¼ˆorder_queueï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;order_queue&quot;</span> <span class="attr">name</span>=<span class="string">&quot;order_queue&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3 ç»‘å®šï¼Œè®¾ç½®æ­£å¸¸é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ä¸º30min --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-exchange&quot;</span> <span class="attr">value</span>=<span class="string">&quot;order_exchange_dlx&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-dead-letter-routing-key&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dlx.order.cancel&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;x-message-ttl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">value-type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:queue-arguments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:queue</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;order_exchange&quot;</span> <span class="attr">id</span>=<span class="string">&quot;order_exchange&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;order.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;order_queue&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2 å®šä¹‰æ­»ä¿¡äº¤æ¢æœºï¼ˆorder_exchange_dlxï¼‰å’Œé˜Ÿåˆ—ï¼ˆorder_queue_dlxï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:queue</span> <span class="attr">id</span>=<span class="string">&quot;order_queue_dlx&quot;</span> <span class="attr">name</span>=<span class="string">&quot;order_queue_dlx&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rabbit:topic-exchange</span> <span class="attr">name</span>=<span class="string">&quot;order_exchange_dlx&quot;</span> <span class="attr">id</span>=<span class="string">&quot;order_exchange_dlx&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rabbit:binding</span> <span class="attr">pattern</span>=<span class="string">&quot;dlx.order.#&quot;</span> <span class="attr">queue</span>=<span class="string">&quot;order_queue_dlx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rabbit:bindings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:topic-exchange</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ç”Ÿäº§è€…ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelay</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//1 è®¢å•ç³»ç»Ÿåœ¨ä¸‹å•å®Œæˆåï¼Œå‘é€æ¶ˆæ¯</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;order_exchange&quot;</span>,<span class="string">&quot;order.msg&quot;</span>,<span class="string">&quot;è®¢å•ä¿¡æ¯ï¼šid = 1,time = 16ç‚¹26åˆ†&quot;</span>);</span><br><span class="line">    <span class="comment">//2 æ‰“å°ä¸€ä¸ªå€’è®¡æ—¶</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        System.out.println(i + <span class="string">&quot;...&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ¶ˆè´¹è€…æ¨¡å—ç¼–å†™ä¸€ä¸ªOrderListenerç›‘å¬å™¨ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderListener</span> <span class="keyword">implements</span> <span class="title">ChannelAwareMessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//è·å–æ¶ˆæ¯çš„deliveryTag</span></span><br><span class="line">        <span class="keyword">long</span> deliveryTag = message.getMessageProperties().getDeliveryTag();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">            System.out.println(<span class="string">&quot;å¤„ç†ä¸šåŠ¡é€»è¾‘...&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ ¹æ®è®¢å•idæŸ¥è¯¢å…¶çŠ¶æ€...&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;åˆ¤æ–­çŠ¶æ€æ˜¯å¦ä¸ºå·²æ”¯ä»˜...&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;å–æ¶ˆè®¢å•ï¼Œå›æ»šåº“å­˜...&quot;</span>);</span><br><span class="line">            channel.basicAck(deliveryTag,<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            channel.basicNack(deliveryTag,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½® <code>OrderListener</code> ç›‘å¬å™¨ï¼Œæ³¨æ„è¿™é‡Œå¿…é¡»ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¦‚æœç›‘å¬æ­£å¸¸é˜Ÿåˆ—çš„è¯ï¼Œé‚£ä¹ˆè®¢å•ç³»ç»Ÿä¸€å‘å‡ºæ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…å°±æ¥æ”¶åˆ°äº†</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rabbit:listener-container</span> <span class="attr">connection-factory</span>=<span class="string">&quot;connectionFactory&quot;</span> <span class="attr">acknowledge</span>=<span class="string">&quot;manual&quot;</span> <span class="attr">prefetch</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rabbit:listener</span> <span class="attr">ref</span>=<span class="string">&quot;orderListener&quot;</span> <span class="attr">queue-names</span>=<span class="string">&quot;order_queue_dlx&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rabbit:listener-container</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨æ¶ˆè´¹è€…ï¼Œç„¶åå¯åŠ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯</li></ul><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç”Ÿäº§è€…å‘é€å®Œæ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…æ— æ³•ç›´æ¥çœ‹åˆ°æ¶ˆæ¯ï¼Œåªæœ‰åœ¨ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„åç§’åï¼Œæ¶ˆè´¹è€…æ‰èƒ½æ”¶åˆ°æ¶ˆæ¯ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322164336.png" alt="image-20210322164335674"></p><h3 id="4ã€å°ç»“"><a href="#4ã€å°ç»“" class="headerlink" title="4ã€å°ç»“"></a>4ã€å°ç»“</h3><ul><li>å»¶è¿Ÿé˜Ÿåˆ— æŒ‡æ¶ˆæ¯è¿›å…¥é˜Ÿåˆ—åï¼Œå¯ä»¥è¢«å»¶è¿Ÿä¸€å®šæ—¶é—´ï¼Œå†è¿›è¡Œæ¶ˆè´¹ã€‚</li><li>RabbitMQæ²¡æœ‰æä¾›å»¶è¿Ÿé˜Ÿåˆ—åŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ ï¼š TTL + æ­»ä¿¡é˜Ÿåˆ— æ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—æ•ˆæœã€‚</li></ul><h2 id="7-8ã€æ—¥å¿—ä¸ç›‘æ§"><a href="#7-8ã€æ—¥å¿—ä¸ç›‘æ§" class="headerlink" title="7.8ã€æ—¥å¿—ä¸ç›‘æ§"></a>7.8ã€æ—¥å¿—ä¸ç›‘æ§</h2><h3 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h3><blockquote><p>RabbitMQé»˜è®¤æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼š /var/log/rabbitmq/rabbit@xxx.log<br>æ—¥å¿—åŒ…å«äº†RabbitMQçš„ç‰ˆæœ¬å·ã€Erlangçš„ç‰ˆæœ¬å·ã€RabbitMQæœåŠ¡èŠ‚ç‚¹åç§°ã€cookieçš„hashå€¼ã€RabbitMQé…ç½®æ–‡ä»¶åœ°å€ã€å†…å­˜é™åˆ¶ã€ç£ç›˜é™åˆ¶ã€é»˜è®¤è´¦æˆ·guestçš„åˆ›å»ºä»¥åŠæƒé™é…ç½®ç­‰ç­‰ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322164632.png" alt="image-20210322164632418"></p><h3 id="2ã€å¸¸ç”¨å‘½ä»¤"><a href="#2ã€å¸¸ç”¨å‘½ä»¤" class="headerlink" title="2ã€å¸¸ç”¨å‘½ä»¤"></a>2ã€å¸¸ç”¨å‘½ä»¤</h3><ul><li>æŸ¥çœ‹é˜Ÿåˆ—</li></ul><blockquote><p><code>rabbitmqctl</code> list_queues</p></blockquote><ul><li>æŸ¥çœ‹exchanges</li></ul><blockquote><p><code>rabbitmqctl</code> list_exchanges</p></blockquote><ul><li>æŸ¥çœ‹ç”¨æˆ·</li></ul><blockquote><p><code>rabbitmqctl</code> list_users</p></blockquote><ul><li>æŸ¥çœ‹è¿æ¥</li></ul><blockquote><p><code>rabbitmqctl</code> list_connections</p></blockquote><ul><li>æŸ¥çœ‹æ¶ˆè´¹è€…ä¿¡æ¯</li></ul><blockquote><p><code>rabbitmqctl</code> list_consumers</p></blockquote><ul><li>æŸ¥çœ‹ç¯å¢ƒå˜é‡</li></ul><blockquote><p><code>rabbitmqctl</code> environment</p></blockquote><ul><li>æŸ¥çœ‹æœªè¢«ç¡®è®¤çš„é˜Ÿåˆ—</li></ul><blockquote><p><code>rabbitmqctl</code> list_queues  name messages_unacknowledged</p></blockquote><ul><li>æŸ¥çœ‹å•ä¸ªé˜Ÿåˆ—çš„å†…å­˜ä½¿ç”¨</li></ul><blockquote><p><code>rabbitmqctl</code> list_queues name memory</p></blockquote><ul><li>æŸ¥çœ‹å‡†å¤‡å°±ç»ªçš„é˜Ÿåˆ—</li></ul><blockquote><p><code>rabbitmqctl</code> list_queues name messages_ready</p></blockquote><h2 id="7-9ã€æ¶ˆæ¯è¿½è¸ª"><a href="#7-9ã€æ¶ˆæ¯è¿½è¸ª" class="headerlink" title="7.9ã€æ¶ˆæ¯è¿½è¸ª"></a>7.9ã€æ¶ˆæ¯è¿½è¸ª</h2><h3 id="1ã€æ¦‚å¿µè¯´æ˜-3"><a href="#1ã€æ¦‚å¿µè¯´æ˜-3" class="headerlink" title="1ã€æ¦‚å¿µè¯´æ˜"></a>1ã€æ¦‚å¿µè¯´æ˜</h3><blockquote><p>åœ¨ä½¿ç”¨ä»»ä½•æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šå‡ºç°æŸæ¡æ¶ˆæ¯å¼‚å¸¸ä¸¢å¤±çš„æƒ…å†µã€‚å¯¹äºRabbitMQè€Œè¨€ï¼Œå¯èƒ½æ˜¯å› ä¸ºç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ä¸RabbitMQæ–­å¼€äº†è¿æ¥ï¼Œè€Œå®ƒä»¬ä¸RabbitMQåˆé‡‡ç”¨äº†ä¸åŒçš„ç¡®è®¤æœºåˆ¶ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å› ä¸ºäº¤æ¢å™¨ä¸é˜Ÿåˆ—ä¹‹é—´ä¸åŒçš„è½¬å‘ç­–ç•¥ï¼›ç”šè‡³æ˜¯äº¤æ¢å™¨å¹¶æ²¡æœ‰ä¸ä»»ä½•é˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œç”Ÿäº§è€…åˆä¸æ„ŸçŸ¥æˆ–è€…æ²¡æœ‰é‡‡å–ç›¸åº”çš„æªæ–½ï¼›å¦å¤–RabbitMQæœ¬èº«çš„é›†ç¾¤ç­–ç•¥ä¹Ÿå¯èƒ½å¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªè¾ƒå¥½çš„æœºåˆ¶è·Ÿè¸ªè®°å½•æ¶ˆæ¯çš„æŠ•é€’è¿‡ç¨‹ï¼Œä»¥æ­¤ååŠ©å¼€å‘å’Œè¿ç»´äººå‘˜è¿›è¡Œé—®é¢˜çš„å®šä½ã€‚</p><p>åœ¨RabbitMQä¸­å¯ä»¥ä½¿ç”¨Firehoseå’Œ<code>rabbitmq_tracing</code>æ’ä»¶åŠŸèƒ½æ¥å®ç°æ¶ˆæ¯è¿½è¸ªã€‚</p></blockquote><h3 id="2ã€æ¶ˆæ¯è¿½è¸ª-Firehose"><a href="#2ã€æ¶ˆæ¯è¿½è¸ª-Firehose" class="headerlink" title="2ã€æ¶ˆæ¯è¿½è¸ª-Firehose"></a>2ã€æ¶ˆæ¯è¿½è¸ª-Firehose</h3><blockquote><p>firehoseçš„æœºåˆ¶æ˜¯å°†ç”Ÿäº§è€…æŠ•é€’ç»™<code>rabbitmq</code>çš„æ¶ˆæ¯ï¼Œ<code>rabbitmq</code>æŠ•é€’ç»™æ¶ˆè´¹è€…çš„æ¶ˆæ¯æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼å‘é€åˆ°é»˜è®¤çš„exchangeä¸Šã€‚è¿™ä¸ªé»˜è®¤çš„exchangeçš„åç§°ä¸º<code>amq.rabbitmq.trace</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªtopicç±»å‹çš„exchangeã€‚å‘é€åˆ°è¿™ä¸ªexchangeä¸Šçš„æ¶ˆæ¯çš„routing keyä¸º <code>publish.exchangename</code> å’Œ <code>deliver.queuename</code>ã€‚å…¶ä¸­<code>exchangename</code>å’Œ<code>queuename</code>ä¸ºå®é™…exchangeå’Œqueueçš„åç§°ï¼Œåˆ†åˆ«å¯¹åº”ç”Ÿäº§è€…æŠ•é€’åˆ°exchangeçš„æ¶ˆæ¯ï¼Œå’Œæ¶ˆè´¹è€…ä»queueä¸Šè·å–çš„æ¶ˆæ¯ã€‚</p><p>æ³¨æ„ï¼šæ‰“å¼€ trace ä¼šå½±å“æ¶ˆæ¯å†™å…¥åŠŸèƒ½ï¼Œé€‚å½“æ‰“å¼€åè¯·å…³é—­ã€‚</p><ol><li><code>rabbitmqctl trace_on</code>ï¼šå¼€å¯Firehoseå‘½ä»¤</li><li><code>rabbitmqctl trace_off</code>ï¼šå…³é—­Firehoseå‘½ä»¤</li></ol></blockquote><h3 id="3ã€æ¶ˆæ¯è¿½è¸ª-rabbitmq-tracing"><a href="#3ã€æ¶ˆæ¯è¿½è¸ª-rabbitmq-tracing" class="headerlink" title="3ã€æ¶ˆæ¯è¿½è¸ª-rabbitmq_tracing"></a>3ã€æ¶ˆæ¯è¿½è¸ª-<code>rabbitmq_tracing</code></h3><blockquote><p>rabbitmq_tracingå’ŒFirehoseåœ¨å®ç°ä¸Šå¦‚å‡ºä¸€è¾™ï¼Œåªä¸è¿‡rabbitmq_tracingçš„æ–¹å¼æ¯”Firehoseå¤šäº†ä¸€å±‚GUIçš„åŒ…è£…ï¼Œæ›´å®¹æ˜“ä½¿ç”¨å’Œç®¡ç†ã€‚</p><p>å¯ç”¨æ’ä»¶ï¼š<code>rabbitmq-plugins enable rabbitmq_tracing</code></p></blockquote><h1 id="å…«ã€RabbitMQ-åº”ç”¨é—®é¢˜"><a href="#å…«ã€RabbitMQ-åº”ç”¨é—®é¢˜" class="headerlink" title="å…«ã€RabbitMQ åº”ç”¨é—®é¢˜"></a>å…«ã€RabbitMQ åº”ç”¨é—®é¢˜</h1><h2 id="8-1ã€æ¶ˆæ¯å¯é æ€§ä¿éšœâ€“æ¶ˆæ¯è¡¥å¿æœºåˆ¶"><a href="#8-1ã€æ¶ˆæ¯å¯é æ€§ä¿éšœâ€“æ¶ˆæ¯è¡¥å¿æœºåˆ¶" class="headerlink" title="8.1ã€æ¶ˆæ¯å¯é æ€§ä¿éšœâ€“æ¶ˆæ¯è¡¥å¿æœºåˆ¶"></a>8.1ã€æ¶ˆæ¯å¯é æ€§ä¿éšœâ€“æ¶ˆæ¯è¡¥å¿æœºåˆ¶</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322185934.png" alt="image-20210322185933727"></p><h2 id="8-2ã€æ¶ˆæ¯å¹‚ç­‰æ€§ä¿éšœ"><a href="#8-2ã€æ¶ˆæ¯å¹‚ç­‰æ€§ä¿éšœ" class="headerlink" title="8.2ã€æ¶ˆæ¯å¹‚ç­‰æ€§ä¿éšœ"></a>8.2ã€æ¶ˆæ¯å¹‚ç­‰æ€§ä¿éšœ</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§"><a href="#1ã€ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§"></a>1ã€ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§</h3><blockquote><p>å¹‚ç­‰æ€§æŒ‡ä¸€æ¬¡å’Œå¤šæ¬¡è¯·æ±‚æŸä¸€ä¸ªèµ„æºï¼Œå¯¹äºèµ„æºæœ¬èº«åº”è¯¥å…·æœ‰åŒæ ·çš„ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œå¯¹èµ„æºæœ¬èº«æ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚</p><p>åœ¨MQä¸­æŒ‡ï¼Œæ¶ˆè´¹å¤šæ¡ç›¸åŒçš„æ¶ˆæ¯ï¼Œå¾—åˆ°ä¸æ¶ˆè´¹è¯¥æ¶ˆæ¯ä¸€æ¬¡ç›¸åŒçš„ç»“æœã€‚</p></blockquote><h3 id="2ã€å®ç°â€“ä¹è§‚é”æœºåˆ¶"><a href="#2ã€å®ç°â€“ä¹è§‚é”æœºåˆ¶" class="headerlink" title="2ã€å®ç°â€“ä¹è§‚é”æœºåˆ¶"></a>2ã€å®ç°â€“ä¹è§‚é”æœºåˆ¶</h3><blockquote><p>æ¯”å¦‚è¯´ç”¨æˆ·å‘äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„versionéƒ½æ˜¯ä¸€ï¼Œä¸”æ­¤æ—¶æ•°æ®åº“çš„è®°å½•çš„versionä¹Ÿä¸º1ï¼›</p><p>å½“æ•°æ®æ¶ˆè´¹å®Œä¸€æ¡æ¶ˆæ¯åï¼Œå°†æ•°æ®åº“çš„è®°å½•çš„versionæ”¹ä¸º2ï¼Œæ­¤æ—¶æ”¶åˆ°ç¬¬äºŒæ¡æ¶ˆæ¯ï¼Œç”±äºæ­¤æ—¶æ•°æ®åº“è®°å½•çš„versionä¸º2ï¼Œä¸æ¶ˆæ¯çš„versionä¸å’Œï¼Œæ‰€ä»¥ä¸ä¼šç¬¬äºŒæ¡æ¶ˆæ¯ä¸ä¼šèµ·å®è´¨æ€§ä½œç”¨ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210322191006.png" alt="image-20210322191006079"></p>]]></content>
      
      
      <categories>
          
          <category> æ¡†æ¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ“«æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåº”ç”¨å­¦ä¹ ï¼ˆäº”ï¼‰-RabbitMQå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰</title>
      <link href="posts/1158970579.html"/>
      <url>posts/1158970579.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€MQåŸºæœ¬æ¦‚å¿µ"><a href="#ä¸€ã€MQåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¸€ã€MQåŸºæœ¬æ¦‚å¿µ"></a>ä¸€ã€MQåŸºæœ¬æ¦‚å¿µ</h1><h2 id="1-1ã€MQæ¦‚è¿°"><a href="#1-1ã€MQæ¦‚è¿°" class="headerlink" title="1.1ã€MQæ¦‚è¿°"></a>1.1ã€MQæ¦‚è¿°</h2><blockquote><p><code>MQå…¨ç§° Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</code>ï¼Œæ˜¯åœ¨æ¶ˆæ¯çš„ä¼ è¾“è¿‡ç¨‹ä¸­ä¿å­˜æ¶ˆæ¯çš„å®¹å™¨ã€‚<code>å¤š</code>ç”¨äº<code>åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚</code></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314160621.png" alt="image-20210314160621807"></p><blockquote><p>ä½¿ç”¨MQä¸­é—´ä»¶</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314160641.png" alt="image-20210314160641024"></p><blockquote><p>å°ç»“</p></blockquote><ul><li>MQå³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ˜¯ç”¨äºå­˜å‚¨æ¶ˆæ¯çš„ä¸­é—´ä»¶ã€‚</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿé€šä¿¡ä¸¤ç§æ–¹å¼ï¼šç›´æ¥è¿œç¨‹è°ƒç”¨ å’Œ å€ŸåŠ©ç¬¬ä¸‰æ–¹å®Œæˆé—´æ¥é€šä¿¡</li><li>å‘é€æ–¹ç§°ä¸º<strong>ç”Ÿäº§è€…</strong>ï¼Œæ¥æ”¶æ–¹ç§°ä¸º<strong>æ¶ˆè´¹è€…</strong>ã€‚</li></ul><h2 id="1-2ã€MQ-çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿"><a href="#1-2ã€MQ-çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿" class="headerlink" title="1.2ã€MQ çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿"></a>1.2ã€MQ çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿</h2><h3 id="1ã€ä¼˜åŠ¿"><a href="#1ã€ä¼˜åŠ¿" class="headerlink" title="1ã€ä¼˜åŠ¿"></a>1ã€ä¼˜åŠ¿</h3><ul><li>åº”ç”¨è§£è€¦</li><li>å¼‚æ­¥æé€Ÿ</li><li>å‰Šå³°å¡«è°·</li></ul><h3 id="2ã€åŠ£åŠ¿"><a href="#2ã€åŠ£åŠ¿" class="headerlink" title="2ã€åŠ£åŠ¿"></a>2ã€åŠ£åŠ¿</h3><ul><li>ç³»ç»Ÿå¯ç”¨æ€§é™ä½</li><li>ç³»ç»Ÿå¤æ‚åº¦æé«˜</li><li>ä¸€è‡´æ€§é—®é¢˜</li></ul><h3 id="3ã€MQä¼˜åŠ¿ä¹‹åº”ç”¨è§£è€¦"><a href="#3ã€MQä¼˜åŠ¿ä¹‹åº”ç”¨è§£è€¦" class="headerlink" title="3ã€MQä¼˜åŠ¿ä¹‹åº”ç”¨è§£è€¦"></a>3ã€MQä¼˜åŠ¿ä¹‹åº”ç”¨è§£è€¦</h3><blockquote><p><strong>ç³»ç»Ÿçš„è€¦åˆæ€§è¶Šé«˜ï¼Œå®¹é”™æ€§å°±è¶Šä½ï¼Œå¯ç»´æŠ¤æ€§å°±è¶Šä½ã€‚</strong></p></blockquote><ul><li>ä»¥ä¸‹è®¢å•ä¸ºä¾‹ï¼Œåœ¨æ²¡æœ‰å¼•å…¥MQä¹‹å‰ï¼Œè®¢å•ç³»ç»Ÿä¸åº“å­˜ç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿè€¦åˆåœ¨ä¸€èµ·ã€‚</li></ul><blockquote><p>å¦‚æœä¸è®¢å•ç³»ç»Ÿå…³è”çš„æŸä¸ªç³»ç»Ÿï¼ˆæ¯”å¦‚è¯´åº“å­˜ç³»ç»Ÿï¼‰æŒ‚äº†ï¼Œé‚£ä¹ˆå¯èƒ½å¯¼è‡´è®¢å•ç³»ç»Ÿä¹Ÿè·Ÿç€æŒ‚äº†ï¼Œæ­¤æ—¶<strong>ç³»ç»Ÿçš„å®¹é”™ä½ã€‚</strong></p><p>å¦‚æœè¦æ–°å¢ä¸€ä¸ªä¸è®¢å•ç³»ç»Ÿç›¸å…³è”çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆæ­¤æ—¶åªèƒ½ä¿®æ”¹è®¢å•ç³»ç»Ÿçš„ä»£ç ï¼Œæ­¤æ—¶<strong>ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ä½ã€‚</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314162029.png" alt="image-20210314162029231"></p><ul><li>åœ¨å¼•å…¥MQä¸­é—´ä»¶åï¼Œä¸Šé¢çš„æµç¨‹å›¾çš„å˜åŒ–å¦‚ä¸‹å›¾æ‰€ç¤º</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314162544.png" alt="image-20210314162544295"></p><blockquote><p>åœ¨å¼•å…¥MQåï¼Œè®¢å•ç³»ç»Ÿåªéœ€è¦å‘ä¸€æ¡æ¶ˆæ¯ç»™MQï¼Œç„¶åè®©æ¶ˆè´¹è€…ï¼ˆåº“å­˜ã€æ”¯ä»˜ã€ç‰©æµã€Xç³»ç»Ÿï¼‰ä»MQä¸­æ‹¿å‡ºæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å³å¯ï¼Œ<strong>ä½¿ç”¨MQä½¿å¾—åº”ç”¨é—´è§£è€¦ï¼Œæç¤ºå®¹é”™æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</strong></p><p>å¦‚æœæ­¤æ—¶åº“å­˜ç³»ç»ŸæŒ‚äº†ï¼Œé‚£ä¹ˆè®¢å•ç³»ç»Ÿå°†ä¸ä¼šå—åˆ°å½±å“ï¼Œå› ä¸ºåº“å­˜ç³»ç»Ÿå’Œè®¢å•ç³»ç»Ÿä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚</p><p>å¦‚æœæ­¤æ—¶éœ€è¦æ·»åŠ ä¸€ä¸ªXç³»ç»Ÿï¼Œé‚£ä¹ˆåªéœ€è¦è®©Xç³»ç»Ÿä»MQä¸­æ‹¿å‡ºæ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹å³å¯ï¼Œæ­¤æ—¶ä¸éœ€è¦ä¿®æ”¹è®¢å•ç³»ç»Ÿä»£ç ï¼Œæå‡äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p></blockquote><h3 id="4ã€MQä¼˜åŠ¿ä¹‹å¼‚æ­¥æé€Ÿ"><a href="#4ã€MQä¼˜åŠ¿ä¹‹å¼‚æ­¥æé€Ÿ" class="headerlink" title="4ã€MQä¼˜åŠ¿ä¹‹å¼‚æ­¥æé€Ÿ"></a>4ã€MQä¼˜åŠ¿ä¹‹å¼‚æ­¥æé€Ÿ</h3><blockquote><p>å¦‚æœåº”ç”¨æµç¨‹ä¸­è®¢å•ç³»ç»Ÿè¿œç¨‹è°ƒç”¨å…¶ä»–ç³»ç»Ÿçš„æ—¶é—´å‡ä¸º300msï¼Œè®¿é—®æ•°æ®åº“çš„æ—¶é—´ä¸º20msï¼Œç”±äºè®¢å•ç³»ç»Ÿè°ƒç”¨å…¶ä»–ç³»ç»Ÿçš„è¡Œä¸ºæ˜¯åŒæ­¥çš„ï¼ˆéœ€è¦è°ƒå®ŒAå†è°ƒç”¨Bï¼‰ï¼Œæ‰€ä»¥ä¸€ä¸ªä¸‹å•æ“ä½œæ€»å…±è€—è´¹çš„æ—¶é—´ä¸º <code>920ms</code>ï¼Œé€Ÿåº¦å¤ªæ…¢ã€‚ </p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314163256.png" alt="image-20210314163256067"></p><blockquote><p>å¼•å…¥MQåï¼Œè®¢å•ç³»ç»Ÿåªéœ€è¦å°†æ¶ˆæ¯æ”¾å…¥MQï¼Œç„¶åæ“ä½œè‡ªå·±çš„æ•°æ®åº“ä¹‹åå³å¯ç»™ç”¨æˆ·è¿”å› <code>ä¸‹å•æˆåŠŸ</code> çš„æç¤ºï¼Œå¹¶ä¸éœ€è¦ç­‰å…¶ä»–ç³»ç»Ÿæ¶ˆè´¹å®Œä»MQæ‹¿å‡ºçš„æ¶ˆæ¯ã€‚</p><p>æ­¤æ—¶ä¸‹å•æ“ä½œæ‰€è€—è´¹çš„æ—¶é—´ä¸ºï¼š<code>25ms</code>ï¼ˆå†™æ•°æ®åº“èŠ±è´¹20msï¼Œå‘é€æ¶ˆæ¯èŠ±è´¹5msï¼‰</p><p>æå‡<strong>ç”¨æˆ·ä½“éªŒ</strong>å’Œ<strong>ç³»ç»Ÿååé‡ï¼ˆå•ä½æ—¶é—´å†…å¤„ç†è¯·æ±‚çš„æ•°ç›®ï¼‰</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314163652.png" alt="image-20210314163652543"></p><h3 id="5ã€MQä¼˜åŠ¿ä¹‹å‰Šå³°å¡«è°·"><a href="#5ã€MQä¼˜åŠ¿ä¹‹å‰Šå³°å¡«è°·" class="headerlink" title="5ã€MQä¼˜åŠ¿ä¹‹å‰Šå³°å¡«è°·"></a>5ã€MQä¼˜åŠ¿ä¹‹å‰Šå³°å¡«è°·</h3><p><code>ä½¿ç”¨MQåï¼Œå¯ä»¥æé«˜ç³»ç»Ÿç¨³å®šæ€§ã€‚</code></p><blockquote><p>å¦‚æœä¸€ä¸ªAç³»ç»Ÿä¸€ç§’é’Ÿæœ€å¤šå¤„ç†1000ä¸ªè¯·æ±‚ï¼Œå¦‚æœæ­¤æ—¶è¯·æ±‚é‡æš´å¢è‡³1ç§’5000ä¸ªï¼Œé‚£ä¹ˆAç³»ç»Ÿå¯èƒ½ç›´æ¥å®•æœºï¼Œæ•´ä¸ªç³»ç»Ÿå¯èƒ½ç›´æ¥ç˜«ç—ªï¼Œç”¨æˆ·ä½“éªŒé™ä½ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314164223.png" alt="image-20210314164223206"></p><blockquote><p>åœ¨å¼•å…¥MQåï¼Œå³ä½¿è¯·æ±‚é‡çœŸçš„ä»1ç§’1000ä¸ªç¬é—´æš´å¢è‡³1ç§’5000ä¸ªï¼Œç”±äºæ­¤æ—¶ç›´æ¥ä¸ç”¨æˆ·å¯¹æ¥çš„ä¸æ˜¯Aç³»ç»Ÿï¼Œè€Œæ˜¯MQé¦–å½“å…¶å†²ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬ä»¤Aç³»ç»Ÿæ¯ç§’æœ€å¤šä»MQä¸­æ‹‰å–1000ä¸ªè¯·æ±‚ï¼Œæ¥ä¿è¯Aç³»ç»Ÿä¸ä¼šå®•æœºã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314164343.png" alt="image-20210314164343109"></p><ul><li>å‰Šå³°</li></ul><blockquote><p>åœ¨è¯·æ±‚é‡æš´å¢çš„æƒ…å†µä¸‹ï¼ŒMQå¯ä»¥é™åˆ¶æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå°†é«˜å³°æœŸäº§ç”Ÿçš„æµé‡å †ç§¯åœ¨MQä¸­ï¼Œè¿™æ ·ä»¥æ¥ï¼Œé«˜å³°å°±è¢«å‰Šæ‰äº†</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314164853.png" alt="image-20210314164853758"></p><ul><li>å¡«è°·</li></ul><blockquote><p>ç”±äºåœ¨â€œå‰Šå³°â€è¿‡ç¨‹ä¸­ï¼Œå¤§é‡æ¶ˆæ¯å †ç§¯åœ¨MQä¸­ï¼Œæ‰€ä»¥åœ¨é«˜å³°æœŸè¿‡åï¼Œæ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦è¿˜æ˜¯ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…ç»´æŒé«˜æ°´å¹³ï¼ˆåœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ä¸º1000ï¼‰ï¼Œç›´åˆ°æ¶ˆè´¹å®Œç§¯å‹å¾—æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯å¡«è°·ã€‚</p></blockquote><ul><li>å‰Šå³°å¡«è°·ç¤ºæ„å›¾</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314165114.png" alt="image-20210314165114086"></p><h3 id="6ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¯ç”¨æ€§é™ä½"><a href="#6ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¯ç”¨æ€§é™ä½" class="headerlink" title="6ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¯ç”¨æ€§é™ä½"></a>6ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¯ç”¨æ€§é™ä½</h3><blockquote><p>åœ¨å¼•å…¥MQå‰ï¼Œåªéœ€è¦ä¿è¯ç»„æˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„å„ä¸ªç³»ç»Ÿæ²¡æœ‰é—®é¢˜ï¼Œåœ¨å¼•å…¥MQåè¿˜éœ€è¦ä¿è¯MQæ²¡æœ‰é—®é¢˜ã€‚</p><p>ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ã€‚ä¸€æ—¦ <code>MQ</code> <strong>å®•æœº</strong>ï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚</p><p>å¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨æ˜¯æˆ‘ä»¬å¼•å…¥MQåå¿…é¡»æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜ã€‚</p></blockquote><h3 id="7ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¤æ‚åº¦æé«˜"><a href="#7ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¤æ‚åº¦æé«˜" class="headerlink" title="7ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¤æ‚åº¦æé«˜"></a>7ã€MQåŠ£åŠ¿ä¹‹ç³»ç»Ÿå¤æ‚åº¦æé«˜</h3><blockquote><p>åœ¨å¼•å…¥MQåï¼Œç³»ç»Ÿçš„å¤æ‚æ€§æé«˜ï¼Œæˆ‘ä»¬è¦è€ƒè™‘ä»¥ä¸‹é—®é¢˜</p></blockquote><ul><li>ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ä¼šä¸ä¼šè¢«æ¶ˆè´¹è€…é‡å¤æ¶ˆè´¹ï¼Ÿ</li><li>å¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Ÿ</li><li>å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿ</li></ul><h3 id="8ã€MQåŠ£åŠ¿ä¹‹ä¸€è‡´æ€§é—®é¢˜"><a href="#8ã€MQåŠ£åŠ¿ä¹‹ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="8ã€MQåŠ£åŠ¿ä¹‹ä¸€è‡´æ€§é—®é¢˜"></a>8ã€MQåŠ£åŠ¿ä¹‹ä¸€è‡´æ€§é—®é¢˜</h3><blockquote><p>A ç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡ MQ ç»™Bã€Cã€Dä¸‰ä¸ªç³»ç»Ÿå‘æ¶ˆæ¯æ•°æ®ï¼Œå¦‚æœ B ç³»ç»Ÿã€C ç³»ç»Ÿå¤„ç†æˆåŠŸï¼ŒD ç³»ç»Ÿå¤„ç†å¤±è´¥ã€‚å¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§ï¼Ÿ</p></blockquote><h2 id="1-3ã€ä½¿ç”¨MQåº”è¯¥æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ"><a href="#1-3ã€ä½¿ç”¨MQåº”è¯¥æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ" class="headerlink" title="1.3ã€ä½¿ç”¨MQåº”è¯¥æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ"></a>1.3ã€ä½¿ç”¨MQåº”è¯¥æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ</h2><ul><li>ç”Ÿäº§è€…ä¸éœ€è¦ä»æ¶ˆè´¹è€…å¤„è·å¾—åé¦ˆã€‚</li></ul><blockquote><p>å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å‰çš„è¿œç¨‹è°ƒç”¨ï¼Œå…¶æ¥å£çš„è¿”å›å€¼åº”è¯¥ä¸ºç©ºï¼Œè¿™æ‰è®©æ˜æ˜ä¸‹å±‚çš„åŠ¨ä½œè¿˜æ²¡åšå®Œï¼Œä¸Šå±‚å´å½“åŠ¨ä½œåšå®Œäº†ç»§ç»­å¾€åèµ°ï¼Œå³æ‰€è°“ <strong>å¼‚æ­¥</strong> æˆä¸ºäº†å¯èƒ½ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœAè°ƒç”¨å®ŒBåéœ€è¦æ‹¿ç€Bçš„è¿”å›ç»“æœä½œä¸ºå‚æ•°å†å»è°ƒç”¨Cï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å¼•å…¥MQæ— æ³•å®ç°å¼‚æ­¥è°ƒç”¨ã€‚</p></blockquote><ul><li>å®¹è®¸çŸ­æš‚çš„ä¸ä¸€è‡´æ€§ã€‚</li><li>ç¡®å®æ˜¯ç”¨äº†æœ‰æ•ˆæœã€‚</li></ul><blockquote><p>å³è§£è€¦ã€æé€Ÿã€å‰Šå³°è¿™äº›æ–¹é¢çš„æ”¶ç›Šï¼Œè¶…è¿‡åŠ å…¥MQï¼Œç®¡ç†MQè¿™äº›æˆæœ¬ã€‚</p></blockquote><h2 id="1-4ã€å¸¸è§çš„MQäº§å“"><a href="#1-4ã€å¸¸è§çš„MQäº§å“" class="headerlink" title="1.4ã€å¸¸è§çš„MQäº§å“"></a>1.4ã€å¸¸è§çš„MQäº§å“</h2><blockquote><p>ç›®å‰ä¸šç•Œæœ‰å¾ˆå¤šçš„ MQ äº§å“ï¼Œä¾‹å¦‚ <code>RabbitMQ</code>ã€<code>RocketMQ</code>ã€<code>ActiveMQã€Kafka</code>ã€<code>ZeroMQ</code>ã€<code>MetaMQ</code>ç­‰ï¼Œä¹Ÿæœ‰ç›´æ¥ä½¿ç”¨ <code>Redis</code> å……å½“æ¶ˆæ¯é˜Ÿåˆ—çš„æ¡ˆä¾‹ï¼Œè€Œè¿™äº›æ¶ˆæ¯é˜Ÿåˆ—äº§å“ï¼Œå„æœ‰ä¾§é‡ï¼Œåœ¨å®é™…é€‰å‹æ—¶ï¼Œéœ€è¦ç»“åˆè‡ªèº«éœ€æ±‚åŠ MQ äº§å“ç‰¹å¾ï¼Œç»¼åˆè€ƒè™‘ã€‚</p></blockquote><ul><li>å¸¸è§çš„MQäº§å“å¯¹æ¯”</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314171819.png" alt="image-20210314171817994"></p><h1 id="äºŒã€RabbitMQ"><a href="#äºŒã€RabbitMQ" class="headerlink" title="äºŒã€RabbitMQ"></a>äºŒã€RabbitMQ</h1><h2 id="2-1ã€AMQP"><a href="#2-1ã€AMQP" class="headerlink" title="2.1ã€AMQP"></a>2.1ã€AMQP</h2><blockquote><p><code>AMQPï¼Œå³ Advanced Message Queuing Protocolï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰</code>ï¼Œæ˜¯ä¸€ä¸ª<strong>ç½‘ç»œåè®®</strong>ï¼Œæ˜¯<code>åº”ç”¨å±‚åè®®</code>çš„ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶è®¾è®¡ã€‚åŸºäºæ­¤åè®®çš„å®¢æˆ·ç«¯ä¸æ¶ˆæ¯ä¸­é—´ä»¶å¯ä¼ é€’æ¶ˆæ¯ï¼Œå¹¶ä¸å—å®¢æˆ·ç«¯/ä¸­é—´ä»¶ä¸åŒäº§å“ï¼Œä¸åŒçš„å¼€å‘è¯­è¨€ç­‰æ¡ä»¶çš„é™åˆ¶ã€‚</p><p><code>2006å¹´ï¼ŒAMQP è§„èŒƒå‘å¸ƒã€‚ç±»æ¯”HTTPã€‚</code></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314172849.png" alt="image-20210314172848450"></p><blockquote><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™äº¤æ¢æœºï¼Œäº¤æ¢æœºæ ¹æ®å„ç§å„æ ·çš„è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯å‘é€åˆ°ä¸åŒçš„å®¹å™¨ä¸­ï¼Œå†ç”±æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ã€‚</p></blockquote><h2 id="2-2ã€RabbitMQç®€ä»‹"><a href="#2-2ã€RabbitMQç®€ä»‹" class="headerlink" title="2.2ã€RabbitMQç®€ä»‹"></a>2.2ã€RabbitMQç®€ä»‹</h2><blockquote><p>2007å¹´ï¼ŒRabbit æŠ€æœ¯å…¬å¸åŸºäº AMQP æ ‡å‡†å¼€å‘çš„ RabbitMQ 1.0 å‘å¸ƒã€‚RabbitMQ é‡‡ç”¨ Erlang è¯­è¨€å¼€å‘ã€‚<code>Erlang è¯­è¨€ç”± Ericson è®¾è®¡ï¼Œä¸“é—¨ä¸ºå¼€å‘é«˜å¹¶å‘å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ç§è¯­è¨€ï¼Œåœ¨ç”µä¿¡é¢†åŸŸä½¿ç”¨å¹¿æ³›ã€‚</code></p></blockquote><h3 id="1ã€åŸºç¡€æ¶æ„"><a href="#1ã€åŸºç¡€æ¶æ„" class="headerlink" title="1ã€åŸºç¡€æ¶æ„"></a>1ã€åŸºç¡€æ¶æ„</h3><blockquote><p>RabbitMQçš„åŸºç¡€æ¶æ„å¦‚ä¸‹å›¾ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314173356.png" alt="image-20210314173356306"></p><blockquote><p>äº¤æ¢æœºï¼ˆExchangeï¼‰é€šè¿‡ <code>Binding</code> å’Œé˜Ÿåˆ—ï¼ˆQueueï¼‰ä¸€ä¸€å¯¹åº”ã€‚</p></blockquote><h3 id="2ã€RabbitMQä¸­çš„ç›¸å…³æ¦‚å¿µ"><a href="#2ã€RabbitMQä¸­çš„ç›¸å…³æ¦‚å¿µ" class="headerlink" title="2ã€RabbitMQä¸­çš„ç›¸å…³æ¦‚å¿µ"></a>2ã€RabbitMQä¸­çš„ç›¸å…³æ¦‚å¿µ</h3><ul><li><p><code>Brokerï¼š</code>æ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼Œ<code>RabbitMQ Serverå°±æ˜¯ Message Brokerã€‚</code></p></li><li><p><code>Virtual hostï¼š</code>å‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ <code>AMQP</code> çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼äºç½‘ç»œä¸­çš„ <code>namespace</code> æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª <code>RabbitMQ server</code> æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡ºå¤šä¸ª <code>vhost</code>ï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ <code>vhost</code> åˆ›å»º <code>exchangeï¼queue</code> ç­‰ã€‚</p></li><li><p><code>Connectionï¼š</code>publisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥ã€‚</p></li><li><p><code>Channelï¼š</code>å¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connectionçš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ªthreadåˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº†channel id å¸®åŠ©å®¢æˆ·ç«¯å’Œmessage broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€ã€‚</p></li><li><p><code>Exchangeï¼š</code>message åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼Œ<code>åŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œ</code>åˆ†å‘æ¶ˆæ¯åˆ°queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼š</p><blockquote><ol><li><code>direct (point-to-point)</code></li><li><code>topic (publish-subscribe)</code> </li><li><code>fanout (multicast)</code></li></ol></blockquote></li><li><p><code>Queueï¼š</code>æ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°</p></li><li><p><code>Bindingï¼š</code>exchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyã€‚Binding ä¿¡æ¯è¢«ä¿å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</p></li></ul><h3 id="3ã€RabbitMQçš„å…­ç§å·¥ä½œæ¨¡å¼"><a href="#3ã€RabbitMQçš„å…­ç§å·¥ä½œæ¨¡å¼" class="headerlink" title="3ã€RabbitMQçš„å…­ç§å·¥ä½œæ¨¡å¼"></a>3ã€RabbitMQçš„å…­ç§å·¥ä½œæ¨¡å¼</h3><blockquote><p>RabbitMQ æä¾›äº† 6 ç§å·¥ä½œæ¨¡å¼ï¼š</p></blockquote><ul><li>ç®€å•æ¨¡å¼</li><li>work queues</li><li>Publish/Subscribe ï¼ˆå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼‰</li><li>Routing ï¼ˆè·¯ç”±æ¨¡å¼ï¼‰</li><li>Topics ï¼ˆä¸»é¢˜æ¨¡å¼ï¼‰</li><li>RPC è¿œç¨‹è°ƒç”¨æ¨¡å¼ ï¼ˆè¿œç¨‹è°ƒç”¨ï¼Œä¸å¤ªç®— MQï¼›æš‚ä¸ä½œä»‹ç»ï¼‰</li></ul><blockquote><p>å®˜ç½‘ä¸­å…³äºä»¥ä¸Šæ¨¡å¼çš„<a href="https://www.rabbitmq.com/getstarted.html">ä»‹ç»</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210314180250.png" alt="image-20210314180250054"></p><h2 id="2-3ã€AMQPå’ŒJMS"><a href="#2-3ã€AMQPå’ŒJMS" class="headerlink" title="2.3ã€AMQPå’ŒJMS"></a>2.3ã€AMQPå’ŒJMS</h2><blockquote><p>MQæ˜¯æ¶ˆæ¯é€šä¿¡çš„æ¨¡å‹ï¼›<code>å®ç°MQçš„å¤§è‡´æœ‰ä¸¤ç§ä¸»æµæ–¹å¼ï¼šAMQPã€JMSã€‚</code></p></blockquote><h3 id="1ã€AMQP"><a href="#1ã€AMQP" class="headerlink" title="1ã€AMQP"></a>1ã€AMQP</h3><blockquote><p>AMQPæ˜¯ä¸€ç§åè®®ï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯ä¸€ç§binary wire-level protocolï¼ˆé“¾æ¥åè®®ï¼‰ã€‚è¿™æ˜¯å…¶å’ŒJMSçš„æœ¬è´¨å·®åˆ«ï¼ŒAMQPä¸ä»APIå±‚è¿›è¡Œé™å®šï¼Œè€Œæ˜¯ç›´æ¥å®šä¹‰ç½‘ç»œäº¤æ¢çš„æ•°æ®æ ¼å¼ã€‚</p></blockquote><h3 id="2ã€JMS"><a href="#2ã€JMS" class="headerlink" title="2ã€JMS"></a>2ã€JMS</h3><blockquote><p><code>JMSå³Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJavaMessage Serviceï¼‰åº”ç”¨ç¨‹åºæ¥å£ï¼Œ</code>æ˜¯ä¸€ä¸ªJavaå¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´ï¼Œæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚</p><p>JMS æ˜¯ <code>JavaEE</code> è§„èŒƒä¸­çš„ä¸€ç§ï¼Œç±»æ¯”JDBCã€‚</p></blockquote><h3 id="3-AMQP-ä¸-JMS-åŒºåˆ«"><a href="#3-AMQP-ä¸-JMS-åŒºåˆ«" class="headerlink" title="3 AMQP ä¸ JMS åŒºåˆ«"></a>3 AMQP ä¸ JMS åŒºåˆ«</h3><p>JMSæ˜¯å®šä¹‰äº†ç»Ÿä¸€çš„æ¥å£ï¼Œæ¥å¯¹æ¶ˆæ¯æ“ä½œè¿›è¡Œç»Ÿä¸€ï¼›AMQPæ˜¯é€šè¿‡è§„å®šåè®®æ¥ç»Ÿä¸€æ•°æ®äº¤äº’çš„æ ¼å¼</p><p>JMSé™å®šäº†å¿…é¡»ä½¿ç”¨Javaè¯­è¨€ï¼›AMQPåªæ˜¯åè®®ï¼Œä¸è§„å®šå®ç°æ–¹å¼ï¼Œå› æ­¤æ˜¯è·¨è¯­è¨€çš„ã€‚</p><p>JMSè§„å®šäº†ä¸¤ç§æ¶ˆæ¯æ¨¡å¼ï¼›è€ŒAMQPçš„æ¶ˆæ¯æ¨¡å¼æ›´åŠ ä¸°å¯Œ</p><h3 id="4-å†è°ˆå¸‚åœºä¸Šå¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#4-å†è°ˆå¸‚åœºä¸Šå¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="4 å†è°ˆå¸‚åœºä¸Šå¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—"></a>4 å†è°ˆå¸‚åœºä¸Šå¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p><code>ActiveMQ</code>ï¼šåŸºäºJMS</p><p><code>ZeroMQ</code>ï¼šåŸºäºCè¯­è¨€å¼€å‘</p><p>RabbitMQï¼šåŸºäºAMQPåè®®ï¼Œerlangè¯­è¨€å¼€å‘ï¼Œç¨³å®šæ€§å¥½</p><p><code>RocketMQ</code>ï¼šåŸºäºJMSï¼Œé˜¿é‡Œå·´å·´äº§å“</p><p>Kafkaï¼šç±»ä¼¼MQçš„äº§å“ï¼›åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼Œé«˜ååé‡ã€‚</p><h1 id="ä¸‰ã€RabbitMQ-å¿«é€Ÿå…¥é—¨"><a href="#ä¸‰ã€RabbitMQ-å¿«é€Ÿå…¥é—¨" class="headerlink" title="ä¸‰ã€RabbitMQ å¿«é€Ÿå…¥é—¨"></a>ä¸‰ã€RabbitMQ å¿«é€Ÿå…¥é—¨</h1><h2 id="3-1ã€å…¥é—¨ç¨‹åº"><a href="#3-1ã€å…¥é—¨ç¨‹åº" class="headerlink" title="3.1ã€å…¥é—¨ç¨‹åº"></a>3.1ã€å…¥é—¨ç¨‹åº</h2><h3 id="1ã€éœ€æ±‚"><a href="#1ã€éœ€æ±‚" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><blockquote><p>ä½¿ç”¨RabbitMQå…­ç§æ¨¡å¼ä¹‹ä¸­çš„<strong>ç®€å•æ¨¡å¼</strong>å®Œæˆæ¶ˆæ¯ä¼ é€’</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320210713.png" alt="image-20210320210713517"></p><h3 id="2ã€æ­¥éª¤"><a href="#2ã€æ­¥éª¤" class="headerlink" title="2ã€æ­¥éª¤"></a>2ã€æ­¥éª¤</h3><ul><li>åˆ›å»ºå·¥ç¨‹ï¼ˆæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…ï¼‰</li><li>åˆ†åˆ«æ·»åŠ ä¾èµ–</li><li>ç¼–å†™ä»£ç ï¼Œä»¤ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯ã€‚</li></ul><h3 id="3ã€å¼•å…¥ä¾èµ–"><a href="#3ã€å¼•å…¥ä¾èµ–" class="headerlink" title="3ã€å¼•å…¥ä¾èµ–"></a>3ã€å¼•å…¥ä¾èµ–</h3><blockquote><p>åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å—ä¸­åˆ†åˆ«å¼•å…¥ä»¥ä¸‹ä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç "><a href="#4ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç " class="headerlink" title="4ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç "></a>4ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç </h3><blockquote><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p></blockquote><ul><li><p>åˆ›å»ºè¿æ¥å·¥å‚</p></li><li><p>è®¾ç½®å‚æ•°</p><ul><li>è®¾ç½®<code>ip</code>åœ°å€ï¼Œé»˜è®¤åªä¸º <code>localhost</code></li><li>è®¾ç½®<code>port</code>ç«¯å£ï¼Œé»˜è®¤ä¸º 5672</li><li>è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤ä¸º /</li><li>è®¾ç½®ç”¨æˆ·å¯†ç ï¼Œé»˜è®¤å€¼éƒ½ä¸º <code>admin</code></li></ul></li><li><p>åˆ›å»ºè¿æ¥   <strong>Connection</strong></p></li><li><p>åˆ›å»º  <strong>Channel</strong></p></li></ul><blockquote><p>å‚æ•°ä»‹ç»<br> 1 quequeï¼šé˜Ÿåˆ—åç§°<br> 2 durableï¼šæ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœä¸æŒä¹…åŒ–ï¼Œé‚£ä¹ˆmqé‡å¯å³å¤±<br> 3 exclusiveï¼š<br>     æ˜¯å¦ç‹¬å ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç›‘å¬æ­¤é˜Ÿåˆ—ï¼‰<br>     å½“Connectionå…³é—­æ—¶ï¼Œæ˜¯å¦åˆ é™¤æ­¤é˜Ÿåˆ—<br> 4 autoDeleteï¼š<br>     æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œå½“æ²¡æœ‰Consumeræ—¶ï¼Œè‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—<br> 5 argumentsï¼šå‚æ•°</p></blockquote><ul><li>åˆ›å»ºé˜Ÿåˆ—    <strong>Queue</strong></li><li>å‘é€æ¶ˆæ¯</li></ul><blockquote><p>å‚æ•°ï¼š<br>      1 exchange<br>          äº¤æ¢æœºæ¯æ¬¡ï¼Œç®€å•æ¨¡å¼ä¸‹äº¤æ¢æœºä¼šä½¿ç”¨é»˜è®¤çš„<br>      2 routingKey<br>          è·¯ç”±åç§°<br>      3 propsï¼šé…ç½®ä¿¡æ¯<br>      4 bodyï¼šå‘é€æ¶ˆæ¯çš„æ•°æ®ï¼ˆbyteæ•°ç»„ï¼‰</p></blockquote><ul><li>é‡Šæ”¾èµ„æº</li></ul><blockquote><p><strong>ç”Ÿäº§è€…çš„å…·ä½“ä»£ç å¦‚ä¸‹</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"><span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line"><span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"><span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//5 åˆ›å»ºé˜Ÿåˆ—Queue</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  å‚æ•°ä»‹ç»</span></span><br><span class="line"><span class="comment">   1 quequeï¼šé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">   2 durableï¼šæ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœä¸æŒä¹…åŒ–ï¼Œé‚£ä¹ˆmqé‡å¯å³å¤±</span></span><br><span class="line"><span class="comment">   3 exclusiveï¼š</span></span><br><span class="line"><span class="comment">       æ˜¯å¦ç‹¬å ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç›‘å¬æ­¤é˜Ÿåˆ—ï¼‰</span></span><br><span class="line"><span class="comment">       å½“Connectionå…³é—­æ—¶ï¼Œæ˜¯å¦åˆ é™¤æ­¤é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">   4 autoDeleteï¼š</span></span><br><span class="line"><span class="comment">       æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œå½“æ²¡æœ‰Consumeræ—¶ï¼Œè‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">   5 argumentsï¼šå‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰åå­—ä¸ºhello_worldçš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨åˆ›å»ºè¯¥é˜Ÿåˆ—ï¼Œå¦åˆ™ä¸ä¼šåˆ›å»º</span></span><br><span class="line">channel.queueDeclare(<span class="string">&quot;hello_world&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//6 å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">        1 exchange</span></span><br><span class="line"><span class="comment">            äº¤æ¢æœºæ¯æ¬¡ï¼Œç®€å•æ¨¡å¼ä¸‹äº¤æ¢æœºä¼šä½¿ç”¨é»˜è®¤çš„</span></span><br><span class="line"><span class="comment">        2 routingKey</span></span><br><span class="line"><span class="comment">            è·¯ç”±åç§°</span></span><br><span class="line"><span class="comment">        3 propsï¼šé…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        4 bodyï¼šå‘é€æ¶ˆæ¯çš„æ•°æ®ï¼ˆbyteæ•°ç»„ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">String data = <span class="string">&quot;hello rabbitMQ&quot;</span>;</span><br><span class="line"><span class="comment">//è¿™é‡Œå¦‚æœä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼Œé‚£ä¹ˆroutingKeyå¿…é¡»å’Œäº¤æ¢æœºåç§°ä¸€è‡´</span></span><br><span class="line"><span class="comment">//å³åŒæ ·ä¸ºhello_world</span></span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;hello_world&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br><span class="line"><span class="comment">//7 é‡Šæ”¾èµ„æºï¼ˆå…ˆå¼€å¯çš„åå…³é—­ï¼‰</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œä»£ç ï¼Œ å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªåä¸º  <strong>hello_world</strong> çš„é˜Ÿåˆ—è¢«åˆ›å»º</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320220222.png" alt="image-20210320220220877"></p><blockquote><p>ç‚¹å‡»é˜Ÿåˆ—ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ¶ˆæ¯å·²ç»å°±ç»ªï¼Œç­‰å¾…è¢«æ¶ˆè´¹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320220337.png" alt="image-20210320220337441"></p><h3 id="5ã€ç¼–å†™æ¶ˆè´¹è€…ä»£ç "><a href="#5ã€ç¼–å†™æ¶ˆè´¹è€…ä»£ç " class="headerlink" title="5ã€ç¼–å†™æ¶ˆè´¹è€…ä»£ç "></a>5ã€ç¼–å†™æ¶ˆè´¹è€…ä»£ç </h3><blockquote><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p></blockquote><ul><li><p>åˆ›å»ºè¿æ¥å·¥å‚</p></li><li><p>è®¾ç½®å‚æ•°</p><ul><li>è®¾ç½®<code>ip</code>åœ°å€ï¼Œé»˜è®¤åªä¸º <code>localhost</code></li><li>è®¾ç½®<code>port</code>ç«¯å£ï¼Œé»˜è®¤ä¸º 5672</li><li>è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤ä¸º /</li><li>è®¾ç½®ç”¨æˆ·å¯†ç ï¼Œé»˜è®¤å€¼éƒ½ä¸º <code>admin</code></li></ul></li><li><p>åˆ›å»ºè¿æ¥   <strong>Connection</strong></p></li><li><p>åˆ›å»º  <strong>Channel</strong></p></li></ul><blockquote><p>å‚æ•°ä»‹ç»<br> 1 quequeï¼šé˜Ÿåˆ—åç§°<br> 2 durableï¼šæ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœä¸æŒä¹…åŒ–ï¼Œé‚£ä¹ˆmqé‡å¯å³å¤±<br> 3 exclusiveï¼š<br>     æ˜¯å¦ç‹¬å ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç›‘å¬æ­¤é˜Ÿåˆ—ï¼‰<br>     å½“Connectionå…³é—­æ—¶ï¼Œæ˜¯å¦åˆ é™¤æ­¤é˜Ÿåˆ—<br> 4 autoDeleteï¼š<br>     æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œå½“æ²¡æœ‰Consumeræ—¶ï¼Œè‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—<br> 5 argumentsï¼šå‚æ•°</p></blockquote><ul><li>åˆ›å»ºé˜Ÿåˆ—    <strong>Queue</strong></li><li>åˆ›å»ºå›è°ƒ <code>DefaultConsumer</code> å¯¹è±¡</li></ul><blockquote><p>é‡å†™ <code>DefaultConsumer</code> çš„ <code>handleDelivery</code> æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯åä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•</p><p>å‚æ•°è¯´æ˜</p><p>/*<br>    è¿™é‡Œçš„ <code>DefaultConsumer</code> å¯¹è±¡ä¸ºå›è°ƒå¯¹è±¡ï¼Œ<br>    æˆ‘ä»¬å¯ä»¥é‡å†™å›è°ƒæ–¹æ³• <code>handleDelivery</code>ï¼Œ<br>    æ”¶åˆ°æ¶ˆæ¯åä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•</p><p>   å‚æ•°è¯´æ˜ï¼š<br>        1 <code>consumerTag</code>ï¼šæ ‡è¯†<br>        2 envelopeï¼šè·å–ä¿¡æ¯çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¯´äº¤æ¢å™¨ã€è·¯ç”±key<br>        3 propertiesï¼šé…ç½®ä¿¡æ¯<br>        4 bodyï¼šæ•°æ®<br>    */</p></blockquote><ul><li>æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</li></ul><blockquote><p>/*<br>  å‚æ•°ï¼š<br>        1 queueï¼šé˜Ÿåˆ—åç§°<br>        2 autoACKï¼šæ˜¯å¦è‡ªåŠ¨ç¡®è®¤<br>        3 callbackï¼šå›è°ƒå¯¹è±¡<br>*/</p></blockquote><ul><li>æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­è¿æ¥é‡Šæ”¾èµ„æºï¼Œå› ä¸ºæ¶ˆè´¹è€…éœ€è¦ç›‘å¬ç«¯å£</li></ul><blockquote><p>æ¶ˆè´¹è€…å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line"> ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"> <span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"> <span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line"> factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"> <span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line"> factory.setPort(<span class="number">5672</span>);</span><br><span class="line"> <span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line"> factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"> <span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line"> factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"> <span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line"> factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"> <span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line"> Connection connection = factory.newConnection();</span><br><span class="line"> <span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line"> Channel channel = connection.createChannel();</span><br><span class="line"> <span class="comment">//5 åˆ›å»ºé˜Ÿåˆ—Queue</span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">   å‚æ•°ä»‹ç»</span></span><br><span class="line"><span class="comment">    1 quequeï¼šé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">    2 durableï¼šæ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœä¸æŒä¹…åŒ–ï¼Œé‚£ä¹ˆmqé‡å¯å³å¤±</span></span><br><span class="line"><span class="comment">    3 exclusiveï¼š</span></span><br><span class="line"><span class="comment">        æ˜¯å¦ç‹¬å ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ç›‘å¬æ­¤é˜Ÿåˆ—ï¼‰</span></span><br><span class="line"><span class="comment">        å½“Connectionå…³é—­æ—¶ï¼Œæ˜¯å¦åˆ é™¤æ­¤é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">    4 autoDeleteï¼š</span></span><br><span class="line"><span class="comment">        æ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œå½“æ²¡æœ‰Consumeræ—¶ï¼Œè‡ªåŠ¨åˆ é™¤é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">    5 argumentsï¼šå‚æ•°</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="comment">//å¦‚æœæ²¡æœ‰åå­—ä¸ºhello_worldçš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨åˆ›å»ºè¯¥é˜Ÿåˆ—ï¼Œå¦åˆ™ä¸ä¼šåˆ›å»º</span></span><br><span class="line"> channel.queueDeclare(<span class="string">&quot;hello_world&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//6 æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">   å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">         1 queueï¼šé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         2 autoACKï¼šæ˜¯å¦è‡ªåŠ¨ç¡®è®¤</span></span><br><span class="line"><span class="comment">         3 callbackï¼šå›è°ƒå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">     è¿™é‡Œçš„DefaultConsumerå¯¹è±¡ä¸ºå›è°ƒå¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">     æˆ‘ä»¬å¯ä»¥é‡å†™å›è°ƒæ–¹æ³•handleDeliveryï¼Œ</span></span><br><span class="line"><span class="comment">     æ”¶åˆ°æ¶ˆæ¯åä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">     1 consumerTagï¼šæ ‡è¯†</span></span><br><span class="line"><span class="comment">     2 envelopeï¼šè·å–ä¿¡æ¯çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¯´äº¤æ¢å™¨ã€è·¯ç”±key</span></span><br><span class="line"><span class="comment">     3 propertiesï¼šé…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     4 bodyï¼šæ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;consumerTag:&quot;</span> + consumerTag);</span><br><span class="line">         System.out.println(<span class="string">&quot;envelope:&quot;</span> + envelope.getExchange());</span><br><span class="line">         System.out.println(<span class="string">&quot;routingKey:&quot;</span> + envelope.getRoutingKey());</span><br><span class="line">         System.out.println(<span class="string">&quot;properties:&quot;</span> + properties);</span><br><span class="line">         System.out.println(<span class="string">&quot;body:&quot;</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"> <span class="comment">//è¿™é‡Œé˜Ÿåˆ—çš„åç§°å¿…é¡»å’Œç”Ÿäº§è€…åˆ›å»ºçš„é˜Ÿåˆ—åç§°ç›¸åŒ</span></span><br><span class="line"> channel.basicConsume(<span class="string">&quot;hello_world&quot;</span>,<span class="keyword">true</span>,consumer);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ç›‘å¬</span></span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨æ¶ˆè´¹è€…ï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320223308.png" alt="image-20210320223307615"></p><h2 id="3-2ã€å°ç»“"><a href="#3-2ã€å°ç»“" class="headerlink" title="3.2ã€å°ç»“"></a>3.2ã€å°ç»“</h2><blockquote><p>ä¸Šè¿°çš„å…¥é—¨æ¡ˆä¾‹ä¸­å…¶å®ä½¿ç”¨çš„æ˜¯ä»¥ä¸‹çš„ç®€å•æ–¹å¼</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320223411.png" alt="image-20210320223411565"></p><blockquote><p>åœ¨ä¸Šå›¾çš„æ¨¡å‹ä¸­ï¼Œæœ‰ä»¥ä¸‹æ¦‚å¿µ</p></blockquote><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åº</li><li>Cï¼šæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥</li><li>queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå›¾ä¸­çº¢è‰²éƒ¨åˆ†ï¼Œç±»ä¼¼ä¸€ä¸ªé‚®ç®±ï¼Œå¯ä»¥ç¼“å­˜æ¶ˆæ¯ï¼›ç”Ÿäº§è€…å‘å…¶ä¸­æŠ•é€’æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ä»ä¸­å–å‡ºæ¶ˆæ¯</li></ul><h1 id="å››ã€RabbitMQå·¥ä½œæ¨¡å¼"><a href="#å››ã€RabbitMQå·¥ä½œæ¨¡å¼" class="headerlink" title="å››ã€RabbitMQå·¥ä½œæ¨¡å¼"></a>å››ã€RabbitMQå·¥ä½œæ¨¡å¼</h1><h2 id="4-1ã€Work-queueså·¥ä½œé˜Ÿåˆ—æ¨¡å¼"><a href="#4-1ã€Work-queueså·¥ä½œé˜Ÿåˆ—æ¨¡å¼" class="headerlink" title="4.1ã€Work queueså·¥ä½œé˜Ÿåˆ—æ¨¡å¼"></a>4.1ã€Work queueså·¥ä½œé˜Ÿåˆ—æ¨¡å¼</h2><h3 id="1ã€æ¨¡å¼è¯´æ˜"><a href="#1ã€æ¨¡å¼è¯´æ˜" class="headerlink" title="1ã€æ¨¡å¼è¯´æ˜"></a>1ã€æ¨¡å¼è¯´æ˜</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320224013.png" alt="image-20210320224013389"></p><blockquote><p><code>Work Queues</code>ä¸å…¥é—¨ç¨‹åºçš„<code>ç®€å•æ¨¡å¼</code>ç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæˆ–ä¸€äº›æ¶ˆè´¹ç«¯ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</p><p>æ³¨æ„ï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„æ¶ˆè´¹è€…é—´æ˜¯<strong>ç«äº‰</strong>å…³ç³»ï¼Œå³æœ€ååªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–åˆ°æ¶ˆæ¯ã€‚</p></blockquote><h3 id="2ã€åº”ç”¨åœºæ™¯"><a href="#2ã€åº”ç”¨åœºæ™¯" class="headerlink" title="2ã€åº”ç”¨åœºæ™¯"></a>2ã€åº”ç”¨åœºæ™¯</h3><blockquote><p>å¯¹äº ä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ã€‚</p></blockquote><h3 id="3ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç "><a href="#3ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç " class="headerlink" title="3ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç "></a>3ã€ç¼–å†™ç”Ÿäº§è€…ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"><span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line"><span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"><span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//5 åˆ›å»ºé˜Ÿåˆ—Queue</span></span><br><span class="line">channel.queueDeclare(<span class="string">&quot;work_queues&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    String data = <span class="string">&quot;hello rabbitMQ + i&quot;</span>;</span><br><span class="line">    <span class="comment">//6 å‘é€æ¶ˆæ¯</span></span><br><span class="line">    channel.basicPublish(<span class="string">&quot;&quot;</span>,<span class="string">&quot;work_queues&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//7 é‡Šæ”¾èµ„æºï¼ˆå…ˆå¼€å¯çš„åå…³é—­ï¼‰</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><h3 id="4ã€ç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…"><a href="#4ã€ç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…" class="headerlink" title="4ã€ç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…"></a>4ã€ç¼–å†™ä¸¤ä¸ªæ¶ˆè´¹è€…</h3><blockquote><p>è¿™é‡Œç»™å‡ºå…¶ä¸­ä¸€ä¸ªçš„ä»£ç ï¼Œç¬¬äºŒä¸ªå’Œç¬¬ä¸€ä¸ªä»£ç ä¸€è‡´</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"><span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line"><span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"><span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//5 åˆ›å»ºé˜Ÿåˆ—Queue</span></span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰åå­—ä¸ºhello_worldçš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨åˆ›å»ºè¯¥é˜Ÿåˆ—ï¼Œå¦åˆ™ä¸ä¼šåˆ›å»º</span></span><br><span class="line">channel.queueDeclare(<span class="string">&quot;work_queues&quot;</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//6 æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;body:&quot;</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//è¿™é‡Œé˜Ÿåˆ—çš„åç§°å¿…é¡»å’Œç”Ÿäº§è€…åˆ›å»ºçš„é˜Ÿåˆ—åç§°ç›¸åŒ</span></span><br><span class="line">channel.basicConsume(<span class="string">&quot;work_queues&quot;</span>,<span class="keyword">true</span>,consumer);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ç›‘å¬</span></span><br></pre></td></tr></table></figure><h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><blockquote><p>å…ˆå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒæŸ¥çœ‹å·¥ä½œçª—å£ä¸­çš„è¿æ¥æƒ…å†µ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320230336.png" alt="image-20210320230335776"></p><blockquote><p>å¯åŠ¨ç”Ÿäº§è€…ï¼ŒæŸ¥çœ‹æ¶ˆæ¯è¢«æ¶ˆè´¹æƒ…å†µ</p></blockquote><ul><li>æ¶ˆè´¹è€…1</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320230830.png" alt="image-20210320230830722"></p><ul><li>æ¶ˆè´¹è€…2</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320230901.png" alt="image-20210320230901377"></p><h3 id="6ã€å°ç»“"><a href="#6ã€å°ç»“" class="headerlink" title="6ã€å°ç»“"></a>6ã€å°ç»“</h3><ul><li><p>åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…ä¹‹é—´å¯¹åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯çš„å…³ç³»æ˜¯<strong>ç«äº‰</strong>å…³ç³»ã€‚</p></li><li><p><strong>Work Queues</strong> å¯¹äºä»»åŠ¡è¿‡é‡æˆ–ä»»åŠ¡è¾ƒå¤šæƒ…å†µï¼Œä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦</p></li></ul><blockquote><p>ä¾‹å¦‚ï¼šçŸ­ä¿¡æœåŠ¡éƒ¨ç½²æœ‰å¤šä¸ªï¼Œåªéœ€è¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹å‘é€æˆåŠŸå³å¯ã€‚</p></blockquote><h2 id="4-2ã€Pub-Subè®¢é˜…å‘å¸ƒæ¨¡å¼"><a href="#4-2ã€Pub-Subè®¢é˜…å‘å¸ƒæ¨¡å¼" class="headerlink" title="4.2ã€Pub/Subè®¢é˜…å‘å¸ƒæ¨¡å¼"></a>4.2ã€Pub/Subè®¢é˜…å‘å¸ƒæ¨¡å¼</h2><blockquote><p><strong>åœ¨Pub/Subä¹‹åçš„å·¥ä½œæ¨¡å¼ä¸­ï¼Œä¸€æ¡æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</strong></p></blockquote><h3 id="1ã€æ¨¡å¼è¯´æ˜-1"><a href="#1ã€æ¨¡å¼è¯´æ˜-1" class="headerlink" title="1ã€æ¨¡å¼è¯´æ˜"></a>1ã€æ¨¡å¼è¯´æ˜</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321124939.png" alt="image-20210321124903796"></p><blockquote><p>ç›¸æ¯” <strong>Work_Queues</strong>å’Œç®€å•æ¨¡å¼ï¼Œè®¢é˜…å‘å¸ƒæ¨¡å¼å¤šäº†ä¸€ä¸ª <strong>Exchange</strong> è§’è‰²ï¼Œè€Œä¸”è¿‡ç¨‹ç•¥æœ‰å˜åŒ–ï¼š</p></blockquote><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯è¦å‘é€æ¶ˆæ¯çš„ç¨‹åºï¼Œä½†æ˜¯ä¸å†å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å‘ç»™äº¤æ¢æœºX</li><li>Cï¼šæ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯çš„æ¥æ”¶è€…ï¼Œä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥</li><li>Queueï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥æ”¶æ¶ˆæ¯ï¼Œç¼“å­˜æ¶ˆæ¯</li><li>Exchangeï¼šäº¤æ¢æœºXï¼Œä¸€æ–¹é¢ï¼Œæ¥æ”¶ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŸ¥é“å¦‚ä½•å¤„ç†æ¶ˆæ¯ï¼Œä¾‹å¦‚é€’äº¤æŸä¸ªç‰¹åˆ«é˜Ÿåˆ—ã€é€’äº¤ç»™æ‰€æœ‰é˜Ÿåˆ—ã€æˆ–æ˜¯å°†æ¶ˆæ¯ä¸¢å¼ƒï¼Œå…·ä½“å¦‚ä½•æ“ä½œï¼Œå–å†³äºäº¤æ¢æœºçš„ç±»å‹ã€‚äº¤æ¢æœºæœ‰ä»¥ä¸‹ä¸‰ç§ç±»å‹<ul><li>Fanoutï¼šå¹¿æ’­ï¼Œå°†æ¶ˆæ¯äº¤ç»™æ‰€æœ‰ç»‘å®šåˆ°äº¤æ¢æœºçš„é˜Ÿåˆ—ã€‚</li><li>Directï¼šå®šå‘ï¼Œå°†æ¶ˆæ¯äº¤ç»™ç¬¦åˆæŒ‡å®š <strong>routing key</strong> çš„é˜Ÿåˆ—ã€‚</li><li>Topicï¼šé€šé…ç¬¦ï¼Œå°†æ¶ˆæ¯äº¤ç»™ç¬¦åˆ <strong>routing pattern</strong> ï¼ˆè·¯ç”±æ¨¡å¼ï¼‰ çš„é˜Ÿåˆ—ã€‚</li></ul></li></ul><blockquote><p><strong>Exchange</strong> ï¼ˆäº¤æ¢æœºï¼‰åªè´Ÿè´£è½¬å‘æ¶ˆæ¯ï¼Œä¸å…·å¤‡å­˜å‚¨æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ä¸ <strong>Exchange</strong> ç»‘å®šï¼Œæˆ–è€…æ²¡æœ‰ç¬¦åˆ è·¯ç”±è§„åˆ™çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šä¸¢å¤±ï¼</p></blockquote><h3 id="2ã€éœ€æ±‚"><a href="#2ã€éœ€æ±‚" class="headerlink" title="2ã€éœ€æ±‚"></a>2ã€éœ€æ±‚</h3><blockquote><p>ç”Ÿäº§è€…ç”Ÿäº§ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå°†è¿™æ¡æ¶ˆæ¯åˆ†å‘ç»™ C1 å’Œ C2ï¼Œè¿™æ¡æ¶ˆæ¯æ˜¯ä¸€æ¡æ—¥å¿—ï¼ŒC1ä¼šå°†æ¶ˆæ¯æ‰“å°åˆ°æ§åˆ¶å°ï¼ŒC2å°†æ—¥å¿—å­˜å‚¨æ•°æ®åº“ã€‚</p></blockquote><h3 id="3ã€ç”Ÿäº§è€…ä»£ç "><a href="#3ã€ç”Ÿäº§è€…ä»£ç " class="headerlink" title="3ã€ç”Ÿäº§è€…ä»£ç "></a>3ã€ç”Ÿäº§è€…ä»£ç </h3><blockquote><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p></blockquote><ul><li>åˆ›å»ºè¿æ¥å·¥å‚</li><li>è®¾ç½®å‚æ•°</li><li>åˆ›å»ºè¿æ¥</li><li>åˆ›å»ºChannel</li><li>åˆ›å»ºäº¤æ¢æœº</li></ul><blockquote><p>å‚æ•°è¯´æ˜ï¼š</p><p>1 exchangeï¼šäº¤æ¢æœºåç§°<br>2 typeï¼šäº¤æ¢æœºç±»å‹ï¼ˆå»ºè®®ä½¿ç”¨æšä¸¾ç±»å‹ï¼‰<br> DIRECT(â€œdirectâ€):å®šå‘<br> FANOUT(â€œfanoutâ€):å¹¿æ’­<br> TOPIC(â€œtopicâ€):é€šé…ç¬¦æ–¹å¼<br> HEADERS(â€œheadersâ€):å‚æ•°åŒ¹é…<br>3 durableï¼šæ˜¯å¦æŒä¹…åŒ–<br>4 autoDeleteï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤<br>5 internalï¼šå†…éƒ¨ä½¿ç”¨ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºfalse<br>6 argumentsï¼šå‚æ•°</p></blockquote><ul><li>åˆ›å»ºé˜Ÿåˆ—</li><li>ç»‘å®šäº¤æ¢æœºå’Œé˜Ÿåˆ—</li></ul><blockquote><p>å‚æ•°è¯´æ˜ï¼š<br>1 queueï¼šé˜Ÿåˆ—çš„åç§°<br>2 exchangeï¼šäº¤æ¢æœºåç§°<br>3 routing keyï¼šè·¯ç”±é”®ï¼Œç»‘å®šè§„åˆ™<br>å¦‚æœäº¤æ¢æœºç±»å‹ä¸º fanoutï¼Œé‚£ä¹ˆrouting keyè®¾ç½®ä¸ºâ€â€<br>è¿™æ ·äº¤æ¢æœºä¼šæŠŠæ¶ˆæ¯å‘ç»™æ‰€æœ‰é˜Ÿåˆ—</p></blockquote><ul><li>å‘é€æ¶ˆæ¯</li><li>é‡Šæ”¾èµ„æº</li></ul><blockquote><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"><span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line"><span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"><span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//5 åˆ›å»ºäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"> * 1 exchangeï¼šäº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment"> * 2 typeï¼šäº¤æ¢æœºç±»å‹ï¼ˆå»ºè®®ä½¿ç”¨æšä¸¾ç±»å‹ï¼‰</span></span><br><span class="line"><span class="comment"> *  DIRECT(&quot;direct&quot;):å®šå‘</span></span><br><span class="line"><span class="comment"> *  FANOUT(&quot;fanout&quot;):å¹¿æ’­</span></span><br><span class="line"><span class="comment"> *  TOPIC(&quot;topic&quot;):é€šé…ç¬¦æ–¹å¼</span></span><br><span class="line"><span class="comment"> *  HEADERS(&quot;headers&quot;):å‚æ•°åŒ¹é…</span></span><br><span class="line"><span class="comment"> * 3 durableï¼šæ˜¯å¦æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment"> * 4 autoDeleteï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment"> * 5 internalï¼šå†…éƒ¨ä½¿ç”¨ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºfalse</span></span><br><span class="line"><span class="comment"> * 6 argumentsï¼šå‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String exchangeName = <span class="string">&quot;test_fanout&quot;</span>;</span><br><span class="line"><span class="comment">//è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªåä¸ºtest_fanoutçš„äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(exchangeName, BuiltinExchangeType.FANOUT,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//6 åˆ›å»ºé˜Ÿåˆ—ï¼Œè¿™é‡Œéœ€è¦åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">String queue1Name = <span class="string">&quot;test_fanout_queue1&quot;</span>;</span><br><span class="line">String queue2Name = <span class="string">&quot;test_fanout_queue2&quot;</span>;</span><br><span class="line">channel.queueDeclare(queue1Name,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">channel.queueDeclare(queue2Name,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//7 ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> * 1 queueï¼šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment"> * 2 exchangeï¼šäº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment"> * 3 routing keyï¼šè·¯ç”±é”®ï¼Œç»‘å®šè§„åˆ™</span></span><br><span class="line"><span class="comment"> * å¦‚æœäº¤æ¢æœºç±»å‹ä¸º fanoutï¼Œé‚£ä¹ˆrouting keyè®¾ç½®ä¸º&quot;&quot;</span></span><br><span class="line"><span class="comment"> * è¿™æ ·äº¤æ¢æœºä¼šæŠŠæ¶ˆæ¯å‘ç»™æ‰€æœ‰é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">channel.queueBind(queue1Name,exchangeName,<span class="string">&quot;&quot;</span>);</span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†findAllæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šinfo...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br><span class="line"><span class="comment">//9 é‡Šæ”¾èµ„æº</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><h3 id="4ã€æ¶ˆè´¹è€…ä»£ç "><a href="#4ã€æ¶ˆè´¹è€…ä»£ç " class="headerlink" title="4ã€æ¶ˆè´¹è€…ä»£ç "></a>4ã€æ¶ˆè´¹è€…ä»£ç </h3><blockquote><p>æ¶ˆè´¹è€…ä¸éœ€è¦åˆ›å»ºé˜Ÿåˆ—ï¼Œåªéœ€è¦ç»‘å®šç”Ÿäº§è€…åˆ›å»ºçš„é˜Ÿåˆ—å³å¯ã€‚</p><p>ä¸‹é¢åªç»™å‡ºæ¶ˆè´¹è€…2çš„ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">    ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line">    <span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line">    <span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">    factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line">    <span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">    factory.setPort(<span class="number">5672</span>);</span><br><span class="line">    <span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">    factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line">    <span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">    factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    <span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">    factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    <span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">    Connection connection = factory.newConnection();</span><br><span class="line">    <span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">    Channel channel = connection.createChannel();</span><br><span class="line">    String queue1Name = <span class="string">&quot;test_fanout_queue1&quot;</span>;</span><br><span class="line">    String queue2Name = <span class="string">&quot;test_fanout_queue2&quot;</span>;</span><br><span class="line">    <span class="comment">//5 æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">            1 queueï¼šé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">            2 autoACKï¼šæ˜¯å¦è‡ªåŠ¨ç¡®è®¤</span></span><br><span class="line"><span class="comment">            3 callbackï¼šå›è°ƒå¯¹è±¡</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è¿™é‡Œçš„DefaultConsumerå¯¹è±¡ä¸ºå›è°ƒå¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">        æˆ‘ä»¬å¯ä»¥é‡å†™å›è°ƒæ–¹æ³•handleDeliveryï¼Œ</span></span><br><span class="line"><span class="comment">        æ”¶åˆ°æ¶ˆæ¯åä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">   å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">        1 consumerTagï¼šæ ‡è¯†</span></span><br><span class="line"><span class="comment">        2 envelopeï¼šè·å–ä¿¡æ¯çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¯´äº¤æ¢å™¨ã€è·¯ç”±key</span></span><br><span class="line"><span class="comment">        3 propertiesï¼šé…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        4 bodyï¼šæ•°æ®</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;body:&quot;</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…ä¸€å°†æ—¥å¿—ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“...&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;----------------------------------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//è¿™é‡Œé˜Ÿåˆ—çš„åç§°å¿…é¡»å’Œç”Ÿäº§è€…åˆ›å»ºçš„é˜Ÿåˆ—åç§°ç›¸åŒ</span></span><br><span class="line">    channel.basicConsume(queue2Name,<span class="keyword">true</span>,consumer);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ç›‘å¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€æµ‹è¯•-1"><a href="#5ã€æµ‹è¯•-1" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><blockquote><p>å…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œç„¶åå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå‘ç°ä¸¤ä¸ªæ¶ˆè´¹è€…çš„æ§åˆ¶å°éƒ½è¾“å‡ºäº†å¯¹åº”çš„æ—¥å¿—ä¿¡æ¯ã€‚</p></blockquote><ul><li>æ¶ˆè´¹è€…1</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321135557.png" alt="image-20210321135557577"></p><ul><li>æ¶ˆè´¹è€…2</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321135535.png" alt="image-20210321135534003"></p><ul><li>rabbitmqæ§åˆ¶å°</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321135640.png" alt="image-20210321135639849"></p><h3 id="6ã€å°ç»“-1"><a href="#6ã€å°ç»“-1" class="headerlink" title="6ã€å°ç»“"></a>6ã€å°ç»“</h3><ul><li><p>äº¤æ¢æœºéœ€è¦ä¸é˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œç»‘å®šä¹‹åï¼›ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…éƒ½æ”¶åˆ°ã€‚</p></li><li><p>ç”Ÿäº§è€…éœ€è¦åˆ›å»ºä¸€ä¸ª <strong>fanout</strong>  ç±»å‹çš„äº¤æ¢æœº</p></li></ul><blockquote><p>æ³¨æ„ï¼š<strong>fanout</strong>  ç±»å‹çš„äº¤æ¢æœºä¸éœ€è¦æŒ‡å®š <strong>routing key</strong></p></blockquote><ul><li>Pub/Subçš„äº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€ç»™æ¯ä¸€ä¸ªä¸æ­¤äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ã€‚</li></ul><h3 id="7ã€ä¸WorkQueueså·¥ä½œæ¨¡å¼çš„åŒºåˆ«"><a href="#7ã€ä¸WorkQueueså·¥ä½œæ¨¡å¼çš„åŒºåˆ«" class="headerlink" title="7ã€ä¸WorkQueueså·¥ä½œæ¨¡å¼çš„åŒºåˆ«"></a>7ã€ä¸<code>WorkQueues</code>å·¥ä½œæ¨¡å¼çš„åŒºåˆ«</h3><ul><li><p>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¸ç”¨å®šä¹‰äº¤æ¢æœºï¼Œè€Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼éœ€è¦å®šä¹‰äº¤æ¢æœºã€‚ </p></li><li><p>å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘é˜Ÿåˆ—å‘é€æ¶ˆæ¯(åº•å±‚ä½¿ç”¨é»˜è®¤äº¤æ¢æœº)ã€‚</p></li><li><p>å‘å¸ƒ/è®¢é˜…æ¨¡å¼éœ€è¦è®¾ç½®é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¸éœ€è¦è®¾ç½®ï¼Œå®é™…ä¸Šå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ä¼šå°†é˜Ÿåˆ—ç»‘ å®šåˆ°é»˜è®¤çš„äº¤æ¢æœº ã€‚</p></li></ul><h2 id="4-3ã€Routingè·¯ç”±æ¨¡å¼"><a href="#4-3ã€Routingè·¯ç”±æ¨¡å¼" class="headerlink" title="4.3ã€Routingè·¯ç”±æ¨¡å¼"></a>4.3ã€Routingè·¯ç”±æ¨¡å¼</h2><h3 id="1ã€æ¨¡å¼è¯´æ˜-2"><a href="#1ã€æ¨¡å¼è¯´æ˜-2" class="headerlink" title="1ã€æ¨¡å¼è¯´æ˜"></a>1ã€æ¨¡å¼è¯´æ˜</h3><ul><li>é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šä¸èƒ½æ˜¯ä»»æ„ç»‘å®šäº†ï¼Œè€Œæ˜¯è¦æŒ‡å®šä¸€ä¸ª <strong>Routing Key</strong>ï¼ˆè·¯ç”±keyï¼‰</li><li>æ¶ˆæ¯çš„å‘é€æ–¹åœ¨å‘ <strong>Exchange</strong> å‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿå¿…é¡»æŒ‡å®šæ¶ˆæ¯çš„ <strong>Routing Key</strong></li><li><strong>Exchange</strong> ä¸å†æŠŠæ¶ˆæ¯äº¤ç»™æ¯ä¸€ä¸ªç»‘å®šçš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆæ¯çš„ <strong>Routing Key</strong> è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰é˜Ÿåˆ—çš„ <strong>Routing Key</strong> å’Œæ¶ˆæ¯çš„ <strong>Routing Key</strong> å®Œå…¨ä¸€è‡´æ—¶ï¼Œæ‰ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321141048.png" alt="image-20210321141048174"></p><blockquote><p>å›¾è§£ï¼š</p></blockquote><ul><li>Pï¼šç”Ÿäº§è€…ï¼Œå‘Exchangeå‘é€æ¶ˆæ¯ï¼Œå‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šæŒ‡å®šä¸€ä¸ªrouting keyã€‚</li><li>Xï¼šExchangeï¼ˆäº¤æ¢æœºï¼‰ï¼Œæ¥æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œç„¶åæŠŠæ¶ˆæ¯é€’äº¤ç»™ ä¸routing keyå®Œå…¨åŒ¹é…çš„é˜Ÿåˆ—</li><li>C1ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing key ä¸º error çš„æ¶ˆæ¯</li><li>C2ï¼šæ¶ˆè´¹è€…ï¼Œå…¶æ‰€åœ¨é˜Ÿåˆ—æŒ‡å®šäº†éœ€è¦routing key ä¸º infoã€errorã€warning çš„æ¶ˆæ¯</li></ul><h3 id="2ã€éœ€æ±‚-1"><a href="#2ã€éœ€æ±‚-1" class="headerlink" title="2ã€éœ€æ±‚"></a>2ã€éœ€æ±‚</h3><blockquote><p>åªæœ‰å½“æ—¥å¿—çº§åˆ«ä¸º <strong>error</strong> æ—¶ï¼Œæ‰å°†æ—¥å¿—ä¿¡æ¯å­˜å‚¨åˆ°æ•°æ®åº“ï¼ˆåŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°ï¼‰ã€‚</p><p>å½“æ—¥å¿—çº§åˆ«åœ¨ <strong>error</strong> ä»¥ä¸‹æ—¶ï¼Œåªå°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</p></blockquote><h3 id="3ã€ç”Ÿäº§è€…"><a href="#3ã€ç”Ÿäº§è€…" class="headerlink" title="3ã€ç”Ÿäº§è€…"></a>3ã€ç”Ÿäº§è€…</h3><ul><li>åœ¨åˆ›å»ºäº¤æ¢æœºæ—¶éœ€è¦æŒ‡å®šäº¤æ¢æœºçš„ç±»å‹ä¸º <strong>DIRECT</strong> </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.exchangeDeclare(exchangeName, BuiltinExchangeType.DIRECT,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure><ul><li>åœ¨ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºæ—¶éœ€è¦æŒ‡å®š <strong>Routing Key</strong></li></ul><blockquote><p>å¦‚æœéœ€è¦ç»™ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå¤šä¸ª Routing Keyï¼Œé‚£ä¹ˆå¯ä»¥ç»‘å®šå¤šæ¬¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é˜Ÿåˆ—ä¸€çš„ç»‘å®š</span></span><br><span class="line">channel.queueBind(queue1Name,exchangeName,<span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="comment">//é˜Ÿåˆ—äºŒçš„ç»‘å®šï¼šinfoã€errorå’Œwarning</span></span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;info&quot;</span>);</span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;error&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>å®Œæ•´ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"><span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line"><span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"><span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//5 åˆ›å»ºäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"> * 1 exchangeï¼šäº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment"> * 2 typeï¼šäº¤æ¢æœºç±»å‹ï¼ˆå»ºè®®ä½¿ç”¨æšä¸¾ç±»å‹ï¼‰</span></span><br><span class="line"><span class="comment"> *  DIRECT(&quot;direct&quot;):å®šå‘</span></span><br><span class="line"><span class="comment"> *  FANOUT(&quot;fanout&quot;):å¹¿æ’­</span></span><br><span class="line"><span class="comment"> *  TOPIC(&quot;topic&quot;):é€šé…ç¬¦æ–¹å¼</span></span><br><span class="line"><span class="comment"> *  HEADERS(&quot;headers&quot;):å‚æ•°åŒ¹é…</span></span><br><span class="line"><span class="comment"> * 3 durableï¼šæ˜¯å¦æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment"> * 4 autoDeleteï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment"> * 5 internalï¼šå†…éƒ¨ä½¿ç”¨ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºfalse</span></span><br><span class="line"><span class="comment"> * 6 argumentsï¼šå‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String exchangeName = <span class="string">&quot;test_direct&quot;</span>;</span><br><span class="line"><span class="comment">//è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªåä¸ºtest_directçš„äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(exchangeName, BuiltinExchangeType.DIRECT,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//6 åˆ›å»ºé˜Ÿåˆ—ï¼Œè¿™é‡Œéœ€è¦åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">String queue1Name = <span class="string">&quot;test_direct_queue1&quot;</span>;</span><br><span class="line">String queue2Name = <span class="string">&quot;test_direct_queue2&quot;</span>;</span><br><span class="line">channel.queueDeclare(queue1Name,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">channel.queueDeclare(queue2Name,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//7 ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> * 1 queueï¼šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment"> * 2 exchangeï¼šäº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment"> * 3 routing keyï¼šè·¯ç”±é”®ï¼Œç»‘å®šè§„åˆ™</span></span><br><span class="line"><span class="comment"> * å¦‚æœäº¤æ¢æœºç±»å‹ä¸º fanoutï¼Œé‚£ä¹ˆrouting keyè®¾ç½®ä¸º&quot;&quot;</span></span><br><span class="line"><span class="comment"> * è¿™æ ·äº¤æ¢æœºä¼šæŠŠæ¶ˆæ¯å‘ç»™æ‰€æœ‰é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//é˜Ÿåˆ—ä¸€çš„ç»‘å®š</span></span><br><span class="line">channel.queueBind(queue1Name,exchangeName,<span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="comment">//é˜Ÿåˆ—äºŒçš„ç»‘å®šï¼šinfoã€errorå’Œwarning</span></span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;info&quot;</span>);</span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†findAllæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šinfo...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;info&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br><span class="line"><span class="comment">//9 é‡Šæ”¾èµ„æº</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ï¼ŒæŸ¥çœ‹ RabbitMQæ§åˆ¶å°</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321142723.png" alt="image-20210321142722924"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œé˜Ÿåˆ—2æœ‰ä¸€æ¡æ¶ˆæ¯å¾…å‘é€ï¼Œè€Œé˜Ÿåˆ—1æ²¡æœ‰æ¶ˆæ¯ã€‚</p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨çš„ <strong>Routing Key</strong> ä¸ºinfoï¼Œæ•… <strong>Routing Key</strong> ä¸ºerrorçš„é˜Ÿåˆ—æ— æ³•æ”¶åˆ°æ¶ˆæ¯ã€‚</p></blockquote><h3 id="4ã€æ¶ˆè´¹è€…ä»£ç -1"><a href="#4ã€æ¶ˆè´¹è€…ä»£ç -1" class="headerlink" title="4ã€æ¶ˆè´¹è€…ä»£ç "></a>4ã€æ¶ˆè´¹è€…ä»£ç </h3><blockquote><p>è¿™é‡Œåªç»™å‡ºä¿å­˜åˆ°æ¶ˆè´¹è€…1çš„ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"><span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line"><span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"><span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line">String queue1Name = <span class="string">&quot;test_direct_queue1&quot;</span>;</span><br><span class="line">String queue2Name = <span class="string">&quot;test_direct_queue2&quot;</span>;</span><br><span class="line"><span class="comment">//5 æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">        1 queueï¼šé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">        2 autoACKï¼šæ˜¯å¦è‡ªåŠ¨ç¡®è®¤</span></span><br><span class="line"><span class="comment">        3 callbackï¼šå›è°ƒå¯¹è±¡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    è¿™é‡Œçš„DefaultConsumerå¯¹è±¡ä¸ºå›è°ƒå¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">    æˆ‘ä»¬å¯ä»¥é‡å†™å›è°ƒæ–¹æ³•handleDeliveryï¼Œ</span></span><br><span class="line"><span class="comment">    æ”¶åˆ°æ¶ˆæ¯åä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">    1 consumerTagï¼šæ ‡è¯†</span></span><br><span class="line"><span class="comment">    2 envelopeï¼šè·å–ä¿¡æ¯çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¯´äº¤æ¢å™¨ã€è·¯ç”±key</span></span><br><span class="line"><span class="comment">    3 propertiesï¼šé…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    4 bodyï¼šæ•°æ®</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;body:&quot;</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…ä¸€å°†æ—¥å¿—ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“...&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//è¿™é‡Œé˜Ÿåˆ—çš„åç§°å¿…é¡»å’Œç”Ÿäº§è€…åˆ›å»ºçš„é˜Ÿåˆ—åç§°ç›¸åŒ</span></span><br><span class="line">channel.basicConsume(queue1Name,<span class="keyword">true</span>,consumer);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ç›‘å¬</span></span><br></pre></td></tr></table></figure><h3 id="5ã€å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒæŸ¥çœ‹ç»“æœ"><a href="#5ã€å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒæŸ¥çœ‹ç»“æœ" class="headerlink" title="5ã€å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒæŸ¥çœ‹ç»“æœ"></a>5ã€å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼ŒæŸ¥çœ‹ç»“æœ</h3><blockquote><p>å¦‚æœæ­¤æ—¶ç”Ÿäº§è€…å‘é€çš„æ—¥å¿—çº§åˆ«ï¼ˆrouting keyï¼‰ä¸º <strong>info</strong>ï¼Œé‚£ä¹ˆåªæœ‰æ¶ˆè´¹è€…äºŒå¯ä»¥æ¥æ”¶åˆ°æ­¤æ¶ˆæ¯</p><p>å¦‚æœæ­¤æ—¶ç”Ÿäº§è€…å‘é€çš„æ—¥å¿—çº§åˆ«ï¼ˆrouting keyï¼‰ä¸º <strong>error</strong>ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…ä¸€å’Œæ¶ˆè´¹è€…äºŒéƒ½å¯ä»¥æ¥æ”¶åˆ°æ­¤æ¶ˆæ¯</p></blockquote><ul><li>å½“å‘é€çš„æ—¥å¿—çº§åˆ«ï¼ˆrouting keyï¼‰ä¸º <strong>info</strong>æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†findAllæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šinfo...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;info&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br></pre></td></tr></table></figure><blockquote><p>æ¶ˆè´¹è€…ä¸€</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321144244.png" alt="image-20210321144244543"></p><blockquote><p>æ¶ˆè´¹è€…äºŒ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321144325.png" alt="image-20210321144325191"></p><ul><li>å½“ç”Ÿäº§è€…å‘é€çš„æ—¥å¿—çº§åˆ«ï¼ˆrouting key ä¸º <strong>error</strong> æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†batchDeleteæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šerror...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;error&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br></pre></td></tr></table></figure><blockquote><p>æ¶ˆè´¹è€…ä¸€</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321144810.png" alt="image-20210321144809814"></p><blockquote><p>æ¶ˆè´¹è€…äºŒ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321144828.png" alt="image-20210321144827854"></p><h3 id="6ã€å°ç»“-2"><a href="#6ã€å°ç»“-2" class="headerlink" title="6ã€å°ç»“"></a>6ã€å°ç»“</h3><p>Routingæ¨¡å¼è¦æ±‚é˜Ÿåˆ—åœ¨ç»‘å®šäº¤æ¢æœºæ—¶è¦æŒ‡å®šrouting keyï¼Œæ¶ˆæ¯ä¼šè½¬å‘åˆ°ç¬¦åˆrouting keyçš„é˜Ÿåˆ—ã€‚</p><h2 id="4-4ã€Topic-é€šé…ç¬¦æ¨¡å¼"><a href="#4-4ã€Topic-é€šé…ç¬¦æ¨¡å¼" class="headerlink" title="4.4ã€Topic é€šé…ç¬¦æ¨¡å¼"></a>4.4ã€Topic é€šé…ç¬¦æ¨¡å¼</h2><h3 id="1ã€æ¨¡å¼è¯´æ˜-3"><a href="#1ã€æ¨¡å¼è¯´æ˜-3" class="headerlink" title="1ã€æ¨¡å¼è¯´æ˜"></a>1ã€æ¨¡å¼è¯´æ˜</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321145318.png" alt="image-20210321145318552"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321145340.png" alt="image-20210321145340635"></p><blockquote><p>å›¾è§£ï¼š</p></blockquote><ul><li>çº¢è‰²Queueï¼šç»‘å®šçš„æ˜¯ <code>usa.#</code> ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>usa.</code> å¼€å¤´çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…åˆ°</li><li>é»„è‰²Queueï¼šç»‘å®šçš„æ˜¯ <code>#.news</code>ï¼Œå› æ­¤å‡¡æ˜¯ä»¥ <code>.news</code> ç»“å°¾çš„ <code>routing key</code> éƒ½ä¼šè¢«åŒ¹é…</li></ul><blockquote><p>æ‰€ä»¥åœ¨ä¸Šé¢çš„ç¬¬äºŒå¼ å›¾ä¸­ï¼Œ<code>routing key</code> ä¸º <strong>usa.news</strong> çš„æ¶ˆæ¯ä¼šè¢«è½¬å‘åˆ° ç¬¬ä¸€ä¸ªé˜Ÿåˆ—å’Œç¬¬äºŒä¸ªé˜Ÿåˆ—ä¸­ã€‚</p><p><code>routing key</code> ä¸º <strong>usa.weather</strong> çš„æ¶ˆæ¯ä¼šè¢«è½¬å‘åˆ° ç¬¬ä¸€ä¸ªé˜Ÿåˆ—å’Œç¬¬ä¸‰ä¸ªé˜Ÿåˆ—ä¸­ã€‚</p><p><code>routing key</code> ä¸º <strong>europe.news</strong> çš„æ¶ˆæ¯ä¼šè¢«è½¬å‘åˆ° ç¬¬äºŒä¸ªé˜Ÿåˆ—å’Œç¬¬å››ä¸ªé˜Ÿåˆ—ä¸­ã€‚</p><p><code>routing key</code> ä¸º <strong>europe.weather</strong> çš„æ¶ˆæ¯ä¼šè¢«è½¬å‘åˆ° ç¬¬ä¸‰ä¸ªé˜Ÿåˆ—å’Œç¬¬å››ä¸ªé˜Ÿåˆ—ä¸­ã€‚</p></blockquote><ul><li>é€šé…ç¬¦è¯´æ˜</li></ul><blockquote><p>â€œ*â€å¯ä»¥åŒ¹é…ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼ˆä»£æ›¿ä¸€ä¸ªå•è¯ï¼‰</p><p>â€œ#â€å¯ä»¥åŒ¹é…0ä¸ªæˆ–å¤šä¸ªæ ‡è¯†ç¬¦ï¼ˆä»£æ›¿0ä¸ªæˆ–å¤šä¸ªå•è¯ï¼‰</p></blockquote><h3 id="2ã€éœ€æ±‚-2"><a href="#2ã€éœ€æ±‚-2" class="headerlink" title="2ã€éœ€æ±‚"></a>2ã€éœ€æ±‚</h3><blockquote><p>é™¤äº† <strong>error</strong> çº§åˆ«çš„æ—¥å¿—ï¼Œæˆ‘è¿˜å¸Œæœ›å°†è®¢å•ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ—¥å¿—éƒ½è®°å½•åˆ°æ•°æ®åº“ä¸­</p></blockquote><h3 id="3ã€ç”Ÿäº§è€…ä»£ç -1"><a href="#3ã€ç”Ÿäº§è€…ä»£ç -1" class="headerlink" title="3ã€ç”Ÿäº§è€…ä»£ç "></a>3ã€ç”Ÿäº§è€…ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line">factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"><span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line"><span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"><span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line">factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"><span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br><span class="line"><span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line">Channel channel = connection.createChannel();</span><br><span class="line"><span class="comment">//5 åˆ›å»ºäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å‚æ•°è¯´æ˜</span></span><br><span class="line"><span class="comment"> * 1 exchangeï¼šäº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment"> * 2 typeï¼šäº¤æ¢æœºç±»å‹ï¼ˆå»ºè®®ä½¿ç”¨æšä¸¾ç±»å‹ï¼‰</span></span><br><span class="line"><span class="comment"> *  DIRECT(&quot;direct&quot;):å®šå‘</span></span><br><span class="line"><span class="comment"> *  FANOUT(&quot;fanout&quot;):å¹¿æ’­</span></span><br><span class="line"><span class="comment"> *  TOPIC(&quot;topic&quot;):é€šé…ç¬¦æ–¹å¼</span></span><br><span class="line"><span class="comment"> *  HEADERS(&quot;headers&quot;):å‚æ•°åŒ¹é…</span></span><br><span class="line"><span class="comment"> * 3 durableï¼šæ˜¯å¦æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment"> * 4 autoDeleteï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment"> * 5 internalï¼šå†…éƒ¨ä½¿ç”¨ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºfalse</span></span><br><span class="line"><span class="comment"> * 6 argumentsï¼šå‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String exchangeName = <span class="string">&quot;test_topic&quot;</span>;</span><br><span class="line"><span class="comment">//è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªåä¸ºtest_topicçš„äº¤æ¢æœº</span></span><br><span class="line">channel.exchangeDeclare(exchangeName, BuiltinExchangeType.TOPIC,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//6 åˆ›å»ºé˜Ÿåˆ—ï¼Œè¿™é‡Œéœ€è¦åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">String queue1Name = <span class="string">&quot;test_topic_queue1&quot;</span>;</span><br><span class="line">String queue2Name = <span class="string">&quot;test_topic_queue2&quot;</span>;</span><br><span class="line">channel.queueDeclare(queue1Name,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">channel.queueDeclare(queue2Name,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"><span class="comment">//7 ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> * 1 queueï¼šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment"> * 2 exchangeï¼šäº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment"> * 3 routing keyï¼šè·¯ç”±é”®ï¼Œç»‘å®šè§„åˆ™</span></span><br><span class="line"><span class="comment"> * å¦‚æœäº¤æ¢æœºç±»å‹ä¸º fanoutï¼Œé‚£ä¹ˆrouting keyè®¾ç½®ä¸º&quot;&quot;</span></span><br><span class="line"><span class="comment"> * è¿™æ ·äº¤æ¢æœºä¼šæŠŠæ¶ˆæ¯å‘ç»™æ‰€æœ‰é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//é˜Ÿåˆ—ä¸€çš„ç»‘å®šï¼Œç³»ç»Ÿçš„åç§°ï¼Œæ—¥å¿—çš„çº§åˆ«</span></span><br><span class="line"><span class="comment">//éœ€æ±‚ï¼Œæ‰€æœ‰erroræ—¥å¿—å’Œè®¢å•ç³»ç»Ÿçš„æ—¥å¿—éƒ½è®°å½•å…¥æ•°æ®åº“</span></span><br><span class="line">channel.queueBind(queue1Name,exchangeName,<span class="string">&quot;#.error&quot;</span>);</span><br><span class="line">channel.queueBind(queue1Name,exchangeName,<span class="string">&quot;order.*&quot;</span>);</span><br><span class="line"><span class="comment">//é˜Ÿåˆ—äºŒçš„ç»‘å®šï¼šä»€ä¹ˆæ—¥å¿—éƒ½æ‰“å°åˆ°æ§åˆ¶å°</span></span><br><span class="line">channel.queueBind(queue2Name,exchangeName,<span class="string">&quot;*.*&quot;</span>);</span><br><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†batchDeleteæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šerror...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;order.info&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br><span class="line"><span class="comment">//9 é‡Šæ”¾èµ„æº</span></span><br><span class="line">channel.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ç”Ÿäº§è€…ï¼ŒæŸ¥çœ‹RabbitMQæ§åˆ¶å°</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321152030.png" alt="image-20210321152029637"></p><h3 id="4ã€æ¶ˆè´¹è€…ä»£ç -2"><a href="#4ã€æ¶ˆè´¹è€…ä»£ç -2" class="headerlink" title="4ã€æ¶ˆè´¹è€…ä»£ç "></a>4ã€æ¶ˆè´¹è€…ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//1 åˆ›å»ºè¿æ¥å·¥å‚</span></span><br><span class="line"> ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"> <span class="comment">//2 è®¾ç½®å‚æ•°</span></span><br><span class="line"> <span class="comment">//2.1 è®¾ç½®ipåœ°å€ï¼Œé»˜è®¤å€¼ä¸ºlocalhost</span></span><br><span class="line"> factory.setHost(<span class="string">&quot;192.168.56.101&quot;</span>);</span><br><span class="line"> <span class="comment">//2.2 è®¾ç½®ç«¯å£ï¼Œé»˜è®¤å€¼ä¸º5672</span></span><br><span class="line"> factory.setPort(<span class="number">5672</span>);</span><br><span class="line"> <span class="comment">//2.3 è®¾ç½®è™šæ‹Ÿæœºï¼Œé»˜è®¤å€¼ä¸º&quot;/&quot;</span></span><br><span class="line"> factory.setVirtualHost(<span class="string">&quot;/wuhu&quot;</span>);</span><br><span class="line"> <span class="comment">//2.4 è®¾ç½®ç”¨æˆ·ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line"> factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"> <span class="comment">//2.5 è®¾ç½®å¯†ç ï¼Œé»˜è®¤ä¸º guest</span></span><br><span class="line"> factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"> <span class="comment">//3 åˆ›å»ºè¿æ¥</span></span><br><span class="line"> Connection connection = factory.newConnection();</span><br><span class="line"> <span class="comment">//4 åˆ›å»ºChannel</span></span><br><span class="line"> Channel channel = connection.createChannel();</span><br><span class="line"> String queue1Name = <span class="string">&quot;test_topic_queue1&quot;</span>;</span><br><span class="line"> String queue2Name = <span class="string">&quot;test_topic_queue2&quot;</span>;</span><br><span class="line"> <span class="comment">//5 æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">   å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">         1 queueï¼šé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">         2 autoACKï¼šæ˜¯å¦è‡ªåŠ¨ç¡®è®¤</span></span><br><span class="line"><span class="comment">         3 callbackï¼šå›è°ƒå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment">     è¿™é‡Œçš„DefaultConsumerå¯¹è±¡ä¸ºå›è°ƒå¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">     æˆ‘ä»¬å¯ä»¥é‡å†™å›è°ƒæ–¹æ³•handleDeliveryï¼Œ</span></span><br><span class="line"><span class="comment">     æ”¶åˆ°æ¶ˆæ¯åä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">å‚æ•°è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">     1 consumerTagï¼šæ ‡è¯†</span></span><br><span class="line"><span class="comment">     2 envelopeï¼šè·å–ä¿¡æ¯çš„å¯¹è±¡ï¼Œæ¯”å¦‚è¯´äº¤æ¢å™¨ã€è·¯ç”±key</span></span><br><span class="line"><span class="comment">     3 propertiesï¼šé…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     4 bodyï¼šæ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> Consumer consumer = <span class="keyword">new</span> DefaultConsumer(channel) &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;body:&quot;</span> + <span class="keyword">new</span> String(body));</span><br><span class="line">         System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…äºŒå°†æ—¥å¿—ä¿¡æ¯æ‰“å°åˆ°æ§åˆ¶å°...&quot;</span>);</span><br><span class="line">         System.out.println(<span class="string">&quot;----------------------------------------&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"> <span class="comment">//è¿™é‡Œé˜Ÿåˆ—çš„åç§°å¿…é¡»å’Œç”Ÿäº§è€…åˆ›å»ºçš„é˜Ÿåˆ—åç§°ç›¸åŒ</span></span><br><span class="line"> channel.basicConsume(queue2Name,<span class="keyword">true</span>,consumer);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//æ¶ˆè´¹è€…ä¸éœ€è¦å…³é—­èµ„æºï¼Œéœ€è¦ä¸€ç›´ç›‘å¬</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢åªç»™å‡ºæ¶ˆè´¹è€…2çš„ä»£ç </p></blockquote><h3 id="5ã€æµ‹è¯•-2"><a href="#5ã€æµ‹è¯•-2" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><ul><li>å½“ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯çš„ routing key ä¸º order.info æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†batchDeleteæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šerror...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;order.info&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹æ¶ˆè´¹è€…1</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321152858.png" alt="image-20210321152858577"></p><blockquote><p>æ¶ˆè´¹è€…2</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321152917.png" alt="image-20210321152917266"></p><ul><li>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„ routing key ä¸º â€œgoods.infoâ€ æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†batchDeleteæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šerror...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;goods.info&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br></pre></td></tr></table></figure><blockquote><p>æ¶ˆè´¹è€…1</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321153122.png" alt="image-20210321153122385"></p><blockquote><p>æ¶ˆè´¹è€…2</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321153154.png" alt="image-20210321153154041"></p><ul><li>å½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„ routing key ä¸º â€œgoods.errorâ€ æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8 å‘é€æ¶ˆæ¯</span></span><br><span class="line">String data = <span class="string">&quot;æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹:ç”¨æˆ·[å¼ ä¸‰]è°ƒç”¨äº†batchDeleteæ–¹æ³•...æ—¥å¿—çº§åˆ«ï¼šerror...&quot;</span>;</span><br><span class="line">channel.basicPublish(exchangeName,<span class="string">&quot;goods.error&quot;</span>,<span class="keyword">null</span>,data.getBytes());</span><br></pre></td></tr></table></figure><blockquote><p>æ¶ˆè´¹è€…1</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321153255.png" alt="image-20210321153255138"></p><blockquote><p>æ¶ˆè´¹è€…2</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210321153328.png" alt="image-20210321153327988"></p><h3 id="6ã€å°ç»“-3"><a href="#6ã€å°ç»“-3" class="headerlink" title="6ã€å°ç»“"></a>6ã€å°ç»“</h3><blockquote><p>Topicä¸»é¢˜æ¨¡å¼å¯ä»¥å®ç° <code>Publish/Subscribeå‘å¸ƒä¸è®¢é˜…æ¨¡å¼</code> å’Œ <code> Routingè·¯ç”±æ¨¡å¼</code> çš„åŠŸèƒ½ï¼›åªæ˜¯Topicåœ¨é…ç½®routing key çš„æ—¶å€™å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œæ˜¾å¾—æ›´åŠ çµæ´»ã€‚</p></blockquote><h2 id="4-5ã€æ¨¡å¼æ€»ç»“"><a href="#4-5ã€æ¨¡å¼æ€»ç»“" class="headerlink" title="4.5ã€æ¨¡å¼æ€»ç»“"></a>4.5ã€æ¨¡å¼æ€»ç»“</h2><blockquote><p>RabbitMQå·¥ä½œæ¨¡å¼ï¼š</p></blockquote><h3 id="1ã€ç®€å•æ¨¡å¼"><a href="#1ã€ç®€å•æ¨¡å¼" class="headerlink" title="1ã€ç®€å•æ¨¡å¼"></a>1ã€ç®€å•æ¨¡å¼</h3><blockquote><p>ä¸€ä¸ªç”Ÿäº§è€…ã€ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰</p></blockquote><h3 id="2ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"><a href="#2ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼" class="headerlink" title="2ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"></a>2ã€å·¥ä½œé˜Ÿåˆ—æ¨¡å¼</h3><blockquote><p>ä¸€ä¸ªç”Ÿäº§è€…ã€å¤šä¸ªæ¶ˆè´¹è€…ï¼ˆç«äº‰å…³ç³»ï¼‰ï¼Œä¸éœ€è¦è®¾ç½®äº¤æ¢æœºï¼ˆä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼‰</p></blockquote><h3 id="3ã€å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#3ã€å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="3ã€å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>3ã€å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><blockquote><p>éœ€è¦è®¾ç½®ç±»å‹ä¸ºfanoutçš„äº¤æ¢æœºï¼Œå¹¶ä¸”äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šå°†æ¶ˆæ¯å‘é€åˆ°ç»‘å®šçš„é˜Ÿåˆ—</p></blockquote><h3 id="4ã€è·¯ç”±æ¨¡å¼"><a href="#4ã€è·¯ç”±æ¨¡å¼" class="headerlink" title="4ã€è·¯ç”±æ¨¡å¼"></a>4ã€è·¯ç”±æ¨¡å¼</h3><blockquote><p>éœ€è¦è®¾ç½®ç±»å‹ä¸ºdirectçš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šrouting keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ®routing keyå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—</p></blockquote><h3 id="5ã€é€šé…ç¬¦æ¨¡å¼"><a href="#5ã€é€šé…ç¬¦æ¨¡å¼" class="headerlink" title="5ã€é€šé…ç¬¦æ¨¡å¼"></a>5ã€é€šé…ç¬¦æ¨¡å¼</h3><blockquote><p>éœ€è¦è®¾ç½®ç±»å‹ä¸ºtopicçš„äº¤æ¢æœºï¼Œäº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®šï¼Œå¹¶ä¸”æŒ‡å®šé€šé…ç¬¦æ–¹å¼çš„routing keyï¼Œå½“å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºåï¼Œäº¤æ¢æœºä¼šæ ¹æ®routing keyå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„é˜Ÿåˆ—</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ¡†æ¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ğŸ“«æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåº”ç”¨å­¦ä¹ ï¼ˆå››ï¼‰-Mybatisæ¡†æ¶å®ç°ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤š</title>
      <link href="posts/718443640.html"/>
      <url>posts/718443640.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€å‡†å¤‡å·¥ä½œ"><a href="#1ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h2><h3 id="1-1ã€å‡†å¤‡æ•°æ®åº“è¡¨"><a href="#1-1ã€å‡†å¤‡æ•°æ®åº“è¡¨" class="headerlink" title="1.1ã€å‡†å¤‡æ•°æ®åº“è¡¨"></a>1.1ã€å‡†å¤‡æ•°æ®åº“è¡¨</h3><blockquote><p>æˆ‘ä»¬éœ€è¦å‡†å¤‡äº”å¼ è¡¨ï¼Œåˆ†åˆ«ä¸º å­¦ç”Ÿè¡¨ <code>edu_student</code>ï¼Œ è¯¾ç¨‹è¡¨ <code>edu_course</code> ï¼Œä¸“ä¸šè¡¨ <code>edu_profession</code> ã€ é€‰è¯¾è¡¨ <code>edu_select_course</code> å’Œ èº«ä»½å¡è¡¨ <code>edu_card</code></p><p>å…¶ä¸­ï¼Œå­¦ç”Ÿä¸èº«ä»½å¡ä¸ºä¸€å¯¹ä¸€å…³ç³»ï¼Œå­¦ç”Ÿä¸è¯¾ç¨‹è¡¨ä¸ºå¤šå¯¹å¤šæ˜ å°„å…³ç³»ï¼Œé€‰è¯¾è¡¨ä¸ºè´Ÿè´£è®©å­¦ç”Ÿè¡¨ä¸è¯¾ç¨‹è¡¨å»ºç«‹å…³ç³»ï¼Œå­¦ç”Ÿä¸ä¸“ä¸šè¡¨ä¸ºå¤šå¯¹ä¸€æ˜ å°„å…³ç³»ã€‚</p></blockquote><ul><li>å­¦ç”Ÿè¡¨ <code>edu_student</code> </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">create table edu_student</span><br><span class="line">(</span><br><span class="line">    student_id    char(19)     not null comment &#39;å­¦ç”Ÿid</span><br><span class="line">&#39;</span><br><span class="line">        primary key,</span><br><span class="line">    name          varchar(200) not null comment &#39;å­¦ç”Ÿå§“å&#39;,</span><br><span class="line">    card_id       char(19)     null comment &#39;å­¦ç”Ÿå¡id&#39;,</span><br><span class="line">    profession_id char(19)     null comment &#39;ä¸“ä¸šid&#39;</span><br><span class="line">) comment &#39;å­¦ç”Ÿè¡¨&#39;;</span><br><span class="line"></span><br><span class="line">INSERT INTO mybatis_exercise.edu_student (student_id, name, card_id, profession_id) VALUES (&#39;1&#39;, &#39;A&#39;, &#39;1&#39;, &#39;1&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_student (student_id, name, card_id, profession_id) VALUES (&#39;2&#39;, &#39;B&#39;, &#39;2&#39;, &#39;1&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_student (student_id, name, card_id, profession_id) VALUES (&#39;3&#39;, &#39;C&#39;, &#39;3&#39;, &#39;2&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_student (student_id, name, card_id, profession_id) VALUES (&#39;4&#39;, &#39;D&#39;, &#39;4&#39;, &#39;3&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_student (student_id, name, card_id, profession_id) VALUES (&#39;5&#39;, &#39;E&#39;, &#39;5&#39;, &#39;2&#39;);</span><br></pre></td></tr></table></figure><ul><li>è¯¾ç¨‹è¡¨ <code>edu_course</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create table edu_course</span><br><span class="line">(</span><br><span class="line">    course_id   char(19)     not null comment &#39;è¯¾ç¨‹id&#39;</span><br><span class="line">        primary key,</span><br><span class="line">    course_name varchar(500) null comment &#39;è¯¾ç¨‹å&#39;</span><br><span class="line">) comment &#39;è¯¾ç¨‹è¡¨&#39;;</span><br><span class="line"></span><br><span class="line">INSERT INTO mybatis_exercise.edu_course (course_id, course_name) VALUES (&#39;1&#39;, &#39;è¿ç­¹å­¦&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_course (course_id, course_name) VALUES (&#39;2&#39;, &#39;Java&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_course (course_id, course_name) VALUES (&#39;3&#39;, &#39;æ•°æ®åº“&#39;);</span><br></pre></td></tr></table></figure><ul><li>é€‰è¯¾è¡¨ <code>edu_select_course</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create table edu_select_course</span><br><span class="line">(</span><br><span class="line">    sc_id      char(19) not null comment &#39;é€‰è¯¾è¡¨id&#39;</span><br><span class="line">        primary key,</span><br><span class="line">    course_id  char(19) null comment &#39;è¯¾ç¨‹id&#39;,</span><br><span class="line">    student_id char(19) null comment &#39;å­¦ç”Ÿid&#39;,</span><br><span class="line">    score      double   null comment &#39;æˆç»©&#39;</span><br><span class="line">) comment &#39;é€‰è¯¾è¡¨&#39;;</span><br><span class="line"></span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;1&#39;, &#39;1&#39;, &#39;1&#39;, 80);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;2&#39;, &#39;1&#39;, &#39;2&#39;, 85);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;3&#39;, &#39;1&#39;, &#39;3&#39;, 85);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;4&#39;, &#39;2&#39;, &#39;1&#39;, 70);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;5&#39;, &#39;3&#39;, &#39;1&#39;, 60);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;6&#39;, &#39;2&#39;, &#39;2&#39;, 60);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;7&#39;, &#39;2&#39;, &#39;3&#39;, 70);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_select_course (sc_id, course_id, student_id, score) VALUES (&#39;8&#39;, &#39;3&#39;, &#39;3&#39;, 90);</span><br></pre></td></tr></table></figure><ul><li>ä¸“ä¸šè¡¨ <code>edu_profession</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table edu_profession</span><br><span class="line">(</span><br><span class="line">    profession_id   char(19)    not null comment &#39;ä¸“ä¸šid&#39;</span><br><span class="line">        primary key,</span><br><span class="line">    profession_name varchar(50) null comment &#39;ä¸“ä¸šåç§°&#39;</span><br><span class="line">) comment &#39;ä¸“ä¸šè¡¨&#39;;</span><br><span class="line">INSERT INTO mybatis_exercise.edu_profession (profession_id, profession_name) VALUES (&#39;1&#39;, &#39;ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_profession (profession_id, profession_name) VALUES (&#39;2&#39;, &#39;æ•°å­¦ä¸åº”ç”¨æ•°å­¦&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_profession (profession_id, profession_name) VALUES (&#39;3&#39;, &#39;åº”ç”¨ç»Ÿè®¡å­¦&#39;);</span><br></pre></td></tr></table></figure><ul><li>èº«ä»½å¡è¡¨ <code>edu_card</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table edu_card</span><br><span class="line">(</span><br><span class="line">    card_id char(19)     not null comment &#39;å­¦ç”Ÿå¡id&#39;</span><br><span class="line">        primary key,</span><br><span class="line">    info    varchar(500) null comment &#39;å­¦ç”Ÿä¿¡æ¯&#39;</span><br><span class="line">) comment &#39;idå¡è¡¨&#39;;</span><br><span class="line"></span><br><span class="line">INSERT INTO mybatis_exercise.edu_card (card_id, info) VALUES (&#39;1&#39;, &#39;è¿™æ˜¯ä¸€å·å¡&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_card (card_id, info) VALUES (&#39;2&#39;, &#39;è¿™æ˜¯äºŒå·å¡&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_card (card_id, info) VALUES (&#39;3&#39;, &#39;è¿™æ˜¯ä¸‰å·å¡&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_card (card_id, info) VALUES (&#39;4&#39;, &#39;è¿™æ˜¯å››å·å¡&#39;);</span><br><span class="line">INSERT INTO mybatis_exercise.edu_card (card_id, info) VALUES (&#39;5&#39;, &#39;è¿™æ˜¯äº”å·å¡&#39;);</span><br></pre></td></tr></table></figure><h3 id="1-2ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹"><a href="#1-2ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹" class="headerlink" title="1.2ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹"></a>1.2ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹</h3><blockquote><p>æˆ‘ä»¬ä½¿ç”¨ Spring Boot + <code>Mybatis-plus</code> æ¥å¿«é€Ÿæ­å»ºæœ¬æ¬¡å­¦ä¹ æ‰€éœ€é¡¹ç›®</p></blockquote><ul><li>ä½¿ç”¨<code>Spring Initializr</code> å¿«é€Ÿæ„å»ºSpring Booté¡¹ç›®</li><li>pom.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">velocity.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">velocity.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springBoot.version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">springBoot.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springBoot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- velocity æ¨¡æ¿å¼•æ“, Mybatis Plus ä»£ç ç”Ÿæˆå™¨éœ€è¦ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;velocity.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- org.apache.commons.lang3.StringUtils --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springBoot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥ä¸‹é¢çš„ä»£ç ï¼Œå°†javaåŒ…ä¸‹çš„xxxMapper.xmlæ–‡ä»¶ä¹Ÿç¼–è¯‘è¿›é¡¹ç›®ä¸­</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">addResources</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addResources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span> <span class="comment">&lt;!--å°†mapperæ–‡ä»¶æ‰“åŒ…è¿›å»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span> <span class="comment">&lt;!--æŒ‡å®šæ ¹ç›®å½• åˆ°æºæ–‡ä»¶å¤¹ ä¸€èˆ¬å¦‚ä¸‹--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.yaml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span> <span class="comment">&lt;!--æŒ‡å®šæ ¹ç›®å½• åˆ°æºæ–‡ä»¶å¤¹ ä¸€èˆ¬å¦‚ä¸‹--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.yaml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>test</code> åŒ…ä¸‹ä½¿ç”¨<code>Mybatis-Plus</code>çš„ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆcontrollerã€serviceã€mapperå’Œentity</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">genCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String moduleName = <span class="string">&quot;edu&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨</span></span><br><span class="line">        AutoGenerator mpg = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2ã€å…¨å±€é…ç½®</span></span><br><span class="line">        GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">        String projectPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        gc.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;five&quot;</span>);</span><br><span class="line">        gc.setOpen(<span class="keyword">false</span>); <span class="comment">//ç”Ÿæˆåæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨</span></span><br><span class="line"><span class="comment">//        gc.setFileOverride(false); //é‡æ–°ç”Ÿæˆæ—¶æ–‡ä»¶æ˜¯å¦è¦†ç›–</span></span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);<span class="comment">//å»æ‰Serviceæ¥å£çš„é¦–å­—æ¯I</span></span><br><span class="line">        gc.setIdType(IdType.ASSIGN_ID); <span class="comment">//ä¸»é”®ç­–ç•¥</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);<span class="comment">//å®šä¹‰ç”Ÿæˆçš„å®ä½“ç±»ä¸­æ—¥æœŸç±»å‹</span></span><br><span class="line">        gc.setSwagger2(<span class="keyword">true</span>);<span class="comment">//å¼€å¯Swagger2æ¨¡å¼</span></span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3ã€æ•°æ®æºé…ç½®</span></span><br><span class="line">        DataSourceConfig dsc = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis_exercise?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;tianxin1230.&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4ã€åŒ…é…ç½®</span></span><br><span class="line">        PackageConfig pc = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">        pc.setModuleName(moduleName); <span class="comment">//æ¨¡å—å</span></span><br><span class="line">        pc.setParent(<span class="string">&quot;com.five.wuhu&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5ã€ç­–ç•¥é…ç½®</span></span><br><span class="line">        StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);<span class="comment">//æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span></span><br><span class="line">        strategy.setTablePrefix(moduleName + <span class="string">&quot;_&quot;</span>);<span class="comment">//è®¾ç½®è¡¨å‰ç¼€ä¸ç”Ÿæˆ</span></span><br><span class="line"></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);<span class="comment">//æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="keyword">true</span>); <span class="comment">// lombok æ¨¡å‹ @Accessors(chain = true) setteré“¾å¼æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">        strategy.setRestControllerStyle(<span class="keyword">true</span>); <span class="comment">//restful apié£æ ¼æ§åˆ¶å™¨</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>); <span class="comment">//urlä¸­é©¼å³°è½¬è¿å­—ç¬¦</span></span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6ã€æ‰§è¡Œ</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œä»£ç ç”Ÿæˆå™¨ä¸­çš„ä»£ç ï¼Œç”Ÿæˆé¡¹ç›®ç»“æ„å¦‚ä¸‹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320152017.png" alt="image-20210320152016401"></p><h3 id="1-3ã€æ·»åŠ ä¸»å¯åŠ¨ç±»"><a href="#1-3ã€æ·»åŠ ä¸»å¯åŠ¨ç±»" class="headerlink" title="1.3ã€æ·»åŠ ä¸»å¯åŠ¨ç±»"></a>1.3ã€æ·»åŠ ä¸»å¯åŠ¨ç±»</h3><blockquote><p>åœ¨ä¸»å¯åŠ¨ç±»ä¸­æŒ‡å®š Mapper æ¥å£å­˜æ”¾çš„æ–‡ä»¶å¤¹ï¼Œå¹¶è¿›è¡ŒåŒ…æ‰«æ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &quot;com.five.wuhu&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.five.wuhu.edu.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EMSApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EMSApplication.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost:8080/swagger-ui/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4ã€é…ç½®Swagger"><a href="#1-4ã€é…ç½®Swagger" class="headerlink" title="1.4ã€é…ç½®Swagger"></a>1.4ã€é…ç½®Swagger</h3><blockquote><p>åœ¨configåŒ…ä¸‹åˆ›å»º <code>SwaggerConfiguration</code> ç±»ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">webApiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;ç½‘ç«™-APIæ–‡æ¡£&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;æœ¬æ–‡æ¡£æè¿°äº†ç½‘ç«™å¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;è”¡å¤§å¤´&quot;</span>, <span class="string">&quot;http://wuhu.com&quot;</span>, <span class="string">&quot;763882220@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">adminApiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;åå°ç®¡ç†ç³»ç»Ÿ-APIæ–‡æ¡£&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;æœ¬æ–‡æ¡£æè¿°äº†åå°ç®¡ç†ç³»ç»Ÿå¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;è”¡å¤§å¤´&quot;</span>, <span class="string">&quot;http://wuhu.com&quot;</span>, <span class="string">&quot;763882220@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5ã€åˆ›å»ºé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨æµ‹è¯•"><a href="#1-5ã€åˆ›å»ºé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨æµ‹è¯•" class="headerlink" title="1.5ã€åˆ›å»ºé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨æµ‹è¯•"></a>1.5ã€åˆ›å»ºé…ç½®æ–‡ä»¶å¹¶å¯åŠ¨æµ‹è¯•</h3><ul><li>åœ¨ <code>resource</code> ç›®å½•ä¸‹åˆ›å»º <code>application.yml</code> é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹é…ç½®</li></ul><blockquote><p>è¿™é‡Œéœ€è¦æ ¹æ®ä½ çš„ç¯å¢ƒè¿›è¡Œä¿®æ”¹</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis_exercise?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">tianxin1230.</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line"><span class="comment"># æ‰“å°sqlè¯­å¥</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-column-underline:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:com/five/wuhu/edu/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨æµ‹è¯•</li></ul><blockquote><p>å¯åŠ¨ç¨‹åºå è®¿é—® <a href="http://localhost:8080/swagger-ui/">http://localhost:8080/swagger-ui/</a> ï¼Œå¦‚æœå‡ºç°ä»¥ä¸‹æƒ…å†µè¯æ˜é¡¹ç›®ç¯å¢ƒæ­å»ºå®Œæˆ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320152332.png" alt="image-20210320152332311"></p><h2 id="2ã€æ˜ å°„æµ‹è¯•"><a href="#2ã€æ˜ å°„æµ‹è¯•" class="headerlink" title="2ã€æ˜ å°„æµ‹è¯•"></a>2ã€æ˜ å°„æµ‹è¯•</h2><h3 id="2-1ã€ä½¿ç”¨Mybatisè¿›è¡Œä¸€å¯¹ä¸€æ˜ å°„"><a href="#2-1ã€ä½¿ç”¨Mybatisè¿›è¡Œä¸€å¯¹ä¸€æ˜ å°„" class="headerlink" title="2.1ã€ä½¿ç”¨Mybatisè¿›è¡Œä¸€å¯¹ä¸€æ˜ å°„"></a>2.1ã€ä½¿ç”¨<code>Mybatis</code>è¿›è¡Œä¸€å¯¹ä¸€æ˜ å°„</h3><ul><li>åœ¨ <code>StudentController</code> ç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›æ‰€æœ‰å­¦ç”Ÿä»¥åŠæ¯ä¸ªå­¦ç”Ÿå¯¹åº”çš„idå¡ä¿¡æ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å­¦ç”Ÿæ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/edu/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentService studentService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;getAllStudentAndCardInfo&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è·å–æ‰€æœ‰å­¦ç”Ÿä¿¡æ¯åŠå¯¹åº”å¡ä¿¡æ¯ï¼Œä¸€å¯¹ä¸€&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">getAllStudentAndCardInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;StudentCardVo&gt; studentCardVos = studentService.getAllStudentAndCardInfo();</span><br><span class="line">        <span class="keyword">return</span> Result.ok().data(<span class="string">&quot;items&quot;</span>,studentCardVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªvoç±»ï¼Œè¿™ä¸ªç±»å°è£…äº†å­¦ç”Ÿä»¥åŠå¯¹åº”idå¡ä¿¡æ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentCardVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String studentId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Card card;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>serviceå±‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">StudentMapper</span>, <span class="title">Student</span>&gt; <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;StudentCardVo&gt; <span class="title">getAllStudentAndCardInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.getAllStudentAndCardInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Mapperæ¥å£å±‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Student</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;StudentCardVo&gt; <span class="title">getAllStudentAndCardInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Mapperæ–‡ä»¶å±‚</li></ul><blockquote><p>åœ¨ä¸€å¯¹ä¸€ä¸­ï¼Œé™„å¸¦çš„â€œä¸€â€ä½¿ç”¨<code>association</code>æ ‡ç­¾è¿›è¡Œä¿®é¥°</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.five.wuhu.edu.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentCardVo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.five.wuhu.edu.entity.vo.StudentCardVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;card&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.Card&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cardId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;card_id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;info&quot;</span> <span class="attr">column</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllStudentAndCardInfo&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentCardVo&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            s.student_id,</span><br><span class="line">            s.name as name,</span><br><span class="line">            c.info,</span><br><span class="line">            c.card_id</span><br><span class="line">        from</span><br><span class="line">            `mybatis_exercise`.edu_student as s</span><br><span class="line">        inner join</span><br><span class="line">            `mybatis_exercise`.edu_card as c</span><br><span class="line">        on</span><br><span class="line">            s.card_id = c.card_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>Swagger</code> è¿›è¡Œæµ‹è¯•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320153538.png" alt="image-20210320153537831"></p><ul><li>æµ‹è¯•ç»“æœ</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;items&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯ä¸€å·å¡&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯äºŒå·å¡&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯ä¸‰å·å¡&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;D&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯å››å·å¡&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;E&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯äº”å·å¡&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2ã€ä½¿ç”¨Mybatisè¿›è¡Œä¸€å¯¹å¤šæµ‹è¯•"><a href="#2-2ã€ä½¿ç”¨Mybatisè¿›è¡Œä¸€å¯¹å¤šæµ‹è¯•" class="headerlink" title="2.2ã€ä½¿ç”¨Mybatisè¿›è¡Œä¸€å¯¹å¤šæµ‹è¯•"></a>2.2ã€ä½¿ç”¨<code>Mybatis</code>è¿›è¡Œä¸€å¯¹å¤šæµ‹è¯•</h3><blockquote><p>æŸ¥çœ‹ä¸€ä¸ªä¸“ä¸šä¸‹çš„æ‰€æœ‰å­¦ç”Ÿ</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªvoç±»</li></ul><blockquote><p>æ³¨æ„ï¼Œè¿™é‡Œçš„æ³›å‹æ˜¯ <code>StudentCardVo</code> è€Œä¸æ˜¯Studentï¼Œè¿™æ˜¯å› ä¸ºé™¤äº†ä¸“ä¸š-å­¦ç”Ÿè¿™ä¸€æ˜ å°„å¤–ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›æ·»åŠ å­¦ç”Ÿ-idå¡è¿™ä¸€æ˜ å°„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProfessionStudentVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String professionId;</span><br><span class="line">    <span class="keyword">private</span> String professionName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;StudentCardVo&gt; studentCardVos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;ä¸“ä¸šæ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/edu/profession&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProfessionController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProfessionService professionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getAllProfessionAndStudents&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢å…¨éƒ¨ä¸“ä¸šåŠä¸“ä¸šä¸‹çš„æ‰€æœ‰å­¦ç”Ÿï¼Œä¸€å¯¹å¤š&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">getAllProfessionAndStudents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;ProfessionStudentVo&gt; professionStudentVos = professionService.getAllProfessionAndStudents();</span><br><span class="line">        <span class="keyword">return</span> Result.ok().data(<span class="string">&quot;items&quot;</span>,professionStudentVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºServiceå±‚åªæ˜¯ç®€å•è°ƒç”¨Mapperå±‚çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¿½ç•¥Serviceå±‚çš„ä»£ç </p></blockquote><ul><li>Mapperæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProfessionMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Profession</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;ProfessionStudentVo&gt; <span class="title">getAllProfessionAndStudents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Mapperæ–‡ä»¶</li></ul><blockquote><p>åœ¨ä¸€å¯¹å¤šæ˜ å°„ä¸­ï¼Œâ€œå¤šâ€çš„ä¸€æ–¹ä½¿ç”¨ collection æ ‡ç­¾è¡¨ç¤ºï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä½¿ç”¨<code>ofType</code>æŒ‡å®šé›†åˆä¸­å­˜æ”¾çš„å®ä½“ç±»å‹ï¼Œè¿™é‡Œ <code>ProfessionStudentVo</code> ä¸­çš„Listå­˜æ”¾çš„ç±»å‹ä¸º <code>StudentCardVo</code>ï¼Œæ•… <code>ofType</code> ä¸º <code>StudentCardVo</code></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.five.wuhu.edu.mapper.ProfessionMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;professionStudentVo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.five.wuhu.edu.entity.vo.ProfessionStudentVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;professionId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;profession_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;professionName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;profession_name&quot;</span> /&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;studentCardVos&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.vo.StudentCardVo&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;card&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.Card&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cardId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;card_id&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;info&quot;</span> <span class="attr">column</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllProfessionAndStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;professionStudentVo&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            s.student_id,</span><br><span class="line">            s.name,</span><br><span class="line">            p.profession_id,</span><br><span class="line">            p.profession_name,</span><br><span class="line">            c.card_id,</span><br><span class="line">            c.info</span><br><span class="line">        from</span><br><span class="line">            `mybatis_exercise`.`edu_student` as s</span><br><span class="line">        inner join</span><br><span class="line">            `mybatis_exercise`.`edu_profession` as p</span><br><span class="line">        on</span><br><span class="line">            s.profession_id = p.profession_id</span><br><span class="line">        inner join</span><br><span class="line">            `mybatis_exercise`.`edu_card` as c</span><br><span class="line">        on</span><br><span class="line">            c.card_id = s.card_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320154353.png" alt="image-20210320154353217"></p><ul><li>æµ‹è¯•ç»“æœ</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;items&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;studentCardVos&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯ä¸€å·å¡&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯äºŒå·å¡&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;æ•°å­¦ä¸åº”ç”¨æ•°å­¦&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;studentCardVos&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯ä¸‰å·å¡&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;E&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯äº”å·å¡&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;åº”ç”¨ç»Ÿè®¡å­¦&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;studentCardVos&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;D&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯å››å·å¡&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3ã€ä½¿ç”¨Mybatisè¿›è¡Œå¤šå¯¹å¤šæ˜ å°„"><a href="#2-3ã€ä½¿ç”¨Mybatisè¿›è¡Œå¤šå¯¹å¤šæ˜ å°„" class="headerlink" title="2.3ã€ä½¿ç”¨Mybatisè¿›è¡Œå¤šå¯¹å¤šæ˜ å°„"></a>2.3ã€ä½¿ç”¨<code>Mybatis</code>è¿›è¡Œå¤šå¯¹å¤šæ˜ å°„</h3><h4 id="1ã€æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå’Œä»–é€‰çš„æ‰€æœ‰è¯¾ç¨‹ä¿¡æ¯"><a href="#1ã€æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå’Œä»–é€‰çš„æ‰€æœ‰è¯¾ç¨‹ä¿¡æ¯" class="headerlink" title="1ã€æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå’Œä»–é€‰çš„æ‰€æœ‰è¯¾ç¨‹ä¿¡æ¯"></a>1ã€æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå’Œä»–é€‰çš„æ‰€æœ‰è¯¾ç¨‹ä¿¡æ¯</h4><blockquote><p>åˆ›å»ºä¸€ä¸ª vo å®ä½“ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentCourseVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String studentId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Course&gt; courses;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å­¦ç”Ÿæ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/edu/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentService studentService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;getAllCourse&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿå’Œé€‰æ‹©çš„è¯¾&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">getAllStudentAndCourse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;StudentCourseVo&gt; studentCourseVos = studentService.getAllStudentAndCourse();</span><br><span class="line">        <span class="keyword">return</span> Result.ok().data(<span class="string">&quot;items&quot;</span>,studentCourseVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Mapperæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Student</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;StudentCourseVo&gt; <span class="title">getAllStudentAndCourse</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Mapperæ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.five.wuhu.edu.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentCourseVo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.five.wuhu.edu.entity.vo.StudentCourseVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span>  <span class="attr">ofType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.Course&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;courseName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllStudentAndCourse&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentCourseVo&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            s.student_id,</span><br><span class="line">            s.name,</span><br><span class="line">            c.course_id,</span><br><span class="line">            c.course_name</span><br><span class="line">        from</span><br><span class="line">            `mybatis_exercise`.edu_student as s</span><br><span class="line">        inner join</span><br><span class="line">            `mybatis_exercise`.edu_select_course as sc</span><br><span class="line">        on</span><br><span class="line">            s.student_id = sc.student_id</span><br><span class="line">        inner join</span><br><span class="line">            `mybatis_exercise`.edu_course as c</span><br><span class="line">        on</span><br><span class="line">            sc.course_id = c.course_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•ç»“æœ</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;items&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;è¿ç­¹å­¦&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;Java&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;æ•°æ®åº“&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;è¿ç­¹å­¦&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;Java&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;è¿ç­¹å­¦&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;Java&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;æ•°æ®åº“&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ã€æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹åŠé€‰è¿™é—¨è¯¾ç¨‹çš„æ‰€æœ‰å­¦ç”Ÿä¿¡æ¯"><a href="#2ã€æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹åŠé€‰è¿™é—¨è¯¾ç¨‹çš„æ‰€æœ‰å­¦ç”Ÿä¿¡æ¯" class="headerlink" title="2ã€æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹åŠé€‰è¿™é—¨è¯¾ç¨‹çš„æ‰€æœ‰å­¦ç”Ÿä¿¡æ¯"></a>2ã€æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹åŠé€‰è¿™é—¨è¯¾ç¨‹çš„æ‰€æœ‰å­¦ç”Ÿä¿¡æ¯</h4><blockquote><p>åˆ›å»ºä¸€ä¸ª vo ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseStudentVo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String courseId;</span><br><span class="line">    <span class="keyword">private</span> String courseName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; students;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;è¯¾ç¨‹æ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/edu/course&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CourseService courseService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è·å–å…¨éƒ¨è¯¾ç¨‹åŠé€‰æ‹©æ­¤è¯¾ç¨‹çš„å­¦ç”Ÿ&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getAllCoursesAndStudents&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">getAllCoursesAndStudents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;CourseStudentVo&gt; courseStudentVos = courseService.getAllCoursesAndStudents();</span><br><span class="line">        <span class="keyword">return</span> Result.ok().data(<span class="string">&quot;items&quot;</span>,courseStudentVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Mapperæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Course</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;CourseStudentVo&gt; <span class="title">getAllCoursesAndStudents</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Mapperæ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.five.wuhu.edu.mapper.CourseMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;courseStudentVo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.five.wuhu.edu.entity.vo.CourseStudentVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;courseName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.Student&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllCoursesAndStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;courseStudentVo&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            s.student_id,</span><br><span class="line">            s.name,</span><br><span class="line">            c.course_id,</span><br><span class="line">            c.course_name</span><br><span class="line">        from</span><br><span class="line">            `mybatis_exercise`.edu_student as s</span><br><span class="line">        inner join</span><br><span class="line">            `mybatis_exercise`.edu_select_course as sc</span><br><span class="line">        on</span><br><span class="line">            s.student_id = sc.student_id</span><br><span class="line">        inner join</span><br><span class="line">            `mybatis_exercise`.edu_course as c</span><br><span class="line">        on</span><br><span class="line">            sc.course_id = c.course_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•ç»“æœ</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;items&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;è¿ç­¹å­¦&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;students&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;students&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;æ•°æ®åº“&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;students&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;cardId&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;professionId&quot;</span>: <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€ç»¼åˆæµ‹è¯•"><a href="#3ã€ç»¼åˆæµ‹è¯•" class="headerlink" title="3ã€ç»¼åˆæµ‹è¯•"></a>3ã€ç»¼åˆæµ‹è¯•</h2><blockquote><p>æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>id</code> å¡ä¿¡æ¯ã€æ‰€åœ¨ä¸“ä¸šå’Œé€‰ä¿®çš„æ‰€æœ‰è¯¾ç¨‹ä¿¡æ¯</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ª vo ç±»ï¼Œç”¨äºå±•ç¤ºæ‰€æœ‰ä¿¡æ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentInfoVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String studentId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String cardInfo;</span><br><span class="line">    <span class="keyword">private</span> String professionName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Course&gt; courses;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;å­¦ç”Ÿæ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/edu/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentService studentService;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;getInfo&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è·å–å…¨éƒ¨å­¦ç”Ÿçš„è¯¦ç»†ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;StudentInfoVo&gt; studentInfoVos = studentService.getInfo();</span><br><span class="line">        <span class="keyword">return</span> Result.ok().data(<span class="string">&quot;items&quot;</span>,studentInfoVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mapperæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Student</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;StudentInfoVo&gt; <span class="title">getInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>mapperæ–‡ä»¶</li></ul><blockquote><p>å¯¹äºå¤šå¯¹ä¸€ä¸­çš„ä¸€ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ association æ ‡ç­¾è¿›è¡Œå…³è”ã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.five.wuhu.edu.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentInfoVo&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.five.wuhu.edu.entity.vo.StudentInfoVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;card&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.Card&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;cardId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;card_id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;info&quot;</span> <span class="attr">column</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;profession&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.Profession&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;professionId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;profession_id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;professionName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;profession_name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.five.wuhu.edu.entity.Course&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;courseId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;courseName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;course_name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getInfo&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentInfoVo&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            s.student_id,</span><br><span class="line">            s.name,</span><br><span class="line">            p.profession_id,</span><br><span class="line">            p.profession_name,</span><br><span class="line">            card.card_id,</span><br><span class="line">            card.info,</span><br><span class="line">            c.course_id,</span><br><span class="line">            c.course_name</span><br><span class="line">        from</span><br><span class="line">            `mybatis_exercise`.edu_student as s</span><br><span class="line">        left join</span><br><span class="line">            `mybatis_exercise`.edu_card as card</span><br><span class="line">        on</span><br><span class="line">            s.card_id = card.card_id</span><br><span class="line">        left join</span><br><span class="line">            `mybatis_exercise`.edu_profession as p</span><br><span class="line">        on</span><br><span class="line">            p.profession_id = s.profession_id</span><br><span class="line">        left join</span><br><span class="line">            `mybatis_exercise`.edu_select_course as sc</span><br><span class="line">        on</span><br><span class="line">            sc.student_id = s.student_id</span><br><span class="line">        left join</span><br><span class="line">            `mybatis_exercise`.edu_course as c</span><br><span class="line">        on</span><br><span class="line">            sc.course_id = c.course_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•ç»“æœ</li></ul><blockquote><p>ä¸Šé¢ä½¿ç”¨ <code>left join</code> è¿æ¥è¡¨ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°æ‰€æœ‰å­¦ç”Ÿã€‚</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;items&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;A&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯ä¸€å·å¡&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;profession&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;è¿ç­¹å­¦&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;Java&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;æ•°æ®åº“&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;B&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯äºŒå·å¡&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;profession&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;è¿ç­¹å­¦&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;Java&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;C&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯ä¸‰å·å¡&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;profession&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;æ•°å­¦ä¸åº”ç”¨æ•°å­¦&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;è¿ç­¹å­¦&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;Java&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;courseId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;courseName&quot;</span>: <span class="string">&quot;æ•°æ®åº“&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;D&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;4&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯å››å·å¡&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;profession&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;åº”ç”¨ç»Ÿè®¡å­¦&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: []</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;studentId&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;E&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;card&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;cardId&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;è¿™æ˜¯äº”å·å¡&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;profession&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;professionId&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;professionName&quot;</span>: <span class="string">&quot;æ•°å­¦ä¸åº”ç”¨æ•°å­¦&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;courses&quot;</span>: []</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€æºç ä¸‹è½½"><a href="#4ã€æºç ä¸‹è½½" class="headerlink" title="4ã€æºç ä¸‹è½½"></a>4ã€æºç ä¸‹è½½</h2><blockquote><p>å¯†ç ï¼š7hx7</p></blockquote><div class="btns rounded grid5">            <a class="button" href='https://wws.lanzous.com/b025zf0dg' title='èµ„æºä¸‹è½½'><i class='fas fa-download'></i>èµ„æºä¸‹è½½</a>          </div>]]></content>
      
      
      <categories>
          
          <category> æ¡†æ¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ’Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jetbrainså…¨å®¶æ¡¶ç ´è§£</title>
      <link href="posts/1306044467.html"/>
      <url>posts/1306044467.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><blockquote><p>èµ„æºä¸‹è½½ï¼Œå¯†ç ï¼šd2l7</p><p>åœ¨ç ´è§£å®Œåï¼Œè¯·ä¸è¦éšæ„ç§»åŠ¨æ’ä»¶çš„ä½ç½®ã€‚</p></blockquote><div class="btns rounded grid5">            <a class="button" href='https://wws.lanzous.com/b025yqija' title='èµ„æºä¸‹è½½'><i class='fas fa-download'></i>èµ„æºä¸‹è½½</a>          </div><h2 id="1ã€ä¸‹è½½è½¯ä»¶å®‰è£…åŒ…"><a href="#1ã€ä¸‹è½½è½¯ä»¶å®‰è£…åŒ…" class="headerlink" title="1ã€ä¸‹è½½è½¯ä»¶å®‰è£…åŒ…"></a>1ã€ä¸‹è½½è½¯ä»¶å®‰è£…åŒ…</h2><blockquote><p>è®¿é—® <code>Jetbrains</code> çš„ <a href="https://www.jetbrains.com/">å®˜æ–¹ç½‘ç«™</a> ï¼Œåœ¨å¯¼èˆªæ  <code>Developer Tool</code> é€‰é¡¹ä¸­é€‰æ‹©è‡ªå·±è¦ä¸‹è½½çš„å¼€å‘è½¯ä»¶ï¼Œè¿™é‡Œä»¥<code>Pycharm</code>ä¸ºä¾‹ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313170105.png" alt="image-20210313170104936"></p><blockquote><p>ç‚¹å‡» <code>DOWNLOAD</code> é€‰é¡¹è¿›è¡Œä¸‹è½½</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313170214.png" alt="image-20210313170214400"></p><blockquote><p>é€‰æ‹© <code>Professional</code> è¿›è¡Œä¸‹è½½</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313170410.png" alt="image-20210313170410434"></p><h2 id="2ã€å®‰è£…è½¯ä»¶"><a href="#2ã€å®‰è£…è½¯ä»¶" class="headerlink" title="2ã€å®‰è£…è½¯ä»¶"></a>2ã€å®‰è£…è½¯ä»¶</h2><blockquote><p>åŒå‡»ç¬¬ä¸€æ­¥ä¸­ä¸‹è½½çš„å®‰è£…åŒ…</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313170839.png" alt="image-20210313170839095"></p><blockquote><p>å‹¾é€‰ 64-bit launcherï¼Œç‚¹å‡»next</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313170941.png" alt="image-20210313170941767"></p><blockquote><p>ç‚¹å‡» Install è¿›è¡Œå®‰è£…</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313171019.png" alt="image-20210313171019799"></p><blockquote><p>å®‰è£…å®Œæˆåï¼Œç‚¹å‡» Finish é€€å‡ºå®‰è£…ç¨‹åºï¼Œè¿è¡Œ <code>Pycharm</code> ï¼Œè¿›å…¥è¯•ç”¨ç•Œé¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313171255.png" alt="image-20210313171255823"></p><blockquote><p>å¦‚æœæ²¡æœ‰å‡ºç°ä»¥ä¸Šçš„ç•Œé¢ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ä¸Šé¢ç»™å‡ºçš„èµ„æºä¸­è§£å‹ <code>reset_script.zip</code> å‹ç¼©åŒ…ï¼Œå¹¶åœ¨ <code>reset_script</code> ç›®å½•ä¸‹è¿è¡Œé‡ç½®è„šæœ¬ï¼Œå…¶ä¸­<code>linux</code>å’Œ<code>mac</code>è¿è¡Œ <code>.sh</code> è„šæœ¬ï¼Œwindowsè¿è¡Œ <code>.vbs</code> è„šæœ¬ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313171852.png" alt="image-20210313171852128"></p><blockquote><p>è¿›å…¥ <code>Pycharm</code> çš„ä¸»ç•Œé¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313172225.png" alt="image-20210313172225307"></p><h2 id="3ã€ç ´è§£"><a href="#3ã€ç ´è§£" class="headerlink" title="3ã€ç ´è§£"></a>3ã€ç ´è§£</h2><blockquote><p>åœ¨ä¸»é¡µé¢å·¦ä¸Šè§’é€‰æ‹© File -&gt; Settingsè¿›å…¥è®¾ç½®é¡µé¢ï¼Œç„¶åé€‰æ‹© Pluginsã€æ’ä»¶ã€‘ä¸€æ </p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313172538.png" alt="image-20210313172538352"></p><blockquote><p>é€‰æ‹©ä¸‹è½½èµ„æºä¸­çš„ <code>BetterIntellJ</code> æ’ä»¶è¿›è¡Œå®‰è£…</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313172837.png" alt="image-20210313172837430"></p><blockquote><p>ç‚¹å‡» Apply å¹¶é‡å¯è½¯ä»¶</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313172932.png" alt="image-20210313172932312"></p><blockquote><p>çœ‹åˆ°ä»¥ä¸‹æç¤ºåé‡å¯å³å¯ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313172950.png" alt="image-20210313172950710"></p><blockquote><p>ç”¨è®°äº‹æœ¬æ‰“å¼€èµ„æºä¸­çš„ ã€æ¿€æ´»è¡¥ä¸keyã€‘ï¼Œå¤åˆ¶å…¨éƒ¨å†…å®¹ï¼Œåœ¨ <code>pycharm</code> ä¸»é¡µé¢ä¸­é€‰æ‹©ã€Helpã€‘-&gt; ã€Registerã€‘</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313173213.png" alt="image-20210313173213381"></p><blockquote><p>ç‚¹å‡» ã€Add New Licenseã€‘æ·»åŠ æ¿€æ´»ç </p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313173514.png" alt="image-20210313173514166"></p><blockquote><p>æ­¤æ—¶æç¤ºæ¿€æ´»æˆåŠŸ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313173544.png" alt="image-20210313173544312"></p><blockquote><p>DataGripå’ŒIDEAçš„ç ´è§£æ­¥éª¤ä¸Pycharmå¤§åŒå°å¼‚ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> è½¯ä»¶ä½¿ç”¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé«˜çº§å­¦ä¹ ï¼ˆå››ï¼‰-MySQLæ—¥å¿—å’Œä¸»ä»å¤åˆ¶</title>
      <link href="posts/2904493033.html"/>
      <url>posts/2904493033.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€MySQLæ—¥å¿—"><a href="#ä¸€ã€MySQLæ—¥å¿—" class="headerlink" title="ä¸€ã€MySQLæ—¥å¿—"></a>ä¸€ã€MySQLæ—¥å¿—</h1><blockquote><p>åœ¨ä»»ä½•ä¸€ç§æ•°æ®åº“ä¸­ï¼Œéƒ½ä¼šæœ‰å„ç§å„æ ·çš„æ—¥å¿—ï¼Œè®°å½•ç€æ•°æ®åº“å·¥ä½œçš„æ–¹æ–¹é¢é¢ï¼Œä»¥å¸®åŠ©æ•°æ®åº“ç®¡ç†å‘˜è¿½è¸ªæ•°æ®åº“æ›¾ç»å‘ç”Ÿè¿‡çš„å„ç§äº‹ä»¶ã€‚</p><p>MySQL ä¹Ÿä¸ä¾‹å¤–ï¼Œåœ¨ MySQL ä¸­ï¼Œæœ‰ 4 ç§ä¸åŒçš„æ—¥å¿—ï¼Œåˆ†åˆ«æ˜¯<strong>é”™è¯¯æ—¥å¿—</strong>ã€<strong>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOG   æ—¥å¿—ï¼‰</strong>ã€<strong>æŸ¥è¯¢æ—¥å¿—</strong>å’Œ<strong>æ…¢æŸ¥è¯¢æ—¥å¿—</strong>ï¼Œè¿™äº›æ—¥å¿—è®°å½•ç€æ•°æ®åº“åœ¨ä¸åŒæ–¹é¢çš„è¸ªè¿¹ã€‚</p></blockquote><h2 id="1-1ã€é”™è¯¯æ—¥å¿—"><a href="#1-1ã€é”™è¯¯æ—¥å¿—" class="headerlink" title="1.1ã€é”™è¯¯æ—¥å¿—"></a>1.1ã€é”™è¯¯æ—¥å¿—</h2><blockquote><p>é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œå®ƒè®°å½•äº†å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚å½“æ•°æ®åº“å‡ºç°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—ã€‚</p><p>è¯¥æ—¥å¿—æ˜¯é»˜è®¤å¼€å¯çš„ ï¼Œ é»˜è®¤å­˜æ”¾ç›®å½•ä¸º mysql  çš„æ•°æ®ç›®å½•ï¼ˆvar/lib/mysqlï¼‰,   é»˜è®¤çš„æ—¥å¿—æ–‡ä»¶åä¸ºhostname.errï¼ˆhostnameæ˜¯ä¸»æœºåï¼‰ã€‚</p><p>æŸ¥çœ‹æ—¥å¿—ä½ç½®æŒ‡ä»¤ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;log_error%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312145050.png" alt="image-20210312145042887"></p><h2 id="1-2ã€äºŒè¿›åˆ¶æ—¥å¿—"><a href="#1-2ã€äºŒè¿›åˆ¶æ—¥å¿—" class="headerlink" title="1.2ã€äºŒè¿›åˆ¶æ—¥å¿—"></a>1.2ã€äºŒè¿›åˆ¶æ—¥å¿—</h2><h3 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h3><blockquote><p>äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆBINLOGï¼‰è®°å½•äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰è¯­å¥ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬æ•°æ®æŸ¥è¯¢è¯­å¥ã€‚æ­¤æ—¥å¿—å¯¹äºç¾éš¾æ—¶çš„æ•°æ®æ¢å¤èµ·ç€æå…¶é‡è¦çš„ä½œç”¨ï¼Œ<strong>MySQLçš„ä¸»ä»å¤åˆ¶ï¼Œ å°±æ˜¯é€šè¿‡è¯¥ <code>binlog</code> å®ç°çš„ã€‚</strong></p><p>äºŒè¿›åˆ¶æ—¥å¿—ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œéœ€è¦åˆ°MySQLçš„é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼Œå¹¶é…ç½®MySQLæ—¥å¿—çš„æ ¼å¼ã€‚</p><p>é…ç½®æ–‡ä»¶ä½ç½® :  <code>/usr/my.cnf</code></p><p>æ—¥å¿—å­˜æ”¾ä½ç½®  :  é…ç½®æ—¶ï¼Œç»™å®šäº†æ–‡ä»¶åä½†æ˜¯æ²¡æœ‰æŒ‡å®šè·¯å¾„ï¼Œæ—¥å¿—é»˜è®¤å†™å…¥<code>Mysql</code>çš„æ•°æ®ç›®å½•ã€‚</p></blockquote><h3 id="2ã€äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼"><a href="#2ã€äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼" class="headerlink" title="2ã€äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼"></a>2ã€äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼</h3><ul><li>STATEMENT</li></ul><blockquote><p>è¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„éƒ½æ˜¯SQLè¯­å¥ï¼ˆstatementï¼‰ï¼Œæ¯ä¸€æ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„SQLï¼ˆç±»ä¼¼<code>Redis</code>çš„<code>aof</code>ï¼Œåªè®°å½•å†™æ“ä½œï¼Œä¸è®°å½•æŸ¥è¯¢æ“ä½œï¼‰éƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ <code>Mysql</code> æä¾›çš„ <code>mysqlbinlog</code> å·¥å…·ï¼Œå¯ä»¥æ¸…æ™°çš„æŸ¥çœ‹åˆ°æ¯æ¡è¯­å¥çš„æ–‡æœ¬ã€‚</p><p>ä¸»ä»å¤åˆ¶çš„æ—¶å€™ï¼Œä»åº“ï¼ˆslaveï¼‰ä¼šå°†æ—¥å¿—è§£æä¸ºåŸæ–‡æœ¬ï¼Œå¹¶åœ¨ä»åº“é‡æ–°æ‰§è¡Œä¸€æ¬¡ã€‚</p></blockquote><ul><li>ROW</li></ul><blockquote><p>è¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ï¼Œè€Œä¸æ˜¯è®°å½•SQLè¯­å¥ã€‚</p><p>æ¯”å¦‚ï¼Œæ‰§è¡ŒSQLè¯­å¥ ï¼š <code>update tb_book set status=&#39;1&#39; </code>, å¦‚æœæ˜¯STATEMENT æ—¥å¿—æ ¼å¼ï¼Œåœ¨æ—¥å¿—ä¸­ä¼šè®°å½•ä¸€è¡ŒSQLæ–‡ä»¶ï¼› </p><p>å¦‚æœæ˜¯ROWï¼Œç”±äºæ˜¯å¯¹å…¨è¡¨è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€è¡Œè®°å½•éƒ½ä¼šå‘ç”Ÿå˜æ›´ï¼Œ<strong>ROW æ ¼å¼çš„æ—¥å¿—ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´ã€‚</strong></p></blockquote><ul><li>MIXED</li></ul><blockquote><p>è¿™æ˜¯ç›®å‰MySQLé»˜è®¤çš„æ—¥å¿—æ ¼å¼ï¼Œå³æ··åˆäº†STATEMENT å’Œ ROWä¸¤ç§æ ¼å¼ã€‚é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨STATEMENTï¼Œä½†æ˜¯åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹é‡‡ç”¨ROWæ¥è¿›è¡Œè®°å½•ã€‚MIXED æ ¼å¼èƒ½å°½é‡åˆ©ç”¨ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œè€Œé¿å¼€ä»–ä»¬çš„ç¼ºç‚¹ã€‚</p></blockquote><h3 id="3ã€æŸ¥çœ‹æ—¥å¿—"><a href="#3ã€æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="3ã€æŸ¥çœ‹æ—¥å¿—"></a>3ã€æŸ¥çœ‹æ—¥å¿—</h3><blockquote><p>ç”±äºæ—¥å¿—ä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜å‚¨ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦å€ŸåŠ© <code>mysqlbinlog</code> å·¥å…·æ¥æŸ¥çœ‹ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog <span class="built_in">log</span> file;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹<code>STATEMENT</code>æ ¼å¼æ—¥å¿—</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog æ–‡ä»¶å;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹<code>ROW</code>æ ¼å¼æ—¥å¿—</li></ul><blockquote><p>å¦‚æœæ—¥å¿—æ ¼å¼æ˜¯ ROW , ç›´æ¥æŸ¥çœ‹æ•°æ® , æ˜¯æŸ¥çœ‹ä¸æ‡‚çš„ ; </p><p>å¯ä»¥åœ¨<code>mysqlbinlog</code> åé¢åŠ ä¸Šå‚æ•° <code>-vv</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog -vv æ–‡ä»¶å;</span><br></pre></td></tr></table></figure><h3 id="4ã€æ—¥å¿—åˆ é™¤"><a href="#4ã€æ—¥å¿—åˆ é™¤" class="headerlink" title="4ã€æ—¥å¿—åˆ é™¤"></a>4ã€æ—¥å¿—åˆ é™¤</h3><blockquote><p>å¯¹äºæ¯”è¾ƒç¹å¿™çš„ç³»ç»Ÿï¼Œç”±äºæ¯å¤©ç”Ÿæˆæ—¥å¿—é‡å¤§ ï¼Œè¿™äº›æ—¥å¿—å¦‚æœé•¿æ—¶é—´ä¸æ¸…æ¥šï¼Œå°†ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚ä¸‹é¢æˆ‘ä»¬å°†ä¼šè®²è§£å‡ ç§åˆ é™¤æ—¥å¿—çš„å¸¸è§æ–¹æ³•ï¼š</p></blockquote><ul><li>æ–¹å¼ä¸€ï¼šé€šè¿‡ <code>Reset Master</code> æŒ‡ä»¤åˆ é™¤å…¨éƒ¨ binlog æ—¥å¿—ï¼Œåˆ é™¤ä¹‹åï¼Œæ—¥å¿—ç¼–å·ï¼Œå°†ä» xxxx.000001é‡æ–°å¼€å§‹ </li></ul><blockquote><p>åˆ é™¤å‰å…ˆæŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312151756.png" alt="image-20210312151755838"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Reset Master;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312151819.png" alt="image-20210312151819371"></p><ul><li>æ–¹å¼äºŒï¼šæ‰§è¡ŒæŒ‡ä»¤<code>purge master logs to &#39;mysqlbin.xxx&#39;</code>ï¼Œè¿™ä¸ªå‘½ä»¤å°†åˆ é™¤<code>xxx</code>ç¼–å·ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ã€‚</li><li>æ–¹å¼ä¸‰ï¼šæ‰§è¡ŒæŒ‡ä»¤ <code>purge master logs before &#39;yyyy-mm-dd hh:mm:ss&#39;</code>ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤æ—¥å¿—ä¸º <code>&quot;yyyy-mm-dd hh:mm:ss&quot; </code>ä¹‹å‰äº§ç”Ÿçš„æ‰€æœ‰æ—¥å¿— ã€‚</li><li>æ–¹å¼å››ï¼šè®¾ç½®å‚æ•° <code>--expire_logs_days=#</code> ï¼Œæ­¤å‚æ•°çš„å«ä¹‰æ˜¯è®¾ç½®æ—¥å¿—çš„è¿‡æœŸå¤©æ•°ï¼Œ è¿‡äº†æŒ‡å®šçš„å¤©æ•°åæ—¥å¿—å°†ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œè¿™æ ·å°†æœ‰åˆ©äºå‡å°‘DBA    ç®¡ç†æ—¥å¿—çš„å·¥ä½œé‡ã€‚</li></ul><h2 id="1-3ã€æŸ¥è¯¢æ—¥å¿—"><a href="#1-3ã€æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="1.3ã€æŸ¥è¯¢æ—¥å¿—"></a>1.3ã€æŸ¥è¯¢æ—¥å¿—</h2><blockquote><p>æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œè€ŒäºŒè¿›åˆ¶æ—¥å¿—ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ æŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚å¦‚æœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹é…ç½® ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#è¯¥é€‰é¡¹ç”¨æ¥å¼€å¯æŸ¥è¯¢æ—¥å¿— ï¼Œ å¯é€‰å€¼ ï¼š 0 æˆ–è€… 1 ï¼› 0 ä»£è¡¨å…³é—­ï¼Œ      1 ä»£è¡¨å¼€å¯</span><br><span class="line">general_log&#x3D;1 </span><br><span class="line">#è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶å ï¼Œ å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œ é»˜è®¤çš„æ–‡ä»¶åä¸º   host_name.log</span><br><span class="line">general_log_file&#x3D;file_name </span><br></pre></td></tr></table></figure><ul><li>åœ¨<code>mysql</code>é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸­é…ç½®å¦‚ä¸‹å†…å®¹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312153855.png" alt="image-20210312153855304"></p><ul><li>é…ç½®å®Œæ¯•ä¹‹åï¼Œåœ¨æ•°æ®åº“æ‰§è¡Œä»¥ä¸‹æ“ä½œ  ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_book;</span><br><span class="line">select * from tb_book where id &#x3D; 1;</span><br><span class="line">update tb_book set name &#x3D; &#39;luceneå…¥é—¨æŒ‡å—&#39; where id &#x3D; 5;</span><br><span class="line">select * from tb_book where id &lt; 8;</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œå®Œæ¯•åæŸ¥çœ‹æŸ¥è¯¢æ—¥å¿—</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312154159.png" alt="image-20210312154159228"></p><h2 id="1-4ã€æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#1-4ã€æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="1.4ã€æ…¢æŸ¥è¯¢æ—¥å¿—"></a>1.4ã€æ…¢æŸ¥è¯¢æ—¥å¿—</h2><blockquote><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•äº†æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡å‚æ•°  <code>long_query_time</code>  è®¾ç½®å€¼å¹¶ä¸”æ‰«æè®°å½•æ•°ä¸å°äº</p><p><code>min_examined_row_limit</code> çš„æ‰€æœ‰çš„SQLè¯­å¥çš„æ—¥å¿—ã€‚</p><p><code>long_query_time</code> é»˜è®¤ä¸º 10 ç§’ï¼Œæœ€å°ä¸º 0ï¼Œ ç²¾åº¦å¯ä»¥åˆ°å¾®ç§’ã€‚</p></blockquote><h3 id="1ã€æ–‡ä»¶ä½ç½®å’Œæ ¼å¼"><a href="#1ã€æ–‡ä»¶ä½ç½®å’Œæ ¼å¼" class="headerlink" title="1ã€æ–‡ä»¶ä½ç½®å’Œæ ¼å¼"></a>1ã€æ–‡ä»¶ä½ç½®å’Œæ ¼å¼</h3><blockquote><p>æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ˜¯å…³é—­çš„ ï¼Œå¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># è¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œ å¯å–å€¼ï¼š 1 å’Œ 0 ï¼Œ 1 ä»£è¡¨å¼€å¯ï¼Œ 0  ä»£è¡¨å…³é—­</span><br><span class="line">slow_query_log&#x3D;1</span><br><span class="line"></span><br><span class="line"># è¯¥å‚æ•°ç”¨æ¥æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—çš„æ–‡ä»¶å</span><br><span class="line">slow_query_log_file&#x3D;slow_query.log</span><br><span class="line"></span><br><span class="line"># è¯¥é€‰é¡¹ç”¨æ¥é…ç½®æŸ¥è¯¢çš„æ—¶é—´é™åˆ¶ï¼Œ è¶…è¿‡è¿™ä¸ªæ—¶é—´å°†è®¤ä¸ºå€¼æ…¢æŸ¥è¯¢ï¼Œ å°†éœ€è¦è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œ é»˜è®¤10s long_query_time&#x3D;10</span><br></pre></td></tr></table></figure><h3 id="2ã€æ—¥å¿—çš„è¯»å–"><a href="#2ã€æ—¥å¿—çš„è¯»å–" class="headerlink" title="2ã€æ—¥å¿—çš„è¯»å–"></a>2ã€æ—¥å¿—çš„è¯»å–</h3><blockquote><p>å’Œé”™è¯¯æ—¥å¿—ã€æŸ¥è¯¢æ—¥å¿—ä¸€æ ·ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•çš„æ ¼å¼ä¹Ÿæ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥è¢«ç›´æ¥è¯»å–ã€‚</p></blockquote><ul><li>æŸ¥è¯¢long_query_time  çš„å€¼ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;long%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312155744.png" alt="image-20210312155744225"></p><ul><li>æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id, title,price,num ,status from tb_item where id &#x3D; 1;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312155851.png" alt="image-20210312155851586"></p><blockquote><p>ç”±äºæ‰§è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œæ‰€ä»¥è¯¥æŸ¥è¯¢è¯­å¥ä¸ä¼šè¢«è®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚</p></blockquote><ul><li>æ‰§è¡Œä¸€æ¡æŸ¥è¯¢æ—¶é—´æé•¿çš„SQLè¯­å¥</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_item where title like &#39;%é˜¿å°”å¡ç‰¹ (OT-927) ç‚­é»‘ è”é€š3Gæ‰‹æœº åŒå¡åŒå¾…</span><br><span class="line">165454%&#39; ;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312160016.png" alt="image-20210312160016746"></p><blockquote><p>è¯¥SQLè¯­å¥ ï¼Œ æ‰§è¡Œæ—¶é•¿ä¸º 26.77s ï¼Œè¶…è¿‡10sï¼ˆ<code>long_query_time</code>ï¼‰ ï¼Œ æ‰€ä»¥ä¼šè®°å½•åœ¨æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p></blockquote><h1 id="äºŒã€MySQLå¤åˆ¶"><a href="#äºŒã€MySQLå¤åˆ¶" class="headerlink" title="äºŒã€MySQLå¤åˆ¶"></a>äºŒã€MySQLå¤åˆ¶</h1><h2 id="2-1ã€å¤åˆ¶æ¦‚è¿°"><a href="#2-1ã€å¤åˆ¶æ¦‚è¿°" class="headerlink" title="2.1ã€å¤åˆ¶æ¦‚è¿°"></a>2.1ã€å¤åˆ¶æ¦‚è¿°</h2><blockquote><p>å¤åˆ¶æ˜¯æŒ‡å°†ä¸»æ•°æ®åº“çš„ <strong>DDL  å’Œ  DML **æ“ä½œ</strong>é€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¼ åˆ°ä»åº“æœåŠ¡å™¨ä¸­**ï¼Œç„¶ååœ¨ä»åº“ä¸Šå¯¹è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆä¹Ÿå«é‡åšï¼‰ï¼Œä»è€Œä½¿å¾—ä»åº“å’Œä¸»åº“çš„æ•°æ®ä¿æŒåŒæ­¥ã€‚</p><p><strong>MySQLæ”¯æŒä¸€å°ä¸»åº“åŒæ—¶å‘å¤šå°ä»åº“è¿›è¡Œå¤åˆ¶ï¼Œ   ä»åº“åŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»åº“ï¼Œå®ç°é“¾çŠ¶å¤åˆ¶ã€‚</strong></p></blockquote><h2 id="2-2ã€å¤åˆ¶åŸç†"><a href="#2-2ã€å¤åˆ¶åŸç†" class="headerlink" title="2.2ã€å¤åˆ¶åŸç†"></a>2.2ã€å¤åˆ¶åŸç†</h2><blockquote><p>MySQLçš„ä¸»ä»å¤åˆ¶åŸç†å¦‚ä¸‹ï¼š</p><p>æ³¨æ„ï¼Œä¸»ä»å¤åˆ¶çš„å‰ææ˜¯<code>Master</code>èŠ‚ç‚¹å¿…é¡»å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312161130.png" alt="image-20210312161130480"></p><blockquote><p>ä»ä¸Šå±‚æ¥çœ‹ï¼Œå¤åˆ¶åˆ†ä¸ºä¸‰æ­¥ï¼š</p></blockquote><ul><li>Master ä¸»åº“åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œä¼šæŠŠæ•°æ®å˜æ›´ä½œä¸ºæ—¶é—´ <code>Events</code> è®°å½•åœ¨äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ <code>Binlog</code> ä¸­ã€‚</li><li>ä¸»åº“æ¨é€äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ <code>Binlog</code> ä¸­çš„æ—¥å¿—äº‹ä»¶åˆ°ä»åº“çš„ä¸­ç»§æ—¥å¿— <code>Relay Log</code> ã€‚</li><li>slaveé‡åšä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶ï¼Œå°†æ”¹å˜åæ˜ å®ƒè‡ªå·±çš„æ•°æ®ã€‚</li></ul><h2 id="2-3ã€å¤åˆ¶ä¼˜åŠ¿"><a href="#2-3ã€å¤åˆ¶ä¼˜åŠ¿" class="headerlink" title="2.3ã€å¤åˆ¶ä¼˜åŠ¿"></a>2.3ã€å¤åˆ¶ä¼˜åŠ¿</h2><blockquote><p>MySQL   å¤åˆ¶çš„æœ‰ç‚¹ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p></blockquote><ul><li>ä¸»åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°ä»åº“æä¾›æœåŠ¡ã€‚</li><li>å¯ä»¥åœ¨ä»åº“ä¸Šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä»ä¸»åº“ä¸­æ›´æ–°ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œé™ä½ä¸»åº“çš„è®¿é—®å‹åŠ›ã€‚</li><li>å¯ä»¥åœ¨ä»åº“ä¸­æ‰§è¡Œå¤‡ä»½ï¼Œä»¥é¿å…å¤‡ä»½æœŸé—´å½±å“ä¸»åº“çš„æœåŠ¡ã€‚</li></ul><h2 id="2-4ã€æ­å»ºæ­¥éª¤"><a href="#2-4ã€æ­å»ºæ­¥éª¤" class="headerlink" title="2.4ã€æ­å»ºæ­¥éª¤"></a>2.4ã€æ­å»ºæ­¥éª¤</h2><blockquote><p>å‡†å¤‡ä¸¤å°æœåŠ¡å™¨</p></blockquote><h3 id="1ã€master"><a href="#1ã€master" class="headerlink" title="1ã€master"></a>1ã€master</h3><ul><li>åœ¨ <code>master</code> çš„é…ç½®æ–‡ä»¶ <code>my.cnf</code> ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#mysql æœåŠ¡ID,ä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€</span><br><span class="line">server-id&#x3D;1</span><br><span class="line"></span><br><span class="line">#mysql binlog æ—¥å¿—çš„å­˜å‚¨è·¯å¾„å’Œæ–‡ä»¶å</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysqlbin</span><br><span class="line"></span><br><span class="line">#é”™è¯¯æ—¥å¿—,é»˜è®¤å·²ç»å¼€å¯</span><br><span class="line">#log-err</span><br><span class="line">#mysqlçš„å®‰è£…ç›®å½•</span><br><span class="line">#basedir</span><br><span class="line">#mysqlçš„ä¸´æ—¶ç›®å½•</span><br><span class="line">#tmpdir </span><br><span class="line">#mysqlçš„æ•°æ®å­˜æ”¾ç›®å½•</span><br><span class="line">#datadir</span><br><span class="line"></span><br><span class="line">#æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯», 0 ä»£è¡¨è¯»å†™ï¼Œç”±äºæ­¤å¤„ä¸ºmasterèŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸ºè¯»å†™å‹0</span><br><span class="line">read-only&#x3D;0</span><br><span class="line"></span><br><span class="line">#å¿½ç•¥çš„æ•°æ®, æŒ‡ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“</span><br><span class="line">binlog-ignore-db&#x3D;mysql</span><br><span class="line"></span><br><span class="line">#æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“</span><br><span class="line">#binlog-do-db&#x3D;db01</span><br></pre></td></tr></table></figure><ul><li>é…ç½®å®Œæ¯•ä¹‹åï¼Œéœ€è¦é‡å¯ <code>MySQL</code>ï¼Œå…³é—­é˜²ç«å¢™ ï¼ˆä¸»ä»èŠ‚ç‚¹éƒ½éœ€è¦å…³é—­ï¼‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># é‡å¯mysqlæœåŠ¡</span><br><span class="line">service mysql restart;</span><br><span class="line"># å…³é—­é˜²ç«å¢™</span><br><span class="line">service iptables stop;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºåŒæ­¥æ•°æ®çš„è´¦æˆ·ï¼Œå¹¶ä¸”è¿›è¡Œæˆæƒæ“ä½œï¼š</li></ul><blockquote><p>ç»™ä»èŠ‚ç‚¹ <code>itcast&#39;@&#39;192.168.192.131</code> æˆäºˆä¸€ä¸ªä¸»ä»å¤åˆ¶çš„æƒé™ï¼Œåœ¨æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨ä¸Šã€‚</p><p><code>*.*</code> è¡¨ç¤ºæ‰€æœ‰æ•°æ®åº“æ‰€æœ‰è¡¨ã€‚</p><p><code>identified by &#39;itcast&#39;</code> æŒ‡å®šè®¿é—®å¯†ç ä¸º <code>&#39;itcast&#39;</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grant replication slave on *.* to &#39;itcast&#39;@&#39;192.168.192.131&#39; identified by &#39;itcast&#39;;</span><br><span class="line"># åˆ·æ–°æƒé™åˆ—è¡¨</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹å½“å‰ <code>master</code> èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312164038.png" alt="image-20210312164038664"></p><blockquote><p>å­—æ®µå«ä¹‰ï¼š</p><ul><li><code>File</code> : ä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶ï¼Œè¿™é‡Œåº”è¯¥ä» <code>mysqlbin.000001</code> å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶</li><li><code>Position</code> ï¼š ä»å“ªä¸ªä½ç½®å¼€å§‹æ¨é€æ—¥å¿—ï¼Œè¿™é‡Œåº”ä»413è¡Œå¼€å§‹æ¨é€æ—¥å¿—</li><li><code>Binlog_Ignore_DB</code> : æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ï¼Œå¿½ç•¥ <code>mysql</code> æ•°æ®åº“</li></ul></blockquote><h3 id="2ã€slaveèŠ‚ç‚¹"><a href="#2ã€slaveèŠ‚ç‚¹" class="headerlink" title="2ã€slaveèŠ‚ç‚¹"></a>2ã€slaveèŠ‚ç‚¹</h3><ul><li>åœ¨  slave ç«¯é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#mysqlæœåŠ¡ç«¯ID,å”¯ä¸€</span><br><span class="line">server-id&#x3D;2</span><br><span class="line"></span><br><span class="line">#æŒ‡å®šbinlogæ—¥å¿—</span><br><span class="line">log-bin&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysqlbin</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œéœ€è¦é‡å¯ <code>Mysql</code>ï¼Œå¹¶å…³é—­é˜²ç«å¢™</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># é‡å¯mysqlæœåŠ¡</span><br><span class="line">service mysql restart;</span><br><span class="line"># å…³é—­é˜²ç«å¢™</span><br><span class="line">service iptables stop;</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host&#x3D; &#39;192.168.192.130&#39;, master_user&#x3D;&#39;itcast&#39;, master_password&#x3D;&#39;itcast&#39;,  master_log_file&#x3D;&#39;mysqlbin.000001&#39;,  master_log_pos&#x3D;413;</span><br></pre></td></tr></table></figure><blockquote><p>æŒ‡å®šå½“å‰ä»åº“å¯¹åº”çš„<strong>ä¸»åº“çš„IPåœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹çš„é‚£ä¸ªä½ç½®</strong>å¼€å§‹åŒæ­¥æ¨é€æ—¥å¿—ã€‚</p></blockquote><ul><li>å¼€å¯åŒæ­¥æ“ä½œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ä»èŠ‚ç‚¹å½“å‰çŠ¶æ€</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show slave status\G;</span><br></pre></td></tr></table></figure><blockquote><p><code>Slave_IO_State</code>çš„å€¼ä¸ºï¼šç­‰å¾…ä¸»èŠ‚ç‚¹ç»™ä»èŠ‚ç‚¹å‘é€æ•°æ®ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312165843.png" alt="image-20210312165843704"></p><ul><li>å…³é—­åŒæ­¥æ“ä½œ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop slave;</span><br></pre></td></tr></table></figure><h3 id="3ã€éªŒè¯ä¸»ä»å¤åˆ¶åŒæ­¥æ“ä½œ"><a href="#3ã€éªŒè¯ä¸»ä»å¤åˆ¶åŒæ­¥æ“ä½œ" class="headerlink" title="3ã€éªŒè¯ä¸»ä»å¤åˆ¶åŒæ­¥æ“ä½œ"></a>3ã€éªŒè¯ä¸»ä»å¤åˆ¶åŒæ­¥æ“ä½œ</h3><ul><li>åœ¨ä¸»èŠ‚ç‚¹ä¸­åˆ›å»ºæ•°æ®åº“ï¼Œåˆ›å»ºè¡¨ï¼Œå¹¶æ’å…¥æ•°æ®  ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create database db01;</span><br><span class="line">use db01;</span><br><span class="line">create table user</span><br><span class="line">(</span><br><span class="line">    id   int(11)     not null auto_increment,</span><br><span class="line">    name varchar(50) not null,</span><br><span class="line">    sex  varchar(1),</span><br><span class="line">    primary key (id)</span><br><span class="line">);        </span><br><span class="line">insert into user (id, name,sex) values (null,&#39;Dawn&#39;,&#39;1&#39;);</span><br><span class="line">insert into user(id,name,sex) values(null,&#39;Trigger&#39;,&#39;0&#39;);</span><br><span class="line">insert into user(id,name,sex) values(null,&#39;Dawn&#39;,&#39;1&#39;);</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä»èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„æ•°æ®åº“</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312170759.png" alt="image-20210312170759153"></p><ul><li>ä¹Ÿå¯ä»¥åœ¨ <code>db01</code> æ•°æ®åº“ä¸­ï¼ŒæŸ¥è¯¢åˆ° <code>user</code> è¡¨ä¸­çš„æ•°æ®ã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312170832.png" alt="image-20210312170832484"></p><ul><li>æ­¤æ—¶åœ¨ä¸»èŠ‚ç‚¹ä¸­ä½¿ç”¨ <code>update</code> æ›´æ–° <code>user</code> è¡¨ä¸­çš„æ•°æ®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update &#96;user&#96; set sex &#x3D; &#39;2&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312171104.png" alt="image-20210312171104252"></p><ul><li>åœ¨ä»èŠ‚ç‚¹ä¸­æŸ¥è¯¢ <code>user</code> è¡¨ä¸­çš„æ•°æ®</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312171138.png" alt="image-20210312171138826"></p>]]></content>
      
      
      <categories>
          
          <category> MySQLé«˜çº§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ğŸ¤“æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaé¢è¯•æ€»ç»“ï¼ˆäºŒï¼‰-hashCode()å’Œequals()è¯¦è§£</title>
      <link href="posts/3000794297.html"/>
      <url>posts/3000794297.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ"><a href="#1ã€é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ" class="headerlink" title="1ã€é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ"></a>1ã€é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œ</h2><blockquote><p>åœ¨é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œï¼ˆå…­ï¼‰-é›†åˆå¤„ç†ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ¡å¼ºåˆ¶è§„çº¦</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311214636.png" alt="image-20210311214636678"></p><h2 id="2ã€æŸ¥çœ‹åº•å±‚æºç "><a href="#2ã€æŸ¥çœ‹åº•å±‚æºç " class="headerlink" title="2ã€æŸ¥çœ‹åº•å±‚æºç "></a>2ã€æŸ¥çœ‹åº•å±‚æºç </h2><blockquote><p><code>hashCode</code>å’Œ<code>equals</code> æ˜¯<code>Object</code>ç±»ä¸‹çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­<code>hashCode</code> æ–¹æ³•ä»¥ <code>native</code> å…³é”®å­—ä¿®é¥°ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶éJavaå®ç°ã€‚</p><p>è€Œ<code>equals</code> æ–¹æ³•åº•å±‚è°ƒç”¨äº† <code>==</code> æ¥ä¸ä¼ å…¥çš„å¯¹è±¡åšæ¯”è¾ƒï¼ˆæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡åœ°å€å€¼ï¼‰</p></blockquote><h2 id="3ã€hashCodeä»‹ç»"><a href="#3ã€hashCodeä»‹ç»" class="headerlink" title="3ã€hashCodeä»‹ç»"></a>3ã€<code>hashCode</code>ä»‹ç»</h2><blockquote><p><code>hashCode</code>æ–¹æ³•æ˜¯æ¯ä¸ªç±»ä¸­éƒ½æ‹¥æœ‰çš„ä¸€ä¸ªå‡½æ•°ï¼Œä¸»è¦è¿”å›æ¯ä¸ªå¯¹è±¡çš„hashå€¼ï¼Œhashå€¼ä¸»è¦ç”¨äºæ•£åˆ—è¡¨ï¼ˆHashMapã€HashSetã€HashTableï¼‰ä¸­ã€‚</p><p>å¯¹hashç çš„é€šç”¨çº¦å®šå¦‚ä¸‹ï¼š</p></blockquote><ul><li>ä»Hashå€¼ä¸èƒ½åå‘æ¨å¯¼å‡ºåŸå§‹çš„æ•°æ®</li><li>è¾“å…¥æ•°æ®çš„å¾®å°å˜åŒ–ä¼šå¾—åˆ°å®Œå…¨ä¸åŒçš„Hashå€¼ï¼Œç›¸åŒçš„æ•°æ®ä¼šå¾—åˆ°ç›¸åŒçš„å€¼ã€‚</li></ul><blockquote><p>åœ¨javaç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåœ¨ä¸€ä¸ªå¯¹è±¡æ²¡æœ‰è¢«æ”¹å˜çš„å‰æä¸‹ï¼Œæ— è®ºè¿™ä¸ªå¯¹è±¡è¢«è°ƒç”¨å¤šå°‘æ¬¡ï¼ŒhashCodeæ–¹æ³•éƒ½ä¼šè¿”å›ç›¸åŒçš„æ•´æ•°å€¼ã€‚å¯¹è±¡çš„å“ˆå¸Œç æ²¡æœ‰å¿…è¦åœ¨ä¸åŒçš„ç¨‹åºä¸­ä¿æŒç›¸åŒçš„å€¼ã€‚</p></blockquote><ul><li>Hashç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¦é«˜æ•ˆï¼Œé•¿çš„æ–‡æœ¬ä¹Ÿèƒ½å¿«é€Ÿè®¡ç®—å‡ºHashå€¼</li><li>å¦‚æœ2ä¸ªå¯¹è±¡ä½¿ç”¨equalsæ–¹æ³•è¿›è¡Œæ¯”è¾ƒå¹¶ä¸”ç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆè¿™2ä¸ªå¯¹è±¡çš„<code>hashCode</code>æ–¹æ³•çš„å€¼ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚</li><li>å¦‚æœæ ¹æ®equalsæ–¹æ³•ï¼Œå¾—åˆ°ä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿™2ä¸ªå¯¹è±¡çš„<code>hashCode</code>å€¼ä¸éœ€è¦å¿…é¡»ä¸ç›¸åŒã€‚ä½†æ˜¯ï¼Œä¸ç›¸ç­‰çš„å¯¹è±¡çš„<code>hashCode</code>å€¼ä¸åŒçš„è¯å¯ä»¥æé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½ã€‚</li></ul><h2 id="4ã€æ¡ˆä¾‹"><a href="#4ã€æ¡ˆä¾‹" class="headerlink" title="4ã€æ¡ˆä¾‹"></a>4ã€æ¡ˆä¾‹</h2><h3 id="4-1ã€ç¼–å†™ä¸€ä¸ªPersonç±»"><a href="#4-1ã€ç¼–å†™ä¸€ä¸ªPersonç±»" class="headerlink" title="4.1ã€ç¼–å†™ä¸€ä¸ªPersonç±»"></a>4.1ã€ç¼–å†™ä¸€ä¸ªPersonç±»</h3><blockquote><p>è¿™é‡Œä¸é‡å†™hashCodeæ–¹æ³•ï¼Œåªé‡å†™Personç±»çš„equalsæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span> == obj) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(obj <span class="keyword">instanceof</span> Person) &#123;</span><br><span class="line">            Person person = (Person)obj;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.age.equals(person.age) &amp;&amp; <span class="keyword">this</span>.name.equals(person.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™ä¸€æ®µæµ‹è¯•ä»£ç ï¼Œæµ‹è¯•ä¸¤ä¸ªæ»¡è¶³<code>equals</code>æ–¹æ³•çš„Personå¯¹è±¡çš„hashCodeæ˜¯å¦ç›¸ç­‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person p1 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Person p2 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;p1ä¸p2ä½¿ç”¨equalsæ–¹æ³•åˆ¤æ–­æ˜¯å¦ç›¸ç­‰çš„ç»“æœæ˜¯ï¼š&quot;</span> + p1.equals(p2));</span><br><span class="line">System.out.println(<span class="string">&quot;å¯¹è±¡p1çš„hashCodeä¸ºï¼š&quot;</span> + p1.hashCode());</span><br><span class="line">System.out.println(<span class="string">&quot;å¯¹è±¡p2çš„hashCodeä¸ºï¼š&quot;</span> + p2.hashCode());</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311221801.png" alt="image-20210311221800697"></p><blockquote><p>ä»ä¸Šé¢è¿è¡Œçš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœåªé‡å†™equalsæ–¹æ³•ï¼Œä¸é‡å†™hashCodeæ–¹æ³•ï¼Œé‚£ä¹ˆä½¿ç”¨equalsæ–¹æ³•åˆ¤æ–­ä¸ºç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡çš„hashå€¼å¯èƒ½ä¸åŒã€‚</p></blockquote><h3 id="4-2ã€å‘HashSetä¸­æ·»åŠ ä¸é‡å†™hashCodeæ–¹æ³•çš„å¯¹è±¡"><a href="#4-2ã€å‘HashSetä¸­æ·»åŠ ä¸é‡å†™hashCodeæ–¹æ³•çš„å¯¹è±¡" class="headerlink" title="4.2ã€å‘HashSetä¸­æ·»åŠ ä¸é‡å†™hashCodeæ–¹æ³•çš„å¯¹è±¡"></a>4.2ã€å‘HashSetä¸­æ·»åŠ ä¸é‡å†™<code>hashCode</code>æ–¹æ³•çš„å¯¹è±¡</h3><blockquote><p><code>HashSet</code>åº•å±‚æ˜¯ç»´æŠ¤äº†ä¸€ä¸ª<code>HashMap</code>å¯¹è±¡ï¼Œåœ¨å¾€<code>HashSet</code>å¯¹è±¡ä¸­addå¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨äº†åº•å±‚<code>HashMap</code>å¯¹è±¡çš„putæ–¹æ³•ï¼Œä¼ å…¥çš„<code>Entry</code>å¯¹è±¡ä¸­ï¼Œé”®ä¸ºå¾…æ·»åŠ å¯¹è±¡ï¼Œå€¼å›ºå®šä¸ºä¸€ä¸ª<code>Object</code>å¯¹è±¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311223030.png" alt="image-20210311223030452"></p><blockquote><p>addæ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311223322.png" alt="image-20210311223322917"></p><ul><li>åˆ›å»ºä¸€ä¸ªHashSetå¯¹è±¡ï¼Œä½¿ç”¨Personä½œä¸ºæ³›å‹ï¼Œç„¶åæ·»åŠ å‡ ä¸ªPersonå¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Person p1 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Person p2 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Person p3 = <span class="keyword">new</span> Person(<span class="number">2</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Set&lt;Person&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">set.add(p1);</span><br><span class="line">set.add(p2);</span><br><span class="line">set.add(p3);</span><br><span class="line">System.out.println(set);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311223922.png" alt="image-20210311223922525"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨é‡å†™<code>equals</code>æ–¹æ³•è€Œä¸é‡å†™<code>hashCode</code>æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå°†è¯¥ç±»ä½œä¸ºæ•£åˆ—è¡¨çš„é”®æˆ–è€…HashSetçš„æ³›å‹ï¼Œå°±ä¼šé€ æˆå‡ºç°å¤šä¸ªä¸€æ¨¡ä¸€æ ·çš„keyæˆ–è€…å¯¹è±¡ã€‚</p></blockquote><h3 id="4-3ã€é‡å†™Personç±»çš„hashCodeæ–¹æ³•"><a href="#4-3ã€é‡å†™Personç±»çš„hashCodeæ–¹æ³•" class="headerlink" title="4.3ã€é‡å†™Personç±»çš„hashCodeæ–¹æ³•"></a>4.3ã€é‡å†™Personç±»çš„<code>hashCode</code>æ–¹æ³•</h3><blockquote><p>å°†Personå¯¹è±¡çš„<code>name</code>å±æ€§å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™ï¼Œç„¶åä½¿ç”¨Stringç±»çš„<code>hashCode</code>æ–¹æ³•è®¡ç®—<code>name</code>çš„hashå€¼ï¼Œç„¶åä¸Personå¯¹è±¡çš„<code>age</code>è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> nameCode = name.toUpperCase().hashCode();</span><br><span class="line">    <span class="keyword">return</span> nameCode ^ age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4ã€å†æ¬¡è¿è¡Œä¸Šé¢çš„ä¸¤ä¸ªæ¡ˆä¾‹"><a href="#4-4ã€å†æ¬¡è¿è¡Œä¸Šé¢çš„ä¸¤ä¸ªæ¡ˆä¾‹" class="headerlink" title="4.4ã€å†æ¬¡è¿è¡Œä¸Šé¢çš„ä¸¤ä¸ªæ¡ˆä¾‹"></a>4.4ã€å†æ¬¡è¿è¡Œä¸Šé¢çš„ä¸¤ä¸ªæ¡ˆä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person p1 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Person p2 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;p1ä¸p2ä½¿ç”¨equalsæ–¹æ³•åˆ¤æ–­æ˜¯å¦ç›¸ç­‰çš„ç»“æœæ˜¯ï¼š&quot;</span> + p1.equals(p2));</span><br><span class="line">System.out.println(<span class="string">&quot;å¯¹è±¡p1çš„hashCodeä¸ºï¼š&quot;</span> + p1.hashCode());</span><br><span class="line">System.out.println(<span class="string">&quot;å¯¹è±¡p2çš„hashCodeä¸ºï¼š&quot;</span> + p2.hashCode());</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç»“æœï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°ä½¿ç”¨equalsæ¯”è¾ƒç»“æœä¸ºtrueçš„ä¸¤ä¸ªå¯¹è±¡çš„hashCodeä¸€å®šç›¸ç­‰ã€‚</p><p>æ³¨æ„ï¼šæ­¤æ—¶<code>hashCode</code>å€¼ç›¸ç­‰çš„å¯¹è±¡equalsåçš„ç»“æœä¸ä¸€å®šä¸ºtrue</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311225155.png" alt="image-20210311225155026"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Person p1 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Person p2 = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Person p3 = <span class="keyword">new</span> Person(<span class="number">2</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">Set&lt;Person&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">set.add(p1);</span><br><span class="line">set.add(p2);</span><br><span class="line">set.add(p3);</span><br><span class="line">System.out.println(set);</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç»“æœï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°HashSetå¯¹è±¡ä¸­æ²¡æœ‰ä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311230851.png" alt="image-20210311230850503"></p><h2 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h2><h3 id="5-1ã€å¯¹äºä¸ä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»"><a href="#5-1ã€å¯¹äºä¸ä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»" class="headerlink" title="5.1ã€å¯¹äºä¸ä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»"></a>5.1ã€å¯¹äºä¸ä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»</h3><blockquote><p>â€œä¸ä¼šåˆ›å»ºæ•£åˆ—è¡¨â€çš„æ„æ€æ˜¯ï¼š</p><p>æˆ‘ä»¬ä¸ä¼šåœ¨<code>HashSet</code>ã€<code>HashMap</code>ã€<code>HashTable</code>ã€<code>ConcurrentHashMap</code>ç­‰ç­‰è¿™äº›æœ¬è´¨æ˜¯æ•£åˆ—è¡¨çš„æ•°æ®ç»“æ„ä¸­ä½¿ç”¨è¿™ä¸ªç±»ï¼Œå…¶ä¸­<code>HashMap</code>ã€<code>HashTable</code>å’Œ<code>ConcurrentHashMap</code>ä¸­ä¸ä¼šä½œä¸ºé”®ä½¿ç”¨ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>hashCode</code>å’Œ<code>equals</code>æ–¹æ³•ä¸å­˜åœ¨å…³ç³»ï¼Œæ­¤æ—¶equalsæ–¹æ³•ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œè€Œ<code>hashCode</code>å…¨æ— ä½œç”¨ã€‚</p></blockquote><h3 id="5-2ã€å¯¹äºä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»"><a href="#5-2ã€å¯¹äºä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»" class="headerlink" title="5.2ã€å¯¹äºä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»"></a>5.2ã€å¯¹äºä¼šåˆ›å»ºæ•£åˆ—è¡¨çš„ç±»</h3><blockquote><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»é‡å†™<code>hashCode</code>å’Œ<code>equals</code>æ–¹æ³•ï¼Œå¹¶ä¸”é‡å†™çš„<code>hashCode</code>æ–¹æ³•å¿…é¡»æ»¡è¶³ä¸Šé¢ç»™å‡ºçš„hashé€šç”¨çº¦å®šã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>hashCode</code>æ–¹æ³•å’Œ<code>equals</code>æ–¹æ³•å¾—å‡ºçš„ç»“æœæœ‰å¦‚ä¸‹å…³ç³»ï¼š</p></blockquote><ul><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ä½¿ç”¨equalsæ–¹æ³•æ¯”è¾ƒåçš„ç»“æœä¸ºtrueï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡ç»ç”±<code>hashCode</code>æ–¹æ³•å¾—åˆ°çš„ç»“æœä¸€å®šä¸€è‡´ã€‚</li><li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ä½¿ç”¨equalsæ–¹æ³•æ¯”è¾ƒåçš„ç»“æœä¸ºfalseï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡ç»ç”±<code>hashCode</code>æ–¹æ³•å¾—åˆ°çš„ç»“æœå¯èƒ½ç›¸ç­‰ã€‚ï¼ˆåœ¨<code>HashMap</code>ä¸­ï¼Œä¸¤ä¸ª<code>hashCode</code>ç›¸åŒè€Œé”®ä¸åŒçš„ç°è±¡ç§°ä¸ºhashå†²çªï¼‰</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•ç›¸å…³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé«˜çº§å­¦ä¹ ï¼ˆä¸‰ï¼‰-MySQLé”é—®é¢˜ã€å¸¸ç”¨æŠ€å·§å’Œå†…å­˜ä¼˜åŒ–</title>
      <link href="posts/2442351397.html"/>
      <url>posts/2442351397.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€åº”ç”¨ä¼˜åŒ–"><a href="#ä¸€ã€åº”ç”¨ä¼˜åŒ–" class="headerlink" title="ä¸€ã€åº”ç”¨ä¼˜åŒ–"></a>ä¸€ã€åº”ç”¨ä¼˜åŒ–</h1><blockquote><p>å‰é¢ç« èŠ‚ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¾ˆå¤šæ•°æ®åº“çš„ä¼˜åŒ–æªæ–½ã€‚</p><p>ä½†æ˜¯åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç”±äºæ•°æ®åº“æœ¬èº«çš„æ€§èƒ½å±€é™ï¼Œå°±å¿…é¡»è¦å¯¹å‰å°çš„åº”ç”¨è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œæ¥é™ä½æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚</p></blockquote><h2 id="1-1ã€ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± "><a href="#1-1ã€ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="1.1ã€ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± "></a>1.1ã€ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± </h2><blockquote><p>å¯¹äºè®¿é—®æ•°æ®åº“æ¥è¯´ï¼Œå»ºç«‹è¿æ¥çš„ä»£ä»·æ˜¯æ¯”è¾ƒæ˜‚è´µçš„ï¼Œå› ä¸ºæˆ‘ä»¬é¢‘ç¹çš„åˆ›å»ºå…³é—­è¿æ¥ï¼Œæ˜¯æ¯”è¾ƒè€—è´¹èµ„æºçš„ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å»ºç«‹ æ•°æ®åº“è¿æ¥æ± ï¼Œä»¥æé«˜è®¿é—®çš„æ€§èƒ½ã€‚</p><p>Javaä¸­å¸¸ç”¨çš„æ•°æ®åº“å¦‚ä¸‹ï¼š</p></blockquote><h3 id="1ã€C3P0"><a href="#1ã€C3P0" class="headerlink" title="1ã€C3P0"></a>1ã€C3P0</h3><blockquote><p>å¼€æºçš„ï¼Œæˆç†Ÿçš„ï¼Œé«˜å¹¶å‘ç¬¬ä¸‰æ–¹æ•°æ®åº“è¿æ¥æ± ï¼Œä½œè€…æ˜¯ Steve Waldmanï¼Œç›¸å…³çš„æ–‡æ¡£èµ„æ–™æ¯”è¾ƒå®Œå–„ï¼Œå¤§åé¼é¼çš„hibernateæ¡†æ¶å°±ä½¿ç”¨äº†c3p0æ•°æ®åº“è¿æ¥æ± ã€‚</p><p>SSMé¡¹ç›®ä¸­å¸¸é›†æˆ <code>C3P0</code> è¿æ¥æ± </p></blockquote><h3 id="2ã€HiKariCP"><a href="#2ã€HiKariCP" class="headerlink" title="2ã€HiKariCP"></a>2ã€HiKariCP</h3><blockquote><p><code>Spring Boot</code> é»˜è®¤é›†æˆçš„æ•°æ®åº“è¿æ¥æ± ï¼Œé€Ÿåº¦æå¿«</p></blockquote><h3 id="3ã€Druid"><a href="#3ã€Druid" class="headerlink" title="3ã€Druid"></a>3ã€Druid</h3><blockquote><p><code>Alibaba</code>å¼€æºçš„æ•°æ®åº“è¿æ¥æ± ï¼Œå·ç§°æ˜¯Javaè¯­è¨€ä¸­æœ€å¥½çš„æ•°æ®åº“è¿æ¥æ± ã€‚Druidèƒ½å¤Ÿæä¾›å¼ºå¤§çš„ç›‘æ§å’Œæ‰©å±•åŠŸèƒ½ã€‚</p></blockquote><h2 id="1-2ã€å‡å°‘å¯¹MySQLçš„è®¿é—®"><a href="#1-2ã€å‡å°‘å¯¹MySQLçš„è®¿é—®" class="headerlink" title="1.2ã€å‡å°‘å¯¹MySQLçš„è®¿é—®"></a>1.2ã€å‡å°‘å¯¹MySQLçš„è®¿é—®</h2><h3 id="1ã€å‡å°‘å¯¹æ•°æ®è¿›è¡Œé‡å¤æ£€ç´¢"><a href="#1ã€å‡å°‘å¯¹æ•°æ®è¿›è¡Œé‡å¤æ£€ç´¢" class="headerlink" title="1ã€å‡å°‘å¯¹æ•°æ®è¿›è¡Œé‡å¤æ£€ç´¢"></a>1ã€å‡å°‘å¯¹æ•°æ®è¿›è¡Œé‡å¤æ£€ç´¢</h3><blockquote><p>åœ¨ç¼–å†™åº”ç”¨ä»£ç æ—¶ï¼Œéœ€è¦èƒ½å¤Ÿç†æ¸…å¯¹æ•°æ®åº“çš„è®¿é—®é€»è¾‘ã€‚èƒ½å¤Ÿä¸€æ¬¡è¿æ¥å°±è·å–åˆ°ç»“æœçš„ï¼Œå°±ä¸ç”¨ä¸¤æ¬¡è¿æ¥ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘å¯¹æ•°æ®åº“æ— ç”¨çš„é‡å¤è¯·æ±‚ã€‚</p></blockquote><ul><li>æ¯”å¦‚ ï¼Œéœ€è¦è·å–ä¹¦ç±çš„id å’Œnameå­—æ®µ ï¼Œ åˆ™æŸ¥è¯¢å¦‚ä¸‹ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id , name from tb_book;</span><br></pre></td></tr></table></figure><ul><li>ä¹‹åï¼Œåœ¨ä¸šåŠ¡é€»è¾‘ä¸­æœ‰éœ€è¦è·å–åˆ°ä¹¦ç±çŠ¶æ€ä¿¡æ¯ï¼Œ  åˆ™æŸ¥è¯¢å¦‚ä¸‹ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id , status from tb_book;</span><br></pre></td></tr></table></figure><ul><li>è¿™æ ·ï¼Œå°±éœ€è¦å‘æ•°æ®åº“æäº¤ä¸¤æ¬¡è¯·æ±‚ï¼Œæ•°æ®åº“å°±è¦åšä¸¤æ¬¡æŸ¥è¯¢æ“ä½œã€‚å…¶å®å®Œå…¨å¯ä»¥ç”¨ä¸€æ¡SQLè¯­å¥å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id, name , status from tb_book;</span><br></pre></td></tr></table></figure><h3 id="2ã€å¢åŠ cacheå±‚"><a href="#2ã€å¢åŠ cacheå±‚" class="headerlink" title="2ã€å¢åŠ cacheå±‚"></a>2ã€å¢åŠ cacheå±‚</h3><blockquote><p>åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ä¸­å¢åŠ  ç¼“å­˜ å±‚æ¥è¾¾åˆ°å‡è½»æ•°æ®åº“è´Ÿæ‹…çš„ç›®çš„ã€‚ç¼“å­˜å±‚æœ‰å¾ˆå¤šç§ï¼Œä¹Ÿæœ‰å¾ˆå¤šå®ç°æ–¹å¼ï¼Œåªè¦èƒ½è¾¾åˆ°é™ä½æ•°æ®åº“çš„è´Ÿæ‹…åˆèƒ½æ»¡è¶³åº”ç”¨éœ€æ±‚å°±å¯ä»¥ã€‚</p><p>å› æ­¤å¯ä»¥éƒ¨åˆ†æ•°æ®ä»æ•°æ®åº“ä¸­æŠ½å–å‡ºæ¥æ”¾åˆ°åº”ç”¨ç«¯ä»¥æ–‡æœ¬æ–¹å¼å­˜å‚¨ï¼Œ æˆ–è€…ä½¿ç”¨æ¡†æ¶(Mybatis, Hibernate)æä¾›çš„ä¸€çº§ç¼“å­˜/äºŒçº§ç¼“å­˜ï¼Œæˆ–è€…ä½¿ç”¨redisæ•°æ®åº“æ¥ç¼“å­˜æ•°æ®  ã€‚</p></blockquote><h2 id="1-3ã€è´Ÿè½½å‡è¡¡"><a href="#1-3ã€è´Ÿè½½å‡è¡¡" class="headerlink" title="1.3ã€è´Ÿè½½å‡è¡¡"></a>1.3ã€è´Ÿè½½å‡è¡¡</h2><blockquote><p>è´Ÿè½½å‡è¡¡æ˜¯åº”ç”¨ä¸­ä½¿ç”¨éå¸¸æ™®éçš„ä¸€ç§ä¼˜åŒ–æ–¹æ³•ï¼Œå®ƒçš„æœºåˆ¶å°±æ˜¯åˆ©ç”¨æŸç§å‡è¡¡ç®—æ³•ï¼Œå°†å›ºå®šçš„è´Ÿè½½é‡åˆ†å¸ƒåˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œ ä»¥æ­¤æ¥é™ä½å•å°æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œè¾¾åˆ°ä¼˜åŒ–çš„æ•ˆæœã€‚</p></blockquote><h3 id="1ã€åˆ©ç”¨MySQLå¤åˆ¶åˆ†æµæŸ¥è¯¢"><a href="#1ã€åˆ©ç”¨MySQLå¤åˆ¶åˆ†æµæŸ¥è¯¢" class="headerlink" title="1ã€åˆ©ç”¨MySQLå¤åˆ¶åˆ†æµæŸ¥è¯¢"></a>1ã€åˆ©ç”¨MySQLå¤åˆ¶åˆ†æµæŸ¥è¯¢</h3><blockquote><p>æœ‰ä¸€å° <code>MySQL</code> çš„ <strong>ä¸»èŠ‚ç‚¹</strong> ï¼Œå¯ä»¥å°†æ•°æ®åŒæ­¥åˆ° <strong>ä»èŠ‚ç‚¹</strong> ä¸­</p><p>é€šè¿‡MySQLçš„ä¸»ä»å¤åˆ¶ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œä½¿å¢åˆ æ”¹æ“ä½œèµ°ä¸»èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ“ä½œèµ°ä»èŠ‚ç‚¹ï¼Œä»è€Œå¯ä»¥é™ä½å•å°æœåŠ¡å™¨çš„è¯»å†™å‹åŠ›ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310212344.png" alt="image-20210310212344695"></p><blockquote><p>åœ¨è¿›è¡Œ <strong>å†™æ“ä½œï¼ˆå¢åˆ æ”¹ï¼‰</strong> çš„æ—¶å€™ç›´æ¥å¯¹ <code>master</code> èŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼Œç„¶åç”± <code>master</code> èŠ‚ç‚¹åŒæ­¥åˆ° <code>salve</code> èŠ‚ç‚¹ä¸­ã€‚</p><p><strong>è¯»æ“ä½œ</strong> ä¸è¯·æ±‚ <code>master</code> ï¼Œè€Œæ˜¯è¯·æ±‚ <code>slave</code> ã€‚</p><p><strong>å†™</strong> çš„å‹åŠ›é›†ä¸­åœ¨ <code>master</code> ï¼Œè€Œ <strong>è¯»</strong> çš„å‹åŠ›é›†ä¸­åœ¨ <code>salve</code> </p></blockquote><h3 id="2ã€é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„"><a href="#2ã€é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„" class="headerlink" title="2ã€é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„"></a>2ã€é‡‡ç”¨åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„</h3><blockquote><p>åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„é€‚åˆå¤§æ•°æ®é‡ã€è´Ÿè½½é«˜çš„æƒ…å†µï¼Œå®ƒæœ‰è‰¯å¥½çš„æ‹“å±•æ€§å’Œé«˜å¯ç”¨æ€§ã€‚é€šè¿‡åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´åˆ†å¸ƒæ•°æ®ï¼Œå¯ä»¥å®ç°åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œæé«˜è®¿é—®æ•ˆç‡ã€‚</p></blockquote><h1 id="äºŒã€MySQLä¸­æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–"><a href="#äºŒã€MySQLä¸­æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–" class="headerlink" title="äºŒã€MySQLä¸­æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–"></a>äºŒã€MySQLä¸­æŸ¥è¯¢ç¼“å­˜ä¼˜åŒ–</h1><blockquote><p>æ³¨æ„ï¼Œ<code>MySQL</code> 8.0ä¹‹åå»æ‰äº†æŸ¥è¯¢ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–ç¼“å­˜æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ <code>Redis</code>ï¼‰æ¥ä»£æ›¿</p></blockquote><h2 id="2-1ã€æ¦‚è¿°"><a href="#2-1ã€æ¦‚è¿°" class="headerlink" title="2.1ã€æ¦‚è¿°"></a>2.1ã€æ¦‚è¿°</h2><blockquote><p>å¼€å¯Mysqlçš„æŸ¥è¯¢ç¼“å­˜ï¼Œ<strong>å½“æ‰§è¡Œå®Œå…¨ç›¸åŒçš„SQLè¯­å¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ç»“æœ</strong>ï¼Œå½“<strong>æ•°æ®è¢«ä¿®æ”¹ï¼Œä¹‹å‰çš„ç¼“å­˜ä¼šå¤±æ•ˆ</strong>ï¼Œ<strong>ä¿®æ”¹æ¯”è¾ƒé¢‘ç¹çš„è¡¨ä¸é€‚åˆåšæŸ¥è¯¢ç¼“å­˜ã€‚</strong></p></blockquote><h2 id="2-2ã€æ“ä½œæµç¨‹"><a href="#2-2ã€æ“ä½œæµç¨‹" class="headerlink" title="2.2ã€æ“ä½œæµç¨‹"></a>2.2ã€æ“ä½œæµç¨‹</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310213045.png" alt="image-20210310213045383"></p><blockquote><p>æ‰§è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p></blockquote><ul><li><p>å®¢æˆ·ç«¯å‘é€ä¸€æ¡æŸ¥è¯¢ç»™æœåŠ¡å™¨ï¼›</p></li><li><p>æœåŠ¡å™¨å…ˆä¼šæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™ç«‹å³è¿”å›å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„ç»“æœã€‚å¦åˆ™è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼›</p></li><li><p>æœåŠ¡å™¨ç«¯è¿›è¡ŒSQLè§£æã€é¢„å¤„ç†ï¼Œå†ç”±ä¼˜åŒ–å™¨ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’ï¼›</p></li><li><p>MySQLæ ¹æ®ä¼˜åŒ–å™¨ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“çš„APIæ¥æ‰§è¡ŒæŸ¥è¯¢ï¼›</p></li><li><p>å°†ç»“æœç¼“å­˜ä¸€ä»½æ”¾å…¥ <strong>æŸ¥è¯¢ç¼“å­˜</strong>ä¸­å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></li></ul><h2 id="2-3ã€æŸ¥è¯¢ç¼“å­˜é…ç½®"><a href="#2-3ã€æŸ¥è¯¢ç¼“å­˜é…ç½®" class="headerlink" title="2.3ã€æŸ¥è¯¢ç¼“å­˜é…ç½®"></a>2.3ã€æŸ¥è¯¢ç¼“å­˜é…ç½®</h2><h3 id="1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦æ”¯æŒæŸ¥è¯¢ç¼“å­˜"><a href="#1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦æ”¯æŒæŸ¥è¯¢ç¼“å­˜" class="headerlink" title="1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦æ”¯æŒæŸ¥è¯¢ç¼“å­˜"></a>1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦æ”¯æŒæŸ¥è¯¢ç¼“å­˜</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#39;have_query_cache&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äº <code>MySQL</code> 8.0ä¹‹åå·²ç»ä¸æ”¯æŒæŸ¥è¯¢ç¼“å­˜ï¼Œè€Œæˆ‘ä½¿ç”¨ç”¨çš„ç‰ˆæœ¬æ˜¯ <code>8.0.19</code> ï¼Œæ‰€ä»¥è¿™é‡Œçš„ç»“æœè‡ªç„¶æ˜¯ <code>NO</code></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310215903.png" alt="image-20210310215902999"></p><h3 id="2ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜"><a href="#2ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="2ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜"></a>2ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#39;query_cache_type&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310220419.png" alt="image-20210310220419476"></p><h3 id="3ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å ç”¨å¤§å°"><a href="#3ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å ç”¨å¤§å°" class="headerlink" title="3ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å ç”¨å¤§å°"></a>3ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å ç”¨å¤§å°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#39;query_cache_size&#39;;</span><br></pre></td></tr></table></figure><h3 id="4ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡"><a href="#4ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡" class="headerlink" title="4ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡"></a>4ã€æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW STATUS LIKE &#39;Qcache%&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœä¸­å„å˜é‡å‚æ•°è¯´æ˜å¦‚ä¸‹</p></blockquote><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>Qcache_free_blocks</code></td><td>æŸ¥è¯¢ç¼“å­˜ä¸­çš„å¯ç”¨å†…å­˜å—æ•°</td></tr><tr><td><code>Qcache_free_memory</code></td><td>æŸ¥è¯¢ç¼“å­˜çš„å¯ç”¨å†…å­˜é‡</td></tr><tr><td><code>Qcache_hits</code></td><td>æŸ¥è¯¢ç¼“å­˜å‘½ä¸­æ•°</td></tr><tr><td><code>Qcache_inserts</code></td><td>æ·»åŠ åˆ°æŸ¥è¯¢ç¼“å­˜çš„æŸ¥è¯¢æ•°</td></tr><tr><td><code>Qcache_lowmen_prunes</code></td><td>ç”±äºå†…å­˜ä¸è¶³è€Œä»æŸ¥è¯¢ç¼“å­˜ä¸­åˆ é™¤çš„æŸ¥è¯¢æ•°</td></tr><tr><td><code>Qcache_not_cached</code></td><td>éç¼“å­˜æŸ¥è¯¢çš„æ•°é‡ï¼ˆç”±äº  query_cache_type  è®¾ç½®è€Œæ— æ³•ç¼“å­˜æˆ–æœªç¼“å­˜ï¼‰</td></tr><tr><td><code>Qcache_queries_in_cache</code></td><td>æŸ¥è¯¢ç¼“å­˜ä¸­æ³¨å†Œçš„æŸ¥è¯¢æ•°</td></tr><tr><td><code>Qcache_total_blocks</code></td><td>æŸ¥è¯¢ç¼“å­˜ä¸­çš„å—æ€»æ•°</td></tr></tbody></table><h2 id="2-4ã€å¼€å¯æŸ¥è¯¢ç¼“å­˜"><a href="#2-4ã€å¼€å¯æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="2.4ã€å¼€å¯æŸ¥è¯¢ç¼“å­˜"></a>2.4ã€å¼€å¯æŸ¥è¯¢ç¼“å­˜</h2><blockquote><p>MySQLçš„æŸ¥è¯¢ç¼“å­˜é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®å‚æ•° query_cache_type ï¼Œ æ¥å¼€å¯æŸ¥è¯¢ç¼“å­˜ã€‚query_cache_typeè¯¥å‚æ•°çš„å¯å–å€¼æœ‰ä¸‰ä¸ªï¼š</p></blockquote><table><thead><tr><th>å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>OFF æˆ– 0</td><td>æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½å…³é—­</td></tr><tr><td>ON æˆ– 1</td><td>æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æ‰“å¼€ï¼ŒSELECTçš„ç»“æœç¬¦åˆç¼“å­˜æ¡ä»¶å³ä¼šç¼“å­˜ï¼Œå¦åˆ™ï¼Œä¸äºˆç¼“å­˜ï¼Œæ˜¾å¼æŒ‡å®šSQL_NO_CACHEï¼Œä¸äºˆç¼“å­˜</td></tr><tr><td>DEMANDæˆ– 2</td><td>æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æŒ‰éœ€è¿›è¡Œï¼Œæ˜¾å¼æŒ‡å®š  SQL_CACHE  çš„SELECTè¯­å¥æ‰ä¼šç¼“å­˜ï¼›å…¶å®ƒå‡ä¸äºˆç¼“å­˜</td></tr></tbody></table><blockquote><p>åœ¨ <code>my.cnf</code> é…ç½®æ–‡ä»¶ä¸­ï¼Œå¢åŠ ä»¥ä¸‹é…ç½®</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯MySQLæŸ¥è¯¢ç¼“å­˜ï¼ˆä¸é€‚ç”¨äº8.0åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰</span></span><br><span class="line">query_cache_type = 1;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®å®Œæ¯•ä¹‹åï¼Œé‡å¯æœåŠ¡æ—¢å¯ç”Ÿæ•ˆ  ï¼›</p><p>ç„¶åå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡ŒSQLè¯­å¥è¿›è¡ŒéªŒè¯ ï¼Œæ‰§è¡Œä¸€æ¡æ¯”è¾ƒè€—æ—¶çš„SQLè¯­å¥ï¼Œç„¶åå†å¤šæ‰§è¡Œå‡ æ¬¡ï¼ŒæŸ¥çœ‹åé¢å‡ æ¬¡çš„æ‰§è¡Œæ—¶é—´ï¼›è·å–é€šè¿‡æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„ç¼“å­˜å‘½ä¸­æ•°ï¼Œæ¥åˆ¤å®šæ˜¯å¦èµ°æŸ¥è¯¢ç¼“å­˜ã€‚</p></blockquote><h2 id="2-5ã€æŸ¥è¯¢ç¼“å­˜Select-é€‰é¡¹"><a href="#2-5ã€æŸ¥è¯¢ç¼“å­˜Select-é€‰é¡¹" class="headerlink" title="2.5ã€æŸ¥è¯¢ç¼“å­˜Select é€‰é¡¹"></a>2.5ã€æŸ¥è¯¢ç¼“å­˜Select é€‰é¡¹</h2><blockquote><p>å¯ä»¥åœ¨SELECTè¯­å¥ä¸­æŒ‡å®šä¸¤ä¸ªä¸æŸ¥è¯¢ç¼“å­˜ç›¸å…³çš„é€‰é¡¹  ï¼š</p><p><code>SQL_CACHE</code> : å¦‚æœæŸ¥è¯¢ç»“æœæ˜¯å¯ç¼“å­˜çš„ï¼Œå¹¶ä¸” query_cache_type ç³»ç»Ÿå˜é‡çš„å€¼ä¸ºONæˆ– DEMAND ï¼Œåˆ™ç¼“å­˜æŸ¥è¯¢ç»“æœ ã€‚</p><p><code>SQL_NO_CACHE</code> : æœåŠ¡å™¨ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚å®ƒæ—¢ä¸æ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œä¹Ÿä¸æ£€æŸ¥ç»“æœæ˜¯å¦å·²ç¼“å­˜ï¼Œä¹Ÿä¸ç¼“å­˜æŸ¥è¯¢ç»“æœã€‚ä¾‹å­ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT SQL_CACHE id, name FROM customer;</span><br><span class="line">SELECT SQL_NO_CACHE id, name FROM customer;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰ã€MySQLå†…å­˜ç®¡ç†åŠä¼˜åŒ–"><a href="#ä¸‰ã€MySQLå†…å­˜ç®¡ç†åŠä¼˜åŒ–" class="headerlink" title="ä¸‰ã€MySQLå†…å­˜ç®¡ç†åŠä¼˜åŒ–"></a>ä¸‰ã€MySQLå†…å­˜ç®¡ç†åŠä¼˜åŒ–</h1><h2 id="3-1ã€å†…å­˜ä¼˜åŒ–åŸåˆ™"><a href="#3-1ã€å†…å­˜ä¼˜åŒ–åŸåˆ™" class="headerlink" title="3.1ã€å†…å­˜ä¼˜åŒ–åŸåˆ™"></a>3.1ã€å†…å­˜ä¼˜åŒ–åŸåˆ™</h2><ul><li><p>å°†å°½é‡å¤šçš„å†…å­˜åˆ†é…ç»™MySQLåšç¼“å­˜ï¼Œä½†è¦ç»™æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºé¢„ç•™è¶³å¤Ÿå†…å­˜ã€‚</p></li><li><p><code>MyISAM</code> å­˜å‚¨å¼•æ“çš„æ•°æ®æ–‡ä»¶è¯»å–ä¾èµ–äºæ“ä½œç³»ç»Ÿè‡ªèº«çš„IOç¼“å­˜ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰<code>MyISAM</code>è¡¨ï¼Œå°±è¦é¢„ç•™æ›´å¤šçš„å†…å­˜ç»™æ“ä½œç³»ç»ŸåšIOç¼“å­˜ã€‚</p></li><li><p><strong>æ’åºåŒºã€è¿æ¥åŒºç­‰ç¼“å­˜æ˜¯åˆ†é…ç»™æ¯ä¸ªæ•°æ®åº“ä¼šè¯ï¼ˆsessionï¼‰ä¸“ç”¨çš„ï¼Œå…¶é»˜è®¤å€¼çš„è®¾ç½®è¦æ ¹æ®æœ€å¤§è¿æ¥æ•°åˆç†åˆ†é…ï¼Œå¦‚æœè®¾ç½®å¤ªå¤§ï¼Œä¸ä½†æµªè´¹èµ„æºï¼Œè€Œä¸”åœ¨å¹¶å‘è¿æ¥è¾ƒé«˜æ—¶ä¼šå¯¼è‡´ç‰©ç†å†…å­˜è€—å°½ã€‚</strong></p></li></ul><h2 id="3-2ã€MyISAM-å†…å­˜ä¼˜åŒ–"><a href="#3-2ã€MyISAM-å†…å­˜ä¼˜åŒ–" class="headerlink" title="3.2ã€MyISAM å†…å­˜ä¼˜åŒ–"></a>3.2ã€<code>MyISAM</code> å†…å­˜ä¼˜åŒ–</h2><blockquote><p><code>MyISAM</code>å­˜å‚¨å¼•æ“ä½¿ç”¨ <code>key_buï¬€er</code> ç¼“å­˜ç´¢å¼•å—ï¼ŒåŠ é€Ÿ<code>MyISAM</code>ç´¢å¼•çš„è¯»å†™é€Ÿåº¦ã€‚å¯¹äº<code>MyISAM</code>è¡¨çš„æ•°æ®å—ï¼Œmysqlæ²¡æœ‰ç‰¹åˆ«çš„ç¼“å­˜æœºåˆ¶ï¼Œå®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„IOç¼“å­˜ã€‚</p></blockquote><h3 id="1ã€key-buï¬€er-size"><a href="#1ã€key-buï¬€er-size" class="headerlink" title="1ã€key_buï¬€er_size"></a>1ã€key_buï¬€er_size</h3><blockquote><p>key_buï¬€er_sizeå†³å®š <code>MyISAM </code>ç´¢å¼•å—ç¼“å­˜åŒºçš„å¤§å°ï¼Œç›´æ¥å½±å“åˆ° <code>MyISAM</code> è¡¨çš„å­˜å–æ•ˆç‡ã€‚</p><p>å¯ä»¥åœ¨MySQLå‚æ•°æ–‡ä»¶ä¸­è®¾ç½®key_buï¬€er_sizeçš„å€¼ï¼Œå¯¹äºä¸€èˆ¬ <code>MyISAM</code> æ•°æ®åº“ï¼Œå»ºè®®è‡³å°‘å°†1/4å¯ç”¨å†…å­˜åˆ†é…ç»™key_buï¬€er_sizeã€‚<br>åœ¨ <code>/usr/my.cnf </code> ä¸­åšå¦‚ä¸‹é…ç½®ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key_buffer_size&#x3D;512M</span><br></pre></td></tr></table></figure><h3 id="2ã€read-buï¬€er-size"><a href="#2ã€read-buï¬€er-size" class="headerlink" title="2ã€read_buï¬€er_size"></a>2ã€read_buï¬€er_size</h3><p>å¦‚æœéœ€è¦ç»å¸¸é¡ºåºæ‰«æ <code>myisam</code> è¡¨ï¼Œå¯ä»¥é€šè¿‡å¢å¤§read_buï¬€er_sizeçš„å€¼æ¥æ”¹å–„æ€§èƒ½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯<br><strong>read_buï¬€er_sizeæ˜¯æ¯ä¸ªsessionç‹¬å çš„</strong>ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚</p><h3 id="3ã€read-rnd-buï¬€er-size"><a href="#3ã€read-rnd-buï¬€er-size" class="headerlink" title="3ã€read_rnd_buï¬€er_size"></a>3ã€read_rnd_buï¬€er_size</h3><p>å¯¹äºéœ€è¦åšæ’åºçš„ <code>myisam</code> è¡¨çš„æŸ¥è¯¢ï¼Œå¦‚å¸¦æœ‰order byå­å¥çš„sqlï¼Œé€‚å½“å¢åŠ  read_rnd_buï¬€er_size çš„å€¼ï¼Œå¯ä»¥æ”¹å–„æ­¤ç±»çš„sqlæ€§èƒ½ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ <strong>read_rnd_buï¬€er_size æ˜¯æ¯ä¸ªsessionç‹¬å çš„</strong>ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚</p><h2 id="3-3ã€InnoDB-å†…å­˜ä¼˜åŒ–"><a href="#3-3ã€InnoDB-å†…å­˜ä¼˜åŒ–" class="headerlink" title="3.3ã€InnoDB å†…å­˜ä¼˜åŒ–"></a>3.3ã€<code>InnoDB</code> å†…å­˜ä¼˜åŒ–</h2><blockquote><p>innodbç”¨ä¸€å—å†…å­˜åŒºåšIOç¼“å­˜æ± ï¼Œè¯¥ç¼“å­˜æ± ä¸ä»…ç”¨æ¥ç¼“å­˜innodbçš„ç´¢å¼•å—ï¼Œè€Œä¸”ä¹Ÿç”¨æ¥ç¼“å­˜innodbçš„æ•°æ®å—ã€‚</p></blockquote><h3 id="1ã€innodb-buï¬€er-pool-size"><a href="#1ã€innodb-buï¬€er-pool-size" class="headerlink" title="1ã€innodb_buï¬€er_pool_size"></a>1ã€<code>innodb_buï¬€er_pool_size</code></h3><blockquote><p>è¯¥å˜é‡å†³å®šäº† innodb <strong>å­˜å‚¨å¼•æ“è¡¨æ•°æ®</strong>å’Œ<strong>ç´¢å¼•æ•°æ®</strong>çš„æœ€å¤§ç¼“å­˜åŒºå¤§å°ã€‚åœ¨ä¿è¯æ“ä½œç³»ç»ŸåŠå…¶ä»–ç¨‹åºæœ‰è¶³å¤Ÿå†…å­˜å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œinnodb_buï¬€er_pool_size çš„å€¼è¶Šå¤§ï¼Œç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œè®¿é—®InnoDBè¡¨éœ€è¦çš„ç£ç›˜I/O å°±è¶Šå°‘ï¼Œæ€§èƒ½ä¹Ÿå°±è¶Šé«˜ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_buffer_pool_size=512M</span><br></pre></td></tr></table></figure><h3 id="2ã€innodb-log-buï¬€er-size"><a href="#2ã€innodb-log-buï¬€er-size" class="headerlink" title="2ã€innodb_log_buï¬€er_size"></a>2ã€<code>innodb_log_buï¬€er_size</code></h3><blockquote><p>å†³å®šäº†innodbé‡åšæ—¥å¿—ç¼“å­˜çš„å¤§å°ï¼Œå¯¹äºå¯èƒ½äº§ç”Ÿå¤§é‡æ›´æ–°è®°å½•çš„å¤§äº‹åŠ¡ï¼Œå¢åŠ innodb_log_buï¬€er_sizeçš„å¤§å°ï¼Œ<strong>å¯ä»¥é¿å…innodbåœ¨äº‹åŠ¡æäº¤å‰å°±æ‰§è¡Œä¸å¿…è¦çš„æ—¥å¿—å†™å…¥ç£ç›˜æ“ä½œã€‚</strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">innodb_log_buffer_size=10M</span><br></pre></td></tr></table></figure><h1 id="å››ã€MySQL-å¹¶å‘å‚æ•°è°ƒæ•´"><a href="#å››ã€MySQL-å¹¶å‘å‚æ•°è°ƒæ•´" class="headerlink" title="å››ã€MySQL å¹¶å‘å‚æ•°è°ƒæ•´"></a>å››ã€MySQL å¹¶å‘å‚æ•°è°ƒæ•´</h1><blockquote><p>ä»å®ç°ä¸Šæ¥è¯´ï¼ŒMySQL Server æ˜¯<strong>å¤šçº¿ç¨‹ç»“æ„</strong>ï¼ŒåŒ…æ‹¬<strong>åå°çº¿ç¨‹å’Œå®¢æˆ·æœåŠ¡çº¿ç¨‹</strong>ã€‚å¤šçº¿ç¨‹å¯ä»¥æœ‰æ•ˆåˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œæé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ã€‚</p><p>åœ¨Mysqlä¸­ï¼Œæ§åˆ¶å¹¶å‘è¿æ¥å’Œçº¿ç¨‹çš„ä¸»è¦å‚æ•°åŒ…æ‹¬ </p></blockquote><ul><li>max_connections</li><li>back_log</li><li>thread_cache_size</li><li>table_open_cacheã€‚</li></ul><h2 id="4-1ã€max-connections"><a href="#4-1ã€max-connections" class="headerlink" title="4.1ã€max_connections"></a>4.1ã€max_connections</h2><blockquote><p>é‡‡ç”¨max_connections  æ§åˆ¶å…è®¸è¿æ¥åˆ°MySQLæ•°æ®åº“çš„æœ€å¤§æ•°é‡ï¼Œ<strong>é»˜è®¤å€¼æ˜¯  151</strong>ã€‚</p><p>å¦‚æœ<strong>çŠ¶æ€å˜é‡connection_errors_max_connections ä¸ä¸ºé›¶</strong>ï¼Œå¹¶ä¸”ä¸€ç›´å¢é•¿ï¼Œåˆ™è¯´æ˜ä¸æ–­æœ‰è¿æ¥è¯·æ±‚å› æ•°æ®åº“è¿æ¥æ•°å·²è¾¾åˆ°å…è®¸æœ€å¤§å€¼è€Œå¤±è´¥ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘å¢å¤§max_connections çš„å€¼ã€‚</p><p><code>Mysql</code> æœ€å¤§å¯æ”¯æŒçš„è¿æ¥æ•°ï¼Œå–å†³äºå¾ˆå¤šå› ç´ ï¼ŒåŒ…æ‹¬ç»™å®šæ“ä½œç³»ç»Ÿå¹³å°çš„çº¿ç¨‹åº“çš„è´¨é‡ã€å†…å­˜å¤§å°ã€æ¯ä¸ªè¿æ¥çš„è´Ÿè·ã€CPUçš„å¤„ç†é€Ÿåº¦ï¼ŒæœŸæœ›çš„å“åº”æ—¶é—´ç­‰ã€‚</p><p>åœ¨Linux å¹³å°ä¸‹ï¼Œæ€§èƒ½å¥½çš„æœåŠ¡å™¨ï¼Œæ”¯æŒ 500-1000 ä¸ªè¿æ¥ä¸æ˜¯éš¾äº‹ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è¿›è¡Œè¯„ä¼°è®¾å®šã€‚</p></blockquote><h2 id="4-2ã€back-log"><a href="#4-2ã€back-log" class="headerlink" title="4.2ã€back_log"></a>4.2ã€back_log</h2><blockquote><p>back_log å‚æ•°æ§åˆ¶MySQLç›‘å¬TCPç«¯å£æ—¶è®¾ç½®çš„ç§¯å‹è¯·æ±‚æ ˆå¤§å°ã€‚</p><p>å¦‚æœMySqlçš„è¿æ¥æ•°è¾¾åˆ°max_connectionsæ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­ï¼Œä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³back_logï¼Œå¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡back_logï¼Œå°†ä¸è¢«æˆäºˆè¿æ¥èµ„æºï¼Œå°†ä¼šæŠ¥é”™ã€‚5.6.6 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤å€¼ä¸º <code>50</code> ï¼Œ ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤ä¸º <code>50 +ï¼ˆmax_connections / 5ï¼‰</code>ï¼Œ ä½†æœ€å¤§ä¸è¶…è¿‡ <code>900</code>ã€‚</p><p><strong>å¦‚æœéœ€è¦æ•°æ®åº“åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å¤„ç†å¤§é‡è¿æ¥è¯·æ±‚</strong>ï¼Œ  å¯ä»¥è€ƒè™‘é€‚å½“å¢å¤§ <code>back_log</code>  çš„å€¼ã€‚</p><p>ç±»ä¼¼çº¿ç¨‹æ± çš„<strong>é˜»å¡é˜Ÿåˆ—</strong></p></blockquote><h2 id="4-3ã€table-open-cache"><a href="#4-3ã€table-open-cache" class="headerlink" title="4.3ã€table_open_cache"></a>4.3ã€table_open_cache</h2><blockquote><p>è¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æ‰€æœ‰SQLè¯­å¥æ‰§è¡Œçº¿ç¨‹å¯æ‰“å¼€è¡¨ç¼“å­˜çš„æ•°é‡ï¼Œ è€Œåœ¨æ‰§è¡ŒSQLè¯­å¥æ—¶ï¼Œæ¯ä¸€ä¸ªSQLæ‰§è¡Œçº¿ç¨‹è‡³å°‘è¦æ‰“å¼€ 1 ä¸ªè¡¨ç¼“å­˜ã€‚</p><p>è¯¥å‚æ•°çš„å€¼åº”è¯¥æ ¹æ®è®¾ç½®çš„æœ€å¤§è¿æ¥æ•° max_connections   ä»¥åŠæ¯ä¸ªè¿æ¥æ‰§è¡Œå…³è”æŸ¥è¯¢ä¸­æ¶‰åŠçš„è¡¨çš„æœ€å¤§æ•°é‡æ¥è®¾å®š  ï¼š<code>max_connections x N </code>ï¼›</p></blockquote><h2 id="4-4ã€thread-cache-size"><a href="#4-4ã€thread-cache-size" class="headerlink" title="4.4ã€thread_cache_size"></a>4.4ã€thread_cache_size</h2><blockquote><p>ä¸ºäº†åŠ å¿«è¿æ¥æ•°æ®åº“çš„é€Ÿåº¦ï¼ŒMySQL ä¼šç¼“å­˜ä¸€å®šæ•°é‡çš„å®¢æˆ·æœåŠ¡çº¿ç¨‹ä»¥å¤‡é‡ç”¨ï¼Œé€šè¿‡å‚æ•° thread_cache_size å¯æ§åˆ¶  MySQL ç¼“å­˜å®¢æˆ·æœåŠ¡çº¿ç¨‹çš„æ•°é‡ã€‚</p></blockquote><h2 id="4-5ã€innodb-lock-wait-timeout"><a href="#4-5ã€innodb-lock-wait-timeout" class="headerlink" title="4.5ã€innodb_lock_wait_timeout"></a>4.5ã€innodb_lock_wait_timeout</h2><blockquote><p>è¯¥å‚æ•°æ˜¯ç”¨æ¥è®¾ç½® <strong>InnoDB äº‹åŠ¡ç­‰å¾…è¡Œé”çš„æ—¶é—´</strong>ï¼Œé»˜è®¤å€¼æ˜¯50ms ï¼Œ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡ŒåŠ¨æ€è®¾ç½®ã€‚å¯¹äºéœ€è¦å¿«é€Ÿåé¦ˆçš„ä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œå¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå°ï¼Œä»¥é¿å…äº‹åŠ¡é•¿æ—¶é—´æŒ‚èµ·ï¼› å¯¹äºåå°è¿è¡Œçš„æ‰¹é‡å¤„ç†ç¨‹åºæ¥è¯´ï¼Œå¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå¤§ï¼Œ ä»¥é¿å…å‘ç”Ÿå¤§çš„å›æ»šæ“ä½œã€‚</p></blockquote><h1 id="äº”ã€MySQLé”é—®é¢˜"><a href="#äº”ã€MySQLé”é—®é¢˜" class="headerlink" title="äº”ã€MySQLé”é—®é¢˜"></a>äº”ã€MySQLé”é—®é¢˜</h1><h2 id="5-1ã€é”æ¦‚è¿°"><a href="#5-1ã€é”æ¦‚è¿°" class="headerlink" title="5.1ã€é”æ¦‚è¿°"></a>5.1ã€é”æ¦‚è¿°</h2><blockquote><p>é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ï¼ˆé¿å…äº‰æŠ¢ï¼‰ã€‚</p><p>åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚ CPUã€RAMã€I/O ç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p></blockquote><h2 id="5-2ã€é”åˆ†ç±»"><a href="#5-2ã€é”åˆ†ç±»" class="headerlink" title="5.2ã€é”åˆ†ç±»"></a>5.2ã€é”åˆ†ç±»</h2><h3 id="1ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†"><a href="#1ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†" class="headerlink" title="1ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†"></a>1ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†</h3><ul><li>è¡¨é”</li></ul><blockquote><p>æ“ä½œæ—¶ï¼Œä¼šé”å®šæ•´ä¸ªè¡¨</p></blockquote><ul><li>è¡Œé”</li></ul><blockquote><p>æ“ä½œæ—¶ï¼Œä¼šé”å®šå½“å‰æ“ä½œè¡Œ</p></blockquote><h3 id="2ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†"><a href="#2ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†" class="headerlink" title="2ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†"></a>2ã€ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹åˆ†</h3><ul><li>è¯»é”ï¼ˆå…±äº«é”ï¼‰</li></ul><blockquote><p>é’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šç›¸äº’å½±å“ã€‚</p></blockquote><ul><li>å†™é”ï¼ˆæ’ä»–é”ï¼‰</li></ul><blockquote><p>å½“å‰æ“ä½œæ²¡æœ‰å®Œæˆä¹‹å‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚</p></blockquote><h2 id="5-3ã€MySQL-é”"><a href="#5-3ã€MySQL-é”" class="headerlink" title="5.3ã€MySQL é”"></a>5.3ã€MySQL é”</h2><blockquote><p>ç›¸å¯¹å…¶ä»–æ•°æ®åº“è€Œè¨€ï¼ŒMySQLçš„é”æœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œå…¶æœ€æ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯ä¸åŒçš„å­˜å‚¨å¼•æ“æ”¯æŒä¸åŒçš„é”æœºåˆ¶ã€‚ä¸‹è¡¨ä¸­ç½—åˆ—å‡ºäº†å„å­˜å‚¨å¼•æ“å¯¹é”çš„æ”¯æŒæƒ…å†µï¼š</p></blockquote><table><thead><tr><th>å­˜å‚¨å¼•æ“</th><th>è¡¨çº§é”</th><th>è¡Œçº§é”</th><th>é¡µé¢é”</th></tr></thead><tbody><tr><td><code>MyISAM</code></td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td><code>InnoDB</code></td><td>æ”¯æŒ</td><td>æ”¯æŒï¼ˆé»˜è®¤æ”¯æŒï¼‰</td><td>ä¸æ”¯æŒ</td></tr><tr><td>MEMORY</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>BDB</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr></tbody></table><blockquote><p>MySQLè¿™ä¸‰ç§é”çš„ç‰¹æ€§å¤§è‡´å¯ä»¥å½’çº³å¦‚ä¸‹</p></blockquote><table><thead><tr><th>é”ç±»å‹</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>è¡¨çº§é”</td><td>åå‘<code>MyISAM</code> å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜,å¹¶å‘åº¦æœ€ä½ã€‚</td></tr><tr><td>è¡Œçº§é”</td><td>åå‘<code>InnoDB</code> å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</td></tr><tr><td>é¡µé¢é”</td><td>å¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚</td></tr></tbody></table><blockquote><p>ä»ä¸Šè¿°ç‰¹ç‚¹å¯è§ï¼Œå¾ˆéš¾ç¬¼ç»Ÿåœ°è¯´å“ªç§é”æ›´å¥½ï¼Œåªèƒ½å°±å…·ä½“åº”ç”¨çš„ç‰¹ç‚¹æ¥è¯´å“ªç§é”æ›´åˆé€‚ï¼ä»…ä»é”çš„è§’åº¦æ¥è¯´ï¼šè¡¨çº§é”æ›´é€‚åˆäºä»¥æŸ¥è¯¢ä¸ºä¸»ï¼Œåªæœ‰å°‘é‡æŒ‰ç´¢å¼•æ¡ä»¶æ›´æ–°æ•°æ®çš„åº”ç”¨ï¼Œå¦‚Web åº”ç”¨ï¼›è€Œè¡Œçº§é”åˆ™æ›´é€‚åˆäºæœ‰å¤§é‡æŒ‰ç´¢å¼•æ¡ä»¶å¹¶å‘æ›´æ–°å°‘é‡ä¸åŒæ•°æ®ï¼ŒåŒæ—¶åˆæœ‰å¹¶æŸ¥è¯¢çš„åº”ç”¨ï¼Œå¦‚ä¸€äº›åœ¨çº¿äº‹åŠ¡å¤„ç†ï¼ˆOLTPï¼‰ç³»ç»Ÿã€‚</p></blockquote><h2 id="5-4ã€MyISAM-è¡¨é”"><a href="#5-4ã€MyISAM-è¡¨é”" class="headerlink" title="5.4ã€MyISAM è¡¨é”"></a>5.4ã€MyISAM è¡¨é”</h2><blockquote><p>MyISAM å­˜å‚¨å¼•æ“åªæ”¯æŒè¡¨é”ï¼Œè¿™ä¹Ÿæ˜¯ MySQL å¼€å§‹å‡ ä¸ªç‰ˆæœ¬ä¸­å”¯ä¸€æ”¯æŒçš„é”ç±»å‹ã€‚</p></blockquote><h3 id="1ã€å¦‚ä½•åŠ è¡¨é”"><a href="#1ã€å¦‚ä½•åŠ è¡¨é”" class="headerlink" title="1ã€å¦‚ä½•åŠ è¡¨é”"></a>1ã€å¦‚ä½•åŠ è¡¨é”</h3><blockquote><p>MyISAM   åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼ˆSELECTï¼‰å‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œæ›´æ–°æ“ä½œï¼ˆUPDATEã€DELETEã€INSERT  ç­‰ï¼‰å‰ï¼Œä¼šè‡ªåŠ¨ç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸éœ€è¦ç”¨æˆ·å¹²é¢„ï¼Œå› æ­¤ï¼Œç”¨æˆ·ä¸€èˆ¬ä¸éœ€è¦ç›´æ¥ç”¨  <code>LOCK TABLE</code> å‘½ä»¤ç»™ MyISAM è¡¨æ˜¾å¼åŠ é”ã€‚</p><p>æ˜¾ç¤ºåŠ è¡¨é”è¯­æ³•ï¼š</p></blockquote><ul><li>åŠ è¯»é”</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock table table_name read;</span><br></pre></td></tr></table></figure><ul><li>åŠ è¯»é”</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock table table_name write;</span><br></pre></td></tr></table></figure><ul><li>è¯»è¯»å…±äº«ï¼Œè¯»å†™äº’æ–¥ï¼Œå†™å†™äº’æ–¥ã€‚</li></ul><h3 id="2ã€è¯»é”æ¡ˆä¾‹"><a href="#2ã€è¯»é”æ¡ˆä¾‹" class="headerlink" title="2ã€è¯»é”æ¡ˆä¾‹"></a>2ã€è¯»é”æ¡ˆä¾‹</h3><ul><li>å‡†å¤‡ç¯å¢ƒ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tb_book&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;           INT(11) auto_increment,</span><br><span class="line">    &#96;name&#96;         VARCHAR(50) DEFAULT NULL,</span><br><span class="line">    &#96;publish_time&#96; DATE        DEFAULT NULL,</span><br><span class="line">    &#96;status&#96;       CHAR(1)     DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE &#x3D; myisam</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO tb_book (id, name, publish_time, status)</span><br><span class="line">VALUES (NULL, &#39;javaç¼–ç¨‹æ€</span><br><span class="line">æƒ³&#39;, &#39;2088-08-01&#39;, &#39;1&#39;);</span><br><span class="line">INSERT INTO tb_book (id, name, publish_time, status)</span><br><span class="line">VALUES (NULL, &#39;solrç¼–ç¨‹æ€æƒ³&#39;, &#39;2088-08-08&#39;, &#39;0&#39;);</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;tb_user&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;   INT(11) auto_increment,</span><br><span class="line">    &#96;name&#96; VARCHAR(50) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE &#x3D; myisam</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">INSERT INTO tb_user (id, name) VALUES(NULL,&#39;ä»¤ç‹å†²&#39;);</span><br><span class="line">INSERT INTO tb_user (id, name) VALUES(NULL,&#39;ç”°ä¼¯å…‰&#39;);</span><br></pre></td></tr></table></figure><blockquote><p>æ‰“å¼€ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯ä¸€å¯¹ <code>tb_book</code> åŠ ä¸€ä¸ªè¯»é”ï¼Œç„¶åæ‰§è¡ŒæŸ¥è¯¢è¯­å¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lock table tb_book read;</span><br><span class="line">select * from tb_book;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311142350.png" alt="image-20210311142350179"></p><blockquote><p>æ­¤æ—¶åœ¨ç¬¬äºŒä¸ªå®¢æˆ·ç«¯ä¸­ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡º <code>tb_book</code> ä¸­çš„æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºè¯»é”æ˜¯ <strong>å…±äº«é”</strong> </p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311142638.png" alt="image-20210311142638815"></p><blockquote><p>è¿™ä¸ªæ—¶å€™åœ¨ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ä¸­æ˜¯æ— æ³•æ“ä½œå…¶ä»–è¡¨çš„</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311142730.png" alt="image-20210311142730459"></p><blockquote><p>åœ¨ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ä¸­ä¹Ÿæ— æ³•å¯¹ <code>tb_book</code> è¿›è¡Œ <strong>å¢åˆ æ”¹</strong> æ“ä½œ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_book set name &#x3D; &#39;wuhu&#39; where id &#x3D; 2;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311143054.png" alt="image-20210311143054009"></p><blockquote><p>è¿™ä¸ªæ—¶å€™åœ¨ç¬¬äºŒä¸ªå®¢æˆ·ç«¯ä¸­è¿›è¡Œ å¢åˆ æ”¹ æ“ä½œæ—¶å°†ä¼šé˜»å¡ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯é‡Šæ”¾è¯»é”ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311143227.png" alt="image-20210311143227420"></p><blockquote><p>åœ¨ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ä¸­é‡Šæ”¾è¯»é”</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311144038.png" alt="image-20210311144038130"></p><blockquote><p>ç¬¬äºŒä¸ªå®¢æˆ·ç«¯é©¬ä¸Šæ‰§è¡Œæ›´æ–°æ“ä½œ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311144106.png" alt="image-20210311144106554"></p><h3 id="3ã€å†™é”æ¡ˆä¾‹"><a href="#3ã€å†™é”æ¡ˆä¾‹" class="headerlink" title="3ã€å†™é”æ¡ˆä¾‹"></a>3ã€å†™é”æ¡ˆä¾‹</h3><ul><li>åœ¨å®¢æˆ·ç«¯ä¸€ä¸­ä¸º <code>tb_book</code> è¡¨åŠ ä¸Šä¸€ä¸ªå†™é”</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock table tb_book write;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶åœ¨å®¢æˆ·ç«¯ä¸€ä¸­ä»ç„¶å¯ä»¥æŸ¥è¯¢æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_book;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311144838.png" alt="image-20210311144838393"></p><blockquote><p>åœ¨å®¢æˆ·ç«¯ä¸€ä¸­ï¼Œå¯ä»¥å¯¹è¡¨ <code>tb_book</code> è¿›è¡Œå†™æ“ä½œï¼ˆå¢åˆ æ”¹ï¼‰</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_book set name &#x3D; &#39;qifei&#39; where id &#x3D; 2;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311144949.png" alt="image-20210311144949347"></p><ul><li>åœ¨å®¢æˆ·ç«¯äºŒä¸­è¿›è¡Œæ“ä½œ</li></ul><blockquote><p>åœ¨å®¢æˆ·ç«¯äºŒä¸­ä½¿ç”¨ <code>select</code> è¿›è¡Œè¯»æ“ä½œï¼Œå‘ç°è¿›å…¥ç­‰å¾…çŠ¶æ€</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311145440.png" alt="image-20210311145440874"></p><blockquote><p>åœ¨å®¢æˆ·ç«¯ä¸€ä¸­é‡Šæ”¾é”åï¼Œå®¢æˆ·ç«¯äºŒä¸­çš„æŒ‡ä»¤è¢«ç«‹å³æ‰§è¡Œã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311145624.png" alt="image-20210311145624833"></p><h3 id="4ã€ç»“è®º"><a href="#4ã€ç»“è®º" class="headerlink" title="4ã€ç»“è®º"></a>4ã€ç»“è®º</h3><blockquote><p>é”æ¨¡å¼çš„ç›¸äº’å…¼å®¹æ€§å¦‚è¡¨æ‰€ç¤ºï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311150933.png" alt="image-20210311150933537"></p><blockquote><p>ç”±ä¸Šè¡¨å¯è§ï¼š</p></blockquote><ul><li>å¯¹MyISAM   è¡¨çš„è¯»æ“ä½œï¼Œä¸ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡å¯¹åŒä¸€è¡¨çš„å†™è¯·æ±‚ï¼›</li><li>å¯¹MyISAM   è¡¨çš„å†™æ“ä½œï¼Œåˆ™ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»å’Œå†™æ“ä½œï¼›</li></ul><blockquote><p>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯»é”ä¼šé˜»å¡å†™ï¼Œä½†æ˜¯ä¸ä¼šé˜»å¡è¯»ã€‚è€Œå†™é”ï¼Œåˆ™æ—¢ä¼šé˜»å¡è¯»ï¼Œåˆä¼šé˜»å¡å†™ã€‚</p><p>æ­¤å¤–ï¼ŒMyISAM çš„è¯»å†™é”è°ƒåº¦æ˜¯å†™ä¼˜å…ˆï¼Œè¿™ä¹Ÿæ˜¯MyISAMä¸é€‚åˆåšå†™ä¸ºä¸»çš„è¡¨çš„å­˜å‚¨å¼•æ“çš„åŸå› ã€‚å› ä¸ºå†™é”åï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½åšä»»ä½•æ“ä½œï¼Œå¤§é‡çš„æ›´æ–°ä¼šä½¿æŸ¥è¯¢å¾ˆéš¾å¾—åˆ°é”ï¼Œä»è€Œé€ æˆæ°¸è¿œé˜»å¡ã€‚</p></blockquote><ul><li>MyISAMä¸é€‚åˆåšè¯»è¡¨çš„å­˜å‚¨å¼•æ“</li></ul><h2 id="5-4ã€InnoDBè¡Œé”"><a href="#5-4ã€InnoDBè¡Œé”" class="headerlink" title="5.4ã€InnoDBè¡Œé”"></a>5.4ã€InnoDBè¡Œé”</h2><h3 id="1ã€è¡Œé”ä»‹ç»"><a href="#1ã€è¡Œé”ä»‹ç»" class="headerlink" title="1ã€è¡Œé”ä»‹ç»"></a>1ã€è¡Œé”ä»‹ç»</h3><blockquote><p>è¡Œé”ç‰¹ç‚¹ ï¼š</p></blockquote><ul><li>åå‘ <code>InnoDB</code> å­˜å‚¨å¼•æ“ï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›</li><li>ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</li></ul><blockquote><p><code>InnoDB</code>  ä¸  <code>MyISAM</code>  çš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼›äºŒæ˜¯ é‡‡ç”¨äº†è¡Œçº§é”ã€‚</p></blockquote><h3 id="2ã€èƒŒæ™¯çŸ¥è¯†"><a href="#2ã€èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="2ã€èƒŒæ™¯çŸ¥è¯†"></a>2ã€èƒŒæ™¯çŸ¥è¯†</h3><ul><li>äº‹åŠ¡åŠå…¶ACIDå±æ€§</li></ul><blockquote><p>äº‹åŠ¡æ˜¯ç”±ä¸€ç»„SQLè¯­å¥ç»„æˆçš„é€»è¾‘å¤„ç†å•å…ƒã€‚</p><p>äº‹åŠ¡å…·æœ‰ä»¥ä¸‹4ä¸ªç‰¹æ€§ï¼Œç®€ç§°ä¸ºäº‹åŠ¡ACIDå±æ€§ã€‚</p></blockquote><table><thead><tr><th>ACIDå±æ€§</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>åŸå­æ€§ï¼ˆAtomicityï¼‰</td><td>äº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œå•å…ƒï¼Œå…¶å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</td></tr><tr><td>ä¸€è‡´æ€§ï¼ˆConsistentï¼‰</td><td>åœ¨äº‹åŠ¡å¼€å§‹å’Œå®Œæˆæ—¶ï¼Œæ•°æ®éƒ½å¿…é¡»ä¿æŒä¸€è‡´çŠ¶æ€ã€‚</td></tr><tr><td>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</td><td>æ•°æ®åº“ç³»ç»Ÿæä¾›ä¸€å®šçš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ â€œç‹¬ç«‹â€ ç¯å¢ƒä¸‹è¿è¡Œã€‚</td></tr><tr><td>æŒä¹…æ€§ï¼ˆDurableï¼‰</td><td>äº‹åŠ¡å®Œæˆä¹‹åï¼Œå¯¹äºæ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…çš„ã€‚</td></tr></tbody></table><ul><li>å¹¶å‘äº‹åŠ¡å¤„ç†å¸¦æ¥çš„é—®é¢˜</li></ul><table><thead><tr><th>é—®é¢˜</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ä¸¢å¤±æ›´æ–°ï¼ˆLost Updateï¼‰</td><td>å½“ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡é€‰æ‹©åŒä¸€è¡Œï¼Œæœ€åˆçš„äº‹åŠ¡ä¿®æ”¹çš„å€¼ï¼Œä¼šè¢«åé¢çš„äº‹åŠ¡ä¿®æ”¹çš„å€¼è¦†ç›–ã€‚</td></tr><tr><td>è„è¯»ï¼ˆDirty Readsï¼‰</td><td>å½“ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è®¿é—®æ•°æ®ï¼Œå¹¶ä¸”å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹ï¼Œè€Œè¿™ç§ä¿®æ”¹è¿˜æ²¡æœ‰æäº¤åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿè®¿é—®è¿™ä¸ªæ•°æ®ï¼Œç„¶åä½¿ç”¨äº†è¿™ä¸ªæ•°æ®ã€‚</td></tr><tr><td>ä¸å¯é‡å¤è¯»ï¼ˆNon- Repeatable Readsï¼‰</td><td>ä¸€ä¸ªäº‹åŠ¡åœ¨è¯»å–æŸäº›æ•°æ®åçš„æŸä¸ªæ—¶é—´ï¼Œå†æ¬¡è¯»å–ä»¥å‰è¯»è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å’Œä»¥å‰è¯»å‡ºçš„æ•°æ®ä¸ä¸€è‡´ã€‚</td></tr><tr><td>å¹»è¯»ï¼ˆPhantom Readsï¼‰</td><td>ä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶é‡æ–°è¯»å–ä»¥å‰æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œå´å‘ç°å…¶ä»–äº‹åŠ¡æ’å…¥äº†æ»¡è¶³å…¶æŸ¥è¯¢æ¡ä»¶çš„æ–°æ•°æ®ã€‚</td></tr></tbody></table><ul><li>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</li></ul><blockquote><p>ä¸ºäº†è§£å†³ä¸Šè¿°æåˆ°çš„äº‹åŠ¡å¹¶å‘é—®é¢˜ï¼Œæ•°æ®åº“æä¾›ä¸€å®šçš„äº‹åŠ¡éš”ç¦»æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ•°æ®åº“çš„äº‹åŠ¡éš”ç¦»è¶Šä¸¥æ ¼ï¼Œå¹¶å‘å‰¯ä½œç”¨è¶Šå°ï¼Œä½†ä»˜å‡ºçš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œå› ä¸ºäº‹åŠ¡éš”ç¦»å®è´¨ä¸Šå°±æ˜¯ä½¿ç”¨äº‹åŠ¡åœ¨ä¸€å®šç¨‹åº¦ä¸Šâ€œä¸²è¡ŒåŒ–â€ è¿›è¡Œï¼Œè¿™æ˜¾ç„¶ä¸â€œå¹¶å‘â€ æ˜¯çŸ›ç›¾çš„ã€‚<br>æ•°æ®åº“çš„éš”ç¦»çº§åˆ«æœ‰4ä¸ªï¼Œç”±ä½åˆ°é«˜ä¾æ¬¡ä¸ºRead uncommittedã€Read committedã€Repeatable readã€ Serializableï¼Œè¿™å››ä¸ªçº§åˆ«å¯ä»¥é€ä¸ªè§£å†³è„å†™ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»è¿™å‡ ç±»é—®é¢˜ã€‚</p></blockquote><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>ä¸¢å¤±æ›´æ–°(è„å†™)</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>Read uncommitted</td><td>Ã—</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Read committed</td><td>Ã—</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Repeatable  readï¼ˆé»˜è®¤ï¼‰</td><td>Ã—</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>Serializable</td><td>Ã—</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><p>å¤‡æ³¨ï¼šâˆš ä»£è¡¨å¯èƒ½å‡ºç° ï¼Œ Ã— ä»£è¡¨ä¸ä¼šå‡ºç° ã€‚</p><ul><li>MySQL çš„æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ä¸ºï¼š<code>Repeatable  read</code> ï¼ŒæŸ¥çœ‹æ–¹å¼ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;tx_isolation&#39;;</span><br></pre></td></tr></table></figure><h3 id="3ã€InnoDBçš„è¡Œé”æ¨¡å¼"><a href="#3ã€InnoDBçš„è¡Œé”æ¨¡å¼" class="headerlink" title="3ã€InnoDBçš„è¡Œé”æ¨¡å¼"></a>3ã€InnoDBçš„è¡Œé”æ¨¡å¼</h3><blockquote><p>InnoDB  å®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ã€‚</p></blockquote><ul><li>å…±äº«é”ï¼ˆSï¼‰ï¼šåˆç§°ä¸ºè¯»é”ï¼Œç®€ç§°Sé”ï¼Œå…±äº«é”å°±æ˜¯å¤šä¸ªäº‹åŠ¡å¯¹äºåŒä¸€æ•°æ®å¯ä»¥å…±äº«ä¸€æŠŠé”ï¼Œéƒ½èƒ½è®¿é—®åˆ°æ•°æ®ï¼Œä½†æ˜¯åªèƒ½è¯»ä¸èƒ½ä¿®æ”¹ã€‚</li><li>æ’ä»–é”ï¼ˆXï¼‰ï¼šåˆç§°ä¸ºå†™é”ï¼Œç®€ç§°Xé”ï¼Œæ’ä»–é”å°±æ˜¯ä¸èƒ½ä¸å…¶ä»–é”å¹¶å­˜ï¼Œå¦‚ä¸€ä¸ªäº‹åŠ¡è·å–äº†ä¸€ä¸ªæ•°æ®è¡Œçš„æ’ä»–é”ï¼Œå…¶ä»–äº‹åŠ¡å°±ä¸èƒ½å†è·å–è¯¥è¡Œçš„å…¶ä»–é”ï¼ŒåŒ…æ‹¬å…±äº«é”å’Œæ’ä»–é”ï¼Œä½†æ˜¯è·å–æ’ä»–é”çš„äº‹åŠ¡æ˜¯å¯ä»¥å¯¹æ•°æ®å°±è¡Œè¯»å–å’Œä¿®æ”¹ã€‚</li></ul><blockquote><p>å¯¹äºUPDATEã€DELETEå’ŒINSERTè¯­å¥ï¼ŒInnoDBä¼šè‡ªåŠ¨ç»™æ¶‰åŠæ•°æ®é›†åŠ æ’ä»–é”ï¼ˆX)ï¼›</p><p>å¯¹äºæ™®é€šSELECTè¯­å¥ï¼ŒInnoDBä¸ä¼šåŠ ä»»ä½•é”ï¼›</p></blockquote><ul><li>å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ˜¾å¼åœ°ç»™è®°å½•é›†åŠ å…±äº«é”æˆ–è€…æ’ä»–é”</li></ul><blockquote><p>å…±äº«é”ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * FROM table_name WHERE ... LOCK IN SHARE MODE</span><br></pre></td></tr></table></figure><blockquote><p>æ’ä»–é”ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * FROM table_name WHERE ... FOR UPDATE</span><br></pre></td></tr></table></figure><h3 id="4ã€æ¡ˆä¾‹ç¯å¢ƒå‡†å¤‡"><a href="#4ã€æ¡ˆä¾‹ç¯å¢ƒå‡†å¤‡" class="headerlink" title="4ã€æ¡ˆä¾‹ç¯å¢ƒå‡†å¤‡"></a>4ã€æ¡ˆä¾‹ç¯å¢ƒå‡†å¤‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">create table test_innodb_lock</span><br><span class="line">(</span><br><span class="line">    id   int(11),</span><br><span class="line">    name varchar(16),</span><br><span class="line">    sex  varchar(1)</span><br><span class="line">) engine &#x3D; innodb</span><br><span class="line">  default charset &#x3D; utf8;</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (1, &#39;100&#39;, &#39;1&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (3, &#39;3&#39;, &#39;1&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (4, &#39;400&#39;, &#39;0&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (5, &#39;500&#39;, &#39;1&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (6, &#39;600&#39;, &#39;0&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (7, &#39;700&#39;, &#39;0&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (8, &#39;800&#39;, &#39;1&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (9, &#39;900&#39;, &#39;1&#39;);</span><br><span class="line">insert into test_innodb_lock</span><br><span class="line">values (1, &#39;200&#39;, &#39;0&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create index idx_test_innodb_lock_id on test_innodb_lock (id);</span><br><span class="line">create index idx_test_innodb_lock_name on test_innodb_lock (name);</span><br></pre></td></tr></table></figure><h3 id="5ã€æ¼”ç¤º-InnoDB-çš„è¡Œé”"><a href="#5ã€æ¼”ç¤º-InnoDB-çš„è¡Œé”" class="headerlink" title="5ã€æ¼”ç¤º InnoDB çš„è¡Œé”"></a>5ã€æ¼”ç¤º <code>InnoDB</code> çš„è¡Œé”</h3><ul><li>æ‰“å¼€ä¸¤ä¸ªå‘½ä»¤è¡Œçª—å£ï¼Œè¿æ¥MySQLåå…³é—­è‡ªåŠ¨æäº¤</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set autocommit &#x3D; 0;</span><br></pre></td></tr></table></figure><ul><li>åœ¨çª—å£ä¸€æ‰§è¡Œä¸€æ¡ <code>update</code> è¯­å¥ï¼Œç„¶åä¸æäº¤</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update test_innodb_lock set name &#x3D; &#39;300&#39; where id &#x3D; 3;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311193546.png" alt="image-20210311193539183"></p><ul><li>åœ¨çª—å£äºŒæ‰§è¡Œä¸€æ¡ <code>update</code> è¯­å¥ï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update test_innodb_lock set name &#x3D; &#39;30&#39; where id &#x3D; 3;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311193747.png" alt="image-20210311193747699"></p><ul><li>æ­¤æ—¶åœ¨çª—å£ä¸€ä¸­æ‰§è¡Œ <code>commit</code> ï¼Œæäº¤äº‹åŠ¡ï¼Œå°±å¯ä»¥é‡Šæ”¾è¡Œé”ï¼Œæ‰§è¡Œçª—å£äºŒçš„æ“ä½œã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311193943.png" alt="image-20210311193943691"></p><p>æ³¨ï¼šå½“æ— ç´¢å¼•æˆ–è€…ç´¢å¼•å¤±æ•ˆæ—¶ï¼Œ<code>InnoDB</code>çš„è¡Œé”å°†å‡çº§ä¸ºè¡¨é”</p><h3 id="6ã€é—´éš™é”å±å®³"><a href="#6ã€é—´éš™é”å±å®³" class="headerlink" title="6ã€é—´éš™é”å±å®³"></a>6ã€é—´éš™é”å±å®³</h3><blockquote><p>å½“æˆ‘ä»¬<strong>ç”¨èŒƒå›´æ¡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®</strong>ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è¿›è¡ŒåŠ é”ï¼› </p><p><strong>å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åš â€œé—´éš™ï¼ˆGAPï¼‰â€ ï¼Œ InnoDBä¹Ÿä¼šå¯¹è¿™ä¸ª â€œé—´éš™â€ åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„ é—´éš™é”ï¼ˆNext-Keyé”ï¼‰ ã€‚</strong></p><p>å› ä¸ºQueryæ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œä»–ä¼šé”å®šæ•´ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„ç´¢å¼•é”®å€¼ï¼Œå³ä½¿è¿™ä¸ªé”®å€¼å¹¶ä¸å­˜åœ¨ã€‚</p><p>é—´éš™é”æœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„å¼±ç‚¹ï¼Œå°±æ˜¯å½“é”å®šä¸€ä¸ªèŒƒå›´é”®å€¼ä¹‹åï¼Œå³ä½¿æŸäº›ä¸å­˜åœ¨çš„é”®å€¼ä¹Ÿä¼šè¢«æ— è¾œçš„é”å®šï¼Œè€Œé€ æˆåœ¨é”å®šçš„æ—¶å€™æ— æ³•æ’å…¥é”å®šé”®å€¼èŒƒå›´å†…çš„ä»»ä½•æ•°æ®ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹è¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆå¾ˆå¤§çš„å±å®³</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311202823.png" alt="image-20210311202823816"></p><ul><li>å‡†å¤‡ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œå…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set autocommit &#x3D; 0;</span><br></pre></td></tr></table></figure><ul><li>åœ¨çª—å£ä¸€æ‰§è¡Œä¸€æ¡ <code>update</code> è¯­å¥ï¼Œåœ¨è¿™ä¹‹å‰æˆ‘ä»¬å…ˆæŸ¥è¯¢ä¸€ä¸‹ <code>test_innodb_lock</code> çš„æ•°æ®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from test_innodb_lock;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311203317.png" alt="image-20210311203317696"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update &#96;test_innodb_lock&#96; set sex &#x3D; &#39;2&#39; where id &lt; 4;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311203444.png" alt="image-20210311203444361"></p><ul><li>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†ç¬¬äºŒä¸ªçª—å£æ’å…¥ä¸€æ¡ <code>id</code> ä¸º2çš„æ•°æ®ï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into test_innodb_lock values(2,&#39;2000&#39;,&#39;1&#39;);</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311203717.png" alt="image-20210311203716889"></p><blockquote><p>åœ¨ç¬¬ä¸€ä¸ªçª—å£æäº¤äº‹åŠ¡ï¼Œå¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªçª—å£è¢«é˜»å¡çš„<code>insert</code> æ‰§è¡ŒæˆåŠŸã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311203914.png" alt="image-20210311203914384"></p><blockquote><p>å¯ä»¥ä½¿ç”¨é€»è¾‘åˆ é™¤æ¥ä»£æ›¿ç‰©ç†åˆ é™¤</p></blockquote><h3 id="7ã€æŸ¥çœ‹InnoDBè¡Œé”äº‰ç”¨æƒ…å†µ"><a href="#7ã€æŸ¥çœ‹InnoDBè¡Œé”äº‰ç”¨æƒ…å†µ" class="headerlink" title="7ã€æŸ¥çœ‹InnoDBè¡Œé”äº‰ç”¨æƒ…å†µ"></a>7ã€æŸ¥çœ‹<code>InnoDB</code>è¡Œé”äº‰ç”¨æƒ…å†µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like &#39;innodb_row_lock%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210311204125.png" alt="image-20210311204125281"></p><blockquote><p>å‚æ•°è¯´æ˜</p></blockquote><ul><li><code>Innodb_row_lock_current_waits</code>:  å½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡</li><li><code>Innodb_row_lock_time</code>:  ä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦</li><li><code>Innodb_row_lock_time_avg</code>ï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é•¿</li><li><code>Innodb_row_lock_time_max</code>ï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€é•¿çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´</li><li><code>Innodb_row_lock_waits</code>ï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°</li></ul><blockquote><p>å½“ç­‰å¾…çš„æ¬¡æ•°å¾ˆé«˜ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…çš„æ—¶é•¿ä¹Ÿä¸å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ†æç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆä¼šæœ‰å¦‚æ­¤å¤šçš„ç­‰å¾…ï¼Œç„¶åæ ¹æ®åˆ†æç»“æœç€æ‰‹åˆ¶å®šä¼˜åŒ–è®¡åˆ’ã€‚</p></blockquote><h3 id="8ã€æ€»ç»“"><a href="#8ã€æ€»ç»“" class="headerlink" title="8ã€æ€»ç»“"></a>8ã€æ€»ç»“</h3><blockquote><p><code>InnoDB</code> å­˜å‚¨å¼•æ“ç”±äºå®ç°äº†è¡Œçº§é”å®šï¼Œè™½ç„¶åœ¨é”å®šæœºåˆ¶çš„å®ç°æ–¹é¢å¸¦æ¥äº†æ€§èƒ½æŸè€—å¯èƒ½æ¯”è¡¨é”ä¼šæ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯åœ¨æ•´ä½“å¹¶å‘å¤„ç†èƒ½åŠ›æ–¹é¢è¦è¿œè¿œä¼˜äº <code>MyISAM</code> çš„è¡¨é”çš„ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡è¾ƒé«˜çš„æ—¶å€™ï¼Œ <code>InnoDB</code> çš„æ•´ä½“æ€§èƒ½å’Œ <code>MyISAM</code> ç›¸æ¯”å°±ä¼šæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä¼˜åŠ¿ã€‚<br>ä½†æ˜¯ï¼Œ<code>InnoDB</code> çš„è¡Œçº§é”åŒæ ·ä¹Ÿæœ‰å…¶è„†å¼±çš„ä¸€é¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸å½“çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè®© <code>InnoDB</code> çš„æ•´ä½“æ€§èƒ½è¡¨ç°ä¸ä»…ä¸èƒ½æ¯” <code>MyISAM</code>é«˜ï¼Œç”šè‡³å¯èƒ½ä¼šæ›´å·®ã€‚</p><p>ä¼˜åŒ–å»ºè®®ï¼š</p></blockquote><ul><li><strong>å°½å¯èƒ½è®©æ‰€æœ‰æ•°æ®æ£€ç´¢éƒ½èƒ½é€šè¿‡ç´¢å¼•æ¥å®Œæˆï¼Œé¿å…æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”ã€‚</strong></li><li>åˆç†è®¾è®¡ç´¢å¼•ï¼Œå°½é‡ç¼©å°é”çš„èŒƒå›´</li><li>å°½å¯èƒ½å‡å°‘ç´¢å¼•æ¡ä»¶ï¼ŒåŠç´¢å¼•èŒƒå›´ï¼Œé¿å…é—´éš™é”å°½é‡æ§åˆ¶äº‹åŠ¡å¤§å°ï¼Œå‡å°‘é”å®šèµ„æºé‡å’Œæ—¶é—´é•¿åº¦</li><li>å°½å¯ä½¿ç”¨ä½çº§åˆ«äº‹åŠ¡éš”ç¦»<strong>ï¼ˆä½†æ˜¯éœ€è¦ä¸šåŠ¡å±‚é¢æ»¡è¶³éœ€æ±‚ï¼‰</strong></li></ul><h1 id="å…­ã€å¸¸ç”¨SQLæŠ€å·§"><a href="#å…­ã€å¸¸ç”¨SQLæŠ€å·§" class="headerlink" title="å…­ã€å¸¸ç”¨SQLæŠ€å·§"></a>å…­ã€å¸¸ç”¨SQLæŠ€å·§</h1><h2 id="6-1ã€SQLæ‰§è¡Œé¡ºåº"><a href="#6-1ã€SQLæ‰§è¡Œé¡ºåº" class="headerlink" title="6.1ã€SQLæ‰§è¡Œé¡ºåº"></a>6.1ã€SQLæ‰§è¡Œé¡ºåº</h2><h3 id="1ã€ç¼–å†™é¡ºåº"><a href="#1ã€ç¼–å†™é¡ºåº" class="headerlink" title="1ã€ç¼–å†™é¡ºåº"></a>1ã€ç¼–å†™é¡ºåº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT </span><br><span class="line">    &lt;select list&gt;</span><br><span class="line">FROM </span><br><span class="line">     &lt;left_table&gt; &lt;join_type&gt;</span><br><span class="line">JOIN </span><br><span class="line">     &lt;right_table&gt; ON &lt;join_condition&gt;</span><br><span class="line">WHERE</span><br><span class="line">    &lt;where_condition&gt;</span><br><span class="line">GROUP BY </span><br><span class="line">    &lt;group_by_list&gt;</span><br><span class="line">HAVING</span><br><span class="line">    &lt;having_condition&gt;</span><br><span class="line">ORDER BY </span><br><span class="line">    &lt;order_by_condition&gt;</span><br><span class="line">LIMIT </span><br><span class="line">    &lt;limit_params&gt;</span><br></pre></td></tr></table></figure><p><code>s f j w g h o l</code></p><h3 id="2ã€æ‰§è¡Œé¡ºåº"><a href="#2ã€æ‰§è¡Œé¡ºåº" class="headerlink" title="2ã€æ‰§è¡Œé¡ºåº"></a>2ã€æ‰§è¡Œé¡ºåº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FROM </span><br><span class="line">    &lt;left_table&gt;</span><br><span class="line">ON </span><br><span class="line">    &lt;join_condition&gt;</span><br><span class="line">    &lt;join_type&gt;JOIN &lt;right_table&gt;</span><br><span class="line">WHERE </span><br><span class="line">    &lt;where_condition&gt;</span><br><span class="line">GROUP BY </span><br><span class="line">    &lt;group_by_list&gt;</span><br><span class="line">HAVING </span><br><span class="line">    &lt;having_condition&gt;</span><br><span class="line">SELECT DISTINCT</span><br><span class="line">    &lt;select list&gt;</span><br><span class="line">ORDER BY </span><br><span class="line">    &lt;order_by_condition&gt;</span><br><span class="line">LIMIT</span><br><span class="line">    &lt;limit_params&gt;</span><br></pre></td></tr></table></figure><p><code>f j w g h s o l </code></p><ul><li>å…ˆæŒ‡å®šä»å“ªä¸€å¼ æˆ–å“ªå‡ å¼ è¡¨ä¸­æŸ¥è¯¢æ•°æ®ï¼ˆè®¾è®¡è”è¡¨åŠè”è¡¨æ¡ä»¶ï¼‰</li><li>æ ¹æ®ä»€ä¹ˆæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢ï¼Ÿï¼ˆwhereè¿›è¡Œä¸€æ¬¡è¿‡æ»¤ï¼‰</li><li>æ ¹æ®ä»€ä¹ˆæ¡ä»¶è¿›è¡Œåˆ†ç»„ï¼ˆgroup byï¼‰</li><li>å¯¹ä¸Šé¢çš„ç»“æœè¿›è¡ŒäºŒæ¬¡è¿‡æ»¤ï¼ˆhavingï¼‰</li><li>ä»äºŒæ¬¡è¿‡æ»¤çš„ç»“æœä¸­æŒ‘é€‰å‡ºè¦å–å¾—çš„ç»“æœåˆ—</li><li>æœ€åè¿›è¡Œæ’åºå’Œåˆ†é¡µã€‚</li></ul><h2 id="6-2ã€æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨"><a href="#6-2ã€æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨" class="headerlink" title="6.2ã€æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨"></a>6.2ã€æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨</h2><blockquote><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯æŒ‡ä¸€ä¸ªç”¨æ¥æè¿°æˆ–è€…åŒ¹é…ä¸€ç³»åˆ—ç¬¦åˆæŸä¸ªå¥æ³•è§„åˆ™çš„å­—ç¬¦ä¸²çš„å•ä¸ªå­—ç¬¦ä¸²ã€‚</p></blockquote><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>^</td><td>åœ¨å­—ç¬¦ä¸²å¼€å§‹å¤„è¿›è¡ŒåŒ¹é…</td></tr><tr><td>$</td><td>åœ¨å­—ç¬¦ä¸²æœ«å°¾å¤„è¿›è¡ŒåŒ¹é…</td></tr><tr><td>.</td><td>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦,  åŒ…æ‹¬æ¢è¡Œç¬¦</td></tr><tr><td>[â€¦]</td><td>åŒ¹é…å‡ºæ‹¬å·å†…çš„ä»»æ„å­—ç¬¦</td></tr><tr><td>[^â€¦]</td><td>åŒ¹é…ä¸å‡ºæ‹¬å·å†…çš„ä»»æ„å­—ç¬¦</td></tr><tr><td>a*</td><td>åŒ¹é…é›¶ä¸ªæˆ–è€…å¤šä¸ªa(åŒ…æ‹¬ç©ºä¸²)</td></tr><tr><td>a+</td><td>åŒ¹é…ä¸€ä¸ªæˆ–è€…å¤šä¸ªa(ä¸åŒ…æ‹¬ç©ºä¸²)</td></tr><tr><td>a?</td><td>åŒ¹é…é›¶ä¸ªæˆ–è€…ä¸€ä¸ªa</td></tr><tr><td>a1|a2</td><td>åŒ¹é…a1æˆ–a2</td></tr><tr><td>a(m)</td><td>åŒ¹é…mä¸ªa</td></tr><tr><td>a(m,)</td><td>è‡³å°‘åŒ¹é…mä¸ªa</td></tr><tr><td>a(m,n)</td><td>åŒ¹é…mä¸ªa åˆ° nä¸ªa</td></tr><tr><td>a(,n)</td><td>åŒ¹é…0åˆ°nä¸ªa</td></tr><tr><td>(â€¦)</td><td>å°†æ¨¡å¼å…ƒç´ ç»„æˆå•ä¸€å…ƒç´ </td></tr></tbody></table><h2 id="6-3ã€MySQLå¸¸ç”¨å‡½æ•°"><a href="#6-3ã€MySQLå¸¸ç”¨å‡½æ•°" class="headerlink" title="6.3ã€MySQLå¸¸ç”¨å‡½æ•°"></a>6.3ã€MySQLå¸¸ç”¨å‡½æ•°</h2><h3 id="1ã€æ•°å­—å‡½æ•°"><a href="#1ã€æ•°å­—å‡½æ•°" class="headerlink" title="1ã€æ•°å­—å‡½æ•°"></a>1ã€æ•°å­—å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ABS</td><td>æ±‚ç»å¯¹å€¼</td></tr><tr><td>SQRT</td><td>æ±‚äºŒæ¬¡æ–¹æ ¹</td></tr><tr><td>MOD</td><td>æ±‚ä½™æ•°</td></tr><tr><td>CEIL å’Œ CEILING</td><td>ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯è¿”å›ä¸å°äºå‚æ•°çš„æœ€å°æ•´æ•°ï¼Œå³å‘ä¸Šå–æ•´</td></tr><tr><td>FLOOR</td><td>å‘ä¸‹å–æ•´ï¼Œè¿”å›å€¼è½¬åŒ–ä¸ºä¸€ä¸ªBIGINT</td></tr><tr><td>RAND</td><td>ç”Ÿæˆä¸€ä¸ª0~1ä¹‹é—´çš„éšæœºæ•°ï¼Œä¼ å…¥æ•´æ•°å‚æ•°æ˜¯ï¼Œç”¨æ¥äº§ç”Ÿé‡å¤åºåˆ—</td></tr><tr><td>ROUND</td><td>å¯¹æ‰€ä¼ å‚æ•°è¿›è¡Œå››èˆäº”å…¥</td></tr><tr><td>SIGN</td><td>è¿”å›å‚æ•°çš„ç¬¦å·</td></tr><tr><td>POW å’Œ POWER</td><td>ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯æ‰€ä¼ å‚æ•°çš„æ¬¡æ–¹çš„ç»“æœå€¼</td></tr><tr><td>SIN</td><td>æ±‚æ­£å¼¦å€¼</td></tr><tr><td>ASIN</td><td>æ±‚åæ­£å¼¦å€¼ï¼Œä¸å‡½æ•°  SIN äº’ä¸ºåå‡½æ•°</td></tr><tr><td>COS</td><td>æ±‚ä½™å¼¦å€¼</td></tr><tr><td>ACOS</td><td>æ±‚åä½™å¼¦å€¼ï¼Œä¸å‡½æ•°  COS äº’ä¸ºåå‡½æ•°</td></tr><tr><td>TAN</td><td>æ±‚æ­£åˆ‡å€¼</td></tr><tr><td>ATAN</td><td>æ±‚åæ­£åˆ‡å€¼ï¼Œä¸å‡½æ•°  TAN äº’ä¸ºåå‡½æ•°</td></tr><tr><td>COT</td><td>æ±‚ä½™åˆ‡å€¼</td></tr></tbody></table><h3 id="2ã€å­—ç¬¦ä¸²å‡½æ•°"><a href="#2ã€å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="2ã€å­—ç¬¦ä¸²å‡½æ•°"></a>2ã€å­—ç¬¦ä¸²å‡½æ•°</h3><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>LENGTH</td><td>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦</td></tr><tr><td>CONCAT</td><td>åˆå¹¶å­—ç¬¦ä¸²å‡½æ•°ï¼Œè¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œå‚æ•°å¯ä»¥ä½¿ä¸€ä¸ªæˆ–å¤šä¸ª</td></tr><tr><td>INSERT</td><td>æ›¿æ¢å­—ç¬¦ä¸²å‡½æ•°</td></tr><tr><td>LOWER</td><td>å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå°å†™</td></tr><tr><td>UPPER</td><td>å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå¤§å†™</td></tr><tr><td>LEFT</td><td>ä»å·¦ä¾§å­—æˆªå–ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²å·¦è¾¹çš„è‹¥å¹²ä¸ªå­—ç¬¦</td></tr><tr><td>RIGHT</td><td>ä»å³ä¾§å­—æˆªå–ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²å³è¾¹çš„è‹¥å¹²ä¸ªå­—ç¬¦</td></tr><tr><td>TRIM</td><td>åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤ä¾§çš„ç©ºæ ¼</td></tr><tr><td>REPLACE</td><td>å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ï¼Œè¿”å›æ›¿æ¢åçš„æ–°å­—ç¬¦ä¸²</td></tr><tr><td>SUBSTRING</td><td>æˆªå–å­—ç¬¦ä¸²ï¼Œè¿”å›ä»æŒ‡å®šä½ç½®å¼€å§‹çš„æŒ‡å®šé•¿åº¦çš„å­—ç¬¦æ¢</td></tr><tr><td>REVERSE</td><td>å­—ç¬¦ä¸²åè½¬ï¼ˆé€†åºï¼‰å‡½æ•°ï¼Œè¿”å›ä¸åŸå§‹å­—ç¬¦ä¸²é¡ºåºç›¸åçš„å­—ç¬¦ä¸²</td></tr></tbody></table><h3 id="3ã€æ—¥æœŸå‡½æ•°"><a href="#3ã€æ—¥æœŸå‡½æ•°" class="headerlink" title="3ã€æ—¥æœŸå‡½æ•°"></a>3ã€æ—¥æœŸå‡½æ•°</h3><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>CURDATE  å’Œ CURRENT_DATE</td><td>ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå€¼</td></tr><tr><td>CURTIME å’Œ CURRENT_TIME</td><td>ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¶é—´å€¼</td></tr><tr><td>NOW å’Œ SYSDATE</td><td>ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´å€¼</td></tr><tr><td>MONTH</td><td>è·å–æŒ‡å®šæ—¥æœŸä¸­çš„æœˆä»½</td></tr><tr><td>MONTHNAME</td><td>è·å–æŒ‡å®šæ—¥æœŸä¸­çš„æœˆä»½è‹±æ–‡åç§°</td></tr><tr><td>DAYNAME</td><td>è·å–æŒ‡å®šæ›°æœŸå¯¹åº”çš„æ˜ŸæœŸå‡ çš„è‹±æ–‡åç§°</td></tr><tr><td>DAYOFWEEK</td><td>è·å–æŒ‡å®šæ—¥æœŸå¯¹åº”çš„ä¸€å‘¨çš„ç´¢å¼•ä½ç½®å€¼</td></tr><tr><td>WEEK</td><td>è·å–æŒ‡å®šæ—¥æœŸæ˜¯ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ï¼Œè¿”å›å€¼çš„èŒƒå›´æ˜¯å¦ä¸º  0ã€œ52  æˆ– 1ã€œ53</td></tr><tr><td>DAYOFYEAR</td><td>è·å–æŒ‡å®šæ›°æœŸæ˜¯ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯1~366</td></tr><tr><td>DAYOFMONTH</td><td>è·å–æŒ‡å®šæ—¥æœŸæ˜¯ä¸€ä¸ªæœˆä¸­æ˜¯ç¬¬å‡ å¤©ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯1~31</td></tr><tr><td>YEAR</td><td>è·å–å¹´ä»½ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯  1970ã€œ2069</td></tr><tr><td>TIME_TO_SEC</td><td>å°†æ—¶é—´å‚æ•°è½¬æ¢ä¸ºç§’æ•°</td></tr><tr><td>SEC_TO_TIME</td><td>å°†ç§’æ•°è½¬æ¢ä¸ºæ—¶é—´ï¼Œä¸TIME_TO_SEC  äº’ä¸ºåå‡½æ•°</td></tr><tr><td>DATE_ADD å’Œ ADDDATE</td><td>ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯å‘æ—¥æœŸæ·»åŠ æŒ‡å®šçš„æ—¶é—´é—´éš”</td></tr><tr><td>DATE_SUB å’Œ SUBDATE</td><td>ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯å‘æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš”</td></tr><tr><td>ADDTIME</td><td>æ—¶é—´åŠ æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šæ·»åŠ æŒ‡å®šçš„æ—¶é—´</td></tr><tr><td>SUBTIME</td><td>æ—¶é—´å‡æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šå‡å»æŒ‡å®šçš„æ—¶é—´</td></tr><tr><td>DATEDIFF</td><td>è·å–ä¸¤ä¸ªæ—¥æœŸä¹‹é—´é—´éš”ï¼Œè¿”å›å‚æ•° 1 å‡å»å‚æ•° 2 çš„å€¼</td></tr><tr><td>DATE_FORMAT</td><td>æ ¼å¼åŒ–æŒ‡å®šçš„æ—¥æœŸï¼Œæ ¹æ®å‚æ•°è¿”å›æŒ‡å®šæ ¼å¼çš„å€¼</td></tr><tr><td>WEEKDAY</td><td>è·å–æŒ‡å®šæ—¥æœŸåœ¨ä¸€å‘¨å†…çš„å¯¹åº”çš„å·¥ä½œæ—¥ç´¢å¼•</td></tr></tbody></table><h3 id="4ã€èšåˆå‡½æ•°"><a href="#4ã€èšåˆå‡½æ•°" class="headerlink" title="4ã€èšåˆå‡½æ•°"></a>4ã€èšåˆå‡½æ•°</h3><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>MAX</td><td>æŸ¥è¯¢æŒ‡å®šåˆ—çš„æœ€å¤§å€¼</td></tr><tr><td>MIN</td><td>æŸ¥è¯¢æŒ‡å®šåˆ—çš„æœ€å°å€¼</td></tr><tr><td>COUNT</td><td>ç»Ÿè®¡æŸ¥è¯¢ç»“æœçš„è¡Œæ•°</td></tr><tr><td>SUM</td><td>æ±‚å’Œï¼Œè¿”å›æŒ‡å®šåˆ—çš„æ€»å’Œ</td></tr><tr><td>AVG</td><td>æ±‚å¹³å‡å€¼ï¼Œè¿”å›æŒ‡å®šåˆ—æ•°æ®çš„å¹³å‡å€¼</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> MySQLé«˜çº§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ğŸ¤“æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé«˜çº§å­¦ä¹ ï¼ˆäºŒï¼‰-MySQLä½“ç³»ç»“æ„ã€SQLä¼˜åŒ–ã€ç´¢å¼•ä½¿ç”¨</title>
      <link href="posts/996934066.html"/>
      <url>posts/996934066.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€MySQLçš„ä½“ç³»ç»“æ„æ¦‚è§ˆ"><a href="#ä¸€ã€MySQLçš„ä½“ç³»ç»“æ„æ¦‚è§ˆ" class="headerlink" title="ä¸€ã€MySQLçš„ä½“ç³»ç»“æ„æ¦‚è§ˆ"></a>ä¸€ã€MySQLçš„ä½“ç³»ç»“æ„æ¦‚è§ˆ</h1><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307200516.png" alt="image-20210307200516510"></p><blockquote><p><strong>æ•´ä¸ªMySQL  Serverç”±ä»¥ä¸‹ç»„æˆ</strong></p></blockquote><ul><li><p>Connection Pool : è¿æ¥æ± ç»„ä»¶</p></li><li><p>Management Services &amp; Utilities : ç®¡ç†æœåŠ¡å’Œå·¥å…·ç»„ä»¶</p></li><li><p>SQL Interface : SQLæ¥å£ç»„ä»¶ </p></li><li><p>Parser : æŸ¥è¯¢åˆ†æå™¨ç»„ä»¶ </p></li><li><p>Optimizer : ä¼˜åŒ–å™¨ç»„ä»¶ </p></li><li><p>Caches &amp; Buï¬€ers : ç¼“å†²æ± ç»„ä»¶</p></li><li><p>Pluggable Storage Engines : å­˜å‚¨å¼•æ“</p></li><li><p>File System : æ–‡ä»¶ç³»ç»Ÿ</p></li></ul><h2 id="1-1ã€è¿æ¥å±‚"><a href="#1-1ã€è¿æ¥å±‚" class="headerlink" title="1.1ã€è¿æ¥å±‚"></a>1.1ã€è¿æ¥å±‚</h2><blockquote><p>æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œé“¾æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ°sock é€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»ä¼¼äº TCP/IPçš„é€šä¿¡ã€‚</p><p>ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äº<strong>è¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆ</strong>ã€‚åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†<strong>çº¿ç¨‹æ± </strong>çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ã€‚åŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚</p></blockquote><h2 id="1-2ã€æœåŠ¡å±‚"><a href="#1-2ã€æœåŠ¡å±‚" class="headerlink" title="1.2ã€æœåŠ¡å±‚"></a>1.2ã€æœåŠ¡å±‚</h2><blockquote><p>ç¬¬äºŒå±‚æ¶æ„ä¸»è¦å®Œæˆå¤§å¤šæ•°çš„æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œå¦‚SQLæ¥å£ï¼Œå¹¶å®Œæˆ<strong>ç¼“å­˜çš„æŸ¥è¯¢ï¼ˆCaches &amp; Buï¬€ersï¼‰</strong>ï¼Œ<strong>SQLçš„åˆ†æå’Œä¼˜åŒ–ï¼ˆOptimizerï¼‰</strong>ï¼Œéƒ¨åˆ†å†…ç½®å‡½æ•°çš„æ‰§è¡Œã€‚<strong>æ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½ä¹Ÿåœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚ è¿‡ç¨‹ã€å‡½æ•°ç­‰</strong>ã€‚åœ¨è¯¥å±‚ï¼ŒæœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šè¡¨çš„æŸ¥è¯¢çš„é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œ æœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œã€‚å¦‚æœæ˜¯</p><p>selectè¯­å¥ï¼ŒæœåŠ¡å™¨è¿˜ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œè¿™æ ·åœ¨è§£å†³å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­èƒ½å¤Ÿå¾ˆå¥½çš„æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p></blockquote><h2 id="1-3ã€å¼•æ“å±‚"><a href="#1-3ã€å¼•æ“å±‚" class="headerlink" title="1.3ã€å¼•æ“å±‚"></a>1.3ã€å¼•æ“å±‚</h2><blockquote><p>å­˜å‚¨å¼•æ“å±‚ï¼Œ <strong>å­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–</strong>ï¼ŒæœåŠ¡å™¨é€šè¿‡APIå’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬<strong>å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“</strong>ã€‚</p></blockquote><h2 id="1-4ã€å­˜å‚¨å±‚"><a href="#1-4ã€å­˜å‚¨å±‚" class="headerlink" title="1.4ã€å­˜å‚¨å±‚"></a>1.4ã€å­˜å‚¨å±‚</h2><blockquote><p>æ•°æ®å­˜å‚¨å±‚ï¼Œä¸»è¦æ˜¯<strong>å°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Š</strong>ï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚</p></blockquote><p>å’Œå…¶ä»–æ•°æ®åº“ç›¸æ¯”ï¼ŒMySQLæœ‰ç‚¹ä¸ä¼—ä¸åŒï¼Œå®ƒçš„æ¶æ„å¯ä»¥åœ¨å¤šç§ä¸åŒåœºæ™¯ä¸­åº”ç”¨å¹¶å‘æŒ¥è‰¯å¥½ä½œç”¨ã€‚ä¸»è¦ä½“ç°åœ¨å­˜å‚¨å¼•æ“ä¸Šï¼Œæ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„ï¼Œå°†æŸ¥è¯¢å¤„ç†å’Œå…¶ä»–çš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–åˆ†ç¦»ã€‚è¿™ç§æ¶æ„å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å’Œå®é™…éœ€è¦é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚</p><h1 id="äºŒã€å­˜å‚¨å¼•æ“"><a href="#äºŒã€å­˜å‚¨å¼•æ“" class="headerlink" title="äºŒã€å­˜å‚¨å¼•æ“"></a>äºŒã€å­˜å‚¨å¼•æ“</h1><h2 id="2-1ã€å­˜å‚¨å¼•æ“æ¦‚è¿°"><a href="#2-1ã€å­˜å‚¨å¼•æ“æ¦‚è¿°" class="headerlink" title="2.1ã€å­˜å‚¨å¼•æ“æ¦‚è¿°"></a>2.1ã€å­˜å‚¨å¼•æ“æ¦‚è¿°</h2><blockquote><p>å’Œå¤§å¤šæ•°çš„æ•°æ®åº“ä¸åŒ,  MySQLä¸­æœ‰ä¸€ä¸ªå­˜å‚¨å¼•æ“çš„æ¦‚å¿µ,  é’ˆå¯¹ä¸åŒçš„å­˜å‚¨éœ€æ±‚å¯ä»¥é€‰æ‹©æœ€ä¼˜çš„å­˜å‚¨å¼•æ“ã€‚</p><p><strong>å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ï¼Œå»ºç«‹ç´¢å¼•ï¼Œæ›´æ–°æŸ¥è¯¢æ•°æ®ç­‰ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼</strong> ã€‚</p><p><strong>å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨</strong>çš„ï¼Œè€Œä¸æ˜¯åŸºäºåº“çš„ã€‚æ‰€ä»¥å­˜å‚¨å¼•æ“ä¹Ÿå¯è¢«ç§°ä¸ºè¡¨ç±»å‹ã€‚</p></blockquote><p>åœ¨ä½¿ç”¨æ•°æ®åº“å¯è§†åŒ–å·¥å…·åˆ›å»ºåº“æ—¶ï¼Œä¸ä¼šè¦æ±‚ä½ é€‰æ‹©å­˜å‚¨å¼•æ“ï¼Œè€Œåœ¨åˆ›å»ºè¡¨æ—¶ï¼Œä¼šè®©ä½ é€‰æ‹©å­˜å‚¨å¼•æ“ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307203200.png" alt="image-20210307203200389"></p><blockquote><p>Oracleï¼ŒSqlServerç­‰æ•°æ®åº“åªæœ‰ä¸€ç§å­˜å‚¨å¼•æ“ã€‚MySQLæä¾›äº†æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„ã€‚æ‰€ä»¥MySQLå­˜åœ¨å¤šç§å­˜å‚¨å¼•æ“ï¼Œå¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ç›¸åº”å¼•æ“ï¼Œæˆ–è€…ç¼–å†™å­˜å‚¨å¼•æ“ã€‚</p><p>MySQL5.0æ”¯æŒçš„å­˜å‚¨å¼•æ“åŒ…å«  ï¼š  <strong>InnoDBï¼ˆ5.5ä¹‹åï¼ŒMySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼‰</strong>  ã€<strong>MyISAMï¼ˆ5.5ä¹‹å‰ï¼ŒMySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼‰</strong>   ã€BDBã€MEMORYã€MERGEã€EXAMPLEã€NDB Clusterã€ARCHIVEã€CSVã€BLACKHOLEã€FEDERATEDç­‰ï¼Œ<strong>å…¶ä¸­InnoDBå’ŒBDBæä¾›äº‹åŠ¡å®‰å…¨è¡¨</strong>ï¼Œå…¶ä»–å­˜å‚¨å¼•æ“æ˜¯éäº‹åŠ¡å®‰å…¨è¡¨ã€‚</p></blockquote><h3 id="1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“"><a href="#1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“" class="headerlink" title="1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“"></a>1ã€æŸ¥çœ‹å½“å‰æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“</h3><blockquote><p>ä½¿ç”¨æŒ‡ä»¤ <code>show engines</code> æ¥æŸ¥çœ‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show engines;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307203646.png" alt="image-20210307203646293"></p><blockquote><p>ä»ä¸Šé¢æœç´¢åˆ°çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒMySQLé»˜è®¤æ”¯æŒçš„å­˜å‚¨å¼•æ“æ˜¯ <strong>InnoDB</strong>ï¼Œåœ¨å»ºè¡¨æ—¶å¦‚æœä¸åŠ ä»¥æŒ‡å®šï¼Œé‚£ä¹ˆé»˜è®¤ä½¿ç”¨ <strong>InnoDB</strong> ä½œä¸ºå­˜å‚¨å¼•æ“ã€‚</p><p><strong>InnoDB</strong> æ”¯æŒ <strong>äº‹åŠ¡</strong>ã€<strong>è¡Œçº§é”</strong> å’Œ <strong>å¤–é”®</strong>ã€‚</p><p>MySQL5.5ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“æ˜¯MyISAMï¼Œ5.5ä¹‹åå°±æ”¹ä¸ºäº†InnoDBã€‚</p></blockquote><h3 id="2ã€æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“"><a href="#2ã€æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“" class="headerlink" title="2ã€æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“"></a>2ã€æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“</h3><blockquote><p>ä½¿ç”¨æŒ‡ä»¤ <code>show variables like &#39;%storage_engine%&#39;</code> æŸ¥çœ‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%storage_engine%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307204509.png" alt="image-20210307204509575"></p><h2 id="2-2ã€å„ç§å­˜å‚¨å¼•æ“ç‰¹æ€§"><a href="#2-2ã€å„ç§å­˜å‚¨å¼•æ“ç‰¹æ€§" class="headerlink" title="2.2ã€å„ç§å­˜å‚¨å¼•æ“ç‰¹æ€§"></a>2.2ã€å„ç§å­˜å‚¨å¼•æ“ç‰¹æ€§</h2><blockquote><p>ä¸‹é¢ä»‹ç»å‡ ç§å¸¸ç”¨çš„å­˜å‚¨å¼•æ“ï¼Œå’Œå„å¼•æ“é—´åŒºåˆ«ï¼Œå¦‚ä¸‹è¡¨</p></blockquote><table><thead><tr><th>ç‰¹ç‚¹</th><th>InnoDB</th><th>MyISAM</th><th>MEMORY</th><th>MERGE</th><th>NDB</th></tr></thead><tbody><tr><td>å­˜å‚¨é™åˆ¶</td><td>64TB</td><td>æœ‰</td><td>æœ‰</td><td>æ²¡æœ‰</td><td>æœ‰</td></tr><tr><td>äº‹åŠ¡å®‰å…¨</td><td><strong>æ”¯æŒ</strong></td><td></td><td></td><td></td><td></td></tr><tr><td>é”æœºåˆ¶</td><td><strong>è¡Œé”(é€‚åˆé«˜å¹¶å‘)</strong></td><td><strong>è¡¨é”</strong></td><td>è¡¨é”</td><td>è¡¨é”</td><td>è¡Œé”</td></tr><tr><td>Bæ ‘ç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å“ˆå¸Œç´¢å¼•</td><td></td><td></td><td>æ”¯æŒ</td><td></td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒ(5.6ç‰ˆæœ¬ä¹‹å)</td><td>æ”¯æŒ</td><td></td><td></td><td></td></tr><tr><td>é›†ç¾¤ç´¢å¼•</td><td>æ”¯æŒ</td><td></td><td></td><td></td><td></td></tr><tr><td>æ•°æ®ç´¢å¼•</td><td>æ”¯æŒ</td><td></td><td>æ”¯æŒ</td><td></td><td>æ”¯æŒ</td></tr><tr><td>ç´¢å¼•ç¼“å­˜</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>æ•°æ®å¯å‹ç¼©</td><td></td><td>æ”¯æŒ</td><td></td><td></td><td></td></tr><tr><td>ç©ºé—´ä½¿ç”¨</td><td>é«˜</td><td>ä½</td><td>N/A</td><td>ä½</td><td>ä½</td></tr><tr><td>å†…å­˜ä½¿ç”¨</td><td>é«˜</td><td>ä½</td><td>ä¸­ç­‰</td><td>ä½</td><td>é«˜</td></tr><tr><td>æ‰¹é‡æ’å…¥é€Ÿåº¦</td><td>ä½</td><td>é«˜</td><td>é«˜</td><td>é«˜</td><td>é«˜</td></tr><tr><td>æ”¯æŒå¤–é”®</td><td><strong>æ”¯æŒ</strong></td><td></td><td></td><td></td><td></td></tr></tbody></table><h3 id="1ã€æŸ¥çœ‹-ä¿®æ”¹MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#1ã€æŸ¥çœ‹-ä¿®æ”¹MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="1ã€æŸ¥çœ‹/ä¿®æ”¹MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«"></a>1ã€æŸ¥çœ‹/ä¿®æ”¹MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«</h3><ul><li>æŸ¥çœ‹MySQLçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒMySQLé»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯<strong>å¯é‡å¤è¯»</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#39;%isolation%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307211527.png" alt="image-20210307211527447"></p><ul><li>ä¿®æ”¹MySQLçš„äº‹åŠ¡éš”ç¦»çº§åˆ«</li></ul><blockquote><p>è¯­æ³•ï¼š</p><p>SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL<br>{<br>    REPEATABLE READ<br>  | READ COMMITTED<br>  | READ UNCOMMITTED<br>  | SERIALIZABLE<br>}</p></blockquote><h3 id="2ã€InnoDB"><a href="#2ã€InnoDB" class="headerlink" title="2ã€InnoDB"></a>2ã€InnoDB</h3><blockquote><p>InnoDBå­˜å‚¨å¼•æ“æ˜¯Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ã€‚InnoDBå­˜å‚¨å¼•æ“æä¾›äº†å…·æœ‰æäº¤ã€å›æ»šã€å´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹åŠ¡å®‰å…¨ã€‚ä½†æ˜¯å¯¹æ¯”MyISAMçš„å­˜å‚¨å¼•æ“ï¼ŒInnoDBå†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº›ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿ç•™æ•°æ®å’Œç´¢å¼•ã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“ä¸åŒäºå…¶ä»–å­˜å‚¨å¼•æ“çš„ç‰¹ç‚¹ ï¼š<strong>äº‹åŠ¡æ§åˆ¶</strong>ã€æ”¯æŒå¤–é”®</p></blockquote><h3 id="3ã€InnoDBçš„äº‹åŠ¡æ§åˆ¶"><a href="#3ã€InnoDBçš„äº‹åŠ¡æ§åˆ¶" class="headerlink" title="3ã€InnoDBçš„äº‹åŠ¡æ§åˆ¶"></a>3ã€InnoDBçš„äº‹åŠ¡æ§åˆ¶</h3><ul><li>åˆ›å»ºä¸€å¼ è¡¨ç”¨äºæ¼”ç¤º <strong>InnoDB</strong> å­˜å‚¨å¼•æ“çš„ç‰¹æ€§â€“äº‹åŠ¡æ§åˆ¶ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table goods_innodb</span><br><span class="line">(</span><br><span class="line">    id   int         NOT NULL AUTO_INCREMENT,</span><br><span class="line">    name varchar(20) NOT NULL,</span><br><span class="line">    primary key (id)</span><br><span class="line">) ENGINE &#x3D; innodb</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰‹åŠ¨å¼€å¯äº‹åŠ¡ï¼Œæ‰“å¼€ä¸¤ä¸ªcmdçª—å£ï¼Œé“¾æ¥ä¸Šæ•°æ®åº“</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -pä½ çš„å¯†ç </span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ç¬¬ä¸€ä¸ªçª—å£ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start transaction;</span><br><span class="line">insert into goods_innodb(id,name) values (2,&#39;èµ·é£&#39;);</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307211158.png" alt="image-20210307211158447"></p><blockquote><p>æ­¤æ—¶ä½¿ç”¨ç¬¬äºŒä¸ªçª—å£æŸ¥çœ‹è¡¨æ•°æ®ï¼Œå‘ç°æ²¡æœ‰ <code>id</code> ä¸º2çš„æ•°æ®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307211222.png" alt="image-20210307211222119"></p><blockquote><p>åœ¨ç¬¬ä¸€ä¸ªçª—å£ä¸­æäº¤äº‹åŠ¡ï¼Œå†æ¬¡æŸ¥çœ‹ç¬¬äºŒä¸ªçª—å£ä¸­æ•°æ®åº“è¡¨æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">commit;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307211308.png" alt="image-20210307211308231"></p><h3 id="4ã€InnoDBæ”¯æŒå¤–é”®"><a href="#4ã€InnoDBæ”¯æŒå¤–é”®" class="headerlink" title="4ã€InnoDBæ”¯æŒå¤–é”®"></a>4ã€InnoDBæ”¯æŒå¤–é”®</h3><ul><li>åˆ›å»ºä¸¤å¼ è¡¨ç”¨äºæ¼”ç¤º <strong>InnoDB</strong> å­˜å‚¨å¼•æ“çš„ç‰¹æ€§â€“æ”¯æŒå¤–é”®ã€‚</li></ul><blockquote><p>MySQLæ”¯æŒå¤–é”®çš„å­˜å‚¨å¼•æ“åªæœ‰InnoDB ï¼Œ åœ¨åˆ›å»ºå¤–é”®çš„æ—¶å€™ï¼Œ è¦æ±‚çˆ¶è¡¨å¿…é¡»æœ‰å¯¹åº”çš„ç´¢å¼• ï¼Œ <strong>å­è¡¨åœ¨åˆ›å»ºå¤–é”®çš„æ—¶å€™ï¼Œ  ä¹Ÿä¼šè‡ªåŠ¨çš„åˆ›å»ºå¯¹åº”çš„ç´¢å¼•ã€‚</strong></p><p><strong>ä¸‹é¢ä¸¤å¼ è¡¨ä¸­ ï¼Œ country_innodbæ˜¯çˆ¶è¡¨ ï¼Œ country_idä¸ºä¸»é”®ç´¢å¼•ï¼Œcity_innodbè¡¨æ˜¯å­è¡¨ï¼Œcountry_idå­—æ®µä¸ºå¤–é”®ï¼Œå¯¹åº”äºcountry_innodbè¡¨çš„ä¸»é”®country_id ã€‚</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">create table country_innodb</span><br><span class="line">(</span><br><span class="line">    country_id   int          NOT NULL AUTO_INCREMENT,</span><br><span class="line">    country_name varchar(100) NOT NULL,</span><br><span class="line">    primary key (country_id)</span><br><span class="line">) ENGINE &#x3D; InnoDB</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">create table city_innodb</span><br><span class="line">(</span><br><span class="line">    city_id    int         NOT NULL AUTO_INCREMENT,</span><br><span class="line">    city_name  varchar(50) NOT NULL,</span><br><span class="line">    country_id int         NOT NULL,</span><br><span class="line">    primary key (city_id),</span><br><span class="line">    key idx_fk_country_id (country_id),</span><br><span class="line">    CONSTRAINT &#96;fk_city_country&#96; FOREIGN KEY (country_id) REFERENCES country_innodb (country_id) ON DELETE RESTRICT ON UPDATE CASCADE</span><br><span class="line">) ENGINE &#x3D; InnoDB</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line">  </span><br><span class="line">insert into country_innodb values(null,&#39;China&#39;),(null,&#39;America&#39;),(null,&#39;Japan&#39;);</span><br><span class="line">insert into city_innodb values(null,&#39;Xian&#39;,1),(null,&#39;NewYork&#39;,2), (null,&#39;BeiJing&#39;,1);  </span><br></pre></td></tr></table></figure><blockquote><p>åœ¨åˆ é™¤ä¸»è¡¨ä¿¡æ¯æ—¶ï¼Œå¦‚æœå­è¡¨ä¸­æœ‰å’Œå¾…åˆ é™¤æ•°æ®å…³è”çš„æ•°æ®ï¼Œé‚£ä¹ˆä¸»è¡¨ä¸èƒ½åˆ é™¤</p><p>è¯•ç€åˆ é™¤ä¸»è¡¨ä¸­ <code>id</code> ä¸º2çš„æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from country_innodb where country_id &#x3D; 2;</span><br></pre></td></tr></table></figure><blockquote><p>æ§åˆ¶å°ç»“æœä¸ºï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307213340.png" alt="image-20210307213340193"></p><blockquote><p>åœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œ  å¯ä»¥æŒ‡å®šåœ¨åˆ é™¤ã€æ›´æ–°çˆ¶è¡¨æ—¶ï¼Œå¯¹å­è¡¨è¿›è¡Œçš„ç›¸åº”æ“ä½œï¼ŒåŒ…æ‹¬  <strong>RESTRICTã€CASCADEã€SET  NULLå’Œ NO ACTIONã€‚</strong></p></blockquote><ul><li><p>RESTRICTå’ŒNO  ACTIONç›¸åŒï¼Œ  æ˜¯æŒ‡é™åˆ¶åœ¨å­è¡¨æœ‰å…³è”è®°å½•çš„æƒ…å†µä¸‹ï¼Œ  çˆ¶è¡¨ä¸èƒ½æ›´æ–°ï¼›</p></li><li><p>CASCADEè¡¨ç¤ºçˆ¶è¡¨åœ¨æ›´æ–°æˆ–è€…åˆ é™¤æ—¶ï¼Œæ›´æ–°æˆ–è€…åˆ é™¤å­è¡¨å¯¹åº”çš„è®°å½•ï¼›</p></li><li><p>SET  NULL  åˆ™è¡¨ç¤ºçˆ¶è¡¨åœ¨æ›´æ–°æˆ–è€…åˆ é™¤çš„æ—¶å€™ï¼Œå­è¡¨çš„å¯¹åº”å­—æ®µè¢«SET  NULL ã€‚</p></li></ul><blockquote><p>é’ˆå¯¹ä¸Šé¢åˆ›å»ºçš„ä¸¤ä¸ªè¡¨ï¼Œ å­è¡¨çš„å¤–é”®æŒ‡å®šæ˜¯ <strong>ON DELETE RESTRICT ON UPDATE CASCADE</strong> æ–¹å¼çš„ï¼Œ <strong>é‚£ä¹ˆåœ¨ä¸»è¡¨åˆ é™¤è®°å½•çš„æ—¶å€™ï¼Œ å¦‚æœå­è¡¨æœ‰å¯¹åº”è®°å½•ï¼Œ åˆ™ä¸å…è®¸åˆ é™¤ï¼Œ ä¸»è¡¨åœ¨æ›´æ–°è®°å½•çš„æ—¶å€™ï¼Œ å¦‚æœå­è¡¨æœ‰å¯¹åº”è®°å½•ï¼Œ  åˆ™å­è¡¨å¯¹åº”æ›´æ–° ã€‚</strong></p></blockquote><ul><li>ä¸‹é¢æ¼”ç¤º <strong>UPDATE CASCADE</strong> ï¼Œå°† <code>id</code> ä¸º1çš„è®°å½•çš„ <code>id</code> è®¾ç½®ä¸º100</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update country_innodb set country_id &#x3D; 100 where country_id &#x3D; 1;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å†æ¬¡æŸ¥çœ‹ä¸¤å¼ è¡¨ä¸­çš„æ•°æ®ï¼Œå‘ç°å­è¡¨ä¸çˆ¶è¡¨å…³è”çš„æ•°æ®ä¹Ÿè¢«ä¿®æ”¹äº†ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307214342.png" alt="image-20210307214342641"></p><h3 id="5ã€InnoDBçš„å­˜å‚¨æ–¹å¼"><a href="#5ã€InnoDBçš„å­˜å‚¨æ–¹å¼" class="headerlink" title="5ã€InnoDBçš„å­˜å‚¨æ–¹å¼"></a>5ã€InnoDBçš„å­˜å‚¨æ–¹å¼</h3><blockquote><p><strong>InnoDB</strong> å­˜å‚¨è¡¨å’Œç´¢å¼•æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p></blockquote><ul><li>ä½¿ç”¨å…±äº«è¡¨ç©ºé—´å­˜å‚¨ï¼Œ  è¿™ç§æ–¹å¼åˆ›å»ºçš„è¡¨çš„è¡¨ç»“æ„ä¿å­˜åœ¨.frmæ–‡ä»¶ä¸­ï¼Œ  æ•°æ®å’Œç´¢å¼•ä¿å­˜innodb_data_home_dir  å’Œ  innodb_data_ï¬le_pathå®šä¹‰çš„è¡¨ç©ºé—´ä¸­ï¼Œå¯ä»¥æ˜¯å¤šä¸ªæ–‡ä»¶ã€‚</li><li>ä½¿ç”¨å¤šè¡¨ç©ºé—´å­˜å‚¨ï¼Œ  è¿™ç§æ–¹å¼åˆ›å»ºçš„è¡¨çš„è¡¨ç»“æ„ä»ç„¶å­˜åœ¨  .frm  æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æ¯ä¸ªè¡¨çš„æ•°æ®å’Œç´¢å¼•å•ç‹¬ä¿å­˜åœ¨.ibd ä¸­ã€‚</li></ul><h3 id="6ã€MyISAM"><a href="#6ã€MyISAM" class="headerlink" title="6ã€MyISAM"></a>6ã€MyISAM</h3><blockquote><p>MyISAM ä¸æ”¯æŒäº‹åŠ¡ã€ä¹Ÿä¸æ”¯æŒå¤–é”®ï¼Œ**å…¶ä¼˜åŠ¿æ˜¯è®¿é—®çš„é€Ÿåº¦å¿«ï¼Œå¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æ²¡æœ‰è¦æ±‚æˆ–è€…ä»¥SELECTã€INSERTä¸ºä¸»çš„åº”ç”¨åŸºæœ¬ä¸Šéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¼•æ“æ¥åˆ›å»ºè¡¨ **ã€‚</p><p>æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„ç‰¹ç‚¹ï¼š</p></blockquote><ul><li><strong>ä¸æ”¯æŒäº‹åŠ¡</strong></li></ul><blockquote><p>åˆ›å»ºä¸€å¼ è¡¨ï¼Œåœ¨å»ºè¡¨è¯­å¥ä¸­æŒ‡å®šå­˜å‚¨å¼•æ“ä¸º<strong>MyISAM</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table goods_myisam</span><br><span class="line">(</span><br><span class="line">    id   int         NOT NULL AUTO_INCREMENT,</span><br><span class="line">    name varchar(20) NOT NULL,</span><br><span class="line">    primary key (id)</span><br><span class="line">) ENGINE &#x3D; myisam</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br></pre></td></tr></table></figure><blockquote><p>åŒä¸Šï¼Œä½¿ç”¨ä¸¤ä¸ªcmdçª—å£ï¼Œåœ¨ç¬¬ä¸€ä¸ªçª—å£ä¸­ä½¿ç”¨ <code>start transaction</code> å¼€å¯äº‹åŠ¡ï¼Œæ’å…¥ä¸€æ¡æ•°æ®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307224114.png" alt="image-20210307224114417"></p><blockquote><p>åœ¨ç¬¬äºŒä¸ªçª—å£æŸ¥çœ‹è¡¨æ•°æ®ï¼Œå‘ç°å·²ç»æŸ¥è¯¢åˆ°äº†æœªæäº¤çš„æ•°æ®ï¼Œæ•… <code>myisam</code> ä¸æ”¯æŒäº‹åŠ¡ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#96;index_study&#96;.goods_myisam;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307224221.png" alt="image-20210307224221849"></p><ul><li><strong>æ–‡ä»¶å­˜å‚¨æ–¹å¼</strong></li></ul><blockquote><p>æ¯ä¸ªMyISAMåœ¨ç£ç›˜ä¸Šå­˜å‚¨æˆ3ä¸ªæ–‡ä»¶ï¼Œå…¶æ–‡ä»¶åéƒ½å’Œè¡¨åç›¸åŒï¼Œä½†æ‹“å±•ååˆ†åˆ«æ˜¯ï¼š</p></blockquote><ul><li>.frm (å­˜å‚¨è¡¨å®šä¹‰)ï¼›</li><li>.MYD(MYData , å­˜å‚¨æ•°æ®)ï¼›</li><li>.MYI(MYIndex , å­˜å‚¨ç´¢å¼•)ï¼›</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307224439.png" alt="image-20210307224439274"></p><h3 id="7ã€MEMORY"><a href="#7ã€MEMORY" class="headerlink" title="7ã€MEMORY"></a>7ã€MEMORY</h3><blockquote><p>Memoryå­˜å‚¨å¼•æ“å°†è¡¨çš„æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­ã€‚æ¯ä¸ªMEMORYè¡¨å®é™…å¯¹åº”ä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œæ ¼å¼æ˜¯.frm ï¼Œè¯¥æ–‡ä»¶ä¸­åªå­˜å‚¨è¡¨çš„ç»“æ„ï¼Œè€Œå…¶æ•°æ®æ–‡ä»¶ï¼Œéƒ½æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·æœ‰åˆ©äºæ•°æ®çš„å¿«é€Ÿå¤„ç†ï¼Œæé«˜æ•´ä¸ªè¡¨çš„æ•ˆç‡ã€‚MEMORYç±»å‹çš„è¡¨è®¿é—®éå¸¸åœ°å¿«ï¼Œå› ä¸ºä»–çš„æ•°æ®æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œå¹¶ä¸”é»˜è®¤ä½¿ç”¨HASHç´¢å¼• ï¼Œ ä½†æ˜¯æœåŠ¡ä¸€æ—¦å…³é—­ï¼Œè¡¨ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚</p></blockquote><h2 id="2-3ã€å­˜å‚¨å¼•æ“çš„é€‰æ‹©"><a href="#2-3ã€å­˜å‚¨å¼•æ“çš„é€‰æ‹©" class="headerlink" title="2.3ã€å­˜å‚¨å¼•æ“çš„é€‰æ‹©"></a>2.3ã€å­˜å‚¨å¼•æ“çš„é€‰æ‹©</h2><blockquote><p>åœ¨é€‰æ‹©å­˜å‚¨å¼•æ“æ—¶ï¼Œåº”è¯¥æ ¹æ®åº”ç”¨ç³»ç»Ÿçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“ã€‚<strong>å¯¹äºå¤æ‚çš„åº”ç”¨ç³»ç»Ÿï¼Œè¿˜å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å¤šç§å­˜å‚¨å¼•æ“è¿›è¡Œç»„åˆã€‚</strong></p><p>ä»¥ä¸‹æ˜¯å‡ ç§å¸¸ç”¨çš„å­˜å‚¨å¼•æ“çš„ä½¿ç”¨ç¯å¢ƒã€‚</p></blockquote><h3 id="1ã€InnoDB"><a href="#1ã€InnoDB" class="headerlink" title="1ã€InnoDB"></a>1ã€InnoDB</h3><blockquote><p>Mysqlçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œ<strong>ç”¨äºäº‹åŠ¡å¤„ç†åº”ç”¨ç¨‹åºï¼Œæ”¯æŒå¤–é”®ã€‚</strong></p><p>å¦‚æœåº”ç”¨å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œ<strong>åœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§</strong>ï¼Œæ•°æ®æ“ä½œé™¤äº†æ’å…¥å’ŒæŸ¥è¯¢æ„å¤–ï¼Œè¿˜åŒ…å«å¾ˆå¤šçš„æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œé‚£ä¹ˆInnoDBå­˜å‚¨å¼•æ“æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚</p><p>InnoDBå­˜å‚¨å¼•æ“é™¤äº†æœ‰æ•ˆçš„é™ä½ç”±äºåˆ é™¤å’Œæ›´æ–°å¯¼è‡´çš„é”å®šï¼Œ è¿˜å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„å®Œæ•´æäº¤å’Œå›æ»šï¼Œå¯¹äº<strong>ç±»ä¼¼äºè®¡è´¹ç³»ç»Ÿæˆ–è€…è´¢åŠ¡ç³»ç»Ÿç­‰å¯¹æ•°æ®å‡†ç¡®æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„ç³»ç»Ÿ</strong>ï¼ŒInnoDBæ˜¯æœ€åˆé€‚çš„é€‰æ‹©ã€‚</p><p><strong>å¼€å‘ä¸­ç»å¤§éƒ¨åˆ†ä½¿ç”¨çš„éƒ½æ˜¯InnoDB</strong></p></blockquote><h3 id="2ã€MyISAM"><a href="#2ã€MyISAM" class="headerlink" title="2ã€MyISAM"></a>2ã€MyISAM</h3><blockquote><p>å¦‚æœåº”ç”¨æ˜¯ä»¥<strong>è¯»æ“ä½œå’Œæ’å…¥æ“ä½œ</strong>ä¸ºä¸»ï¼Œ<strong>åªæœ‰å¾ˆå°‘çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œ</strong>ï¼Œå¹¶ä¸”<strong>å¯¹äº‹åŠ¡çš„å®Œæ•´æ€§ã€å¹¶å‘æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜</strong>ï¼Œé‚£ä¹ˆé€‰æ‹©è¿™ä¸ªå­˜å‚¨å¼•æ“æ˜¯éå¸¸åˆé€‚çš„ã€‚</p></blockquote><h3 id="3ã€Memory"><a href="#3ã€Memory" class="headerlink" title="3ã€Memory"></a>3ã€Memory</h3><blockquote><p>å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨RAMä¸­ï¼Œåœ¨éœ€è¦å¿«é€Ÿå®šä½è®°å½•å’Œå…¶ä»–ç±»ä¼¼æ•°æ®ç¯å¢ƒä¸‹ï¼Œå¯ä»¥æä¾›å‡ å—çš„è®¿é—®ã€‚</p><p><strong>MEMORYçš„ç¼ºé™·å°±æ˜¯å¯¹è¡¨çš„å¤§å°æœ‰é™åˆ¶ï¼Œå¤ªå¤§çš„è¡¨æ— æ³•ç¼“å­˜åœ¨å†…å­˜ä¸­</strong>ï¼Œå…¶æ¬¡æ˜¯è¦ç¡®ä¿è¡¨çš„æ•°æ®å¯ä»¥æ¢å¤ï¼Œ<strong>æ•°æ®åº“å¼‚å¸¸ç»ˆæ­¢åè¡¨ä¸­çš„æ•°æ®æ˜¯å¯ä»¥æ¢å¤çš„ã€‚</strong></p><p>MEMORYè¡¨é€šå¸¸ç”¨äº<strong>æ›´æ–°ä¸å¤ªé¢‘ç¹çš„å°è¡¨</strong>ï¼Œç”¨ä»¥å¿«é€Ÿå¾—åˆ°è®¿é—®ç»“æœã€‚</p></blockquote><h1 id="ä¸‰ã€SQLä¼˜åŒ–ï¼ˆä¸€ï¼‰"><a href="#ä¸‰ã€SQLä¼˜åŒ–ï¼ˆä¸€ï¼‰" class="headerlink" title="ä¸‰ã€SQLä¼˜åŒ–ï¼ˆä¸€ï¼‰"></a>ä¸‰ã€SQLä¼˜åŒ–ï¼ˆä¸€ï¼‰</h1><blockquote><p>åœ¨åº”ç”¨çš„çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç”±äºåˆæœŸæ•°æ®é‡å°ï¼Œå¼€å‘äººå‘˜å†™ SQL è¯­å¥æ—¶æ›´é‡è§†åŠŸèƒ½ä¸Šçš„å®ç°ï¼Œä½†æ˜¯å½“åº”ç”¨ç³»ç»Ÿæ­£å¼ä¸Šçº¿åï¼Œéšç€ç”Ÿäº§æ•°æ®é‡çš„æ€¥å‰§å¢é•¿ï¼Œå¾ˆå¤š SQL è¯­å¥å¼€å§‹é€æ¸æ˜¾éœ²å‡ºæ€§èƒ½é—®é¢˜ï¼Œå¯¹ç”Ÿäº§çš„å½±å“ä¹Ÿè¶Šæ¥è¶Šå¤§ï¼Œæ­¤æ—¶è¿™äº›<strong>æœ‰é—®é¢˜çš„ SQL è¯­å¥å°±æˆä¸ºæ•´ä¸ªç³»ç»Ÿæ€§èƒ½çš„ç“¶é¢ˆ</strong>ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦å¯¹å®ƒä»¬è¿›è¡Œä¼˜åŒ–ã€‚</p><p>å½“é¢å¯¹ä¸€ä¸ªæœ‰ SQL æ€§èƒ½é—®é¢˜çš„æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ä»ä½•å¤„å…¥æ‰‹æ¥è¿›è¡Œç³»ç»Ÿçš„åˆ†æï¼Œä½¿å¾—èƒ½å¤Ÿå°½å¿«å®šä½é—®é¢˜ SQL å¹¶å°½å¿«è§£å†³é—®é¢˜ã€‚</p></blockquote><h2 id="3-1ã€æŸ¥çœ‹SQLæ‰§è¡Œé¢‘ç‡"><a href="#3-1ã€æŸ¥çœ‹SQLæ‰§è¡Œé¢‘ç‡" class="headerlink" title="3.1ã€æŸ¥çœ‹SQLæ‰§è¡Œé¢‘ç‡"></a>3.1ã€æŸ¥çœ‹SQLæ‰§è¡Œé¢‘ç‡</h2><p>MySQL å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼Œé€šè¿‡ show [session|global] status å‘½ä»¤å¯ä»¥æä¾›æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ã€‚show [session|global]  status  å¯ä»¥æ ¹æ®éœ€è¦åŠ ä¸Šå‚æ•°â€œsessionâ€æˆ–è€…â€œglobalâ€æ¥æ˜¾ç¤º  session  çº§ï¼ˆå½“å‰è¿æ¥ï¼‰çš„è®¡ç»“æœå’Œ</p><p>global   çº§ï¼ˆè‡ªæ•°æ®åº“ä¸Šæ¬¡å¯åŠ¨è‡³ä»Šï¼‰çš„ç»Ÿè®¡ç»“æœã€‚å¦‚æœä¸å†™ï¼Œé»˜è®¤ä½¿ç”¨å‚æ•°æ˜¯â€œsessionâ€ã€‚</p><h3 id="1ã€æŸ¥è¯¢å½“å‰ä¼šè¯ä¸­æ‰€æœ‰ç»Ÿè®¡å‚æ•°å€¼"><a href="#1ã€æŸ¥è¯¢å½“å‰ä¼šè¯ä¸­æ‰€æœ‰ç»Ÿè®¡å‚æ•°å€¼" class="headerlink" title="1ã€æŸ¥è¯¢å½“å‰ä¼šè¯ä¸­æ‰€æœ‰ç»Ÿè®¡å‚æ•°å€¼"></a>1ã€æŸ¥è¯¢å½“å‰ä¼šè¯ä¸­æ‰€æœ‰ç»Ÿè®¡å‚æ•°å€¼</h3><blockquote><p>ä¸‹é¢çš„å‘½ä»¤æ˜¾ç¤ºäº†å½“å‰  session  ä¸­æ‰€æœ‰ç»Ÿè®¡å‚æ•°çš„å€¼ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like &#39;Com_______&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308153514.png" alt="image-20210308153514166"></p><h3 id="2ã€æŸ¥è¯¢å…¨å±€ç»Ÿè®¡å‚æ•°å€¼"><a href="#2ã€æŸ¥è¯¢å…¨å±€ç»Ÿè®¡å‚æ•°å€¼" class="headerlink" title="2ã€æŸ¥è¯¢å…¨å±€ç»Ÿè®¡å‚æ•°å€¼"></a>2ã€æŸ¥è¯¢å…¨å±€ç»Ÿè®¡å‚æ•°å€¼</h3><blockquote><p>ä¸Šé¢çš„å‘½ä»¤æŸ¥è¯¢çš„åªæ˜¯<strong>å½“å‰é“¾æ¥</strong>çš„ç»Ÿè®¡å‚æ•°ï¼Œå¦‚æœè¦ç»Ÿè®¡å…¨å±€å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ status å‰æ·»åŠ ä¸€ä¸ª <code>global</code> å‚æ•°</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global status like &#39;Com_______&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308154221.png" alt="image-20210308154221306"></p><h3 id="3ã€æŸ¥è¯¢InnoDBå­˜å‚¨å¼•æ“çš„æ“ä½œæ•°é‡"><a href="#3ã€æŸ¥è¯¢InnoDBå­˜å‚¨å¼•æ“çš„æ“ä½œæ•°é‡" class="headerlink" title="3ã€æŸ¥è¯¢InnoDBå­˜å‚¨å¼•æ“çš„æ“ä½œæ•°é‡"></a>3ã€æŸ¥è¯¢InnoDBå­˜å‚¨å¼•æ“çš„æ“ä½œæ•°é‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like &#39;Innodb_rows_%&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>è¾“å‡ºç»“æœå¦‚ä¸‹</p><p><code>InnoDB</code> æ’å…¥çš„è¡Œï¼š8</p><p><code>InnoDB</code> æŸ¥è¯¢çš„è¡Œï¼š20</p><p><code>InnoDB</code> æ›´æ–°çš„è¡Œï¼š3</p><p><code>InnoDB</code> åˆ é™¤çš„è¡Œï¼š0</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308154523.png" alt="image-20210308154523163"></p><blockquote><p>é€šè¿‡ä¸Šé¢çš„å‡ æ¡æŒ‡ä»¤ï¼Œå°±å¯ä»¥å¤§è‡´ç¡®å®šå½“å‰æ•°æ®åº“åˆ°åº•æ˜¯ä»¥è¯»ä¸ºä¸»è¿˜æ˜¯ä»¥å†™ä¸ºä¸»ã€‚</p></blockquote><h3 id="4ã€å‚æ•°è¯´æ˜"><a href="#4ã€å‚æ•°è¯´æ˜" class="headerlink" title="4ã€å‚æ•°è¯´æ˜"></a>4ã€å‚æ•°è¯´æ˜</h3><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td>Com_select</td><td>æ‰§è¡Œ select æ“ä½œçš„æ¬¡æ•°ï¼Œä¸€æ¬¡æŸ¥è¯¢åªç´¯åŠ  1ã€‚</td></tr><tr><td>Com_insert</td><td>æ‰§è¡Œ  INSERT  æ“ä½œçš„æ¬¡æ•°ï¼Œå¯¹äºæ‰¹é‡æ’å…¥çš„  INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡ã€‚</td></tr><tr><td>Com_update</td><td>æ‰§è¡Œ UPDATE æ“ä½œçš„æ¬¡æ•°ã€‚</td></tr><tr><td>Com_delete</td><td>æ‰§è¡Œ DELETE æ“ä½œçš„æ¬¡æ•°ã€‚</td></tr><tr><td>Innodb_rows_read</td><td>select  æŸ¥è¯¢è¿”å›çš„è¡Œæ•°ã€‚</td></tr><tr><td>Innodb_rows_inserted</td><td>æ‰§è¡Œ INSERT æ“ä½œæ’å…¥çš„è¡Œæ•°ã€‚</td></tr><tr><td>Innodb_rows_updated</td><td>æ‰§è¡Œ UPDATE æ“ä½œæ›´æ–°çš„è¡Œæ•°ã€‚</td></tr><tr><td>Innodb_rows_deleted</td><td>æ‰§è¡Œ DELETE æ“ä½œåˆ é™¤çš„è¡Œæ•°ã€‚</td></tr><tr><td>Connections</td><td>è¯•å›¾è¿æ¥ MySQL æœåŠ¡å™¨çš„æ¬¡æ•°ã€‚</td></tr><tr><td>Uptime</td><td>æœåŠ¡å™¨å·¥ä½œæ—¶é—´ã€‚</td></tr><tr><td>Slow_queries</td><td>æ…¢æŸ¥è¯¢çš„æ¬¡æ•°ã€‚</td></tr></tbody></table><blockquote><p>Com_***  :  è¿™äº›å‚æ•°å¯¹äºæ‰€æœ‰å­˜å‚¨å¼•æ“çš„è¡¨æ“ä½œéƒ½ä¼šè¿›è¡Œç´¯è®¡ã€‚</p><p>Innodb_***  :  è¿™å‡ ä¸ªå‚æ•°åªæ˜¯é’ˆå¯¹InnoDB  å­˜å‚¨å¼•æ“çš„ï¼Œç´¯åŠ çš„ç®—æ³•ä¹Ÿç•¥æœ‰ä¸åŒã€‚</p></blockquote><h2 id="3-2ã€å®šä½ä½æ•ˆç‡æ‰§è¡ŒSQL"><a href="#3-2ã€å®šä½ä½æ•ˆç‡æ‰§è¡ŒSQL" class="headerlink" title="3.2ã€å®šä½ä½æ•ˆç‡æ‰§è¡ŒSQL"></a>3.2ã€å®šä½ä½æ•ˆç‡æ‰§è¡ŒSQL</h2><blockquote><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„  SQL  è¯­å¥ã€‚</p></blockquote><ul><li>æ…¢æŸ¥è¯¢æ—¥å¿— : é€šè¿‡æ…¢æŸ¥è¯¢æ—¥å¿—å®šä½é‚£äº›æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL è¯­å¥ï¼Œç”¨â€“log-slow-queries[=ï¬le_name]é€‰é¡¹å¯åŠ¨æ—¶ï¼Œmysqld å†™ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ long_query_time  ç§’çš„  SQL  è¯­å¥çš„æ—¥å¿—æ–‡ä»¶ã€‚</li><li><strong>show processlist</strong> : æ…¢æŸ¥è¯¢æ—¥å¿—åœ¨æŸ¥è¯¢ç»“æŸä»¥åæ‰çºªå½•ï¼Œæ‰€ä»¥åœ¨åº”ç”¨åæ˜ æ‰§è¡Œæ•ˆç‡å‡ºç°é—®é¢˜çš„æ—¶å€™æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—å¹¶ä¸èƒ½å®šä½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨show processlistå‘½ä»¤æŸ¥çœ‹å½“å‰MySQLåœ¨è¿›è¡Œçš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„çŠ¶æ€ã€æ˜¯å¦é”è¡¨ç­‰ï¼Œå¯ä»¥å®æ—¶åœ°æŸ¥çœ‹ SQL çš„æ‰§è¡Œæƒ…å†µï¼ŒåŒæ—¶å¯¹ä¸€äº›é”è¡¨æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚</li></ul><h3 id="1ã€ä½¿ç”¨show-processlist-æŒ‡ä»¤è¿æ¥å’Œæ‰§è¡Œæ“ä½œ"><a href="#1ã€ä½¿ç”¨show-processlist-æŒ‡ä»¤è¿æ¥å’Œæ‰§è¡Œæ“ä½œ" class="headerlink" title="1ã€ä½¿ç”¨show processlist æŒ‡ä»¤è¿æ¥å’Œæ‰§è¡Œæ“ä½œ"></a>1ã€ä½¿ç”¨show processlist æŒ‡ä»¤è¿æ¥å’Œæ‰§è¡Œæ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show processlist;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹æ‰§è¡Œæ•ˆæœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308155757.png" alt="image-20210308155757344"></p><blockquote><p>æŸ¥çœ‹ <code>Info</code> åˆ—ä¿¡æ¯</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* ApplicationName&#x3D;DataGrip 2020.2.2 *&#x2F; æ“ä½œæ•°æ®åº“çš„åº”ç”¨ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯&#96;DATAGRIP&#96;</span><br><span class="line">show processlist;&#x2F;&#x2F;æ‰§è¡Œçš„è¯­å¥</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šè¿°å‚æ•°è¯´æ˜</p></blockquote><ul><li>idåˆ—ï¼Œç”¨æˆ·ç™»å½•mysqlæ—¶ï¼Œç³»ç»Ÿåˆ†é…çš„â€connection_idâ€ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°connection_id()æŸ¥çœ‹ </li><li>useråˆ—ï¼Œæ˜¾ç¤ºå½“å‰ç”¨æˆ·ã€‚å¦‚æœä¸æ˜¯rootï¼Œè¿™ä¸ªå‘½ä»¤å°±åªæ˜¾ç¤ºç”¨æˆ·æƒé™èŒƒå›´çš„sqlè¯­å¥</li><li>hoståˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªè¯­å¥æ˜¯ä»å“ªä¸ªipçš„å“ªä¸ªç«¯å£ä¸Šå‘çš„ï¼Œå¯ä»¥ç”¨æ¥è·Ÿè¸ªå‡ºç°é—®é¢˜è¯­å¥çš„ç”¨æˆ· </li><li>dbåˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªè¿›ç¨‹ç›®å‰è¿æ¥çš„æ˜¯å“ªä¸ªæ•°æ®åº“</li><li>commandåˆ—ï¼Œæ˜¾ç¤ºå½“å‰è¿æ¥çš„æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸€èˆ¬å–å€¼ä¸ºä¼‘çœ ï¼ˆsleepï¼‰ï¼ŒæŸ¥è¯¢ï¼ˆqueryï¼‰ï¼Œè¿æ¥<br>ï¼ˆconnectï¼‰ç­‰</li><li>timeåˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªçŠ¶æ€æŒç»­çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ </li><li>stateåˆ—ï¼Œæ˜¾ç¤ºä½¿ç”¨å½“å‰è¿æ¥çš„sqlè¯­å¥çš„çŠ¶æ€ï¼Œå¾ˆé‡è¦çš„åˆ—ã€‚stateæè¿°çš„æ˜¯è¯­å¥æ‰§è¡Œä¸­çš„æŸä¸€ä¸ªçŠ¶æ€ã€‚ä¸€<br>ä¸ªsqlè¯­å¥ï¼Œä»¥æŸ¥è¯¢ä¸ºä¾‹ï¼Œå¯èƒ½éœ€è¦ç»è¿‡copying to tmp tableã€sorting resultã€sending dataç­‰çŠ¶æ€æ‰å¯ä»¥å®Œæˆ</li><li>infoåˆ—ï¼Œæ˜¾ç¤ºè¿™ä¸ªsqlè¯­å¥ï¼Œæ˜¯åˆ¤æ–­é—®é¢˜è¯­å¥çš„ä¸€ä¸ªé‡è¦ä¾æ®</li></ul><h3 id="2ã€ä½¿ç”¨show-processlistå®æ—¶ç›‘æ§æ…¢æŸ¥è¯¢sql"><a href="#2ã€ä½¿ç”¨show-processlistå®æ—¶ç›‘æ§æ…¢æŸ¥è¯¢sql" class="headerlink" title="2ã€ä½¿ç”¨show processlistå®æ—¶ç›‘æ§æ…¢æŸ¥è¯¢sql"></a>2ã€ä½¿ç”¨show processlistå®æ—¶ç›‘æ§æ…¢æŸ¥è¯¢sql</h3><blockquote><p>åœ¨ä¸€å¼ å¤§æ•°æ®è¡¨ä¸­ï¼Œæ‰§è¡Œä¸€æ¡æ…¢æŸ¥è¯¢sqlï¼Œç„¶åå¿«é€Ÿä½¿ç”¨ <code>show processlist</code> æŸ¥çœ‹ï¼Œç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308161158.png" alt="image-20210308161158303"></p><h2 id="3-3ã€Explainåˆ†ææ‰§è¡Œè®¡åˆ’"><a href="#3-3ã€Explainåˆ†ææ‰§è¡Œè®¡åˆ’" class="headerlink" title="3.3ã€Explainåˆ†ææ‰§è¡Œè®¡åˆ’"></a>3.3ã€Explainåˆ†ææ‰§è¡Œè®¡åˆ’</h2><blockquote><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤æŸ¥è¯¢åˆ°æ•ˆç‡ä½çš„ SQL è¯­å¥åï¼Œå¯ä»¥é€šè¿‡ EXPLAINæˆ–è€… DESCå‘½ä»¤è·å– MySQLå¦‚ä½•æ‰§è¡Œ SELECT è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨  SELECT  è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­è¡¨å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºã€‚</p></blockquote><h3 id="1ã€ä½¿ç”¨-explain-æŸ¥è¯¢SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’"><a href="#1ã€ä½¿ç”¨-explain-æŸ¥è¯¢SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’" class="headerlink" title="1ã€ä½¿ç”¨ explain æŸ¥è¯¢SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’"></a>1ã€ä½¿ç”¨ explain æŸ¥è¯¢SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’</h3><blockquote><p>explain è¦æŸ¥è¯¢çš„SQLè¯­å¥;</p><p>è¿™é‡Œä»¥è§†é¢‘ç»™çš„æ•°æ®åº“è¡¨ä¸ºä¾‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_item;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308162534.png" alt="image-20210308162533553"></p><blockquote><p>è¯´æ˜</p></blockquote><table><thead><tr><th><strong>å­—æ®µ</strong></th><th><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td>id</td><td>selectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œæ˜¯ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåºã€‚</td></tr><tr><td>select_type</td><td>è¡¨ç¤º  SELECT  çš„ç±»å‹ï¼Œå¸¸è§çš„å–å€¼æœ‰  SIMPLEï¼ˆç®€å•è¡¨ï¼Œå³ä¸ä½¿ç”¨è¡¨è¿æ¥æˆ–è€…å­æŸ¥è¯¢ï¼‰ã€PRIMARYï¼ˆä¸»æŸ¥è¯¢ï¼Œå³å¤–å±‚çš„æŸ¥è¯¢ï¼‰ã€UNIONï¼ˆUNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„æŸ¥è¯¢è¯­å¥ï¼‰ã€SUBQUERYï¼ˆå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª   SELECTï¼‰ç­‰</td></tr><tr><td>table</td><td>è¾“å‡ºç»“æœé›†çš„è¡¨</td></tr><tr><td>type</td><td>è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹ï¼Œæ€§èƒ½ç”±å¥½åˆ°å·®çš„è¿æ¥ç±»å‹ä¸º( system â€”&gt; const â€”â€“&gt; eq_ref â€”â€”&gt; refâ€”â€”-&gt; ref_or_nullâ€”-&gt; index_merge â€”&gt; index_subquery â€”â€“&gt; range â€”â€“&gt; index â€”â€”&gt; all )</td></tr><tr><td>possible_keys</td><td>è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</td></tr><tr><td>key</td><td>è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•</td></tr><tr><td>key_len</td><td>ç´¢å¼•å­—æ®µçš„é•¿åº¦</td></tr><tr><td>rows</td><td>æ‰«æè¡Œçš„æ•°é‡</td></tr><tr><td>extra</td><td>æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°</td></tr></tbody></table><h3 id="2ã€ç¯å¢ƒå‡†å¤‡"><a href="#2ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2ã€ç¯å¢ƒå‡†å¤‡"></a>2ã€ç¯å¢ƒå‡†å¤‡</h3><blockquote><p>å‡†å¤‡ä¸‰å¼ è¡¨ï¼Œè¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308162901.png" alt="image-20210308162901514"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;t_role&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;          varchar(32) NOT NULL,</span><br><span class="line">    &#96;role_name&#96;   varchar(255) DEFAULT NULL,</span><br><span class="line">    &#96;role_code&#96;   varchar(255) DEFAULT NULL,</span><br><span class="line">    &#96;description&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">    UNIQUE KEY &#96;unique_role_name&#96; (&#96;role_name&#96;)</span><br><span class="line">) ENGINE &#x3D; InnoDB</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;t_user&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;       varchar(32) NOT NULL,</span><br><span class="line">    &#96;username&#96; varchar(45) NOT NULL,</span><br><span class="line">    &#96;password&#96; varchar(96) NOT NULL,</span><br><span class="line">    &#96;name&#96;     varchar(45) NOT NULL,</span><br><span class="line"></span><br><span class="line">    PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">    UNIQUE KEY &#96;unique_user_username&#96; (&#96;username&#96;)</span><br><span class="line">) ENGINE &#x3D; InnoDB</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;user_role&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;      int(11) NOT NULL auto_increment,</span><br><span class="line">    &#96;user_id&#96; varchar(32) DEFAULT NULL,</span><br><span class="line">    &#96;role_id&#96; varchar(32) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">    KEY &#96;fk_ur_user_id&#96; (&#96;user_id&#96;),</span><br><span class="line">    KEY &#96;fk_ur_role_id&#96; (&#96;role_id&#96;),</span><br><span class="line">    CONSTRAINT &#96;fk_ur_role_id&#96; FOREIGN KEY (&#96;role_id&#96;) REFERENCES &#96;t_role&#96; (&#96;id&#96;) ON DELETE NO ACTION ON UPDATE NO ACTION,</span><br><span class="line">    CONSTRAINT &#96;fk_ur_user_id&#96; FOREIGN KEY (&#96;user_id&#96;) REFERENCES &#96;t_user&#96; (&#96;id&#96;) ON DELETE NO ACTION ON UPDATE NO ACTION</span><br><span class="line">) ENGINE &#x3D; InnoDB</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into &#96;t_user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;name&#96;)</span><br><span class="line">values (&#39;1&#39;, &#39;super&#39;, &#39;$2a$10$TJ4TmCdK.X4wv&#x2F;tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe&#39;, &#39;è¶…çº§ç®¡ç†å‘˜&#39;);</span><br><span class="line">insert into &#96;t_user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;name&#96;)</span><br><span class="line">values (&#39;2&#39;, &#39;admin&#39;, &#39;$2a$10$TJ4TmCdK.X4wv&#x2F;tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe&#39;, &#39;ç³»ç»Ÿç®¡ç†å‘˜&#39;);</span><br><span class="line">insert into &#96;t_user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;name&#96;)</span><br><span class="line">values (&#39;3&#39;, &#39;itcast&#39;, &#39;$2a$10$8qmaHgUFUAmPR5pOuWhYWOr291WJYjHelUlYn07k5ELF8ZCrW0Cui&#39;, &#39;test02&#39;);</span><br><span class="line">insert into &#96;t_user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;name&#96;)</span><br><span class="line">values (&#39;4&#39;, &#39;stu1&#39;, &#39;$2a$10$pLtt2KDAFpwTWLjNsmTEi.oU1yOZyIn9XkziK&#x2F;y&#x2F;spH5rftCpUMZa&#39;, &#39;å­¦ç”Ÿ1&#39;);</span><br><span class="line">insert into &#96;t_user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;name&#96;)</span><br><span class="line">values (&#39;5&#39;, &#39;stu2&#39;, &#39;$2a$10$nxPKkYSez7uz2YQYUnwhR.z57km3yqKn3Hr&#x2F;p1FR6ZKgc18u.Tvqm&#39;, &#39;å­¦ç”Ÿ2&#39;);</span><br><span class="line">insert into &#96;t_user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;name&#96;)</span><br><span class="line">values (&#39;6&#39;, &#39;t1&#39;, &#39;$2a$10$TJ4TmCdK.X4wv&#x2F;tCqHW14.w70U3CC33CeVncD3SLmyMXMknstqKRe&#39;, &#39;è€å¸ˆ 1&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;t_role&#96; (&#96;id&#96;, &#96;role_name&#96;, &#96;role_code&#96;, &#96;description&#96;)</span><br><span class="line">VALUES (&#39;5&#39;, &#39;å­¦ç”Ÿ&#39;, &#39;student&#39;, &#39;å­¦ç”Ÿ&#39;);</span><br><span class="line">INSERT INTO &#96;t_role&#96; (&#96;id&#96;, &#96;role_name&#96;, &#96;role_code&#96;, &#96;description&#96;)</span><br><span class="line">VALUES (&#39;7&#39;, &#39;è€å¸ˆ&#39;, &#39;teacher&#39;, &#39;è€å¸ˆ&#39;);</span><br><span class="line">INSERT INTO &#96;t_role&#96; (&#96;id&#96;, &#96;role_name&#96;, &#96;role_code&#96;, &#96;description&#96;)</span><br><span class="line">VALUES (&#39;8&#39;, &#39;æ•™å­¦ç®¡ç†å‘˜&#39;, &#39;teachmanager&#39;, &#39;æ•™å­¦ç®¡ç†å‘˜&#39;);</span><br><span class="line">INSERT INTO &#96;t_role&#96; (&#96;id&#96;, &#96;role_name&#96;, &#96;role_code&#96;, &#96;description&#96;)</span><br><span class="line">VALUES (&#39;9&#39;, &#39;ç®¡ç†å‘˜&#39;, &#39;admin&#39;, &#39;ç®¡ç†å‘˜&#39;);</span><br><span class="line">INSERT INTO &#96;t_role&#96; (&#96;id&#96;, &#96;role_name&#96;, &#96;role_code&#96;, &#96;description&#96;)</span><br><span class="line">VALUES (&#39;10&#39;, &#39;è¶…çº§ç®¡ç†å‘˜&#39;, &#39;super&#39;, &#39;è¶…çº§ç®¡ç†å‘˜&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO user_role(id, user_id, role_id)</span><br><span class="line">VALUES (NULL, &#39;1&#39;, &#39;5&#39;),</span><br><span class="line">       (NULL, &#39;1&#39;, &#39;7&#39;),</span><br><span class="line">       (NULL, &#39;2&#39;, &#39;8&#39;),</span><br><span class="line">       (NULL, &#39;3&#39;, &#39;9&#39;),</span><br><span class="line">       (NULL, &#39;4&#39;, &#39;8&#39;),</span><br><span class="line">       (NULL, &#39;5&#39;, &#39;10&#39;);</span><br></pre></td></tr></table></figure><h3 id="3ã€explain-ä¹‹-id"><a href="#3ã€explain-ä¹‹-id" class="headerlink" title="3ã€explain ä¹‹ id"></a>3ã€explain ä¹‹ id</h3><blockquote><p>id  å­—æ®µæ˜¯  selectæŸ¥è¯¢çš„åºåˆ—å·ï¼Œæ˜¯ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºçš„æ˜¯æŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–è€…æ˜¯æ“ä½œè¡¨çš„é¡ºåºã€‚</p><p>id  æƒ…å†µæœ‰ä¸‰ç§ï¼š</p></blockquote><ul><li> id  ç›¸åŒè¡¨ç¤ºåŠ è½½è¡¨çš„é¡ºåºæ˜¯ä»ä¸Šåˆ°ä¸‹</li></ul><blockquote><p>è¿™é‡Œä»¥ä¸€æ¡å¤šè¡¨æŸ¥è¯¢è¯­å¥ä¸ºä¾‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT *</span><br><span class="line">FROM t_user u</span><br><span class="line">JOIN user_role ur ON u.id &#x3D; ur.user_id</span><br><span class="line">JOIN t_role tr ON ur.role_id &#x3D; tr.id;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ° <code>ur</code> è¡¨çš„åŠ è½½é¡ºåºé«˜äº <code>tr</code> è¡¨å’Œ <code>u</code> è¡¨ï¼Œç¬¬ä¸€åˆ—ä¸æ˜¯ <code>id</code> ã€‚ã€‚ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308165156.png" alt="image-20210308165155913"></p><ul><li>id  ä¸åŒidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li></ul><blockquote><p>è¶Šå…ˆè¢«æ‰§è¡Œï¼Œè¿™é‡Œä»¥ä¸€æ¡å­æŸ¥è¯¢è¯­å¥ä¸ºä¾‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT *</span><br><span class="line">FROM t_role</span><br><span class="line">WHERE id &#x3D; (</span><br><span class="line">SELECT role_id</span><br><span class="line">FROM user_role</span><br><span class="line">WHERE user_id &#x3D; (</span><br><span class="line">SELECT id</span><br><span class="line">FROM t_user</span><br><span class="line">WHERE username &#x3D; &#39;stu1&#39;</span><br><span class="line">)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œè¯­å¥æŸ¥çœ‹ç»“æœï¼Œæœ€å†…å±‚çš„å­æŸ¥è¯¢çš„æ‰§è¡Œä¼˜å…ˆçº§æœ€é«˜ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308170831.png" alt="image-20210308170831240"></p><ul><li>id æœ‰ç›¸åŒï¼Œä¹Ÿæœ‰ä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ã€‚</li></ul><blockquote><p>idç›¸åŒçš„å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œï¼›åœ¨æ‰€æœ‰çš„ç»„ä¸­ï¼Œidçš„å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œã€‚</p><p>è¿™é‡Œä»¥ä¸€æ¡å¸¦å­æŸ¥è¯¢å’Œè¿æ¥æŸ¥è¯¢çš„sqlä¸ºä¾‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT *</span><br><span class="line">FROM t_role r, (</span><br><span class="line">SELECT *</span><br><span class="line">FROM user_role ur</span><br><span class="line">WHERE ur.&#96;user_id&#96; &#x3D; &#39;2&#39;</span><br><span class="line">) a</span><br><span class="line">WHERE r.id &#x3D; a.role_id;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœï¼Œå‘ç°å…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œåæ‰§è¡Œè¿æ¥æŸ¥è¯¢ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308171713.png" alt="image-20210308171713304"></p><h3 id="4ã€explain-ä¹‹-select-type"><a href="#4ã€explain-ä¹‹-select-type" class="headerlink" title="4ã€explain ä¹‹ select_type"></a>4ã€explain ä¹‹ select_type</h3><blockquote><p>è¡¨ç¤º SELECT çš„ç±»å‹ï¼Œå¸¸è§çš„å–å€¼å¦‚ä¸‹è¡¨ï¼Œä»ä¸Šåˆ°ä¸‹æ•ˆç‡è¶Šæ¥è¶Šä½ã€‚</p></blockquote><table><thead><tr><th><strong>select_type</strong></th><th><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td>SIMPLE</td><td>ç®€å•çš„selectæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€…UNION</td></tr><tr><td>PRIMARY</td><td><strong>æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­æŸ¥è¯¢ï¼Œæœ€å¤–å±‚æŸ¥è¯¢æ ‡è®°ä¸ºè¯¥æ ‡è¯†</strong></td></tr><tr><td>SUBQUERY</td><td>åœ¨SELECT æˆ– WHERE åˆ—è¡¨ä¸­åŒ…å«äº†å­æŸ¥è¯¢</td></tr><tr><td>DERIVED</td><td>åœ¨FROM åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢ï¼Œè¢«æ ‡è®°ä¸º DERIVEDï¼ˆè¡ç”Ÿï¼‰ MYSQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨ä¸­</td></tr><tr><td>UNION</td><td>è‹¥ç¬¬äºŒä¸ªSELECTå‡ºç°åœ¨UNIONä¹‹åï¼Œåˆ™æ ‡è®°ä¸ºUNION ï¼› è‹¥UNIONåŒ…å«åœ¨FROMå­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚SELECTå°†è¢«æ ‡è®°ä¸º  ï¼š  DERIVED</td></tr><tr><td>UNION RESULT</td><td>ä»UNIONè¡¨è·å–ç»“æœçš„SELECT</td></tr></tbody></table><h3 id="5ã€explain-ä¹‹-table"><a href="#5ã€explain-ä¹‹-table" class="headerlink" title="5ã€explain ä¹‹ table"></a>5ã€explain ä¹‹ table</h3><blockquote><p>å±•ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªä¸€å¼ è¡¨çš„</p></blockquote><h3 id="6ã€explain-ä¹‹-type"><a href="#6ã€explain-ä¹‹-type" class="headerlink" title="6ã€explain ä¹‹ type"></a>6ã€explain ä¹‹ type</h3><blockquote><p>type  æ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œå¯å–å€¼ä¸ºï¼š</p></blockquote><table><thead><tr><th><strong>type</strong></th><th><strong>å«ä¹‰</strong></th></tr></thead><tbody><tr><td>NULL</td><td>MySQLä¸è®¿é—®ä»»ä½•è¡¨ï¼Œç´¢å¼•ï¼Œç›´æ¥è¿”å›ç»“æœ</td></tr><tr><td>system</td><td>è¡¨åªæœ‰ä¸€è¡Œè®°å½•(ç­‰äºç³»ç»Ÿè¡¨)ï¼Œè¿™æ˜¯<code>const</code>ç±»å‹çš„ç‰¹ä¾‹ï¼Œä¸€èˆ¬ä¸ä¼šå‡ºç°</td></tr><tr><td><code>const</code></td><td>è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œ<code>const</code>ç”¨äºæ¯”è¾ƒprimary key æˆ–è€… unique ç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQL å°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸äº®ã€‚<code>const</code>äºå°†â€ä¸»é”®â€ æˆ– â€œå”¯ä¸€â€ ç´¢å¼•çš„æ‰€æœ‰éƒ¨åˆ†ä¸å¸¸é‡å€¼è¿›è¡Œæ¯”è¾ƒ</td></tr><tr><td><code>eq_ref</code></td><td>ç±»ä¼¼refï¼ŒåŒºåˆ«åœ¨äºä½¿ç”¨çš„æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä½¿ç”¨ä¸»é”®çš„å…³è”æŸ¥è¯¢ï¼Œå…³è”æŸ¥è¯¢å‡ºçš„è®°å½•åªæœ‰ä¸€æ¡ã€‚å¸¸è§äºä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æ‰«æ</td></tr><tr><td>ref</td><td>éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œï¼ˆå¤šä¸ªï¼‰</td></tr><tr><td>range</td><td>åªæ£€ç´¢ç»™å®šè¿”å›çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚ where ä¹‹åå‡ºç° between ï¼Œ &lt; , &gt; , in ç­‰æ“ä½œã€‚</td></tr><tr><td>index</td><td>index ä¸ ALLçš„åŒºåˆ«ä¸º index ç±»å‹åªæ˜¯éå†äº†ç´¢å¼•æ ‘ï¼Œ é€šå¸¸æ¯”ALL å¿«ï¼Œ ALL æ˜¯éå†æ•°æ®æ–‡ä»¶ã€‚</td></tr><tr><td>all</td><td>å°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ</td></tr></tbody></table><ul><li>type ä¸º <code>null</code> çš„æƒ…å†µï¼Œä¾‹å¦‚ä½¿ç”¨ <code>select now() </code>è®¿é—®å½“å‰æ—¶é—´</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select now();</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308191128.png" alt="image-20210308191121013"></p><ul><li>type ä¸º <code>system</code> çš„æƒ…å†µï¼Œæ•°æ®æºä¸­åªæœ‰ä¸€æ¡æ•°æ®æ—¶å‡ºç°</li><li>type ä¸º <code>const</code> çš„æƒ…å†µï¼Œä½¿ç”¨ <code>t_user</code> è¡¨ä¸­çš„ <strong>ä¸»é”®ç´¢å¼•</strong> å’Œ <strong>å”¯ä¸€ç´¢å¼•</strong> æŸ¥çœ‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user where username &#x3D; &#39;super&#39;;</span><br><span class="line">explain select * from t_user where id &#x3D; &#39;1&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308192134.png" alt="image-20210308192134670"></p><ul><li><p>typeä¸º <code> eq_ref</code> çš„æƒ…å†µï¼Œä½¿ç”¨ä¸»é”®çš„å…³è”æŸ¥è¯¢ï¼Œå…³è”æŸ¥è¯¢å‡ºçš„è®°å½•åªæœ‰ä¸€æ¡ï¼›</p></li><li><p>typeä¸º <code>index</code> çš„æƒ…å†µï¼ŒæŸ¥è¯¢æ•´ä¸ªç´¢å¼•æ ‘ï¼Œæ•ˆç‡é€šå¸¸ä¸é«˜</p></li><li><p>typeä¸º <code>all</code> çš„æƒ…å†µï¼Œéå†æ•´ä¸ªæ•°æ®æ–‡ä»¶ã€‚</p></li></ul><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ° <code>range</code> çº§åˆ«ï¼Œæœ€å¥½è¾¾åˆ° <code>ref</code>ã€‚</p></blockquote><h3 id="7ã€explain-ä¹‹-key"><a href="#7ã€explain-ä¹‹-key" class="headerlink" title="7ã€explain ä¹‹ key"></a>7ã€explain ä¹‹ key</h3><ul><li>possible_keys : æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨çš„ç´¢å¼•ï¼Œ ä¸€ä¸ªæˆ–å¤šä¸ªã€‚</li><li>key ï¼š  å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œ  å¦‚æœä¸ºNULLï¼Œ åˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</li><li>key_len : è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œ  è¯¥å€¼ä¸ºç´¢å¼•å­—æ®µæœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œåœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œ é•¿åº¦è¶ŠçŸ­è¶Šå¥½ ã€‚</li><li>possible_keys : æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨çš„ç´¢å¼•ï¼Œ ä¸€ä¸ªæˆ–å¤šä¸ªã€‚</li><li>key ï¼š  å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œ  å¦‚æœä¸ºNULLï¼Œ åˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚</li></ul><h3 id="8ã€explain-ä¹‹-rows"><a href="#8ã€explain-ä¹‹-rows" class="headerlink" title="8ã€explain ä¹‹ rows"></a>8ã€explain ä¹‹ rows</h3><blockquote><p>æ‰«æè¡Œçš„æ•°é‡ã€‚</p></blockquote><h3 id="9ã€explain-ä¹‹-extra"><a href="#9ã€explain-ä¹‹-extra" class="headerlink" title="9ã€explain ä¹‹ extra"></a>9ã€explain ä¹‹ extra</h3><blockquote><p>å…¶ä»–çš„é¢å¤–çš„æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œåœ¨è¯¥åˆ—å±•ç¤º  ã€‚</p><p>ä¼˜åŒ–å‰ä¸¤ä¸ªï¼Œä¿æŒç¬¬ä¸‰ä¸ªã€‚</p></blockquote><table><thead><tr><th>extra</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>using ï¬lesort</code></td><td>è¯´æ˜mysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ï¼Œ   ç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€, æ•ˆç‡ä½ã€‚</td></tr><tr><td>using temporary</td><td>ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼ŒMySQLåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äº  order  by  å’Œgroup byï¼› æ•ˆç‡ä½</td></tr><tr><td>using index</td><td>è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œ  é¿å…è®¿é—®è¡¨çš„æ•°æ®è¡Œï¼Œ  æ•ˆç‡ä¸é”™ã€‚ç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®;å½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚</td></tr><tr><td>Using where</td><td>è¡¨æ˜ä½¿ç”¨äº†whereè¿‡æ»¤</td></tr><tr><td>using join buffer</td><td>ä½¿ç”¨äº†è¿æ¥ç¼“å­˜ï¼š</td></tr><tr><td>impossible where</td><td>whereå­å¥çš„å€¼æ€»æ˜¯falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç»„</td></tr></tbody></table><h3 id="10ã€explainä¹‹case"><a href="#10ã€explainä¹‹case" class="headerlink" title="10ã€explainä¹‹case"></a>10ã€explainä¹‹case</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312224222.png" alt="image-20210312224221780"></p><blockquote><p>æ‰§è¡Œé¡ºåºï¼š4-3-2-1-NULL</p></blockquote><ul><li>æ‰§è¡Œé¡ºåº4</li></ul><h2 id="3-4ã€show-profileåˆ†æSQL"><a href="#3-4ã€show-profileåˆ†æSQL" class="headerlink" title="3.4ã€show profileåˆ†æSQL"></a>3.4ã€show profileåˆ†æSQL</h2><blockquote><p>Mysqlä»5.0.37ç‰ˆæœ¬å¼€å§‹å¢åŠ äº†å¯¹ show proï¬les å’Œ show proï¬le è¯­å¥çš„æ”¯æŒã€‚show proï¬les èƒ½å¤Ÿåœ¨åšSQLä¼˜åŒ–æ—¶å¸®åŠ©æˆ‘ä»¬äº†è§£æ—¶é—´éƒ½è€—è´¹åˆ°å“ªé‡Œå»äº†ã€‚</p></blockquote><h3 id="1ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦æ”¯æŒprofile"><a href="#1ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦æ”¯æŒprofile" class="headerlink" title="1ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦æ”¯æŒprofile"></a>1ã€æŸ¥çœ‹å½“å‰MySQLæ˜¯å¦æ”¯æŒprofile</h3><blockquote><p>é€šè¿‡  have_proï¬ling  å‚æ•°ï¼Œèƒ½å¤Ÿçœ‹åˆ°å½“å‰MySQLæ˜¯å¦æ”¯æŒproï¬leï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@have_profiling;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308195521.png" alt="image-20210308195521096"></p><blockquote><p>é»˜è®¤proï¬lingæ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡setè¯­å¥åœ¨Sessionçº§åˆ«å¼€å¯proï¬lingï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set profiling &#x3D; 1;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308200027.png" alt="image-20210308200027227"></p><blockquote><p>æ­¤æ—¶æŸ¥çœ‹ <code>profiling</code> çš„å€¼ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@profiling;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308200142.png" alt="image-20210308200142645"></p><h3 id="2ã€ä½¿ç”¨-show-profiles-æŒ‡ä»¤æŸ¥çœ‹sqlè¯­å¥å’Œè€—æ—¶"><a href="#2ã€ä½¿ç”¨-show-profiles-æŒ‡ä»¤æŸ¥çœ‹sqlè¯­å¥å’Œè€—æ—¶" class="headerlink" title="2ã€ä½¿ç”¨ show profiles æŒ‡ä»¤æŸ¥çœ‹sqlè¯­å¥å’Œè€—æ—¶"></a>2ã€ä½¿ç”¨ show profiles æŒ‡ä»¤æŸ¥çœ‹sqlè¯­å¥å’Œè€—æ—¶</h3><blockquote><p>å…¶ä¸­ <code>Query</code> ä¸ºæ‰§è¡Œçš„SQLè¯­å¥ï¼Œè€Œ <code>Duration</code> ä¸ºè¯¥SQLæ‰§è¡Œè€—è´¹çš„æ—¶é—´ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308201914.png" alt="image-20210308201913192"></p><blockquote><p>åœ¨ä¸Šé¢æŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¹‹ä¸Šï¼Œå¯ä»¥é€šè¿‡ <code>show profile for query idå€¼</code> æŒ‡ä»¤æ¥æŸ¥çœ‹æŸæ¡sqlè¯­å¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚æŸ¥çœ‹<code>id</code>ä¸º5çš„æŸ¥è¯¢è¯­å¥çš„è¯¦ç»†ä¿¡æ¯ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show profile for query 5;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308202515.png" alt="image-20210308202515442"></p><blockquote><p>å‘ç° <code>Sending data</code> é˜¶æ®µèŠ±è´¹äº†æœ€å¤šæ—¶é—´ï¼›</p><p>Sending data çŠ¶æ€è¡¨ç¤º<strong>MySQLçº¿ç¨‹å¼€å§‹è®¿é—®æ•°æ®è¡Œå¹¶æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</strong>ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿”å›ä¸ªå®¢æˆ·ç«¯ã€‚</p><p><strong>ç”±äºåœ¨Sending dataçŠ¶æ€ä¸‹ï¼ŒMySQLçº¿ç¨‹å¾€å¾€éœ€è¦åšå¤§é‡çš„ç£ç›˜è¯»å–æ“ä½œï¼Œæ‰€ä»¥ç»å¸¸æ˜¯æ•´ä¸ªæŸ¥è¯¢ä¸­è€—æ—¶æœ€é•¿çš„çŠ¶æ€ã€‚</strong></p></blockquote><h2 id="3-5ã€traceåˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’"><a href="#3-5ã€traceåˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’" class="headerlink" title="3.5ã€traceåˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’"></a>3.5ã€traceåˆ†æä¼˜åŒ–å™¨æ‰§è¡Œè®¡åˆ’</h2><blockquote><p>MySQL5.6æä¾›äº†å¯¹SQLçš„è·Ÿè¸ªtrace,  é€šè¿‡traceæ–‡ä»¶èƒ½å¤Ÿè¿›ä¸€æ­¥äº†è§£ä¸ºä»€ä¹ˆä¼˜åŒ–å™¨é€‰æ‹©Aè®¡åˆ’,  è€Œä¸æ˜¯é€‰æ‹©Bè®¡åˆ’ã€‚</p></blockquote><h3 id="1ã€æ‰“å¼€trace-å¹¶è®¾ç½®æ ¼å¼å’Œå†…å­˜å¤§å°"><a href="#1ã€æ‰“å¼€trace-å¹¶è®¾ç½®æ ¼å¼å’Œå†…å­˜å¤§å°" class="headerlink" title="1ã€æ‰“å¼€trace å¹¶è®¾ç½®æ ¼å¼å’Œå†…å­˜å¤§å°"></a>1ã€æ‰“å¼€trace å¹¶è®¾ç½®æ ¼å¼å’Œå†…å­˜å¤§å°</h3><blockquote><p>æ‰“å¼€trace ï¼Œ è®¾ç½®æ ¼å¼ä¸º JSONï¼Œå¹¶è®¾ç½®traceæœ€å¤§èƒ½å¤Ÿä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œé¿å…è§£æè¿‡ç¨‹ä¸­å› ä¸ºé»˜è®¤å†…å­˜è¿‡å°è€Œä¸èƒ½å¤Ÿå®Œæ•´å±•ç¤ºã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SET  optimizer_trace&#x3D;&quot;enabled&#x3D;on&quot;,end_markers_in_json&#x3D;on;</span><br><span class="line">set  optimizer_trace_max_mem_size&#x3D;1000000;</span><br></pre></td></tr></table></figure><h3 id="2ã€æ‰§è¡ŒSQLè¯­å¥"><a href="#2ã€æ‰§è¡ŒSQLè¯­å¥" class="headerlink" title="2ã€æ‰§è¡ŒSQLè¯­å¥"></a>2ã€æ‰§è¡ŒSQLè¯­å¥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from  where id &lt; 4;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309143138.png" alt="image-20210309143137932"></p><h3 id="3ã€æŸ¥çœ‹Mysqlå¦‚ä½•æ‰§è¡Œä¸Šè¿°çš„SQLè¯­å¥"><a href="#3ã€æŸ¥çœ‹Mysqlå¦‚ä½•æ‰§è¡Œä¸Šè¿°çš„SQLè¯­å¥" class="headerlink" title="3ã€æŸ¥çœ‹Mysqlå¦‚ä½•æ‰§è¡Œä¸Šè¿°çš„SQLè¯­å¥"></a>3ã€æŸ¥çœ‹Mysqlå¦‚ä½•æ‰§è¡Œä¸Šè¿°çš„SQLè¯­å¥</h3><blockquote><p>æ£€æŸ¥ <code>infomation_schema</code>.<code>optimizer_trace</code> å°±å¯ä»¥çŸ¥é“<strong>MySQL</strong>æ˜¯å¦‚ä½•æ‰§è¡ŒSQLçš„</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from  information_schema.optimizer_trace\G;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309143751.png" alt="image-20210309143751852"></p><h1 id="å››ã€ç´¢å¼•çš„ä½¿ç”¨"><a href="#å››ã€ç´¢å¼•çš„ä½¿ç”¨" class="headerlink" title="å››ã€ç´¢å¼•çš„ä½¿ç”¨"></a>å››ã€ç´¢å¼•çš„ä½¿ç”¨</h1><blockquote><p><strong>ç´¢å¼•æ˜¯æ•°æ®åº“ä¼˜åŒ–æœ€å¸¸ç”¨ä¹Ÿæ˜¯æœ€é‡è¦çš„æ‰‹æ®µä¹‹ä¸€</strong>ï¼Œé€šè¿‡ç´¢å¼•é€šå¸¸å¯ä»¥å¸®åŠ©ç”¨æˆ·<strong>è§£å†³å¤§å¤šæ•°çš„MySQLçš„æ€§èƒ½ä¼˜åŒ–é—®é¢˜ã€‚</strong></p></blockquote><h2 id="4-1ã€éªŒè¯ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡"><a href="#4-1ã€éªŒè¯ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡" class="headerlink" title="4.1ã€éªŒè¯ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡"></a>4.1ã€éªŒè¯ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡</h2><blockquote><p>åœ¨æˆ‘ä»¬å‡†å¤‡çš„è¡¨ç»“æ„tb_item ä¸­ï¼Œ ä¸€å…±å­˜å‚¨äº† 300 ä¸‡è®°å½•ï¼›</p></blockquote><h3 id="1ã€æ ¹æ®IDæŸ¥è¯¢"><a href="#1ã€æ ¹æ®IDæŸ¥è¯¢" class="headerlink" title="1ã€æ ¹æ®IDæŸ¥è¯¢"></a>1ã€æ ¹æ®IDæŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_item where id &#x3D; 1999\G;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309160155.png" alt="image-20210309160155777"></p><blockquote><p>æŸ¥è¯¢é€Ÿåº¦å¾ˆå¿«ï¼Œ æ¥è¿‘0s ï¼Œ <strong>ä¸»è¦çš„åŸå› æ˜¯å› ä¸ºidä¸ºä¸»é”®</strong>ï¼Œ æœ‰ç´¢å¼•ï¼›</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309160229.png" alt="image-20210309160229150"></p><h3 id="2ã€æ ¹æ®titleè¿›è¡Œç²¾ç¡®æŸ¥è¯¢"><a href="#2ã€æ ¹æ®titleè¿›è¡Œç²¾ç¡®æŸ¥è¯¢" class="headerlink" title="2ã€æ ¹æ®titleè¿›è¡Œç²¾ç¡®æŸ¥è¯¢"></a>2ã€æ ¹æ®titleè¿›è¡Œç²¾ç¡®æŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_item where title &#x3D; &#39;iphoneX ç§»åŠ¨3G 32G941&#39;\G;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œsqlè¯­å¥ï¼Œå‘ç°è¿”å›æ—¶é—´é•¿è¾¾9s</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309161840.png" alt="image-20210309161840351"></p><blockquote><p>ä½¿ç”¨ <code>explain</code> æŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309161912.png" alt="image-20210309161912903"></p><h3 id="3ã€ä¼˜åŒ–æŸ¥è¯¢ï¼Œä¸ºtitleæ·»åŠ ç´¢å¼•"><a href="#3ã€ä¼˜åŒ–æŸ¥è¯¢ï¼Œä¸ºtitleæ·»åŠ ç´¢å¼•" class="headerlink" title="3ã€ä¼˜åŒ–æŸ¥è¯¢ï¼Œä¸ºtitleæ·»åŠ ç´¢å¼•"></a>3ã€ä¼˜åŒ–æŸ¥è¯¢ï¼Œä¸ºtitleæ·»åŠ ç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create index idx_item_title on tb_item(title);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºç´¢å¼•å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œè¿™æ˜¯å› ä¸ºMySQLåº•å±‚æ­£åœ¨ä¸º3000000æ¡æ•°æ®åˆ›å»ºç´¢å¼•ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309162151.png" alt="image-20210309162151125"></p><blockquote><p>ç´¢å¼•åˆ›å»ºå®Œæˆä¹‹åï¼Œå†æ¬¡è¿›è¡ŒæŸ¥è¯¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309162222.png" alt="image-20210309162222355"></p><blockquote><p>å†æ¬¡é€šè¿‡explainæŸ¥çœ‹SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°æ‰§è¡ŒSQLæ—¶ä½¿ç”¨äº†åˆšæ‰åˆ›å»ºçš„ç´¢å¼•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309162714.png" alt="image-20210309162714413"></p><h2 id="4-2ã€ç´¢å¼•çš„ä½¿ç”¨"><a href="#4-2ã€ç´¢å¼•çš„ä½¿ç”¨" class="headerlink" title="4.2ã€ç´¢å¼•çš„ä½¿ç”¨"></a>4.2ã€ç´¢å¼•çš„ä½¿ç”¨</h2><h3 id="1ã€å‡†å¤‡ç¯å¢ƒ"><a href="#1ã€å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="1ã€å‡†å¤‡ç¯å¢ƒ"></a>1ã€å‡†å¤‡ç¯å¢ƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">use index_study;</span><br><span class="line">create table &#96;tb_seller&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;sellerid&#96;   varchar(100),</span><br><span class="line">    &#96;name&#96;       varchar(100),</span><br><span class="line">    &#96;nickname&#96;   varchar(50),</span><br><span class="line">    &#96;password&#96;   varchar(60),</span><br><span class="line">    &#96;status&#96;     varchar(1),</span><br><span class="line">    &#96;address&#96;    varchar(100),</span><br><span class="line">    &#96;createtime&#96; datetime,</span><br><span class="line">    primary key (&#96;sellerid&#96;)</span><br><span class="line">) engine &#x3D; innodb</span><br><span class="line">  default charset &#x3D; utf8mb4;</span><br><span class="line"></span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;alibaba&#39;, &#39;é˜¿é‡Œå·´å·´&#39;, &#39;é˜¿é‡Œå° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;baidu&#39;, &#39;ç™¾åº¦ç§‘æŠ€æœ‰é™å…¬å¸&#39;, &#39;ç™¾åº¦å° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;huawei&#39;, &#39;åä¸ºç§‘æŠ€æœ‰é™å…¬å¸&#39;, &#39;åä¸ºå° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;0&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;itcast&#39;, &#39;ä¼ æ™ºæ’­å®¢æ•™è‚²ç§‘æŠ€æœ‰é™å…¬å¸&#39;, &#39;ä¼ æ™ºæ’­ å®¢&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;itheima&#39;, &#39;é»‘é©¬ç¨‹åºå‘˜&#39;, &#39;é»‘é©¬ç¨‹åº å‘˜&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;0&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;luoji&#39;, &#39;ç½—æŠ€ç§‘æŠ€æœ‰é™å…¬å¸&#39;, &#39;ç½—æŠ€å° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;oppo&#39;, &#39;OPPOç§‘æŠ€æœ‰é™å…¬å¸&#39;, &#39;OPPOå®˜æ–¹æ——èˆ° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;0&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;ourpalm&#39;, &#39;æŒè¶£ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸&#39;, &#39;æŒè¶£å° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;qiandu&#39;, &#39;åƒåº¦ç§‘æŠ€&#39;, &#39;åƒåº¦å° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;2&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;sina&#39;, &#39;æ–°æµªç§‘æŠ€æœ‰é™å…¬å¸&#39;, &#39;æ–°æµªå®˜æ–¹æ——èˆ° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;xiaomi&#39;, &#39;å°ç±³ç§‘æŠ€&#39;, &#39;å°ç±³å®˜æ–¹æ——èˆ° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;è¥¿å®‰å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line">insert into &#96;tb_seller&#96; (&#96;sellerid&#96;, &#96;name&#96;, &#96;nickname&#96;, &#96;password&#96;, &#96;status&#96;, &#96;address&#96;, &#96;createtime&#96;)</span><br><span class="line">values (&#39;yijia&#39;, &#39;å®œå®¶å®¶å±…&#39;, &#39;å®œå®¶å®¶å±…æ——èˆ° åº—&#39;, &#39;e10adc3949ba59abbe56e057f20f883e&#39;, &#39;1&#39;, &#39;åŒ—äº¬å¸‚&#39;, &#39;2088-01-01 12:00:00&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create index idx_seller_name_sta_addr on tb_seller (name, status, address);</span><br></pre></td></tr></table></figure><h3 id="2ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å…¨å€¼åŒ¹é…"><a href="#2ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å…¨å€¼åŒ¹é…" class="headerlink" title="2ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å…¨å€¼åŒ¹é…"></a>2ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å…¨å€¼åŒ¹é…</h3><blockquote><p>å…¨å€¼åŒ¹é…ï¼Œ<strong>å¯¹ç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—éƒ½æŒ‡å®šå…·ä½“å€¼ã€‚</strong></p><p>è¯¥æƒ…å†µä¸‹ï¼Œç´¢å¼•ç”Ÿæ•ˆï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain selectfrom tb_seller where name&#x3D;&#39;å°ç±³ç§‘æŠ€&#39; and status&#x3D;&#39;1&#39; and address&#x3D;&#39;åŒ—äº¬å¸‚&#39;\G;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ <code>explain</code> æŸ¥çœ‹ä¸Šè¿°SQLçš„æ‰§è¡Œè®¡åˆ’ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309164955.png" alt="image-20210309164955128"></p><h3 id="3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“æœ€å·¦å‰ç¼€æ³•åˆ™"><a href="#3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“æœ€å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“æœ€å·¦å‰ç¼€æ³•åˆ™"></a>3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“æœ€å·¦å‰ç¼€æ³•åˆ™</h3><blockquote><p>å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æŒ‡çš„æ˜¯æŸ¥è¯¢ä»ç´¢å¼•çš„æœ€å·¦å‰åˆ—å¼€å§‹ï¼Œå¹¶ä¸”ä¸è·³è¿‡ä¸­é—´çš„åˆ—ï¼Œ</p><p>å¦‚æœè·³è¿‡ä¸­é—´åˆ—ï¼Œé‚£ä¹ˆåªä¼šä½¿ç”¨æœ€å·¦åˆ—çš„ç´¢å¼•ã€‚</p><p>ä¸Šè¿°çš„ç´¢å¼•åŠ åœ¨äº†(name, status, address)ä¸­ï¼Œé‚£ä¹ˆæŸ¥è¯¢å°±å¿…é¡»ä» <code>name</code> å¼€å§‹ä¸”ä¸èƒ½è·³è¿‡ <code>status</code> ç›´æ¥è·³åˆ°<code>address</code></p></blockquote><ul><li>åŒ¹é…æœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œèµ°ç´¢å¼•ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain  select * from tb_seller where name&#x3D;&#39;å°ç±³ç§‘æŠ€&#39; and status&#x3D;&#39;1&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309165331.png" alt="image-20210309165331229"></p><ul><li>è¿èƒŒæœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œç´¢å¼•å¤±æ•ˆ</li></ul><blockquote><p>è·³è¿‡nameç›´æ¥æŸ¥è¯¢status/addressï¼Œç´¢å¼•å¤±æ•ˆ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where status &#x3D; &#39;1&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309165918.png" alt="image-20210309165918715"></p><blockquote><p>è·³è¿‡ç´¢å¼•åˆ—ä¸­é—´çš„statusç›´æ¥åˆ°addressï¼Œæ­¤æ—¶åªæœ‰æœ€å·¦è¾¹çš„ç´¢å¼•åˆ—ï¼ˆnameï¼‰ç”Ÿæ•ˆ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39; and address &#x3D; &#39;è¥¿å®‰å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309170240.png" alt="image-20210309170240416"></p><blockquote><p>ä¸ä½¿ç”¨ç´¢å¼•çš„æœ€å·¦åˆ—è¿›è¡ŒæŸ¥è¯¢ï¼Œç´¢å¼•å¤±æ•ˆ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where status &#x3D; &#39;1&#39; and address &#x3D; &#39;è¥¿å®‰å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309170735.png" alt="image-20210309170735922"></p><blockquote><p>ç´¢å¼•å¤±æ•ˆä¸å¦ä¸ <code>where</code> å­å¥çš„ç»„è£…é¡ºåºæ— å…³ã€‚</p></blockquote><h3 id="3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•"><a href="#3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•" class="headerlink" title="3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•"></a>3ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•</h3><blockquote><p>èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—å°†ä¸èµ°ç´¢å¼•ï¼Œä¾‹å¦‚<code>status</code>ä½¿ç”¨äº†èŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆåªèµ° <code>name</code> å’Œ <code>status</code> çš„ç´¢å¼•ï¼Œä¸èµ° <code>address</code> çš„ç´¢å¼•ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39; and status &gt; &#39;1&#39; and address &#x3D; &#39;è¥¿å®‰å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309173327.png" alt="image-20210309173327169"></p><h3 id="4ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œ"><a href="#4ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œ" class="headerlink" title="4ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œ"></a>4ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“ä¸è¦åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œ</h3><blockquote><p>å¦‚æœåœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œï¼Œé‚£ä¹ˆç´¢å¼•å°†å¤±æ•ˆ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where substring(name,3,2) &#x3D; &#39;ç§‘æŠ€&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309173718.png" alt="image-20210309173718913"></p><blockquote><p>åœ¨statusåˆ—ä¸Šè¿›è¡Œè¿ç®—</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39; and status + 1 &#x3D; &#39;2&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309173901.png" alt="image-20210309173901729"></p><h3 id="5ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å­—ç¬¦ä¸²å¿…é¡»åŠ å•å¼•å·"><a href="#5ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å­—ç¬¦ä¸²å¿…é¡»åŠ å•å¼•å·" class="headerlink" title="5ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å­—ç¬¦ä¸²å¿…é¡»åŠ å•å¼•å·"></a>5ã€é¿å…ç´¢å¼•å¤±æ•ˆâ€“å­—ç¬¦ä¸²å¿…é¡»åŠ å•å¼•å·</h3><blockquote><p>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39; and status &#x3D; &#39;1&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309174606.png" alt="image-20210309174606023"></p><blockquote><p>æ¼”ç¤ºä¸åŠ å•å¼•å·çš„æƒ…å†µ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39; and status &#x3D; 1;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309174724.png" alt="image-20210309174724689"></p><blockquote><p>ç”±äºï¼Œåœ¨æŸ¥è¯¢æ—¶æ²¡æœ‰å¯¹å­—ç¬¦ä¸²åŠ å•å¼•å·ï¼ŒMySQLçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨çš„è¿›è¡Œç±»å‹è½¬æ¢ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆã€‚</p></blockquote><h3 id="6ã€å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…select"><a href="#6ã€å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…select" class="headerlink" title="6ã€å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…select *"></a>6ã€å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…select *</h3><blockquote><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼ˆåªè®¿é—®ç´¢å¼•çš„æŸ¥è¯¢ï¼ˆç´¢å¼•åˆ—å®Œå…¨åŒ…å«æŸ¥è¯¢åˆ—ï¼‰ï¼‰ï¼Œå‡å°‘select  *  </p><p>å¦‚æœæŸ¥è¯¢åˆ—ï¼Œè¶…å‡ºç´¢å¼•åˆ—ï¼Œä¹Ÿä¼šé™ä½æ€§èƒ½ã€‚ï¼ˆä¾‹å¦‚å¤šæŸ¥è¯¢äº†ä¸€ä¸ªpasswordä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼‰</p><p>TIPS:</p></blockquote><ul><li>using index ï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æ—¶å€™å°±ä¼šå‡ºç°</li><li>using  whereï¼šåœ¨æŸ¥æ‰¾ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å›è¡¨å»æŸ¥è¯¢æ‰€éœ€çš„æ•°æ®</li><li>using index conditionï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®</li><li>using index ; using whereï¼šæŸ¥æ‰¾ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†æ˜¯éœ€è¦çš„æ•°æ®éƒ½åœ¨ç´¢å¼•åˆ—ä¸­èƒ½æ‰¾åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®</li></ul><h3 id="7ã€oråˆ†éš”çš„æ¡ä»¶"><a href="#7ã€oråˆ†éš”çš„æ¡ä»¶" class="headerlink" title="7ã€oråˆ†éš”çš„æ¡ä»¶"></a>7ã€oråˆ†éš”çš„æ¡ä»¶</h3><blockquote><p>oråˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œ å¦‚æœ<strong>orå‰çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•</strong>ï¼Œè€Œ<strong>åé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•</strong>ï¼Œé‚£ä¹ˆ<strong>æ¶‰åŠçš„ç´¢å¼•éƒ½ä¸ä¼šè¢«ç”¨åˆ°</strong>ã€‚</p><p>ç¤ºä¾‹ï¼Œnameå­—æ®µæ˜¯ç´¢å¼•åˆ— ï¼Œ è€Œ<code>createtime</code>ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œä¸­é—´æ˜¯orè¿›è¡Œè¿æ¥æ˜¯ä¸èµ°ç´¢å¼•çš„ ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain selectfrom tb_seller where name&#x3D;&#39;é»‘é©¬ç¨‹åºå‘˜&#39; or createtime &#x3D; &#39;2088-01-01 12:00:00&#39;\G;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309192548.png" alt="image-20210309192547979"></p><h3 id="8ã€ä»¥-å¼€å¤´çš„Likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œç´¢å¼•å¤±æ•ˆã€‚"><a href="#8ã€ä»¥-å¼€å¤´çš„Likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œç´¢å¼•å¤±æ•ˆã€‚" class="headerlink" title="8ã€ä»¥%å¼€å¤´çš„Likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œç´¢å¼•å¤±æ•ˆã€‚"></a>8ã€ä»¥%å¼€å¤´çš„Likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œç´¢å¼•å¤±æ•ˆã€‚</h3><blockquote><p>å¦‚æœä»…ä»…æ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šå¤±æ•ˆã€‚å¦‚æœæ˜¯å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name like &#39;%é»‘é©¬&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309192904.png" alt="image-20210309192904852"></p><blockquote><p>ä½†å³%ä¸ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name like &#39;é»‘é©¬%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309193636.png" alt="image-20210309193636267"></p><ul><li>è§£å†³æ–¹æ³•</li></ul><blockquote><p>é€šè¿‡è¦†ç›–ç´¢å¼•ï¼ˆå°½é‡ä¸è¦ä½¿ç”¨select * ï¼Œä½¿ç”¨ç´¢å¼•ä¸­çš„é‚£äº›åˆ—ï¼‰æ¥è§£å†³</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select name,status,address from tb_seller where name like &#39;%é»‘é©¬%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309194114.png" alt="image-20210309194114849"></p><blockquote><p>å¦‚æœæŸ¥è¯¢çš„åˆ—ä¸­æœ‰ä¸å«ç´¢å¼•çš„å±æ€§ï¼Œé‚£ä¹ˆç´¢å¼•å°†å¤±æ•ˆã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309194214.png" alt="image-20210309194214600"></p><h3 id="9ã€å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚"><a href="#9ã€å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚" class="headerlink" title="9ã€å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚"></a>9ã€å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚</h3><blockquote><p>ä¸º <code>address</code> åˆ›å»ºä¸€ä¸ªå•åˆ—ç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index &#96;idx_address&#96; on tb_seller(address);</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309195218.png" alt="image-20210309195217953"></p><blockquote><p>æ‰§è¡Œä»¥ä¸‹çš„ sql è¯­å¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where address &#x3D; &#39;åŒ—äº¬å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309195502.png" alt="image-20210309195502240"></p><blockquote><p>å°†ä¸Šè¿°çš„æ¡ä»¶ä¿®æ”¹ä¸º <code>è¥¿å®‰å¸‚</code>ï¼Œå†æ¬¡æ‰§è¡Œ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where address &#x3D; &#39;è¥¿å®‰å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309200903.png" alt="image-20210309200903109"></p><ul><li>ä¸ºä»€ä¹ˆï¼Ÿ</li></ul><blockquote><p>å› ä¸ºåœ¨tb_sellerè¡¨ä¸­ <code>address</code> ä¸º åŒ—äº¬å¸‚ çš„æ•°æ®å æ¯”éå¸¸å¤§ï¼Œä½¿ç”¨ç´¢å¼•ä¸å¦‚è¿›è¡Œå…¨è¡¨æ‰«æã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309201819.png" alt="image-20210309201819199"></p><h3 id="10ã€is-NULLã€is-NOT-NULL-æœ‰æ—¶ç´¢å¼•å¤±æ•ˆã€‚"><a href="#10ã€is-NULLã€is-NOT-NULL-æœ‰æ—¶ç´¢å¼•å¤±æ•ˆã€‚" class="headerlink" title="10ã€is NULLã€is NOT NULL æœ‰æ—¶ç´¢å¼•å¤±æ•ˆã€‚"></a>10ã€is NULLã€is NOT NULL <code>æœ‰æ—¶</code>ç´¢å¼•å¤±æ•ˆã€‚</h3><blockquote><p>ç”±äºä¸Šé¢æˆ‘ä»¬ä¸º <code>address</code> æ·»åŠ äº†å•åˆ—ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥ <code>address</code> ä¸ºä¾‹ã€‚</p></blockquote><ul><li>IS NULL</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where address is null;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309202349.png" alt="image-20210309202349694"></p><blockquote><p>å‘ç°æ­¤æ—¶èµ°äº†ç´¢å¼•ã€‚</p></blockquote><ul><li>IS NOT NULL</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where address is not null;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309202621.png" alt="image-20210309202621190"></p><blockquote><p>å‘ç°æ­¤æ—¶ä¸èµ°ç´¢å¼•ã€‚</p></blockquote><ul><li>åŸå› </li></ul><blockquote><p>è¿™æ˜¯å› ä¸ºåœ¨ tb_seller è¡¨ä¸­ç»å¤§éƒ¨åˆ†æ•°æ®çš„ <code>address</code> å±æ€§éƒ½ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå½“ä½¿ç”¨ <strong>IS NOT NULL</strong> çš„æ—¶å€™ï¼Œç”±äºéç©ºçš„æ•°æ®å¤ªå¤šï¼Œè¿˜ä¸å¦‚ç›´æ¥æ‰«æå…¨è¡¨ã€‚</p><p>è€Œä½¿ç”¨ <strong>is null</strong> æ—¶ï¼Œç”±äºä¸ºç©ºçš„æ•°æ®ä¸å¤šï¼Œæ‰€ä»¥ä½¿ç”¨ç´¢å¼•é€Ÿåº¦å¿«ã€‚</p></blockquote><h3 id="11ã€Inã€not-In-æœ‰æ—¶-ä¸ä½¿ç”¨ç´¢å¼•"><a href="#11ã€Inã€not-In-æœ‰æ—¶-ä¸ä½¿ç”¨ç´¢å¼•" class="headerlink" title="11ã€Inã€not In æœ‰æ—¶ ä¸ä½¿ç”¨ç´¢å¼•"></a>11ã€Inã€not In <code>æœ‰æ—¶</code> ä¸ä½¿ç”¨ç´¢å¼•</h3><blockquote><p>ä½¿ç”¨<code>in</code>è¿›è¡Œæµ‹è¯•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where sellerid in (&#39;oppo&#39;,&#39;xiaomi&#39;,&#39;sina&#39;);</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309212907.png" alt="image-20210309212906507"></p><blockquote><p>ä½¿ç”¨ <code>not in</code> è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°ä½¿ç”¨ç´¢å¼•ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where sellerid not in (&#39;oppo&#39;,&#39;xiaomi&#39;,&#39;sina&#39;);</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309213506.png" alt="image-20210309213506912"></p><p><strong>Inã€not in ä½¿ä¸ä½¿ç”¨ç´¢å¼•ä¸æ˜¯ä¸€åˆ€åˆ‡çš„ã€‚</strong></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309214046.png" alt="image-20210309214046113"></p><h3 id="12ã€å•åˆ—ç´¢å¼•å’Œå¤åˆç´¢å¼•"><a href="#12ã€å•åˆ—ç´¢å¼•å’Œå¤åˆç´¢å¼•" class="headerlink" title="12ã€å•åˆ—ç´¢å¼•å’Œå¤åˆç´¢å¼•"></a>12ã€å•åˆ—ç´¢å¼•å’Œå¤åˆç´¢å¼•</h3><blockquote><p>å°½é‡ä½¿ç”¨å¤åˆç´¢å¼•ï¼Œè€Œå°‘ä½¿ç”¨å•åˆ—ç´¢å¼•ã€‚</p><p>åˆ›å»ºå¤åˆç´¢å¼•ï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_name_sta_address on tb_seller(name, status, address);</span><br></pre></td></tr></table></figure><blockquote><p>ç›¸å½“äºåˆ›å»ºäº†ä¸‰ä¸ªç´¢å¼•ï¼š</p><p>name<br>name + status<br>name + status + address</p></blockquote><ul><li>åˆ›å»ºå•åˆ—ç´¢å¼•ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨å¤šä¸ªå¸¦ç´¢å¼•çš„å­—æ®µè¿›è¡Œæœç´¢æ—¶ï¼Œä¸ä¼šä½¿ç”¨å…¨éƒ¨ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create index idx_seller_name on tb_seller(name);</span><br><span class="line">create index idx_seller_status on tb_seller(status);</span><br><span class="line">create index idx_seller_address on tb_seller(address);</span><br></pre></td></tr></table></figure><blockquote><p>æ•°æ®åº“ä¼šé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜ç´¢å¼•æ¥ä½¿ç”¨ã€‚</p></blockquote><ul><li>æ¼”ç¤ºå•åˆ—ç´¢å¼•å’Œå¤åˆç´¢å¼•çš„åŒºåˆ«</li></ul><blockquote><p>åˆ é™¤ä¸Šé¢ä¸º <code>address</code> åˆ›å»ºçš„å•åˆ—ç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index &#96;idx_address&#96; on tb_seller;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309215039.png" alt="image-20210309215039873"></p><blockquote><p>æ­¤æ—¶ä½¿ç”¨å¤åˆç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥æ‰¾</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39; and status &#x3D; &#39;1&#39; and address &#x3D; &#39;è¥¿å®‰å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309215250.png" alt="image-20210309215250200"></p><blockquote><p>åˆ é™¤è¡¨ä¸­çš„å¤åˆç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index idx_seller_name_sta_addr on tb_seller;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309215443.png" alt="image-20210309215443870"></p><blockquote><p>åˆ›å»ºä¸‰ä¸ªå•åˆ—ç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create index idx_seller_name on tb_seller(name);</span><br><span class="line">create index idx_seller_status on tb_seller(status);</span><br><span class="line">create index idx_seller_address on tb_seller(address);</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309215558.png" alt="image-20210309215558021"></p><blockquote><p>å†æ¬¡æ‰§è¡Œä¸Šé¢çš„æŸ¥è¯¢è¯­å¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39; and status &#x3D; &#39;1&#39; and address &#x3D; &#39;è¥¿å®‰å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309215727.png" alt="image-20210309215727053"></p><blockquote><p>ç”±äº<code>name</code>åˆ—ä¸­çš„æ•°æ®è¾¨è¯†åº¦æœ€é«˜ã€‚</p></blockquote><h2 id="4-3ã€æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ"><a href="#4-3ã€æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ" class="headerlink" title="4.3ã€æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ"></a>4.3ã€æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ</h2><h3 id="1ã€æŸ¥çœ‹å½“å‰è¿æ¥ï¼ˆä¼šè¯ï¼‰çš„ç´¢å¼•æƒ…å†µ"><a href="#1ã€æŸ¥çœ‹å½“å‰è¿æ¥ï¼ˆä¼šè¯ï¼‰çš„ç´¢å¼•æƒ…å†µ" class="headerlink" title="1ã€æŸ¥çœ‹å½“å‰è¿æ¥ï¼ˆä¼šè¯ï¼‰çš„ç´¢å¼•æƒ…å†µ"></a>1ã€æŸ¥çœ‹å½“å‰è¿æ¥ï¼ˆä¼šè¯ï¼‰çš„ç´¢å¼•æƒ…å†µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like &#39;Handler_read%&#39;; </span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309221124.png" alt="image-20210309221124262"></p><h3 id="2ã€æŸ¥çœ‹å…¨å±€ç´¢å¼•ä½¿ç”¨æƒ…å†µ"><a href="#2ã€æŸ¥çœ‹å…¨å±€ç´¢å¼•ä½¿ç”¨æƒ…å†µ" class="headerlink" title="2ã€æŸ¥çœ‹å…¨å±€ç´¢å¼•ä½¿ç”¨æƒ…å†µ"></a>2ã€æŸ¥çœ‹å…¨å±€ç´¢å¼•ä½¿ç”¨æƒ…å†µ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show global status like &#39;Handler_read%&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309221157.png" alt="image-20210309221157356"></p><h3 id="3ã€å±æ€§è¯´æ˜"><a href="#3ã€å±æ€§è¯´æ˜" class="headerlink" title="3ã€å±æ€§è¯´æ˜"></a>3ã€å±æ€§è¯´æ˜</h3><ul><li><p>Handler_read_firstï¼šç´¢å¼•ä¸­ç¬¬ä¸€æ¡è¢«è¯»çš„æ¬¡æ•°ã€‚å¦‚æœè¾ƒé«˜ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ­£æ‰§è¡Œå¤§é‡å…¨ç´¢å¼•æ‰«æï¼ˆè¿™ä¸ªå€¼è¶Šä½<br>è¶Šå¥½ï¼‰ã€‚</p></li><li><p>Handler_read_keyï¼šå¦‚æœç´¢å¼•æ­£åœ¨å·¥ä½œï¼Œè¿™ä¸ªå€¼ä»£è¡¨ä¸€ä¸ªè¡Œè¢«ç´¢å¼•å€¼è¯»çš„æ¬¡æ•°ï¼Œå¦‚æœå€¼è¶Šä½ï¼Œè¡¨ç¤ºç´¢å¼•å¾—åˆ°çš„<br>æ€§èƒ½æ”¹å–„ä¸é«˜ï¼Œå› ä¸ºç´¢å¼•ä¸ç»å¸¸ä½¿ç”¨ï¼ˆè¿™ä¸ªå€¼è¶Šé«˜è¶Šå¥½ï¼‰ã€‚</p></li><li><p>Handler_read_next   ï¼šæŒ‰ç…§é”®é¡ºåºè¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ ç”¨èŒƒå›´çº¦æŸæˆ–å¦‚æœæ‰§è¡Œç´¢å¼•æ‰«ææ¥æŸ¥è¯¢ç´¢å¼•åˆ—ï¼Œ<br>è¯¥å€¼å¢åŠ ã€‚</p></li><li><p>Handler_read_prevï¼šæŒ‰ç…§é”®é¡ºåºè¯»å‰ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚è¯¥è¯»æ–¹æ³•ä¸»è¦ç”¨äºä¼˜åŒ–ORDER BY â€¦ DESCã€‚</p></li><li><p>Handler_read_rnd   ï¼šæ ¹æ®å›ºå®šä½ç½®è¯»ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£æ‰§è¡Œå¤§é‡æŸ¥è¯¢å¹¶éœ€è¦å¯¹ç»“æœè¿›è¡Œæ’åºè¯¥å€¼è¾ƒé«˜ã€‚ä½ å¯èƒ½ä½¿ç”¨äº†å¤§é‡éœ€è¦MySQLæ‰«ææ•´ä¸ªè¡¨çš„æŸ¥è¯¢æˆ–ä½ çš„è¿æ¥æ²¡æœ‰æ­£ç¡®ä½¿ç”¨é”®ã€‚è¿™ä¸ªå€¼è¾ƒé«˜ï¼Œæ„å‘³ç€è¿è¡Œæ•ˆç‡ä½ï¼Œåº”<br>è¯¥å»ºç«‹ç´¢å¼•æ¥è¡¥æ•‘ã€‚</p></li><li><p>Handler_read_rnd_nextï¼šåœ¨æ•°æ®æ–‡ä»¶ä¸­è¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ã€‚å¦‚æœä½ æ­£è¿›è¡Œå¤§é‡çš„è¡¨æ‰«æï¼Œè¯¥å€¼è¾ƒé«˜ã€‚é€šå¸¸è¯´æ˜ä½ çš„è¡¨ç´¢å¼•ä¸æ­£ç¡®æˆ–å†™å…¥çš„æŸ¥è¯¢æ²¡æœ‰åˆ©ç”¨ç´¢å¼•ã€‚</p></li></ul><h2 id="4-4ã€ç»¼åˆæ¡ˆä¾‹"><a href="#4-4ã€ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="4.4ã€ç»¼åˆæ¡ˆä¾‹"></a>4.4ã€ç»¼åˆæ¡ˆä¾‹</h2><h3 id="1ã€ç¯å¢ƒå‡†å¤‡"><a href="#1ã€ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1ã€ç¯å¢ƒå‡†å¤‡"></a>1ã€ç¯å¢ƒå‡†å¤‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">create table test03</span><br><span class="line">(</span><br><span class="line">    id int primary key not null auto_increment,</span><br><span class="line">    c1 char(10),</span><br><span class="line">    c2 char(10),</span><br><span class="line">    c3 char(10),</span><br><span class="line">    c4 char(10),</span><br><span class="line">    c5 char(10)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into test03(c1, c2, c3, c4, c5)</span><br><span class="line">values (&#39;a1&#39;, &#39;a2&#39;, &#39;a3&#39;, &#39;a4&#39;, &#39;a5&#39;);</span><br><span class="line">insert into test03(c1, c2, c3, c4, c5)</span><br><span class="line">values (&#39;b1&#39;, &#39;b2&#39;, &#39;b3&#39;, &#39;b4&#39;, &#39;b5&#39;);</span><br><span class="line">insert into test03(c1, c2, c3, c4, c5)</span><br><span class="line">values (&#39;c1&#39;, &#39;c2&#39;, &#39;c3&#39;, &#39;c4&#39;, &#39;c5&#39;);</span><br><span class="line">insert into test03(c1, c2, c3, c4, c5)</span><br><span class="line">values (&#39;d1&#39;, &#39;d2&#39;, &#39;d3&#39;, &#39;d4&#39;, &#39;d5&#39;);</span><br><span class="line">insert into test03(c1, c2, c3, c4, c5)</span><br><span class="line">values (&#39;e1&#39;, &#39;e2&#39;, &#39;e3&#39;, &#39;e4&#39;, &#39;e5&#39;);</span><br><span class="line"></span><br><span class="line">create index idx_test03_c1234 on test03(c1,c2,c3,c4);</span><br></pre></td></tr></table></figure><h3 id="2ã€æ¡ˆä¾‹1"><a href="#2ã€æ¡ˆä¾‹1" class="headerlink" title="2ã€æ¡ˆä¾‹1"></a>2ã€æ¡ˆä¾‹1</h3><blockquote><p>åˆ†æä»¥ä¸‹æ¡ˆä¾‹çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1&#x3D;&#39;a1&#39; and c2&#x3D;&#39;a2&#39; and c4&#x3D;&#39;a4&#39; and c3&#x3D;&#39;a3&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313152742.png" alt="image-20210313152742780"></p><blockquote><p><strong>ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨ä¼˜åŒ–é¡ºåº</strong></p></blockquote><h3 id="3ã€æ¡ˆä¾‹2"><a href="#3ã€æ¡ˆä¾‹2" class="headerlink" title="3ã€æ¡ˆä¾‹2"></a>3ã€æ¡ˆä¾‹2</h3><blockquote><p>åˆ†æä»¥ä¸‹æ¡ˆä¾‹çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1&#x3D;&#39;a1&#39; and c2&#x3D;&#39;a2&#39; and c4&gt;&#39;a4&#39; and c3&#x3D;&#39;a3&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œä»ç„¶ç”¨åˆ°äº†4ä¸ªç´¢å¼•ï¼Œå› ä¸ºMySQLä¼˜åŒ–å™¨ä¼šä¼˜åŒ–é¡ºåºï¼Œå°†å…¶å˜ä¸ºa1,a2,a3,a4ï¼Œè™½ç„¶èŒƒå›´æ¯”è¾ƒåçš„åˆ—ä¸ä½¿ç”¨ç´¢å¼•ï¼Œä½†èŒƒå›´ç´¢å¼•çš„åˆ—æ˜¯ä½¿ç”¨ç´¢å¼•çš„ï¼Œæ‰€ä»¥ä½¿ç”¨äº†4ä¸ªç´¢å¼•ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤å¤„çš„<code>key_len</code>ä¸ä¸Šé¢ä¸€è‡´ï¼Œéƒ½æ˜¯164ï¼Œæ‰€ä»¥ä½¿ç”¨äº†4ä¸ªç´¢å¼•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313153801.png" alt="image-20210313153801605"></p><h3 id="4ã€æ¡ˆä¾‹3"><a href="#4ã€æ¡ˆä¾‹3" class="headerlink" title="4ã€æ¡ˆä¾‹3"></a>4ã€æ¡ˆä¾‹3</h3><blockquote><p>åˆ†æä»¥ä¸‹æ¡ˆä¾‹çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1&#x3D;&#39;a1&#39; and c2&#x3D;&#39;a2&#39; and c4&#x3D;&#39;a4&#39; order by c3;</span><br></pre></td></tr></table></figure><blockquote><p><strong>è¿™é‡Œå…¶å®ä¹Ÿä½¿ç”¨äº†c3è¿™ä¸ªç´¢å¼•ï¼Œåªä¸è¿‡c3ä½œç”¨åœ¨æ’åºè€Œä¸æ˜¯æŸ¥æ‰¾ï¼Œæ‰€ä»¥æ²¡æœ‰ç»Ÿè®¡è¿›keyä¸­ã€‚</strong></p><p>æ²¡æœ‰ä½¿ç”¨C4ç´¢å¼•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313154442.png" alt="image-20210313154442619"></p><h3 id="5ã€æ¡ˆä¾‹4"><a href="#5ã€æ¡ˆä¾‹4" class="headerlink" title="5ã€æ¡ˆä¾‹4"></a>5ã€æ¡ˆä¾‹4</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1&#x3D;&#39;a1&#39; and c2&#x3D;&#39;a2&#39; order by c4;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½†å‡ºç°äº† <code>filesort</code>ï¼Œå› ä¸ºæ­¤æ—¶æ²¡æœ‰c3ï¼Œc4ç´¢å¼•æ— æ³•ä½¿ç”¨äº†ã€‚</p></blockquote><h3 id="6ã€æ¡ˆä¾‹5"><a href="#6ã€æ¡ˆä¾‹5" class="headerlink" title="6ã€æ¡ˆä¾‹5"></a>6ã€æ¡ˆä¾‹5</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1&#x3D;&#39;a1&#39; and c4 &#x3D; &#39;a4&#39; order by c3,c2;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œä½¿ç”¨äº†c1ç´¢å¼•ï¼Œä½†ç”±äºc3ï¼Œc2é¡ºåºæ²¡æœ‰æŒ‰å»ºç´¢å¼•æ—¶çš„é¡ºåºæ’åºï¼Œæ‰€ä»¥c3ï¼Œc2æ‰€ä»¥å¤±æ•ˆï¼Œå‡ºç°äº† <code>filesort</code></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313155329.png" alt="image-20210313155329368"></p><h3 id="7ã€æ¡ˆä¾‹6"><a href="#7ã€æ¡ˆä¾‹6" class="headerlink" title="7ã€æ¡ˆä¾‹6"></a>7ã€æ¡ˆä¾‹6</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from test03 where c1=<span class="string">&#x27;a1&#x27;</span> and c2 = <span class="string">&#x27;a2&#x27;</span> and c5 = <span class="string">&#x27;a5&#x27;</span> order by c3,c2;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œä½¿ç”¨äº†c1ï¼Œc2ç´¢å¼•è¿›è¡Œæ’åºï¼Œç”±äºc2å·²ç»æœ‰å€¼äº†ï¼ˆå·²ç»æ˜¯ä¸€ä¸ªå¸¸é‡äº†ï¼‰ï¼Œæ‰€ä»¥æ­¤æ—¶c3ä¾ç„¶ç”Ÿæ•ˆï¼Œæ­¤æ—¶c3ç´¢å¼•ç”¨äºæ’åº</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313155621.png" alt="image-20210313155621217"></p><h1 id="äº”ã€SQLä¼˜åŒ–ï¼ˆäºŒï¼‰"><a href="#äº”ã€SQLä¼˜åŒ–ï¼ˆäºŒï¼‰" class="headerlink" title="äº”ã€SQLä¼˜åŒ–ï¼ˆäºŒï¼‰"></a>äº”ã€SQLä¼˜åŒ–ï¼ˆäºŒï¼‰</h1><h2 id="5-1ã€å¤§æ‰¹é‡æ’å…¥æ•°æ®"><a href="#5-1ã€å¤§æ‰¹é‡æ’å…¥æ•°æ®" class="headerlink" title="5.1ã€å¤§æ‰¹é‡æ’å…¥æ•°æ®"></a>5.1ã€å¤§æ‰¹é‡æ’å…¥æ•°æ®</h2><h3 id="1ã€ç¯å¢ƒå‡†å¤‡-1"><a href="#1ã€ç¯å¢ƒå‡†å¤‡-1" class="headerlink" title="1ã€ç¯å¢ƒå‡†å¤‡"></a>1ã€ç¯å¢ƒå‡†å¤‡</h3><blockquote><p>åˆ›å»ºä¸¤å¼ è¡¨ï¼Œä¸¤å¼ è¡¨ç»“æ„ç›¸åŒï¼Œåå­—ä¸åŒï¼›</p><p><code>tb_user_1</code>å’Œ<code>tb_user_2</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tb_user_2&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;          int(11)     NOT NULL AUTO_INCREMENT,</span><br><span class="line">    &#96;username&#96;    varchar(45) NOT NULL,</span><br><span class="line">    &#96;password&#96;    varchar(96) NOT NULL,</span><br><span class="line">    &#96;name&#96;        varchar(45) NOT NULL,</span><br><span class="line">    &#96;birthday&#96;    datetime    DEFAULT NULL,</span><br><span class="line">    &#96;sex&#96;         char(1)     DEFAULT NULL,</span><br><span class="line">    &#96;email&#96;       varchar(45) DEFAULT NULL,</span><br><span class="line">    &#96;phone&#96;       varchar(45) DEFAULT NULL,</span><br><span class="line">    &#96;qq&#96;          varchar(32) DEFAULT NULL,</span><br><span class="line">    &#96;status&#96;      varchar(32) NOT NULL COMMENT &#39;ç”¨æˆ·çŠ¶æ€&#39;,</span><br><span class="line">    &#96;create_time&#96; datetime    NOT NULL,</span><br><span class="line">    &#96;update_time&#96; datetime    DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">    UNIQUE KEY &#96;unique_user_username&#96; (&#96;username&#96;)</span><br><span class="line">) ENGINE &#x3D; InnoDB</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8;</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äº  <code>InnoDB </code> ç±»å‹çš„è¡¨ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š</p></blockquote><ul><li>ä¸»é”®é¡ºåºæ’å…¥</li><li>å…³é—­å”¯ä¸€æ€§æ ¡éªŒ</li><li>æ‰‹åŠ¨æäº¤äº‹åŠ¡</li></ul><h3 id="2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-ä¸»é”®é¡ºåºæ’å…¥"><a href="#2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-ä¸»é”®é¡ºåºæ’å…¥" class="headerlink" title="2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ– - ä¸»é”®é¡ºåºæ’å…¥"></a>2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ– - ä¸»é”®é¡ºåºæ’å…¥</h3><blockquote><p>å› ä¸ºInnoDBç±»å‹çš„è¡¨æ˜¯æŒ‰ç…§ä¸»é”®çš„é¡ºåºä¿å­˜çš„ï¼Œæ‰€ä»¥å°†å¯¼å…¥çš„æ•°æ®æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’åˆ—ï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚å¦‚æœInnoDBè¡¨æ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨é»˜è®¤åˆ›å»ºä¸€ä¸ªå†…éƒ¨åˆ—ä½œä¸ºä¸»é”®ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥ç»™è¡¨åˆ›å»ºä¸€ä¸ªä¸»é”®ï¼Œå°†å¯ä»¥åˆ©ç”¨è¿™ç‚¹ï¼Œæ¥æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ã€‚</p><p>è„šæœ¬æ–‡ä»¶ä»‹ç»ï¼ˆå¤§å°ç›¸åŒï¼‰ :</p></blockquote><ul><li><p>sql1.log    â€”-&gt; ä¸»é”®æœ‰åº</p></li><li><p>sql2.log    â€”-&gt; ä¸»é”®æ— åº</p></li></ul><blockquote><p>ä½¿ç”¨ <code>load data local infile æ–‡ä»¶å into è¡¨å</code> è¿›è¡Œæ•°æ®åŠ è½½ï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><ul><li>æ’å…¥IDé¡ºåºæ’åˆ—æ•°æ®ï¼š</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309223038.png" alt="image-20210309223038580"></p><ul><li>æ’å…¥IDæ— åºæ’åˆ—æ•°æ®ï¼š</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309223954.png" alt="image-20210309223954068"></p><h3 id="2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-å…³é—­å”¯ä¸€æ€§æ ¡éªŒ"><a href="#2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-å…³é—­å”¯ä¸€æ€§æ ¡éªŒ" class="headerlink" title="2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-å…³é—­å”¯ä¸€æ€§æ ¡éªŒ"></a>2ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-å…³é—­å”¯ä¸€æ€§æ ¡éªŒ</h3><blockquote><p>åœ¨å¯¼å…¥æ•°æ®å‰æ‰§è¡Œ <code>SET UNIQUE_CHECKS=0</code>ï¼Œå…³é—­å”¯ä¸€æ€§æ ¡éªŒï¼Œåœ¨å¯¼å…¥ç»“æŸåæ‰§è¡Œ<code>SET UNIQUE_CHECKS=1</code>ï¼Œæ¢å¤å”¯ä¸€æ€§æ ¡éªŒï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p></blockquote><h3 id="3ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-æ‰‹åŠ¨æäº¤äº‹åŠ¡"><a href="#3ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-æ‰‹åŠ¨æäº¤äº‹åŠ¡" class="headerlink" title="3ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-æ‰‹åŠ¨æäº¤äº‹åŠ¡"></a>3ã€InnoDBå¼•æ“è¡¨æ’å…¥ä¼˜åŒ–-æ‰‹åŠ¨æäº¤äº‹åŠ¡</h3><blockquote><p>å¦‚æœåº”ç”¨ä½¿ç”¨è‡ªåŠ¨æäº¤çš„æ–¹å¼ï¼Œå»ºè®®åœ¨å¯¼å…¥å‰æ‰§è¡Œ <code>SET AUTOCOMMIT=0</code>ï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼Œå¯¼å…¥ç»“æŸåå†æ‰§è¡Œ <code>SET AUTOCOMMIT=1</code>ï¼Œæ‰“å¼€è‡ªåŠ¨æäº¤ï¼Œä¹Ÿå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p></blockquote><h2 id="5-2ã€ä¼˜åŒ–insertè¯­å¥"><a href="#5-2ã€ä¼˜åŒ–insertè¯­å¥" class="headerlink" title="5.2ã€ä¼˜åŒ–insertè¯­å¥"></a>5.2ã€ä¼˜åŒ–insertè¯­å¥</h2><blockquote><p>å½“è¿›è¡Œæ•°æ®çš„insertæ“ä½œçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ä»¥ä¸‹å‡ ç§ä¼˜åŒ–æ–¹æ¡ˆã€‚</p></blockquote><h3 id="1ã€ä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„insertè¯­å¥"><a href="#1ã€ä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„insertè¯­å¥" class="headerlink" title="1ã€ä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„insertè¯­å¥"></a>1ã€ä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„insertè¯­å¥</h3><blockquote><p>å¦‚æœéœ€è¦åŒæ—¶å¯¹ä¸€å¼ è¡¨æ’å…¥å¾ˆå¤šè¡Œæ•°æ®æ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨å¤šä¸ªå€¼è¡¨çš„insertè¯­å¥ï¼Œè¿™ç§æ–¹å¼å°†å¤§å¤§çš„ç¼©å‡å®¢æˆ·ç«¯ä¸æ•°æ®åº“ä¹‹é—´çš„è¿æ¥ã€å…³é—­ç­‰æ¶ˆè€—ã€‚ä½¿å¾—æ•ˆç‡æ¯”åˆ†å¼€æ‰§è¡Œçš„å•ä¸ªinsertè¯­å¥å¿«ã€‚</p></blockquote><ul><li>åŸå§‹æ–¹æ¡ˆä¸ºï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert into tb_test values(1,&#39;Tom&#39;);</span><br><span class="line">insert into tb_test values(2,&#39;Cat&#39;);</span><br><span class="line">insert into tb_test values(3,&#39;Jerry&#39;);</span><br></pre></td></tr></table></figure><ul><li>ä¼˜åŒ–åçš„æ–¹æ¡ˆä¸ºï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into tb_test values(1,&#39;Tom&#39;),(2,&#39;Cat&#39;)ï¼Œ(3,&#39;Jerry&#39;);</span><br></pre></td></tr></table></figure><h3 id="2ã€åœ¨æ‰§è¡Œå¤§é‡çš„insertè¯­å¥å‰ä½¿ç”¨äº‹åŠ¡çš„æ‰‹åŠ¨æäº¤"><a href="#2ã€åœ¨æ‰§è¡Œå¤§é‡çš„insertè¯­å¥å‰ä½¿ç”¨äº‹åŠ¡çš„æ‰‹åŠ¨æäº¤" class="headerlink" title="2ã€åœ¨æ‰§è¡Œå¤§é‡çš„insertè¯­å¥å‰ä½¿ç”¨äº‹åŠ¡çš„æ‰‹åŠ¨æäº¤"></a>2ã€åœ¨æ‰§è¡Œå¤§é‡çš„insertè¯­å¥å‰ä½¿ç”¨äº‹åŠ¡çš„æ‰‹åŠ¨æäº¤</h3><blockquote><p>å¦‚æœæ•°æ®é‡å®åœ¨å¤ªå¤§ï¼Œå»ºè®®åˆ†æ®µæäº¤ã€‚</p><p>æ¯ä¸€ä¸‡æ¡æ•°æ® <code>insert</code> ä¸€æ¬¡ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start transaction;</span><br><span class="line">insert into tb_test values(1,&#39;Tom&#39;);</span><br><span class="line">insert into tb_test values(2,&#39;Cat&#39;);</span><br><span class="line">insert into tb_test values(3,&#39;Jerry&#39;);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure><h3 id="3ã€æ•°æ®æœ‰åºæ’å…¥"><a href="#3ã€æ•°æ®æœ‰åºæ’å…¥" class="headerlink" title="3ã€æ•°æ®æœ‰åºæ’å…¥"></a>3ã€æ•°æ®æœ‰åºæ’å…¥</h3><blockquote><p>æŒ‰ç…§ä¸»é”®é¡ºåºæ’å…¥</p></blockquote><ul><li>ä¼˜åŒ–å‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into tb_test values(4,&#39;Tim&#39;);</span><br><span class="line">insert into tb_test values(1,&#39;Tom&#39;);</span><br><span class="line">insert into tb_test values(3,&#39;Jerry&#39;);</span><br><span class="line">insert into tb_test values(5,&#39;Rose&#39;);</span><br><span class="line">insert into tb_test values(2,&#39;Cat&#39;);</span><br></pre></td></tr></table></figure><ul><li>ä¼˜åŒ–å</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insertintotb_testvalues(1,&#39;Tom&#39;);</span><br><span class="line">insertintotb_testvalues(2,&#39;Cat&#39;);</span><br><span class="line">insertintotb_testvalues(3,&#39;Jerry&#39;);</span><br><span class="line">insertintotb_testvalues(4,&#39;Tim&#39;);</span><br><span class="line">insertintotb_testvalues(5,&#39;Rose&#39;);</span><br></pre></td></tr></table></figure><h2 id="5-3ã€ä¼˜åŒ–order-byè¯­å¥"><a href="#5-3ã€ä¼˜åŒ–order-byè¯­å¥" class="headerlink" title="5.3ã€ä¼˜åŒ–order byè¯­å¥"></a>5.3ã€ä¼˜åŒ–order byè¯­å¥</h2><h3 id="1ã€å‡†å¤‡ç¯å¢ƒ-1"><a href="#1ã€å‡†å¤‡ç¯å¢ƒ-1" class="headerlink" title="1ã€å‡†å¤‡ç¯å¢ƒ"></a>1ã€å‡†å¤‡ç¯å¢ƒ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">use index_study;</span><br><span class="line">CREATE TABLE &#96;emp&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;     int(11)      NOT NULL AUTO_INCREMENT,</span><br><span class="line">    &#96;name&#96;   varchar(100) NOT NULL,</span><br><span class="line">    &#96;age&#96;    int(3)       NOT NULL,</span><br><span class="line">    &#96;salary&#96; int(11) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">) ENGINE &#x3D; InnoDB</span><br><span class="line">  DEFAULT CHARSET &#x3D; utf8mb4;</span><br><span class="line">  </span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;1&#39;, &#39;Tom&#39;, &#39;25&#39;, &#39;2300&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;2&#39;, &#39;Jerry&#39;, &#39;30&#39;, &#39;3500&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;3&#39;, &#39;Luci&#39;, &#39;25&#39;, &#39;2800&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;4&#39;, &#39;Jay&#39;, &#39;36&#39;, &#39;3500&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;5&#39;, &#39;Tom2&#39;, &#39;21&#39;, &#39;2200&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;6&#39;, &#39;Jerry2&#39;, &#39;31&#39;, &#39;3300&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;7&#39;, &#39;Luci2&#39;, &#39;26&#39;, &#39;2700&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;8&#39;, &#39;Jay2&#39;, &#39;33&#39;, &#39;3500&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;9&#39;, &#39;Tom3&#39;, &#39;23&#39;, &#39;2400&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;10&#39;, &#39;Jerry3&#39;, &#39;32&#39;, &#39;3100&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;11&#39;, &#39;Luci3&#39;, &#39;26&#39;, &#39;2900&#39;);</span><br><span class="line">insert into &#96;emp&#96; (&#96;id&#96;, &#96;name&#96;, &#96;age&#96;, &#96;salary&#96;)</span><br><span class="line">values (&#39;12&#39;, &#39;Jay3&#39;, &#39;37&#39;, &#39;4500&#39;);</span><br><span class="line"></span><br><span class="line">create index idx_emp_age_salary on emp (age, salary);</span><br></pre></td></tr></table></figure><h3 id="2ã€MySQLæ”¯æŒçš„ä¸¤ç§æ’åºæ–¹å¼"><a href="#2ã€MySQLæ”¯æŒçš„ä¸¤ç§æ’åºæ–¹å¼" class="headerlink" title="2ã€MySQLæ”¯æŒçš„ä¸¤ç§æ’åºæ–¹å¼"></a>2ã€MySQLæ”¯æŒçš„ä¸¤ç§æ’åºæ–¹å¼</h3><ul><li>ç¬¬ä¸€ç§æ˜¯é€šè¿‡å¯¹è¿”å›æ•°æ®è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯é€šå¸¸è¯´çš„ <code>ï¬lesort</code> æ’åºï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å«  <code>FileSort</code> æ’åºã€‚</li><li>ç¬¬äºŒç§é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º  <code>using  index</code>ï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚</li></ul><h3 id="3ã€æŸ¥è¯¢æ‰€æœ‰å­—æ®µè¿›è¡Œçš„æ’åº"><a href="#3ã€æŸ¥è¯¢æ‰€æœ‰å­—æ®µè¿›è¡Œçš„æ’åº" class="headerlink" title="3ã€æŸ¥è¯¢æ‰€æœ‰å­—æ®µè¿›è¡Œçš„æ’åº"></a>3ã€æŸ¥è¯¢æ‰€æœ‰å­—æ®µè¿›è¡Œçš„æ’åº</h3><ul><li>æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼Œæ ¹æ® <code>age</code> è¿›è¡Œå‡åº/é™åºæ’åºã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from emp order by age;</span><br><span class="line">explain select * from emp order by age desc;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309225619.png" alt="image-20210309225619147"></p><blockquote><p>å’Œæ ¹æ® <code>salary</code> è¿›è¡Œæ’åºä¸€æ ·ï¼Œè¿™é‡Œè¿›è¡Œçš„éƒ½æ˜¯æ–‡ä»¶æ’åº <code>filesort</code></p></blockquote><ul><li>æŸ¥è¯¢æ‰€æœ‰å­—æ®µï¼Œæ ¹æ® <code>age</code> å’Œ <code>salary</code> è¿›è¡Œæ’åº</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain select * from emp order by age,salary;</span><br><span class="line">explain select * from emp order by age,salary desc;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309225748.png" alt="image-20210309225748259"></p><blockquote><p>æ­¤æ—¶ä»ç„¶ä¸º <code>filesort</code></p></blockquote><h3 id="4ã€æŸ¥è¯¢ç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº"><a href="#4ã€æŸ¥è¯¢ç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº" class="headerlink" title="4ã€æŸ¥è¯¢ç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº"></a>4ã€æŸ¥è¯¢ç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210309230041.png" alt="image-20210309230041747"></p><blockquote><p>å¦‚æœä½¿ç”¨ <strong>è¦†ç›–ç´¢å¼•</strong> ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨ç´¢å¼•æ’åºã€‚</p></blockquote><h3 id="5ã€æŸ¥è¯¢å­—æ®µä¸­æœ‰éç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº"><a href="#5ã€æŸ¥è¯¢å­—æ®µä¸­æœ‰éç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº" class="headerlink" title="5ã€æŸ¥è¯¢å­—æ®µä¸­æœ‰éç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº"></a>5ã€æŸ¥è¯¢å­—æ®µä¸­æœ‰éç´¢å¼•å­—æ®µè¿›è¡Œçš„æ’åº</h3><blockquote><p>å¦‚æœæŸ¥è¯¢çš„å­—æ®µä¸­æœ‰éç´¢å¼•å­—æ®µï¼Œä¾‹å¦‚ <code>name</code> ï¼Œé‚£ä¹ˆå°†ä¼šä½¿ç”¨ <code>filesort</code></p></blockquote><h3 id="6ã€ä¼˜åŒ–ç›®æ ‡"><a href="#6ã€ä¼˜åŒ–ç›®æ ‡" class="headerlink" title="6ã€ä¼˜åŒ–ç›®æ ‡"></a>6ã€ä¼˜åŒ–ç›®æ ‡</h3><blockquote><p>äº†è§£äº†MySQLçš„æ’åºæ–¹å¼ï¼Œä¼˜åŒ–ç›®æ ‡å°±æ¸…æ™°äº†ï¼š</p></blockquote><ul><li>å°½é‡å‡å°‘é¢å¤–çš„æ’åºï¼Œé€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æœ‰åºæ•°æ®ã€‚</li><li>where æ¡ä»¶å’ŒOrder by ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•ï¼Œå¹¶ä¸”<strong>Order By çš„é¡ºåºå’Œç´¢å¼•é¡ºåºç›¸åŒ</strong>ï¼Œ å¹¶ä¸”Order by çš„å­—æ®µ<strong>éƒ½æ˜¯å‡åºï¼Œæˆ–è€…éƒ½æ˜¯é™åº</strong>ã€‚å¦åˆ™è‚¯å®šéœ€è¦é¢å¤–çš„æ“ä½œï¼Œè¿™æ ·å°±ä¼šå‡ºç° <code>FileSort</code>ã€‚</li></ul><h3 id="7ã€ä¸¾ä¾‹"><a href="#7ã€ä¸¾ä¾‹" class="headerlink" title="7ã€ä¸¾ä¾‹"></a>7ã€ä¸¾ä¾‹</h3><blockquote><p>å‡è®¾ç°æœ‰ä¸€å¤åˆç´¢å¼• <code>idx_a_b_c</code>(a,b,c)ï¼Œåˆ™ä»¥ä¸‹æƒ…å†µå¯ä»¥é¿å…<code>filesort</code></p></blockquote><ul><li><p>order by èƒ½ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰ç¼€</p><ul><li>order by a;</li><li>order by a,b;</li><li>order by a,b,c;</li><li>order by a desc,b desc,c desc;</li></ul></li><li><p>å¦‚æœwhereä½¿ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€å®šä¹‰ä¸ºå¸¸é‡ï¼Œåˆ™order byå¯ä»¥ä½¿ç”¨ç´¢å¼•</p><ul><li>where a = const order by b,c;</li><li>where a = const and b = const order by c;</li><li>where a = const and b &gt; const order by c;</li></ul></li><li><p>ä¸èƒ½ä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åºçš„æƒ…å†µ</p><ul><li>order by a asc,b desc,c desc</li></ul><blockquote><p>ä¸Šè¿°è¯­å¥æ’åºä¸ä¸€è‡´ï¼Œå¿…é¡»è¦ä¹ˆå…¨ä¸ºdescï¼Œè¦ä¹ˆå…¨ä¸ºasc</p></blockquote><ul><li>where g = const order by b,c</li></ul><blockquote><p>ä¸Šè¿°è¯­å¥ä¸¢å¤±aç´¢å¼•</p></blockquote><ul><li>where a = const order by c</li></ul><blockquote><p>ä¸Šè¿°è¯­å¥ä¸¢å¤±bç´¢å¼•</p></blockquote><ul><li>where a = const order by a,d</li></ul><blockquote><p>ä¸Šè¿°è¯­å¥ä¸­ï¼Œdä¸æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†</p></blockquote></li></ul><h3 id="8ã€FileSortçš„ä¼˜åŒ–"><a href="#8ã€FileSortçš„ä¼˜åŒ–" class="headerlink" title="8ã€FileSortçš„ä¼˜åŒ–"></a>8ã€<code>FileSort</code>çš„ä¼˜åŒ–</h3><blockquote><p>é€šè¿‡åˆ›å»ºåˆé€‚çš„ç´¢å¼•ï¼Œèƒ½å¤Ÿå‡å°‘ <code>Filesort</code> çš„å‡ºç°ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¡ä»¶é™åˆ¶ä¸èƒ½è®©<code>Filesort</code>æ¶ˆå¤±ï¼Œé‚£å°±éœ€è¦åŠ å¿« <code>Filesort</code> çš„æ’åºæ“ä½œã€‚å¯¹äº <code>Filesort</code> ï¼Œ MySQL  æœ‰ä¸¤ç§æ’åºç®—æ³•ï¼š</p></blockquote><ul><li><p>ä¸¤æ¬¡æ‰«æç®—æ³• ï¼š<strong>MySQL4.1 ä¹‹å‰</strong>ï¼Œä½¿ç”¨è¯¥æ–¹å¼æ’åºã€‚é¦–å…ˆæ ¹æ®æ¡ä»¶å–å‡ºæ’åºå­—æ®µå’Œè¡ŒæŒ‡é’ˆä¿¡æ¯ï¼Œç„¶ååœ¨æ’åºåŒº sort buï¬€er ä¸­æ’åºï¼Œå¦‚æœsort buï¬€erä¸å¤Ÿï¼Œåˆ™åœ¨ä¸´æ—¶è¡¨ temporary table ä¸­å­˜å‚¨æ’åºç»“æœã€‚å®Œæˆæ’åºä¹‹åï¼Œå†æ ¹æ®è¡ŒæŒ‡é’ˆå›è¡¨è¯»å–è®°å½•ï¼Œè¯¥æ“ä½œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡éšæœºI/Oæ“ä½œã€‚</p></li><li><p>ä¸€æ¬¡æ‰«æç®—æ³•ï¼šä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰å­—æ®µï¼Œç„¶ååœ¨æ’åºåŒº sort buï¬€er ä¸­æ’åºåç›´æ¥è¾“å‡ºç»“æœé›†ã€‚æ’åºæ—¶å†…å­˜å¼€é”€è¾ƒå¤§ï¼Œä½†æ˜¯æ’åºæ•ˆç‡æ¯”ä¸¤æ¬¡æ‰«æç®—æ³•è¦é«˜ã€‚</p></li></ul><blockquote><p>MySQL é€šè¿‡æ¯”è¾ƒç³»ç»Ÿå˜é‡ max_length_for_sort_data çš„å¤§å°å’ŒQueryè¯­å¥å–å‡ºçš„å­—æ®µæ€»å¤§å°ï¼Œ æ¥åˆ¤å®šæ˜¯å¦é‚£ç§æ’åºç®—æ³•ï¼Œå¦‚æœmax_length_for_sort_data æ›´å¤§ï¼Œé‚£ä¹ˆä½¿ç”¨ç¬¬äºŒç§ä¼˜åŒ–ä¹‹åçš„ç®—æ³•ï¼›å¦åˆ™ä½¿ç”¨ç¬¬ä¸€ç§ã€‚</p><p>å¯ä»¥é€‚å½“æé«˜ sort_buï¬€er_size å’Œ max_length_for_sort_data ç³»ç»Ÿå˜é‡ï¼Œæ¥å¢å¤§æ’åºåŒºçš„å¤§å°ï¼Œæé«˜æ’åºçš„æ•ˆç‡ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310082831.png" alt="image-20210310082831825"></p><h2 id="5-4ã€ä¼˜åŒ–group-by-è¯­å¥"><a href="#5-4ã€ä¼˜åŒ–group-by-è¯­å¥" class="headerlink" title="5.4ã€ä¼˜åŒ–group by è¯­å¥"></a>5.4ã€ä¼˜åŒ–group by è¯­å¥</h2><blockquote><p>ç”±äºGROUP BY å®é™…ä¸Šä¹ŸåŒæ ·ä¼šè¿›è¡Œæ’åºæ“ä½œï¼Œè€Œä¸”ä¸ORDER BY ç›¸æ¯”ï¼ŒGROUP BY ä¸»è¦åªæ˜¯<strong>å¤šäº†æ’åºä¹‹åçš„åˆ†ç»„æ“ä½œ</strong>ã€‚å½“ç„¶ï¼Œå¦‚æœåœ¨åˆ†ç»„çš„æ—¶å€™è¿˜ä½¿ç”¨äº†å…¶ä»–çš„ä¸€äº›èšåˆå‡½æ•°ï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¸€äº›èšåˆå‡½æ•°çš„è®¡ç®—ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨ GROUP BY çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸ ORDER BY ä¸€æ ·ä¹Ÿå¯ä»¥åˆ©ç”¨åˆ°ç´¢å¼•ã€‚</p><p>å¦‚æœæŸ¥è¯¢åŒ…å« group by ä½†æ˜¯ç”¨æˆ·æƒ³è¦é¿å…æ’åºç»“æœçš„æ¶ˆè€—ï¼Œ åˆ™å¯ä»¥æ‰§è¡Œ<strong>order by null</strong>ç¦æ­¢æ’åºã€‚å¦‚ä¸‹ ï¼š</p></blockquote><h3 id="1ã€åˆ é™¤å¤åˆç´¢å¼•ï¼ŒæŸ¥çœ‹group-byæ˜¯å¦åŒ…å«æ’åº"><a href="#1ã€åˆ é™¤å¤åˆç´¢å¼•ï¼ŒæŸ¥çœ‹group-byæ˜¯å¦åŒ…å«æ’åº" class="headerlink" title="1ã€åˆ é™¤å¤åˆç´¢å¼•ï¼ŒæŸ¥çœ‹group byæ˜¯å¦åŒ…å«æ’åº"></a>1ã€åˆ é™¤å¤åˆç´¢å¼•ï¼ŒæŸ¥çœ‹group byæ˜¯å¦åŒ…å«æ’åº</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310083802.png" alt="image-20210310083801891"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select age,count(*) from emp group by age;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310084218.png" alt="image-20210310084218530"></p><h3 id="2ã€ä½¿ç”¨order-by-nullä¼˜åŒ–group-byé¿å…æ’åº"><a href="#2ã€ä½¿ç”¨order-by-nullä¼˜åŒ–group-byé¿å…æ’åº" class="headerlink" title="2ã€ä½¿ç”¨order by nullä¼˜åŒ–group byé¿å…æ’åº"></a>2ã€ä½¿ç”¨order by nullä¼˜åŒ–group byé¿å…æ’åº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select age,count(*) from emp group by age order by null;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310084328.png" alt="image-20210310084328837"></p><blockquote><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€ä¸ªSQLè¯­å¥éœ€è¦è¿›è¡Œâ€ï¬lesortâ€ï¼Œè€Œç¬¬äºŒä¸ªSQLç”±äºorder  by  null ä¸éœ€è¦è¿›è¡Œ</p><p>â€œï¬lesortâ€ï¼Œ  è€Œä¸Šæ–‡æè¿‡Filesortå¾€å¾€éå¸¸è€—è´¹æ—¶é—´ã€‚</p></blockquote><h3 id="3ã€ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–Group-by"><a href="#3ã€ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–Group-by" class="headerlink" title="3ã€ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–Group by"></a>3ã€ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–Group by</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create index idx_emp_age_salary on emp(age,salary);</span><br><span class="line">explain select age,count(*) from emp group by age order by null;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310084808.png" alt="image-20210310084808529"></p><h2 id="5-5ã€ä¼˜åŒ–åµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼‰"><a href="#5-5ã€ä¼˜åŒ–åµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼‰" class="headerlink" title="5.5ã€ä¼˜åŒ–åµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼‰"></a>5.5ã€ä¼˜åŒ–åµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼‰</h2><blockquote><p>Mysql4.1ç‰ˆæœ¬ä¹‹åï¼Œå¼€å§‹æ”¯æŒSQLçš„å­æŸ¥è¯¢ã€‚è¿™ä¸ªæŠ€æœ¯å¯ä»¥ä½¿ç”¨SELECTè¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„SQLæ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»ï¼Œå¹¶ä¸”å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢æ˜¯å¯ä»¥è¢«æ›´é«˜æ•ˆçš„è¿æ¥ï¼ˆJOINï¼‰æ›¿ä»£ã€‚</p><p>ç¤ºä¾‹  ï¼ŒæŸ¥æ‰¾æœ‰è§’è‰²çš„æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ :</p></blockquote><h3 id="1ã€ä¼˜åŒ–å‰"><a href="#1ã€ä¼˜åŒ–å‰" class="headerlink" title="1ã€ä¼˜åŒ–å‰"></a>1ã€ä¼˜åŒ–å‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user where id in (select user_id from user_role );</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310085102.png" alt="image-20210310085102274"></p><h3 id="2ã€ä¼˜åŒ–å"><a href="#2ã€ä¼˜åŒ–å" class="headerlink" title="2ã€ä¼˜åŒ–å"></a>2ã€ä¼˜åŒ–å</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from t_user u , user_role ur where u.id &#x3D; ur.user_id;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310085420.png" alt="image-20210310085420290"></p><blockquote><p>è¿æ¥( Join)æŸ¥è¯¢ä¹‹æ‰€ä»¥æ›´æœ‰æ•ˆç‡ä¸€äº› ï¼Œæ˜¯å› ä¸ºMySQLä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨æ¥å®Œæˆè¿™ä¸ªé€»è¾‘ä¸Šéœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œã€‚</p></blockquote><h2 id="5-6ã€ä¼˜åŒ–ORæ¡ä»¶"><a href="#5-6ã€ä¼˜åŒ–ORæ¡ä»¶" class="headerlink" title="5.6ã€ä¼˜åŒ–ORæ¡ä»¶"></a>5.6ã€ä¼˜åŒ–ORæ¡ä»¶</h2><blockquote><p>åŒ…å«ORçš„æŸ¥è¯¢å­å¥ï¼Œå¦‚æœè¦åˆ©ç”¨ç´¢å¼•ï¼Œåˆ™ORä¹‹é—´çš„æ¯ä¸ªæ¡ä»¶åˆ—éƒ½å¿…é¡»ç”¨åˆ°ç´¢å¼• ï¼Œ è€Œä¸”<strong>ä¸èƒ½ä½¿ç”¨åˆ°å¤åˆç´¢å¼•</strong>ï¼›  å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œåˆ™åº”è¯¥è€ƒè™‘å¢åŠ ç´¢å¼•ã€‚</p></blockquote><h3 id="1ã€è·å–-emp-è¡¨ä¸­çš„æ‰€æœ‰çš„ç´¢å¼•"><a href="#1ã€è·å–-emp-è¡¨ä¸­çš„æ‰€æœ‰çš„ç´¢å¼•" class="headerlink" title="1ã€è·å– emp è¡¨ä¸­çš„æ‰€æœ‰çš„ç´¢å¼•"></a>1ã€è·å– emp è¡¨ä¸­çš„æ‰€æœ‰çš„ç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from emp;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310085646.png" alt="image-20210310085646370"></p><h3 id="2ã€ä½¿ç”¨unionæ›¿æ¢or"><a href="#2ã€ä½¿ç”¨unionæ›¿æ¢or" class="headerlink" title="2ã€ä½¿ç”¨unionæ›¿æ¢or"></a>2ã€ä½¿ç”¨unionæ›¿æ¢or</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from emp where id &#x3D; &#39;1&#39; or id &#x3D; &#39;10&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310085956.png" alt="image-20210310085956123"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from emp where id &#x3D; &#39;1&#39; union select * from emp where id &#x3D; &#39;10&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310090132.png" alt="image-20210310090132249"></p><ul><li>æˆ‘ä»¬æ¥æ¯”è¾ƒä¸‹é‡è¦æŒ‡æ ‡ï¼Œå‘ç°ä¸»è¦å·®åˆ«æ˜¯ type å’Œ ref è¿™ä¸¤é¡¹</li></ul><blockquote><p>type   æ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œç»“æœå€¼ä»å¥½åˆ°åä¾æ¬¡æ˜¯ï¼š</p><p>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null    &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL</p></blockquote><ul><li><p>UNION è¯­å¥çš„ type å€¼ä¸º refï¼ŒOR è¯­å¥çš„ type å€¼ä¸º rangeï¼Œå¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„å·®è·</p></li><li><p>UNION è¯­å¥çš„ ref å€¼ä¸º constï¼ŒOR è¯­å¥çš„ type å€¼ä¸º nullï¼Œconst è¡¨ç¤ºæ˜¯å¸¸é‡å€¼å¼•ç”¨ï¼Œéå¸¸å¿«è¿™ä¸¤é¡¹çš„å·®è·å°±è¯´æ˜äº†  UNION  è¦ä¼˜äº  OR ã€‚</p></li></ul><h2 id="5-7ã€ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢"><a href="#5-7ã€ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="5.7ã€ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢"></a>5.7ã€ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢</h2><blockquote><p>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½ã€‚ä¸€ä¸ªå¸¸è§åˆéå¸¸å¤´ç–¼çš„é—®é¢˜å°±æ˜¯ limit 2000000,10 ï¼Œæ­¤æ—¶éœ€è¦MySQLæ’åºå‰2000010 è®°å½•ï¼Œä»…ä»…è¿”å›2000000 - 2000010 çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§  ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310092303.png" alt="image-20210310092303106"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310092325.png" alt="image-20210310092325129"></p><h3 id="1ã€ä¼˜åŒ–æ€è·¯ä¸€"><a href="#1ã€ä¼˜åŒ–æ€è·¯ä¸€" class="headerlink" title="1ã€ä¼˜åŒ–æ€è·¯ä¸€"></a>1ã€ä¼˜åŒ–æ€è·¯ä¸€</h3><blockquote><p><strong>åœ¨ç´¢å¼•ä¸Šå®Œæˆæ’åºåˆ†é¡µæ“ä½œ</strong>ï¼Œæœ€åæ ¹æ®ä¸»é”®å…³è”å›åŸè¡¨æŸ¥è¯¢å…¶ä»–æ‰€éœ€è¦çš„åˆ—çš„å†…å®¹</p></blockquote><ul><li>å¸¸è§„å†™æ³•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_item limit 200000,10;</span><br></pre></td></tr></table></figure><ul><li>ä¼˜åŒ–åå†™æ³•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select t.* from tb_item as t join (select id from tb_seller order by id limit 200000,10) as a on a.id &#x3D; t.id;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ä¼˜åŒ–åå†™æ³•çš„æ‰§è¡Œè®¡åˆ’</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310092839.png" alt="image-20210310092839341"></p><h3 id="2ã€ä¼˜åŒ–æ€è·¯äºŒ"><a href="#2ã€ä¼˜åŒ–æ€è·¯äºŒ" class="headerlink" title="2ã€ä¼˜åŒ–æ€è·¯äºŒ"></a>2ã€ä¼˜åŒ–æ€è·¯äºŒ</h3><blockquote><p>è¯¥æ–¹æ¡ˆé€‚ç”¨äº<strong>ä¸»é”®è‡ªå¢</strong>çš„è¡¨ï¼Œå¯ä»¥æŠŠLimit  æŸ¥è¯¢è½¬æ¢æˆæŸä¸ªä½ç½®çš„æŸ¥è¯¢ ã€‚ï¼ˆè‡ªå¢çš„ä¸»é”®è¿˜ä¸èƒ½å‡ºç°æ–­å±‚ã€‚ï¼‰</p></blockquote><ul><li>ä¼˜åŒ–åå†™æ³•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_item where id &gt; 200000 limit 10;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºä½¿ç”¨äº†ç´¢å¼•ï¼Œæ‰€ä»¥éå¸¸å¿«</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310184441.png" alt="image-20210310184417566"></p><h2 id="5-8ã€ä½¿ç”¨SQLæç¤º"><a href="#5-8ã€ä½¿ç”¨SQLæç¤º" class="headerlink" title="5.8ã€ä½¿ç”¨SQLæç¤º"></a>5.8ã€ä½¿ç”¨SQLæç¤º</h2><blockquote><p>SQLæç¤ºï¼Œæ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„ã€‚</p></blockquote><h3 id="1ã€USE-INDEX"><a href="#1ã€USE-INDEX" class="headerlink" title="1ã€USE INDEX"></a>1ã€USE INDEX</h3><blockquote><p>åœ¨æŸ¥è¯¢è¯­å¥ä¸­è¡¨åçš„åé¢ï¼Œæ·»åŠ  use index æ¥æä¾›å¸Œæœ›MySQLå»å‚è€ƒçš„ç´¢å¼•åˆ—è¡¨ï¼Œå°±å¯ä»¥è®©MySQLä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•ã€‚</p></blockquote><ul><li>æŸ¥çœ‹è¡¨ä¸­çš„ç´¢å¼•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310185045.png" alt="image-20210310185045284"></p><blockquote><p>å‡è®¾ç°åœ¨æœ‰å¦‚ä¸‹SQL</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>é‚£ä¹ˆå¯èƒ½ä¼šä½¿ç”¨ä¸¤ä¸ªç´¢å¼•ï¼Œå³ <code>idx_seller_name</code> å’Œ <code>idx_seller_name_sta_adds</code> </p></blockquote><ul><li>æŸ¥çœ‹ä¸Šè¿°SQLçš„æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°å…¶ä½¿ç”¨äº† <code>idx_seller_name</code>ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310185703.png" alt="image-20210310185702745"></p><ul><li>ä½¿ç”¨ use index äººä¸ºå¹²é¢„</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller use index(idx_seller_name_sta_adds) where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310185814.png" alt="image-20210310185814793"></p><h3 id="2ã€IGNORE-INDEX"><a href="#2ã€IGNORE-INDEX" class="headerlink" title="2ã€IGNORE INDEX"></a>2ã€IGNORE INDEX</h3><blockquote><p>å¦‚æœç”¨æˆ·åªæ˜¯å•çº¯çš„æƒ³è®©MySQLå¿½ç•¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ ignore  index  ä½œä¸º æç¤º</p></blockquote><ul><li>ä»ä¸Šé¢å¯çŸ¥ï¼Œå¦‚æœä¸åŠ ä»¥å¹²é¢„ï¼ŒMysqlä½¿ç”¨çš„æ˜¯ <code>idx_seller_name</code> ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>IGNORE INDEX</code> è®©MySQLå¿½ç•¥ <code>idx_seller_name</code> ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller ignore index(idx_seller_name) where name &#x3D; &#39;å°ç±³ç§‘æŠ€&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310190055.png" alt="image-20210310190055316"></p><h3 id="3ã€FORCE-INDEX"><a href="#3ã€FORCE-INDEX" class="headerlink" title="3ã€FORCE INDEX"></a>3ã€FORCE INDEX</h3><blockquote><p>ä¸ºå¼ºåˆ¶MySQLä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ï¼Œå¯åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨  force  index  ä½œä¸ºæç¤º ã€‚</p></blockquote><ul><li>ä¸º <code>address</code> å±æ€§æ·»åŠ ä¸€ä¸ªå•åˆ—ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index idx_address on tb_seller(address);</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310191208.png" alt="image-20210310191208771"></p><ul><li>åœ¨ <code>tb_seller</code> è¡¨ä¸­æ‰§è¡Œä»¥ä¸‹è¯­å¥ï¼ŒMySQLä¸ä¼šä½¿ç”¨ç´¢å¼•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310190830.png" alt="image-20210310190830900"></p><blockquote><p>è¿™æ˜¯å› ä¸ºè¡¨ä¸­ <code>address</code> å±æ€§ä¸ºåŒ—äº¬å¸‚çš„æ•°æ®å ç»å¤§å¤šæ•°ï¼Œä½¿ç”¨ç´¢å¼•ä¸å¦‚å…¨è¡¨æ‰«æ</p></blockquote><ul><li>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>force index</code> å¼ºåˆ¶MySQLä½¿ç”¨ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain select * from tb_seller force index(idx_address)  where address &#x3D; &#39;åŒ—äº¬å¸‚&#39;;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210310191304.png" alt="image-20210310191304530"></p><h3 id="4ã€force-å’Œ-useçš„åŒºåˆ«"><a href="#4ã€force-å’Œ-useçš„åŒºåˆ«" class="headerlink" title="4ã€force å’Œ useçš„åŒºåˆ«"></a>4ã€force å’Œ useçš„åŒºåˆ«</h3><blockquote><p>use index æ›´å¤šçš„æ˜¯å»ºè®®ï¼Œè€Œforce indexæ˜¯å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ã€‚</p><p>å¦‚æœMySQLè§‰å¾—ä½ ä½¿ç”¨ <code>use index</code> å»ºè®®çš„ç´¢å¼•æ•ˆç‡æ¯”å…¨è¡¨æ‰«ææ…¢ï¼Œé‚£ä¹ˆä»ç„¶ä¸ä¼šèµ°ç´¢å¼•ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨ <code>force index</code> å¼ºåˆ¶MySQLä½¿ç”¨ä½ ç»™çš„ç´¢å¼•ï¼Œé‚£ä¹ˆå³ä½¿ä½ ç»™çš„ç´¢å¼•æ‰§è¡Œæ•ˆç‡ä½ï¼Œé‚£ä¹ˆMySQLä¹Ÿä¼šä½¿ç”¨ä½ ç»™çš„ç´¢å¼•ã€‚</p></blockquote><h2 id="5-9ã€åˆ†è§£å…³è”æŸ¥è¯¢"><a href="#5-9ã€åˆ†è§£å…³è”æŸ¥è¯¢" class="headerlink" title="5.9ã€åˆ†è§£å…³è”æŸ¥è¯¢"></a>5.9ã€åˆ†è§£å…³è”æŸ¥è¯¢</h2><blockquote><p>è®¸å¤šé«˜æ€§èƒ½çš„åº”ç”¨éƒ½ä¼šå¯¹å…³è”æŸ¥è¯¢è¿›è¡Œåˆ†è§£ã€‚</p><p>å³å¯ä»¥å¯¹æ¯ä¸€ä¸ªè¡¨è¿›è¡Œä¸€æ¬¡ <strong>å•è¡¨æŸ¥è¯¢</strong> ï¼Œç„¶åå°†ç»“æœåœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œå…³è”ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸‹é¢è¿™ä¸ªæŸ¥è¯¢ä¸­</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">  *</span><br><span class="line">from</span><br><span class="line">  tag as t</span><br><span class="line">  join tag_post as tp on tp.tag_id &#x3D; t.id</span><br><span class="line">  join post as p on p.id &#x3D; tp.post_id</span><br><span class="line">where</span><br><span class="line">  t.tag &#x3D; &#39;mysql&#39;;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥åˆ†è§£ä¸ºä¸‹åˆ—è¿™äº›æŸ¥è¯¢æ¥ä»£æ›¿</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from tag where tag &#x3D; &#39;mysql&#39;;</span><br><span class="line">select * from tag_post where tag_id &#x3D; 1234;</span><br><span class="line">select * from post where post.id in (123,456,678,9097);</span><br></pre></td></tr></table></figure><blockquote><p>è¿™æ ·åšåœ°åŸå› ï¼Ÿ</p></blockquote><ul><li>è®©ç¼“å­˜çš„æ•ˆç‡æ›´é«˜ã€‚</li></ul><blockquote><p>è®¸å¤šåº”ç”¨ç¨‹åºå¯ä»¥æ–¹ä¾¿åœ°ç¼“å­˜å•è¡¨æŸ¥è¯¢å¯¹åº”çš„ç»“æœå¯¹è±¡ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸Šé¢æŸ¥è¯¢ä¸­çš„ <code>tag</code> å·²ç»è¢«ç¼“å­˜äº†ï¼Œé‚£ä¹ˆåº”ç”¨å°±å¯ä»¥è·³è¿‡ç¬¬ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>å†ä¾‹å¦‚ï¼Œåº”ç”¨ä¸­å·²ç»ç¼“å­˜äº† <code>post.id</code> ä¸º 123ã€456 çš„å†…å®¹ï¼Œé‚£ä¹ˆç¬¬ä¸‰ä¸ªæŸ¥è¯¢çš„ <code>in</code> å°±å¯ä»¥å°‘å‡ ä¸ª <code>ID</code>.</p><p>å¦å¤–ï¼Œå¯¹äºMySQLçš„æŸ¥è¯¢ç¼“å­˜æ¥è¯´ï¼Œå¦‚æœå…³è”çš„ä¸­çš„æ¯ä¸ªè¡¨å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå°±æ— æ³•æ˜¯å“ŸæŸ¥è¯¢ç¼“å­˜äº†ï¼Œè€Œæ‹†åˆ†åï¼Œå¦‚æœæŸä¸ªè¡¨å¾ˆå°‘æ”¹å˜ï¼Œé‚£ä¹ˆåŸºäºæ­¤è¡¨çš„æŸ¥è¯¢å°±å¯ä»¥é‡å¤åˆ©ç”¨æŸ¥è¯¢ç¼“å­˜ã€‚</p></blockquote><ul><li>å°†æŸ¥è¯¢åˆ†è§£åï¼Œæ‰§è¡Œå•ä¸ªæŸ¥è¯¢å¯ä»¥å‡å°‘é”çš„ç«äº‰ã€‚</li><li>åœ¨åº”ç”¨å±‚åšå…³è”ï¼Œå¯ä»¥æ›´å®¹æ˜“å¯¹æ•°æ®åº“è¿›è¡Œæ‹†åˆ†ï¼Œæ›´å®¹æ˜“åšåˆ°é«˜æ€§èƒ½å’Œå¯æ‹“å±•ã€‚</li><li>æŸ¥è¯¢æœ¬èº«æ•ˆç‡å¯èƒ½æœ‰æ‰€æå‡</li></ul><blockquote><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>in</code> ä»£æ›¿ å…³è”æŸ¥è¯¢ï¼Œå¯ä»¥è®©MySQLæŒ‰ç…§ <code>ID</code> é¡ºåºè¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™æ¯”éšæœºçš„å…³è”è¦æ›´é«˜æ•ˆã€‚</p></blockquote><ul><li>å¯ä»¥å‡å°‘å†—ä½™è®°å½•çš„æŸ¥è¯¢ã€‚</li></ul><blockquote><p>åœ¨åº”ç”¨å±‚åšå…³è”æŸ¥è¯¢,æ„å‘³ç€å¯¹äºæŸæ¡è®°å½•åº”ç”¨åªéœ€è¦æŸ¥è¯¢ä¸€æ¬¡,è€Œåœ¨æ•°æ®åº“ä¸­åšå…³è”æŸ¥è¯¢,åˆ™å¯èƒ½éœ€è¦é‡å¤åœ°è®¿é—®ä¸€éƒ¨åˆ†æ•°æ®ã€‚ä»è¿™ç‚¹çœ‹,è¿™æ ·çš„é‡æ„è¿˜å¯èƒ½ä¼šå‡å°‘ç½‘ç»œå’Œå†…å­˜çš„æ¶ˆè€—ã€‚</p></blockquote><h1 id="å…­ã€è¡¥å……-å°šç¡…è°·ç´¢å¼•ä¼˜åŒ–"><a href="#å…­ã€è¡¥å……-å°šç¡…è°·ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="å…­ã€è¡¥å……-å°šç¡…è°·ç´¢å¼•ä¼˜åŒ–"></a>å…­ã€è¡¥å……-å°šç¡…è°·ç´¢å¼•ä¼˜åŒ–</h1><h2 id="6-1ã€ç´¢å¼•å•è¡¨æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹"><a href="#6-1ã€ç´¢å¼•å•è¡¨æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹" class="headerlink" title="6.1ã€ç´¢å¼•å•è¡¨æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹"></a>6.1ã€ç´¢å¼•å•è¡¨æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹</h2><h3 id="1ã€ç¯å¢ƒæ­å»º"><a href="#1ã€ç¯å¢ƒæ­å»º" class="headerlink" title="1ã€ç¯å¢ƒæ­å»º"></a>1ã€ç¯å¢ƒæ­å»º</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;article&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;          INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    &#96;author_id&#96;   INT(10) UNSIGNED NOT NULL,</span><br><span class="line">    &#96;category_id&#96; INT(10) UNSIGNED NOT NULL,</span><br><span class="line">    &#96;views&#96;       INT(10) UNSIGNED NOT NULL,</span><br><span class="line">    &#96;comments&#96;    INT(10) UNSIGNED NOT NULL,</span><br><span class="line">    &#96;title&#96;       VARBINARY(255)   NOT NULL,</span><br><span class="line">    &#96;content&#96;     TEXT             NOT NULL</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;article&#96;</span><br><span class="line">    (&#96;author_id&#96;, &#96;category_id&#96;, &#96;views&#96;, &#96;comments&#96;, &#96;title&#96;, &#96;content&#96;)</span><br><span class="line">VALUES</span><br><span class="line">       (1, 1, 1, 1, &#39;1&#39;, &#39;1&#39;),</span><br><span class="line">       (2, 2, 2, 2, &#39;2&#39;, &#39;2&#39;),</span><br><span class="line">       (1, 1, 3, 3, &#39;3&#39;, &#39;3&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SELECT * FROM article;</span><br></pre></td></tr></table></figure><h3 id="2ã€æ¡ˆä¾‹"><a href="#2ã€æ¡ˆä¾‹" class="headerlink" title="2ã€æ¡ˆä¾‹"></a>2ã€æ¡ˆä¾‹</h3><blockquote><p>æŸ¥è¯¢ category_id ä¸º1 ä¸” comments å¤§äº 1 çš„æƒ…å†µä¸‹, views æœ€å¤šçš„ <code>article_id</code>ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,</span><br><span class="line">author_id</span><br><span class="line">FROM article</span><br><span class="line">WHERE category_id &#x3D; 1</span><br><span class="line">AND comments &gt; 1</span><br><span class="line">ORDER BY  views DESC LIMIT 1;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨explain åˆ†æä»¥ä¸Š<code>sql</code>çš„æ‰§è¡Œè®¡åˆ’ï¼Œå‘ç°<code>type</code>ä¸º ALLï¼Œå³æœ€åçš„æƒ…å†µï¼Œ<code>Extra</code>ä¸­è¿˜å‡ºç°äº† <code>Using FileSort</code> çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å¿…é¡»è¿›è¡Œä¼˜åŒ–ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313125325.png" alt="image-20210313125318090"></p><blockquote><p>å¼€å§‹ä¼˜åŒ–</p></blockquote><ul><li>ä¸º <code>category_id</code>ã€<code>comments</code>å’Œ<code>views</code>æ–°å»ºä¸€ä¸ªå¤åˆç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &#96;article&#96; add index idx_cate_comm_views (&#96;category_id&#96;,&#96;comments&#96;,&#96;views&#96;);</span><br></pre></td></tr></table></figure><ul><li>å†æ¬¡ä½¿ç”¨ explain åˆ†æä¸Šé¢çš„<code>sql</code>ï¼Œå‘ç°ä½¿ç”¨äº†ç´¢å¼•ï¼Œä½† <code>using filesort</code> ä¾ç„¶å­˜åœ¨</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313130956.png" alt="image-20210313130955997"></p><blockquote><p>ç”±äº èŒƒå›´æ¯”è¾ƒ åçš„åˆ—ç´¢å¼•ä¼šå¤±æ•ˆï¼Œæ‰€ä»¥ <code>sql</code> çš„æ‰§è¡Œè®¡åˆ’ä¸­å‡ºç°äº† æ–‡ä»¶æ’åºï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤ä¸Šé¢è¿™ä¸ªä¸æ€ä¹ˆåˆé€‚çš„ç´¢å¼•ï¼Œé‡æ–°å†å»ºä¸€ä¸ªã€‚</p></blockquote><ul><li> åˆ é™¤ä¸Šé¢çš„ç´¢å¼•ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index idx_cate_comm_views on &#96;article&#96;;</span><br></pre></td></tr></table></figure><ul><li>ç»•è¿‡ <code>comments</code> å­—æ®µï¼Œä¸º <code>category_id</code> å’Œ <code>views</code> å­—æ®µå»ºä¸€ä¸ªå¤åˆç´¢å¼•ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &#96;article&#96; add index &#96;idx_article_cate_views&#96;(&#96;category_id&#96;,&#96;views&#96;);</span><br></pre></td></tr></table></figure><ul><li>å†æ¬¡è¿è¡ŒSQLè¯­å¥ï¼ŒæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain SELECT id,author_id FROM article WHERE category_id &#x3D; 1 AND comments &gt; 1 ORDER BY  views DESC LIMIT 1;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313134241.png" alt="image-20210313134241862"></p><h2 id="6-2ã€ç´¢å¼•å…³è”æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹"><a href="#6-2ã€ç´¢å¼•å…³è”æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹" class="headerlink" title="6.2ã€ç´¢å¼•å…³è”æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹"></a>6.2ã€ç´¢å¼•å…³è”æŸ¥è¯¢ä¼˜åŒ–æ¡ˆä¾‹</h2><h3 id="1ã€ç¯å¢ƒå‡†å¤‡-2"><a href="#1ã€ç¯å¢ƒå‡†å¤‡-2" class="headerlink" title="1ã€ç¯å¢ƒå‡†å¤‡"></a>1ã€ç¯å¢ƒå‡†å¤‡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;class&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;id&#96;   INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">    &#96;card&#96; INT(10) UNSIGNED NOT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;id&#96;)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE IF NOT EXISTS &#96;book&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;bookid&#96; INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">    &#96;card&#96;   INT(10) UNSIGNED NOT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;bookid&#96;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO class(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO book(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¸¤è¡¨æ¡ˆä¾‹"><a href="#2ã€ä¸¤è¡¨æ¡ˆä¾‹" class="headerlink" title="2ã€ä¸¤è¡¨æ¡ˆä¾‹"></a>2ã€ä¸¤è¡¨æ¡ˆä¾‹</h3><blockquote><p>ä¸‹é¢å¼€å§‹explainåˆ†æ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * FROM class LEFT JOIN book ON class.card &#x3D; book.card;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313134918.png" alt="image-20210313134918533"></p><ul><li>ç»™bookè¡¨çš„cardå­—æ®µåˆ›å»ºä¸€ä¸ªç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table book add index &#96;idx_book_card&#96; (&#96;card&#96;);</span><br></pre></td></tr></table></figure><ul><li>æ­¤æ—¶å†æ¬¡è¿›è¡Œexplainåˆ†æ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313135304.png" alt="image-20210313135304463"></p><blockquote><p>å·¦è¿æ¥åœ¨å³è¡¨ä¸­åˆ›å»ºç´¢å¼•</p></blockquote><ul><li>åˆ é™¤åŸæœ‰çš„bookè¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸ºclassè¡¨çš„cardå­—æ®µåˆ›å»ºä¸€ä¸ªç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop index &#96;idx_book_card&#96; on book;</span><br><span class="line">alter table class add index &#96;idx_book_card&#96; (&#96;card&#96;);</span><br></pre></td></tr></table></figure><ul><li>å†æ¬¡è¿›è¡Œexplainåˆ†æ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313140207.png" alt="image-20210313140206959"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶çš„typeä¸ºindexï¼Œindexçš„æ•ˆç‡æ¯”refä½ã€‚</p><p>å·¦è¿æ¥ä»¥å·¦è¡¨ä½œä¸ºä¸»è¡¨ï¼Œå·¦è¾¹æ•°æ®æ˜¯ä¸€å®šéƒ½æœ‰çš„ï¼Œ<strong>å·¦è¿æ¥ä»å³è¡¨ä¸­é€‰æ‹©æ•°æ®æ·»åŠ åˆ°å·¦è¡¨ä¸­</strong>ï¼Œå³è¾¹æ˜¯æˆ‘ä»¬çš„å…³é”®ç‚¹ï¼Œæ‰€ä»¥å¿…é¡»å¯¹å³è¡¨å»ºç´¢å¼•ã€‚</p><p>å³è¿æ¥åŒç†éœ€è¦å¯¹å·¦è¡¨çš„å­—æ®µå»ºç´¢å¼•ã€‚</p></blockquote><h3 id="3ã€ä¸‰è¡¨æ¡ˆä¾‹"><a href="#3ã€ä¸‰è¡¨æ¡ˆä¾‹" class="headerlink" title="3ã€ä¸‰è¡¨æ¡ˆä¾‹"></a>3ã€ä¸‰è¡¨æ¡ˆä¾‹</h3><blockquote><p>æ·»åŠ æ–°è¡¨ï¼Œæ’å…¥æ•°æ®</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS &#96;phone&#96;</span><br><span class="line">(</span><br><span class="line">    &#96;phoneid&#96; INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,</span><br><span class="line">    &#96;card&#96;   INT(10) UNSIGNED NOT NULL,</span><br><span class="line">    PRIMARY KEY (&#96;phoneid&#96;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br><span class="line">INSERT INTO phone(card)</span><br><span class="line">VALUES (FLOOR(1 + (RAND() * 20)));</span><br></pre></td></tr></table></figure><ul><li>å…ˆåˆ å»ä¸Šé¢ä¸ºclassåˆ›å»ºçš„ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index &#96;idx_book_card&#96; on class;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸‰è¡¨æŸ¥è¯¢SQL</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM class</span><br><span class="line">LEFT JOIN book</span><br><span class="line">ON class.card &#x3D; book.card</span><br><span class="line">LEFT JOIN phone</span><br><span class="line">ON book.card &#x3D; phone.card;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨explainåˆ†ææ‰§è¡Œè®¡åˆ’</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313143428.png" alt="image-20210313143427954"></p><ul><li>ç»™ <code>phone</code> è¡¨å’Œ <code>book</code> è¡¨å„è‡ªå»ºä¸€ä¸ªç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table &#96;phone&#96; add index &#96;idx_phone_card&#96;(&#96;card&#96;);</span><br><span class="line">alter table &#96;book&#96; add index &#96;idx_book_card&#96;(&#96;card&#96;);</span><br></pre></td></tr></table></figure><ul><li>å†æ¬¡ä½¿ç”¨explainåˆ†ææ‰§è¡Œè®¡åˆ’</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210313143737.png" alt="image-20210313143737877"></p><h3 id="4ã€ç»“è®º"><a href="#4ã€ç»“è®º" class="headerlink" title="4ã€ç»“è®º"></a>4ã€ç»“è®º</h3><ul><li>æ°¸è¿œç”¨å°è¡¨ï¼ˆç»“æœé›†ï¼‰é©±åŠ¨å¤§è¡¨ï¼ˆç»“æœé›†ï¼‰</li></ul><blockquote><p>å…ˆäº†è§£åœ¨joinè¿æ¥æ—¶ï¼Œå“ªä¸ªè¡¨æ˜¯é©±åŠ¨è¡¨ï¼Œå“ªä¸ªæ˜¯è¢«é©±åŠ¨è¡¨</p><ol><li>å½“ä½¿ç”¨left joinæ—¶ï¼Œå·¦è¡¨æ˜¯é©±åŠ¨è¡¨ï¼Œå³è¡¨æ˜¯è¢«é©±åŠ¨è¡¨</li><li>å½“ä½¿ç”¨right joinæ—¶ï¼Œå³è¡¨æ—¶é©±åŠ¨è¡¨ï¼Œå·¦è¡¨æ˜¯é©±åŠ¨è¡¨</li><li>å½“ä½¿ç”¨joinæ—¶ï¼Œ<code>mysql</code>ä¼šé€‰æ‹©æ•°æ®é‡æ¯”è¾ƒå°çš„è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨</li></ol></blockquote><ul><li>å­æŸ¥è¯¢å°½é‡ä¸è¦æ”¾åœ¨è¢«é©±åŠ¨è¡¨ï¼Œæœ‰å¯èƒ½ä½¿ç”¨ä¸åˆ°ç´¢å¼•ã€‚</li></ul><blockquote><p>joinæŸ¥è¯¢åœ¨æœ‰ç´¢å¼•æ¡ä»¶ä¸‹</p><ol><li><p>é©±åŠ¨è¡¨æœ‰ç´¢å¼•ä¸ä¼šä½¿ç”¨åˆ°ç´¢å¼•</p></li><li><p>è¢«é©±åŠ¨è¡¨å»ºç«‹ç´¢å¼•ä¼šä½¿ç”¨åˆ°ç´¢å¼•</p></li></ol><p>åœ¨ä»¥å°è¡¨é©±åŠ¨å¤§è¡¨çš„æƒ…å†µä¸‹ï¼Œå†ç»™å¤§è¡¨å»ºç«‹ç´¢å¼•ä¼šå¤§å¤§æé«˜æ‰§è¡Œé€Ÿåº¦</p></blockquote><ul><li>åœ¨æ— æ³•ä¿è¯è¢«é©±åŠ¨è¡¨çš„Joinæ¡ä»¶å­—æ®µè¢«ç´¢å¼•ä¸”å†…å­˜èµ„æºå……è¶³çš„æƒ…å†µä¸‹ï¼Œä¸è¦å¤ªåæƒœ<code>JoinButter</code> çš„è®¾ç½®</li></ul>]]></content>
      
      
      <categories>
          
          <category> MySQLé«˜çº§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLé«˜çº§å­¦ä¹ ï¼ˆä¸€ï¼‰-åˆè¯†ç´¢å¼•ã€å¤ä¹ è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä»¥åŠè§¦å‘å™¨çš„å­¦ä¹ </title>
      <link href="posts/1389856525.html"/>
      <url>posts/1389856525.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€ç´¢å¼•"><a href="#ä¸€ã€ç´¢å¼•" class="headerlink" title="ä¸€ã€ç´¢å¼•"></a>ä¸€ã€ç´¢å¼•</h1><h2 id="1-1ã€ç´¢å¼•æ¦‚è¿°"><a href="#1-1ã€ç´¢å¼•æ¦‚è¿°" class="headerlink" title="1.1ã€ç´¢å¼•æ¦‚è¿°"></a>1.1ã€ç´¢å¼•æ¦‚è¿°</h2><p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼š</p><blockquote><p>ç´¢å¼•ï¼ˆindexï¼‰æ˜¯<strong>å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®</strong>çš„<strong>æ•°æ®ç»“æ„ï¼ˆæœ‰åºï¼‰</strong>ã€‚åœ¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤è€…æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼å¼•ç”¨ï¼ˆæŒ‡å‘ï¼‰æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•ã€‚å¦‚ä¸‹é¢çš„ç¤ºæ„å›¾æ‰€ç¤º :</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306190926.png" alt="image-20210306190926182"></p><blockquote><p>å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ï¼ˆæ³¨æ„é€»è¾‘ä¸Šç›¸é‚»çš„è®°å½•åœ¨ç£ç›˜ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šç‰©ç†ç›¸é‚»çš„ï¼‰ã€‚ä¸ºäº†åŠ å¿«Col2çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®è®°å½•ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨äºŒå‰æŸ¥æ‰¾å¿«é€Ÿè·å–åˆ°ç›¸åº”æ•°æ®ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥<strong>ç´¢å¼•æ–‡ä»¶</strong>çš„å½¢å¼å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚</p><p><strong>ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨æ¥æé«˜æ€§èƒ½çš„æœ€å¸¸ç”¨çš„å·¥å…·ã€‚</strong></p></blockquote><h2 id="1-2ã€ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿"><a href="#1-2ã€ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿" class="headerlink" title="1.2ã€ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿"></a>1.2ã€ç´¢å¼•ä¼˜åŠ¿åŠ£åŠ¿</h2><h3 id="1ã€ä¼˜åŠ¿"><a href="#1ã€ä¼˜åŠ¿" class="headerlink" title="1ã€ä¼˜åŠ¿"></a>1ã€ä¼˜åŠ¿</h3><ul><li>ç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œ<strong>é™ä½æ•°æ®åº“çš„IOæˆæœ¬</strong></li><li>é€šè¿‡ç´¢å¼•å¯¹æ•°æ®ç»“æ„è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œ<strong>é™ä½CPUçš„æ¶ˆè€—</strong></li></ul><blockquote><p>ä»¥ä¸‹æ˜¯ <strong>ã€Šé«˜æ€§èƒ½MySQLã€‹</strong> ä¸­çš„è¡¥å……</p></blockquote><ul><li>ç´¢å¼•å¤§å¤§å‡å°‘äº†æœåŠ¡å™¨éœ€è¦æ‰«æçš„æ•°æ®é‡ã€‚</li><li>ç´¢å¼•å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨</li><li>ç´¢å¼•å¯ä»¥å°†éšæœº <code>I/O</code> å˜ä¸ºé¡ºåº <code>I/O</code></li></ul><h3 id="2ã€åŠ£åŠ¿"><a href="#2ã€åŠ£åŠ¿" class="headerlink" title="2ã€åŠ£åŠ¿"></a>2ã€åŠ£åŠ¿</h3><ul><li>å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¸­ä¿å­˜äº†ä¸»é”®å’Œç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“ç±»çš„è®°å½•ï¼Œ<strong>ç´¢å¼•ç´¢å¼•åˆ—ä¹Ÿæ˜¯éœ€è¦å ç”¨ç©ºé—´çš„ã€‚</strong></li><li>è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼ŒåŒæ—¶å´ä¹Ÿé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEã€DELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQL ä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯ã€‚</li></ul><h2 id="1-3ã€ç´¢å¼•ç»“æ„"><a href="#1-3ã€ç´¢å¼•ç»“æ„" class="headerlink" title="1.3ã€ç´¢å¼•ç»“æ„"></a>1.3ã€ç´¢å¼•ç»“æ„</h2><blockquote><p>ç´¢å¼•æ˜¯åœ¨MySQLçš„<strong>å­˜å‚¨å¼•æ“å±‚</strong>ä¸­å®ç°çš„ï¼Œè€Œ<strong>ä¸æ˜¯åœ¨æœåŠ¡å™¨å±‚å®ç°çš„</strong>ã€‚æ‰€ä»¥æ¯ç§å­˜å‚¨å¼•æ“çš„ç´¢å¼•éƒ½ä¸ä¸€å®šå®Œå…¨ç›¸åŒï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰çš„å­˜å‚¨å¼•æ“éƒ½æ”¯æŒæ‰€æœ‰çš„ç´¢å¼•ç±»å‹çš„ã€‚MySQLç›®å‰æä¾›äº†ä»¥ä¸‹4ç§ç´¢å¼•ï¼š</p></blockquote><ul><li>BTREE ç´¢å¼•ï¼ˆé‡ç‚¹ä»‹ç»ï¼‰</li></ul><blockquote><p>æœ€å¸¸è§çš„ç´¢å¼•ç±»å‹ï¼Œå¤§éƒ¨åˆ†ç´¢å¼•éƒ½æ”¯æŒ B æ ‘ç´¢å¼•ã€‚</p></blockquote><ul><li>HASH ç´¢å¼•</li></ul><blockquote><p>åªæœ‰Memoryå¼•æ“æ”¯æŒ ï¼Œ ä½¿ç”¨åœºæ™¯ç®€å• ã€‚</p></blockquote><ul><li>R-tree ç´¢å¼•ï¼ˆç©ºé—´ç´¢å¼•ï¼‰</li></ul><blockquote><p>ç©ºé—´ç´¢å¼•æ˜¯MyISAMå¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨è¾ƒå°‘ï¼Œä¸åšç‰¹åˆ«ä»‹ç»ã€‚</p></blockquote><ul><li>Full-textï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰</li></ul><blockquote><p>å…¨æ–‡ç´¢å¼•ä¹Ÿæ˜¯MyISAMçš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºå…¨æ–‡ç´¢å¼•ï¼ŒInnoDBä»Mysql5.6ç‰ˆæœ¬å¼€å§‹æ”¯æŒå…¨æ–‡ç´¢å¼•ã€‚</p></blockquote><center>MyISAMã€nnoDBã€Memoryä¸‰ç§å­˜å‚¨å¼•æ“å¯¹å„ç§ç´¢å¼•ç±»å‹çš„æ”¯æŒ</center><table><thead><tr><th><strong>ç´¢å¼•</strong></th><th><strong>InnoDBå¼•æ“</strong></th><th><strong>MyISAMå¼•æ“</strong></th><th><strong>Memoryå¼•æ“</strong></th></tr></thead><tbody><tr><td>BTREEç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>HASH  ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>R-tree  ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Full-text</td><td>5.6ç‰ˆæœ¬ä¹‹åæ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table><blockquote><p>æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œéƒ½æ˜¯æŒ‡B+æ ‘ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒå‰çš„ï¼‰ç»“æ„ç»„ç»‡çš„ç´¢å¼•ã€‚å…¶ä¸­èšé›†ç´¢å¼•ã€å¤åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•é»˜è®¤éƒ½æ˜¯ä½¿ç”¨ B+tree ç´¢å¼•ï¼Œç»Ÿç§°ä¸º ç´¢å¼•ã€‚</p></blockquote><h3 id="1ã€BTREE-ç»“æ„"><a href="#1ã€BTREE-ç»“æ„" class="headerlink" title="1ã€BTREE ç»“æ„"></a>1ã€BTREE ç»“æ„</h3><blockquote><p><strong>BTreeåˆå«å¤šè·¯å¹³è¡¡æœç´¢æ ‘</strong>ï¼Œä¸€æ£µ <code>m</code> å‰çš„BTreeç‰¹æ€§å¦‚ä¸‹ï¼š</p></blockquote><ul><li>æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å« <code>m</code> ä¸ªå­©å­ã€‚</li><li>é™¤æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ <code>[ceil(m / 2)]</code> ä¸ªå­©å­èŠ‚ç‚¹ã€‚ï¼ˆceilï¼šå‘ä¸Šå–æ•´ï¼‰</li><li>è‹¥æ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰ä¸¤ä¸ªå­©å­ã€‚</li><li>æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚</li><li>æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±nä¸ªkeyï¼ˆå­˜å‚¨å…ƒç´ ï¼‰ä¸n+1ä¸ªæŒ‡é’ˆç»„æˆï¼Œå…¶ä¸­ <code>[ceil(m/2)-1] &lt;= n &lt;= m-1</code></li></ul><blockquote><p>è¿™é‡Œä»¥ <strong>5å‰BTreeä¸ºä¾‹</strong>ï¼Œç”± <code>m = 5</code> å¯æ¨å‡º  <code>[ceil(m/2)-1] &lt;= n &lt;= m-1</code> ã€‚</p><p>å³ <code>2 &lt;= n &lt;= 4</code>ã€‚</p><p>å½“ <code>n &gt; 4</code> æ—¶ï¼Œ<strong>ä¸­é—´èŠ‚ç‚¹åˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ï¼Œç„¶åä¸¤è¾¹èŠ‚ç‚¹åˆ†å¼€ã€‚</strong></p></blockquote><center>æ’å…¥ C N G A H E K Q M F W L T Z D P R X Y S æ•°æ®ä¸ºä¾‹</center><blockquote><p>æ¼”å˜è¿‡ç¨‹å¦‚ä¸‹</p></blockquote><ul><li>æ’å…¥å‰å››ä¸ªå­—æ¯ C N G A</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306161148.png" alt="image-20210306161147934"> </p><ul><li>æ’å…¥ H ï¼Œæ­¤æ—¶ <code>n&gt;4</code>ï¼Œä¸­é—´å…ƒç´  G å­—æ¯ä¼šå‘ä¸Šåˆ†è£‚åˆ°æ–°çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶Gä¸¤è¾¹çš„å…ƒç´ ä¼šåˆ†è£‚æˆä¸¤å—</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162051.png" alt="image-20210306162051558"></p><ul><li>æ’å…¥Eï¼ŒKï¼ŒQä¸éœ€è¦åˆ†è£‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162122.png" alt="image-20210306162122287"></p><ul><li>æ’å…¥Mï¼Œä¸­é—´å…ƒç´ Må­—æ¯å‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹G</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162145.png" alt="image-20210306162145688"></p><ul><li>æ’å…¥Fï¼ŒWï¼ŒLï¼ŒTä¸éœ€è¦åˆ†è£‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162216.png" alt="image-20210306162216615"></p><ul><li>æ’å…¥Zï¼Œä¸­é—´å…ƒç´ Tå‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162245.png" alt="image-20210306162245821"></p><ul><li>æ’å…¥Dï¼Œä¸­é—´å…ƒç´ Då‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­ã€‚ç„¶åæ’å…¥Pï¼ŒRï¼ŒXï¼ŒYä¸éœ€è¦åˆ†è£‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162311.png" alt="image-20210306162311645"></p><ul><li>æœ€åæ’å…¥Sï¼ŒNPQRèŠ‚ç‚¹n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹Qå‘ä¸Šåˆ†è£‚ï¼Œä½†åˆ†è£‚åçˆ¶èŠ‚ç‚¹DGMTçš„n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹Må‘ä¸Šåˆ†è£‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162345.png" alt="image-20210306162345542"></p><blockquote><p>åˆ°æ­¤ï¼Œè¯¥BTREEæ ‘å°±å·²ç»æ„å»ºå®Œæˆäº†ï¼Œ BTREEæ ‘ å’Œ äºŒå‰æ ‘ ç›¸æ¯”ï¼Œ <strong>æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡æ›´é«˜</strong>ï¼Œ å› ä¸º<strong>å¯¹äºç›¸åŒçš„æ•°æ®é‡æ¥è¯´ï¼ŒBTREEçš„å±‚çº§ç»“æ„æ¯”äºŒå‰æ ‘å°</strong>ï¼Œå› æ­¤æœç´¢é€Ÿåº¦å¿«ã€‚</p></blockquote><h3 id="2ã€B-TREE-ç»“æ„"><a href="#2ã€B-TREE-ç»“æ„" class="headerlink" title="2ã€B+TREE ç»“æ„"></a>2ã€B+TREE ç»“æ„</h3><blockquote><p>B+Treeä¸ºBTreeçš„å˜ç§ï¼ŒB+Treeä¸BTreeçš„åŒºåˆ«ä¸ºï¼š</p></blockquote><ul><li><p>nå‰B+Treeæœ€å¤šå«æœ‰nä¸ªkeyï¼Œè€ŒBTreeæœ€å¤šå«æœ‰n-1ä¸ªkeyã€‚</p></li><li><p><strong>B+Treeçš„å¶å­èŠ‚ç‚¹ä¿å­˜æ‰€æœ‰çš„keyä¿¡æ¯ï¼Œä¾keyå¤§å°é¡ºåºæ’åˆ—ã€‚</strong> B+Treeçš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚</p></li><li><p>æ‰€æœ‰çš„éå¶å­èŠ‚ç‚¹éƒ½å¯ä»¥çœ‹ä½œæ˜¯keyçš„ç´¢å¼•éƒ¨åˆ†ã€‚</p></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306162838.png" alt="image-20210306162838426"></p><blockquote><p>ç”±äºB+Treeåªæœ‰å¶å­èŠ‚ç‚¹ä¿å­˜keyä¿¡æ¯ï¼ŒæŸ¥è¯¢ä»»ä½•keyéƒ½è¦ä»rootèµ°åˆ°å¶å­ã€‚æ‰€ä»¥<strong>B+Treeçš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š</strong>ã€‚</p></blockquote><h3 id="3ã€MySQLä¸­çš„B-Tree"><a href="#3ã€MySQLä¸­çš„B-Tree" class="headerlink" title="3ã€MySQLä¸­çš„B+Tree"></a>3ã€MySQLä¸­çš„B+Tree</h3><blockquote><p>MySqlç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„B+Treeè¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„B+Treeï¼Œ<strong>æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ã€‚</strong></p><p>MySQLä¸­çš„ B+Tree ç´¢å¼•ç»“æ„ç¤ºæ„å›¾:</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306163507.png" alt="image-20210306163507780"></p><h2 id="1-4ã€ç´¢å¼•åˆ†ç±»"><a href="#1-4ã€ç´¢å¼•åˆ†ç±»" class="headerlink" title="1.4ã€ç´¢å¼•åˆ†ç±»"></a>1.4ã€ç´¢å¼•åˆ†ç±»</h2><h3 id="1ã€å•å€¼ç´¢å¼•"><a href="#1ã€å•å€¼ç´¢å¼•" class="headerlink" title="1ã€å•å€¼ç´¢å¼•"></a>1ã€å•å€¼ç´¢å¼•</h3><blockquote><p>å³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p></blockquote><h3 id="2ã€å”¯ä¸€ç´¢å¼•"><a href="#2ã€å”¯ä¸€ç´¢å¼•" class="headerlink" title="2ã€å”¯ä¸€ç´¢å¼•"></a>2ã€å”¯ä¸€ç´¢å¼•</h3><blockquote><p>ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚</p></blockquote><h3 id="3ã€å¤åˆç´¢å¼•"><a href="#3ã€å¤åˆç´¢å¼•" class="headerlink" title="3ã€å¤åˆç´¢å¼•"></a>3ã€å¤åˆç´¢å¼•</h3><blockquote><p>å³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ã€‚</p></blockquote><h3 id="4ã€ä¸»é”®ç´¢å¼•"><a href="#4ã€ä¸»é”®ç´¢å¼•" class="headerlink" title="4ã€ä¸»é”®ç´¢å¼•"></a>4ã€ä¸»é”®ç´¢å¼•</h3><blockquote><p>ä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ã€‚</p><p><strong>ä¸€èˆ¬æ˜¯åœ¨å»ºè¡¨çš„æ—¶å€™æŒ‡å®šäº†ä¸»é”®ï¼Œå°±ä¼šåˆ›å»ºä¸»é”®ç´¢å¼•</strong>ï¼Œ CREATE INDEXä¸èƒ½ç”¨æ¥åˆ›å»ºä¸»é”®ç´¢å¼•ï¼Œä½¿ç”¨ ALTER TABLEæ¥ä»£æ›¿ã€‚</p></blockquote><h3 id="5ã€æ™®é€šç´¢å¼•"><a href="#5ã€æ™®é€šç´¢å¼•" class="headerlink" title="5ã€æ™®é€šç´¢å¼•"></a>5ã€æ™®é€šç´¢å¼•</h3><blockquote><p>åˆç§°è¾…åŠ©ç´¢å¼•ã€äºŒçº§ç´¢å¼•ã€‚</p></blockquote><h2 id="1-5ã€ç´¢å¼•è¯­æ³•"><a href="#1-5ã€ç´¢å¼•è¯­æ³•" class="headerlink" title="1.5ã€ç´¢å¼•è¯­æ³•"></a>1.5ã€ç´¢å¼•è¯­æ³•</h2><blockquote><p>ç´¢å¼•å¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶åŒæ—¶åˆ›å»ºï¼Œä¹Ÿå¯ä»¥éšæ—¶æ·»åŠ æ–°çš„ç´¢å¼•ã€‚</p></blockquote><h3 id="1ã€å‡†å¤‡ç¯å¢ƒ"><a href="#1ã€å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="1ã€å‡†å¤‡ç¯å¢ƒ"></a>1ã€å‡†å¤‡ç¯å¢ƒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">use index_study;</span><br><span class="line">CREATE TABLE `city`</span><br><span class="line">(</span><br><span class="line">    `city_id`    <span class="keyword">int</span>(<span class="number">11</span>)     NOT NULL AUTO_INCREMENT,</span><br><span class="line">    `city_name`  varchar(<span class="number">50</span>) NOT NULL,</span><br><span class="line">    `country_id` <span class="keyword">int</span>(<span class="number">11</span>)     NOT NULL,</span><br><span class="line">    <span class="function">PRIMARY <span class="title">KEY</span> <span class="params">(`city_id`)</span></span></span><br><span class="line"><span class="function">) ENGINE </span>= InnoDB</span><br><span class="line">  DEFAULT CHARSET = utf8;</span><br><span class="line">CREATE TABLE `country`</span><br><span class="line">(</span><br><span class="line">    `country_id`   <span class="keyword">int</span>(<span class="number">11</span>)      NOT NULL AUTO_INCREMENT,</span><br><span class="line">    `country_name` varchar(<span class="number">100</span>) NOT NULL,</span><br><span class="line"></span><br><span class="line">    <span class="function">PRIMARY <span class="title">KEY</span> <span class="params">(`country_id`)</span></span></span><br><span class="line"><span class="function">) ENGINE </span>= InnoDB</span><br><span class="line">  DEFAULT CHARSET = utf8;</span><br><span class="line"></span><br><span class="line">insert into `city` (`city_id`, `city_name`, `country_id`)</span><br><span class="line">values (<span class="number">1</span>, <span class="string">&#x27;è¥¿å®‰&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">insert into `city` (`city_id`, `city_name`, `country_id`)</span><br><span class="line">values (<span class="number">2</span>, <span class="string">&#x27;NewYork&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">insert into `city` (`city_id`, `city_name`, `country_id`)</span><br><span class="line">values (<span class="number">3</span>, <span class="string">&#x27;åŒ—äº¬&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">insert into `city` (`city_id`, `city_name`, `country_id`)</span><br><span class="line">values (<span class="number">4</span>, <span class="string">&#x27;ä¸Šæµ·&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">insert into `country` (`country_id`, `country_name`)</span><br><span class="line">values (<span class="number">1</span>, <span class="string">&#x27;China&#x27;</span>);</span><br><span class="line">insert into `country` (`country_id`, `country_name`)</span><br><span class="line">values (<span class="number">2</span>, <span class="string">&#x27;America&#x27;</span>);</span><br><span class="line">insert into `country` (`country_id`, `country_name`)</span><br><span class="line">values (<span class="number">3</span>, <span class="string">&#x27;Japan&#x27;</span>);</span><br><span class="line">insert into `country` (`country_id`, `country_name`)</span><br><span class="line">values (<span class="number">4</span>, <span class="string">&#x27;UK&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºç´¢å¼•"><a href="#2ã€åˆ›å»ºç´¢å¼•" class="headerlink" title="2ã€åˆ›å»ºç´¢å¼•"></a>2ã€åˆ›å»ºç´¢å¼•</h3><blockquote><p>è¯­æ³•ï¼š</p><p>CREATE [UNIQUE | FULLTEXT | SPATIAL] INDEX index_name</p><p>[USING index_type]</p><p>on tbl_name(index_col_name,â€¦)</p><p>index_col_name : column_name[(length)] [ASC | DESC]</p></blockquote><ul><li>[UNIQUE | FULLTEXT | SPATIAL]</li></ul><blockquote><p>UNIQUEï¼šå”¯ä¸€ç´¢å¼•</p><p>FULLTEXTï¼šå…¨æ–‡ç´¢å¼•</p><p>SPATIALï¼šç©ºé—´ç´¢å¼•</p></blockquote><ul><li>[index_type]</li></ul><blockquote><p>å¯é€‰ï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤ä½¿ç”¨BTreeç´¢å¼•</p></blockquote><ul><li>tbl_name(index_col_name,â€¦)</li></ul><blockquote><p>ä¸ºå“ªå¼ è¡¨çš„é‚£äº›å­—æ®µåˆ›å»ºç´¢å¼•ã€‚</p></blockquote><ul><li>ä¸ºcityè¡¨çš„ city_name å­—æ®µåˆ›å»ºç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE INDEX idx_city_name ON &#96;city&#96; (city_name);</span><br></pre></td></tr></table></figure><h3 id="2ã€æŸ¥çœ‹ç´¢å¼•"><a href="#2ã€æŸ¥çœ‹ç´¢å¼•" class="headerlink" title="2ã€æŸ¥çœ‹ç´¢å¼•"></a>2ã€æŸ¥çœ‹ç´¢å¼•</h3><ul><li>è¯­æ³•å¦‚ä¸‹</li></ul><blockquote><p>show index from è¦æŸ¥çœ‹çš„è¡¨;</p></blockquote><ul><li>æŸ¥çœ‹cityè¡¨ä¸­çš„ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from &#96;city&#96;;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œ sqlè¯­å¥ï¼Œç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°cityè¡¨ä¸‹æœ‰ä¸¤ä¸ªç´¢å¼•ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306171002.png" alt="image-20210306171001423"></p><h3 id="3ã€åˆ é™¤ç´¢å¼•"><a href="#3ã€åˆ é™¤ç´¢å¼•" class="headerlink" title="3ã€åˆ é™¤ç´¢å¼•"></a>3ã€åˆ é™¤ç´¢å¼•</h3><ul><li>è¯­æ³•å¦‚ä¸‹</li></ul><blockquote><p>drop index ç´¢å¼•å on è¡¨å;</p></blockquote><ul><li>åˆ é™¤æˆ‘ä»¬åˆšæ‰åœ¨cityè¡¨ä¸­ä¸º city_name åˆ›å»ºçš„ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index idx_city_name on &#96;city&#96;;</span><br></pre></td></tr></table></figure><ul><li>å†æ¬¡è¿è¡ŒæŸ¥çœ‹ç´¢å¼•æŒ‡ä»¤ï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show index from &#96;city&#96;;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å¯ä»¥å‘ç°åªå‰©ä¸‹ PRIMARY ç´¢å¼•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306171442.png" alt="image-20210306171441899"></p><h3 id="4ã€ä½¿ç”¨ALTERå‘½ä»¤æ¥åˆ›å»ºç´¢å¼•"><a href="#4ã€ä½¿ç”¨ALTERå‘½ä»¤æ¥åˆ›å»ºç´¢å¼•" class="headerlink" title="4ã€ä½¿ç”¨ALTERå‘½ä»¤æ¥åˆ›å»ºç´¢å¼•"></a>4ã€ä½¿ç”¨ALTERå‘½ä»¤æ¥åˆ›å»ºç´¢å¼•</h3><ul><li>ä½¿ç”¨ <strong>ALTER</strong> å‘½ä»¤åˆ›å»ºä¸€ä¸ªä¸»é”®ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &#96;tb_name&#96; add primary key(å­—æ®µåˆ—è¡¨);</span><br></pre></td></tr></table></figure><blockquote><p>è¯¥è¯­å¥æ·»åŠ ä¸€ä¸ªä¸»é”®ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸”ä¸èƒ½ä¸ºNULL</p></blockquote><ul><li>ä½¿ç”¨ <strong>ALTER</strong> å‘½ä»¤åˆ›å»ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &#96;tb_name&#96; add unique ç´¢å¼•å(å­—æ®µåˆ—è¡¨);</span><br></pre></td></tr></table></figure><blockquote><p>è¿™æ¡è¯­å¥åˆ›å»ºç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ˆé™¤äº†NULLå¤–ï¼ŒNULLå¯èƒ½ä¼šå‡ºç°å¤šæ¬¡ï¼‰</p></blockquote><ul><li>ä½¿ç”¨ <strong>ALTER</strong> å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ™®é€šç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table &#96;tb_name&#96; add index ç´¢å¼•å(å­—æ®µåˆ—è¡¨);</span><br></pre></td></tr></table></figure><blockquote><p>æ·»åŠ æ™®é€šç´¢å¼•ï¼Œ ç´¢å¼•å€¼å¯ä»¥å‡ºç°å¤šæ¬¡ã€‚</p></blockquote><ul><li>ä½¿ç”¨ <strong>ALTER</strong> å‘½ä»¤åˆ›å»ºä¸€ä¸ªå…¨æ–‡ç´¢å¼•</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table tb_nameaddfulltext ç´¢å¼•å(å­—æ®µåˆ—è¡¨);</span><br></pre></td></tr></table></figure><blockquote><p>è¯¥è¯­å¥æŒ‡å®šäº†ç´¢å¼•ä¸ºFULLTEXTï¼Œ ç”¨äºå…¨æ–‡ç´¢å¼•</p></blockquote><h3 id="5ã€å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªç´¢å¼•æ˜¯ä¸æ˜¯å”¯ä¸€ç´¢å¼•"><a href="#5ã€å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªç´¢å¼•æ˜¯ä¸æ˜¯å”¯ä¸€ç´¢å¼•" class="headerlink" title="5ã€å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªç´¢å¼•æ˜¯ä¸æ˜¯å”¯ä¸€ç´¢å¼•"></a>5ã€å¦‚ä½•æŸ¥çœ‹ä¸€ä¸ªç´¢å¼•æ˜¯ä¸æ˜¯å”¯ä¸€ç´¢å¼•</h3><blockquote><p>æŸ¥çœ‹è¯¥è¡¨çš„ç´¢å¼•</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use index_study;</span><br><span class="line">create index idx_city_name on &#96;city&#96;(city_name);</span><br><span class="line">show index from &#96;city&#96;;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306172658.png" alt="image-20210306172658202"></p><h2 id="1-6ã€ç´¢å¼•è®¾è®¡åŸåˆ™"><a href="#1-6ã€ç´¢å¼•è®¾è®¡åŸåˆ™" class="headerlink" title="1.6ã€ç´¢å¼•è®¾è®¡åŸåˆ™"></a>1.6ã€ç´¢å¼•è®¾è®¡åŸåˆ™</h2><blockquote><p>â€‹       ç´¢å¼•çš„è®¾è®¡å¯ä»¥éµå¾ªä¸€äº›å·²æœ‰çš„åŸåˆ™ï¼Œåˆ›å»ºç´¢å¼•çš„æ—¶å€™è¯·å°½é‡è€ƒè™‘ç¬¦åˆè¿™äº›åŸåˆ™ï¼Œä¾¿äºæå‡ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡ï¼Œæ›´é«˜æ•ˆçš„ä½¿ç”¨ç´¢å¼•ã€‚</p></blockquote><ul><li><p>å¯¹<strong>æŸ¥è¯¢é¢‘æ¬¡è¾ƒé«˜ï¼Œä¸”æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨</strong>å»ºç«‹ç´¢å¼•ã€‚</p></li><li><p>ç´¢å¼•å­—æ®µçš„é€‰æ‹©ï¼Œæœ€ä½³å€™é€‰åˆ—åº”å½“ä»whereå­å¥çš„æ¡ä»¶ä¸­æå–ï¼Œå¦‚æœwhereå­å¥ä¸­çš„ç»„åˆæ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆåº”å½“æŒ‘é€‰æœ€å¸¸ç”¨ã€è¿‡æ»¤æ•ˆæœæœ€å¥½çš„åˆ—çš„ç»„åˆï¼ˆ<strong>é’ˆå¯¹æŸ¥è¯¢å­—æ®µè®¾è®¡ç´¢å¼•</strong>ï¼‰</p></li><li><p>ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚</p></li><li><p>ç´¢å¼•å¯ä»¥æœ‰æ•ˆçš„æå‡æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡ï¼Œä½†ç´¢å¼•æ•°é‡ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·è‡ªç„¶ä¹Ÿå°±æ°´æ¶¨èˆ¹é«˜ã€‚å¯¹äºæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰DMLæ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¡¨æ¥è¯´ï¼Œç´¢å¼•è¿‡å¤šï¼Œä¼šå¼•å…¥ç›¸å½“é«˜çš„ç»´æŠ¤ä»£ä»·ï¼Œé™ä½</p></li><li><p>DMLï¼ˆå¦‚insertã€updateã€deleteï¼‰æ“ä½œçš„æ•ˆç‡ï¼Œå¢åŠ ç›¸åº”æ“ä½œçš„æ—¶é—´æ¶ˆè€—ã€‚å¦å¤–ç´¢å¼•è¿‡å¤šçš„è¯ï¼ŒMySQLä¹Ÿä¼šçŠ¯é€‰æ‹©å›°éš¾ç—…ï¼Œè™½ç„¶æœ€ç»ˆä»ç„¶ä¼šæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ç´¢å¼•ï¼Œä½†æ— ç–‘æé«˜äº†é€‰æ‹©çš„ä»£ä»·ã€‚</p></li><li><p><strong>ä½¿ç”¨çŸ­ç´¢å¼•</strong>ï¼Œç´¢å¼•åˆ›å»ºä¹‹åä¹Ÿæ˜¯ä½¿ç”¨ç¡¬ç›˜æ¥å­˜å‚¨çš„ï¼Œå› æ­¤æå‡ç´¢å¼•è®¿é—®çš„I/Oæ•ˆç‡ï¼Œä¹Ÿå¯ä»¥æå‡æ€»ä½“çš„è®¿é—®æ•ˆç‡ã€‚å‡å¦‚æ„æˆç´¢å¼•çš„å­—æ®µæ€»é•¿åº¦æ¯”è¾ƒçŸ­ï¼Œé‚£ä¹ˆåœ¨ç»™å®šå¤§å°çš„å­˜å‚¨å—å†…å¯ä»¥å­˜å‚¨æ›´å¤šçš„ç´¢å¼•å€¼ï¼Œç›¸åº”çš„å¯ä»¥æœ‰æ•ˆçš„æå‡MySQLè®¿é—®ç´¢å¼•çš„I/Oæ•ˆç‡ã€‚</p></li><li><p>ï¼ˆé’ˆå¯¹å¤åˆç´¢å¼•ï¼‰åˆ©ç”¨æœ€å·¦å‰ç¼€ï¼ŒNä¸ªåˆ—ç»„åˆè€Œæˆçš„ç»„åˆç´¢å¼•ï¼Œé‚£ä¹ˆç›¸å½“äºæ˜¯åˆ›å»ºäº†Nä¸ªç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢æ—¶whereå­å¥ä¸­ä½¿ç”¨äº†ç»„æˆè¯¥ç´¢å¼•çš„å‰å‡ ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™æ¡æŸ¥è¯¢SQLå¯ä»¥åˆ©ç”¨ç»„åˆç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p></li></ul><blockquote><p>å¦‚æœåˆ›å»ºå¤åˆç´¢å¼•idxï¼Œè¿™ä¸ªç´¢å¼•ä½œç”¨äº NAMEã€EMAILå’ŒSTATUSä¸Šï¼Œé‚£ä¹ˆï¼š</p><p>ç›¸å½“äºå¯¹NAMEåˆ›å»ºäº†ç´¢å¼•ã€‚</p><p>å¯¹NAMEã€EMAILåˆ›å»ºäº†ç´¢å¼•</p><p>å¯¹NAMEã€EMAILå’ŒSTATUSåˆ›å»ºäº†ç´¢å¼•ã€‚</p><p><strong>åªè¦åœ¨æŸ¥è¯¢æ—¶åŒ…å«äº†ç¬¬ä¸€ä¸ªå­—æ®µNAMEï¼Œé‚£ä¹ˆæŸ¥è¯¢å°±ä¼šèµ°ç´¢å¼•ã€‚</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306173547.png" alt="image-20210306173547319"></p><h3 id="1ã€å“ªäº›æƒ…å†µä¸‹éœ€è¦åˆ›å»ºç´¢å¼•"><a href="#1ã€å“ªäº›æƒ…å†µä¸‹éœ€è¦åˆ›å»ºç´¢å¼•" class="headerlink" title="1ã€å“ªäº›æƒ…å†µä¸‹éœ€è¦åˆ›å»ºç´¢å¼•"></a>1ã€å“ªäº›æƒ…å†µä¸‹éœ€è¦åˆ›å»ºç´¢å¼•</h3><ul><li><p>ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•</p></li><li><p>é¢‘ç¹ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µåº”è¯¥åˆ›å»ºç´¢å¼•(where åé¢çš„è¯­å¥)</p></li><li><p>æŸ¥è¯¢ä¸­ä¸å…¶å®ƒè¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»å»ºç«‹ç´¢å¼•</p></li><li><p><strong>æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µ</strong>ï¼Œæ’åºå­—æ®µè‹¥é€šè¿‡ç´¢å¼•å»è®¿é—®å°†å¤§å¤§æé«˜æ’åºé€Ÿåº¦</p></li><li><p>æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–è€…åˆ†ç»„å­—æ®µ</p></li><li><p>å¯¹äºå•é”®å’Œç»„åˆç´¢å¼•ï¼Œåœ¨é«˜å¹¶å‘æ¡ä»¶ä¸‹å€¾å‘äºåˆ›å»ºç»„åˆç´¢å¼•</p></li></ul><h3 id="2ã€å“ªäº›æƒ…å†µä¸‹ä¸éœ€è¦åˆ›å»ºç´¢å¼•"><a href="#2ã€å“ªäº›æƒ…å†µä¸‹ä¸éœ€è¦åˆ›å»ºç´¢å¼•" class="headerlink" title="2ã€å“ªäº›æƒ…å†µä¸‹ä¸éœ€è¦åˆ›å»ºç´¢å¼•"></a>2ã€å“ªäº›æƒ…å†µä¸‹ä¸éœ€è¦åˆ›å»ºç´¢å¼•</h3><ul><li>æ•°æ®é‡ä¸å¤§çš„è¡¨</li><li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨</li></ul><blockquote><p>æé«˜äº†æŸ¥è¯¢é€Ÿåº¦ï¼ŒåŒæ—¶å´ä¼šé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚</p><p>å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶</p></blockquote><ul><li>æ•°æ®é‡å¤ä¸”åˆ†å¸ƒå¹³å‡çš„è¡¨å­—æ®µ</li></ul><blockquote><p>å› æ­¤åº”è¯¥åªä¸ºæœ€ç»å¸¸æŸ¥è¯¢å’Œæœ€ç»å¸¸æ’åºçš„æ•°æ®åˆ—å»ºç«‹ç´¢å¼•ã€‚</p><p>æ³¨æ„ï¼Œå¦‚æœæŸä¸ªæ•°æ®åˆ—åŒ…å«è®¸å¤šé‡å¤çš„å†…å®¹ï¼Œä¸ºå®ƒå»ºç«‹ç´¢å¼•å°±æ²¡æœ‰å¤ªå¤§çš„å®é™…æ•ˆæœã€‚</p><p>å¦‚ï¼šæ€§åˆ«å’Œå›½ç±</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210312213446.png" alt="img"></p><h2 id="1-7ã€å…³äºMySQLä¸­BTreeç´¢å¼•çš„ä¸€äº›è¡¥å……"><a href="#1-7ã€å…³äºMySQLä¸­BTreeç´¢å¼•çš„ä¸€äº›è¡¥å……" class="headerlink" title="1.7ã€å…³äºMySQLä¸­BTreeç´¢å¼•çš„ä¸€äº›è¡¥å……"></a>1.7ã€å…³äºMySQLä¸­BTreeç´¢å¼•çš„ä¸€äº›è¡¥å……</h2><blockquote><p>æˆ‘ä»¬ä½¿ç”¨æœ¯è¯­ <code>B-Tree</code> ï¼Œæ˜¯å› ä¸º MySQL åœ¨CREATE TABLE å’Œå…¶ä»–è¯­å¥æ—¶ä¹Ÿæ˜¯ç”¨è¯¥å…³é”®å­—ã€‚</p><p>ä¸è¿‡ï¼Œåº•å±‚çš„å­˜å‚¨å¼•æ“ä¹Ÿå¯èƒ½ä½¿ç”¨ä¸åŒçš„å­˜å‚¨ç»“æ„</p><p>ä¾‹å¦‚ï¼Œ <code>NOB</code> é›†ç¾¤å­˜å‚¨å¼•æ“å†…éƒ¨æ—¶æœºä¸Šä½¿ç”¨äº† <code>T-Tree</code> ç»“æ„å­˜å‚¨è¿™ç§ç´¢å¼•ï¼Œå³ä½¿å…¶åå­—ä¸º <code>BTree</code> ï¼›</p><p><code>InnoDB</code> åˆ™ä½¿ç”¨çš„æ˜¯ <code>B+Tree</code> ã€‚</p></blockquote><h3 id="1ã€åˆ›å»ºä¸€å¼ æ•°æ®è¡¨"><a href="#1ã€åˆ›å»ºä¸€å¼ æ•°æ®è¡¨" class="headerlink" title="1ã€åˆ›å»ºä¸€å¼ æ•°æ®è¡¨"></a>1ã€åˆ›å»ºä¸€å¼ æ•°æ®è¡¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE table People (</span><br><span class="line">    &#96;last_name&#96; varchar(50) not null,</span><br><span class="line">    &#96;first_name&#96; varchar(50) not null,</span><br><span class="line">    &#96;birthday&#96; date not null,</span><br><span class="line">    &#96;gender&#96; enum(&#39;m&#39;,&#39;f&#39;) not null,</span><br><span class="line">    key(last_name,first_name,birthday) </span><br><span class="line">);</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºè¡¨ä¸­çš„æ¯ä¸€è¡Œæ•°æ®ï¼Œç´¢å¼•ä¸­åŒ…å«äº† <code>last_name</code> ã€<code>first_name</code> å’Œ <code>birthday</code> åˆ—çš„å€¼ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†ç´¢å¼•æ˜¯å¦‚ä½•ç»„ç»‡æ•°æ®çš„å­˜å‚¨çš„ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210308104848.png" alt="image-20210308104834889"></p><h3 id="2ã€ç´¢å¼•æœ‰æ•ˆçš„æŸ¥è¯¢"><a href="#2ã€ç´¢å¼•æœ‰æ•ˆçš„æŸ¥è¯¢" class="headerlink" title="2ã€ç´¢å¼•æœ‰æ•ˆçš„æŸ¥è¯¢"></a>2ã€ç´¢å¼•æœ‰æ•ˆçš„æŸ¥è¯¢</h3><ul><li>å…¨å€¼åŒ¹é…</li></ul><blockquote><p>å…¨å€¼åŒ¹é…æŒ‡çš„æ˜¯å’Œç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—ï¼ˆä¸Šè¡¨æ˜¯<code>last_name,first_name,birthday</code>ï¼‰ï¼Œä¾‹å¦‚å‰é¢æåˆ°çš„ç´¢å¼•å¯ä»¥ç”¨äºæŸ¥æ‰¾ å§“åä¸º <strong>æå°æ˜</strong>ã€å‡ºç”Ÿäº2000-10-31çš„äººã€‚</p></blockquote><ul><li>åŒ¹é…æœ€å·¦å‰ç¼€</li></ul><blockquote><p>å‰é¢æåˆ°çš„ç´¢å¼•å¯ä»¥ç”¨äºæŸ¥æ‰¾æ‰€æœ‰å§“ä¸º <strong>åˆ˜</strong> çš„äººï¼Œå³ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€åˆ—ã€‚</p></blockquote><ul><li>åŒ¹é…åˆ—å‰ç¼€</li></ul><blockquote><p>ä¹Ÿå¯ä»¥åªåŒ¹é…æŸä¸€åˆ—çš„å¼€å¤´éƒ¨åˆ†ï¼Œå¦‚å‰é¢æåˆ°çš„ç´¢å¼•å¯ä»¥ç”¨äºå¯ä»¥ç”¨äºæŸ¥æ‰¾æ‰€æœ‰ä»¥ <strong>J</strong> å¼€å¤´çš„å§“çš„äººã€‚è¿™é‡Œä¹Ÿä½¿ç”¨äº†ç´¢å¼•çš„ç¬¬ä¸€åˆ—ã€‚</p></blockquote><ul><li>åŒ¹é…èŒƒå›´å€¼</li></ul><blockquote><p>ä¾‹å¦‚å‰é¢æåˆ°çš„ç´¢å¼•å¯ç”¨äºæŸ¥æ‰¾å§“åœ¨ <code>Allen</code> å’Œ <code>Barrymore</code> ä¹‹é—´çš„äººã€‚è¿™é‡Œä½¿ç”¨äº†ç´¢å¼•çš„ç¬¬ä¸€åˆ—ã€‚</p></blockquote><ul><li>ç²¾ç¡®åŒ¹é…æŸä¸€åˆ—è€ŒèŒƒå›´åŒ¹é…å¦ä¸€åˆ—</li></ul><blockquote><p>æŸ¥æ‰¾æ¡ä»¶ä¸ç´¢å¼•ç¬¬ä¸€åˆ— <code>last_name</code> å…¨åŒ¹é…ï¼Œä¸ç´¢å¼•ç¬¬äºŒåˆ— <code>last_name</code> èŒƒå›´åŒ¹é…</p></blockquote><h3 id="3ã€B-Treeç´¢å¼•çš„é™åˆ¶"><a href="#3ã€B-Treeç´¢å¼•çš„é™åˆ¶" class="headerlink" title="3ã€B-Treeç´¢å¼•çš„é™åˆ¶"></a>3ã€B-Treeç´¢å¼•çš„é™åˆ¶</h3><ul><li>å¦‚æœä¸æ˜¯æŒ‰ç…§ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹æŸ¥æ‰¾,åˆ™æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚</li></ul><blockquote><p>ä¾‹å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„ç´¢å¼•æ— æ³•ç”¨äºæŸ¥æ‰¾åå­—ä¸ºBilläºº,ä¹Ÿæ— æ³•æŸ¥æ‰¾æŸä¸ªç‰¹å®šç”Ÿæ—¥çš„äºº,å› ä¸ºè¿™ä¸¤åˆ—éƒ½ä¸æ˜¯æœ€å·¦æ•°æ®åˆ—ã€‚ç±»ä¼¼åœ°,ä¹Ÿæ— æ³•æŸ¥æ‰¾å§“æ°ä»¥æŸä¸ªå­—æ¯ç»“å°¾çš„äººã€‚</p></blockquote><ul><li>ä¸èƒ½è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—ã€‚</li></ul><blockquote><p>ä¹Ÿå°±æ˜¯è¯´,å‰é¢æ‰€è¿°çš„ç´¢å¼•æ— æ³•ç”¨äºæŸ¥æ‰¾å§“ä¸º Smithå¹¶ä¸”åœ¨æŸä¸ªç‰¹å®šæ—¥æœŸå‡ºç”Ÿçš„äººã€‚å¦‚æœä¸æŒ‡å®šå( first name),åˆ™ MySQLåªèƒ½ä½¿ç”¨ç´¢å¼•çš„ç¬¬ä¸€åˆ—</p></blockquote><ul><li>å¦‚æœæŸ¥è¯¢ä¸­æœ‰æŸä¸ªåˆ—çš„èŒƒå›´æŸ¥è¯¢,åˆ™å…¶å³è¾¹æ‰€æœ‰åˆ—éƒ½æ— æ³•ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥æ‰¾ã€‚</li></ul><blockquote><p>ä¾‹å¦‚æœ‰æŸ¥è¯¢ WHERE Last name=â€™ Smithâ€™ AND first name LIKE â€˜%J%â€™  and birthday=â€™1976-12-23â€™,è¿™ä¸ªæŸ¥è¯¢åªèƒ½ä½¿ç”¨ç´¢å¼•çš„å‰ä¸¤åˆ—,å› ä¸ºè¿™é‡ŒLIKEæ˜¯ä¸€ä¸ªèŒƒå›´æ¡ä»¶(ä½†æ˜¯æœåŠ¡å™¨å¯ä»¥æŠŠå…¶ä½™åˆ—ç”¨äºå…¶ä»–ç›®çš„)ã€‚å¦‚æœèŒƒå›´æŸ¥è¯¢åˆ—å€¼çš„æ•°é‡æœ‰é™,é‚£ä¹ˆå¯ä»¥é€šè¿‡ä½¿ç”¨å¤šä¸ªç­‰äºæ¡ä»¶æ¥ä»£æ›¿èŒƒå›´æ¡ä»¶.</p></blockquote><h1 id="äºŒã€è§†å›¾"><a href="#äºŒã€è§†å›¾" class="headerlink" title="äºŒã€è§†å›¾"></a>äºŒã€è§†å›¾</h1><h2 id="2-1ã€è§†å›¾æ¦‚è¿°"><a href="#2-1ã€è§†å›¾æ¦‚è¿°" class="headerlink" title="2.1ã€è§†å›¾æ¦‚è¿°"></a>2.1ã€è§†å›¾æ¦‚è¿°</h2><blockquote><p><strong>è§†å›¾ï¼ˆViewï¼‰æ˜¯ä¸€ç§è™šæ‹Ÿå­˜åœ¨çš„è¡¨</strong>ã€‚è§†å›¾å¹¶ä¸åœ¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨ï¼Œè¡Œå’Œåˆ—æ•°æ®æ¥è‡ªå®šä¹‰è§†å›¾çš„æŸ¥è¯¢ä¸­ä½¿ç”¨çš„è¡¨ï¼Œå¹¶ä¸”æ˜¯åœ¨ä½¿ç”¨è§†å›¾æ—¶åŠ¨æ€ç”Ÿæˆçš„ã€‚é€šä¿—çš„è®²ï¼Œ<strong>è§†å›¾å°±æ˜¯ä¸€æ¡SELECTè¯­å¥æ‰§è¡Œåè¿”å›çš„ç»“æœé›†ã€‚</strong>æ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºè§†å›¾çš„æ—¶å€™ï¼Œä¸»è¦çš„å·¥ä½œå°±è½åœ¨åˆ›å»ºè¿™æ¡SQLæŸ¥è¯¢è¯­å¥ä¸Šã€‚</p><p>è§†å›¾ç›¸å¯¹äºæ™®é€šçš„è¡¨çš„ä¼˜åŠ¿ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ é¡¹ã€‚</p></blockquote><ul><li><p>ç®€å•ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·å®Œå…¨ä¸éœ€è¦å…³å¿ƒåé¢å¯¹åº”çš„è¡¨çš„ç»“æ„ã€å…³è”æ¡ä»¶å’Œç­›é€‰æ¡ä»¶ï¼Œå¯¹ç”¨æˆ·æ¥è¯´å·²ç»æ˜¯è¿‡æ»¤å¥½çš„å¤åˆæ¡ä»¶çš„ç»“æœé›†ã€‚</p></li><li><p>å®‰å…¨ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·åªèƒ½è®¿é—®ä»–ä»¬è¢«å…è®¸æŸ¥è¯¢çš„ç»“æœé›†ï¼Œå¯¹è¡¨çš„æƒé™ç®¡ç†å¹¶ä¸èƒ½é™åˆ¶åˆ°æŸä¸ªè¡ŒæŸä¸ªåˆ—ï¼Œä½†æ˜¯é€šè¿‡è§†å›¾å°±å¯ä»¥ç®€å•çš„å®ç°ã€‚</p></li><li><p>æ•°æ®ç‹¬ç«‹ï¼šä¸€æ—¦è§†å›¾çš„ç»“æ„ç¡®å®šäº†ï¼Œå¯ä»¥å±è”½è¡¨ç»“æ„å˜åŒ–å¯¹ç”¨æˆ·çš„å½±å“ï¼Œæºè¡¨å¢åŠ åˆ—å¯¹è§†å›¾æ²¡æœ‰å½±å“ï¼›æºè¡¨ä¿®æ”¹åˆ—åï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹è§†å›¾æ¥è§£å†³ï¼Œä¸ä¼šé€ æˆå¯¹è®¿é—®è€…çš„å½±å“ã€‚</p></li></ul><h2 id="2-2ã€åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾"><a href="#2-2ã€åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾" class="headerlink" title="2.2ã€åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾"></a>2.2ã€åˆ›å»ºæˆ–è€…ä¿®æ”¹è§†å›¾</h2><h3 id="1ã€åˆ›å»ºè§†å›¾çš„è¯­æ³•"><a href="#1ã€åˆ›å»ºè§†å›¾çš„è¯­æ³•" class="headerlink" title="1ã€åˆ›å»ºè§†å›¾çš„è¯­æ³•"></a>1ã€åˆ›å»ºè§†å›¾çš„è¯­æ³•</h3><blockquote><p>CREATE [OR REPLACE] [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}] </p><p>VIEW view_name [(column_list)] </p><p>AS select_statement </p><p>[WITH [CASCADED | LOCAL] CHECK OPTION]</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œå±•ç¤ºåŸå¸‚å’Œå›½å®¶çš„ç›¸å…³ä¿¡æ¯</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create view view_country ASSELECT c1.*,</span><br><span class="line">        c2.country_name</span><br><span class="line">FROM city AS c1</span><br><span class="line">JOIN country AS c2</span><br><span class="line">    ON c1.country_id &#x3D; c2.country_id; </span><br></pre></td></tr></table></figure><ul><li>è§†å›¾æ˜¯ä¸€å¼ è™š<strong>è¡¨</strong>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ“ä½œè¡¨çš„è¯­å¥æ¥æ“ä½œè§†å›¾</li><li>æŸ¥è¯¢è¡¨ä¸­æ‰€æœ‰æ•°æ®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from view_country;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306194224.png" alt="image-20210306194217169"></p><h3 id="2ã€é€šè¿‡è§†å›¾æ›´æ–°åŸºè¡¨æ•°æ®"><a href="#2ã€é€šè¿‡è§†å›¾æ›´æ–°åŸºè¡¨æ•°æ®" class="headerlink" title="2ã€é€šè¿‡è§†å›¾æ›´æ–°åŸºè¡¨æ•°æ®"></a>2ã€é€šè¿‡è§†å›¾æ›´æ–°åŸºè¡¨æ•°æ®</h3><blockquote><p>å¦‚æœè§†å›¾åŒ…å«ä¸‹è¿°ç»“æ„ä¸­çš„ä»»ä½•ä¸€ç§ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸å¯æ›´æ–°çš„ï¼š</p></blockquote><ul><li>èšåˆå‡½æ•°ï¼›</li><li>DISTINCTå…³é”®å­—ï¼›</li><li>GROUP BYå­å¥ï¼›</li><li>ORDER BYå­å¥ï¼›</li><li>HAVINGå­å¥ï¼›</li><li>UNIONè¿ç®—ç¬¦ï¼›</li><li>ä½äºé€‰æ‹©åˆ—è¡¨ä¸­çš„å­æŸ¥è¯¢ï¼›</li><li>FROMå­å¥ä¸­åŒ…å«å¤šä¸ªè¡¨ï¼›</li><li>SELECTè¯­å¥ä¸­å¼•ç”¨äº†ä¸å¯æ›´æ–°è§†å›¾ï¼›</li><li>WHEREå­å¥ä¸­çš„å­æŸ¥è¯¢ï¼Œå¼•ç”¨FROMå­å¥ä¸­çš„è¡¨ï¼›</li><li>ALGORITHM é€‰é¡¹æŒ‡å®šä¸ºTEMPTABLEï¼ˆä½¿ç”¨ä¸´æ—¶è¡¨æ€»ä¼šä½¿è§†å›¾æˆä¸ºä¸å¯æ›´æ–°çš„ï¼‰ã€‚</li></ul><blockquote><p><strong>ä¸å»ºè®®æ›´æ–°è§†å›¾ã€‚</strong></p></blockquote><h3 id="3ã€ä¿®æ”¹è§†å›¾çš„è¯­æ³•"><a href="#3ã€ä¿®æ”¹è§†å›¾çš„è¯­æ³•" class="headerlink" title="3ã€ä¿®æ”¹è§†å›¾çš„è¯­æ³•"></a>3ã€ä¿®æ”¹è§†å›¾çš„è¯­æ³•</h3><blockquote><p>ALTER [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]</p><p>VIEW view_name [(column_list)] </p><p>AS select_statement </p><p>[WITH [CASCADED | LOCAL] CHECK OPTION]</p></blockquote><ul><li>ä¿®æ”¹ä¸Šé¢åˆ›å»ºçš„è§†å›¾ï¼Œæ”¹ä¸ºæŸ¥è¯¢cityè¡¨ä¸­çš„<code>city_id</code> å’Œ <code>city_name</code> å­—æ®µ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ALTER VIEW view_country</span><br><span class="line">AS</span><br><span class="line">SELECT city_id, city_name</span><br><span class="line">FROM city;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢ä¿®æ”¹åçš„è§†å›¾</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from view_country;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306195645.png" alt="image-20210306195645056"></p><h3 id="4ã€æŸ¥çœ‹è§†å›¾"><a href="#4ã€æŸ¥çœ‹è§†å›¾" class="headerlink" title="4ã€æŸ¥çœ‹è§†å›¾"></a>4ã€æŸ¥çœ‹è§†å›¾</h3><blockquote><p>ä» MySQL 5.1 ç‰ˆæœ¬å¼€å§‹ï¼Œä½¿ç”¨ SHOW TABLES å‘½ä»¤çš„æ—¶å€™ä¸ä»…æ˜¾ç¤ºè¡¨çš„åå­—ï¼ŒåŒæ—¶ä¹Ÿä¼šæ˜¾ç¤ºè§†å›¾çš„åå­—ï¼Œè€Œä¸å­˜åœ¨å•ç‹¬æ˜¾ç¤ºè§†å›¾çš„ SHOW  VIEWS å‘½ä»¤ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306200016.png" alt="image-20210306200016218"></p><blockquote><p>åŒæ ·ï¼Œåœ¨ä½¿ç”¨ SHOW TABLE STATUS å‘½ä»¤çš„æ—¶å€™ï¼Œä¸ä½†å¯ä»¥æ˜¾ç¤ºè¡¨çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ˜¾ç¤ºè§†å›¾çš„ä¿¡æ¯ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306200047.png" alt="image-20210306200047809"></p><blockquote><p>å¦‚æœéœ€è¦æŸ¥è¯¢æŸä¸ªè§†å›¾çš„å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨ SHOW CREATE VIEW å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306200114.png" alt="image-20210306200114777"></p><ul><li>æŸ¥çœ‹åˆ›å»ºè§†å›¾æ—¶ä½¿ç”¨çš„SQLè¯­å¥</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create view view_country;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœï¼Œåœ¨ç»“æœçš„Create Viewé‚£ä¸€åˆ—ä¸­å¯ä»¥çœ‹åˆ°æ‰§è¡Œçš„sqlè¯­å¥ï¼š</p><p>CREATE ALGORITHM=UNDEFINED DEFINER=<code>root</code>@<code>localhost</code> SQL SECURITY DEFINER VIEW <code>view_country</code> AS select <code>city</code>.<code>city_id</code> AS <code>city_id</code>,<code>city</code>.<code>city_name</code> AS <code>city_name</code> from <code>city</code></p></blockquote><h3 id="5ã€åˆ é™¤è§†å›¾"><a href="#5ã€åˆ é™¤è§†å›¾" class="headerlink" title="5ã€åˆ é™¤è§†å›¾"></a>5ã€åˆ é™¤è§†å›¾</h3><blockquote><p>è¯­æ³•ï¼š</p><p>DROP VIEW [IF EXISTS] view_name [, view_name] â€¦[RESTRICT | CASCADE]</p></blockquote><ul><li>åˆ é™¤è§†å›¾ view_country</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view if exists view_country;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶æ‰§è¡Œshow tablesï¼Œå‘ç°è§†å›¾å·²ç»è¢«åˆ é™¤</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306201859.png" alt="image-20210306201859079"></p><h1 id="ä¸‰ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#ä¸‰ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="ä¸‰ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>ä¸‰ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h1><h2 id="3-1ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°"><a href="#3-1ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°" class="headerlink" title="3.1ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°"></a>3.1ã€å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ¦‚è¿°</h2><blockquote><p>â€‹       å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ˜¯<strong>äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µ SQL è¯­å¥çš„é›†åˆ</strong>ï¼Œè°ƒç”¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°å¯ä»¥ç®€åŒ–åº”ç”¨å¼€å‘äººå‘˜çš„å¾ˆå¤šå·¥ä½œï¼Œå‡å°‘æ•°æ®åœ¨æ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“ï¼Œå¯¹äºæé«˜æ•°æ®å¤„ç†çš„æ•ˆç‡æ˜¯æœ‰å¥½å¤„çš„ã€‚</p><p>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„åŒºåˆ«åœ¨äºå‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹æ²¡æœ‰ã€‚</p></blockquote><ul><li><p>å‡½æ•° ï¼š æ˜¯ä¸€ä¸ªæœ‰è¿”å›å€¼çš„å­˜å‚¨è¿‡ç¨‹ ï¼›</p></li><li><p>å­˜å‚¨è¿‡ç¨‹ ï¼š æ˜¯ä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•° ï¼›</p></li></ul><h2 id="3-2ã€åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"><a href="#3-2ã€åˆ›å»ºå­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3.2ã€åˆ›å»ºå­˜å‚¨è¿‡ç¨‹"></a>3.2ã€åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</h2><blockquote><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><p>CREATE PROCEDURE procedure_name ([proc_parameter[,â€¦]])</p><p>begin</p><p>â€“ SQLè¯­å¥</p><p>end ;</p></blockquote><ul><li>ç¤ºä¾‹</li></ul><blockquote><p>è¿™é‡Œéœ€è¦å…ˆæŒ‡å®šåˆ†éš”ç¬¦ï¼Œå°†åˆ†éš”ç¬¦å®šä¹‰ä¸º â€œ$â€</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure myprodure ()</span><br><span class="line">begin</span><br><span class="line">    select &#39;èŠœæ¹–èµ·é£&#39;;</span><br><span class="line">end$</span><br></pre></td></tr></table></figure><h2 id="3-3ã€è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"><a href="#3-3ã€è°ƒç”¨å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3.3ã€è°ƒç”¨å­˜å‚¨è¿‡ç¨‹"></a>3.3ã€è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</h2><blockquote><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><p>call å­˜å‚¨è¿‡ç¨‹å() å®šä¹‰çš„åˆ†éš”ç¬¦</p></blockquote><ul><li>è°ƒç”¨ä¸Šé¢å®šä¹‰çš„å­˜å‚¨è¿‡ç¨‹myprodure</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">call myprodure()$</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306205245.png" alt="image-20210306205245227"></p><h2 id="3-4ã€æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹"><a href="#3-4ã€æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3.4ã€æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹"></a>3.4ã€æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹</h2><blockquote><p>â€“ æŸ¥è¯¢db_nameæ•°æ®åº“ä¸­çš„æ‰€æœ‰çš„å­˜å‚¨è¿‡ç¨‹</p><p>select name from mysql.proc where db=â€™db_nameâ€™; </p><p>â€“ æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹çš„çŠ¶æ€ä¿¡æ¯</p><p>show procedure status; </p><p>â€“ æŸ¥è¯¢æŸä¸ªå­˜å‚¨è¿‡ç¨‹çš„å®šä¹‰</p><p>show create procedure test.pro_test1 \G;</p></blockquote><ul><li>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çš„çŠ¶æ€</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show procedure status;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306221935.png" alt="image-20210306221934288"></p><ul><li>æŸ¥çœ‹<code>myprocedure</code>å­˜å‚¨è¿‡ç¨‹çš„å®šä¹‰</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create procedure myprodure;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306222219.png" alt="image-20210306222219461"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE DEFINER&#x3D;&#96;root&#96;@&#96;localhost&#96; PROCEDURE &#96;myprodure&#96;()</span><br><span class="line">begin</span><br><span class="line">    select &#39;èŠœæ¹–èµ·é£&#39;;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><ul><li>å’Œè§†å›¾ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨æ•°æ®åº“å¯è§†åŒ–å·¥å…·æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹ï¼Œè¿™é‡Œä½¿ç”¨çš„æ•°æ®åº“å¯è§†åŒ–å·¥å…·æ˜¯ <code>DataGrip</code></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306222533.png" alt="image-20210306222533214"></p><h2 id="3-5ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹"><a href="#3-5ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="3.5ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹"></a>3.5ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹</h2><blockquote><p>DROP PROCEDURE [IF EXISTS] å­˜å‚¨è¿‡ç¨‹åå­— ï¼›</p></blockquote><ul><li>åˆ é™¤ä¸Šé¢åˆ›å»ºçš„å­˜å‚¨è¿‡ç¨‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure if exists index_study.myprodure;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306224444.png" alt="image-20210306224444718"></p><h2 id="3-6ã€å­˜å‚¨è¿‡ç¨‹ä¼ é€’å‚æ•°"><a href="#3-6ã€å­˜å‚¨è¿‡ç¨‹ä¼ é€’å‚æ•°" class="headerlink" title="3.6ã€å­˜å‚¨è¿‡ç¨‹ä¼ é€’å‚æ•°"></a>3.6ã€å­˜å‚¨è¿‡ç¨‹ä¼ é€’å‚æ•°</h2><h3 id="1ã€è¯­æ³•ç»“æ„"><a href="#1ã€è¯­æ³•ç»“æ„" class="headerlink" title="1ã€è¯­æ³•ç»“æ„"></a>1ã€è¯­æ³•ç»“æ„</h3><blockquote><p>create procedure procedure_name([in/out/inout] å‚æ•°å  å‚æ•°ç±»å‹</p><p>â€¦</p><p>IN :    è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å…¥ï¼Œä¹Ÿå°±æ˜¯éœ€è¦è°ƒç”¨æ–¹ä¼ å…¥å€¼ , é»˜è®¤</p><p>OUT:    è¯¥å‚æ•°ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼</p><p>INOUT: æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¾“å‡ºå‚æ•°</p></blockquote><h3 id="2ã€ç¤ºä¾‹"><a href="#2ã€ç¤ºä¾‹" class="headerlink" title="2ã€ç¤ºä¾‹"></a>2ã€ç¤ºä¾‹</h3><ul><li>æ ¹æ®ä¼ å…¥çš„èº«é«˜å˜é‡ï¼Œè·å–å½“å‰èº«é«˜çš„æ‰€å±çš„èº«æç±»å‹</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line">create procedure myprocedure(in height int,out &#96;desc&#96; varchar(100))</span><br><span class="line">begin</span><br><span class="line">    if height &gt;&#x3D; 180 then</span><br><span class="line">        set &#96;desc&#96; &#x3D; &#39;èº«æé«˜æŒ‘&#39;;</span><br><span class="line">    elseif height &gt;&#x3D; 170 and height &lt; 180 then</span><br><span class="line">        set &#96;desc&#96; &#x3D; &#39;èº«ææ ‡å‡†&#39;;</span><br><span class="line">    else</span><br><span class="line">        set &#96;desc&#96; &#x3D; &#39;èº«æä¸€èˆ¬&#39;;</span><br><span class="line">    end if;</span><br><span class="line">end$</span><br></pre></td></tr></table></figure><blockquote><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call myprocedure(175,@desc);</span><br><span class="line">select @&#96;desc&#96;;</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306232054.png" alt="image-20210306232047574"></p><blockquote><p>@description : è¿™ç§å˜é‡è¦åœ¨å˜é‡åç§°å‰é¢åŠ ä¸Šâ€œ@â€ç¬¦å·ï¼Œå«åšç”¨æˆ·ä¼šè¯å˜é‡ï¼Œä»£è¡¨æ•´ä¸ªä¼šè¯è¿‡ç¨‹ä»–éƒ½æ˜¯æœ‰ä½œç”¨çš„ï¼Œè¿™ä¸ªç±»ä¼¼äºå…¨å±€å˜é‡ä¸€æ ·ã€‚</p><p>@@global.sort_buï¬€er_size : è¿™ç§åœ¨å˜é‡å‰åŠ ä¸Š â€œ@@â€ ç¬¦å·, å«åš ç³»ç»Ÿå˜é‡</p></blockquote><h2 id="3-7ã€å­˜å‚¨å‡½æ•°"><a href="#3-7ã€å­˜å‚¨å‡½æ•°" class="headerlink" title="3.7ã€å­˜å‚¨å‡½æ•°"></a>3.7ã€å­˜å‚¨å‡½æ•°</h2><h3 id="1ã€è¯­æ³•ç»“æ„-1"><a href="#1ã€è¯­æ³•ç»“æ„-1" class="headerlink" title="1ã€è¯­æ³•ç»“æ„"></a>1ã€è¯­æ³•ç»“æ„</h3><blockquote><p>CREATE FUNCTION function_name([param type â€¦ ])</p><p>RETURNS type</p><p>BEGIN    </p><p>â€¦</p><p>END;</p></blockquote><h3 id="2ã€ç¤ºä¾‹-1"><a href="#2ã€ç¤ºä¾‹-1" class="headerlink" title="2ã€ç¤ºä¾‹"></a>2ã€ç¤ºä¾‹</h3><ul><li>å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè·å–æ»¡è¶³æ¡ä»¶ï¼ˆcityï¼‰çš„æ€»è®°å½•æ•°</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create function fun1(countryId int)</span><br><span class="line">returns int</span><br><span class="line">begin</span><br><span class="line">    declare cnum int;</span><br><span class="line">    select count(*) into cnum from city where country_id &#x3D; countryId;</span><br><span class="line">    return cnum;</span><br><span class="line">end$</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºå‡½æ•°æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code>select</code> è¾“å‡ºç»“æœ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select fun1(1)$</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœä¸ºï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210306234131.png" alt="image-20210306234131066"></p><h1 id="å››ã€è§¦å‘å™¨"><a href="#å››ã€è§¦å‘å™¨" class="headerlink" title="å››ã€è§¦å‘å™¨"></a>å››ã€è§¦å‘å™¨</h1><h2 id="4-1ã€ä»‹ç»"><a href="#4-1ã€ä»‹ç»" class="headerlink" title="4.1ã€ä»‹ç»"></a>4.1ã€ä»‹ç»</h2><blockquote><p>è§¦å‘å™¨æ˜¯ä¸è¡¨æœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼Œ<strong>æŒ‡åœ¨ insert/update/delete ä¹‹å‰æˆ–ä¹‹åï¼Œè§¦å‘å¹¶æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„SQLè¯­å¥é›†åˆã€‚</strong>è§¦å‘å™¨çš„è¿™ç§ç‰¹æ€§å¯ä»¥ååŠ©åº”ç”¨åœ¨æ•°æ®åº“ç«¯ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ , æ—¥å¿—è®°å½• , æ•°æ®æ ¡éªŒç­‰æ“ä½œ ã€‚</p><p>ä½¿ç”¨åˆ«å OLD å’Œ NEW æ¥å¼•ç”¨è§¦å‘å™¨ä¸­å‘ç”Ÿå˜åŒ–çš„è®°å½•å†…å®¹ï¼Œè¿™ä¸å…¶ä»–çš„æ•°æ®åº“æ˜¯ç›¸ä¼¼çš„ã€‚ç°åœ¨è§¦å‘å™¨è¿˜åªæ”¯æŒè¡Œçº§è§¦å‘ï¼Œä¸æ”¯æŒè¯­å¥çº§è§¦å‘ã€‚</p></blockquote><table><thead><tr><th><strong>è§¦å‘å™¨ç±»å‹</strong></th><th>NEWå’ŒOLDçš„ä½¿ç”¨</th></tr></thead><tbody><tr><td>INSERT å‹è§¦å‘å™¨</td><td>NEW  è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»æ–°å¢çš„æ•°æ®</td></tr><tr><td>UPDATE å‹è§¦å‘å™¨</td><td>OLD è¡¨ç¤ºä¿®æ”¹ä¹‹å‰çš„æ•°æ® , NEW è¡¨ç¤ºå°†è¦æˆ–å·²ç»ä¿®æ”¹åçš„æ•°æ®</td></tr><tr><td>DELETE å‹è§¦å‘å™¨</td><td>OLD  è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»åˆ é™¤çš„æ•°æ®</td></tr></tbody></table><h2 id="4-2ã€åˆ›å»ºè§¦å‘å™¨"><a href="#4-2ã€åˆ›å»ºè§¦å‘å™¨" class="headerlink" title="4.2ã€åˆ›å»ºè§¦å‘å™¨"></a>4.2ã€åˆ›å»ºè§¦å‘å™¨</h2><h3 id="1ã€è¯­æ³•ç»“æ„ï¼š"><a href="#1ã€è¯­æ³•ç»“æ„ï¼š" class="headerlink" title="1ã€è¯­æ³•ç»“æ„ï¼š"></a>1ã€è¯­æ³•ç»“æ„ï¼š</h3><blockquote><p>create  trigger  trigger_name</p><p>before/after  insert/update/delete</p><p>on tbl_name</p><p>[ for each row ]    â€“ è¡Œçº§è§¦å‘å™¨</p><p>begin</p><p>â€‹    è¦æ‰§è¡Œçš„è¯­å¥</p><p>end;</p></blockquote><h3 id="2ã€ç¤ºä¾‹-2"><a href="#2ã€ç¤ºä¾‹-2" class="headerlink" title="2ã€ç¤ºä¾‹"></a>2ã€ç¤ºä¾‹</h3><blockquote><p>éœ€æ±‚ï¼šé€šè¿‡è§¦å‘å™¨è®°å½• <code>emp</code> è¡¨çš„æ•°æ®å˜æ›´æ—¥å¿— <code>emp_logs</code>ï¼ŒåŒ…æ‹¬å¢åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤</p></blockquote><h3 id="3ã€å‡†å¤‡empè„šæœ¬"><a href="#3ã€å‡†å¤‡empè„šæœ¬" class="headerlink" title="3ã€å‡†å¤‡empè„šæœ¬"></a>3ã€å‡†å¤‡<code>emp</code>è„šæœ¬</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">create table emp</span><br><span class="line">(</span><br><span class="line">    id     int(11)     not null auto_increment,</span><br><span class="line">    name   varchar(50) not null comment &#39;å§“å&#39;,</span><br><span class="line">    age    int(11) comment &#39;å¹´é¾„&#39;,</span><br><span class="line">    salary int(11) comment &#39;è–ªæ°´&#39;,</span><br><span class="line">    primary key (&#96;id&#96;)</span><br><span class="line">) engine &#x3D; innodb</span><br><span class="line">  default charset &#x3D; utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into emp(id, name, age, salary)</span><br><span class="line">values (null, &#39;é‡‘æ¯›ç‹®ç‹&#39;, 55, 3800),</span><br><span class="line">       (null, &#39;ç™½çœ‰é¹°ç‹&#39;, 60, 4000),</span><br><span class="line">       (null, &#39;é’ç¿¼è ç‹&#39;, 38, 2800),</span><br><span class="line">       (null, &#39;ç´«è¡«é¾™ç‹&#39;, 42, 1800);</span><br></pre></td></tr></table></figure><h3 id="4ã€åˆ›å»ºä¸€å¼ æ—¥å¿—è¡¨"><a href="#4ã€åˆ›å»ºä¸€å¼ æ—¥å¿—è¡¨" class="headerlink" title="4ã€åˆ›å»ºä¸€å¼ æ—¥å¿—è¡¨"></a>4ã€åˆ›å»ºä¸€å¼ æ—¥å¿—è¡¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create table emp_logs</span><br><span class="line">(</span><br><span class="line">    id             int(11)     not null auto_increment,</span><br><span class="line">    operation      varchar(20) not null comment &#39;æ“ä½œç±»å‹, insert&#x2F;update&#x2F;delete&#39;,</span><br><span class="line">    operate_time   datetime    not null comment &#39;æ“ä½œæ—¶é—´&#39;,</span><br><span class="line">    operate_id     int(11)     not null comment &#39;æ“ä½œè¡¨çš„ID&#39;,</span><br><span class="line">    operate_params varchar(500) comment &#39;æ“ä½œå‚æ•°&#39;,</span><br><span class="line">    primary key (&#96;id&#96;)</span><br><span class="line">) engine &#x3D; innodb</span><br><span class="line">  default charset &#x3D; utf8;</span><br></pre></td></tr></table></figure><h3 id="5ã€åˆ›å»º-insert-è§¦å‘å™¨"><a href="#5ã€åˆ›å»º-insert-è§¦å‘å™¨" class="headerlink" title="5ã€åˆ›å»º insert è§¦å‘å™¨"></a>5ã€åˆ›å»º <code>insert</code> è§¦å‘å™¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create trigger emp_logs_insert_trigger</span><br><span class="line">    after insert</span><br><span class="line">    on &#96;emp&#96;</span><br><span class="line">    for each row</span><br><span class="line">begin</span><br><span class="line">    insert into emp_logs (id, operation, operate_time, operate_id, operate_params)</span><br><span class="line">    values (null, &#39;insert&#39;, now(), new.id,</span><br><span class="line">            concat(&#39;æ’å…¥å(id:&#39;, new.id, &#39;, name:&#39;, new.name, &#39;, age:&#39;, new.age, &#39;,  salary:&#39;, new.salary, &#39;)&#39;));</span><br><span class="line">end$</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•è§¦å‘å™¨ï¼Œæ‰§è¡Œä¸€æ¡ <code>insert</code> è¯­å¥</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into emp(id,name,age,salary) values(null, &#39;å…‰æ˜å³ä½¿&#39;,33,3200); </span><br></pre></td></tr></table></figure><ul><li>ç°åœ¨æŸ¥çœ‹ <code>emp_logs</code> è¡¨ï¼Œå‘ç°æœ‰äº†ä¸€æ¡è®°å½•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307003100.png" alt="image-20210307003100615"></p><h3 id="6ã€åˆ›å»º-update-è§¦å‘å™¨"><a href="#6ã€åˆ›å»º-update-è§¦å‘å™¨" class="headerlink" title="6ã€åˆ›å»º update è§¦å‘å™¨"></a>6ã€åˆ›å»º <code>update</code> è§¦å‘å™¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">create trigger emp_logs_update_trigger</span><br><span class="line">    after update</span><br><span class="line">    on &#96;emp&#96;</span><br><span class="line">    for each row</span><br><span class="line">begin</span><br><span class="line">    insert into emp_logs (id, operation, operate_time, operate_id, operate_params)</span><br><span class="line">    values (null, &#39;update&#39;, now(), new.id,</span><br><span class="line">            concat(&#39;æ›´æ–°å‰(id:&#39;, OLD.id,</span><br><span class="line">                        &#39;, name:&#39;, OLD.name,</span><br><span class="line">                        &#39;, age:&#39;, OLD.age,</span><br><span class="line">                        &#39;,  salary:&#39;, OLD.salary, &#39;),&#39;</span><br><span class="line">                   &#39;æ›´æ–°å(id:&#39;, NEW.id,</span><br><span class="line">                        &#39;, name:&#39;, NEW.name,</span><br><span class="line">                        &#39;, age:&#39;, NEW.age,</span><br><span class="line">                        &#39;,  salary:&#39;, NEW.salary, &#39;)&#39;</span><br><span class="line">                ));</span><br><span class="line">end$</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•è§¦å‘å™¨ï¼Œæ›´æ–°ä¸€æ¡æ•°æ®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update emp set age &#x3D; 39 where id &#x3D; 3;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ <code>emp_logs</code> è¡¨</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307004444.png" alt="image-20210307004443553"></p><blockquote><p>emp_logsè¡¨ä¸­operate_paramsè®°å½•å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307004554.png" alt="image-20210307004554610"></p><h3 id="7ã€åˆ›å»ºåˆ é™¤è§¦å‘å™¨"><a href="#7ã€åˆ›å»ºåˆ é™¤è§¦å‘å™¨" class="headerlink" title="7ã€åˆ›å»ºåˆ é™¤è§¦å‘å™¨"></a>7ã€åˆ›å»ºåˆ é™¤è§¦å‘å™¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create trigger emp_logs_delete_trigger</span><br><span class="line">    after delete</span><br><span class="line">    on &#96;emp&#96;</span><br><span class="line">    for each row</span><br><span class="line">begin</span><br><span class="line">    insert into emp_logs (id, operation, operate_time, operate_id, operate_params)</span><br><span class="line">    values (null, &#39;delete&#39;, now(), OLD.id,</span><br><span class="line">            concat(&#39;åˆ é™¤å‰(id:&#39;, OLD.id,</span><br><span class="line">                        &#39;, name:&#39;, OLD.name,</span><br><span class="line">                        &#39;, age:&#39;, OLD.age,</span><br><span class="line">                        &#39;,  salary:&#39;, OLD.salary, &#39;)&#39;</span><br><span class="line">                ));</span><br><span class="line">end$</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•è§¦å‘å™¨ï¼Œåˆ é™¤ä¸€æ¡æ•°æ®</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from emp where id &#x3D; 3;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ <code>emp_logs</code> è¡¨</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210307005623.png" alt="image-20210307005623544"></p><h2 id="4-3ã€æŸ¥çœ‹è§¦å‘å™¨"><a href="#4-3ã€æŸ¥çœ‹è§¦å‘å™¨" class="headerlink" title="4.3ã€æŸ¥çœ‹è§¦å‘å™¨"></a>4.3ã€æŸ¥çœ‹è§¦å‘å™¨</h2><blockquote><p>å¯ä»¥é€šè¿‡æ‰§è¡Œ <code>SHOW TRIGGERS</code> å‘½ä»¤æ¥æŸ¥çœ‹è§¦å‘å™¨çš„çŠ¶æ€ã€è¯­æ³•ç­‰ä¿¡æ¯ã€‚</p></blockquote><h3 id="1ã€è¯­æ³•ç»“æ„-2"><a href="#1ã€è¯­æ³•ç»“æ„-2" class="headerlink" title="1ã€è¯­æ³•ç»“æ„"></a>1ã€è¯­æ³•ç»“æ„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show triggers;</span><br></pre></td></tr></table></figure><h3 id="2ã€ç¤ºä¾‹-3"><a href="#2ã€ç¤ºä¾‹-3" class="headerlink" title="2ã€ç¤ºä¾‹"></a>2ã€ç¤ºä¾‹</h3><blockquote><p>æŸ¥çœ‹ä¸Šé¢åˆ›å»ºçš„è§¦å‘å™¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210315215150.png" alt="image-20210315215150402"></p><blockquote><p>åœ¨<code>Statement</code>ä¸­å°è£…äº†å®šä¹‰è¯­å¥ï¼Œè¿™é‡Œä»¥æ’å…¥è§¦å‘å™¨ä¸ºä¾‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">begin</span><br><span class="line">    insert into emp_logs (id, operation, operate_time, operate_id, operate_params)</span><br><span class="line">    values (null, &#39;insert&#39;, now(), new.id,</span><br><span class="line">            concat(&#39;æ’å…¥å(id:&#39;, new.id, &#39;, name:&#39;, new.name, &#39;, age:&#39;, new.age, &#39;,  salary:&#39;, new.salary, &#39;)&#39;));</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h2 id="4-4ã€åˆ é™¤è§¦å‘å™¨"><a href="#4-4ã€åˆ é™¤è§¦å‘å™¨" class="headerlink" title="4.4ã€åˆ é™¤è§¦å‘å™¨"></a>4.4ã€åˆ é™¤è§¦å‘å™¨</h2><h3 id="1ã€è¯­æ³•"><a href="#1ã€è¯­æ³•" class="headerlink" title="1ã€è¯­æ³•"></a>1ã€è¯­æ³•</h3><blockquote><p>drop trigger [æ•°æ®åº“å.]è§¦å‘å™¨å</p><p>å¦‚æœä¸æŒ‡å®šæ•°æ®åº“åï¼Œé‚£ä¹ˆé»˜è®¤åˆ é™¤å½“å‰è¡¨çš„è§¦å‘å™¨ã€‚</p></blockquote><h3 id="2ã€ç¤ºä¾‹-4"><a href="#2ã€ç¤ºä¾‹-4" class="headerlink" title="2ã€ç¤ºä¾‹"></a>2ã€ç¤ºä¾‹</h3><blockquote><p>åˆ é™¤<code>emp</code>è¡¨ä¸­çš„<code>insert</code>è§¦å‘å™¨</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop trigger index_study.emp_logs_insert_trigger;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å†æ¬¡ä½¿ç”¨ <strong>show triggers</strong> æŸ¥çœ‹è§¦å‘å™¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210315215134.png" alt="image-20210315215134287"></p><blockquote><p>ç¬”è®°ä¸»è¦å‚è€ƒæ¥æºå¦‚ä¸‹ï¼š</p></blockquote><ul><li>[1]  <a href="https://www.bilibili.com/video/BV1UQ4y1P7Xr">é»‘é©¬ç¨‹åºå‘˜-MySQLé«˜çº§</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> MySQLé«˜çº§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ğŸ¤“æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆä¸ƒï¼‰-ConcurrentHashMapæºç è§£è¯»</title>
      <link href="posts/2912697261.html"/>
      <url>posts/2912697261.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€JDK8ConcurrentHashMapåˆå§‹åŒ–"><a href="#ä¸€ã€JDK8ConcurrentHashMapåˆå§‹åŒ–" class="headerlink" title="ä¸€ã€JDK8ConcurrentHashMapåˆå§‹åŒ–"></a>ä¸€ã€JDK8ConcurrentHashMapåˆå§‹åŒ–</h1><h2 id="1-1ã€æºç åˆ†æ"><a href="#1-1ã€æºç åˆ†æ" class="headerlink" title="1.1ã€æºç åˆ†æ"></a>1.1ã€æºç åˆ†æ</h2><blockquote><p>åœ¨ <strong>JDK8</strong> çš„ ConcurrentHashMap ä¸­ä¸€ä¸ªæœ‰äº”ä¸ªæ„é€ æ–¹æ³•ï¼Œå’Œ JDK8 çš„ HashMap ä¸€æ ·ï¼Œè¿™äº”ä¸ªæ„é€ æ–¹æ³•ä¸­éƒ½æ²¡æœ‰å¯¹ Map å†…éƒ¨çš„ <strong>Node</strong> æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œåªæ˜¯å¯¹ä¸€äº›å˜é‡çš„åˆå§‹å€¼åšäº†å¤„ç†ã€‚</p><p><strong>JDK8 çš„ ConcurrentHashMap çš„ Node æ•°ç»„åˆå§‹åŒ–æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶å®Œæˆçš„ã€‚</strong></p></blockquote><h3 id="1ã€æ— å‚æ„é€ å‡½æ•°"><a href="#1ã€æ— å‚æ„é€ å‡½æ•°" class="headerlink" title="1ã€æ— å‚æ„é€ å‡½æ•°"></a>1ã€æ— å‚æ„é€ å‡½æ•°</h3><blockquote><p>åˆ›å»ºä¸€ä¸ª<strong>æ–°</strong>çš„ã€<strong>ç©º</strong>çš„ï¼Œ<strong>æ•°ç»„é•¿åº¦ä¸ºåˆå§‹åŒ–é•¿åº¦ï¼ˆ16ï¼‰</strong>çš„ConcurrentHashMapå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new, empty map with the default initial table size (16).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ConcurrentHashMapçš„æ•°ç»„é»˜è®¤åˆå§‹åŒ–é•¿åº¦ä¸º <code>16</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The default initial table capacity.  Must be a power of 2</span></span><br><span class="line"><span class="comment"> * (i.e., at least 1) and at most MAXIMUM_CAPACITY.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">16</span>;</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¼ å…¥åˆå§‹å®¹é‡çš„æ„é€ å‡½æ•°"><a href="#2ã€ä¼ å…¥åˆå§‹å®¹é‡çš„æ„é€ å‡½æ•°" class="headerlink" title="2ã€ä¼ å…¥åˆå§‹å®¹é‡çš„æ„é€ å‡½æ•°"></a>2ã€ä¼ å…¥åˆå§‹å®¹é‡çš„æ„é€ å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new, empty map with an initial table size</span></span><br><span class="line"><span class="comment"> * accommodating the specified number of elements without the need</span></span><br><span class="line"><span class="comment"> * to dynamically resize.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialCapacity The implementation performs internal</span></span><br><span class="line"><span class="comment"> * sizing to accommodate this many elements.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity of</span></span><br><span class="line"><span class="comment"> * elements is negative</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">int</span> cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="number">1</span>)) ?</span><br><span class="line">               MAXIMUM_CAPACITY :</span><br><span class="line">               tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; <span class="number">1</span>) + <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">this</span>.sizeCtl = cap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>ConcurrentHashMap</strong> ä¼šåŸºäºä¼ å…¥çš„ <code>initialCapacity</code> è®¡ç®—ä¸€ä¸ª<strong>æ¯”è¿™ä¸ªå€¼å¤§ä¸”ä¸º2çš„å¹‚æ¬¡æ–¹çš„æ•´æ•°</strong>ä½œä¸º ConcurrentHashMap çš„<strong>åˆå§‹å®¹é‡</strong>ã€‚</p><p>å’Œ <strong>HashMap</strong> ä¸€æ ·ï¼Œè¿™ä¸ªåŠŸèƒ½ç”± <code>tableSizeFor</code> æ–¹æ³•å®Œæˆ</p><p>ä½†åœ¨ConcurrentHashMapä¸­ï¼Œå³ä½¿ä¼ å…¥çš„åˆå§‹å®¹é‡ <code>initialCapacity</code> ä¸º2çš„å¹‚æ¬¡æ–¹ï¼Œåœ¨ç»è¿‡ <code>tableSizeFor</code> æ–¹æ³•åä¹Ÿä¼šè¿”å›ä¸€ä¸ªæ¯” <code>initialCapacity</code> å¤§çš„ä¸”ä¸º2çš„å¹‚æ¬¡æ–¹çš„å€¼ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210304220258.png" alt="image-20210304220256402"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a power of two table size for the given desired capacity.</span></span><br><span class="line"><span class="comment"> * See Hackers Delight, sec 3.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = c - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç±»æ¯”ä¸Šé¢çš„ <code>tableSizeFor</code> æ–¹æ³•å’Œ  <strong>æ„é€ æ–¹æ³•</strong> è¿›è¡Œæµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcurrentHashMapStudy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(getCapacity(<span class="number">32</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getCapacity</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tableSizeFor(n + (n &gt;&gt;&gt; <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = c - <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210304221040.png" alt="image-20210304221040912"></p><h3 id="3ã€å«æœ‰ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•"><a href="#3ã€å«æœ‰ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•" class="headerlink" title="3ã€å«æœ‰ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•"></a>3ã€å«æœ‰ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•</h3><blockquote><p>è¿™ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼š<code>initialCapacity</code> ï¼ˆåˆå§‹å®¹é‡ï¼‰ã€ <code>loadFactor</code> ï¼ˆè´Ÿè½½å› å­ï¼‰ å’Œ <code>concurrencyLevel</code> </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new, empty map with an initial table size based on</span></span><br><span class="line"><span class="comment"> * the given number of elements (&#123;<span class="doctag">@code</span> initialCapacity&#125;), table</span></span><br><span class="line"><span class="comment"> * density (&#123;<span class="doctag">@code</span> loadFactor&#125;), and number of concurrently</span></span><br><span class="line"><span class="comment"> * updating threads (&#123;<span class="doctag">@code</span> concurrencyLevel&#125;).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialCapacity the initial capacity. The implementation</span></span><br><span class="line"><span class="comment"> * performs internal sizing to accommodate this many elements,</span></span><br><span class="line"><span class="comment"> * given the specified load factor.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> loadFactor the load factor (table density) for</span></span><br><span class="line"><span class="comment"> * establishing the initial table size</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> concurrencyLevel the estimated number of concurrently</span></span><br><span class="line"><span class="comment"> * updating threads. The implementation may use this value as</span></span><br><span class="line"><span class="comment"> * a sizing hint.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is</span></span><br><span class="line"><span class="comment"> * negative or the load factor or concurrencyLevel are</span></span><br><span class="line"><span class="comment"> * nonpositive</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">float</span> loadFactor, <span class="keyword">int</span> concurrencyLevel)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(loadFactor &gt; <span class="number">0.0f</span>) || initialCapacity &lt; <span class="number">0</span> || concurrencyLevel &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; concurrencyLevel)   <span class="comment">// Use at least as many bins</span></span><br><span class="line">        initialCapacity = concurrencyLevel;   <span class="comment">// as estimated threads</span></span><br><span class="line">    <span class="keyword">long</span> size = (<span class="keyword">long</span>)(<span class="number">1.0</span> + (<span class="keyword">long</span>)initialCapacity / loadFactor);</span><br><span class="line">    <span class="keyword">int</span> cap = (size &gt;= (<span class="keyword">long</span>)MAXIMUM_CAPACITY) ?</span><br><span class="line">        MAXIMUM_CAPACITY : tableSizeFor((<span class="keyword">int</span>)size);</span><br><span class="line">    <span class="keyword">this</span>.sizeCtl = cap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å«æœ‰ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°å®é™…ä¸Šè°ƒç”¨äº†æ­¤æ„é€ å‡½æ•°ï¼Œä¸” concurrencyLevel ä¸º1</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(initialCapacity, loadFactor, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ä¼ å…¥ä¸€ä¸ªMapçš„æ„é€ å‡½æ•°"><a href="#4ã€ä¼ å…¥ä¸€ä¸ªMapçš„æ„é€ å‡½æ•°" class="headerlink" title="4ã€ä¼ å…¥ä¸€ä¸ªMapçš„æ„é€ å‡½æ•°"></a>4ã€ä¼ å…¥ä¸€ä¸ªMapçš„æ„é€ å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentHashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.sizeCtl = DEFAULT_CAPACITY;</span><br><span class="line">    putAll(m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-2ã€-sizeCtl-å«ä¹‰è§£é‡Š"><a href="#1-2ã€-sizeCtl-å«ä¹‰è§£é‡Š" class="headerlink" title="1.2ã€ sizeCtl å«ä¹‰è§£é‡Š"></a>1.2ã€ sizeCtl å«ä¹‰è§£é‡Š</h2><blockquote><p><strong>æ³¨æ„ï¼šä»¥ä¸Šè¿™äº›æ„é€ æ–¹æ³•ä¸­ï¼Œéƒ½æ¶‰åŠåˆ°ä¸€ä¸ªå˜é‡ <code>sizeCtl</code> ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å˜é‡ï¼Œè€Œä¸”å…·æœ‰éå¸¸ä¸°å¯Œçš„å«ä¹‰ï¼Œå®ƒçš„å€¼ä¸åŒï¼Œå¯¹åº”çš„å«ä¹‰ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå¯¹è¿™ä¸ªå˜é‡ä¸åŒçš„å€¼çš„å«ä¹‰åšä¸€ä¸‹è¯´æ˜ï¼Œåç»­æºç åˆ†æè¿‡ç¨‹ä¸­ï¼Œè¿›ä¸€æ­¥è§£é‡Š</strong></p><p><code>sizeCtl</code>ä¸º0ï¼Œä»£è¡¨æ•°ç»„æœªåˆå§‹åŒ–ï¼Œ ä¸”æ•°ç»„çš„åˆå§‹å®¹é‡ä¸º16</p><p><code>sizeCtl</code>ä¸ºæ­£æ•°ï¼Œå¦‚æœæ•°ç»„æœªåˆå§‹åŒ–ï¼Œé‚£ä¹ˆå…¶è®°å½•çš„æ˜¯æ•°ç»„çš„åˆå§‹å®¹é‡ï¼Œå¦‚æœæ•°ç»„å·²ç»åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå…¶è®°å½•çš„æ˜¯æ•°ç»„çš„æ‰©å®¹é˜ˆå€¼</p><p><code>sizeCtl</code>ä¸º-1ï¼Œè¡¨ç¤ºæ•°ç»„æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–</p><p><code>sizeCtl</code>å°äº0ï¼Œå¹¶ä¸”ä¸æ˜¯-1ï¼Œè¡¨ç¤ºæ•°ç»„æ­£åœ¨æ‰©å®¹ï¼Œ -(1+n)ï¼Œè¡¨ç¤ºæ­¤æ—¶æœ‰nä¸ªçº¿ç¨‹æ­£åœ¨å…±åŒå®Œæˆæ•°ç»„çš„æ‰©å®¹æ“ä½œ</p></blockquote><ul><li><code>sizeCtl</code>æ˜¯ä¸€ä¸ªè¢« <strong>volatile</strong> ä¿®é¥°çš„å˜é‡ï¼Œä¿è¯å…¶å¯è§æ€§</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> sizeCtl;</span><br></pre></td></tr></table></figure><h1 id="äºŒã€JDK8æ·»åŠ å®‰å…¨"><a href="#äºŒã€JDK8æ·»åŠ å®‰å…¨" class="headerlink" title="äºŒã€JDK8æ·»åŠ å®‰å…¨"></a>äºŒã€JDK8æ·»åŠ å®‰å…¨</h1><h2 id="2-1ã€putæ–¹æ³•å’ŒputValæ–¹æ³•"><a href="#2-1ã€putæ–¹æ³•å’ŒputValæ–¹æ³•" class="headerlink" title="2.1ã€putæ–¹æ³•å’ŒputValæ–¹æ³•"></a>2.1ã€putæ–¹æ³•å’ŒputValæ–¹æ³•</h2><blockquote><p>å’ŒHashMapä¸€æ ·ï¼ŒConcurrentHashMapåº•å±‚åŒæ ·è°ƒç”¨äº†putValæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(key, value, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœæœ‰ç©ºå€¼æˆ–è€…ç©ºé”®ï¼Œç›´æ¥æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="comment">//åŸºäºkeyè®¡ç®—hashå€¼ï¼Œå¹¶è¿›è¡Œä¸€å®šçš„æ‰°åŠ¨</span></span><br><span class="line">    <span class="keyword">int</span> hash = spread(key.hashCode());</span><br><span class="line">    <span class="comment">//è®°å½•æŸä¸ªæ¡¶ä¸Šå…ƒç´ çš„ä¸ªæ•°ï¼Œå¦‚æœè¶…è¿‡8ä¸ªï¼Œä¼šè½¬æˆçº¢é»‘æ ‘</span></span><br><span class="line">    <span class="keyword">int</span> binCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">        Node&lt;K,V&gt; f; <span class="keyword">int</span> n, i, fh;</span><br><span class="line">        <span class="comment">//å¦‚æœæ•°ç»„è¿˜æœªåˆå§‹åŒ–ï¼Œå…ˆå¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            tab = initTable();</span><br><span class="line">    <span class="comment">//å¦‚æœhashè®¡ç®—å¾—åˆ°çš„æ¡¶ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ©ç”¨caså°†å…ƒç´ æ·»åŠ </span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//cas+è‡ªæ—‹ï¼ˆå’Œå¤–ä¾§çš„foræ„æˆè‡ªæ—‹å¾ªç¯ï¼‰ï¼Œä¿è¯å…ƒç´ æ·»åŠ å®‰å…¨</span></span><br><span class="line">            <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,</span><br><span class="line">                         <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>)))</span><br><span class="line">                <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœhashè®¡ç®—å¾—åˆ°çš„æ¡¶ä½ç½®å…ƒç´ çš„hashå€¼ä¸ºMOVEDï¼Œè¯æ˜æ­£åœ¨æ‰©å®¹ï¼Œé‚£ä¹ˆååŠ©æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">            tab = helpTransfer(tab, f);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//hashè®¡ç®—çš„æ¡¶ä½ç½®å…ƒç´ ä¸ä¸ºç©ºï¼Œä¸”å½“å‰æ²¡æœ‰å¤„äºæ‰©å®¹æ“ä½œï¼Œè¿›è¡Œå…ƒç´ æ·»åŠ </span></span><br><span class="line">            V oldVal = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//å¯¹å½“å‰æ¡¶è¿›è¡ŒåŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰§è¡Œå…ƒç´ æ·»åŠ æ“ä½œ</span></span><br><span class="line">            <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                    <span class="comment">//æ™®é€šé“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">                    <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        binCount = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                            K ek;</span><br><span class="line">                            <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                                ((ek = e.key) == key ||</span><br><span class="line">                                 (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                oldVal = e.val;</span><br><span class="line">                                <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                    e.val = value;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            Node&lt;K,V&gt; pred = e;</span><br><span class="line">                            <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                                pred.next = <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                          value, <span class="keyword">null</span>);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//æ ‘èŠ‚ç‚¹ï¼Œå°†å…ƒç´ æ·»åŠ åˆ°çº¢é»‘æ ‘ä¸­</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                        Node&lt;K,V&gt; p;</span><br><span class="line">                        binCount = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                       value)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            oldVal = p.val;</span><br><span class="line">                            <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                p.val = value;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//é“¾è¡¨é•¿åº¦å¤§äº/ç­‰äº8ï¼Œå°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘</span></span><br><span class="line">                <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                    treeifyBin(tab, i);</span><br><span class="line">                <span class="comment">//å¦‚æœæ˜¯é‡å¤é”®ï¼Œç›´æ¥å°†æ—§å€¼è¿”å›</span></span><br><span class="line">                <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> oldVal;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ·»åŠ çš„æ˜¯æ–°å…ƒç´ ï¼Œç»´æŠ¤é›†åˆé•¿åº¦ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œæ‰©å®¹æ“ä½œ</span></span><br><span class="line">    addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ <code>putVal</code>æ–¹æ³•ä¸­å¯ä»¥å‘ç°ï¼Œ<strong>ConcurrentHashMap</strong>åœ¨ç¬¬ä¸€æ¬¡<code>put</code>çš„æ—¶å€™æ‰åˆå§‹åŒ–Nodeæ•°ç»„ï¼Œè¿™ä¸€ç‚¹å’Œ<strong>HashMap</strong>ç±»ä¼¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœæ•°ç»„è¿˜æœªåˆå§‹åŒ–ï¼Œå…ˆå¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">    tab = initTable();</span><br></pre></td></tr></table></figure><h3 id="1ã€initTableåˆå§‹åŒ–æ•°ç»„æ–¹æ³•"><a href="#1ã€initTableåˆå§‹åŒ–æ•°ç»„æ–¹æ³•" class="headerlink" title="1ã€initTableåˆå§‹åŒ–æ•°ç»„æ–¹æ³•"></a>1ã€initTableåˆå§‹åŒ–æ•°ç»„æ–¹æ³•</h3><blockquote><p>åˆå§‹åŒ– <strong>Node</strong> æ•°ç»„çš„æ–¹æ³•ï¼Œè¿™é‡Œä½¿ç”¨CASè‡ªæ—‹ä¿è¯çº¿ç¨‹å®‰å…¨</p></blockquote><ul><li>å¦‚æœå½“å‰ <code>sizeCtl &lt; 0</code> ï¼Œé‚£ä¹ˆæ ¹æ®è¡¨ç¤ºæœ‰çº¿ç¨‹æ­£åœ¨å¯¹ <strong>Node</strong> æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œå½“å‰çº¿ç¨‹éœ€è¦è®©å‡ºcpuè°ƒåº¦æƒç»™æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–æ•°ç»„çš„çº¿ç¨‹</li><li>å¦‚æœ  <code>sizeCtl != 0</code> ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å¯ä»¥å¯¹ <strong>Node</strong> æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œä½¿ç”¨CASè‡ªé€‰æ¥å¯¹ <code>sizeCtl</code> è¿›è¡Œä¿®æ”¹ï¼Œå¦‚æœä¿®æ”¹æˆåŠŸå°±ç»§ç»­åˆå§‹åŒ–ï¼Œå¦åˆ™ç»§ç»­è‡ªæ—‹</li><li>å¦‚æœä¿®æ”¹ <code>sizeCtl</code> æˆåŠŸï¼Œæ­¤æ—¶å…ˆå¯¹ <strong>Node</strong> æ•°ç»„è¿›è¡Œåˆ¤ç©ºæ£€æŸ¥</li><li>å¦‚æœ <strong>Node</strong> æ•°ç»„ä¸ºç©ºï¼Œå°±new ä¸€ä¸ª <strong>Node</strong> æ•°ç»„ï¼ŒåŒæ—¶è®¡ç®—æ‰©å®¹é˜ˆå€¼</li></ul><blockquote><p>ç”±äº<strong>ConcurrentHashMapçš„é»˜è®¤è´Ÿè½½å› å­ä¸º 0.75</strong> ï¼Œè€Œ n å³ç§»ä¸¤ä½çš„å€¼åˆšå¥½ç­‰äºåŸå€¼nçš„å››åˆ†ä¹‹ä¸€ï¼Œ<strong>æ•… n - (n &gt;&gt;&gt; 2) æ­£å¥½ä¸ºåŸå€¼nçš„ 0.75 å€</strong>ï¼Œè¿™é‡Œä½¿ç”¨äº†ä½è¿ç®—æ¥é¿å…é™¤æ³•æé«˜æ•ˆç‡ã€‚</p></blockquote><ul><li>åœ¨è®¡ç®—å®Œé˜ˆå€¼ä¹‹åï¼Œä½¿ç”¨breakè·³å‡ºå¾ªç¯ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; <span class="keyword">int</span> sc;</span><br><span class="line">    <span class="comment">//cas+è‡ªæ—‹ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">    <span class="keyword">while</span> ((tab = table) == <span class="keyword">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœsizeCtlçš„å€¼ï¼ˆ-1ï¼‰å°äº0ï¼Œè¯´æ˜æ­¤æ—¶æ­£åœ¨åˆå§‹åŒ–ï¼Œ è®©å‡ºcpu</span></span><br><span class="line">        <span class="keyword">if</span> ((sc = sizeCtl) &lt; <span class="number">0</span>)</span><br><span class="line">            Thread.yield(); <span class="comment">// lost initialization race; just spin</span></span><br><span class="line">        <span class="comment">//casä¿®æ”¹sizeCtlçš„å€¼ä¸º-1ï¼Œä¿®æ”¹æˆåŠŸï¼Œè¿›è¡Œæ•°ç»„åˆå§‹åŒ–ï¼Œå¤±è´¥ï¼Œç»§ç»­è‡ªæ—‹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (U.compareAndSwapInt(<span class="keyword">this</span>, SIZECTL, sc, -<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || tab.length == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//sizeCtlä¸º0ï¼Œå–é»˜è®¤é•¿åº¦16ï¼Œå¦åˆ™å»sizeCtlçš„å€¼</span></span><br><span class="line">                    <span class="keyword">int</span> n = (sc &gt; <span class="number">0</span>) ? sc : DEFAULT_CAPACITY;</span><br><span class="line">                    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">                    <span class="comment">//åŸºäºåˆå§‹é•¿åº¦ï¼Œæ„å»ºæ•°ç»„å¯¹è±¡</span></span><br><span class="line">                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node&lt;?,?&gt;[n];</span><br><span class="line">                    table = tab = nt;</span><br><span class="line">                    <span class="comment">//è®¡ç®—æ‰©å®¹é˜ˆå€¼ï¼Œå¹¶èµ‹å€¼ç»™sc</span></span><br><span class="line">                    sc = n - (n &gt;&gt;&gt; <span class="number">2</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">//å°†æ‰©å®¹é˜ˆå€¼ï¼Œèµ‹å€¼ç»™sizeCtl</span></span><br><span class="line">                sizeCtl = sc;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€è®¡ç®—é”®å€¼å¯¹æ·»åŠ çš„ä½ç½®"><a href="#2ã€è®¡ç®—é”®å€¼å¯¹æ·»åŠ çš„ä½ç½®" class="headerlink" title="2ã€è®¡ç®—é”®å€¼å¯¹æ·»åŠ çš„ä½ç½®"></a>2ã€è®¡ç®—é”®å€¼å¯¹æ·»åŠ çš„ä½ç½®</h3><blockquote><p>åœ¨åˆå§‹åŒ–å®Œæ•°ç»„ä¹‹åï¼Œä¼šä½¿ç”¨<code>tabAt</code> å‡½æ•°è®¡ç®—è¦æ·»åŠ çš„<code>Entry</code> å¯¹è±¡åœ¨æ•°ç»„ä¸­çš„ä½ç½®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¦‚æœhashè®¡ç®—å¾—åˆ°çš„æ¡¶ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ©ç”¨caså°†å…ƒç´ æ·»åŠ </span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">//cas+è‡ªæ—‹ï¼ˆå’Œå¤–ä¾§çš„foræ„æˆè‡ªæ—‹å¾ªç¯ï¼‰ï¼Œä¿è¯å…ƒç´ æ·»åŠ å®‰å…¨</span></span><br><span class="line">    <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,</span><br><span class="line">                 <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>)))</span><br><span class="line">        <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>tabAt</code>å‡½æ•°åº•å±‚ä½¿ç”¨äº†CAS</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function">Node&lt;K,V&gt; <span class="title">tabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœ<strong>table</strong>æ•°ç»„ä¸­è®¡ç®—å‡ºæ¥çš„ä½ç½®å…ƒç´ ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥å°†ç›´æ¥åˆ›å»ºä¸€ä¸ª<strong>Node</strong>èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°è¯¥ä½ç½®å³å¯ã€‚</p></blockquote><h3 id="3ã€å¤šçº¿ç¨‹ååŠ©æ‰©å®¹"><a href="#3ã€å¤šçº¿ç¨‹ååŠ©æ‰©å®¹" class="headerlink" title="3ã€å¤šçº¿ç¨‹ååŠ©æ‰©å®¹"></a>3ã€å¤šçº¿ç¨‹ååŠ©æ‰©å®¹</h3><blockquote><p>å¦‚æœè®¡ç®—å‡ºæ¥<strong>Node</strong>æ•°ç»„ä¸­è¦æ’å…¥ä½ç½®çš„å…ƒç´ çš„hashå€¼ä¸º<code>MOVED</code> ï¼Œé‚£ä¹ˆè¯æ˜å½“å‰ <strong>Node</strong> æ•°ç»„ä¸­è¦æ’å…¥ä½ç½®çš„å…ƒç´ ä¸º <strong>forwarding</strong> èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹çš„hashå€¼ä¸º1ã€‚</p><p><strong>forwarding</strong> èŠ‚ç‚¹å’Œ <strong>å¤šçº¿ç¨‹ååŠ©æ‰©å®¹</strong> æœ‰å…³ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">    tab = helpTransfer(tab, f);</span><br></pre></td></tr></table></figure><blockquote><p><strong>ConcurrentHashMap</strong> ä¸­ <code>MOVED</code> çš„å®šä¹‰å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MOVED     = -<span class="number">1</span>; <span class="comment">// hash for forwarding nodes</span></span><br></pre></td></tr></table></figure><h3 id="4ã€putæ–¹æ³•åŠ é”å›¾è§£"><a href="#4ã€putæ–¹æ³•åŠ é”å›¾è§£" class="headerlink" title="4ã€putæ–¹æ³•åŠ é”å›¾è§£"></a>4ã€putæ–¹æ³•åŠ é”å›¾è§£</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210305142810.jpg" alt="Snipaste_2020-05-16_12-04-08"></p><blockquote><p>ä¸Šé¢çš„ <code>if/else-if</code> åˆ†åˆ«å¯¹åº” <strong>Node</strong> æ•°ç»„<strong>æœªåˆå§‹åŒ–</strong>ã€<strong>Node</strong> æ•°ç»„è¦æ·»åŠ çš„<strong>ä½ç½®å…ƒç´ ä¸ºç©º</strong>ã€<strong>Node</strong> æ•°ç»„è¦æ·»åŠ çš„ä½ç½®<strong>æ­£åœ¨æ‰©å®¹</strong>çš„æƒ…å†µã€‚</p><p>ä¸‹é¢çš„ <code>else</code> è¡¨ç¤ºè¦æ·»åŠ çš„ä½ç½®å…ƒç´ å·²ç»å­˜åœ¨å…ƒç´ äº†ï¼Œæ­¤æ—¶å¯¹è¯¥ä½ç½®ä¸Šçš„å…ƒç´ åŠ é”ã€‚</p><p><strong>ConcurrentHashMap</strong> åœ¨æ·»åŠ å…ƒç´ æ—¶ï¼Œ<strong>åªä¼šå¯¹è¦åŠ å…¥çš„æ¡¶åŠ é”</strong>ï¼Œä¸ä¼šå½±å“å…¶ä»–æ¡¶ä½çš„çº¿ç¨‹æ“ä½œã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//hashè®¡ç®—çš„æ¡¶ä½ç½®å…ƒç´ ä¸ä¸ºç©ºï¼Œä¸”å½“å‰æ²¡æœ‰å¤„äºæ‰©å®¹æ“ä½œï¼Œè¿›è¡Œå…ƒç´ æ·»åŠ </span></span><br><span class="line">    V oldVal = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//å¯¹å½“å‰æ¡¶è¿›è¡ŒåŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰§è¡Œå…ƒç´ æ·»åŠ æ“ä½œ</span></span><br><span class="line">    <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">            <span class="comment">//æ™®é€šé“¾è¡¨èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                binCount = <span class="number">1</span>;</span><br><span class="line">                <span class="comment">//éå†é“¾è¡¨ï¼Œé€ä¸ªæ¯”è¾ƒé“¾è¡¨å…ƒç´ çš„keyå’Œå¾…æ’å…¥èŠ‚ç‚¹çš„keyæ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">                <span class="comment">//å¦‚æœä¸æ˜¯ï¼Œå°±ä½¿ç”¨å°¾æ’æ³•æ’å…¥å…ƒç´ ï¼Œå¦åˆ™å°±è¦†ç›–æ—§å€¼</span></span><br><span class="line">                <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                    K ek;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((ek = e.key) == key ||</span><br><span class="line">                         (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                        oldVal = e.val;</span><br><span class="line">                        <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                            e.val = value;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Node&lt;K,V&gt; pred = e;</span><br><span class="line">                    <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        pred.next = <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                  value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ ‘èŠ‚ç‚¹ï¼Œå°†å…ƒç´ æ·»åŠ åˆ°çº¢é»‘æ ‘ä¸­</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                Node&lt;K,V&gt; p;</span><br><span class="line">                binCount = <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                               value)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    oldVal = p.val;</span><br><span class="line">                    <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                        p.val = value;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//é“¾è¡¨é•¿åº¦å¤§äº/ç­‰äº8ï¼Œå°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">            treeifyBin(tab, i);</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯é‡å¤é”®ï¼Œç›´æ¥å°†æ—§å€¼è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span> oldVal;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€æ·»åŠ å®Œå…ƒç´ åè¿›è¡Œé“¾è¡¨é•¿åº¦åˆ¤æ–­"><a href="#5ã€æ·»åŠ å®Œå…ƒç´ åè¿›è¡Œé“¾è¡¨é•¿åº¦åˆ¤æ–­" class="headerlink" title="5ã€æ·»åŠ å®Œå…ƒç´ åè¿›è¡Œé“¾è¡¨é•¿åº¦åˆ¤æ–­"></a>5ã€æ·»åŠ å®Œå…ƒç´ åè¿›è¡Œé“¾è¡¨é•¿åº¦åˆ¤æ–­</h3><blockquote><p>å’Œ <strong>HashMap</strong> ç±»ä¼¼ï¼Œåœ¨æ·»åŠ å®Œä¸€ä¸ªå…ƒç´ åéœ€è¦å¯¹<strong>æ¡¶å…ƒç´ ä¸ªæ•°</strong>åŠ<strong>æ•°ç»„é•¿åº¦</strong>è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¡¶ä¸­<strong>é“¾è¡¨é•¿åº¦å¤§äº8</strong>ä¸”<strong>æ•°ç»„é•¿åº¦å¤§äº64</strong>ï¼Œå°±å°†è¯¥æ¡¶ä¸Šçš„é“¾è¡¨<strong>è½¬æ¢</strong>ä¸ºä¸€æ£µçº¢é»‘æ ‘ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">//é“¾è¡¨é•¿åº¦å¤§äº/ç­‰äº8ï¼Œå°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘</span></span><br><span class="line">    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">        treeifyBin(tab, i);</span><br><span class="line">    <span class="comment">//å¦‚æœæ˜¯é‡å¤é”®ï¼Œç›´æ¥å°†æ—§å€¼è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> oldVal;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ ‘åŒ–æ–¹æ³• <code>treeifyBin</code> åªæœ‰å½“<strong>æ•°ç»„é•¿åº¦å¤§äºç­‰äº64</strong>çš„æ—¶å€™æ‰ä¼šé€‰æ‹©æ ‘åŒ–ï¼Œä¸”æ ‘åŒ–æ—¶çš„åŠ é”è¿‡ç¨‹ä¹Ÿæ˜¯å¯¹å•ä¸€æ¡¶åŠ é”ã€‚</p><p>å¦‚æœæ•°ç»„é•¿åº¦å°äº64ï¼Œä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">       Node&lt;K,V&gt; b; <span class="keyword">int</span> n, sc;</span><br><span class="line">       <span class="keyword">if</span> (tab != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">               tryPresize(n &lt;&lt; <span class="number">1</span>);</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> ((b = tabAt(tab, index)) != <span class="keyword">null</span> &amp;&amp; b.hash &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="keyword">synchronized</span> (b) &#123;</span><br><span class="line">                   <span class="keyword">if</span> (tabAt(tab, index) == b) &#123;</span><br><span class="line">                       TreeNode&lt;K,V&gt; hd = <span class="keyword">null</span>, tl = <span class="keyword">null</span>;</span><br><span class="line">                       <span class="keyword">for</span> (Node&lt;K,V&gt; e = b; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">                           TreeNode&lt;K,V&gt; p =</span><br><span class="line">                               <span class="keyword">new</span> TreeNode&lt;K,V&gt;(e.hash, e.key, e.val,</span><br><span class="line">                                                 <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                           <span class="keyword">if</span> ((p.prev = tl) == <span class="keyword">null</span>)</span><br><span class="line">                               hd = p;</span><br><span class="line">                           <span class="keyword">else</span></span><br><span class="line">                               tl.next = p;</span><br><span class="line">                           tl = p;</span><br><span class="line">                       &#125;</span><br><span class="line">                       setTabAt(tab, index, <span class="keyword">new</span> TreeBin&lt;K,V&gt;(hd));</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="2-2ã€ConcurrentHashMap-ç©ºå€¼å’Œç©ºé”®é—®é¢˜"><a href="#2-2ã€ConcurrentHashMap-ç©ºå€¼å’Œç©ºé”®é—®é¢˜" class="headerlink" title="2.2ã€ConcurrentHashMap ç©ºå€¼å’Œç©ºé”®é—®é¢˜"></a>2.2ã€ConcurrentHashMap ç©ºå€¼å’Œç©ºé”®é—®é¢˜</h2><blockquote><p><strong>HashMap</strong>æ˜¯å…è®¸<em>ç©ºé”®ç©ºå€¼</em>çš„ï¼Œå…¶ä¸­ç©ºé”®åªå…è®¸æœ‰ä¸€ä¸ªï¼Œç©ºå€¼å…è®¸æœ‰å¤šä¸ªï¼Œä½† <strong>ConcurrentHashMap</strong> ä¸å…è®¸æœ‰ç©ºé”®ç©ºå€¼ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210304223605.png" alt="image-20210304223605030"></p><blockquote><p><code>spread</code>æ–¹æ³•æ˜¯ <strong>ConcurrentHashMap</strong> ä¸­çš„<strong>æ‰°åŠ¨æ–¹æ³•</strong> ï¼Œç”¨äºå¢åŠ æ•£åˆ—æ€§ï¼Œä¸”ä¿è¯ <code>spread</code> æ–¹æ³•è¿”å›çš„å€¼ä¸€å®šä¸ºæ­£æ•°ã€‚</p><p>åœ¨HashMapçš„hashæ–¹æ³•è®¡ç®—ç»“æœçš„åŸºç¡€ä¸Šï¼Œè®©å¾—åˆ°çš„å€¼ä¸ <code>0x7fffffff</code> è¿›è¡Œä¸€ä¸ªä¸è¿ç®—ã€‚</p><p>å°† <code>0x7fffffff</code> æ”¾å…¥è®¡ç®—å™¨ä¸­è®¡ç®—ï¼Œå¾—åˆ°çš„äºŒè¿›åˆ¶å€¼ä¸º</p><p><code>01111111111111111111111111111111</code></p><p>ä»»ä½•æ•°ä¸ <code>01111111111111111111111111111111</code> å¯ä»¥ä¿è¯è¯¥æ•°çš„ç¬¬ä¸€ä½ä¸º0ï¼Œåœ¨äºŒè¿›åˆ¶ä¸­ï¼Œç¬¬ä¸€ä½ä¸º0çš„æ•°ä¸ºæ­£æ•°ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_BITS = <span class="number">0x7fffffff</span>; <span class="comment">// usable bits of normal node hash    </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">spread</span><span class="params">(<span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> (h ^ (h &gt;&gt;&gt; <span class="number">16</span>)) &amp; HASH_BITS;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå­¦ä¹ ç¬”è®°ï¼ˆäº”ï¼‰-ThreadLocalå­¦ä¹ </title>
      <link href="posts/1275843529.html"/>
      <url>posts/1275843529.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="åä¸‰ã€ThreadLocal"><a href="#åä¸‰ã€ThreadLocal" class="headerlink" title="åä¸‰ã€ThreadLocal"></a>åä¸‰ã€ThreadLocal</h1><h2 id="13-1ã€ThreadLocal-ç®€ä»‹"><a href="#13-1ã€ThreadLocal-ç®€ä»‹" class="headerlink" title="13.1ã€ThreadLocal ç®€ä»‹"></a>13.1ã€ThreadLocal ç®€ä»‹</h2><h3 id="1ã€ThreadLocal-æ˜¯ä»€ä¹ˆ"><a href="#1ã€ThreadLocal-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1ã€ThreadLocal æ˜¯ä»€ä¹ˆ?"></a>1ã€ThreadLocal æ˜¯ä»€ä¹ˆ?</h3><blockquote><p>â€‹       <strong>ThreadLocal èƒ½æä¾›çº¿ç¨‹å±€éƒ¨å˜é‡</strong>ï¼Œè¿™äº›å˜é‡ä¸æ­£å¸¸çš„å˜é‡ä¸åŒï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—® ThreadLocal å®ä¾‹çš„æ—¶å€™ï¼ˆé€šè¿‡ get æˆ– set æ–¹æ³•ï¼‰éƒ½æœ‰è‡ªå·±ç‹¬ç«‹åˆå§‹åŒ–çš„å˜é‡å‰¯æœ¬ï¼ŒThreadLocal å®ä¾‹é€šå¸¸æ˜¯ç±»ä¸­çš„<strong>ç§æœ‰é™æ€</strong>å­—æ®µï¼Œä½¿ç”¨å®ƒçš„ç›®çš„æ˜¯å¸Œæœ›å°†çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ· ID æˆ–è€…äº‹åŠ¡ IDï¼‰å…³è”èµ·æ¥ã€‚</p></blockquote><p>æ€»ç»“ï¼š</p><ul><li>çº¿ç¨‹å¹¶å‘</li></ul><blockquote><p>ThreadLocalè¿ç”¨äºå¤šçº¿ç¨‹ç¯å¢ƒä¸‹</p></blockquote><ul><li>ä¼ é€’æ•°æ®</li></ul><blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ThreadLocalåœ¨åŒä¸€çº¿ç¨‹ï¼Œä¸åŒç»„ä»¶ä¸­ä¼ é€’å…¬å…±å˜é‡</p></blockquote><ul><li>çº¿ç¨‹éš”ç¦»</li></ul><blockquote><p>æ¯ä¸ªçº¿ç¨‹çš„å˜é‡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šç›¸äº’å½±å“</p></blockquote><h3 id="2ã€ThreadLocal-èƒ½å¹²ä»€ä¹ˆï¼Ÿ"><a href="#2ã€ThreadLocal-èƒ½å¹²ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€ThreadLocal èƒ½å¹²ä»€ä¹ˆï¼Ÿ"></a>2ã€ThreadLocal èƒ½å¹²ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>â€‹       ThreadLocal èƒ½å®ç°æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ä¸“å±çš„æœ¬åœ°å˜é‡å‰¯æœ¬ï¼Œä¸»è¦è§£å†³äº†è®©æ¯ä¸ªçº¿ç¨‹ç»‘å®šè‡ªå·±çš„å€¼ï¼Œé€šè¿‡ä½¿ç”¨ get(ï¼‰å’Œ set() æ–¹æ³•ï¼Œè·å–é»˜è®¤å€¼æˆ–å°†å…¶å€¼æ›´æ”¹ä¸ºå½“å‰çº¿ç¨‹æ‰€å­˜çš„å‰¯æœ¬çš„å€¼ä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p></blockquote><h3 id="3ã€ThreadLocal-å¸¸ç”¨APIä»‹ç»"><a href="#3ã€ThreadLocal-å¸¸ç”¨APIä»‹ç»" class="headerlink" title="3ã€ThreadLocal å¸¸ç”¨APIä»‹ç»"></a>3ã€ThreadLocal å¸¸ç”¨APIä»‹ç»</h3><blockquote><p>â€‹       è¿”å›è¯¥çº¿ç¨‹å±€éƒ¨å˜é‡åœ¨å½“å‰çº¿ç¨‹å‰¯æœ¬ä¸­çš„å€¼ã€‚å¦‚æœè¯¥å˜é‡å¯¹äºå½“å‰çº¿ç¨‹æ²¡æœ‰å€¼ï¼Œå®ƒé¦–å…ˆè¢«åˆå§‹åŒ–è°ƒç”¨ initialValue æ–¹æ³•å¾—åˆ°è¿”å›çš„å€¼ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>â€‹       è¿”å›å½“å‰çº¿ç¨‹çš„è¿™ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡çš„â€œåˆå§‹å€¼â€ã€‚è¯¥æ–¹æ³•å°†åœ¨çº¿ç¨‹ç¬¬ä¸€æ¬¡ä½¿ç”¨ get æ–¹æ³•è®¿é—®å˜é‡æ—¶è¢«è°ƒç”¨<br>é™¤éçº¿ç¨‹ä¹‹å‰è°ƒç”¨äº†set æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒinitialValue æ–¹æ³•å°†ä¸ä¼šè¢«çº¿ç¨‹è°ƒç”¨ã€‚<br>â€‹        é€šå¸¸ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­æœ€å¤šè°ƒç”¨ä¸€æ¬¡ï¼Œä½†æ˜¯åœ¨åç»­è°ƒç”¨ remove å’Œ get çš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½ä¼šè¢«å†æ¬¡è°ƒç”¨ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> T <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>â€‹       åˆ é™¤å½“å‰çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ã€‚å¦‚æœè¿™ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡éšåè¢«å½“å‰çº¿ç¨‹è°ƒç”¨äº† get ï¼Œå®ƒçš„å€¼å°†é€šè¿‡è°ƒç”¨å®ƒçš„ initialValue æ–¹æ³•é‡æ–°åˆå§‹åŒ–ï¼Œé™¤éå®ƒçš„å€¼åœ¨è¿‡æ¸¡æœŸé—´è¢«å½“å‰çº¿ç¨‹è°ƒç”¨äº† set ã€‚è¿™å¯èƒ½å¯¼è‡´åœ¨å½“å‰çº¿ç¨‹ä¸­å¤šæ¬¡è°ƒç”¨ initialValue æ–¹æ³•ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>â€‹       å°†å½“å‰çº¿ç¨‹çš„è¿™ä¸ªçº¿ç¨‹å±€éƒ¨å˜é‡çš„å‰¯æœ¬è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚å¤§å¤šæ•°å­ç±»å°†ä¸éœ€è¦è¦†ç›–è¿™ä¸ªæ–¹æ³•ï¼Œä»…ä»…ä¾é  initialValue æ–¹æ³•æ¥è®¾ç½®çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>â€‹       åˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡ã€‚å˜é‡çš„åˆå§‹å€¼æ˜¯é€šè¿‡æ–¹æ³•ä¸Š Supplier çš„ get æ–¹æ³•æ¥ç¡®å®šçš„ã€‚jdk1.8 æ‰æœ‰çš„ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;S&gt; <span class="function">ThreadLocal&lt;S&gt; <span class="title">withInitial</span><span class="params">(Supplier&lt;? extends S&gt; supplier)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="13-2ã€ThreadLocal-ç®€å•ä½¿ç”¨"><a href="#13-2ã€ThreadLocal-ç®€å•ä½¿ç”¨" class="headerlink" title="13.2ã€ThreadLocal ç®€å•ä½¿ç”¨"></a>13.2ã€ThreadLocal ç®€å•ä½¿ç”¨</h2><h3 id="1ã€é—®é¢˜å¼•å‡º"><a href="#1ã€é—®é¢˜å¼•å‡º" class="headerlink" title="1ã€é—®é¢˜å¼•å‡º"></a>1ã€é—®é¢˜å¼•å‡º</h3><blockquote><p>éœ€æ±‚ï¼šçº¿ç¨‹éš”ç¦»</p><ul><li>åœ¨å¤šçº¿ç¨‹å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„å˜é‡éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„</li><li>çº¿ç¨‹Aï¼Œè®¾ç½®å˜é‡1ï¼Œè·å–å˜é‡1</li><li>çº¿ç¨‹Bï¼Œè®¾ç½®å˜é‡2ï¼Œè·å–å˜é‡2</li></ul><p>åœ¨æ²¡æœ‰å¼•å…¥ThreadLocalä¹‹å‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDemo01</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDemo01 demo = <span class="keyword">new</span> MyDemo01();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                demo.setContent(Thread.currentThread().getName() + <span class="string">&quot;çš„æ•°æ®&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;---&gt;&quot;</span> + demo.getContent());</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼Œå‘ç°çº¿ç¨‹é—´æ²¡æœ‰å®ç°éš”ç¦»ï¼Œæœ‰çº¿ç¨‹æ‹¿åˆ°äº†è‡ªå·±ä»¥å¤–çš„çº¿ç¨‹èµ„æºã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303151207.png" alt="image-20210303151200139"></p><h3 id="2ã€å¼•å…¥ThreadLocal"><a href="#2ã€å¼•å…¥ThreadLocal" class="headerlink" title="2ã€å¼•å…¥ThreadLocal"></a>2ã€å¼•å…¥ThreadLocal</h3><blockquote><p>set()ï¼šå°†å˜é‡ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ä¸­</p><p>get()ï¼šè·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å˜é‡</p><p>åœ¨ä¸Šé¢çš„ç¨‹åºä¸­ä½¿ç”¨ThreadLocalä»£æ›¿<code>content</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDemo01</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal threadLocal = <span class="keyword">new</span> ThreadLocal();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDemo01 demo = <span class="keyword">new</span> MyDemo01();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                threadLocal.set(Thread.currentThread().getName() + <span class="string">&quot;çš„æ•°æ®&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;---&gt;&quot;</span> + threadLocal.get());</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å†æ¬¡è¿è¡Œç¨‹åºï¼Œå‘ç°å·²ç»å®ç°çº¿ç¨‹éš”ç¦»</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303152441.png" alt="image-20210303152441357"></p><h2 id="13-3ã€ThreadLocal-å’Œ-synchronizedçš„åŒºåˆ«"><a href="#13-3ã€ThreadLocal-å’Œ-synchronizedçš„åŒºåˆ«" class="headerlink" title="13.3ã€ThreadLocal å’Œ synchronizedçš„åŒºåˆ«"></a>13.3ã€ThreadLocal å’Œ synchronizedçš„åŒºåˆ«</h2><table><thead><tr><th></th><th>synchronized</th><th>ThreadLocal</th></tr></thead><tbody><tr><td>åŸç†</td><td>åŒæ­¥æœºåˆ¶é‡‡ç”¨<strong>ä»¥æ—¶é—´æ¢ç©ºé—´</strong>çš„æ–¹å¼ã€‚åªæä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æ’é˜Ÿè®¿é—®ã€‚</td><td>ThreadLocalé‡‡ç”¨äº†<strong>ä»¥ç©ºé—´æ¢æ—¶é—´</strong>çš„æ–¹å¼ï¼Œä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä»½å˜é‡çš„<strong>å‰¯æœ¬</strong>ï¼Œä»è€Œå®ç°åŒæ—¶è®¿é—®è€Œäº’ä¸å¹²æ‰°</td></tr><tr><td>ä¾§é‡ç‚¹</td><td>å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®èµ„æºçš„åŒæ­¥</td><td>å¤šçº¿ç¨‹ä¸­è®©æ¯ä¸ªçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ç›¸äº’éš”ç¦»</td></tr></tbody></table><blockquote><p>æ€»ç»“ï¼šåœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œä½¿ç”¨<code>synchronized</code> å’Œ <code>ThreadLocal</code> éƒ½å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†ä½¿ç”¨ <code>ThreadLocal</code> æ›´ä¸ºåˆé€‚ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ä½¿ç¨‹åºæ‹¥æœ‰æ›´é«˜çš„å¹¶å‘æ€§ã€‚</p></blockquote><h2 id="13-4ã€ThreadLocal-çš„å†…éƒ¨ç»“æ„"><a href="#13-4ã€ThreadLocal-çš„å†…éƒ¨ç»“æ„" class="headerlink" title="13.4ã€ThreadLocal çš„å†…éƒ¨ç»“æ„"></a>13.4ã€ThreadLocal çš„å†…éƒ¨ç»“æ„</h2><blockquote><p>æ¢ç©¶å®ç°çº¿ç¨‹æ•°æ®éš”ç¦»åŸç†</p></blockquote><h3 id="1ã€å¸¸è§çš„è¯¯è§£"><a href="#1ã€å¸¸è§çš„è¯¯è§£" class="headerlink" title="1ã€å¸¸è§çš„è¯¯è§£"></a>1ã€å¸¸è§çš„è¯¯è§£</h3><blockquote><p>â€‹       å¦‚æœæˆ‘ä»¬ä¸å»çœ‹æºä»£ç çš„è¯ï¼Œå¯èƒ½ä¼šçŒœæµ‹ThreadLocalæ˜¯è¿™æ ·å­è®¾è®¡çš„ï¼šæ¯ä¸ªThreadLocalç±»éƒ½åˆ›å»ºä¸€ä¸ª<code>Map</code>ï¼Œç„¶åç”¨çº¿ç¨‹ä½œä¸º<code>Map</code>çš„<code>key</code>ï¼Œè¦å­˜å‚¨çš„å±€éƒ¨å˜é‡ä½œä¸º<code>Map</code>çš„<code>value</code>ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°å„ä¸ªçº¿ç¨‹çš„å±€éƒ¨å˜é‡éš”ç¦»çš„æ•ˆæœã€‚è¿™æ˜¯æœ€ç®€å•çš„è®¾è®¡æ–¹æ³•ï¼Œ<strong>JDKæœ€æ—©æœŸçš„ThreadLocalå°±æ˜¯è¿™æ ·è®¾è®¡çš„</strong>ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303204948.png" alt="image-20210303204947445"></p><h3 id="2ã€ç°åœ¨çš„è®¾è®¡"><a href="#2ã€ç°åœ¨çš„è®¾è®¡" class="headerlink" title="2ã€ç°åœ¨çš„è®¾è®¡"></a>2ã€ç°åœ¨çš„è®¾è®¡</h3><blockquote><p>â€‹       JDKåé¢ä¼˜åŒ–äº†è®¾è®¡æ–¹æ¡ˆï¼Œåœ¨JDK8 ä¸­ <code>ThreadLocal</code> çš„è®¾è®¡æ˜¯ï¼šæ¯ä¸ª <code>Thread</code> éƒ½ç»´æŠ¤ä¸€ä¸ª <code>ThreadLocalMap</code> ï¼Œè¿™ä¸ªMapçš„ <code>key</code> æ˜¯ <code>ThreadLocal</code> å®ä¾‹æœ¬èº«ï¼Œ<code>value</code> æ‰æ˜¯çœŸæ­£è¦å­˜å‚¨çš„å€¼ <code>Object</code> ã€‚</p><p>â€‹       å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p></blockquote><ul><li>æ¯ä¸ªThreadçº¿ç¨‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªMap (ThreadLocalMap)</li><li>Mapé‡Œé¢å­˜å‚¨ThreadLocalå¯¹è±¡ï¼ˆkeyï¼‰å’Œçº¿ç¨‹çš„å˜é‡å‰¯æœ¬ï¼ˆvalueï¼‰</li><li>Threadå†…éƒ¨çš„Mapæ˜¯ç”±ThreadLocalç»´æŠ¤çš„ï¼Œç”±ThreadLocalè´Ÿè´£å‘mapè·å–å’Œè®¾ç½®çº¿ç¨‹çš„å˜é‡å€¼ã€‚</li><li>å¯¹äºä¸åŒçš„çº¿ç¨‹ï¼Œæ¯æ¬¡è·å–å‰¯æœ¬å€¼æ—¶ï¼Œåˆ«çš„çº¿ç¨‹å¹¶ä¸èƒ½è·å–åˆ°å½“å‰çº¿ç¨‹çš„å‰¯æœ¬å€¼ï¼Œå½¢æˆäº†å‰¯æœ¬çš„éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°ã€‚</li></ul><blockquote><p>JDK8ä¸­ThreadLocalè®¾è®¡å›¾</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303205447.png" alt="image-20210303205447468"></p><h3 id="3ã€è¿™æ ·è®¾è®¡çš„å¥½å¤„"><a href="#3ã€è¿™æ ·è®¾è®¡çš„å¥½å¤„" class="headerlink" title="3ã€è¿™æ ·è®¾è®¡çš„å¥½å¤„"></a>3ã€è¿™æ ·è®¾è®¡çš„å¥½å¤„</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303210524.png" alt="image-20210303210524365"></p><blockquote><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒJDK8åçš„è®¾è®¡å’Œæˆ‘ä»¬ä¸€å¼€å§‹çŒœæµ‹çš„è®¾è®¡æ­£å¥½ç›¸åï¼Œè¿™æ ·è®¾è®¡æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p></blockquote><ul><li>è¿™æ ·è®¾è®¡ä¹‹åæ¯ä¸ª<code>Map</code>å­˜å‚¨çš„<code>Entry</code>æ•°é‡å°±ä¼šå˜å°‘ï¼Œå› ä¸ºä¹‹å‰çš„å­˜å‚¨æ•°é‡ç”±<code>Thread</code>çš„æ•°é‡å†³å®šï¼Œç°åœ¨æ˜¯ç”±<code>ThreadLocal</code>çš„æ•°é‡å†³å®šã€‚</li><li>å½“<code>Thread</code>é”€æ¯ä¹‹åï¼Œå¯¹åº”çš„<code>ThreadLocalMap</code>ä¹Ÿä¼šéšä¹‹é”€æ¯ï¼Œèƒ½å‡å°‘å†…å­˜çš„ä½¿ç”¨ã€‚</li></ul><h2 id="13-5ã€ThreadLocalçš„æ ¸å¿ƒæ–¹æ³•æºç "><a href="#13-5ã€ThreadLocalçš„æ ¸å¿ƒæ–¹æ³•æºç " class="headerlink" title="13.5ã€ThreadLocalçš„æ ¸å¿ƒæ–¹æ³•æºç "></a>13.5ã€ThreadLocalçš„æ ¸å¿ƒæ–¹æ³•æºç </h2><blockquote><p>é™¤äº†æ„é€ æ–¹æ³•å¤–ï¼ŒThreadLocalè¿˜æœ‰ä»¥ä¸‹4ä¸ªå¯¹å¤–æš´éœ²çš„æ–¹æ³•</p></blockquote><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>protected T initialValue()</td><td>è¿”å›å½“å‰çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼</td></tr><tr><td>public void set( T value)</td><td>è®¾ç½®å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td></tr><tr><td>public T get()</td><td>è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td></tr><tr><td>public void remove()</td><td>ç§»é™¤å½“å‰çº¿ç¨‹ç»‘å®šçš„å±€éƒ¨å˜é‡</td></tr></tbody></table><h3 id="1ã€ThreadLocalMapç›¸å…³æ–¹æ³•"><a href="#1ã€ThreadLocalMapç›¸å…³æ–¹æ³•" class="headerlink" title="1ã€ThreadLocalMapç›¸å…³æ–¹æ³•"></a>1ã€ThreadLocalMapç›¸å…³æ–¹æ³•</h3><blockquote><p><strong>ThreadLocal</strong>ä¸­æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»<code>ThreadLocalMap</code>ï¼Œå…¶ä¸­<code>ThreadLocalMap</code>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª<strong>Entry</strong> æ•°ç»„ï¼›</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<strong>ThreadLocal</strong>ä¸­è¿˜æœ‰<code>getMap</code>ã€<code>createMap</code>ç­‰ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸<code>ThreadLocalMap</code>æ¯æ¯ç›¸å…³ã€‚</p></blockquote><ul><li>ThreadLocalMapé™æ€å†…éƒ¨ç±»</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303212211.png" alt="image-20210303212211603"></p><ul><li>ThreadLocalMapä¸­çš„é™æ€å†…éƒ¨ç±»Entry</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalMap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">        Object value;</span><br><span class="line"></span><br><span class="line">        Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class="line">            <span class="keyword">super</span>(k);</span><br><span class="line">            value = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The initial capacity -- MUST be a power of two.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The table, resized as necessary.</span></span><br><span class="line"><span class="comment">     * table.length MUST always be a power of two.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Entry[] table;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ThreadLocalä¸­çš„getMapæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å‰çº¿ç¨‹Threadå¯¹åº”ç»´æŠ¤çš„ThreadLocalMap </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  t the current thread å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the map å¯¹åº”ç»´æŠ¤çš„ThreadLocalMap </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ThreadLocalä¸­çš„createMapæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *åˆ›å»ºå½“å‰çº¿ç¨‹Threadå¯¹åº”ç»´æŠ¤çš„ThreadLocalMap </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> t å½“å‰çº¿ç¨‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> firstValue å­˜æ”¾åˆ°mapä¸­ç¬¬ä¸€ä¸ªentryçš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createMap</span><span class="params">(Thread t, T firstValue)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œçš„thisæ˜¯è°ƒç”¨æ­¤æ–¹æ³•çš„threadLocal</span></span><br><span class="line">    t.threadLocals = <span class="keyword">new</span> ThreadLocalMap(<span class="keyword">this</span>, firstValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>setInitialValueæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * setçš„å˜æ ·å®ç°ï¼Œç”¨äºåˆå§‹åŒ–å€¼initialValueï¼Œ</span></span><br><span class="line"><span class="comment"> * ç”¨äºä»£æ›¿é˜²æ­¢ç”¨æˆ·é‡å†™set()æ–¹æ³•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the initial value åˆå§‹åŒ–åçš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> T <span class="title">setInitialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨initialValueè·å–åˆå§‹åŒ–çš„å€¼</span></span><br><span class="line">    T value = initialValue();</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    <span class="comment">// å¦‚æœæ­¤mapå­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// å­˜åœ¨åˆ™è°ƒç”¨map.setè®¾ç½®æ­¤å®ä½“entry</span></span><br><span class="line">        map.set(<span class="keyword">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// 1ï¼‰å½“å‰çº¿ç¨‹Thread ä¸å­˜åœ¨ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// 2ï¼‰åˆ™è°ƒç”¨createMapè¿›è¡ŒThreadLocalMapå¯¹è±¡çš„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="comment">// 3ï¼‰å¹¶å°†æ­¤å®ä½“entryä½œä¸ºç¬¬ä¸€ä¸ªå€¼å­˜æ”¾è‡³ThreadLocalMapä¸­</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">    <span class="comment">// è¿”å›è®¾ç½®çš„å€¼value</span></span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€setæ–¹æ³•"><a href="#2ã€setæ–¹æ³•" class="headerlink" title="2ã€setæ–¹æ³•"></a>2ã€setæ–¹æ³•</h3><blockquote><p>æºç åŠä¸­æ–‡æ³¨é‡Š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®å½“å‰çº¿ç¨‹å¯¹åº”çš„ThreadLocalçš„å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value å°†è¦ä¿å­˜åœ¨å½“å‰çº¿ç¨‹å¯¹åº”çš„ThreadLocalçš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    <span class="comment">// å¦‚æœæ­¤mapå­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// å­˜åœ¨åˆ™è°ƒç”¨map.setè®¾ç½®æ­¤å®ä½“entry</span></span><br><span class="line">        map.set(<span class="keyword">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// 1ï¼‰å½“å‰çº¿ç¨‹Thread ä¸å­˜åœ¨ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// 2ï¼‰åˆ™è°ƒç”¨createMapè¿›è¡ŒThreadLocalMapå¯¹è±¡çš„åˆå§‹åŒ–</span></span><br><span class="line">        <span class="comment">// 3ï¼‰å¹¶å°†æ­¤å®ä½“entryä½œä¸ºç¬¬ä¸€ä¸ªå€¼å­˜æ”¾è‡³ThreadLocalMapä¸­</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>setæ–¹æ³•ä»£ç æ‰§è¡Œæµç¨‹å¦‚ä¸‹</strong></p></blockquote><ul><li><p>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªMap</p></li><li><p>å¦‚æœè·å–çš„Mapä¸ä¸ºç©ºï¼Œåˆ™å°†å‚æ•°è®¾ç½®åˆ°Mapä¸­ï¼ˆå½“å‰ThreadLocalçš„å¼•ç”¨ä½œä¸ºkeyï¼‰</p></li><li><p>å¦‚æœMapä¸ºç©ºï¼Œåˆ™ç»™è¯¥çº¿ç¨‹åˆ›å»º Mapï¼Œå¹¶è®¾ç½®åˆå§‹å€¼</p></li></ul><h3 id="3ã€getæ–¹æ³•"><a href="#3ã€getæ–¹æ³•" class="headerlink" title="3ã€getæ–¹æ³•"></a>3ã€getæ–¹æ³•</h3><blockquote><p>æºç åŠä¸­æ–‡æ³¨é‡Š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿”å›å½“å‰çº¿ç¨‹ä¸­ä¿å­˜ThreadLocalçš„å€¼</span></span><br><span class="line"><span class="comment"> * å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰æ­¤ThreadLocalå˜é‡ï¼Œ</span></span><br><span class="line"><span class="comment"> * åˆ™å®ƒä¼šé€šè¿‡è°ƒç”¨&#123;<span class="doctag">@link</span> #initialValue&#125; æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›å½“å‰çº¿ç¨‹å¯¹åº”æ­¤ThreadLocalçš„å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    <span class="comment">// è·å–æ­¤çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    <span class="comment">// å¦‚æœæ­¤mapå­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ä»¥å½“å‰çš„ThreadLocal ä¸º keyï¼Œè°ƒç”¨getEntryè·å–å¯¹åº”çš„å­˜å‚¨å®ä½“e</span></span><br><span class="line">        ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// æ‰¾åˆ°å¯¹åº”çš„å­˜å‚¨å®ä½“ e </span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="comment">// è·å–å­˜å‚¨å®ä½“ e å¯¹åº”çš„ valueå€¼</span></span><br><span class="line">            <span class="comment">// å³ä¸ºæˆ‘ä»¬æƒ³è¦çš„å½“å‰çº¿ç¨‹å¯¹åº”æ­¤ThreadLocalçš„å€¼</span></span><br><span class="line">            T result = (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœmapä¸å­˜åœ¨ï¼Œåˆ™è¯æ˜æ­¤çº¿ç¨‹æ²¡æœ‰ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨setInitialValueè¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»£ç æ‰§è¡Œæµç¨‹</p></blockquote><ul><li><p>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œæ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªMap</p></li><li><p>å¦‚æœè·å–çš„Mapä¸ä¸ºç©ºï¼Œåˆ™åœ¨Mapä¸­ä»¥ThreadLocalçš„å¼•ç”¨ä½œä¸ºkeyæ¥åœ¨Mapä¸­è·å–å¯¹åº”çš„value eï¼Œå¦åˆ™è½¬åˆ°E</p></li><li><p>å¦‚æœeä¸ä¸ºnullï¼Œåˆ™è¿”å›e.valueï¼Œå¦åˆ™æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ</p></li><li><p>Mapä¸ºç©ºæˆ–è€…eä¸ºç©ºï¼Œåˆ™é€šè¿‡initialValueå‡½æ•°è·å–åˆå§‹å€¼valueï¼Œç„¶åç”¨ThreadLocalçš„å¼•ç”¨å’Œvalueä½œä¸ºfirstKeyå’ŒfirstValueåˆ›å»ºä¸€ä¸ªæ–°çš„Map</p></li></ul><blockquote><p>getæ–¹æ³•æ€»ç»“: å…ˆè·å–å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å˜é‡ï¼Œå¦‚æœå­˜åœ¨åˆ™è¿”å›å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶è¿”å›åˆå§‹å€¼ã€‚</p></blockquote><h3 id="4ã€removeæ–¹æ³•"><a href="#4ã€removeæ–¹æ³•" class="headerlink" title="4ã€removeæ–¹æ³•"></a>4ã€removeæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤å½“å‰çº¿ç¨‹ä¸­ä¿å­˜çš„ThreadLocalå¯¹åº”çš„å®ä½“entry</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ä¸­ç»´æŠ¤çš„ThreadLocalMapå¯¹è±¡</span></span><br><span class="line">     ThreadLocalMap m = getMap(Thread.currentThread());</span><br><span class="line">    <span class="comment">// å¦‚æœæ­¤mapå­˜åœ¨</span></span><br><span class="line">     <span class="keyword">if</span> (m != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// å­˜åœ¨åˆ™è°ƒç”¨map.remove</span></span><br><span class="line">        <span class="comment">// ä»¥å½“å‰ThreadLocalä¸ºkeyåˆ é™¤å¯¹åº”çš„å®ä½“entry</span></span><br><span class="line">         m.remove(<span class="keyword">this</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»£ç æ‰§è¡Œæµç¨‹</p></blockquote><ul><li><p>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶æ ¹æ®å½“å‰çº¿ç¨‹è·å–ä¸€ä¸ªMap</p></li><li><p>å¦‚æœè·å–çš„Mapä¸ä¸ºç©ºï¼Œåˆ™ç§»é™¤å½“å‰ThreadLocalå¯¹è±¡å¯¹åº”çš„entry</p></li></ul><h3 id="5ã€initialValueæ–¹æ³•"><a href="#5ã€initialValueæ–¹æ³•" class="headerlink" title="5ã€initialValueæ–¹æ³•"></a>5ã€initialValueæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * è¿”å›å½“å‰çº¿ç¨‹å¯¹åº”çš„ThreadLocalçš„åˆå§‹å€¼</span></span><br><span class="line"><span class="comment">  * æ­¤æ–¹æ³•çš„ç¬¬ä¸€æ¬¡è°ƒç”¨å‘ç”Ÿåœ¨ï¼Œå½“çº¿ç¨‹é€šè¿‡&#123;<span class="doctag">@link</span> #get&#125;æ–¹æ³•è®¿é—®æ­¤çº¿ç¨‹çš„ThreadLocalå€¼æ—¶</span></span><br><span class="line"><span class="comment">  * é™¤éçº¿ç¨‹å…ˆè°ƒç”¨äº† &#123;<span class="doctag">@link</span> #set&#125;æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@code</span> initialValue&#125; æ‰ä¸ä¼šè¢«è¿™ä¸ªçº¿ç¨‹è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment">  * é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹æœ€å¤šè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * &lt;p&gt;è¿™ä¸ªæ–¹æ³•ä»…ä»…ç®€å•çš„è¿”å›null &#123;<span class="doctag">@code</span> null&#125;;</span></span><br><span class="line"><span class="comment">  * å¦‚æœç¨‹åºå‘˜æƒ³ThreadLocalçº¿ç¨‹å±€éƒ¨å˜é‡æœ‰ä¸€ä¸ªé™¤nullä»¥å¤–çš„åˆå§‹å€¼ï¼Œ</span></span><br><span class="line"><span class="comment">  * å¿…é¡»é€šè¿‡å­ç±»ç»§æ‰¿&#123;<span class="doctag">@code</span> ThreadLocal&#125; çš„æ–¹å¼å»é‡å†™æ­¤æ–¹æ³•</span></span><br><span class="line"><span class="comment">  * é€šå¸¸, å¯ä»¥é€šè¿‡åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼å®ç°</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> å½“å‰ThreadLocalçš„åˆå§‹å€¼</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> T <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯ è¿”å›è¯¥çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼ã€‚</p></blockquote><ul><li><p>è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå»¶è¿Ÿè°ƒç”¨æ–¹æ³•ï¼Œä»ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¾—çŸ¥ï¼Œåœ¨setæ–¹æ³•è¿˜æœªè°ƒç”¨è€Œå…ˆè°ƒç”¨äº†getæ–¹æ³•æ—¶æ‰æ‰§è¡Œï¼Œå¹¶ä¸”ä»…æ‰§è¡Œ1æ¬¡ã€‚</p></li><li><p>è¿™ä¸ªæ–¹æ³•ç¼ºçœå®ç°ç›´æ¥è¿”å›ä¸€ä¸ªnullã€‚</p></li><li><p>å¦‚æœæƒ³è¦ä¸€ä¸ªé™¤nullä¹‹å¤–çš„åˆå§‹å€¼ï¼Œå¯ä»¥é‡å†™æ­¤æ–¹æ³•ã€‚ï¼ˆå¤‡æ³¨ï¼š è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªprotectedçš„æ–¹æ³•ï¼Œæ˜¾ç„¶æ˜¯ä¸ºäº†è®©å­ç±»è¦†ç›–è€Œè®¾è®¡çš„ï¼‰</p></li></ul><h2 id="13-6ã€ThreadLocalMapæºç åˆ†æ"><a href="#13-6ã€ThreadLocalMapæºç åˆ†æ" class="headerlink" title="13.6ã€ThreadLocalMapæºç åˆ†æ"></a>13.6ã€ThreadLocalMapæºç åˆ†æ</h2><h3 id="1ã€åŸºæœ¬ç»“æ„"><a href="#1ã€åŸºæœ¬ç»“æ„" class="headerlink" title="1ã€åŸºæœ¬ç»“æ„"></a>1ã€åŸºæœ¬ç»“æ„</h3><blockquote><p>â€‹       ThreadLocalMapæ˜¯ThreadLocalçš„å†…éƒ¨ç±»ï¼Œ<strong>æ²¡æœ‰å®ç°Mapæ¥å£</strong>ï¼Œ<strong>ç”¨ç‹¬ç«‹çš„æ–¹å¼å®ç°äº†Mapçš„åŠŸèƒ½</strong>ï¼Œå…¶<strong>å†…éƒ¨çš„Entryä¹Ÿæ˜¯ç‹¬ç«‹å®ç°</strong>ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303214447.png" alt="image-20210303214447305"></p><h3 id="2ã€æˆå‘˜å˜é‡"><a href="#2ã€æˆå‘˜å˜é‡" class="headerlink" title="2ã€æˆå‘˜å˜é‡"></a>2ã€æˆå‘˜å˜é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆå§‹å®¹é‡ â€”â€” å¿…é¡»æ˜¯2çš„æ•´æ¬¡å¹‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INITIAL_CAPACITY = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å­˜æ”¾æ•°æ®çš„tableï¼ŒEntryç±»çš„å®šä¹‰åœ¨ä¸‹é¢åˆ†æ</span></span><br><span class="line"><span class="comment"> * åŒæ ·ï¼Œæ•°ç»„é•¿åº¦å¿…é¡»æ˜¯2çš„å†¥ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Entry[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°ç»„é‡Œé¢entrysçš„ä¸ªæ•°ï¼Œå¯ä»¥ç”¨äºåˆ¤æ–­tableå½“å‰ä½¿ç”¨é‡æ˜¯å¦è¶…è¿‡è´Ÿå› å­ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿›è¡Œæ‰©å®¹çš„é˜ˆå€¼ï¼Œè¡¨ä½¿ç”¨é‡å¤§äºå®ƒçš„æ—¶å€™è¿›è¡Œæ‰©å®¹ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> threshold; <span class="comment">// Default to 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é˜ˆå€¼è®¾ç½®ä¸ºé•¿åº¦çš„2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setThreshold</span><span class="params">(<span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    threshold = len * <span class="number">2</span> / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>â€‹       ä¸<strong>HashMap</strong>ç±»ä¼¼ï¼Œ<code>INITIAL_CAPACITY</code>ä»£è¡¨è¿™ä¸ª<strong>Map</strong>æ•°ç»„çš„åˆå§‹å®¹é‡ï¼Œ<code>table</code>æ˜¯ä¸€ä¸ª<strong>Entry</strong>ç±»å‹çš„æ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ•°æ®ï¼Œ<code>size</code>ä»£è¡¨è¡¨ä¸­å­˜å‚¨çš„æ•°ç›®ï¼Œ<code>threshold</code>ä»£è¡¨æ‰©å®¹æ—¶å¯¹äºsizeçš„é˜ˆå€¼ã€‚</p></blockquote><h3 id="3ã€ThreadLocalMapä¸­çš„å­˜å‚¨ç»“æ„Entry"><a href="#3ã€ThreadLocalMapä¸­çš„å­˜å‚¨ç»“æ„Entry" class="headerlink" title="3ã€ThreadLocalMapä¸­çš„å­˜å‚¨ç»“æ„Entry"></a>3ã€ThreadLocalMapä¸­çš„å­˜å‚¨ç»“æ„Entry</h3><blockquote><p><strong>ThreadLocalMap</strong>ä¸­çš„Entryç±»ç»§æ‰¿è‡ª<code>WeakReference</code>(å¼±å¼•ç”¨)ï¼Œä¹Ÿå°±æ˜¯<code>key</code>(ThreadLocal) æ˜¯å¼±å¼•ç”¨ï¼Œå…¶ç›®çš„æ˜¯å°†<strong>ThreadLocal</strong> å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸè§£ç»‘ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ThreadLocalMapä¸­ï¼Œä¹Ÿæ˜¯ç”¨Entryæ¥ä¿å­˜K-Vç»“æ„æ•°æ®çš„ã€‚ä½†æ˜¯Entryä¸­keyåªèƒ½æ˜¯ThreadLocalå¯¹è±¡ï¼Œè¿™ç‚¹è¢«Entryçš„æ„é€ æ–¹æ³•å·²ç»é™å®šæ­»äº†</span></span><br><span class="line"><span class="comment">// å¦å¤–ï¼ŒEntryç»§æ‰¿WeakReference,ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå¯ä»¥å°†ThreadLocalå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç”Ÿå‘½å‘¨æœŸè§£ç»‘ï¼ŒæŒæœ‰å¯¹ThreadLocalçš„å¼±å¼•ç”¨ï¼Œå¯ä»¥ä½¿å¾—ThreadLocalåœ¨æ²¡æœ‰å…¶ä»–å¼ºå¼•ç”¨çš„æ—¶å€™è¢«å›æ”¶æ‰ï¼Œè¿™æ ·å¯ä»¥é¿å…å› ä¸ºçº¿ç¨‹å¾—ä¸åˆ°é”€æ¯å¯¼è‡´ThreadLocalå¯¹è±¡æ— æ³•è¢«å›æ”¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/** The value associated with this ThreadLocal. */</span></span><br><span class="line">    Object value;</span><br><span class="line"></span><br><span class="line">    Entry(ThreadLocal k, Object v) &#123;</span><br><span class="line">        <span class="keyword">super</span>(k);</span><br><span class="line">        value = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼"><a href="#4ã€å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼" class="headerlink" title="4ã€å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼"></a>4ã€å¼±å¼•ç”¨å’Œå†…å­˜æ³„æ¼</h3><blockquote><p>â€‹       æœ‰äº›ç¨‹åºå‘˜åœ¨ä½¿ç”¨ThreadLocalçš„è¿‡ç¨‹ä¸­ä¼šå‘ç°æœ‰å†…å­˜æ³„æ¼çš„æƒ…å†µå‘ç”Ÿ,å°±çŒœæµ‹è¿™ä¸ªå†…å­˜æ³„æ¼è·ŸEntryä¸­ä½¿ç”¨äº†å¼±å¼•ç”¨çš„keyæœ‰å…³ç³»ã€‚è¿™ä¸ªç†è§£å…¶å®æ˜¯ä¸å¯¹çš„ã€‚</p></blockquote><p>æˆ‘ä»¬å…ˆæ¥å›é¡¾è¿™ä¸ªé—®é¢˜ä¸­æ¶‰åŠçš„å‡ ä¸ªåè¯æ¦‚å¿µï¼Œå†æ¥åˆ†æé—®é¢˜</p><blockquote><p>å†…å­˜æ³„æ¼ç›¸å…³æ¦‚å¿µ</p></blockquote><ul><li><strong>Memory overflow</strong>:å†…å­˜æº¢å‡º,æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æä¾›ç”³è¯·è€…ä½¿ç”¨ã€‚</li><li><strong>Memory leak</strong>:å†…å­˜æ³„æ¼æ˜¯æŒ‡ç¨‹åºä¸­å·±åŠ¨æ€åˆ†é…çš„å †å†…å­˜ç”±äºæŸç§åŸå› ç¨‹åºæœªé‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾,é€ æˆç³»ç»Ÿå†…å­˜çš„æµªè´¹,å¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦å‡æ…¢ç”šè‡³ç³»ç»Ÿå´©æºƒç­‰ä¸¥é‡åæœã€‚å†…å­˜æ³„æ¼çš„å †ç§¯ç»ˆå°†å¯¼è‡´å†…å­˜æº¢å‡ºã€‚</li></ul><blockquote><p>å¼±å¼•ç”¨ç›¸å…³æ¦‚å¿µ</p></blockquote><ul><li><p>Javaä¸­çš„å¼•ç”¨æœ‰4ç§ç±»å‹: å¼ºã€è½¯ã€å¼±ã€è™šã€‚å½“å‰è¿™ä¸ªé—®é¢˜ä¸»è¦æ¶‰åŠåˆ°å¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨:</p></li><li><p><strong>å¼ºå¼•ç”¨(StrongReference)</strong>, å°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„æ™®é€šå¯¹è±¡å¼•ç”¨,åªè¦è¿˜æœ‰å¼ºå¼•ç”¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡,å°±èƒ½è¡¨æ˜å¯¹è±¡è¿˜â€œæ´»ç€â€,åƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶è¿™ç§å¯¹è±¡ã€‚</p></li><li><p><strong>å¼±å¼•ç”¨(WeakReference)</strong>,åƒåœ¾å›æ”¶å™¨ä¸€æ—¦å‘ç°äº† åªå…·æœ‰å¼±å¼“|ç”¨çš„å¯¹è±¡,ä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦,éƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚</p></li></ul><blockquote><p>å¦‚æœkeyä½¿ç”¨å¼ºå¼•ç”¨</p></blockquote><ul><li>å‡è®¾ThreadLocalMapä¸­çš„keyä½¿ç”¨äº†å¼ºå¼•ç”¨,é‚£ä¹ˆä¼šå‡ºç°å†…å­˜æ³„æ¼å—?<br>æ­¤æ—¶ThreadLocalçš„å†…å­˜å›¾(å®çº¿è¡¨ç¤ºå¼ºå¼•ç”¨)å¦‚ä¸‹ï¼š</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303220758.png" alt="image-20210303220758608"></p><blockquote><p>å¦‚æœkeyä½¿ç”¨å¼±å¼•ç”¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210303221126.png" alt="image-20210303221126771"></p><h3 id="5ã€ThreadLocalå†…å­˜æ³„æ¼æ€»ç»“"><a href="#5ã€ThreadLocalå†…å­˜æ³„æ¼æ€»ç»“" class="headerlink" title="5ã€ThreadLocalå†…å­˜æ³„æ¼æ€»ç»“"></a>5ã€ThreadLocalå†…å­˜æ³„æ¼æ€»ç»“</h3><ul><li><p>å¦‚æœThreadLocalMapä¸­çš„keyä½¿ç”¨å¼ºå¼•ç”¨ï¼Œé‚£ä¹ˆå½“æŒ‡å‘ThreadLocalçš„å¼•ç”¨è¢«å›æ”¶åï¼ŒkeyæŒ‡å‘çš„ThreadLocalå®ä¾‹å°†æ— æ³•è¢«å›æ”¶ï¼ˆå› ä¸ºkeyä¸ºå¼ºå¼•ç”¨ï¼‰ï¼Œæ­¤æ—¶æ— æ³•é¿å…å†…å­˜æ³„æ¼</p></li><li><p>å¦‚æœThreadLocalMapä¸­çš„keyä½¿ç”¨å¼±å¼•ç”¨ï¼Œé‚£ä¹ˆå½“æŒ‡å‘ThreadLocalçš„å¼•ç”¨è¢«å›æ”¶åï¼ŒkeyæŒ‡å‘çš„ThreadLocalå®ä¾‹ç›´æ¥è¢«gcå›æ”¶ï¼ˆå› ä¸ºkeyä¸ºå¼±å¼•ç”¨ï¼‰ï¼Œä½†ç”±äºæ­¤æ—¶Entryä¸­çš„valueä¸ä¼šè¢«å›æ”¶ï¼Œå› æ­¤ä»ç„¶å¯èƒ½é€ æˆå†…å­˜æ³„æ¼</p></li></ul><blockquote><p>â€‹       æ ¹æ®åˆšæ‰çš„åˆ†æ,æˆ‘ä»¬çŸ¥é“äº†ï¼š<strong>æ— è®ºä½¿ç”¨ThreadLocalMapä¸­çš„keyä½¿ç”¨å“ªç§ç±»å‹å¼•ç”¨éƒ½æ— æ³•å®Œå…¨é¿å…å†…å­˜æ³„æ¼</strong>ï¼Œ<strong>è·Ÿä½¿ç”¨å¼±å¼•ç”¨æ²¡æœ‰å…³ç³»</strong>ã€‚</p><p>â€‹        ThreadLocalé€ æˆå†…å­˜æ³„æ¼çš„æ ¹æœ¬åŸå› æ˜¯ï¼š<em>ç”±äºThreadLocalMapçš„ç”Ÿå‘½å‘¨æœŸå’ŒThreadä¸€æ ·é•¿ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨åˆ é™¤å¯¹åº”Entryå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚</em></p><p>â€‹       è¦é¿å…å†…å­˜æ³„æ¼æœ‰ä¸¤ç§æ–¹å¼ï¼š</p></blockquote><ul><li>ä½¿ç”¨å®ŒThreadLocal ï¼Œè°ƒç”¨å…¶removeæ–¹æ³•åˆ é™¤å¯¹åº”çš„Entryï¼Œå°±èƒ½é¿å…å†…å­˜æ³„æ¼</li><li>ä½¿ç”¨å®ŒThreadLocal ï¼Œå½“å‰Threadä¹Ÿéšä¹‹è¿è¡Œç»“æŸç›¸å¯¹ç¬¬ä¸€ç§æ–¹å¼ï¼Œ ç¬¬äºŒç§æ–¹å¼æ˜¾ç„¶æ›´ä¸å¥½æ§åˆ¶ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œçº¿ç¨‹ç»“æŸæ˜¯ä¸ä¼šé”€æ¯çš„ã€‚</li></ul><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>åªè¦è®°å¾—åœ¨ä½¿ç”¨å®ŒThreadLocalåŠæ—¶çš„è°ƒç”¨remove</strong> ï¼Œæ— è®ºkeyæ˜¯å¼ºå¼•ç”¨è¿˜æ˜¯å¼±å¼•ç”¨éƒ½ä¸ä¼šæœ‰é—®é¢˜ã€‚</p></blockquote><h3 id="6ã€keyä½¿ç”¨å¼±å¼•ç”¨çš„åŸå› "><a href="#6ã€keyä½¿ç”¨å¼±å¼•ç”¨çš„åŸå› " class="headerlink" title="6ã€keyä½¿ç”¨å¼±å¼•ç”¨çš„åŸå› "></a>6ã€keyä½¿ç”¨å¼±å¼•ç”¨çš„åŸå› </h3><blockquote><p>â€‹       äº‹å®ä¸Šï¼Œåœ¨ThreadLocalMapä¸­çš„set/getEntryæ–¹æ³•ä¸­ï¼Œ<strong>ä¼šå¯¹keyä¸ºnull (ä¹Ÿå³æ˜¯ThreadLocalä¸ºnull )è¿›è¡Œåˆ¤æ–­</strong>ï¼Œ<strong>å¦‚æœkeyä¸ºnulçš„è¯</strong>ï¼Œé‚£ä¹ˆæ˜¯ä¼š<strong>å°†valueç½®ä¸ºnull</strong>çš„ã€‚<br>â€‹       è¿™å°±æ„å‘³ç€ä½¿ç”¨å®ŒThreadLocal ï¼Œ CurrentThreadä¾ç„¶è¿è¡Œçš„å‰æä¸‹ï¼Œå°±ç®—å¿˜è®°è°ƒç”¨removeæ–¹æ³•ï¼Œ<strong>å¼±å¼•ç”¨æ¯”å¼ºå¼•ç”¨å¯ä»¥å¤šä¸€å±‚ä¿éšœï¼šå¼±å¼•ç”¨çš„ThreadLocalä¼šè¢«å›æ”¶ï¼Œå¯¹åº”çš„valueåœ¨ä¸‹ä¸€æ¬¡ThreadLocalMapè°ƒç”¨setï¼Œgetï¼Œremoveä¸­çš„ä»»ä¸€æ–¹æ³•çš„æ—¶å€™ä¼šè¢«æ¸…é™¤</strong>ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼ã€‚</p></blockquote><h2 id="13-7ã€ThreadLocalMapè§£å†³hashå†²çªçš„æ–¹æ³•"><a href="#13-7ã€ThreadLocalMapè§£å†³hashå†²çªçš„æ–¹æ³•" class="headerlink" title="13.7ã€ThreadLocalMapè§£å†³hashå†²çªçš„æ–¹æ³•"></a>13.7ã€ThreadLocalMapè§£å†³hashå†²çªçš„æ–¹æ³•</h2><blockquote><p>ThreadLocalä½¿ç”¨çš„æ˜¯<strong>è‡ªå®šä¹‰çš„ThreadLocalMap</strong>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ¢ç©¶ä¸€ä¸‹ThreadLocalMapçš„hashå†²çªè§£å†³æ–¹å¼ã€‚</p></blockquote><h3 id="1ã€å›é¡¾ThreadLocalçš„setæ–¹æ³•"><a href="#1ã€å›é¡¾ThreadLocalçš„setæ–¹æ³•" class="headerlink" title="1ã€å›é¡¾ThreadLocalçš„setæ–¹æ³•"></a>1ã€å›é¡¾ThreadLocalçš„setæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocal.ThreadLocalMap map = getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="keyword">null</span>)</span><br><span class="line">        map.set(<span class="keyword">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ThreadLocal.<span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t.threadLocals;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createMap</span><span class="params">(Thread t, T firstValue)</span> </span>&#123;</span><br><span class="line">    t.threadLocals = <span class="keyword">new</span> ThreadLocal.ThreadLocalMap(<span class="keyword">this</span>, firstValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è·å–å½“å‰çº¿ç¨‹ï¼Œå¹¶è·å–å½“å‰çº¿ç¨‹çš„ThreadLocalMapå®ä¾‹ï¼ˆä»getMap(Thread t)ä¸­å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼‰ã€‚</li><li>å¦‚æœè·å–åˆ°çš„mapå®ä¾‹ä¸ä¸ºç©ºï¼Œè°ƒç”¨map.set()æ–¹æ³•ï¼Œå¦åˆ™è°ƒç”¨æ„é€ å‡½æ•° ThreadLocal.ThreadLocalMap(this, firstValue)å®ä¾‹åŒ–mapã€‚</li></ul><blockquote><p>å¯ä»¥çœ‹å‡ºæ¥çº¿ç¨‹ä¸­çš„ThreadLocalMapä½¿ç”¨çš„æ˜¯<strong>å»¶è¿Ÿåˆå§‹åŒ–</strong>ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨get()æˆ–è€…set()æ–¹æ³•çš„æ—¶å€™æ‰ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚</p></blockquote><h3 id="2ã€ThreadLocalMapæ„é€ æ–¹æ³•"><a href="#2ã€ThreadLocalMapæ„é€ æ–¹æ³•" class="headerlink" title="2ã€ThreadLocalMapæ„é€ æ–¹æ³•"></a>2ã€ThreadLocalMapæ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–table</span></span><br><span class="line">    table = <span class="keyword">new</span> ThreadLocal.ThreadLocalMap.Entry[INITIAL_CAPACITY];</span><br><span class="line">    <span class="comment">//è®¡ç®—ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">int</span> i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®å€¼</span></span><br><span class="line">    table[i] = <span class="keyword">new</span> ThreadLocal.ThreadLocalMap.Entry(firstKey, firstValue);</span><br><span class="line">    size = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//è®¾ç½®é˜ˆå€¼</span></span><br><span class="line">    setThreshold(INITIAL_CAPACITY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸»è¦è¯´ä¸€ä¸‹è®¡ç®—ç´¢å¼•ï¼Œ<code>firstKey.threadLocalHashCode</code> &amp; <code>(INITIAL_CAPACITY - 1)</code></p></blockquote><ul><li>å…³äº<code>&amp; (INITIAL_CAPACITY - 1)</code>,è¿™æ˜¯å–æ¨¡çš„ä¸€ç§æ–¹å¼ï¼Œå¯¹äº2çš„å¹‚ä½œä¸ºæ¨¡æ•°å–æ¨¡ï¼Œç”¨æ­¤ä»£æ›¿<code>%(2^n)</code>ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºå•¥å®¹é‡å¿…é¡»ä¸º2çš„å¹‚ï¼Œåœ¨è¿™ä¸ªåœ°æ–¹ä¹Ÿå¾—åˆ°äº†è§£ç­”ã€‚</li><li>å…³äº<code>firstKey.threadLocalHashCode</code>ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> threadLocalHashCode = nextHashCode();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">nextHashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nextHashCode.getAndAdd(HASH_INCREMENT);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger nextHashCode =  <span class="keyword">new</span> AtomicInteger();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> HASH_INCREMENT = <span class="number">0x61c88647</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª<strong>AtomicInteger</strong>ç±»å‹ï¼Œæ¯æ¬¡è·å–å½“å‰å€¼å¹¶åŠ ä¸Š<code>HASH_INCREMENT</code>ï¼Œ<code>HASH_INCREMENT</code> = 0x61c88647,è¿™ä¸ªå€¼å’Œæ–æ³¢é‚£å¥‘æ•£åˆ—æœ‰å…³ï¼ˆè¿™æ˜¯ä¸€ç§ä¹˜æ•°æ•£åˆ—æ³•ï¼Œåªä¸è¿‡è¿™ä¸ªä¹˜æ•°æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯32ä½æ•´å‹ä¸Šé™2^32-1ä¹˜ä»¥é»„é‡‘åˆ†å‰²æ¯”ä¾‹0.618â€¦çš„å€¼2654435769ï¼Œç”¨æœ‰ç¬¦å·æ•´å‹è¡¨ç¤ºå°±æ˜¯-1640531527ï¼Œå»æ‰ç¬¦å·å16è¿›åˆ¶è¡¨ç¤ºä¸º0x61c88647ï¼‰ï¼Œå…¶ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†è®©å“ˆå¸Œç èƒ½å‡åŒ€çš„åˆ†å¸ƒåœ¨2çš„næ¬¡æ–¹çš„æ•°ç»„é‡Œ, ä¹Ÿå°±æ˜¯<code>Entry[] table</code>ä¸­ï¼Œè¿™æ ·åšå¯ä»¥å°½é‡é¿å…hashå†²çªã€‚</p></blockquote><h3 id="3ã€ThreadLocalMapä¸­çš„setæ–¹æ³•"><a href="#3ã€ThreadLocalMapä¸­çš„setæ–¹æ³•" class="headerlink" title="3ã€ThreadLocalMapä¸­çš„setæ–¹æ³•"></a>3ã€ThreadLocalMapä¸­çš„setæ–¹æ³•</h3><blockquote><p>â€‹       <strong>ThreadLocalMap</strong>ä½¿ç”¨<strong>å¼€å‘åœ°å€-çº¿æ€§æ¢æµ‹æ³•</strong>æ¥è§£å†³å“ˆå¸Œå†²çªï¼Œçº¿æ€§æ¢æµ‹æ³•çš„åœ°å€å¢é‡di = 1, 2, â€¦ å…¶ä¸­ï¼Œiä¸ºæ¢æµ‹æ¬¡æ•°ã€‚</p><p>â€‹       <em>è¯¥æ–¹æ³•ä¸€æ¬¡æ¢æµ‹ä¸‹ä¸€ä¸ªåœ°å€ï¼Œç›´åˆ°æœ‰ç©ºçš„åœ°å€åæ’å…¥</em>ï¼Œ<strong>è‹¥æ•´ä¸ªç©ºé—´éƒ½æ‰¾ä¸åˆ°ç©ºä½™çš„åœ°å€ï¼Œåˆ™äº§ç”Ÿæº¢å‡º</strong>ã€‚å‡è®¾å½“å‰tableé•¿åº¦ä¸º16ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœè®¡ç®—å‡ºæ¥keyçš„hashå€¼ä¸º14ï¼Œå¦‚æœtable[14]ä¸Šå·²ç»æœ‰å€¼ï¼Œå¹¶ä¸”å…¶keyä¸å½“å‰keyä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå°±å‘ç”Ÿäº†hashå†²çªï¼Œè¿™ä¸ªæ—¶å€™å°†14åŠ 1å¾—åˆ°15ï¼Œå–table[15]è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœè¿˜æ˜¯å†²çªä¼šå›åˆ°0ï¼Œå–table[0],ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°å¯ä»¥æ’å…¥ã€‚</p><p>æŒ‰ç…§ä¸Šé¢çš„æè¿°ï¼Œå¯ä»¥æŠŠtableçœ‹æˆä¸€ä¸ªç¯å½¢æ•°ç»„ã€‚</p><p>å…ˆçœ‹ä¸€ä¸‹çº¿æ€§æ¢æµ‹ç›¸å…³çš„ä»£ç ï¼Œä»ä¸­ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥tableå®é™…æ˜¯ä¸€ä¸ªç¯ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(ThreadLocal&lt;?&gt; key, Object value)</span> </span>&#123;</span><br><span class="line">    ThreadLocal.ThreadLocalMap.Entry[] tab = table;</span><br><span class="line">    <span class="keyword">int</span> len = tab.length;</span><br><span class="line">    <span class="comment">//è®¡ç®—ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">int</span> i = key.threadLocalHashCode &amp; (len-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨çº¿æ€§æ¢æµ‹æ³•æŸ¥æ‰¾å…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">for</span> (ThreadLocal.ThreadLocalMap.Entry e = tab[i];</span><br><span class="line">         e != <span class="keyword">null</span>;</span><br><span class="line">         e = tab[i = nextIndex(i, len)]) &#123;</span><br><span class="line">        ThreadLocal&lt;?&gt; k = e.get();</span><br><span class="line">        <span class="comment">//table[i]ä¸Škeyä¸ä¸ºç©ºï¼Œå¹¶ä¸”å’Œå½“å‰keyç›¸åŒï¼Œæ›´æ–°value</span></span><br><span class="line">        <span class="keyword">if</span> (k == key) &#123;</span><br><span class="line">            e.value = value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * table[i]ä¸Šçš„keyä¸ºç©ºï¼Œè¯´æ˜è¢«å›æ”¶äº†</span></span><br><span class="line"><span class="comment">         * è¿™ä¸ªæ—¶å€™è¯´æ˜æ”¹table[i]å¯ä»¥é‡æ–°ä½¿ç”¨ï¼Œç”¨æ–°çš„key-valueå°†å…¶æ›¿æ¢,å¹¶åˆ é™¤å…¶ä»–æ— æ•ˆçš„entry</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">if</span> (k == <span class="keyword">null</span>) &#123;</span><br><span class="line">        replaceStaleEntry(key, value, i);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¬”è®°å‚è€ƒæ¥æºå¦‚ä¸‹ï¼š</p></blockquote><ul><li>[1]  <a href="https://www.bilibili.com/video/av98868538/">é»‘é©¬ç¨‹åºå‘˜-JavaåŸºç¡€æ•™ç¨‹ç”±æµ…å…¥æ·±å…¨é¢è§£æThreadLocal</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå­¦ä¹ ç¬”è®°ï¼ˆå››ï¼‰-åˆ†æ”¯åˆå¹¶æ¡†æ¶ã€CASå’Œvolatile</title>
      <link href="posts/3341669189.html"/>
      <url>posts/3341669189.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="åã€åˆ†æ”¯åˆå¹¶æ¡†æ¶"><a href="#åã€åˆ†æ”¯åˆå¹¶æ¡†æ¶" class="headerlink" title="åã€åˆ†æ”¯åˆå¹¶æ¡†æ¶"></a>åã€åˆ†æ”¯åˆå¹¶æ¡†æ¶</h1><h2 id="10-1ã€ForkJoinPool"><a href="#10-1ã€ForkJoinPool" class="headerlink" title="10.1ã€ForkJoinPool"></a>10.1ã€ForkJoinPool</h2><blockquote><p><code>Fork</code>ï¼šæŠŠä¸€ä¸ªå¤æ‚ä»»åŠ¡è¿›è¡Œåˆ†æ‹†ï¼Œå¤§äº‹åŒ–å°</p><p><code>Join</code>ï¼šæŠŠåˆ†æ‹†ä»»åŠ¡çš„ç»“æœè¿›è¡Œåˆå¹¶</p></blockquote><h2 id="10-2ã€åŸç†"><a href="#10-2ã€åŸç†" class="headerlink" title="10.2ã€åŸç†"></a>10.2ã€åŸç†</h2><blockquote><p>ç±»ä¼¼å½’å¹¶ç®—æ³•ï¼Œé‡‡å–åˆ†è€Œæ²»ä¹‹çš„æ€æƒ³</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302152043.jpg" alt="æœªå‘½åæ–‡ä»¶ (3)"></p><h2 id="10-3ã€ç›¸å…³ç±»"><a href="#10-3ã€ç›¸å…³ç±»" class="headerlink" title="10.3ã€ç›¸å…³ç±»"></a>10.3ã€ç›¸å…³ç±»</h2><h3 id="1ã€ForkJoinPool"><a href="#1ã€ForkJoinPool" class="headerlink" title="1ã€ForkJoinPool"></a>1ã€ForkJoinPool</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302153214.png" alt="img"></p><blockquote><p><strong>åˆ†æ”¯åˆå¹¶æ± </strong> ç±»æ¯”=&gt;  <strong>çº¿ç¨‹æ± </strong></p></blockquote><h3 id="2ã€ForkJoinTask"><a href="#2ã€ForkJoinTask" class="headerlink" title="2ã€ForkJoinTask"></a>2ã€ForkJoinTask</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302153333.png" alt="img"></p><blockquote><p><strong>ForkJoinTask</strong>  ç±»æ¯”=&gt;  <strong>FutureTask</strong></p></blockquote><h3 id="3ã€RecursiveTask"><a href="#3ã€RecursiveTask" class="headerlink" title="3ã€RecursiveTask"></a>3ã€RecursiveTask</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302153938.png" alt="img"></p><blockquote><p>é€’å½’ä»»åŠ¡ï¼šç»§æ‰¿åå¯ä»¥å®ç°é€’å½’(è‡ªå·±è°ƒè‡ªå·±)è°ƒç”¨çš„ä»»åŠ¡</p></blockquote><ul><li>ä»¥æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fibonacci</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">int</span> n;</span><br><span class="line">  Fibonacci(<span class="keyword">int</span> n) &#123; <span class="keyword">this</span>.n = n; &#125;</span><br><span class="line">  <span class="function">Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n </span><br><span class="line">      <span class="keyword">return</span> n;</span><br><span class="line">    Fibonacci f1 = <span class="keyword">new</span> Fibonacci(n - <span class="number">1</span>);</span><br><span class="line">    f1.fork();</span><br><span class="line">    Fibonacci f2 = <span class="keyword">new</span> Fibonacci(n - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> f2.compute() + f1.join();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-4ã€å®ä¾‹"><a href="#10-4ã€å®ä¾‹" class="headerlink" title="10.4ã€å®ä¾‹"></a>10.4ã€å®ä¾‹</h2><blockquote><p>ä½¿ç”¨RecursiveTaskè®¡ç®—ä»beginä¹˜åˆ°endï¼Œå…¶ä¸­beginã€endå‡ç”±ç”¨æˆ·è¾“å…¥ä¸”begin &lt; end</p></blockquote><h3 id="1ã€åˆ›å»ºä¸€ä¸ªMyTaskç±»"><a href="#1ã€åˆ›å»ºä¸€ä¸ªMyTaskç±»" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªMyTaskç±»"></a>1ã€åˆ›å»ºä¸€ä¸ªMyTaskç±»</h3><blockquote><p>è¿™ä¸ªç±»å®šä¹‰ç»§æ‰¿è‡³ <strong>RecursiveTask</strong> </p><p>åœ¨computeæ–¹æ³•ä¸­åˆ›å»ºä¸¤ä¸ªMyTaskå¯¹è±¡ï¼Œç„¶åè°ƒç”¨MyTaskå¯¹è±¡çš„forkæ–¹æ³•å¼€å¯é‡æ–°å¼€å¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œå†æ¬¡è°ƒç”¨computeæ–¹æ³•è®¡ç®—ã€‚</p><p>å¦‚æœä¼ å…¥é‚£ä¸¤ä¸ªMyTaskå¯¹è±¡ çš„end - begin &gt; 10ï¼Œé‚£ä¹ˆä¼šåœ¨è¯¥å¯¹è±¡ä¸­é‡æ–°å¼€å¯çº¿ç¨‹è°ƒç”¨computeæ–¹æ³•è¿›è¡Œè®¡ç®—ã€‚</p><p>è°ƒç”¨MyTaskå¯¹è±¡çš„joinæ–¹æ³•å¯ä»¥è·å¾—è¯¥å¯¹è±¡<strong>compute</strong> æ–¹æ³•å¾—åˆ°çš„ç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer ADJUST_VALUE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> begin;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTask</span><span class="params">(<span class="keyword">int</span> begin,<span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.begin = begin;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((end - begin) &lt;= ADJUST_VALUE) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœendå’Œbeginçš„å·®å€¼å°äº10ï¼Œé‚£ä¹ˆè¯æ˜æ•°æ®è®¡ç®—é‡å°ï¼Œæ­¤æ—¶ä¸ä½¿ç”¨åˆ†æ”¯åˆå¹¶æ¡†æ¶ï¼Œç›´æ¥è®¡ç®—</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = begin; i &lt;= end; i++) &#123;</span><br><span class="line">                result = result * i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> middle = (end + begin) / <span class="number">2</span>;</span><br><span class="line">        MyTask task01 = <span class="keyword">new</span> MyTask(begin,middle);</span><br><span class="line">        MyTask task02 = <span class="keyword">new</span> MyTask(middle + <span class="number">1</span>,end);</span><br><span class="line">        task01.fork();</span><br><span class="line">        task02.fork();</span><br><span class="line">        result = task01.join() + task02.join();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ä½¿ç”¨ForkJoinPoolè°ƒç”¨MyTaskä¸­çš„computeæ–¹æ³•"><a href="#2ã€ä½¿ç”¨ForkJoinPoolè°ƒç”¨MyTaskä¸­çš„computeæ–¹æ³•" class="headerlink" title="2ã€ä½¿ç”¨ForkJoinPoolè°ƒç”¨MyTaskä¸­çš„computeæ–¹æ³•"></a>2ã€ä½¿ç”¨ForkJoinPoolè°ƒç”¨MyTaskä¸­çš„computeæ–¹æ³•</h3><ul><li>åˆ›å»ºä¸€ä¸ªMyTaskå¯¹è±¡</li><li>åˆ›å»ºä¸€ä¸ªForkJoinPoolå¯¹è±¡</li><li>è°ƒç”¨ForkJoinPoolå¯¹è±¡çš„submitæ–¹æ³•ï¼Œä¼ å…¥ä¸Šé¢çš„MyTaskå¯¹è±¡ï¼Œsubmitæ–¹æ³•è¿”å›ä¸€ä¸ª<strong>ForkJoinTask</strong> å¯¹è±¡</li><li>æ ¹æ®<strong>ForkJoinTask</strong>çš„getæ–¹æ³•è·å–<code>MyTask</code>å¯¹è±¡çš„<code>compute</code>æ–¹æ³•çš„è®¡ç®—ç»“æœ</li><li>å…³é—­ForkJoinPoolå¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    MyTask task = <span class="keyword">new</span> MyTask(<span class="number">1</span>,<span class="number">11</span>);</span><br><span class="line">    ForkJoinPool pool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">    ForkJoinTask&lt;Integer&gt; joinTask = pool.submit(task);</span><br><span class="line">    Integer result = joinTask.get();</span><br><span class="line">    System.out.println(<span class="string">&quot;è®¡ç®—ç»“æœä¸º:&quot;</span> + result);</span><br><span class="line">    pool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ"><a href="#3ã€è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ" class="headerlink" title="3ã€è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ"></a>3ã€è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302161846.png" alt="image-20210302161845167"></p><h1 id="åä¸€ã€æ‚²è§‚é”ã€ä¹è§‚é”å’ŒCAS"><a href="#åä¸€ã€æ‚²è§‚é”ã€ä¹è§‚é”å’ŒCAS" class="headerlink" title="åä¸€ã€æ‚²è§‚é”ã€ä¹è§‚é”å’ŒCAS"></a>åä¸€ã€æ‚²è§‚é”ã€ä¹è§‚é”å’ŒCAS</h1><h2 id="11-1ã€æ‚²è§‚é”"><a href="#11-1ã€æ‚²è§‚é”" class="headerlink" title="11.1ã€æ‚²è§‚é”"></a>11.1ã€æ‚²è§‚é”</h2><blockquote><p>â€‹       æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡<strong>åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”</strong>ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚å†æ¯”å¦‚Javaé‡Œé¢çš„åŒæ­¥åŸè¯­<strong>synchronizedå…³é”®å­—çš„å®ç°å°±æ˜¯æ‚²è§‚é”ï¼Œvolatileå…³é”®å­—è™½ç„¶æ˜¯synchronizedå…³é”®å­—çš„è½»é‡çº§å®ç°ï¼Œä½†æ˜¯å…¶æ— æ³•ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿè¦æ­é…é”ä½¿ç”¨ã€‚</strong></p></blockquote><h2 id="11-2ã€ä¹è§‚é”"><a href="#11-2ã€ä¹è§‚é”" class="headerlink" title="11.2ã€ä¹è§‚é”"></a>11.2ã€ä¹è§‚é”</h2><blockquote><p>â€‹       é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»<strong>æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹</strong>ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºwrite_conditionæœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚</p></blockquote><h2 id="11-3ã€CAS-Compare-And-Swap"><a href="#11-3ã€CAS-Compare-And-Swap" class="headerlink" title="11.3ã€CAS(Compare And Swap)"></a>11.3ã€CAS(Compare And Swap)</h2><h3 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h3><blockquote><p>CASå°±æ˜¯æ ¹æ®<strong>ä¹è§‚é”</strong>çš„è®¾è®¡æ€æƒ³æ¥å®ç°ï¼Œåœ¨å–æ•°æ®çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´æ˜¯å¦æœ‰äººä¿®æ”¹ï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ã€‚</p><p><strong>CAS</strong> æ˜¯ç”±ç¡¬ä»¶å®ç°çš„</p><p>CASå¯ä»¥å°†read-modify-writeè¿™ç±»çš„æ“ä½œï¼ˆå¦‚i++ï¼‰è½¬æ¢ä¸ºåŸå­æ“ä½œ</p><p>ä¾‹å¦‚ï¼šAtomicIntegerä¸­çš„ <code>incrementAndGet()</code>å°±ä½¿ç”¨äº†CASè‡ªæ—‹é”</p></blockquote><ul><li>æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªå€¼0ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒè¿›è¡Œé€’å¢ï¼ŒåŸæœ¬ä¸ºä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒåŠ ä¸€æŠŠé”ï¼Œä½†ç°åœ¨ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªæ—‹é”æ¥å®Œæˆã€‚</li><li>è¯»å–å½“å‰å€¼ï¼Œå½“å‰éœ€è¦é€’å¢çš„å€¼<code>X</code>ä¸º0ï¼›è®¡ç®—ç»“æœå€¼ï¼Œ<code>X</code> çš„ç»“æœå€¼åº”ä¸º1ï¼Œåœ¨å°†1èµ‹ç»™<code>X</code> ä¹‹å‰ï¼Œæˆ‘ä»¬å†æ¬¡è¯»å–<code>X</code> çš„å€¼ï¼Œçœ‹çœ‹<code>X</code>çš„å€¼æ˜¯å¦å’Œç¬¬ä¸€æ¬¡è¯»å–çš„å†…å­˜å€¼ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œå°±å°†1èµ‹ç»™<code>X</code>ã€‚</li><li>å¦‚æœå½“å‰è¯»å–åˆ°çš„å€¼å’Œç¬¬ä¸€æ¬¡è¯»å–åˆ°çš„å€¼ä¸åŒï¼Œå‡è®¾å†…å­˜ä¸­<code>X</code>çš„å€¼å·²ç»ç”±0å˜ä¸º2ï¼Œé‚£ä¹ˆæ­¤æ—¶å†æ¬¡è¯»å–2ï¼Œè®¡ç®—ç»“æœï¼Œå¾—åˆ°3ï¼Œåœ¨å°†3å†™ç»™<code>X</code>ä¹‹å‰ï¼Œè¯»å–å†…å­˜å€¼ï¼Œçœ‹çœ‹è¿™æ¬¡è¯»å–åˆ°çš„å†…å­˜å€¼æ˜¯å¦å’Œä¸Šä¸€æ¬¡è¯»å–åˆ°çš„å€¼ï¼ˆ2ï¼‰ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œå°†3èµ‹ç»™<code>X</code>ï¼Œå¦åˆ™ç»§ç»­è‡ªæ—‹ï¼Œç›´åˆ°ä¿®æ”¹æˆåŠŸæˆ–è€…æ”¾å¼ƒæ“ä½œã€‚</li></ul><h3 id="2ã€CASåŸç†"><a href="#2ã€CASåŸç†" class="headerlink" title="2ã€CASåŸç†"></a>2ã€CASåŸç†</h3><blockquote><p><strong>CASåŸç†ï¼š</strong>CASæœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼Œå³<strong>å†…å­˜å€¼v,æ—§çš„æ“ä½œæ•°a,æ–°çš„æ“ä½œæ•°b</strong>ã€‚å½“æˆ‘ä»¬éœ€è¦æ›´æ–°vå€¼ä¸ºbæ—¶ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ¤æ–­vå€¼æ˜¯å¦å’Œæˆ‘ä»¬ä¹‹å‰çš„æ‰€è§å€¼aç›¸åŒï¼Œè‹¥ç›¸åŒåˆ™å°†vèµ‹å€¼ä¸ºbï¼Œè‹¥ä¸åŒï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚æ˜¯ä¸€ç§éé˜»å¡ç®—æ³•**ï¼ˆnon-blocking algorithmï¼‰.**åœ¨javaä¸­å¯ä»¥é€šè¿‡é”å’Œå¾ªç¯CASçš„æ–¹å¼æ¥å®ç°åŸå­æ“ä½œã€‚</p><p><strong>Javaä¸­çš„å®ç°ï¼š</strong>Javaä¸­ java.util.concurrent.atomicåŒ…ç›¸å…³ç±»å°±æ˜¯CASçš„å®ç°ï¼Œé€šè¿‡è‡ªæ—‹è½¬CASæ¥å°è¯•è·å¾—é”ã€‚</p><p>CASè‡ªæ—‹é”é€‚ç”¨äºé”ä½¿ç”¨è€…ä¿æŒé”æ—¶é—´æ¯”è¾ƒçŸ­çš„æƒ…å†µä¸­ï¼Œå› ä¸ºè‡ªæ—‹é”ä½¿ç”¨è€…ä¸€èˆ¬ä¿æŒé”çš„æ—¶é—´å¾ˆçŸ­ï¼Œæ‰€ä»¥æ‰é€‰æ‹©è‡ªæ—‹è€Œä¸æ˜¯ç¡çœ ã€‚</p><p>Javaé€šè¿‡<strong>é”</strong>å’Œå¾ªç¯<strong>CAS</strong>çš„æ–¹å¼å®ç°<strong>åŸå­æ“ä½œã€‚</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302183545.png" alt="image-20210302183544760"></p><blockquote><p>CASæœ€ç»ˆé€šè¿‡ <code>lock cmpxchg</code> æŒ‡ä»¤æ¥å®ç°</p></blockquote><h3 id="3ã€CASå­˜åœ¨çš„é—®é¢˜"><a href="#3ã€CASå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="3ã€CASå­˜åœ¨çš„é—®é¢˜"></a>3ã€CASå­˜åœ¨çš„é—®é¢˜</h3><ul><li>ABAé—®é¢˜ï¼š</li></ul><blockquote><p>â€‹        å› ä¸ºCASåœ¨è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œæ€»æ˜¯éœ€è¦æ¯”è¾ƒæ–°çš„æ“ä½œæ•°å’Œæ—§çš„æ“ä½œæ•°ï¼Œå¦‚æœç›¸åŒåˆ™æ›´æ–°ã€‚ä½†æ˜¯<strong>å¦‚æœæ–°çš„æ“ä½œæ•°ç»è¿‡ä¸¤æ¬¡ä¿®æ”¹ä¹‹åè¿”å›åŸæ¥çš„å€¼</strong>ï¼Œé‚£ä¹ˆä¹…å‡ºç°äº†ABAé—®é¢˜ã€‚<strong>è§£å†³é—®é¢˜çš„æ–¹æ³•å°±æ˜¯å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·</strong>ï¼Œä¸ä»…ä»…é€šè¿‡æ£€æŸ¥å€¼å¾—å˜åŒ–æ¥ç¡®å®šæ˜¯å¦æ›´æ–°ã€‚</p><p>æ¯”å¦‚ä¸¤ä¸ªçº¿ç¨‹</p></blockquote><ul><li>çº¿ç¨‹1 æŸ¥è¯¢Açš„å€¼ä¸ºaï¼Œä¸æ—§å€¼aæ¯”è¾ƒï¼Œ</li><li>çº¿ç¨‹2 æŸ¥è¯¢Açš„å€¼ä¸ºaï¼Œä¸æ—§å€¼aæ¯”è¾ƒï¼Œç›¸ç­‰ï¼Œæ›´æ–°ä¸ºbå€¼</li><li>çº¿ç¨‹2 æŸ¥è¯¢Açš„å€¼ä¸ºbï¼Œä¸æ—§å€¼bæ¯”è¾ƒï¼Œç›¸ç­‰ï¼Œæ›´æ–°ä¸ºaå€¼</li><li>çº¿ç¨‹1 ç›¸ç­‰ï¼Œæ›´æ–°Bçš„å€¼ä¸ºc</li></ul><blockquote><p>å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹1 å¯ä»¥æ­£å¸¸ è¿›è¡ŒCASæ“ä½œï¼Œå°†å€¼ä»aå˜ä¸ºc ä½†æ˜¯åœ¨è¿™ä¹‹é—´ï¼Œå®é™…Aå€¼å·²ç»å‘äº†a-&gt;b  b-&gt;açš„è½¬æ¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302182802.png" alt="image-20210302182801422"></p><h3 id="4ã€ä½¿ç”¨CASå®ç°çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨"><a href="#4ã€ä½¿ç”¨CASå®ç°çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨" class="headerlink" title="4ã€ä½¿ç”¨CASå®ç°çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨"></a>4ã€ä½¿ç”¨CASå®ç°çº¿ç¨‹å®‰å…¨çš„è®¡æ•°å™¨</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªCASCounterç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CASCounter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">long</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> expectedValue æœŸæœ›å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newValue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">compareAndSwap</span><span class="params">(<span class="keyword">long</span> expectedValue,<span class="keyword">long</span> newValue)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå½“å‰valueçš„å€¼ä¸æœŸæœ›çš„expectValueå€¼ä¸€æ ·ï¼Œå°±æŠŠå½“å‰valueå­—æ®µçš„å€¼æ¢ä¸ºnewValueå€¼</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(value == expectedValue) &#123;</span><br><span class="line">                value = newValue;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incrementAndGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> oldValue;</span><br><span class="line">        <span class="keyword">long</span> newValue;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            oldValue = value;</span><br><span class="line">            newValue = oldValue + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>(!compareAndSwap(oldValue,newValue));</span><br><span class="line">        <span class="keyword">return</span> newValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»º100ä¸ªçº¿ç¨‹ï¼Œè¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CASCounter casCounter = <span class="keyword">new</span> CASCounter();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(casCounter.incrementAndGet());</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302225835.png" alt="image-20210302225833762"></p><h2 id="11-4ã€CASçš„ABAé—®é¢˜"><a href="#11-4ã€CASçš„ABAé—®é¢˜" class="headerlink" title="11.4ã€CASçš„ABAé—®é¢˜"></a>11.4ã€CASçš„ABAé—®é¢˜</h2><blockquote><p>â€‹        CASå®ç°åŸå­æ“ä½œèƒŒåæœ‰ä¸€ä¸ªå‡è®¾ï¼šå…±äº«å˜é‡çš„å½“å‰å€¼å’Œå½“å‰çº¿ç¨‹æä¾›çš„æœŸæœ›å€¼ç›¸åŒï¼Œå°±è®¤ä¸ºè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡ã€‚</p><p>â€‹        å®é™…ä¸Šè¿™ç§å‡è®¾ä¸ä¸€å®šæ€»æ˜¯æˆç«‹ï¼Œè®¾æœ‰å…±äº«å˜é‡ <code>count</code> = 0</p><ul><li>Açº¿ç¨‹å¯¹ <code>count</code> å€¼ä¿®æ”¹ä¸º10</li><li>Bçº¿ç¨‹å¯¹ <code>count</code> å€¼ä¿®æ”¹ä¸º20</li><li>Cçº¿ç¨‹å¯¹ <code>count</code> å€¼ä¿®æ”¹ä¸º0</li></ul><p>â€‹        å½“å‰çº¿ç¨‹çœ‹åˆ° <code>count</code> å˜é‡çš„å€¼ç°åœ¨ä¸º0ï¼Œç°åœ¨èƒ½å¦è®¤ä¸º <code>count</code> å˜é‡çš„å€¼æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°å‘¢ï¼Ÿè¿™æ ·çš„ç»“æœèƒ½ä¸èƒ½è¢«æ¥å—ï¼Ÿ</p><p>â€‹        å¦‚æœæƒ³è¦è§„é¿ABAé—®é¢˜ï¼Œå¯ä»¥ä¸ºå…±äº«å˜é‡å¼•å…¥ä¸€ä¸ªä¿®è®¢å·ï¼ˆç‰ˆæœ¬å·ã€æ—¶é—´æˆ³ï¼‰ï¼Œæ¯æ¬¡ä¿®æ”¹å…±äº«å˜é‡æ—¶ï¼Œç›¸åº”çš„ä¿®è®¢å·å°±ä¼šå¢åŠ ä¸€ã€‚</p></blockquote><h2 id="11-5ã€åŸå­å˜é‡ç±»"><a href="#11-5ã€åŸå­å˜é‡ç±»" class="headerlink" title="11.5ã€åŸå­å˜é‡ç±»"></a>11.5ã€åŸå­å˜é‡ç±»</h2><blockquote><p>â€‹       åŸå­å˜é‡ç±»åŸºäºCASå®ç°ï¼Œå½“å¯¹å…±äº«å˜é‡è¿›è¡Œ <strong>read-modify-write</strong> æ›´æ–°æ“ä½œæ—¶ï¼Œä½¿ç”¨åŸå­å˜é‡ç±»å¯ä»¥ä¿éšœæ“ä½œçš„åŸå­æ€§å’Œå¯è§æ€§ã€‚å¯¹å˜é‡çš„ <strong>read-modify-write</strong> æ›´æ–°æ“ä½œæ˜¯æŒ‡å½“å‰çš„æ“ä½œä¸æ˜¯ä¸€ä¸ªç®€å•çš„å¤åˆ¶ï¼Œè€Œæ˜¯å˜é‡çš„æ–°å€¼ä¾èµ–äºå˜é‡çš„æ—§å€¼ï¼Œå¦‚è‡ªå¢æ“ä½œi++.</p><p>â€‹        åŸå­å˜é‡ç±»æœ‰åäºŒä¸ª</p></blockquote><table><thead><tr><th>åˆ†ç»„</th><th>åŸå­å˜é‡ç±»</th></tr></thead><tbody><tr><td>åŸºç¡€æ•°æ®å‹</td><td>AtomicIntegerã€AtomicLongã€AtomicBoolean</td></tr><tr><td>æ•°ç»„å‹</td><td>AtomicIntegerArrayã€AtomicLongArrayã€AtomicReferenceArray</td></tr><tr><td>å­—æ®µæ›´æ–°å™¨</td><td>AtomicIntegerFieldUpdaterã€AtomicLongFieldUpdaterã€AtomicReferenceFieldUpdater</td></tr><tr><td>å¼•ç”¨å‹</td><td>AtomicReferenceã€AtomicStampedReferenceã€AtomicMarlableReference</td></tr></tbody></table><h2 id="11-6ã€ä½¿ç”¨AtomicLongå®šä¹‰è®¡æ•°å™¨"><a href="#11-6ã€ä½¿ç”¨AtomicLongå®šä¹‰è®¡æ•°å™¨" class="headerlink" title="11.6ã€ä½¿ç”¨AtomicLongå®šä¹‰è®¡æ•°å™¨"></a>11.6ã€ä½¿ç”¨AtomicLongå®šä¹‰è®¡æ•°å™¨</h2><h1 id="åäºŒã€è½»é‡çº§åŒæ­¥æœºåˆ¶-volatile"><a href="#åäºŒã€è½»é‡çº§åŒæ­¥æœºåˆ¶-volatile" class="headerlink" title="åäºŒã€è½»é‡çº§åŒæ­¥æœºåˆ¶-volatile"></a>åäºŒã€è½»é‡çº§åŒæ­¥æœºåˆ¶-volatile</h1><h2 id="12-1ã€volatile-çš„ä½œç”¨"><a href="#12-1ã€volatile-çš„ä½œç”¨" class="headerlink" title="12.1ã€volatile çš„ä½œç”¨"></a>12.1ã€volatile çš„ä½œç”¨</h2><blockquote><p>â€‹        volatileå…³é”®å­—çš„ä½œç”¨æ˜¯ä½¿å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯è§ï¼Œè§£å†³äº†å˜é‡çš„<strong>å¯è§æ€§</strong></p><p>â€‹        volatileè®©å˜é‡æ¯æ¬¡åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½ä»<strong>ä¸»å­˜</strong>ä¸­å–ã€‚è€Œä¸æ˜¯ä»å„ä¸ªçº¿ç¨‹çš„â€œå·¥ä½œå†…å­˜â€ã€‚volatileå˜é‡å¯¹äºä¿è¯æ¯æ¬¡è®¿é—®çš„çº¿ç¨‹éƒ½èƒ½<strong>å¾—åˆ°å½“å‰volatileå˜é‡çš„æœ€æ–°å€¼</strong>ï¼Œä½†æ˜¯<strong>volatileå˜é‡å¹¶ä¸ä¿è¯å¹¶å‘çš„æ­£ç¡®æ€§ã€‚</strong></p><p>æ³¨ï¼švolatile å…³é”®å­—ä»…ä»…æ˜¯ä¿è¯æ‰€æœ‰çº¿ç¨‹å‡ä»ä¸»å†…å­˜ä¸­è·å–æ•°æ®ï¼Œ<strong>æ— æ³•ä¿è¯åŸå­æ€§</strong></p></blockquote><h2 id="12-2ã€volatileå’Œsynchronizedçš„åŒºåˆ«"><a href="#12-2ã€volatileå’Œsynchronizedçš„åŒºåˆ«" class="headerlink" title="12.2ã€volatileå’Œsynchronizedçš„åŒºåˆ«"></a>12.2ã€volatileå’Œsynchronizedçš„åŒºåˆ«</h2><ul><li>volatile å…³é”®å­—æ˜¯çº¿ç¨‹åŒæ­¥çš„è½»é‡çº§å®ç°ï¼Œæ‰€ä»¥ volatile æ€§èƒ½è‚¯å®šæ¯” synchronizedè¦å¥½ï¼›</li><li>volatile åªèƒ½ä¿®é¥°å˜é‡ï¼Œè€Œ synchronized å¯ä»¥ä¿®é¥°ä»£ç å—å’Œæ–¹æ³•</li><li>éšç€JDKæ–°ç‰ˆæœ¬çš„å‘å¸ƒï¼Œsynchronized çš„æ‰§è¡Œæ•ˆç‡ä¹Ÿæœ‰äº†å¾ˆå¤§çš„æå‡ï¼Œæ‰€ä»¥å¼€å‘ä¸­synchronizedçš„ä½¿ç”¨æ¯”ç‡è¿˜æ˜¯å¾ˆå¤§çš„ã€‚</li><li>å¤šçº¿ç¨‹è®¿é—® volatile å˜é‡ä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œè€Œ synchronized å¯èƒ½ä¼šé˜»å¡ï¼›</li><li>volatile å¯ä»¥ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œè€Œsynchronizedæ—¢å¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä¹Ÿå¯ä»¥ä¿è¯å¯è§æ€§ã€‚</li><li>å…³é”®å­— volatile è§£å†³çš„æ˜¯å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼›synchronized å¯ä»¥è§£å†³å¤šä¸ªçº¿ç¨‹ä¹‹é—´è®¿é—®å…¬å…±èµ„æºçš„åŒæ­¥æ€§</li></ul>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŸºç¡€å­¦ä¹ ï¼ˆäºŒï¼‰-é›†åˆæµå¼ç¼–ç¨‹</title>
      <link href="posts/3012219674.html"/>
      <url>posts/3012219674.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€é›†åˆæµçš„ç®€ä»‹"><a href="#ä¸€ã€é›†åˆæµçš„ç®€ä»‹" class="headerlink" title="ä¸€ã€é›†åˆæµçš„ç®€ä»‹"></a>ä¸€ã€é›†åˆæµçš„ç®€ä»‹</h1><h2 id="1-1ã€é›†åˆæµå¼ç¼–ç¨‹çš„ç®€ä»‹"><a href="#1-1ã€é›†åˆæµå¼ç¼–ç¨‹çš„ç®€ä»‹" class="headerlink" title="1.1ã€é›†åˆæµå¼ç¼–ç¨‹çš„ç®€ä»‹"></a>1.1ã€é›†åˆæµå¼ç¼–ç¨‹çš„ç®€ä»‹</h2><blockquote><p>Streamæ˜¯JDK8åå‡ºç°çš„æ–°ç‰¹æ€§ï¼Œä¹Ÿæ˜¯JDK8ä¸­æœ€å€¼å¾—å­¦ä¹ çš„ä¸¤ç§æ–°ç‰¹æ€§ä¹‹ä¸€ï¼ˆå¦ä¸€ä¸ªæ˜¯Lambdaè¡¨è¾¾å¼ï¼‰ã€‚</p><p>Streamæ˜¯å¯¹é›†åˆæ“ä½œçš„å¢å¼ºï¼Œæµä¸æ˜¯é›†åˆçš„å…ƒç´ ï¼Œä¸æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸è´Ÿè´£æ•°æ®å­˜å‚¨ï¼Œæµæ›´åƒæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯ä»¥å•å‘éå†ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ä¸å¯å¾ªç¯ã€‚</p></blockquote><h2 id="1-2ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆæµå¼ç¼–ç¨‹ï¼Ÿ"><a href="#1-2ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆæµå¼ç¼–ç¨‹ï¼Ÿ" class="headerlink" title="1.2ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆæµå¼ç¼–ç¨‹ï¼Ÿ"></a>1.2ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆæµå¼ç¼–ç¨‹ï¼Ÿ</h2><blockquote><p>æœ‰äº›æ—¶å€™ï¼Œå¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨åˆ°å…¶ä»–æ“ä½œçš„ç»“æœï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé›†åˆçš„æµå¼æ®ç¨‹å¯ä»¥å¤§å¹…åº¦çš„ç®€åŒ–ä»£ç çš„æ•°é‡ã€‚å°†æ•°æ®æºä¸­çš„æ•°æ®ï¼Œè¯»å–åˆ°ä¸€ä¸ªæµä¸­ï¼Œå¯ä»¥å¯¹è¿™ä¸ªæµä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œï¼ˆåˆ é™¤ã€è¿‡æ»¤ï¼Œæ˜ å°„..â€¦ï¼‰ã€‚æ¯æ¬¡çš„æ“ä½œç»“æœä¹Ÿæ˜¯ä¸€ä¸ªæµå¯¹è±¡ï¼Œå¯ä»¥å¯¹è¿™ä¸ªæµå†è¿›è¡Œå…¶ä»–çš„æ“ä½œã€‚</p></blockquote><h2 id="1-3ã€ä½¿ç”¨æ­¥éª¤"><a href="#1-3ã€ä½¿ç”¨æ­¥éª¤" class="headerlink" title="1.3ã€ä½¿ç”¨æ­¥éª¤"></a>1.3ã€ä½¿ç”¨æ­¥éª¤</h2><blockquote><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹é›†åˆä¸­çš„æ•°æ®ä½¿ç”¨æµå¼ç¼–ç¨‹ï¼Œéœ€è¦ç»è¿‡ä»¥ä¸‹ä¸‰æ­¥ï¼š</p></blockquote><ul><li>è·å–æ•°æ®æºï¼Œå°†æ•°æ®æºä¸­çš„æ•°æ®è¯»å–åˆ°æµä¸­</li><li>å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œå„ç§å„æ ·çš„å¤„ç†ã€‚</li><li>å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œæ•´åˆå¤„ç†ã€‚</li></ul><blockquote><p>â€‹        åœ¨ä¸Šè¿°ä¸‰ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿‡ç¨‹2ä¸­ï¼Œæœ‰è‹¥å¹²æ–¹æ³•ï¼Œå¯ä»¥å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œå„ç§å„æ ·çš„æ“ä½œï¼Œå¹¶ä¸”è¿”å›æµå¯¹è±¡æœ¬èº«ï¼Œè¿™æ ·çš„æ“ä½œï¼Œè¢«ç§°ä¸º<strong>ä¸­é—´æ“ä½œ</strong>ï¼Œè¿‡ç¨‹3ä¸­ï¼Œæœ‰è‹¥å¹²æ–¹æ³•ï¼Œå¯ä»¥å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œå„ç§å¤„ç†ï¼Œå¹¶å…³é—­æµï¼Œè¿™æ ·çš„æ“ä½œï¼Œè¢«ç§°ä¸º<strong>æœ€ç»ˆæ“ä½œ</strong>ã€‚</p><p>â€‹        åœ¨ä¸­é—´æ“ä½œå’Œæœ€ç»ˆæ“ä½œä¸­ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½æ˜¯å‡½æ•°å¼æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥å®ç°ï¼Œä½¿ç”¨é›†åˆçš„æµå¼ç¼–ç¨‹ï¼Œæ¥ç®€åŒ–ä»£ç é‡ï¼Œæ˜¯éœ€è¦å¯¹lambdaè¡¨è¾¾å¼åšåˆ°ç†Ÿç»ƒæŒæ¡ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301194131.png" alt="image-20210301194130742"></p><h1 id="äºŒã€æ•°æ®æºçš„è·å–"><a href="#äºŒã€æ•°æ®æºçš„è·å–" class="headerlink" title="äºŒã€æ•°æ®æºçš„è·å–"></a>äºŒã€æ•°æ®æºçš„è·å–</h1><h2 id="2-1ã€æ•°æ®æºç®€ä»‹"><a href="#2-1ã€æ•°æ®æºç®€ä»‹" class="headerlink" title="2.1ã€æ•°æ®æºç®€ä»‹"></a>2.1ã€æ•°æ®æºç®€ä»‹</h2><blockquote><p>â€‹        æ•°æ®æºï¼Œé¡¾åæ€ä¹‰ï¼Œæ—¢æ˜¯æµä¸­çš„æ•°æ®çš„æ¥æºã€‚æ˜¯é›†åˆçš„æµå¼ç¼–ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œå°†æ•°æ®æºä¸­çš„æ•°æ®è¯»å–åˆ°æµä¸­ï¼Œè¿›è¡Œå¤„ç†ã€‚</p><p>â€‹        æ³¨æ„ï¼š<strong>å°†æ•°æ®è¯»å–åˆ°æµä¸­è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œä¸æ•°æ®æºä¸­çš„æ•°æ®æ²¡æœ‰å…³ç³»ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸­é—´æ“ä½œå¯¹æµä¸­çš„æ•°æ®è¿›è¡Œå¤„ç†ã€è¿‡æ»¤ã€æ˜ å°„ã€æ’åº..ï¼Œæ­¤æ—¶æ˜¯ä¸ä¼šå½±å“æ•°æ®æºä¸­çš„æ•°æ®çš„ã€‚</strong></p></blockquote><h2 id="2-2ã€æ•°æ®æºè·å–"><a href="#2-2ã€æ•°æ®æºè·å–" class="headerlink" title="2.2ã€æ•°æ®æºè·å–"></a>2.2ã€æ•°æ®æºè·å–</h2><blockquote><p>â€‹        è¿™ä¸ªè¿‡ç¨‹ï¼Œå…¶å®æ˜¯å°†ä¸€ä¸ªå®¹å™¨ä¸­çš„æ•°æ®ï¼Œè¯»å–åˆ°ä¸€ä¸ªæµä¸­ï¼Œå› æ­¤<strong>æ— è®ºä»€ä¹ˆå®¹å™¨ä½œä¸ºæ•°æ®æºï¼Œè¯»å–åˆ°æµä¸­çš„æ–¹æ³•è¿”å›å€¼ä¸€å®šæ˜¯ä¸€ä¸ªStreamå¯¹è±¡ã€‚</strong></p></blockquote><h3 id="1ã€é›†åˆä½œä¸ºæ•°æ®æº"><a href="#1ã€é›†åˆä½œä¸ºæ•°æ®æº" class="headerlink" title="1ã€é›†åˆä½œä¸ºæ•°æ®æº"></a>1ã€é›†åˆä½œä¸ºæ•°æ®æº</h3><ul><li>è°ƒç”¨<strong>é›†åˆå¯¹è±¡</strong>çš„<strong>stream()æ–¹æ³•</strong>ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<strong>Streamå¯¹è±¡ã€‚</strong></li></ul><blockquote><p>è¿™é‡Œä»¥ArrayListå¯¹è±¡ä¸ºä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 å®ä¾‹åŒ–ä¸€ä¸ªé›†åˆ</span></span><br><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="comment">//2 å¡«å……é›†åˆä¸­çš„å…ƒç´ </span></span><br><span class="line">Collections.addAll(list,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line"><span class="comment">//3 è¯»å–é›†åˆä¸­çš„å…ƒç´ ï¼Œå°†å…¶è¯»å–åˆ°æµä¸­</span></span><br><span class="line">Stream&lt;Integer&gt; stream = list.stream();</span><br><span class="line"><span class="comment">//4 è¾“å‡ºstreamå¯¹è±¡</span></span><br><span class="line">System.out.println(stream);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301200137.png" alt="image-20210301200137447"></p><ul><li>è°ƒç”¨<strong>é›†åˆå¯¹è±¡</strong>çš„<strong>parallelStream()æ–¹æ³•</strong>ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<strong>Streamå¯¹è±¡ã€‚</strong></li></ul><blockquote><p>åŒºåˆ«ï¼šstram()æ–¹æ³•è·å–çš„æ˜¯ä¸€ä¸ª<strong>åŒæ­¥æµ</strong>ï¼Œè€ŒparallelStream()æ–¹æ³•è¿”å›ä¸€ä¸ª<strong>å¹¶å‘æµ</strong>ã€‚</p></blockquote><h3 id="2ã€æ•°ç»„ä½œä¸ºæ•°æ®æº"><a href="#2ã€æ•°ç»„ä½œä¸ºæ•°æ®æº" class="headerlink" title="2ã€æ•°ç»„ä½œä¸ºæ•°æ®æº"></a>2ã€æ•°ç»„ä½œä¸ºæ•°æ®æº</h3><ul><li>è°ƒç”¨æ•°æ®å·¥å…·ç±» <strong>Arrays</strong> çš„ <strong>stream()</strong> æ–¹æ³•ï¼Œä¼ å…¥è½¬æ¢ä¸ºæµå¯¹è±¡çš„æ•°ç»„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 å®ä¾‹åŒ–ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">Integer[] arr = <span class="keyword">new</span> Integer[]&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line"><span class="comment">//2 è¯»å–æ•°ç»„ä¸­çš„æ•°æ®åˆ°æµä¸­ï¼Œå¾—åˆ°ä¸€ä¸ªæµå¯¹è±¡ï¼Œä½¿ç”¨Arrayså·¥å…·ç±»ä¸­çš„streamæ–¹æ³•</span></span><br><span class="line">Stream&lt;Integer&gt; stream = Arrays.stream(arr);</span><br><span class="line"><span class="comment">//3 è¾“å‡ºå¾—åˆ°çš„Streamå¯¹è±¡</span></span><br><span class="line">System.out.println(stream);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åº</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301201154.png" alt="image-20210301201154216"></p><ul><li>å°†åŸºæœ¬æ•°æ®ç±»å‹æ•°ç»„è½¬æ¢ä¸ºæµå¯¹è±¡ï¼ŒåŒæ ·è°ƒç”¨æ•°æ®å·¥å…·ç±» <strong>Arrays</strong> çš„ <strong>stream()</strong> æ–¹æ³•ï¼Œä¼šæ ¹æ®ä¼ å…¥æ•°ç»„çš„ç±»å‹è¿”å›å¯¹åº”çš„æµå¯¹è±¡ã€‚</li></ul><blockquote><p>è¿™é‡Œä»¥intç±»å‹æ•°ç»„ä¸ºä¾‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 å®ä¾‹åŒ–ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line"><span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;</span><br><span class="line"><span class="comment">//2 è¯»å–æ•°ç»„ä¸­çš„æ•°æ®åˆ°æµä¸­ï¼Œå¾—åˆ°ä¸€ä¸ªæµå¯¹è±¡ï¼Œä½¿ç”¨Arrayså·¥å…·ç±»ä¸­çš„streamæ–¹æ³•</span></span><br><span class="line">IntStream stream = Arrays.stream(arr);</span><br><span class="line"><span class="comment">//3 è¾“å‡ºå¾—åˆ°çš„Streamå¯¹è±¡</span></span><br><span class="line">System.out.println(stream);</span><br></pre></td></tr></table></figure><h1 id="ä¸‰ã€æœ€ç»ˆæ“ä½œ"><a href="#ä¸‰ã€æœ€ç»ˆæ“ä½œ" class="headerlink" title="ä¸‰ã€æœ€ç»ˆæ“ä½œ"></a>ä¸‰ã€æœ€ç»ˆæ“ä½œ</h1><blockquote><p>é¦–å…ˆç¼–å†™ä¸€ä¸ªgetStreamé™æ€æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºå°†ä¸€ä¸ªæ•´æ•°é›†åˆè½¬æ¢ä¸ºä¸€ä¸ªStreamå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Stream&lt;Integer&gt; <span class="title">getStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 å®ä¾‹åŒ–ä¸€ä¸ªé›†åˆ</span></span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//2 å¡«å……é›†åˆä¸­çš„å…ƒç´ </span></span><br><span class="line">    Collections.addAll(list,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> list.stream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-1ã€ç®€ä»‹"><a href="#3-1ã€ç®€ä»‹" class="headerlink" title="3.1ã€ç®€ä»‹"></a>3.1ã€ç®€ä»‹</h2><blockquote><p>â€‹        å°†æµä¸­çš„æ•°æ®æ•´åˆåˆ°ä¸€èµ·ï¼Œå¯ä»¥å­˜å…¥ä¸€ä¸ªé›†åˆï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œéå†ã€æ•°æ®ç»Ÿè®¡.â€¦ï¼Œé€šè¿‡æœ€ç»ˆæ“ä½œï¼Œéœ€è¦æŒæ¡å¦‚ä½•ä»æµä¸­æå–å‡ºæ¥æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ã€‚<br>â€‹        æ³¨æ„äº‹é¡¹ï¼šæœ€ç»ˆæ“ä½œï¼Œä¹‹æ‰€ä»¥å«æœ€ç»ˆæ“ä½œï¼Œæ˜¯å› ä¸ºï¼Œåœ¨æœ€ç»ˆæ“ä½œæ‰§è¡Œç»“æŸåï¼Œä¼šå…³é—­è¿™ä¸ªæµï¼Œæµä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šé”€æ¯ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªå·²ç»å…³é—­äº†çš„æµï¼Œä¼šå‡ºç°å¼‚å¸¸ã€‚</p></blockquote><h2 id="3-2ã€collect"><a href="#3-2ã€collect" class="headerlink" title="3.2ã€collect"></a>3.2ã€collect</h2><blockquote><p>â€‹        <strong>å°†æµä¸­çš„æ•°æ®æ”¶é›†åˆ°ä¸€èµ·</strong>ï¼Œå¯¹è¿™äº›æ•°æ®è¿›è¡Œä¸€äº›å¤„ç†ï¼Œæœ€å¸¸è§çš„å¤„ç†ï¼Œå°±æ˜¯<strong>å°†æµä¸­çš„æ•°æ®å­˜å…¥ä¸€ä¸ªé›†åˆ</strong>ï¼Œcollectæ–¹æ³•çš„å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªCollectoræ¥å£ï¼Œè€Œä¸”è¿™ä¸ªæ¥å£å¹¶ä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå®ç°è¿™ä¸ªæ¥å£ï¼Œå¯ä»¥è‡ªå®šä¹‰æ”¶é›†çš„è§„åˆ™ï¼Œä½†æ˜¯ï¼Œç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸éœ€è¦è‡ªå®šä¹‰ã€‚</p><p>â€‹        ç›´æ¥ä½¿ç”¨ <code>Collectors</code> å·¥å…·ç±»æä¾›çš„æ–¹æ³•å³å¯ã€‚</p></blockquote><ul><li>å°†æµä¸­çš„æ•°æ®è½¬æˆList</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Collections.addAll(list,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">List&lt;Integer&gt; integerList = list.stream().collect(Collectors.toList());</span><br><span class="line">System.out.println(integerList);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301204010.png" alt="image-20210301204010558"></p><ul><li>å°†æµä¸­çš„æ•°æ®è½¬æˆä¸€ä¸ªSet</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Collections.addAll(list,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">Set&lt;Integer&gt; set = list.stream().collect(Collectors.toSet());</span><br><span class="line">System.out.println(set);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301204701.png" alt="image-20210301204701061"></p><ul><li>å°†æµä¸­çš„æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªMapï¼Œåˆ†åˆ«å®ç°<strong>é”®çš„ç”Ÿæˆè§„åˆ™</strong>å’Œ<strong>å€¼çš„ç”Ÿæˆè§„åˆ™</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Collections.addAll(list,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">Map&lt;String, Integer&gt; map = list.stream().collect(Collectors.toMap(ele -&gt; ele + <span class="string">&quot;&quot;</span>,ele -&gt; ele));</span><br><span class="line">System.out.println(map);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301205023.png" alt="image-20210301205023637"></p><h2 id="3-3ã€reduce"><a href="#3-3ã€reduce" class="headerlink" title="3.3ã€reduce"></a>3.3ã€reduce</h2><blockquote><p>å°†<strong>æµä¸­çš„æ•°æ®</strong>ä»¥ä¸€å®šçš„è§„åˆ™<strong>èšåˆ</strong>èµ·æ¥</p><p>reduceæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª BinaryOperator<T> å‡½æ•°å¼æ¥å£å¯¹è±¡ï¼Œè¿™ä¸ªæ¥å£æ˜¯BiFunctionçš„å­æ¥å£</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301211315.png" alt="image-20210301211315278"></p><blockquote><p>åœ¨ <strong>BinaryOperator</strong> æ¥å£ä¸­ï¼Œåˆå¯¹ <strong>BiFunction</strong> ä¸­çš„æ³›å‹åšäº†è¿›ä¸€æ­¥é™åˆ¶ï¼Œæ•… <strong>BinaryOperator</strong> çš„applyæ–¹æ³•ä¸­å‚æ•°å’Œè¿”å›å€¼éƒ½æ˜¯ä¸€ä¸ªç±»å‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301211548.png" alt="image-20210301211548880"></p><ul><li>ä½¿ç”¨reduceå‡½æ•°å®ç°å…ƒç´ ç›¸åŠ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 è¯»å–æ•°æ®æºï¼Œå¾—åˆ°æµå¯¹è±¡</span></span><br><span class="line">Stream&lt;Integer&gt; dataSource = getStream();</span><br><span class="line"><span class="comment">//2 æœ€ç»ˆæ“ä½œ</span></span><br><span class="line">Integer sum = dataSource.reduce((p1, p2) -&gt; p1 + p2).get();</span><br><span class="line">System.out.println(sum);</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢ä»£ç çš„æ‰§è¡Œé€»è¾‘ä¸ºï¼š</p><p>å°†é›†åˆç¬¬ä¸€äºŒä¸ªå…ƒç´ ä½œä¸ºp1ã€p2ï¼Œç„¶åå°†å¾—åˆ°çš„ç»“æœä½œä¸ºp1ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ä½œä¸ºp2ï¼Œå†æ¬¡æ‰§è¡Œå‡½æ•°ï¼Œä»¥æ­¤ç±»æ¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301212459.png" alt="image-20210301212459107"></p><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301212621.png" alt="image-20210301212621194"></p><h2 id="3-4ã€count"><a href="#3-4ã€count" class="headerlink" title="3.4ã€count"></a>3.4ã€count</h2><blockquote><p>ç»Ÿè®¡æµä¸­çš„<strong>å…ƒç´ æ•°é‡</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> count = getStream().count();</span><br><span class="line">System.out.println(<span class="string">&quot;æµä¸­æ•°æ®ä¸ªæ•°ä¸º:&quot;</span> + count);</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301213228.png" alt="image-20210301213228442"></p><h2 id="3-5ã€foreach"><a href="#3-5ã€foreach" class="headerlink" title="3.5ã€foreach"></a>3.5ã€foreach</h2><blockquote><p>foreachæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª Consumerå‡½æ•°æ¥å£å¯¹è±¡ï¼Œè¯¥æ¥å£ä¸­æœ‰ä¸€ä¸ªacceptæŠ½è±¡æ–¹æ³•ï¼Œacceptæ–¹æ³•<strong>æ¥å—ä¸€ä¸ªå‚æ•°</strong>ï¼Œ<strong>ä¸”æ²¡æœ‰è¿”å›å€¼</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs this operation on the given argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the input argument</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éå†æµä¸­çš„å…ƒç´ </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">getStream().forEach(ele -&gt; &#123;</span><br><span class="line">    System.out.println(ele);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>é…åˆæ–¹æ³•å¼•ç”¨ï¼Œä»¥ä¸Šä»£ç å¯ä»¥ç®€åŒ–ä¸ºï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getStream().forEach(System.out::println);</span><br></pre></td></tr></table></figure><h2 id="3-6ã€max-amp-min"><a href="#3-6ã€max-amp-min" class="headerlink" title="3.6ã€max&amp;min"></a>3.6ã€max&amp;min</h2><blockquote><p>è·å–æµä¸­çš„æœ€å¤§å…ƒç´ ã€æœ€å°å…ƒç´ </p><p>Streamç±»ä¸­ max å’Œ min æ–¹æ³•æºç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Optional&lt;T&gt; <span class="title">max</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; comparator)</span></span>;</span><br><span class="line"><span class="function">Optional&lt;T&gt; <span class="title">min</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; comparator)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>max å’Œ min æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª Comparator æ¥å£å¯¹è±¡ï¼Œè¯¥æ¥å£ä¸­æœ‰ä¸€ä¸ªcompareæ–¹æ³•ï¼Œç”¨äºè‡ªå®šä¹‰å¤§å°æ¯”è¾ƒè§„åˆ™</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(T o1, T o2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è·å–æµä¸­æœ€å¤§å€¼æœ€å°å€¼çš„ä»£ç å¦‚ä¸‹ï¼Œä¼ å…¥Integerç±»ä¸­çš„compareToæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Integer max = getStream().max(Integer::compareTo).get();</span><br><span class="line">System.out.println(<span class="string">&quot;é›†åˆä¸­æœ€å¤§çš„å…ƒç´ ä¸ºï¼š&quot;</span> + max);</span><br><span class="line">Integer min = getStream().min(Integer::compareTo).get();</span><br><span class="line">System.out.println(<span class="string">&quot;é›†åˆä¸­æœ€å¤§çš„å…ƒç´ ä¸ºï¼š&quot;</span> + min);</span><br></pre></td></tr></table></figure><blockquote><p>Integerç±»ä¸­å®ç°äº†Comparatoræ–¹æ³•ï¼Œé‡å†™äº†compareToæ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301215514.png" alt="image-20210301215514697"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Integer anotherInteger)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> compare(<span class="keyword">this</span>.value, anotherInteger.value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x &lt; y) ? -<span class="number">1</span> : ((x == y) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301215320.png" alt="image-20210301215320169"></p><h2 id="3-7ã€Matching"><a href="#3-7ã€Matching" class="headerlink" title="3.7ã€Matching"></a>3.7ã€Matching</h2><ul><li>allMatchï¼šåªæœ‰å½“æµä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œéƒ½åŒ¹é…æŒ‡å®šçš„è§„åˆ™æ—¶ï¼Œæ‰ä¼šè¿”å›true</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> result = getStream().allMatch(ele -&gt; ele &gt; <span class="number">50</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;é›†åˆä¸­æ˜¯å¦æ‰€æœ‰æ•°æ®éƒ½å¤§äº50ï¼Ÿï¼š&quot;</span> + result);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301220226.png" alt="image-20210301220226746"></p><ul><li>anyMatchï¼šåªè¦æµä¸­æœ‰ä»»æ„æ•°æ®æ»¡è¶³æŒ‡å®šè§„åˆ™ï¼Œå°±ä¼šè¿”å›true</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> result = getStream().anyMatch(ele -&gt; ele % <span class="number">2</span> == <span class="number">0</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¶æ•°ï¼Ÿ&quot;</span> + result);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301220436.png" alt="image-20210301220436936"></p><ul><li>noneMatchï¼šåªæœ‰å½“æµä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œéƒ½ä¸æ»¡è¶³æŒ‡å®šçš„è§„åˆ™æ—¶ï¼Œæ‰ä¼šè¿”å›true</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> result = getStream().noneMatch(ele -&gt; ele &gt; <span class="number">50</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;é›†åˆæ˜¯å¦éƒ½å°äº50ï¼Ÿ&quot;</span> + result);</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301220837.png" alt="image-20210301220837820"></p><h2 id="3-8ã€find"><a href="#3-8ã€find" class="headerlink" title="3.8ã€find"></a>3.8ã€find</h2><h3 id="1ã€findFirst"><a href="#1ã€findFirst" class="headerlink" title="1ã€findFirst"></a>1ã€findFirst</h3><blockquote><p>ä»æµä¸­è·å–ä¸€ä¸ªå…ƒç´ ï¼ˆè·å–å¼€å¤´çš„å…ƒç´ ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer integer = getStream().findFirst().get();</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º:&quot;</span> + integer);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301221400.png" alt="image-20210301221400180"></p><h3 id="2ã€findAny"><a href="#2ã€findAny" class="headerlink" title="2ã€findAny"></a>2ã€findAny</h3><blockquote><p>ä»æµä¸­è·å–ä¸€ä¸ªå…ƒç´ ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ˜¯è·å–çš„å¼€å¤´çš„å…ƒç´ ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Integer integer = getStream().findAny().get();</span><br><span class="line">System.out.println(<span class="string">&quot;å¯»æ‰¾çš„å…ƒç´ ä¸º:&quot;</span> + integer);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åº</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301221502.png" alt="image-20210301221502073"></p><h3 id="3ã€è¯´æ˜"><a href="#3ã€è¯´æ˜" class="headerlink" title="3ã€è¯´æ˜"></a>3ã€è¯´æ˜</h3><blockquote><p>â€‹        ä¸Šé¢çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œåœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä½†æ˜¯åœ¨<strong>å¤šçº¿ç¨‹</strong>çš„ç¯å¢ƒä¸‹ï¼Œ<code>findFirst</code> å’Œ <code>findAny</code> è¿”å›çš„ç»“æœå¯èƒ½ä¸ä¸€æ ·ã€‚</p><p>â€‹        <strong>findAnyåœ¨å¹¶è¡Œæµä¸­è·å–çš„å¯èƒ½ä¸æ˜¯é¦–å…ƒç´ </strong></p></blockquote><h2 id="3-9ã€IntStreamé¢å¤–çš„æœ€ç»ˆæ“ä½œ"><a href="#3-9ã€IntStreamé¢å¤–çš„æœ€ç»ˆæ“ä½œ" class="headerlink" title="3.9ã€IntStreamé¢å¤–çš„æœ€ç»ˆæ“ä½œ"></a>3.9ã€IntStreamé¢å¤–çš„æœ€ç»ˆæ“ä½œ</h2><h3 id="1ã€å‡†å¤‡ä¸€ä¸ªæ•°ç»„ï¼Œè½¬æ¢ä¸ºIntStream"><a href="#1ã€å‡†å¤‡ä¸€ä¸ªæ•°ç»„ï¼Œè½¬æ¢ä¸ºIntStream" class="headerlink" title="1ã€å‡†å¤‡ä¸€ä¸ªæ•°ç»„ï¼Œè½¬æ¢ä¸ºIntStream"></a>1ã€å‡†å¤‡ä¸€ä¸ªæ•°ç»„ï¼Œè½¬æ¢ä¸ºIntStream</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntStream <span class="title">getIntStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€è·å–æ•°æ®æœ€å¤§å€¼"><a href="#2ã€è·å–æ•°æ®æœ€å¤§å€¼" class="headerlink" title="2ã€è·å–æ•°æ®æœ€å¤§å€¼"></a>2ã€è·å–æ•°æ®æœ€å¤§å€¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(getIntStream().max().getAsInt());</span><br></pre></td></tr></table></figure><h3 id="3ã€è·å–æ•°æ®æœ€å°å€¼"><a href="#3ã€è·å–æ•°æ®æœ€å°å€¼" class="headerlink" title="3ã€è·å–æ•°æ®æœ€å°å€¼"></a>3ã€è·å–æ•°æ®æœ€å°å€¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(getIntStream().min().getAsInt());</span><br></pre></td></tr></table></figure><h3 id="4ã€è·å–æ•°ç»„å’Œ"><a href="#4ã€è·å–æ•°ç»„å’Œ" class="headerlink" title="4ã€è·å–æ•°ç»„å’Œ"></a>4ã€è·å–æ•°ç»„å’Œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(getIntStream().sum());</span><br></pre></td></tr></table></figure><h3 id="5ã€è·å–æµä¸­æ•°æ®æ•°é‡"><a href="#5ã€è·å–æµä¸­æ•°æ®æ•°é‡" class="headerlink" title="5ã€è·å–æµä¸­æ•°æ®æ•°é‡"></a>5ã€è·å–æµä¸­æ•°æ®æ•°é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(getIntStream().count());</span><br></pre></td></tr></table></figure><h3 id="6ã€è·å–æµä¸­æ‰€æœ‰æ•°æ®çš„å¹³å‡å€¼"><a href="#6ã€è·å–æµä¸­æ‰€æœ‰æ•°æ®çš„å¹³å‡å€¼" class="headerlink" title="6ã€è·å–æµä¸­æ‰€æœ‰æ•°æ®çš„å¹³å‡å€¼"></a>6ã€è·å–æµä¸­æ‰€æœ‰æ•°æ®çš„å¹³å‡å€¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(getIntStream().average().getAsDouble());</span><br></pre></td></tr></table></figure><h3 id="7ã€è·å–åˆ°ä¸€ä¸ªå¯¹æµä¸­æ•°æ®çš„åˆ†æç»“æœ"><a href="#7ã€è·å–åˆ°ä¸€ä¸ªå¯¹æµä¸­æ•°æ®çš„åˆ†æç»“æœ" class="headerlink" title="7ã€è·å–åˆ°ä¸€ä¸ªå¯¹æµä¸­æ•°æ®çš„åˆ†æç»“æœ"></a>7ã€è·å–åˆ°ä¸€ä¸ªå¯¹æµä¸­æ•°æ®çš„åˆ†æç»“æœ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IntSummaryStatistics statistics = getIntStream().summaryStatistics();</span><br></pre></td></tr></table></figure><ul><li>è·å–æœ€å¤§å€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;æœ€å¤§å€¼ä¸º:&quot;</span> + statistics.getMax());</span><br></pre></td></tr></table></figure><ul><li>è·å–æœ€å°å€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;æœ€å°å€¼ä¸º:&quot;</span> + statistics.getMin());</span><br></pre></td></tr></table></figure><ul><li>è·å–æ•°æ®å’Œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;å’Œä¸º:&quot;</span> + statistics.getSum());</span><br></pre></td></tr></table></figure><ul><li>è·å–å¹³å‡å€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;å¹³å‡å€¼ä¸º:&quot;</span> + statistics.getAverage());</span><br></pre></td></tr></table></figure><h2 id="3-10ã€æ³¨æ„äº‹é¡¹"><a href="#3-10ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="3.10ã€æ³¨æ„äº‹é¡¹"></a>3.10ã€æ³¨æ„äº‹é¡¹</h2><blockquote><p>åœ¨æ‰§è¡Œå®Œä»¥ä¸Šçš„<strong>æœ€ç»ˆæ“ä½œ</strong>åï¼Œæµå°†ä¼šè¢«å…³é—­ï¼Œæµä¸­æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«é”€æ¯ï¼Œå¦‚æœå»æ“ä½œä¸€ä¸ªå·²ç»å…³é—­çš„æµä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301210239.png" alt="image-20210301210239525"></p><h1 id="å››ã€ä¸­é—´æ“ä½œ"><a href="#å››ã€ä¸­é—´æ“ä½œ" class="headerlink" title="å››ã€ä¸­é—´æ“ä½œ"></a>å››ã€ä¸­é—´æ“ä½œ</h1><blockquote><p>åˆ›å»ºä¸€ä¸ªé™æ€å†…éƒ¨ç±»Studentï¼Œæ„é€ å‡½æ•°ã€Getter/Setterå’ŒtoStringçœç•¥ä¸å†™</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™ä¸€ä¸ªgetDataSourceæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªStreamå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Stream&lt;Student&gt; <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;Student&gt; students = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Collections.addAll(students,</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu1&quot;</span>,<span class="number">18</span>,<span class="number">98</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu2&quot;</span>,<span class="number">19</span>,<span class="number">40</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu3&quot;</span>,<span class="number">21</span>,<span class="number">50</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu4&quot;</span>,<span class="number">15</span>,<span class="number">60</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu5&quot;</span>,<span class="number">12</span>,<span class="number">92</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu6&quot;</span>,<span class="number">11</span>,<span class="number">61</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu7&quot;</span>,<span class="number">19</span>,<span class="number">96</span>)</span><br><span class="line">            );</span><br><span class="line">    <span class="keyword">return</span> students.stream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-1ã€ç®€ä»‹"><a href="#4-1ã€ç®€ä»‹" class="headerlink" title="4.1ã€ç®€ä»‹"></a>4.1ã€ç®€ä»‹</h2><blockquote><p>â€‹        å°†æ•°æ®ä»æ•°æ®æºä¸­è¯»å–åˆ°æµä¸­ï¼Œä¸­é—´æ“ä½œï¼Œå°±æ˜¯å¯¹æµä¸­çš„æ•°æ®è¿›è¡Œå„ç§å„æ ·çš„æ“ä½œã€å¤„ç†ï¼Œä¸­é—´æ“ä½œå¯ä»¥è¿ç»­æ“ä½œï¼Œ<strong>æ¯ä¸€ä¸ªæ“ä½œçš„è¿”å›å€¼éƒ½æ˜¯ä¸€ä¸ªStreamå¯¹è±¡</strong>ï¼Œå¯ä»¥ç»§ç»­è¿›è¡Œå…¶ä»–æ“ä½œï¼Œç›´åˆ°æ“ä½œç»“æŸã€‚</p></blockquote><h2 id="4-2ã€filter"><a href="#4-2ã€filter" class="headerlink" title="4.2ã€filter"></a>4.2ã€filter</h2><blockquote><p>æ¡ä»¶è¿‡æ»¤ï¼Œä»…ä¿ç•™<strong>æ»¡è¶³æŒ‡å®šæ¡ä»¶çš„æ•°æ®</strong>ï¼Œå…¶ä»–ä¸æ»¡è¶³çš„æ•°æ®éƒ½ä¼šè¢«<strong>å‰”é™¤</strong>ã€‚</p><p>Streamç±»ä¸­ filter æ–¹æ³•å¦‚ä¸‹ï¼Œè¿™ä¸ªæ–¹æ³•è¦æ±‚ä¼ å…¥ä¸€ä¸ªPredicateæ¥å£å¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">filter</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> T&gt; predicate)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>Predicateæ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301230501.png" alt="image-20210301230500980"></p><h3 id="1ã€è¿‡æ»¤æ‰é›†åˆä¸­æˆç»©ä¸åŠæ ¼çš„å­¦ç”Ÿ"><a href="#1ã€è¿‡æ»¤æ‰é›†åˆä¸­æˆç»©ä¸åŠæ ¼çš„å­¦ç”Ÿ" class="headerlink" title="1ã€è¿‡æ»¤æ‰é›†åˆä¸­æˆç»©ä¸åŠæ ¼çš„å­¦ç”Ÿ"></a>1ã€è¿‡æ»¤æ‰é›†åˆä¸­æˆç»©ä¸åŠæ ¼çš„å­¦ç”Ÿ</h3><blockquote><p>ç­›é€‰æ¡ä»¶ä¸º <code>å­¦ç”Ÿæˆç»© &gt;= 60</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getDataSource();</span><br><span class="line">stream.filter(ele -&gt; ele.score &gt;= <span class="number">60</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301231048.png" alt="image-20210301231048054"></p><h3 id="2ã€è¿‡æ»¤æ‰é›†åˆä¸­æœªæˆå¹´çš„å­¦ç”Ÿ"><a href="#2ã€è¿‡æ»¤æ‰é›†åˆä¸­æœªæˆå¹´çš„å­¦ç”Ÿ" class="headerlink" title="2ã€è¿‡æ»¤æ‰é›†åˆä¸­æœªæˆå¹´çš„å­¦ç”Ÿ"></a>2ã€è¿‡æ»¤æ‰é›†åˆä¸­æœªæˆå¹´çš„å­¦ç”Ÿ</h3><blockquote><p>ç­›é€‰æ¡ä»¶ä¸º <code>å­¦ç”Ÿå¹´é¾„ &gt;= 18</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getDataSource();</span><br><span class="line">stream.filter(ele -&gt; ele.age &gt;= <span class="number">18</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åº</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301231251.png" alt="image-20210301231251567"></p><h2 id="4-3ã€distinct"><a href="#4-3ã€distinct" class="headerlink" title="4.3ã€distinct"></a>4.3ã€distinct</h2><blockquote><p>å»é™¤é›†åˆä¸­<strong>é‡å¤çš„å…ƒç´ </strong>ï¼Œè¿™ä¸ªæ–¹æ³• <strong>æ²¡æœ‰</strong> å‚æ•°ï¼Œ<strong>å»é‡çš„è§„åˆ™ä¸HashSetç›¸åŒã€‚</strong> </p><p>å…ˆæ¯”è¾ƒhashCodeï¼Œå¦‚æœhashCodeç»“æœç›¸åŒï¼Œé‚£ä¹ˆä½¿ç”¨equalsæ–¹æ³•æ¯”è¾ƒ</p></blockquote><ul><li>é‡å†™Studentç±»ä¸­çš„equalså’ŒhashCodeæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    Student student = (Student) o;</span><br><span class="line">    <span class="keyword">return</span> age == student.age &amp;&amp;</span><br><span class="line">            score == student.score &amp;&amp;</span><br><span class="line">            name.equals(student.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(name, age, score);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹æ•°æ®æºï¼Œæ·»åŠ é‡å¤æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Stream&lt;Student&gt; <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;Student&gt; students = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Collections.addAll(students,</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu1&quot;</span>,<span class="number">18</span>,<span class="number">98</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu2&quot;</span>,<span class="number">19</span>,<span class="number">40</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu2&quot;</span>,<span class="number">19</span>,<span class="number">40</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu3&quot;</span>,<span class="number">21</span>,<span class="number">50</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu3&quot;</span>,<span class="number">21</span>,<span class="number">50</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu4&quot;</span>,<span class="number">15</span>,<span class="number">60</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu5&quot;</span>,<span class="number">12</span>,<span class="number">92</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu5&quot;</span>,<span class="number">12</span>,<span class="number">92</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu5&quot;</span>,<span class="number">12</span>,<span class="number">92</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu6&quot;</span>,<span class="number">11</span>,<span class="number">61</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;wuhu7&quot;</span>,<span class="number">19</span>,<span class="number">96</span>)</span><br><span class="line">            );</span><br><span class="line">    <span class="keyword">return</span> students.stream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨Streamç±»ä¸­çš„distinctæ–¹æ³•å»é‡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getDataSource();</span><br><span class="line">stream.distinct().forEach(System.out::println);</span><br></pre></td></tr></table></figure><ul><li>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301232417.png" alt="image-20210301232416852"></p><h2 id="4-4ã€sorted"><a href="#4-4ã€sorted" class="headerlink" title="4.4ã€sorted"></a>4.4ã€sorted</h2><blockquote><p>Streamç±»ä¸­æœ‰ä¸¤ä¸ªsortedæ–¹æ³•ï¼Œä¸€ä¸ªæœ‰å‚ï¼Œä¸€ä¸ªæ— å‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">sorted</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">sorted</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> T&gt; comparator)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="1ã€æœ‰å‚sorted"><a href="#1ã€æœ‰å‚sorted" class="headerlink" title="1ã€æœ‰å‚sorted"></a>1ã€æœ‰å‚sorted</h3><blockquote><p>æœ‰å‚ sorted æ–¹æ³•éœ€è¦æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªComparatoræ¥å£å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ¯”è¾ƒå¤§å°è§„åˆ™ã€‚</p></blockquote><ul><li>åœ¨è°ƒç”¨sortedæ—¶ä¼ å…¥ä¸€ä¸ªComparatoræ¥å£å¯¹è±¡ï¼Œè‡ªå®šä¹‰æ¯”è¾ƒå¤§å°è§„åˆ™</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getDataSource();</span><br><span class="line">stream.sorted((s1,s2) -&gt; s1.age - s2.age).forEach(System.out::println);</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301233953.png" alt="image-20210301233953340"></p><h3 id="2ã€æ— å‚sorted"><a href="#2ã€æ— å‚sorted" class="headerlink" title="2ã€æ— å‚sorted"></a>2ã€æ— å‚sorted</h3><blockquote><p>å°†æµä¸­çš„æ•°æ®ï¼ŒæŒ‰ç…§å…¶å¯¹åº”çš„ç±»å®ç°çš„Comparableæ¥å£æä¾›çš„æ¯”è¾ƒè§„åˆ™è¿›è¡Œæ’åºã€‚</p></blockquote><ul><li>è®©Studentç±»<strong>å®ç°Comparableæ¥å£</strong>ï¼Œ<strong>é‡å†™compareToæ–¹æ³•</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Student</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> score - student.score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ ¹æ® Student ä¸­ compareTo æ–¹æ³•å®šä¹‰çš„è§„åˆ™è¿›è¡Œæ’åº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getDataSource();</span><br><span class="line">stream.sorted().forEach(System.out::println);</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301233726.png" alt="image-20210301233726676"></p><h2 id="4-5ã€limit-amp-skip"><a href="#4-5ã€limit-amp-skip" class="headerlink" title="4.5ã€limit &amp; skip"></a>4.5ã€limit &amp; skip</h2><blockquote><p><code>limit</code> ï¼šé™åˆ¶ï¼Œæˆªå–æµä¸­æŒ‡å®šæ•°é‡çš„å…ƒç´ </p><p><code>skip</code>ï¼šè·³è¿‡ï¼Œè·³è¿‡æµä¸­æŒ‡å®šæ•°é‡çš„å…ƒç´ </p></blockquote><h3 id="1ã€limit"><a href="#1ã€limit" class="headerlink" title="1ã€limit"></a>1ã€limit</h3><blockquote><p>è·å–æˆç»©å‰äº”åçš„å­¦ç”Ÿä¿¡æ¯</p></blockquote><ul><li>ä¿®æ”¹å­¦ç”Ÿç±»ä¸­çš„compareToæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> student.score - score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä»£ç å¦‚ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDataSource().sorted().limit(<span class="number">5</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301234724.png" alt="image-20210301234724840"></p><h3 id="2ã€skip"><a href="#2ã€skip" class="headerlink" title="2ã€skip"></a>2ã€skip</h3><blockquote><p>è·³è¿‡é›†åˆä¸­çš„å‰äº”ä¸ªå­¦ç”Ÿï¼Œä»ç¬¬å…­ä¸ªå­¦ç”Ÿå¼€å§‹æ‰“å°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDataSource().sorted().skip(<span class="number">5</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301234956.png" alt="image-20210301234956322"></p><h3 id="3ã€limit-amp-skip"><a href="#3ã€limit-amp-skip" class="headerlink" title="3ã€limit&amp;skip"></a>3ã€limit&amp;skip</h3><blockquote><p>è¾“å‡ºé›†åˆä¸­æˆç»©åœ¨ç¬¬ä¸‰-ç¬¬ä¸ƒçš„å­¦ç”Ÿä¿¡æ¯ï¼Œä½¿ç”¨limitå’Œskip</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getDataSource().sorted().skip(<span class="number">2</span>).limit(<span class="number">5</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301235129.png" alt="image-20210301235129603"></p><h2 id="4-6ã€map-amp-flatMap"><a href="#4-6ã€map-amp-flatMap" class="headerlink" title="4.6ã€map&amp;flatMap"></a>4.6ã€map&amp;flatMap</h2><h3 id="1ã€map"><a href="#1ã€map" class="headerlink" title="1ã€map"></a>1ã€map</h3><blockquote><p>mapï¼š<strong>æä¾›ä¸€ä¸ªæ˜ å°„è§„åˆ™ï¼Œå¯¹æµä¸­çš„æ•°æ®è¿›è¡Œæ˜ å°„ï¼Œç”¨æ–°çš„æ•°æ®æ›¿æ¢æ—§çš„æ•°æ®</strong></p><p>Streamç±»ä¸­mapçš„æºç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;R&gt; <span class="function">Stream&lt;R&gt; <span class="title">map</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends R&gt; mapper)</span></span>;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­Functionæ¥å£æ˜¯ä¸€ä¸ª<strong>ä¼ å…¥ä¸€ä¸ªå‚æ•°</strong>ï¼Œ<strong>è¿”å›ä¸€ä¸ªè¿”å›å€¼</strong>çš„å‡½æ•°å¼æ¥å£</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302121510.png" alt="image-20210302121509802"></p><blockquote><p>å®é™…éœ€æ±‚ï¼š<strong>è·å–æ‰€æœ‰å­¦ç”Ÿçš„åå­—</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getDataSource();</span><br><span class="line">List&lt;String&gt; stuNameList = stream.map(ele -&gt; ele.getName()).collect(Collectors.toList());</span><br><span class="line">stuNameList.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302122007.png" alt="image-20210302122007006"></p><blockquote><p>ä¸Šé¢çš„ä»£ç ä¹Ÿå¯ä»¥ä½¿ç”¨Studentç±»ä¸­çš„æ–¹æ³•å¼•ç”¨æ¥å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getDataSource();</span><br><span class="line">List&lt;String&gt; stuNameList = stream.map(Student::getName).collect(Collectors.toList());</span><br><span class="line">stuNameList.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="2ã€flatMap"><a href="#2ã€flatMap" class="headerlink" title="2ã€flatMap"></a>2ã€flatMap</h3><blockquote><p>flatMapï¼š<strong>æ‰å¹³åŒ–æ˜ å°„</strong>ï¼Œä¸€èˆ¬ç”¨äºmapæ˜ å°„åï¼Œæµä¸­çš„æ•°æ®æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œè€Œæˆ‘ä»¬éœ€è¦å¯¹å®¹å™¨ä¸­çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰å¹³åŒ–æ˜ å°„ï¼Œå°†å®¹å™¨ä¸­çš„æ•°æ®ç›´æ¥è¯»å–åˆ°æµä¸­ã€‚</p></blockquote><ul><li>æ¨¡æ‹Ÿï¼šç»Ÿè®¡å­—ç¬¦ä¸²æ•°ç»„ä¸­æ‰€æœ‰å‡ºç°çš„å­—ç¬¦</li></ul><blockquote><p>æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>å°†å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½åˆ‡å‰²ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</li><li>å°†å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æ•°æ®è¿›è¡Œæ‰å¹³åŒ–æ˜ å°„</li><li>å¯¹æµä¸­çš„å­—ç¬¦ä¸²ä½¿ç”¨distinctè¿›è¡Œå»é‡</li><li>æ‰“å°</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String[] array = &#123;<span class="string">&quot;Hello&quot;</span>,<span class="string">&quot;World&quot;</span>,<span class="string">&quot;Hehe&quot;</span>&#125;;</span><br><span class="line">Stream&lt;String&gt; stringStream = Arrays.stream(array);</span><br><span class="line"><span class="comment">//ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å‡ºç°çš„å­—ç¬¦</span></span><br><span class="line">stringStream.map(s -&gt; s.split(<span class="string">&quot;&quot;</span>))</span><br><span class="line">            .flatMap(Arrays::stream)</span><br><span class="line">            .distinct()</span><br><span class="line">            .forEach(System.out::println);</span><br></pre></td></tr></table></figure><ul><li>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302124011.png" alt="image-20210302124010884"></p><h1 id="äº”ã€Collectorså·¥å…·ç±»"><a href="#äº”ã€Collectorså·¥å…·ç±»" class="headerlink" title="äº”ã€Collectorså·¥å…·ç±»"></a>äº”ã€Collectorså·¥å…·ç±»</h1><h2 id="5-1ã€æ¦‚å¿µ"><a href="#5-1ã€æ¦‚å¿µ" class="headerlink" title="5.1ã€æ¦‚å¿µ"></a>5.1ã€æ¦‚å¿µ</h2><blockquote><p>Collectors æ˜¯ä¸€ä¸ª<strong>å·¥å…·ç±»</strong>ï¼Œé‡Œé¢å°è£…äº†å¾ˆå¤šæ–¹æ³•ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–åˆ°ä¸€ä¸ª<strong>Collectoræ¥å£çš„å®ç°ç±»å¯¹è±¡</strong>ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨<strong>collectæ–¹æ³•</strong>ï¼Œå¯¹æµä¸­çš„æ•°æ®è¿›è¡Œå„ç§å„æ ·çš„<strong>å¤„ç†å’Œæ•´åˆ</strong>ã€‚</p></blockquote><h2 id="5-2ã€å¸¸ç”¨æ–¹æ³•"><a href="#5-2ã€å¸¸ç”¨æ–¹æ³•" class="headerlink" title="5.2ã€å¸¸ç”¨æ–¹æ³•"></a>5.2ã€å¸¸ç”¨æ–¹æ³•</h2><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>Collectors.toList()</td><td>å°†æµä¸­çš„æ•°æ®ï¼Œæ•´åˆåˆ°ä¸€ä¸ª <code>List</code> é›†åˆä¸­</td></tr><tr><td>Collectors.toSet()</td><td>å°†æµä¸­çš„æ•°æ®ï¼Œæ•´åˆåˆ°ä¸€ä¸ª <code>Set</code> é›†åˆä¸­</td></tr><tr><td>Collectors.toMap()</td><td>å°†æµä¸­çš„æ•°æ®ï¼Œæ•´åˆåˆ°ä¸€ä¸ª <code>Map</code> é›†åˆä¸­</td></tr><tr><td>maxBy()</td><td>æŒ‰ç…§æŒ‡å®šçš„è§„åˆ™ï¼Œæ‰¾åˆ°æµä¸­æœ€å¤§çš„å…ƒç´ ï¼Œç­‰åŒä¸ <code>max</code></td></tr><tr><td>minBy()</td><td>æŒ‰ç…§æŒ‡å®šçš„è§„åˆ™ï¼Œæ‰¾åˆ°æµä¸­æœ€å°çš„å…ƒç´ ï¼Œç­‰åŒä¸ <code>min</code></td></tr><tr><td>joining()</td><td>å°†æµä¸­çš„æ•°æ®æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ³¨æ„ï¼šåªèƒ½æ“ä½œæµä¸­æ˜¯ <code>String</code> çš„æ•°æ®</td></tr><tr><td>summingInt()</td><td>å°†æµä¸­çš„æ•°æ®æ˜ å°„æˆ <code>int</code> ç±»å‹çš„æ•°æ®ï¼Œå¹¶<strong>æ±‚å’Œ</strong></td></tr><tr><td>averagingInt()</td><td>å°†æµä¸­çš„æ•°æ®æ˜ å°„æˆ <code>int</code> ç±»å‹çš„æ•°æ®ï¼Œå¹¶<strong>æ±‚å¹³å‡å€¼</strong></td></tr><tr><td>summarizingInt()</td><td>å°†æµä¸­çš„æ•°æ®æ˜ å°„æˆ <code>int</code> ç±»å‹çš„æ•°æ®ï¼Œå¹¶<strong>è·å–æè¿°ä¿¡æ¯</strong></td></tr></tbody></table><h2 id="5-3ã€ç¤ºä¾‹ä»£ç "><a href="#5-3ã€ç¤ºä¾‹ä»£ç " class="headerlink" title="5.3ã€ç¤ºä¾‹ä»£ç "></a>5.3ã€ç¤ºä¾‹ä»£ç </h2><h3 id="1ã€joining"><a href="#1ã€joining" class="headerlink" title="1ã€joining"></a>1ã€joining</h3><ul><li>æ‹¼æ¥å­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 å‡†å¤‡ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä½œä¸ºæ•°æ®æº</span></span><br><span class="line">String[] dataSource = &#123;<span class="string">&quot;wuhu&quot;</span>,<span class="string">&quot;qifei&quot;</span>,<span class="string">&quot;java&quot;</span>&#125;;</span><br><span class="line"><span class="comment">//2 å°†æ•°ç»„ä¸­çš„æ•°æ®è½¬æ¢ä¸ºæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;String&gt; stream = Arrays.stream(dataSource);</span><br><span class="line"><span class="comment">//3 ä½¿ç”¨joiningå°†æµä¸­çš„æ•°æ®æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">String collect = stream.collect(Collectors.joining());</span><br><span class="line">System.out.println(<span class="string">&quot;æ‹¼æ¥ä¹‹åçš„ç»“æœä¸º:&quot;</span> + collect);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302134642.png" alt="image-20210302134641765"></p><blockquote><p>é‡è½½æ–¹æ³•ä¸€</p><ul><li>ä¼ å…¥ä¸€ä¸ªåˆ†éš”ç¬¦ï¼Œä»¤æ‹¼æ¥è€Œæˆçš„å­—ç¬¦ä¸²æ ¹æ®ä¼ å…¥çš„åˆ†éš”ç¬¦åˆ†å‰²å¼€æ¥ï¼Œæ ¼å¼ä¸º:</li></ul><p>å­—ç¬¦ä¸² <code>åˆ†éš”ç¬¦</code> å­—ç¬¦ä¸²2<code>åˆ†éš”ç¬¦</code> å­—ç¬¦ä¸²3 â€¦</p><ul><li>ä¼ å…¥ä¸€ä¸ªåˆ†éš”ç¬¦ã€ä¸€ä¸ªå‰ç¼€å’Œä¸€ä¸ªå°¾ç¼€ï¼Œæ‹¼æ¥è€Œæˆçš„ç»“æœå­—ç¬¦ä¸²æ ¼å¼ä¸º</li></ul><p>â€œå‰ç¼€â€ å­—ç¬¦ä¸² <code>åˆ†éš”ç¬¦</code> å­—ç¬¦ä¸²2<code>åˆ†éš”ç¬¦</code> å­—ç¬¦ä¸²3 â€¦ â€œåç¼€â€</p></blockquote><ul><li>ä¼ å…¥åˆ†éš”ç¬¦çš„joining</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 å‡†å¤‡ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä½œä¸ºæ•°æ®æº</span></span><br><span class="line">String[] dataSource = &#123;<span class="string">&quot;wuhu&quot;</span>,<span class="string">&quot;qifei&quot;</span>,<span class="string">&quot;java&quot;</span>&#125;;</span><br><span class="line"><span class="comment">//2 å°†æ•°ç»„ä¸­çš„æ•°æ®è½¬æ¢ä¸ºæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;String&gt; stream = Arrays.stream(dataSource);</span><br><span class="line"><span class="comment">//3 ä½¿ç”¨joiningå°†æµä¸­çš„æ•°æ®æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">String collect = stream.collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;æ‹¼æ¥ä¹‹åçš„ç»“æœä¸º:&quot;</span> + collect);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302135340.png" alt="image-20210302135340206"></p><ul><li>ä¼ å…¥åˆ†éš”ç¬¦ã€å‰ç¼€å’Œå°¾ç¼€çš„joining</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 å‡†å¤‡ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä½œä¸ºæ•°æ®æº</span></span><br><span class="line">String[] dataSource = &#123;<span class="string">&quot;wuhu&quot;</span>,<span class="string">&quot;qifei&quot;</span>,<span class="string">&quot;java&quot;</span>&#125;;</span><br><span class="line"><span class="comment">//2 å°†æ•°ç»„ä¸­çš„æ•°æ®è½¬æ¢ä¸ºæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;String&gt; stream = Arrays.stream(dataSource);</span><br><span class="line"><span class="comment">//3 ä½¿ç”¨joiningå°†æµä¸­çš„æ•°æ®æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">String collect = stream.collect(Collectors.joining(<span class="string">&quot;, &quot;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;]&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;æ‹¼æ¥ä¹‹åçš„ç»“æœä¸º:&quot;</span> + collect);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302135440.png" alt="image-20210302135439927"></p><h3 id="2ã€summingInt"><a href="#2ã€summingInt" class="headerlink" title="2ã€summingInt"></a>2ã€summingInt</h3><blockquote><p>Collectors ä¸­ summingInt æ–¹æ³•çš„æºç å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302135726.png" alt="image-20210302135726430"></p><blockquote><p>summingIntæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªToIntFunctionæ¥å£å¯¹è±¡ ï¼Œè¿™ä¸ªæ¥å£çš„æŠ½è±¡æ–¹æ³•å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºintç±»å‹æ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToIntFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">applyAsInt</span><span class="params">(T value)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¾“å‡ºå­—ç¬¦ä¸²æ•°ç»„ä¸­çš„å­—ç¬¦ä¸²æ€»é•¿åº¦</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 å‡†å¤‡ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œä½œä¸ºæ•°æ®æº</span></span><br><span class="line">String[] dataSource = &#123;<span class="string">&quot;wuhu&quot;</span>,<span class="string">&quot;qifei&quot;</span>,<span class="string">&quot;java&quot;</span>&#125;;</span><br><span class="line"><span class="comment">//2 å°†æ•°ç»„ä¸­çš„æ•°æ®è½¬æ¢ä¸ºæµå¯¹è±¡</span></span><br><span class="line">Stream&lt;String&gt; stream = Arrays.stream(dataSource);</span><br><span class="line"><span class="comment">//ä½¿ç”¨summingIntæ–¹æ³•ï¼Œè¾“å‡ºå­—ç¬¦ä¸²æ•°ç»„çš„æ€»é•¿åº¦</span></span><br><span class="line">Integer sumLength = stream.collect(Collectors.summingInt(ele -&gt; ele.length()));</span><br><span class="line">System.out.println(<span class="string">&quot;æ•°ç»„ä¸­å­—ç¬¦ä¸²æ€»é•¿åº¦ä¸ºï¼š&quot;</span> + sumLength);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302140113.png" alt="image-20210302140113830"></p><h1 id="å…­ã€ç»¼åˆæ¡ˆä¾‹"><a href="#å…­ã€ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="å…­ã€ç»¼åˆæ¡ˆä¾‹"></a>å…­ã€ç»¼åˆæ¡ˆä¾‹</h1><blockquote><p>ä¸€ä¸ªé›†åˆä¸­å­˜å‚¨äº†è‹¥å¹²ä¸ªå­¦ç”Ÿå¯¹è±¡ï¼Œè¦æ±‚ç¼–ç å®ç°ä»¥ä¸‹åŠŸèƒ½</p><p>å…¶ä¸­ï¼Œå­¦ç”Ÿç±»çš„å±æ€§å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Integer score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ•°æ®æºå¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Stream&lt;Student&gt; <span class="title">getStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Student&gt; students = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Collections.addAll(students,</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–1&quot;</span>,<span class="number">18</span>,<span class="number">90</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–2&quot;</span>,<span class="number">15</span>,<span class="number">60</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–3&quot;</span>,<span class="number">12</span>,<span class="number">70</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–4&quot;</span>,<span class="number">11</span>,<span class="number">65</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–5&quot;</span>,<span class="number">19</span>,<span class="number">85</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–6&quot;</span>,<span class="number">20</span>,<span class="number">40</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–7&quot;</span>,<span class="number">25</span>,<span class="number">30</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–8&quot;</span>,<span class="number">30</span>,<span class="number">99</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–9&quot;</span>,<span class="number">18</span>,<span class="number">100</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–10&quot;</span>,<span class="number">18</span>,<span class="number">20</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–11&quot;</span>,<span class="number">18</span>,<span class="number">45</span>),</span><br><span class="line">            <span class="keyword">new</span> Student(<span class="string">&quot;èŠœæ¹–12&quot;</span>,<span class="number">18</span>,<span class="number">55</span>)</span><br><span class="line">            );</span><br><span class="line">    <span class="keyword">return</span> students.stream();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-1ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿä¿¡æ¯"><a href="#6-1ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿä¿¡æ¯" class="headerlink" title="6.1ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿä¿¡æ¯"></a>6.1ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿä¿¡æ¯</h2><blockquote><p>ä½¿ç”¨ä¸­é—´æ“ä½œ <code>filter</code> ï¼Œç­›é€‰æ¡ä»¶ä¸ºå­¦ç”Ÿæˆç»© &gt;= 60</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getStream();</span><br><span class="line">stream.filter(ele -&gt; ele.getScore() &gt;= <span class="number">60</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302142209.png" alt="image-20210302142208348"></p><h2 id="6-2ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿå§“å"><a href="#6-2ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿå§“å" class="headerlink" title="6.2ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿå§“å"></a>6.2ã€æ‰€æœ‰åŠæ ¼çš„å­¦ç”Ÿå§“å</h2><blockquote><p>ä½¿ç”¨ä¸­é—´æ“ä½œ <code>filter</code> å’Œ <code>map</code> ï¼Œå…¶ä¸­ç­›é€‰æ¡ä»¶ä¸º <code>å­¦ç”Ÿæˆç»©&gt;=60</code> ï¼Œåœ¨ç­›é€‰å®ŒåŠæ ¼çš„å­¦ç”Ÿåï¼Œéœ€è¦ä½¿ç”¨ <code>map</code> å°†å­¦ç”Ÿå¯¹è±¡æ˜ å°„ä¸º å­¦ç”Ÿå§“å</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getStream();</span><br><span class="line">stream.filter(ele -&gt; ele.getScore() &gt;= <span class="number">60</span>).map(Student::getName).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302142450.png" alt="image-20210302142450138"></p><h2 id="6-3ã€æ‰€æœ‰å­¦ç”Ÿçš„å¹³å‡æˆç»©"><a href="#6-3ã€æ‰€æœ‰å­¦ç”Ÿçš„å¹³å‡æˆç»©" class="headerlink" title="6.3ã€æ‰€æœ‰å­¦ç”Ÿçš„å¹³å‡æˆç»©"></a>6.3ã€æ‰€æœ‰å­¦ç”Ÿçš„å¹³å‡æˆç»©</h2><blockquote><p>ç”¨åˆ°æµå¯¹è±¡ <code>mapToInt</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†Streamå¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªIntStreamå¯¹è±¡ï¼Œå†è°ƒç”¨ IntStream å¯¹è±¡çš„ <code>average</code> å’Œ <code>getAsDouble</code> æ–¹æ³•å³å¯ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getStream();</span><br><span class="line"><span class="keyword">double</span> avgScore = stream.mapToInt(Student::getScore).average().getAsDouble();</span><br><span class="line">System.out.println(<span class="string">&quot;æ‰€æœ‰å­¦ç”Ÿçš„å¹³å‡æˆç»©ä¸ºï¼š&quot;</span> + avgScore);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302143236.png" alt="image-20210302143236123"></p><h2 id="6-4ã€ç­çº§çš„å‰ä¸‰å"><a href="#6-4ã€ç­çº§çš„å‰ä¸‰å" class="headerlink" title="6.4ã€ç­çº§çš„å‰ä¸‰å"></a>6.4ã€ç­çº§çš„å‰ä¸‰å</h2><blockquote><p>å…ˆä½¿ç”¨Streamå¯¹è±¡çš„ <code>sorted</code> æ–¹æ³•æ’åºï¼Œç„¶åä½¿ç”¨ <code>limit</code> å–å‰ä¸‰æ¡å³å¯ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; studentStream = getStream();</span><br><span class="line">studentStream.sorted((s1,s2) -&gt; s2.getScore() - s1.getScore()).limit(<span class="number">3</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302143523.png" alt="image-20210302143522931"></p><h2 id="6-5ã€ç­çº§çš„3-10å"><a href="#6-5ã€ç­çº§çš„3-10å" class="headerlink" title="6.5ã€ç­çº§çš„3-10å"></a>6.5ã€ç­çº§çš„3-10å</h2><blockquote><p>å…ˆä½¿ç”¨Streamå¯¹è±¡çš„ <code>sorted</code> æ–¹æ³•æ’åºï¼Œç„¶åä½¿ç”¨ <code>skip</code> è·³è¿‡å‰ä¸‰æ¡ï¼Œå†ç”¨<code>limit</code>å–åé¢ä¸ƒæ¡å³å¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; studentStream = getStream();</span><br><span class="line">studentStream.sorted((s1,s2) -&gt; s2.getScore() - s1.getScore()).skip(<span class="number">3</span>).limit(<span class="number">7</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302143728.png" alt="image-20210302143727979"></p><h2 id="6-6ã€æ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿçš„å¹³å‡æˆç»©"><a href="#6-6ã€æ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿçš„å¹³å‡æˆç»©" class="headerlink" title="6.6ã€æ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿçš„å¹³å‡æˆç»©"></a>6.6ã€æ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿçš„å¹³å‡æˆç»©</h2><blockquote><p>å…ˆä½¿ç”¨ <code>filter</code> ç­›é€‰æ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿï¼Œç„¶åä½¿ç”¨ <code>mapToInt</code> å°†æµå¯¹è±¡è½¬æ¢ä¸ºIntStreamæµå¯¹è±¡ï¼Œæœ€åè°ƒç”¨IntStreamæµå¯¹è±¡çš„ <code>average</code> å’Œ <code>getAsDouble</code> æ–¹æ³•å³å¯ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getStream();</span><br><span class="line"><span class="keyword">double</span> avgScore = stream.filter(ele -&gt; ele.getScore() &lt; <span class="number">60</span>).mapToInt(Student::getScore).average().getAsDouble();</span><br><span class="line">System.out.println(<span class="string">&quot;æ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿçš„å¹³å‡æˆç»©ä¸ºï¼š&quot;</span> + avgScore);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302143956.png" alt="image-20210302143956708"></p><h2 id="6-7ã€å°†åŠæ ¼çš„å­¦ç”Ÿï¼ŒæŒ‰ç…§é™åºé¡ºåºè¾“å‡ºæ‰€æœ‰ä¿¡æ¯"><a href="#6-7ã€å°†åŠæ ¼çš„å­¦ç”Ÿï¼ŒæŒ‰ç…§é™åºé¡ºåºè¾“å‡ºæ‰€æœ‰ä¿¡æ¯" class="headerlink" title="6.7ã€å°†åŠæ ¼çš„å­¦ç”Ÿï¼ŒæŒ‰ç…§é™åºé¡ºåºè¾“å‡ºæ‰€æœ‰ä¿¡æ¯"></a>6.7ã€å°†åŠæ ¼çš„å­¦ç”Ÿï¼ŒæŒ‰ç…§é™åºé¡ºåºè¾“å‡ºæ‰€æœ‰ä¿¡æ¯</h2><blockquote><p>å…ˆä½¿ç”¨ <code>filter</code> ç­›é€‰æ‰€æœ‰åŠæ ¼å­¦ç”Ÿï¼Œç„¶åä½¿ç”¨<code>sorted</code> è¿›è¡Œæ’åºï¼Œå†è¾“å‡ºæ‰€æœ‰åŠæ ¼å­¦ç”Ÿä¿¡æ¯å³å¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getStream();</span><br><span class="line">stream.filter(ele -&gt; ele.getScore() &gt;= <span class="number">60</span>).sorted((s1,s2) -&gt; s2.getScore() - s1.getScore()).forEach(System.out::println);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302144148.png" alt="image-20210302144148021"></p><h2 id="6-8ã€ç­çº§å­¦ç”Ÿçš„æ€»åˆ†"><a href="#6-8ã€ç­çº§å­¦ç”Ÿçš„æ€»åˆ†" class="headerlink" title="6.8ã€ç­çº§å­¦ç”Ÿçš„æ€»åˆ†"></a>6.8ã€ç­çº§å­¦ç”Ÿçš„æ€»åˆ†</h2><blockquote><p>ä½¿ç”¨æµå¯¹è±¡çš„ <code>mapTo</code> æ–¹æ³•ï¼Œå°†æµå¯¹è±¡è½¬æ¢ä¸ºIntStreamå¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>sum</code> æ–¹æ³•å³å¯ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Student&gt; stream = getStream();</span><br><span class="line"><span class="keyword">int</span> sum = stream.mapToInt(Student::getScore).sum();</span><br><span class="line">System.out.println(<span class="string">&quot;ç­çº§æ‰€æœ‰å­¦ç”Ÿæ€»æˆç»©ä¸º:&quot;</span> + sum);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302144349.png" alt="image-20210302144349019"></p>]]></content>
      
      
      <categories>
          
          <category> JavaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰-è¯»å†™é”ã€é˜»å¡é˜Ÿåˆ—ã€çº¿ç¨‹æ± å’Œåˆ†æ”¯åˆå¹¶æ¡†æ¶</title>
      <link href="posts/2958134976.html"/>
      <url>posts/2958134976.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸ƒã€ReentrantReadWriteLock"><a href="#ä¸ƒã€ReentrantReadWriteLock" class="headerlink" title="ä¸ƒã€ReentrantReadWriteLock"></a>ä¸ƒã€ReentrantReadWriteLock</h1><blockquote><p>ReentrantReadWriteLockæ˜¯ä¸€æŠŠ<strong>å¯é‡å…¥è¯»å†™é”</strong></p></blockquote><h2 id="7-1ã€æ€§è´¨"><a href="#7-1ã€æ€§è´¨" class="headerlink" title="7.1ã€æ€§è´¨"></a>7.1ã€æ€§è´¨</h2><h3 id="1ã€å¯é‡å…¥"><a href="#1ã€å¯é‡å…¥" class="headerlink" title="1ã€å¯é‡å…¥"></a>1ã€å¯é‡å…¥</h3><blockquote><p>å¦‚æœä½ äº†è§£è¿‡synchronizedå…³é”®å­—ï¼Œä¸€å®šçŸ¥é“ä»–çš„å¯é‡å…¥æ€§ï¼Œå¯é‡å…¥å°±æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥é‡å¤åŠ é”ï¼Œæ¯æ¬¡åŠ é”çš„æ—¶å€™countå€¼åŠ 1ï¼Œæ¯æ¬¡é‡Šæ”¾é”çš„æ—¶å€™countå‡1ï¼Œç›´åˆ°countä¸º0ï¼Œå…¶ä»–çš„çº¿ç¨‹æ‰å¯ä»¥å†æ¬¡è·å–ã€‚</p></blockquote><h3 id="2ã€è¯»å†™åˆ†ç¦»"><a href="#2ã€è¯»å†™åˆ†ç¦»" class="headerlink" title="2ã€è¯»å†™åˆ†ç¦»"></a>2ã€è¯»å†™åˆ†ç¦»</h3><blockquote><p>æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªæ•°æ®ï¼Œä¸ç®¡æ˜¯å‡ ä¸ªçº¿ç¨‹åŒæ—¶è¯»éƒ½ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å†™å°±ä¸ä¸€æ ·äº†ï¼Œå‡ ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œæ›´æ”¹å°±å¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå› æ­¤æƒ³å‡ºäº†ä¸€ä¸ªæ–¹æ³•å°±æ˜¯å¯¹æ•°æ®åŠ é”ï¼Œè¿™æ—¶å€™å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼š</p><p>çº¿ç¨‹å†™æ•°æ®çš„æ—¶å€™åŠ é”æ˜¯ä¸ºäº†ç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§ï¼Œä½†æ˜¯çº¿ç¨‹è¯»æ•°æ®çš„æ—¶å€™å†åŠ é”å°±ä¼šå¤§å¤§é™ä½æ•ˆç‡ï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±å¯¹å†™æ•°æ®å’Œè¯»æ•°æ®åˆ†å¼€ï¼ŒåŠ ä¸Šä¸¤æŠŠä¸åŒçš„é”ï¼Œä¸ä»…ä¿è¯äº†æ­£ç¡®æ€§ï¼Œè¿˜èƒ½æé«˜æ•ˆç‡ã€‚</p></blockquote><h3 id="3ã€å¯ä»¥é”é™çº§"><a href="#3ã€å¯ä»¥é”é™çº§" class="headerlink" title="3ã€å¯ä»¥é”é™çº§"></a>3ã€å¯ä»¥é”é™çº§</h3><blockquote><p>çº¿ç¨‹è·å–å†™å…¥é”åå¯ä»¥è·å–è¯»å–é”ï¼Œç„¶åé‡Šæ”¾å†™å…¥é”ï¼Œè¿™æ ·å°±ä»å†™å…¥é”å˜æˆäº†è¯»å–é”ï¼Œä»è€Œå®ç°é”é™çº§çš„ç‰¹æ€§ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228122842.png" alt="image-20210228122842386"></p><h3 id="4ã€ä¸å¯é”å‡çº§"><a href="#4ã€ä¸å¯é”å‡çº§" class="headerlink" title="4ã€ä¸å¯é”å‡çº§"></a>4ã€ä¸å¯é”å‡çº§</h3><blockquote><p>çº¿ç¨‹è·å–è¯»é”æ˜¯ä¸èƒ½ç›´æ¥å‡çº§ä¸ºå†™å…¥é”çš„ã€‚éœ€è¦é‡Šæ”¾æ‰€æœ‰è¯»å–é”ï¼Œæ‰å¯è·å–å†™é”ï¼Œ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228122914.png" alt="image-20210228122914209"></p><h2 id="7-2ã€ReadWriteLockDemo"><a href="#7-2ã€ReadWriteLockDemo" class="headerlink" title="7.2ã€ReadWriteLockDemo"></a>7.2ã€ReadWriteLockDemo</h2><h3 id="1ã€æ¨¡æ‹Ÿæ²¡æœ‰åŠ é”çš„æƒ…å†µ"><a href="#1ã€æ¨¡æ‹Ÿæ²¡æœ‰åŠ é”çš„æƒ…å†µ" class="headerlink" title="1ã€æ¨¡æ‹Ÿæ²¡æœ‰åŠ é”çš„æƒ…å†µ"></a>1ã€æ¨¡æ‹Ÿæ²¡æœ‰åŠ é”çš„æƒ…å†µ</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªMyCacheç±»ç”¨äºæ¨¡æ‹Ÿç¼“å­˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key,Object value)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å…¥æ•°æ®&quot;</span> + key);</span><br><span class="line">        <span class="comment">//åœ¨è¿™é‡Œæ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å…¥å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å–æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="comment">//åœ¨è¿™é‡Œæ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Object result = map.get(key);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å–å®Œæˆ&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºåä¸ªçº¿ç¨‹ï¼Œäº”ä¸ªç”¨äºå­˜æ•°æ®ï¼Œäº”ä¸ªç”¨äºå–æ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MyCache cache = <span class="keyword">new</span> MyCache();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> tempInt = i;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        cache.put(tempInt + <span class="string">&quot;&quot;</span>,tempInt + <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;,<span class="string">&quot;put&quot;</span> + i).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> tempInt = i;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        cache.get(tempInt + <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;,<span class="string">&quot;get&quot;</span> + i).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228130858.png" alt="image-20210228130856655"></p><h3 id="2ã€å¼•å…¥ReentrantReadWriteLock"><a href="#2ã€å¼•å…¥ReentrantReadWriteLock" class="headerlink" title="2ã€å¼•å…¥ReentrantReadWriteLock"></a>2ã€å¼•å…¥ReentrantReadWriteLock</h3><blockquote><p>ä¿®æ”¹MyCacheç±»ï¼Œå¼•å…¥è¯»å†™é”</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">//å¼•å…¥ReentrantReadWriteLock</span></span><br><span class="line">    <span class="keyword">private</span> ReadWriteLock readWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key,Object value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ç”±äºputæ˜¯å†™æ“ä½œï¼Œæ‰€ä»¥å¼•å…¥ä¸€ä¸ªå†™é”</span></span><br><span class="line">        readWriteLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å…¥æ•°æ®&quot;</span> + key);</span><br><span class="line">            <span class="comment">//åœ¨è¿™é‡Œæ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">            <span class="keyword">try</span> &#123; TimeUnit.MILLISECONDS.sleep(<span class="number">500</span>); &#125; <span class="keyword">catch</span> (Exception e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t å†™å…¥å®Œæˆ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//getæ˜¯è¯»æ“ä½œï¼Œå¼•å…¥è¯»é”ã€‚</span></span><br><span class="line">        readWriteLock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å–æ•°æ®&quot;</span>);</span><br><span class="line">            <span class="comment">//åœ¨è¿™é‡Œæ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span><br><span class="line">            <span class="keyword">try</span> &#123; TimeUnit.MILLISECONDS.sleep(<span class="number">500</span>); &#125; <span class="keyword">catch</span> (Exception e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">            Object result = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t è¯»å–å®Œæˆ&quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å†æ¬¡è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœï¼Œå†™æ—¶æ•°æ®å¾—åˆ°ä¸€è‡´æ€§ä¿éšœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228132056.png" alt="image-20210228132056118"></p><h1 id="å…«ã€BlockingQueueDemoé˜»å¡é˜Ÿåˆ—"><a href="#å…«ã€BlockingQueueDemoé˜»å¡é˜Ÿåˆ—" class="headerlink" title="å…«ã€BlockingQueueDemoé˜»å¡é˜Ÿåˆ—"></a>å…«ã€BlockingQueueDemoé˜»å¡é˜Ÿåˆ—</h1><h2 id="8-1ã€åŸºæœ¬ä»‹ç»"><a href="#8-1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="8.1ã€åŸºæœ¬ä»‹ç»"></a>8.1ã€åŸºæœ¬ä»‹ç»</h2><blockquote><p>é˜»å¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­èµ·çš„ä½œç”¨å¦‚ä¸‹å›¾</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228134508.png" alt="img"></p><blockquote><p><strong>çº¿ç¨‹1å¾€é˜»å¡é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ ï¼Œçº¿ç¨‹2ä»é˜»å¡é˜Ÿåˆ—é‡Œç§»é™¤å…ƒç´ </strong></p></blockquote><ul><li>å½“é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä»é˜Ÿåˆ—ä¸­<strong>è·å–</strong>å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡</li><li>å½“é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œä»é˜Ÿåˆ—ä¸­<strong>æ·»åŠ </strong>å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡</li></ul><blockquote><p>è¯•å›¾ä»ç©ºçš„é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹å¾€ç©ºçš„é˜Ÿåˆ—æ’å…¥æ–°çš„å…ƒç´ </p><p>è¯•å›¾å‘å·²æ»¡çš„é˜Ÿåˆ—ä¸­æ·»åŠ æ–°å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æˆ–è€…å®Œå…¨æ¸…ç©ºï¼Œä½¿é˜Ÿåˆ—å˜å¾—ç©ºé—²èµ·æ¥å¹¶åç»­æ–°å¢</p></blockquote><h2 id="8-2ã€é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„"><a href="#8-2ã€é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„" class="headerlink" title="8.2ã€é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„"></a>8.2ã€é˜»å¡é˜Ÿåˆ—çš„ç”¨å¤„</h2><blockquote><p>åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼šæ‰€è°“é˜»å¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šæŒ‚èµ·çº¿ç¨‹ï¼ˆå³é˜»å¡waitã€awaitï¼‰ï¼Œä¸€æ—¦æ¡ä»¶æ»¡è¶³ï¼Œè¢«æŒ‚èµ·çš„çº¿ç¨‹åˆä¼šè‡ªåŠ¨è¢«å”¤èµ·ï¼ˆnotifyã€signalï¼‰</p><p>ä¸ºä»€ä¹ˆéœ€è¦BlockingQueue</p><p>å¥½å¤„æ˜¯æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒä»€ä¹ˆæ—¶å€™éœ€è¦é˜»å¡çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦å”¤é†’çº¿ç¨‹ï¼Œå› ä¸ºè¿™ä¸€åˆ‡BlockingQueueéƒ½ç»™ä½ ä¸€æ‰‹åŒ…åŠäº†</p><p>åœ¨concurrentåŒ…å‘å¸ƒä»¥å‰ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬æ¯ä¸ªç¨‹åºå‘˜éƒ½å¿…é¡»å»è‡ªå·±æ§åˆ¶è¿™äº›ç»†èŠ‚ï¼Œå°¤å…¶è¿˜è¦å…¼é¡¾æ•ˆç‡å’Œçº¿ç¨‹å®‰å…¨ï¼Œè€Œè¿™ä¼šç»™æˆ‘ä»¬çš„ç¨‹åºå¸¦æ¥ä¸å°çš„å¤æ‚åº¦ã€‚</p></blockquote><h2 id="8-3ã€BlockingQueueçš„æ¶æ„ä»‹ç»å’Œç§ç±»åˆ†æ"><a href="#8-3ã€BlockingQueueçš„æ¶æ„ä»‹ç»å’Œç§ç±»åˆ†æ" class="headerlink" title="8.3ã€BlockingQueueçš„æ¶æ„ä»‹ç»å’Œç§ç±»åˆ†æ"></a>8.3ã€BlockingQueueçš„æ¶æ„ä»‹ç»å’Œç§ç±»åˆ†æ</h2><h3 id="1ã€æ¶æ„ä»‹ç»"><a href="#1ã€æ¶æ„ä»‹ç»" class="headerlink" title="1ã€æ¶æ„ä»‹ç»"></a>1ã€æ¶æ„ä»‹ç»</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228135937.png" alt="img"></p><h3 id="2ã€ç§ç±»åˆ†æ"><a href="#2ã€ç§ç±»åˆ†æ" class="headerlink" title="2ã€ç§ç±»åˆ†æ"></a>2ã€ç§ç±»åˆ†æ</h3><ul><li><strong>ArrayBlockingQueue</strong></li></ul><blockquote><p>ç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p></blockquote><ul><li><strong>LinkedBlockingQueue</strong></li></ul><blockquote><p>ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„<strong>æœ‰ç•Œï¼ˆä½†å¤§å°é»˜è®¤å€¼ä¸ºinteger.MAX_VALUEï¼‰</strong>é˜»å¡é˜Ÿåˆ—ã€‚</p></blockquote><ul><li>PriorityBlockingQueue</li></ul><blockquote><p>æ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p></blockquote><ul><li>DelayQueue</li></ul><blockquote><p>ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p></blockquote><ul><li><strong>SynchronousQueue</strong></li></ul><blockquote><p>ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿå³å•ä¸ªå…ƒç´ çš„é˜Ÿåˆ—ã€‚</p><p>è¯¥é˜Ÿåˆ—ä¸­æ°¸è¿œåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œç”Ÿäº§ä¸€ä¸ªæ¶ˆè´¹ä¸€ä¸ªã€‚</p></blockquote><ul><li>LinkedTransferQueue</li></ul><blockquote><p>ç”±é“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</p></blockquote><ul><li>LinkedBlockingDeque</li></ul><blockquote><p>ç”±é“¾è¡¨ç»„æˆçš„<strong>åŒå‘</strong>é˜»å¡é˜Ÿåˆ—ã€‚</p></blockquote><h2 id="8-4ã€BlockingQueueæ ¸å¿ƒæ–¹æ³•"><a href="#8-4ã€BlockingQueueæ ¸å¿ƒæ–¹æ³•" class="headerlink" title="8.4ã€BlockingQueueæ ¸å¿ƒæ–¹æ³•"></a>8.4ã€BlockingQueueæ ¸å¿ƒæ–¹æ³•</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228141219.png" alt="img"></p><table><thead><tr><th>æŠ›å‡ºå¼‚å¸¸</th><th>å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œaddæ’å…¥å…ƒç´ ä¼šæŠ›IllegalStateException:Queue full  å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œå†å¾€é˜Ÿåˆ—é‡Œremoveç§»é™¤å…ƒç´ ä¼šæŠ›NoSuchElementException</th></tr></thead><tbody><tr><td><strong>ç‰¹æ®Šå€¼</strong></td><td><strong>æ’å…¥æ–¹æ³•ï¼ŒæˆåŠŸtureå¤±è´¥falseï¼›                                                                             ç§»é™¤æ–¹æ³•ï¼ŒæˆåŠŸè¿”å›å‡ºé˜Ÿåˆ—çš„å…ƒç´ ï¼Œé˜Ÿåˆ—é‡Œæ²¡æœ‰å°±è¿”å›null</strong></td></tr><tr><td><strong>ä¸€ç›´é˜»å¡</strong></td><td><strong>å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç»§ç»­å¾€é˜Ÿåˆ—é‡Œputå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ç›´åˆ°putæ•°æ®orå“åº”ä¸­æ–­é€€å‡ºï¼›                                                                                        å½“é˜»å¡é˜Ÿåˆ—ç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»é˜Ÿåˆ—é‡Œtakeå…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡æ¶ˆè´¹è€…çº¿ç¨‹ç›´åˆ°é˜Ÿåˆ—å¯ç”¨</strong></td></tr><tr><td><strong>è¶…æ—¶é€€å‡º</strong></td><td><strong>å½“é˜»å¡é˜Ÿåˆ—æ»¡æ—¶ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ä¸€å®šæ—¶é—´ï¼Œè¶…è¿‡é™æ—¶åç”Ÿäº§è€…çº¿ç¨‹ä¼šé€€å‡º</strong></td></tr></tbody></table><h2 id="8-5ã€é˜»å¡é˜Ÿåˆ—APIä¹‹æŠ›å‡ºå¼‚å¸¸ç»„"><a href="#8-5ã€é˜»å¡é˜Ÿåˆ—APIä¹‹æŠ›å‡ºå¼‚å¸¸ç»„" class="headerlink" title="8.5ã€é˜»å¡é˜Ÿåˆ—APIä¹‹æŠ›å‡ºå¼‚å¸¸ç»„"></a>8.5ã€é˜»å¡é˜Ÿåˆ—APIä¹‹æŠ›å‡ºå¼‚å¸¸ç»„</h2><h3 id="1ã€é˜»å¡é˜Ÿåˆ—çš„addæ–¹æ³•"><a href="#1ã€é˜»å¡é˜Ÿåˆ—çš„addæ–¹æ³•" class="headerlink" title="1ã€é˜»å¡é˜Ÿåˆ—çš„addæ–¹æ³•"></a>1ã€é˜»å¡é˜Ÿåˆ—çš„addæ–¹æ³•</h3><blockquote><p>å¾€å·²æ»¡çš„é˜Ÿåˆ—ä¸­addå…ƒç´ ä¼šæŠ¥å¼‚å¸¸</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">System.out.println(blockingQueue.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.add(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.add(<span class="string">&quot;c&quot;</span>));</span><br><span class="line"><span class="comment">//æ­¤æ—¶å†addç¬¬å››ä¸ªä¼šæŠ¥Queue fullå¼‚å¸¸</span></span><br><span class="line">System.out.println(blockingQueue.add(<span class="string">&quot;d&quot;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228154833.png" alt="image-20210228154832276"></p><h3 id="2ã€é˜»å¡é˜Ÿåˆ—çš„removeæ–¹æ³•"><a href="#2ã€é˜»å¡é˜Ÿåˆ—çš„removeæ–¹æ³•" class="headerlink" title="2ã€é˜»å¡é˜Ÿåˆ—çš„removeæ–¹æ³•"></a>2ã€é˜»å¡é˜Ÿåˆ—çš„removeæ–¹æ³•</h3><blockquote><p>é˜»å¡é˜Ÿåˆ—çš„removeæœ‰ä¸¤ä¸ªé‡è½½æ–¹æ³•</p></blockquote><ul><li>ä¸€ä¸ªç”¨äºåˆ é™¤ä¼ å…¥çš„å¯¹è±¡ï¼Œå¦‚æœåˆ é™¤æˆåŠŸè¿”å›trueï¼Œåˆ é™¤å¤±è´¥æˆ–å…ƒç´ ä¸å­˜åœ¨è¿”å›false</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span>;</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤å¹¶è¿”å›æœ€å…ˆè¿›å…¥é˜»å¡é˜Ÿåˆ—çš„å…ƒç´ ï¼Œè¿™ä¸ªæ–¹æ³•ç»§æ‰¿è‡ªQueueæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">E <span class="title">remove</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœé˜»å¡é˜Ÿåˆ—ä¸ºç©ºæ—¶è°ƒç”¨removeæ–¹æ³•ï¼Œæ­¤æ—¶ä¼šæŠ¥NoSuchElementExceptionå¼‚å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">System.out.println(blockingQueue.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.add(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.add(<span class="string">&quot;c&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç§»é™¤æœ€å…ˆè¿›å…¥é˜Ÿåˆ—çš„å…ƒç´ ï¼Œå¹¶å°†è¢«ç§»é™¤çš„å…ƒç´ è¿”å›</span></span><br><span class="line">System.out.println(blockingQueue.remove());</span><br><span class="line">System.out.println(blockingQueue.remove());</span><br><span class="line">System.out.println(blockingQueue.remove());</span><br><span class="line">System.out.println(blockingQueue.remove());</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228160733.png" alt="image-20210228160733711"></p><h3 id="3ã€elementæ£€æŸ¥æ–¹æ³•"><a href="#3ã€elementæ£€æŸ¥æ–¹æ³•" class="headerlink" title="3ã€elementæ£€æŸ¥æ–¹æ³•"></a>3ã€elementæ£€æŸ¥æ–¹æ³•</h3><blockquote><p>è¯¥æ–¹æ³•ç”¨äºæŸ¥çœ‹é˜Ÿåˆ—é¦–éƒ¨å…ƒç´ </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">blockingQueue.add(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">blockingQueue.add(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">blockingQueue.add(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;é˜Ÿé¦–å…ƒç´ ä¸º:&quot;</span> + blockingQueue.element());</span><br></pre></td></tr></table></figure><blockquote><p>æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228161125.png" alt="image-20210228161125103"></p><blockquote><p>å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¼šæŠ¥ NoSuchElementException å¼‚å¸¸</p></blockquote><h2 id="8-6ã€é˜»å¡é˜Ÿåˆ—APIä¹‹ç‰¹æ®Šå€¼ç»„"><a href="#8-6ã€é˜»å¡é˜Ÿåˆ—APIä¹‹ç‰¹æ®Šå€¼ç»„" class="headerlink" title="8.6ã€é˜»å¡é˜Ÿåˆ—APIä¹‹ç‰¹æ®Šå€¼ç»„"></a>8.6ã€é˜»å¡é˜Ÿåˆ—APIä¹‹ç‰¹æ®Šå€¼ç»„</h2><blockquote><p>å’Œä¸Šé¢æŠ›å‡ºå¼‚å¸¸ç»„ä¸åŒçš„æ˜¯ï¼Œofferå’Œpollæ–¹æ³•ä¸æŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å›booleanå€¼true/false</p></blockquote><h3 id="1ã€offeræ–¹æ³•"><a href="#1ã€offeræ–¹æ³•" class="headerlink" title="1ã€offeræ–¹æ³•"></a>1ã€offeræ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;d&quot;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228161615.png" alt="image-20210228161615110"></p><blockquote><p>ç”±æ­¤å¯è§ï¼Œå¾€å·²æ»¡é˜Ÿåˆ—æ’å…¥å…ƒç´ æ—¶ï¼Œ<strong>æ­¤æ—¶offeræ–¹æ³•ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯è¿”å›false</strong></p></blockquote><h3 id="2ã€pollæ–¹æ³•"><a href="#2ã€pollæ–¹æ³•" class="headerlink" title="2ã€pollæ–¹æ³•"></a>2ã€pollæ–¹æ³•</h3><blockquote><p>æˆåŠŸåˆ™è¿”å›å‡ºé˜Ÿåˆ—çš„å…ƒç´ ï¼Œé˜Ÿåˆ—é‡Œæ²¡æœ‰å°±è¿”å›null</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬ä¸€æ¬¡å–å‡º:&quot;</span> + blockingQueue.poll());</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬äºŒæ¬¡å–å‡º:&quot;</span> + blockingQueue.poll());</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬ä¸‰æ¬¡å–å‡º:&quot;</span> + blockingQueue.poll());</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬å››æ¬¡å–å‡º:&quot;</span> + blockingQueue.poll());</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228163634.png" alt="image-20210228163634215"></p><h3 id="3ã€peekæ–¹æ³•"><a href="#3ã€peekæ–¹æ³•" class="headerlink" title="3ã€peekæ–¹æ³•"></a>3ã€peekæ–¹æ³•</h3><blockquote><p>åŒpollï¼Œå¦‚æœé˜Ÿåˆ—æœ‰å…ƒç´ åˆ™è¿”å›é˜Ÿé¦–å…ƒç´ ï¼Œå¦åˆ™è¿”å›null</p></blockquote><h2 id="8-7ã€é˜»å¡é˜Ÿåˆ—APIä¹‹é˜»å¡"><a href="#8-7ã€é˜»å¡é˜Ÿåˆ—APIä¹‹é˜»å¡" class="headerlink" title="8.7ã€é˜»å¡é˜Ÿåˆ—APIä¹‹é˜»å¡"></a>8.7ã€é˜»å¡é˜Ÿåˆ—APIä¹‹é˜»å¡</h2><h3 id="1ã€putæ–¹æ³•"><a href="#1ã€putæ–¹æ³•" class="headerlink" title="1ã€putæ–¹æ³•"></a>1ã€putæ–¹æ³•</h3><blockquote><p>å¾€éæ»¡é˜Ÿåˆ—æ’å…¥å…ƒç´ æ—¶</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;c&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼Œå‘ç°ä¸€åˆ‡æ­£å¸¸</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228164139.png" alt="image-20210228164139485"></p><blockquote><p>å¦‚æœå¾€å·²æ»¡é˜Ÿåˆ—ä¸­putå…ƒç´ ï¼Œæ­¤æ—¶ä¼šé˜»å¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;d&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼Œå‘ç°ç¨‹åºå·²ç»è¢«é˜»å¡</p><p>ç¨‹åºå°†ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æœ‰ç©ºä½ç»™ç¬¬å››ä¸ªå…ƒç´ ä¸ºæ­¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228164310.png" alt="image-20210228164310894"></p><h3 id="2ã€takeæ–¹æ³•"><a href="#2ã€takeæ–¹æ³•" class="headerlink" title="2ã€takeæ–¹æ³•"></a>2ã€takeæ–¹æ³•</h3><blockquote><p>åŒputæ–¹æ³•ï¼Œå¦‚æœå»takeä¸€ä¸ªç©ºé˜Ÿåˆ—ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰å…ƒç´ è¢«takeä¸ºæ­¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">blockingQueue.put(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"><span class="comment">//å–</span></span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬ä¸€ä¸ªå–å‡ºçš„å…ƒç´ ä¸º:&quot;</span> + blockingQueue.take());</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬äºŒä¸ªå–å‡ºçš„å…ƒç´ ä¸º:&quot;</span> + blockingQueue.take());</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬ä¸‰ä¸ªå–å‡ºçš„å…ƒç´ ä¸º:&quot;</span> + blockingQueue.take());</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬å››ä¸ªå–å‡ºçš„å…ƒç´ ä¸º:&quot;</span> + blockingQueue.take());</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228165034.png" alt="image-20210228165034190"></p><h2 id="8-8ã€é˜»å¡é˜Ÿåˆ—APIä¹‹è¶…æ—¶"><a href="#8-8ã€é˜»å¡é˜Ÿåˆ—APIä¹‹è¶…æ—¶" class="headerlink" title="8.8ã€é˜»å¡é˜Ÿåˆ—APIä¹‹è¶…æ—¶"></a>8.8ã€é˜»å¡é˜Ÿåˆ—APIä¹‹è¶…æ—¶</h2><h3 id="1ã€offer"><a href="#1ã€offer" class="headerlink" title="1ã€offer"></a>1ã€offer</h3><blockquote><p>boolean offer(è¦æ·»åŠ çš„å…ƒç´ ,ç­‰å¾…æ—¶é•¿,å•ä½);</p><p>è¿™ä¸ªæ–¹æ³•çš„æ„æ€æ˜¯ï¼šå¾€é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨æ—¶é—´å†…æ²¡æœ‰æ·»åŠ å®Œæˆï¼Œé‚£ä¹ˆç›´æ¥å–æ¶ˆæ·»åŠ è¿”å›false</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªArrayBlockingQueueå¯¹è±¡ï¼Œè®¾ç½®æœ€å¤§å®¹é‡ä¸º3</span></span><br><span class="line">BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">blockingQueue.offer(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">blockingQueue.offer(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">blockingQueue.offer(<span class="string">&quot;c&quot;</span>);</span><br><span class="line"><span class="comment">//æ­¤æ—¶ä½¿ç”¨è¶…æ—¶Apiæ·»åŠ å…ƒç´ </span></span><br><span class="line">System.out.println(blockingQueue.offer(<span class="string">&quot;d&quot;</span>,<span class="number">3L</span>, TimeUnit.SECONDS));</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228170039.png" alt="image-20210228170039224"></p><h2 id="8-9ã€TestTransferValue"><a href="#8-9ã€TestTransferValue" class="headerlink" title="8.9ã€TestTransferValue"></a>8.9ã€TestTransferValue</h2><h3 id="1ã€åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡"><a href="#1ã€åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡"></a>1ã€åˆ›å»ºä¸€ä¸ªPersonå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ç¼–å†™ä¸€ä¸ªTestTransferValueç±»"><a href="#2ã€ç¼–å†™ä¸€ä¸ªTestTransferValueç±»" class="headerlink" title="2ã€ç¼–å†™ä¸€ä¸ªTestTransferValueç±»"></a>2ã€ç¼–å†™ä¸€ä¸ªTestTransferValueç±»</h3><blockquote><p>è¿™ä¸ªç±»ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åŸºæœ¬æ•°æ®ç±»å‹ã€è‡ªå®šä¹‰å¼•ç”¨ç±»å‹å’ŒJDKè‡ªå¸¦å¼•ç”¨ç±»å‹ä¸­çš„å€¼è¿›è¡Œä¿®æ”¹ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTransferValue</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ä¿®æ”¹åŸºæœ¬æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeBaseValue</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        age = <span class="number">30</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * JDKè‡ªå¸¦å¼•ç”¨ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeJDKValue</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        str = <span class="string">&quot;xxx&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeOurValue</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        person.setName(<span class="string">&quot;wuhu&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TestTransferValue test = <span class="keyword">new</span> TestTransferValue();</span><br><span class="line">        <span class="keyword">int</span> age = <span class="number">20</span>;</span><br><span class="line">        test.changeBaseValue(<span class="number">30</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------age:&quot;</span> + age);</span><br><span class="line"></span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">&quot;abd&quot;</span>);</span><br><span class="line">        test.changeOurValue(person);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------person:&quot;</span> + person);</span><br><span class="line"></span><br><span class="line">        String str = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        test.changeJDKValue(str);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------str:&quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228171741.png" alt="image-20210228171741581"></p><h3 id="3ã€æŒ‰å€¼ä¼ é€’å’ŒæŒ‰å¼•ç”¨ä¼ é€’"><a href="#3ã€æŒ‰å€¼ä¼ é€’å’ŒæŒ‰å¼•ç”¨ä¼ é€’" class="headerlink" title="3ã€æŒ‰å€¼ä¼ é€’å’ŒæŒ‰å¼•ç”¨ä¼ é€’"></a>3ã€æŒ‰å€¼ä¼ é€’å’ŒæŒ‰å¼•ç”¨ä¼ é€’</h3><ul><li>ä¼ å€¼è¿˜æ˜¯ä¼ å¼•ç”¨</li></ul><blockquote><p>å€¼ä¼ é€’æ˜¯å¤å°ä»¶ã€å¼•ç”¨ä¼ é€’æ˜¯æœ¬ä½“</p></blockquote><ul><li>æ³¨æ„æ–¹æ³•çš„ä½œç”¨åŸŸ</li><li>changeBaseValueæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TestTransferValue test = <span class="keyword">new</span> TestTransferValue();</span><br><span class="line"><span class="keyword">int</span> age = <span class="number">20</span>;</span><br><span class="line">test.changeBaseValue(<span class="number">30</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;----------------age:&quot;</span> + age);</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºmainæ–¹æ³•ä¸­çš„ageæ˜¯å±€éƒ¨å˜é‡ï¼Œè¿™ä¸ªageå’ŒchangeBaseValueæ–¹æ³•ä¸­çš„ageæ²¡æœ‰ä¸æ¯«å…³ç³»ã€‚</p><p><strong>åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ï¼ŒåŸºæœ¬ç±»å‹åªä¼ é€’å¤å°ä»¶ï¼ŒåŸä»¶ä¸åŠ¨ï¼Œæ‰€ä»¥changeBaseValueæ–¹æ³•ä¿®æ”¹çš„åªæ˜¯ageçš„æ‹·è´ï¼Œå’ŒåŸæ¥çš„ageæ²¡æœ‰å…³ç³»</strong></p></blockquote><ul><li>changeOurValueæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Person person = <span class="keyword">new</span> Person(<span class="string">&quot;abd&quot;</span>);</span><br><span class="line">test.changeOurValue(person);</span><br><span class="line">System.out.println(<span class="string">&quot;----------------person:&quot;</span> + person);</span><br></pre></td></tr></table></figure><blockquote><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£Javaä¸­å¼•ç”¨å’Œå®ä¾‹å¯¹è±¡çš„å…³ç³»</p><p>Person person = new Person(â€œabdâ€);</p><p>å…¶ä¸­personç§°ä¸ºå¼•ç”¨ï¼Œå­˜æ”¾åœ¨æ ˆä¸­ï¼Œnew Person(â€œabdâ€)ç§°ä¸ºå®ä¾‹å¯¹è±¡ï¼Œå­˜æ”¾åœ¨å †ä¸­ï¼Œæ­¤æ—¶å…³ç³»å›¾å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228173435.png" alt="image-20210228173435911"></p><blockquote><p>å°†personä¼ å…¥changeOurValueæ–¹æ³•åï¼Œä¼ å…¥çš„æ˜¯å¼•ç”¨ï¼Œæ­¤æ—¶ç¨‹åºæ ¹æ®å¼•ç”¨åœ°å€æ‰¾åˆ°abdï¼Œç„¶åå°†å€¼ä¿®æ”¹ä¸ºwuhu</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228173700.png" alt="image-20210228173700010"></p><ul><li>changeJDKValueæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">test.changeJDKValue(str);</span><br><span class="line">System.out.println(<span class="string">&quot;----------------str:&quot;</span> + str);</span><br></pre></td></tr></table></figure><blockquote><p>Stringå¯¹è±¡å­˜æ”¾åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± </p><p>å½“æ‰§è¡Œ String str = â€œabcâ€;æ—¶ï¼Œä¼šå…ˆåˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¯»æ‰¾â€abcâ€å­—ç¬¦ä¸²ï¼Œå¦‚æœæ‰¾åˆ°ç›´æ¥å¼•ç”¨ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åˆ›å»ºStringå¯¹è±¡åå¼•ç”¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228174341.png" alt="image-20210228174341270"></p><blockquote><p>æ­¤æ—¶stræ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œåœ¨æ‰§è¡ŒchangeJDKValueæ–¹æ³•åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°å¼•ç”¨æŒ‡å‘abc</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228174525.png" alt="image-20210228174525338"></p><blockquote><p>æ­¤æ—¶æ‰§è¡ŒchangeJDKValueæ–¹æ³•ä¸­çš„ str = â€œxxxâ€ æ—¶ï¼Œä¼šå»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å¯»æ‰¾ â€œxxxâ€ å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªï¼Œç„¶åæŒ‡å‘æ–¹æ³•çš„strå¼•ç”¨</p><p>æ­¤æ—¶å…³ç³»å›¾å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228174925.png" alt="image-20210228174925546"></p><blockquote><p>æœ€åæ‰§è¡Œ System.out.println(â€œâ€”â€”â€”â€”â€”-str:â€ + str); </p><p>ç”±äºmainæ–¹æ³•ä¸­çš„strä½¿ç”¨æŒ‡å‘ â€œabcâ€ ï¼Œæ‰€ä»¥è¾“å‡ºabc</p></blockquote><h3 id="4ã€æ€»ç»“"><a href="#4ã€æ€»ç»“" class="headerlink" title="4ã€æ€»ç»“"></a>4ã€æ€»ç»“</h3><ul><li>å¦‚æœä¼ é€’æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆä¼ é€’çš„æ˜¯å‰¯æœ¬ï¼ŒåŸå€¼ä¸åŠ¨</li><li>å¦‚æœä¼ é€’çš„æ˜¯è‡ªå®šä¹‰å¼•ç”¨å¯¹è±¡ï¼Œé‚£ä¹ˆæ˜¯æœ¬ä½“</li></ul><h1 id="ä¹ã€çº¿ç¨‹æ± "><a href="#ä¹ã€çº¿ç¨‹æ± " class="headerlink" title="ä¹ã€çº¿ç¨‹æ± "></a>ä¹ã€çº¿ç¨‹æ± </h1><h2 id="9-1ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿"><a href="#9-1ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿" class="headerlink" title="9.1ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿"></a>9.1ã€çº¿ç¨‹æ± çš„ä¼˜åŠ¿</h2><blockquote><p>çº¿ç¨‹æ± åšçš„å·¥ä½œåªè¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œ<strong>å¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—</strong>ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œ<strong>å¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡ï¼Œè¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™</strong>ï¼Œç­‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚</p></blockquote><ul><li>çº¿ç¨‹æ± çš„ä¸»è¦ç‰¹ç‚¹<ul><li>çº¿ç¨‹å¤ç”¨</li><li>æ§åˆ¶æœ€å¤§å¹¶å‘æ•°</li><li>ç®¡ç†çº¿ç¨‹</li></ul></li></ul><blockquote><p>ç¬¬ä¸€ï¼šé™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„é”€è€—ã€‚</p><p>ç¬¬äºŒï¼šæé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</p><p>ç¬¬ä¸‰ï¼šæé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šé”€è€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚</p></blockquote><h2 id="9-2ã€å¦‚ä½•ä½¿ç”¨"><a href="#9-2ã€å¦‚ä½•ä½¿ç”¨" class="headerlink" title="9.2ã€å¦‚ä½•ä½¿ç”¨"></a>9.2ã€å¦‚ä½•ä½¿ç”¨</h2><h3 id="1ã€æ¶æ„è¯´æ˜"><a href="#1ã€æ¶æ„è¯´æ˜" class="headerlink" title="1ã€æ¶æ„è¯´æ˜"></a>1ã€æ¶æ„è¯´æ˜</h3><blockquote><p>Javaä¸­çš„çº¿ç¨‹æ± æ˜¯é€šè¿‡Executoræ¡†æ¶å®ç°çš„ï¼Œè¯¥æ¡†æ¶ä¸­ç”¨åˆ°äº†Executorï¼ŒExecutorsï¼ŒExecutorServiceï¼ŒThreadPoolExecutorè¿™å‡ ä¸ªç±».</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228202136.png" alt="img"></p><h3 id="2ã€ç¼–ç å®ç°"><a href="#2ã€ç¼–ç å®ç°" class="headerlink" title="2ã€ç¼–ç å®ç°"></a>2ã€ç¼–ç å®ç°</h3><ul><li>Executors.newFixedThreadPool(int)</li></ul><blockquote><p>æ‰§è¡Œé•¿æœŸä»»åŠ¡æ€§èƒ½å¥½ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä¸€æ± æœ‰Nä¸ªå›ºå®šçš„çº¿ç¨‹ï¼Œæœ‰å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­æœ‰äº”ä¸ªçº¿ç¨‹</span></span><br><span class="line">ExecutorService threadPool = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡ï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">    exception.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨å®Œæ¯•åè¦äº¤è¿˜çº¿ç¨‹</span></span><br><span class="line">    threadPool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228205016.png" alt="image-20210228205016503"></p><ul><li>Executors.newSingleThreadExecutor()</li></ul><blockquote><p>ä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œï¼Œä¸€æ± ä¸€çº¿ç¨‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­æœ‰äº”ä¸ªçº¿ç¨‹</span></span><br><span class="line">ExecutorService threadPool = Executors.newSingleThreadExecutor();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡ï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">    exception.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨å®Œæ¯•åè¦äº¤è¿˜çº¿ç¨‹</span></span><br><span class="line">    threadPool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228204615.png" alt="image-20210228204614440"></p><ul><li>Executors.newCachedThreadPool()</li></ul><blockquote><p>æ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œä½†åœ¨å…ˆå‰æ„å»ºçš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ã€‚<strong>å¯æ‰©å®¹</strong>ï¼Œé‡å¼ºåˆ™å¼º.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­æœ‰äº”ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment">//ExecutorService threadPool = Executors.newFixedThreadPool(5);</span></span><br><span class="line">ExecutorService threadPool = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡ï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">    exception.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨å®Œæ¯•åè¦äº¤è¿˜çº¿ç¨‹</span></span><br><span class="line">    threadPool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228205315.png" alt="image-20210228205315345"></p><h2 id="9-3ã€ThreadPoolExecutoråº•å±‚åŸç†"><a href="#9-3ã€ThreadPoolExecutoråº•å±‚åŸç†" class="headerlink" title="9.3ã€ThreadPoolExecutoråº•å±‚åŸç†"></a>9.3ã€ThreadPoolExecutoråº•å±‚åŸç†</h2><blockquote><p>æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œ9.2ä¸­è·å–çº¿ç¨‹æ± çš„æ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯è°ƒç”¨äº†ThreadPoolExecutorçš„æ„é€ æ–¹æ³•</p></blockquote><h3 id="1ã€ThreadPoolExecutoræ„é€ æ–¹æ³•"><a href="#1ã€ThreadPoolExecutoræ„é€ æ–¹æ³•" class="headerlink" title="1ã€ThreadPoolExecutoræ„é€ æ–¹æ³•"></a>1ã€ThreadPoolExecutoræ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">         Executors.defaultThreadFactory(), defaultHandler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>corePoolSize</li></ul><blockquote><p>çº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ ¸å¿ƒçº¿ç¨‹ä¼šä¸€ç›´å­˜æ´»ï¼Œå³ä½¿å¤„äºé—²ç½®çŠ¶æ€ä¹Ÿä¸ä¼šå—å­˜<code>keepAliveTime</code>é™åˆ¶ã€‚é™¤éå°†<code>allowCoreThreadTimeOut</code>è®¾ç½®ä¸º<code>true</code>ã€‚</p></blockquote><ul><li>maximumPoolSize</li></ul><blockquote><p>çº¿ç¨‹æ± æ‰€èƒ½å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚è¶…è¿‡è¿™ä¸ªæ•°çš„çº¿ç¨‹å°†è¢«é˜»å¡ã€‚å½“ä»»åŠ¡é˜Ÿåˆ—ä¸ºæ²¡æœ‰è®¾ç½®å¤§å°çš„LinkedBlockingDequeæ—¶ï¼Œè¿™ä¸ªå€¼æ— æ•ˆã€‚</p></blockquote><ul><li>keepAliveTime</li></ul><blockquote><p>éæ ¸å¿ƒçº¿ç¨‹çš„é—²ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¼šè¢«å›æ”¶ã€‚</p></blockquote><ul><li>unit</li></ul><blockquote><p>æŒ‡å®š<code>keepAliveTime</code>çš„å•ä½ï¼Œå¦‚<code>TimeUnit.SECONDS</code>ã€‚å½“å°†<code>allowCoreThreadTimeOut</code>è®¾ç½®ä¸º<code>true</code>æ—¶å¯¹corePoolSizeç”Ÿæ•ˆã€‚</p></blockquote><ul><li>workQueue</li></ul><blockquote><p>çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—.</p><p>å¸¸ç”¨çš„æœ‰ä¸‰ç§é˜Ÿåˆ—ï¼Œ<code>SynchronousQueue</code>,<code>LinkedBlockingDeque</code>,<code>ArrayBlockingQueue</code></p></blockquote><h3 id="2ã€newFixedThreadPool-int"><a href="#2ã€newFixedThreadPool-int" class="headerlink" title="2ã€newFixedThreadPool(int)"></a>2ã€newFixedThreadPool(int)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                  <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>FixedThreadPoolä¸­ï¼Œ<strong>æ ¸å¿ƒçº¿ç¨‹æ•°</strong> <code>corePoolSize</code> å’Œ<strong>çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°</strong> <code>maximumPoolSize</code> éƒ½è®¾ç½®ä¸ºç”¨æˆ·ä¼ å…¥çš„<strong>nThreads</strong>ï¼Œä¸”ç©ºé—²çº¿ç¨‹æ•°ä¸º0ï¼Œ<strong>ä½¿ç”¨LinkedBlockingQueueé˜Ÿåˆ—</strong></p></blockquote><h3 id="3ã€newSingleThreadExecutor"><a href="#3ã€newSingleThreadExecutor" class="headerlink" title="3ã€newSingleThreadExecutor()"></a>3ã€newSingleThreadExecutor()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>SingleThreadExecutorä¸­ï¼Œ<strong>æ ¸å¿ƒçº¿ç¨‹æ•°</strong> <code>corePoolSize</code> å’Œ<strong>çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°</strong> <code>maximumPoolSize</code> éƒ½ä¸º1ï¼Œä¸”ç©ºé—²çº¿ç¨‹æ•°ä¸º0ï¼Œ<strong>ä½¿ç”¨LinkedBlockingQueueé˜Ÿåˆ—</strong></p></blockquote><h3 id="4ã€newCachedThreadPool"><a href="#4ã€newCachedThreadPool" class="headerlink" title="4ã€newCachedThreadPool()"></a>4ã€newCachedThreadPool()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>newCachedThreadPoolåˆ›å»ºçš„çº¿ç¨‹æ± å°†corePoolSizeè®¾ç½®ä¸º0ï¼Œå°†maximumPoolSizeè®¾ç½®ä¸ºInteger.MAX_VALUEï¼Œå®ƒä½¿ç”¨çš„æ˜¯SynchronousQueueï¼Œä¹Ÿå°±æ˜¯è¯´æ¥äº†ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹è¿è¡Œï¼Œå½“çº¿ç¨‹ç©ºé—²è¶…è¿‡60ç§’ï¼Œå°±é”€æ¯çº¿ç¨‹ã€‚</p></blockquote><h2 id="9-4ã€çº¿ç¨‹æ± çš„ä¸ƒå¤§å‚æ•°"><a href="#9-4ã€çº¿ç¨‹æ± çš„ä¸ƒå¤§å‚æ•°" class="headerlink" title="9.4ã€çº¿ç¨‹æ± çš„ä¸ƒå¤§å‚æ•°"></a>9.4ã€çº¿ç¨‹æ± çš„ä¸ƒå¤§å‚æ•°</h2><blockquote><p>ThreadPoolExecutorä¸­å«æœ‰ä¸ƒä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.acc = System.getSecurityManager() == <span class="keyword">null</span> ?</span><br><span class="line">            <span class="keyword">null</span> :</span><br><span class="line">            AccessController.getContext();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1ã€corePoolSize"><a href="#1ã€corePoolSize" class="headerlink" title="1ã€corePoolSize"></a>1ã€corePoolSize</h3><blockquote><p>int corePoolSize</p><p>çº¿ç¨‹æ± ä¸­çš„å¸¸é©»æ ¸å¿ƒçº¿ç¨‹æ•°</p></blockquote><h3 id="2ã€maximumPoolSize"><a href="#2ã€maximumPoolSize" class="headerlink" title="2ã€maximumPoolSize"></a>2ã€maximumPoolSize</h3><blockquote><p>int maximumPoolSize</p><p>çº¿ç¨‹æ± ä¸­èƒ½å¤Ÿå®¹çº³åŒæ—¶æ‰§è¡Œçš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ­¤å€¼å¿…é¡»å¤§äºç­‰äº1</p></blockquote><h3 id="3ã€keepAliveTime"><a href="#3ã€keepAliveTime" class="headerlink" title="3ã€keepAliveTime"></a>3ã€keepAliveTime</h3><blockquote><p>long keepAliveTime</p><p>å¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼Œå½“å‰æ± ä¸­çº¿ç¨‹æ•°é‡è¶…è¿‡corePoolSizeæ—¶ï¼Œå½“ç©ºé—²æ—¶é—´è¾¾åˆ°keepAliveTimeæ—¶ï¼Œå¤šä½™çº¿ç¨‹ä¼šè¢«é”€æ¯ç›´åˆ°åªå‰©ä¸‹corePoolSizeä¸ªçº¿ç¨‹ä¸ºæ­¢ã€‚</p></blockquote><h3 id="4ã€unit"><a href="#4ã€unit" class="headerlink" title="4ã€unit"></a>4ã€unit</h3><blockquote><p>TimeUnit unit</p><p>keepAliveTimeçš„å•ä½</p></blockquote><h3 id="5ã€workQueue"><a href="#5ã€workQueue" class="headerlink" title="5ã€workQueue"></a>5ã€workQueue</h3><blockquote><p>BlockingQueue&lt; Runnable &gt; workQueue</p><p>ä»»åŠ¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æŒ‡<strong>å­˜æ”¾è¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡</strong>çš„é˜Ÿåˆ—ã€‚</p></blockquote><h3 id="6ã€threadFactory"><a href="#6ã€threadFactory" class="headerlink" title="6ã€threadFactory"></a>6ã€threadFactory</h3><blockquote><p>ThreadFactory threadFactory</p><p>è¡¨ç¤ºç”Ÿæˆçº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ï¼Œ<strong>ä¸€èˆ¬é»˜è®¤çš„å³å¯</strong> </p></blockquote><h3 id="7ã€handler"><a href="#7ã€handler" class="headerlink" title="7ã€handler"></a>7ã€handler</h3><blockquote><p>RejectedExecutionHandler handler</p><p>æ‹’ç»ç­–ç•¥ï¼Œè¡¨ç¤ºå½“é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹å¤§äºç­‰äºçº¿ç¨‹æ± çš„æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰æ—¶å¦‚ä½•æ¥æ‹’ç»è¯·æ±‚æ‰§è¡Œçš„runnableçš„ç­–ç•¥</p></blockquote><h2 id="9-5ã€çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†"><a href="#9-5ã€çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†" class="headerlink" title="9.5ã€çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†"></a>9.5ã€çº¿ç¨‹æ± åº•å±‚å·¥ä½œåŸç†</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228223251.png" alt="img"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228223301.png" alt="img"></p><blockquote><p>çº¿ç¨‹æ± å·¥ä½œåŸç†å¦‚ä¸‹</p></blockquote><ul><li><p>åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œå¼€å§‹ç­‰å¾…è¯·æ±‚ã€‚</p></li><li><p>å½“è°ƒç”¨execute()æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå‡ºå¦‚ä¸‹åˆ¤æ–­ï¼š</p><ul><li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºcorePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li><li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºcorePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼›</li><li>å¦‚æœè¿™ä¸ªæ—¶å€™é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äºmaximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li><li>å¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºmaximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œã€‚</li></ul></li><li><p>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚</p></li><li><p>å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹ä¼šåˆ¤æ–­ï¼š</p></li></ul><blockquote><p>å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ°corePoolSizeçš„å¤§å°ã€‚</p></blockquote><h2 id="9-6ã€çº¿ç¨‹æ± ç”¨å“ªä¸ªï¼Ÿ"><a href="#9-6ã€çº¿ç¨‹æ± ç”¨å“ªä¸ªï¼Ÿ" class="headerlink" title="9.6ã€çº¿ç¨‹æ± ç”¨å“ªä¸ªï¼Ÿ"></a>9.6ã€çº¿ç¨‹æ± ç”¨å“ªä¸ªï¼Ÿ</h2><h3 id="1ã€åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„-å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿ"><a href="#1ã€åœ¨å·¥ä½œä¸­å•ä¸€çš„-å›ºå®šæ•°çš„-å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿ" class="headerlink" title="1ã€åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„/å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿ"></a>1ã€åœ¨å·¥ä½œä¸­å•ä¸€çš„/å›ºå®šæ•°çš„/å¯å˜çš„ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•å“ªä¸ªç”¨çš„å¤šï¼Ÿ</h3><blockquote><p><strong>ä¸€ä¸ªéƒ½ä¸ç”¨ï¼Œæˆ‘ä»¬å·¥ä½œä¸­åªèƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„</strong></p></blockquote><h3 id="2ã€ä¸ºä»€ä¹ˆä¸ç”¨JDKè‡ªå¸¦çš„Executorsåˆ›å»ºçº¿ç¨‹æ± "><a href="#2ã€ä¸ºä»€ä¹ˆä¸ç”¨JDKè‡ªå¸¦çš„Executorsåˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="2ã€ä¸ºä»€ä¹ˆä¸ç”¨JDKè‡ªå¸¦çš„Executorsåˆ›å»ºçº¿ç¨‹æ± "></a>2ã€ä¸ºä»€ä¹ˆä¸ç”¨JDKè‡ªå¸¦çš„Executorsåˆ›å»ºçº¿ç¨‹æ± </h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228231811.png" alt="img"></p><blockquote><p>Executorsè¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹:</p></blockquote><ul><li><code>FixedThreadPool</code> å’Œ <code>SingleThreadPool</code> å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º <code>Integer.MAX_VALUE</code>ï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´<strong>OOM</strong></li><li><code>CacheThreadPool</code> å’Œ <code>ScheduledThreadPool</code> å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º <code>Integer.MAX_VALUE</code> ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ä»è€Œå¯¼è‡´<strong>OOM</strong></li></ul><h2 id="9-7ã€è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#9-7ã€è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="9.7ã€è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>9.7ã€è‡ªå®šä¹‰çº¿ç¨‹æ± </h2><blockquote><p>ä½¿ç”¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ª <strong>ThreadPoolExecutor</strong> å¯¹è±¡ã€‚</p><p>è‡ªå®šä¹‰çº¿ç¨‹æ± çš„ä¸ƒå¤§å‚æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>,<span class="number">5</span>,<span class="number">60L</span>,TimeUnit.SECONDS,<span class="keyword">new</span> LinkedBlockingDeque&lt;Runnable&gt;(<span class="number">3</span>),Executors.defaultThreadFactory(),<span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; i++) &#123;</span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡ï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">    exception.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨å®Œæ¯•åè¦äº¤è¿˜çº¿ç¨‹</span></span><br><span class="line">    threadPool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œåœ¨ä¼ å…¥é˜»å¡é˜Ÿåˆ—å¯¹è±¡æ˜¯ä¸€å®šè¦æŒ‡å®šé˜»å¡é˜Ÿåˆ—çš„å®¹é‡å¤§å°ï¼Œå› ä¸ºé˜»å¡é˜Ÿåˆ—çš„é»˜è®¤å®¹é‡æ˜¯Integer.MAX_VALUE</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedBlockingDeque</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(Integer.MAX_VALUE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œä¸Šé¢çš„ç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228233817.png" alt="image-20210228233817697"></p><blockquote><p>å°†å¾ªç¯æ¬¡æ•°ç”±7æ”¹ä¸º9ï¼Œæ¨¡æ‹Ÿæ­¤æ—¶æœ‰9ä¸ªä»»åŠ¡è¿‡æ¥ï¼Œæ­¤æ—¶è¿è¡Œç¨‹åºæŸ¥çœ‹ç»“æœ</p><p>è§¦å‘äº†æ‹’ç»ç­–ç•¥</p><p>æ•…<strong>çº¿ç¨‹æ± èƒ½æ‰¿å—çš„æœ€å¤§ä»»åŠ¡æ•° = çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•° + é˜»å¡é˜Ÿåˆ—å®¹é‡</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228234010.png" alt="image-20210228234010374"></p><h2 id="9-8ã€çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥"><a href="#9-8ã€çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥" class="headerlink" title="9.8ã€çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥"></a>9.8ã€çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥</h2><h3 id="1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p><strong>ç­‰å¾…é˜Ÿåˆ—å·²ç»æ’æ»¡äº†</strong>ï¼Œå†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†</p><p>åŒæ—¶ï¼Œçº¿ç¨‹æ± ä¸­çš„maxçº¿ç¨‹ä¹Ÿè¾¾åˆ°äº†ï¼Œæ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡ã€‚</p><p>è¿™ä¸ªæ˜¯æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><h3 id="2ã€JDKè‡ªå¸¦æ‹’ç»ç­–ç•¥"><a href="#2ã€JDKè‡ªå¸¦æ‹’ç»ç­–ç•¥" class="headerlink" title="2ã€JDKè‡ªå¸¦æ‹’ç»ç­–ç•¥"></a>2ã€JDKè‡ªå¸¦æ‹’ç»ç­–ç•¥</h3><ul><li>AbortPolicy(é»˜è®¤)</li></ul><blockquote><p>ç›´æ¥æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸é˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</p></blockquote><ul><li>CallerRunsPolicy</li></ul><blockquote><p>â€œè°ƒç”¨è€…è¿è¡Œâ€ä¸€ç§è°ƒèŠ‚æœºåˆ¶ï¼Œè¯¥ç­–ç•¥æ—¢ä¸ä¼šæŠ›å¼ƒä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯å°†æŸäº›ä»»åŠ¡å›é€€åˆ°è°ƒç”¨è€…ï¼Œä»è€Œé™ä½æ–°ä»»åŠ¡çš„æµé‡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>,<span class="number">5</span>,<span class="number">60L</span>,TimeUnit.SECONDS,<span class="keyword">new</span> LinkedBlockingDeque&lt;Runnable&gt;(<span class="number">3</span>),Executors.defaultThreadFactory(),<span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡ï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">    exception.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨å®Œæ¯•åè¦äº¤è¿˜çº¿ç¨‹</span></span><br><span class="line">    threadPool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°ä¸­å¯ç”¨ <strong>CallerRunsPolicy</strong> ç­–ç•¥ã€‚</p><p>å¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301172530.png" alt="image-20210301172529674"></p><ul><li>DiscardOldestPolicy</li></ul><blockquote><p>æŠ›å¼ƒé˜Ÿåˆ—ä¸­ç­‰å¾…æœ€ä¹…çš„ä»»åŠ¡ï¼Œç„¶åæŠŠå½“å‰ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ä¸­å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</p><p>åœ¨ThreadPoolExecutorçš„æ„é€ å‡½æ•°ä¸­å¯ç”¨ <strong>DiscardOldestPolicy</strong> ç­–ç•¥ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">5</span>,<span class="number">60L</span>,TimeUnit.SECONDS,<span class="keyword">new</span> LinkedBlockingDeque&lt;Runnable&gt;(<span class="number">3</span>), Executors.defaultThreadFactory(), <span class="keyword">new</span> ThreadPoolExecutor.DiscardOldestPolicy());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">        threadPool.execute(() -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t åŠç†ä¸šåŠ¡ï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">    exception.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨å®Œæ¯•åè¦äº¤è¿˜çº¿ç¨‹</span></span><br><span class="line">    threadPool.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301180756.png" alt="image-20210301180756130"></p><ul><li>DiscardPolicy</li></ul><blockquote><p>è¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§ç­–ç•¥ã€‚</p></blockquote><ul><li>åé¢ä¸¤ç§æ‹’ç»ç­–ç•¥çš„å·®åˆ«</li></ul><blockquote><p><strong>DiscardOldestPolicy</strong> æŠ›å¼ƒç­‰å¾…æœ€ä¹…çš„è¯·æ±‚ï¼Œè€Œ <strong>DiscardPolicy</strong> æŠ›å¼ƒæœ€æ–°çš„è¯·æ±‚ã€‚</p></blockquote><h3 id="3ã€è¡¥å……"><a href="#3ã€è¡¥å……" class="headerlink" title="3ã€è¡¥å……"></a>3ã€è¡¥å……</h3><blockquote><p>ä»¥ä¸Šå†…ç½®æ‹’ç»ç­–ç•¥å‡å®ç°äº†<strong>RejectedExecutionHandle</strong>æ¥å£</p><p><strong>é»˜è®¤çš„æ‹’ç»ç­–ç•¥æ˜¯ AbortPolicy</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301181405.png" alt="image-20210301181405424"></p><blockquote><p>4ä¸ªæ‹’ç»ç­–ç•¥åˆ†åˆ«éƒ½æ˜¯ThreadPoolExecutorä¸­çš„é™æ€å†…éƒ¨ç±»</p><p>è¿™é‡Œç»™å‡ºAbortPolicyçš„æºç ä¸ºä¾‹ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210301181617.png" alt="image-20210301181617236"></p><h2 id="9-9ã€æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®"><a href="#9-9ã€æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®" class="headerlink" title="9.9ã€æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®"></a>9.9ã€æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®</h2><h3 id="1ã€CPUå¯†é›†å‹"><a href="#1ã€CPUå¯†é›†å‹" class="headerlink" title="1ã€CPUå¯†é›†å‹"></a>1ã€CPUå¯†é›†å‹</h3><blockquote><p>è®¾ç½®<code>æœ€å¤§çº¿ç¨‹æ•°</code> = <code>CPUæ ¸æ•°</code> + 1</p><p>ä½¿ç”¨Javaä»£ç æŸ¥çœ‹CPUæ ¸æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(Runtime.getRuntime().availableProcessors());</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228235213.png" alt="image-20210228235213769"></p><h3 id="2ã€IOå¯†é›†å‹"><a href="#2ã€IOå¯†é›†å‹" class="headerlink" title="2ã€IOå¯†é›†å‹"></a>2ã€IOå¯†é›†å‹</h3><blockquote><p>åé¢è¡¥å……</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaé¢è¯•æ€»ç»“ï¼ˆä¸€ï¼‰</title>
      <link href="posts/3180010034.html"/>
      <url>posts/3180010034.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€JDK-amp-JRE-amp-JVM"><a href="#1ã€JDK-amp-JRE-amp-JVM" class="headerlink" title="1ã€JDK&amp;JRE&amp;JVM"></a>1ã€JDK&amp;JRE&amp;JVM</h2><ul><li>JDKï¼Œå³Java Development Kit</li></ul><blockquote><p>Javaå¼€å‘å·¥å…·åŒ…ï¼Œæä¾›äº†Javaçš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒ</p><p>åŒ…å«äº†ç¼–è¯‘Javaæºæ–‡ä»¶çš„ç¼–è¯‘å™¨Javacï¼Œè¿˜æœ‰è°ƒè¯•å’Œåˆ†æçš„å·¥å…·ã€‚</p></blockquote><ul><li>JREï¼Œå³Java Runtime Environmentï¼ŒJavaè¿è¡Œç¯å¢ƒï¼ŒåŒ…å«Javaè™šæ‹ŸæœºåŠä¸€äº›åŸºç¡€ç±»åº“</li><li>JVMï¼Œå³Java Virtual Machineï¼ŒJavaè™šæ‹Ÿæœºï¼Œæä¾›æ‰§è¡Œå­—èŠ‚ç æ–‡ä»¶çš„èƒ½åŠ›</li></ul><blockquote><p>å¦‚æœåªæ˜¯è¿è¡ŒJavaç¨‹åºï¼Œé‚£ä¹ˆåªéœ€è¦è£…JREå³å¯</p><p>JVMæ˜¯å®ç°Javaè·¨å¹³å°çš„æ ¸å¿ƒï¼Œä½†JVMæœ¬èº«ä¸æ˜¯è·¨å¹³å°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒå¹³å°éœ€è¦å®‰è£…ä¸åŒçš„JVM</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210226003719.png" alt="image-20210226003719315"></p><h2 id="2ã€-ä¸equalsçš„åŒºåˆ«"><a href="#2ã€-ä¸equalsçš„åŒºåˆ«" class="headerlink" title="2ã€==ä¸equalsçš„åŒºåˆ«"></a>2ã€==ä¸equalsçš„åŒºåˆ«</h2><h3 id="2-1ã€"><a href="#2-1ã€" class="headerlink" title="2.1ã€=="></a>2.1ã€==</h3><ul><li>å¦‚æœæ¯”è¾ƒçš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆæ¯”è¾ƒçš„æ˜¯æ•°å€¼</li><li>å¦‚æœæ¯”è¾ƒçš„æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£ä¹ˆæ¯”è¾ƒå¼•ç”¨æŒ‡å‘çš„å€¼ï¼Œä¹Ÿå°±æ˜¯åœ°å€ã€‚</li></ul><h3 id="2-2ã€equals"><a href="#2-2ã€equals" class="headerlink" title="2.2ã€equals"></a>2.2ã€equals</h3><ul><li><strong>é»˜è®¤æ¯”è¾ƒçš„ä¹Ÿæ˜¯åœ°å€ï¼Œequalsæ–¹æ³•æ˜¯å®šä¹‰åœ¨Objectç±»ä¸Šçš„ï¼Œé»˜è®¤çš„å®ç°å°±æ˜¯æ¯”è¾ƒåœ°å€</strong> ï¼ŒObjectä¸Šequalsæ–¹æ³•çš„æºç å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒObjectçš„equalsæ–¹æ³•<strong>åº•å±‚è°ƒç”¨äº† â€œ==â€ è¿›è¡Œæ¯”è¾ƒ</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">this</span> == obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å¯¹äºè‡ªå®šä¹‰çš„ç±»ï¼Œå¦‚æœéœ€è¦æ¯”è¾ƒçš„æ˜¯å†…å®¹ï¼ˆç±»ä¼¼Stringã€Integerï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡å†™equalsæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹Stringå’ŒIntegerä¸­çš„equalsæ–¹æ³•</p></li><li><p>Stringçš„equalsæ–¹æ³•</p><ul><li>å…ˆåˆ¤æ–­ä¼ å…¥çš„å¯¹è±¡å’Œå½“å‰å­—ç¬¦ä¸²å¯¹è±¡åœ°å€æ˜¯å¦ç›¸åŒ</li><li>å¦‚æœåœ°å€ä¸åŒï¼Œåˆ¤æ–­ä¼ å…¥çš„å¯¹è±¡æ˜¯å¦ä¸ºStringç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è¿”å›false</li><li>å¦‚æœä¼ å…¥çš„å¯¹è±¡æ˜¯Stringç±»å‹å¯¹è±¡ï¼Œé‚£ä¹ˆåˆ¤æ–­é•¿åº¦æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç­‰ï¼Œç›´æ¥è¿”å›false</li><li>å¦‚æœä¸¤è€…é•¿åº¦ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±å°†ä¸¤è€…charæ•°ç»„ä¸­çš„å­—ç¬¦ä¸€ä¸€å–å‡ºï¼Œé€ä¸€åˆ¤æ–­æ˜¯å¦ç›¸ç­‰ï¼Œè‹¥æœ‰ä¸ç­‰çš„å­—ç¬¦ï¼Œç›´æ¥è¿”å›false</li><li>å¦‚æœä»¥ä¸Šæ¡ä»¶å‡æ»¡è¶³ï¼Œè¿”å›true</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">        String anotherString = (String)anObject;</span><br><span class="line">        <span class="keyword">int</span> n = value.length;</span><br><span class="line">        <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">            <span class="keyword">char</span> v1[] = value;</span><br><span class="line">            <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Integerçš„equalsæ–¹æ³•</p><ul><li>å…ˆåˆ¤æ–­ä¼ å…¥å¯¹è±¡çš„ç±»å‹ï¼Œå¦‚æœä¸ä¸ºIntegerç±»å‹ï¼Œé‚£ä¹ˆç›´æ¥return false</li><li>å¦åˆ™æ¯”è¾ƒä¸¤ä¸ªIntegerå¯¹è±¡çš„å€¼</li></ul><blockquote><p>æ³¨æ„ï¼šåˆ¤æ–­ä¸¤ä¸ªIntegerå¯¹è±¡å€¼æ˜¯å¦ç›¸ç­‰ä¸èƒ½ç”¨â€==â€ï¼Œéœ€è¦ä½¿ç”¨equalsæ–¹æ³•ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">        <span class="keyword">return</span> value == ((Integer)obj).intValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-3ã€å‡ ä¸ªå¯¹è±¡ï¼Ÿ"><a href="#2-3ã€å‡ ä¸ªå¯¹è±¡ï¼Ÿ" class="headerlink" title="2.3ã€å‡ ä¸ªå¯¹è±¡ï¼Ÿ"></a>2.3ã€å‡ ä¸ªå¯¹è±¡ï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String s1 = <span class="keyword">new</span> String(<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">String s2 = <span class="keyword">new</span> String(<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">System.out.println(s1 == s2);</span><br></pre></td></tr></table></figure><blockquote><p>false</p><p>ä½¿ç”¨newå…³é”®å­—åˆ›å»ºStringå¯¹è±¡æ—¶å¼€è¾Ÿäº†æ–°ç©ºé—´ï¼Œæ•…åœ°å€ä¸åŒã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String s3 = <span class="string">&quot;zs&quot;</span>;</span><br><span class="line">String s4 = <span class="string">&quot;zs&quot;</span>;</span><br><span class="line">System.out.println(s3 == s4);</span><br><span class="line">System.out.println(s3 == s1);</span><br></pre></td></tr></table></figure><blockquote><p>true</p><p>ä½¿ç”¨äº†å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œs3å’Œs4å‡æŒ‡å‘å¸¸é‡æ± ä¸­çš„â€zsâ€å­—ç¬¦ä¸²å¯¹è±¡</p><p>false</p><p>s1æŒ‡å‘å †çš„åœ°å€ï¼Œè€Œs3æŒ‡å‘å¸¸é‡æ± çš„åœ°å€</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String s5 = <span class="string">&quot;zszs&quot;</span>;</span><br><span class="line">String s6 = s3+s4;</span><br><span class="line">System.out.println(s5 == s6);</span><br></pre></td></tr></table></figure><blockquote><p>false</p><p>å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªä¸å¯å˜å€¼ï¼Œåœ¨ä½¿ç”¨ â€œ+â€ å·è¿æ¥å­—ç¬¦ä¸²æ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡newå…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™ä¸ªæ–°å¯¹è±¡çš„å€¼ä¸ºs3 + s4ï¼Œä¹Ÿå³zszsï¼Œè™½ç„¶å†…å®¹ç›¸åŒï¼Œä½†åœ°å€ä¸åŒã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String s7 = <span class="string">&quot;zs&quot;</span>;</span><br><span class="line"><span class="keyword">final</span> String s8 = <span class="string">&quot;zs&quot;</span>;</span><br><span class="line">String s9 = s7+s8;</span><br><span class="line">System.out.println(s5 == s9);</span><br></pre></td></tr></table></figure><blockquote><p>true</p><p>ç”±äºä½¿ç”¨finalä¿®é¥°ï¼Œæ­¤æ—¶s7å’Œs8ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªå¸¸é‡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> String s10 = s3+s4;</span><br><span class="line">System.out.println(s5 == s10);</span><br></pre></td></tr></table></figure><blockquote><p>false</p><p>ç”±äºs3ã€s4æ²¡æœ‰åŠ finalä¿®é¥°ï¼Œä¾ç„¶è¿˜æ˜¯å˜é‡ï¼Œæ‰€ä»¥ä»ç„¶éœ€è¦ä½¿ç”¨new StringBuilderå»æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç»“æœä¸ºfalseã€‚</p></blockquote><h2 id="3ã€final"><a href="#3ã€final" class="headerlink" title="3ã€final"></a>3ã€final</h2><ul><li>ä½¿ç”¨finalä¿®é¥°ç±»ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»ä¸å¯è¢«ç»§æ‰¿ï¼Œä¾‹å¦‚Stringç±»</li><li>ä½¿ç”¨finalä¿®é¥°æ–¹æ³•ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•ä¸å¯è¢«é‡å†™</li><li>ä½¿ç”¨finalä¿®é¥°å˜é‡ï¼Œè¿™ä¸ªå˜é‡å°±æ˜¯å¸¸é‡</li></ul><blockquote><p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨finalä¿®é¥°å˜é‡æ—¶</p></blockquote><ul><li>å¦‚æœä¿®é¥°çš„æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¡¨ç¤ºè¿™ä¸ªå€¼æœ¬èº«ä¸å¯è¢«ä¿®æ”¹</li><li>å¦‚æœä¿®é¥°çš„æ˜¯å¼•ç”¨ç±»å‹ï¼Œ<strong>é‚£ä¹ˆä»£è¡¨å¼•ç”¨çš„æŒ‡å‘ä¸å¯è¢«æ”¹å˜ï¼Œè€Œè¢«ä¿®é¥°å¼•ç”¨çš„å±æ€§å€¼æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ã€‚</strong></li><li>æ¯”å¦‚ä»¥ä¸‹çš„ä»£ç æ˜¯å¯ä»¥çš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Student student = <span class="keyword">new</span> Student(<span class="number">1</span>,<span class="string">&quot;Andy&quot;</span>);</span><br><span class="line">student.setAge(<span class="number">18</span>);<span class="comment">//æ³¨æ„ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥çš„ï¼</span></span><br></pre></td></tr></table></figure><h2 id="4ã€æ¥å£ä¸æŠ½è±¡ç±»çš„åŒºåˆ«"><a href="#4ã€æ¥å£ä¸æŠ½è±¡ç±»çš„åŒºåˆ«" class="headerlink" title="4ã€æ¥å£ä¸æŠ½è±¡ç±»çš„åŒºåˆ«"></a>4ã€æ¥å£ä¸æŠ½è±¡ç±»çš„åŒºåˆ«</h2><h3 id="4-1ã€JDK8ä¹‹å‰"><a href="#4-1ã€JDK8ä¹‹å‰" class="headerlink" title="4.1ã€JDK8ä¹‹å‰"></a>4.1ã€JDK8ä¹‹å‰</h3><ul><li><p>è¯­æ³•ï¼š</p></li><li><ul><li>æŠ½è±¡ç±»ï¼šæ–¹æ³•å¯ä»¥æœ‰æŠ½è±¡çš„ï¼Œä¹Ÿå¯ä»¥æœ‰éæŠ½è±¡, æœ‰æ„é€ å™¨</li><li>æ¥å£ï¼šæ–¹æ³•éƒ½æ˜¯æŠ½è±¡ï¼Œå±æ€§éƒ½æ˜¯å¸¸é‡ï¼Œé»˜è®¤æœ‰public static finalä¿®é¥°</li><li>æ¥å£ä¸­ä¸èƒ½å«æœ‰é™æ€ä»£ç å—ä»¥åŠé™æ€æ–¹æ³•ï¼Œè€ŒæŠ½è±¡ç±»å¯ä»¥æœ‰é™æ€ä»£ç å—å’Œé™æ€æ–¹æ³•ï¼›</li><li>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œä¸€ä¸ªç±»å´å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</li></ul></li><li><p>è®¾è®¡ï¼š</p></li><li><ul><li>æŠ½è±¡ç±»ï¼šåŒä¸€ç±»äº‹ç‰©çš„æŠ½å–ï¼Œæ¯”å¦‚é’ˆå¯¹Daoå±‚æ“ä½œçš„å°è£…ï¼Œå¦‚ï¼ŒBaseDaoï¼ŒBaseServiceImpl</li><li>æ¥å£ï¼šé€šå¸¸æ›´åƒæ˜¯ä¸€ç§æ ‡å‡†çš„åˆ¶å®šï¼Œå®šåˆ¶ç³»ç»Ÿä¹‹é—´å¯¹æ¥çš„æ ‡å‡†</li></ul></li></ul><h3 id="4-2ã€JDK8ä¹‹å"><a href="#4-2ã€JDK8ä¹‹å" class="headerlink" title="4.2ã€JDK8ä¹‹å"></a>4.2ã€JDK8ä¹‹å</h3><ul><li>æ¥å£é‡Œé¢å¯ä»¥æœ‰å®ç°çš„æ–¹æ³•ï¼Œæ³¨æ„è¦åœ¨æ–¹æ³•çš„å£°æ˜ä¸ŠåŠ ä¸Šdefaultæˆ–è€…static</li></ul><h2 id="5ã€é‡å†™å’Œé‡è½½"><a href="#5ã€é‡å†™å’Œé‡è½½" class="headerlink" title="5ã€é‡å†™å’Œé‡è½½"></a>5ã€é‡å†™å’Œé‡è½½</h2><h3 id="5-1ã€é‡è½½"><a href="#5-1ã€é‡è½½" class="headerlink" title="5.1ã€é‡è½½"></a>5.1ã€é‡è½½</h3><blockquote><p>é‡è½½å‘ç”Ÿåœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œæ–¹æ³•åç›¸åŒï¼Œå‚æ•°åˆ—è¡¨ä¸åŒ</p><p><strong>é‡è½½å’Œè¿”å›å€¼ç±»å‹æ— å…³</strong>ï¼Œå³ä»¥ä¸‹å†™æ³•ä¸æ„æˆé‡è½½</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="5-2ã€é‡å†™"><a href="#5-2ã€é‡å†™" class="headerlink" title="5.2ã€é‡å†™"></a>5.2ã€é‡å†™</h3><blockquote><p>å‘ç”Ÿåœ¨çˆ¶ç±»å’Œå­ç±»ä¸­ï¼Œæ–¹æ³•åç›¸åŒï¼Œå‚æ•°åˆ—è¡¨ç›¸åŒ</p></blockquote><h2 id="6ã€ArrayListå’ŒLinkedList"><a href="#6ã€ArrayListå’ŒLinkedList" class="headerlink" title="6ã€ArrayListå’ŒLinkedList"></a>6ã€ArrayListå’ŒLinkedList</h2><h3 id="6-1ã€åº•å±‚æ•°æ®ç»“æ„çš„åŒºåˆ«"><a href="#6-1ã€åº•å±‚æ•°æ®ç»“æ„çš„åŒºåˆ«" class="headerlink" title="6.1ã€åº•å±‚æ•°æ®ç»“æ„çš„åŒºåˆ«"></a>6.1ã€åº•å±‚æ•°æ®ç»“æ„çš„åŒºåˆ«</h3><blockquote><p>ArrayListåº•å±‚ä½¿ç”¨äº†æ•°ç»„ï¼Œè¿ç»­ä¸€å—å†…å­˜ç©ºé—´ã€‚</p><p>LinkedListï¼ŒåŒå‘é“¾è¡¨ï¼Œä¸æ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´</p></blockquote><h3 id="6-2ã€å¸¸è§„ç»“è®º"><a href="#6-2ã€å¸¸è§„ç»“è®º" class="headerlink" title="6.2ã€å¸¸è§„ç»“è®º"></a>6.2ã€å¸¸è§„ç»“è®º</h3><ul><li>æ³¨æ„ï¼Œä»¥ä¸‹ç»“è®ºä¸è¿™ä¹ˆä¸¥è°¨</li></ul><blockquote><p>ArrayListï¼ŒæŸ¥æ‰¾å¿«ï¼Œå› ä¸ºæ˜¯è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ–¹ä¾¿å¯»å€ï¼Œä½†åˆ é™¤ï¼Œæ’å…¥æ…¢ï¼Œå› ä¸ºéœ€è¦å‘ç”Ÿæ•°æ®è¿ç§»<br>LinkedListï¼ŒæŸ¥æ‰¾æ…¢ï¼Œå› ä¸ºéœ€è¦é€šè¿‡æŒ‡é’ˆä¸€ä¸ªä¸ªå¯»æ‰¾ï¼Œä½†åˆ é™¤ï¼Œæ’å…¥å—ï¼Œå› ä¸ºåªè¦æ”¹å˜å‰åèŠ‚ç‚¹çš„æŒ‡é’ˆæŒ‡å‘å³å¯ã€‚</p></blockquote><h3 id="6-3ã€ArrayListç»†èŠ‚åˆ†æ"><a href="#6-3ã€ArrayListç»†èŠ‚åˆ†æ" class="headerlink" title="6.3ã€ArrayListç»†èŠ‚åˆ†æ"></a>6.3ã€ArrayListç»†èŠ‚åˆ†æ</h3><blockquote><p>å¢åŠ </p></blockquote><ul><li><p>æ·»åŠ åˆ°æœ«å°¾ï¼Œæ­£å¸¸ä¸éœ€è¦åšç‰¹åˆ«çš„å¤„ç†ï¼Œé™¤éç°æœ‰çš„æ•°ç»„ç©ºé—´ä¸å¤Ÿäº†ï¼Œéœ€è¦æ‰©å®¹</p></li><li><ul><li><p>æ•°ç»„åˆå§‹åŒ–å®¹é‡å¤šå¤§ï¼Ÿ10ï¼Œå½“ä½ çŸ¥é“éœ€è¦å­˜å‚¨å¤šå°‘æ•°æ®æ—¶ï¼Œå»ºè®®åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œç›´æ¥è®¾ç½®åˆå§‹åŒ–å¤§å°</p></li><li><p>æ€ä¹ˆæ‰©å®¹ï¼Ÿ</p></li><li><ul><li>å½“å‘ç°å®¹é‡ä¸å¤Ÿä¹‹åï¼Œå°±è¿›è¡Œæ‰©å®¹</li><li>æŒ‰åŸå…ˆæ•°ç»„å®¹é‡çš„1.5å€è¿›è¡Œæ‰©å®¹ï¼Œä½è¿ç®—ï¼Œä¸‹é¢æ˜¯å…³é”®çš„æºç </li></ul></li><li><p>```java<br>int oldCapacity = elementData.length;<br>int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- - å†å°†åŸå…ˆæ•°ç»„çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ï¼Œä½¿ç”¨æ•°ç»„å·¥å…·ç±»Arraysçš„copyOfæ–¹æ³•</span><br><span class="line"></span><br><span class="line">- &#96;&#96;&#96;java</span><br><span class="line">  elementData &#x3D; Arrays.copyOf(elementData, newCapacity)</span><br></pre></td></tr></table></figure></li></ul></li><li><ul><li>å¦‚æœæ·»åŠ åˆ°å…¶ä»–ä½ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±è¦åšæ•°ç»„æ•´ä½“çš„æ¬è¿</li></ul></li></ul><blockquote><p>åˆ é™¤</p></blockquote><ul><li>åˆ é™¤æœ«å°¾ï¼Œå¹¶ä¸éœ€è¦è¿ç§»</li><li>åˆ é™¤å…¶ä»–ä½ç½®ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ¬è¿</li></ul><blockquote><p>ä¿®æ”¹</p></blockquote><ul><li>ä¿®æ”¹ä¹‹å‰å…ˆå®šä½</li></ul><h3 id="6-4ã€LinkedListç»†èŠ‚åˆ†æ"><a href="#6-4ã€LinkedListç»†èŠ‚åˆ†æ" class="headerlink" title="6.4ã€LinkedListç»†èŠ‚åˆ†æ"></a>6.4ã€LinkedListç»†èŠ‚åˆ†æ</h3><ul><li><p>æä¾›äº†ä¸¤ä¸ªå¼•ç”¨ï¼šfirstå’Œlast</p></li><li><p>å¢åŠ </p></li></ul><blockquote><p>æ·»åŠ åˆ°æœ«å°¾ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå°†ä¹‹å‰çš„lastèŠ‚ç‚¹è®¾ç½®ä¸ºæ–°èŠ‚ç‚¹çš„preï¼Œæ–°èŠ‚ç‚¹è®¾ç½®ä¸ºlast</p><p>æˆ‘ä»¬çœ‹ä¸‹æºç ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">linkLast</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·å–åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹â€‹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; l = last;</span><br><span class="line">    <span class="comment">//æ„å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œå°†å½“å‰çš„lastä½œä¸ºè¿™ä¸ªæ–°èŠ‚ç‚¹çš„preâ€‹</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(l, e, <span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">//æŠŠlastæŒ‡å‘æ–°èŠ‚ç‚¹â€‹</span></span><br><span class="line">    last = newNode;</span><br><span class="line">    <span class="comment">//å¦‚æœåŸå…ˆæ²¡æœ‰æœ€åä¸€ä¸ªèŠ‚ç‚¹â€‹</span></span><br><span class="line">    <span class="keyword">if</span> (l == <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">//å°†firstæŒ‡å‘æ–°èŠ‚ç‚¹â€‹</span></span><br><span class="line">        first = newNode;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">//å¦åˆ™ï¼Œå°†åŸå…ˆçš„lastçš„nextæŒ‡å‘æ–°èŠ‚ç‚¹â€‹</span></span><br><span class="line">        l.next = newNode;</span><br><span class="line">    size++;</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br><span class="line">NodeèŠ‚ç‚¹çš„å®šä¹‰ï¼šå†…éƒ¨ç±»</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    E item;</span><br><span class="line">    Node&lt;E&gt; next;</span><br><span class="line">    Node&lt;E&gt; prev;</span><br><span class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = element;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">        <span class="keyword">this</span>.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7ã€ArrayListå’ŒVector"><a href="#7ã€ArrayListå’ŒVector" class="headerlink" title="7ã€ArrayListå’ŒVector"></a>7ã€ArrayListå’ŒVector</h2><h3 id="7-1ã€åŸºæœ¬ä»‹ç»"><a href="#7-1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="7.1ã€åŸºæœ¬ä»‹ç»"></a>7.1ã€åŸºæœ¬ä»‹ç»</h3><blockquote><p>ArrayListï¼šçº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•ˆç‡é«˜ï¼Œå¸¸ç”¨<br>Vectorï¼šçº¿ç¨‹å®‰å…¨çš„ï¼Œæ•ˆç‡ä½</p></blockquote><h3 id="7-2ã€CopyOnWriteArrayList"><a href="#7-2ã€CopyOnWriteArrayList" class="headerlink" title="7.2ã€CopyOnWriteArrayList"></a>7.2ã€CopyOnWriteArrayList</h3><blockquote><p>ç”±äºArrayListæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œåœ¨é«˜å¹¶å‘è¯»å†™æƒ…å†µä¸‹ï¼ŒArrayListå¯èƒ½ä¼šæŠ¥<strong>ConcurrentModificationException</strong> å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¯»æ‰¾åœ¨é«˜å¹¶å‘æ¡ä»¶ä¸‹èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨çš„æ›¿ä»£å“ã€‚</p><p>Vectoræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†ç”±äºå®ƒä½¿ç”¨synchronizedæ¥ä¿è¯å®‰å…¨æ€§ï¼Œæ‰€ä»¥å¯¼è‡´å®ƒæ•ˆç‡ä½ï¼Œæ‰€ä»¥åœ¨é«˜å¹¶å‘æ¡ä»¶ä¸‹ä¹Ÿä¸è€ƒè™‘Vectorã€‚</p><p>å¯¹äºå¹¶å‘é‡å°çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Collectionså·¥å…·ç±»çš„synchronizedList()æ¥åŒ…è£…ä¸€ä¸ªArrayListï¼Œä½¿åŸæœ¬çº¿ç¨‹ä¸å®‰å…¨çš„ArrayListå¯¹è±¡çº¿ç¨‹å®‰å…¨ã€‚</p><p>åœ¨é«˜å¹¶å‘æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CopyOnWriteArrayListæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿™ç§æ•°æ®ç»“æ„ä½¿ç”¨è¯»å†™åˆ†ç¦»æ¥æé«˜æ•ˆç‡ã€‚</p></blockquote><h2 id="8ã€HashMapã€HashTableå’ŒConcurrentHashMapçš„åŒºåˆ«"><a href="#8ã€HashMapã€HashTableå’ŒConcurrentHashMapçš„åŒºåˆ«" class="headerlink" title="8ã€HashMapã€HashTableå’ŒConcurrentHashMapçš„åŒºåˆ«"></a>8ã€HashMapã€HashTableå’ŒConcurrentHashMapçš„åŒºåˆ«</h2><h3 id="8-1ã€åŸºæœ¬åŒºåˆ«"><a href="#8-1ã€åŸºæœ¬åŒºåˆ«" class="headerlink" title="8.1ã€åŸºæœ¬åŒºåˆ«"></a>8.1ã€åŸºæœ¬åŒºåˆ«</h3><blockquote><p>Hashtableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ•ˆç‡ä½<br>HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä½†æ•ˆç‡é«˜<br>Collections.synchronizedMap()ï¼Œå·¥å…·ç±»æä¾›äº†åŒæ­¥åŒ…è£…å™¨çš„æ–¹æ³•ï¼Œæ¥è¿”å›å…·æœ‰çº¿ç¨‹å®‰å…¨çš„é›†åˆå¯¹è±¡ï¼Œä½†æ€§èƒ½ä¾ç„¶æœ‰é—®é¢˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function">Map&lt;K,V&gt; <span class="title">synchronizedMap</span><span class="params">(Map&lt;K,V&gt; m)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SynchronizedMap&lt;&gt;(m);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åœ¨è¿™ä¸ªç±»çš„å†…éƒ¨æ–¹æ³•å®ç°ä¸Šï¼Œä¹Ÿåªæ˜¯å•çº¯åŠ ä¸Šäº†é”</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line"><span class="keyword">synchronized</span> (mutex) &#123;<span class="keyword">return</span> m.put(key, value);&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºè§£å†³è¿™æ ·çš„çŸ›ç›¾é—®é¢˜ï¼Œæ‰€ä»¥JDKæä¾›äº†å¹¶å‘åŒ…ï¼Œæ¥å¹³è¡¡è¿™æ ·çš„é—®é¢˜ï¼ˆjava.util.concurrentï¼‰</p><h3 id="8-2ã€ConcurrentHashMapï¼ˆé‡ç‚¹ï¼‰"><a href="#8-2ã€ConcurrentHashMapï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="8.2ã€ConcurrentHashMapï¼ˆé‡ç‚¹ï¼‰"></a>8.2ã€ConcurrentHashMapï¼ˆé‡ç‚¹ï¼‰</h3><ul><li>å…¼é¡¾äº†çº¿ç¨‹å®‰å…¨å’Œæ•ˆç‡çš„é—®é¢˜</li></ul><blockquote><p>åˆ†æï¼šHashTableé”äº†æ•´æ®µæ•°æ®ï¼ˆç”¨æˆ·æ“ä½œæ˜¯ä¸åŒçš„æ•°æ®æ®µï¼Œä¾ç„¶éœ€è¦ç­‰å¾…ï¼‰<br>è§£å†³æ–¹æ¡ˆï¼šæŠŠæ•°æ®åˆ†æ®µï¼Œæ‰§è¡Œåˆ†æ®µé”ï¼ˆåˆ†ç¦»é”ï¼‰ï¼Œæ ¸å¿ƒæŠŠé”çš„èŒƒå›´å˜å°ï¼Œè¿™æ ·å‡ºç°å¹¶å‘å†²çªçš„æ¦‚ç‡å°±å˜å°<br>åœ¨ä¿å­˜çš„æ—¶å€™ï¼Œè®¡ç®—æ‰€å­˜å‚¨çš„æ•°æ®æ˜¯å±äºå“ªä¸€æ®µï¼Œåªé”å½“å‰è¿™ä¸€æ®µ</p></blockquote><ul><li><strong>æ³¨æ„ï¼šåˆ†æ®µé”ï¼ˆåˆ†ç¦»é”ï¼‰æ˜¯JDK1.8ä¹‹å‰çš„ä¸€ç§çš„æ–¹æ¡ˆï¼ŒJDK1.8ä¹‹ååšäº†ä¼˜åŒ–ã€‚</strong></li></ul><p><strong>JDK1.7è·ŸJDK1.8åœ¨ConcurrentHashMapçš„å®ç°ä¸Šå­˜åœ¨ä»¥ä¸‹åŒºåˆ«ï¼š</strong></p><p><strong>1ï¼Œæ•°æ®ç»“æ„</strong></p><p>JDK1.7é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼ï¼Œè€ŒJDK1.8åˆ™é‡‡ç”¨é“¾è¡¨+çº¢é»‘æ ‘çš„æ–¹å¼</p><p><strong>2ï¼Œå‘ç”Ÿhashç¢°æ’ä¹‹å</strong></p><p>JDK1.7å‘ç”Ÿç¢°æ’ä¹‹åï¼Œä¼šé‡‡ç”¨é“¾è¡¨çš„æ–¹å¼æ¥è§£å†³</p><p>JDK1.8å‘ç”Ÿç¢°æ’ä¹‹åï¼Œé»˜è®¤é‡‡ç”¨é“¾è¡¨ï¼Œä½†å½“é“¾è¡¨çš„é•¿åº¦è¶…è¿‡8ï¼Œä¸”æ•°ç»„å®¹é‡è¶…è¿‡64æ—¶ï¼Œä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘å­˜å‚¨</p><p><strong>3ï¼Œä¿è¯å¹¶å‘å®‰å…¨</strong></p><p>JDK1.7é‡‡ç”¨åˆ†æ®µé”çš„æ–¹å¼ï¼Œè€ŒJDK1.8é‡‡ç”¨CASå’Œsynchronizedçš„ç»„åˆæ¨¡å¼</p><p><strong>4ï¼ŒæŸ¥è¯¢å¤æ‚åº¦</strong></p><p>JDK1.7é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œè€ŒJDK1.8åœ¨é‡‡ç”¨çº¢é»‘æ ‘çš„æ–¹å¼æ—¶ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(log(n))</p><h2 id="9ã€IOæµçš„åˆ†ç±»å’Œé€‰æ‹©"><a href="#9ã€IOæµçš„åˆ†ç±»å’Œé€‰æ‹©" class="headerlink" title="9ã€IOæµçš„åˆ†ç±»å’Œé€‰æ‹©"></a>9ã€IOæµçš„åˆ†ç±»å’Œé€‰æ‹©</h2><h3 id="9-1ã€åˆ†ç±»"><a href="#9-1ã€åˆ†ç±»" class="headerlink" title="9.1ã€åˆ†ç±»"></a>9.1ã€åˆ†ç±»</h3><ul><li>æŒ‰æ–¹å‘åˆ†ï¼šè¾“å…¥æµï¼Œè¾“å‡ºæµ</li></ul><blockquote><p>ï¼ˆæ³¨æ„ï¼Œæ˜¯ç«™åœ¨ç¨‹åºçš„è§’åº¦æ¥çœ‹æ–¹å‘ï¼‰ï¼Œè¾“å…¥æµç”¨äºè¯»æ–‡ä»¶ï¼Œè¾“å‡ºæµç”¨äºå†™æ–‡ä»¶</p></blockquote><ul><li><p>æŒ‰è¯»å–çš„å•ä½åˆ†ï¼šå­—èŠ‚æµï¼Œå­—ç¬¦æµ</p></li><li><p>æŒ‰å¤„ç†çš„æ–¹å¼åˆ†ï¼šèŠ‚ç‚¹æµï¼Œå¤„ç†æµ</p></li></ul><blockquote><p>æ¯”å¦‚ï¼ŒFileInputStreamå’ŒBufferedInputStream(åè€…å¸¦æœ‰ç¼“å­˜åŒºåŠŸèƒ½-byte[])</p></blockquote><ul><li>IOæµçš„4å¤§åŸºç±»ï¼šInputStreamï¼ŒOutputStreamï¼ŒReaderï¼ŒWriter</li></ul><h3 id="9-2ã€é€‰æ‹©"><a href="#9-2ã€é€‰æ‹©" class="headerlink" title="9.2ã€é€‰æ‹©"></a>9.2ã€é€‰æ‹©</h3><blockquote><p>å­—èŠ‚æµå¯ä»¥è¯»å–ä»»ä½•æ–‡ä»¶<br>è¯»å–æ–‡æœ¬æ–‡ä»¶çš„æ—¶å€™ï¼šé€‰æ‹©å­—ç¬¦æµï¼ˆå‡å¦‚æœ‰è§£ææ–‡ä»¶çš„å†…å®¹çš„éœ€æ±‚ï¼Œæ¯”å¦‚é€è¡Œå¤„ç†ï¼Œåˆ™é‡‡ç”¨å­—ç¬¦æµï¼Œæ¯”å¦‚txtæ–‡ä»¶ï¼‰<br>è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶çš„æ—¶å€™ï¼Œé€‰æ‹©å­—èŠ‚æµï¼ˆè§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œdocï¼Œpptï¼‰</p></blockquote><h2 id="10ã€Exceptionå’ŒError"><a href="#10ã€Exceptionå’ŒError" class="headerlink" title="10ã€Exceptionå’ŒError"></a>10ã€Exceptionå’ŒError</h2><h3 id="10-1ã€Exceptionå’ŒErrorçš„åŒºåˆ«"><a href="#10-1ã€Exceptionå’ŒErrorçš„åŒºåˆ«" class="headerlink" title="10.1ã€Exceptionå’ŒErrorçš„åŒºåˆ«"></a>10.1ã€Exceptionå’ŒErrorçš„åŒºåˆ«</h3><blockquote><p>Exceptionå’ŒErrorä¸¤è€…å‡æ˜¯Throwableçš„å­ç±»ï¼Œä¸€ä¸ªå¼‚å¸¸åªæœ‰æ˜¯Throwableçš„å­ç±»ï¼Œæ‰èƒ½è¢«ç¨‹åºæ•è·å’ŒæŠ›å‡º</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210226202156.png" alt="image-20210226202153816"></p><ul><li>ErroræŒ‡æ­£å¸¸æƒ…å†µä¸‹ä¸å¤ªå¯èƒ½å‡ºç°çš„æƒ…å†µï¼Œç»å¤§éƒ¨åˆ†çš„ErroræŒ‡ç¨‹åºå´©æºƒï¼Œå¤„äºéæ­£å¸¸ä¸å¯æ¢å¤çš„çŠ¶æ€ï¼Œå¦‚OutOfMemoryErrorå’ŒStackOverflowError</li><li>Exceptionæ˜¯ç¨‹åºæ­£å¸¸è¿è¡Œä¸­å¯ä»¥é¢„æ–™çš„æ„å¤–æƒ…å†µï¼Œå¯ä»¥æ•è·å’Œå¤„ç†</li></ul><h3 id="10-2ã€è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸çš„åŒºåˆ«"><a href="#10-2ã€è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸çš„åŒºåˆ«" class="headerlink" title="10.2ã€è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸çš„åŒºåˆ«"></a>10.2ã€è¿è¡Œæ—¶å¼‚å¸¸å’Œä¸€èˆ¬å¼‚å¸¸çš„åŒºåˆ«</h3><blockquote><p>éè¿è¡Œæ—¶å¼‚å¸¸</p></blockquote><ul><li>åœ¨ç¼–è¯‘æ—¶è¢«å¼ºåˆ¶æ£€æŸ¥çš„å¼‚å¸¸ï¼Œåœ¨æ–¹æ³•å£°æ˜ä¸­å£°æ˜çš„å¼‚å¸¸ï¼Œå¦‚ClassNotFoundExceptionã€IOException</li></ul><blockquote><p>è¿è¡Œæ—¶å¼‚å¸¸</p></blockquote><ul><li>ä¸å—æ£€æŸ¥ä½†é€šå¸¸åœ¨ç¼–ç ä¸­å¯ä»¥é¿å…çš„é€»è¾‘é”™è¯¯ï¼Œæ ¹æ®éœ€è¦æ¥åˆ¤æ–­å¦‚ä½•å¤„ç†ï¼Œä¸éœ€è¦å†ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚ï¼›å¦‚ConcurrentModificationExceptionã€NullPointerExceptionç­‰</li></ul><h2 id="11ã€Servletç”Ÿå‘½å‘¨æœŸ"><a href="#11ã€Servletç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="11ã€Servletç”Ÿå‘½å‘¨æœŸ"></a>11ã€Servletç”Ÿå‘½å‘¨æœŸ</h2><ul><li>Webå®¹å™¨åŠ è½½Servletç±»å¹¶å®ä¾‹åŒ–ï¼ˆé»˜è®¤å»¶è¿ŸåŠ è½½ï¼Œä¸€æ¬¡ï¼‰</li><li>è°ƒç”¨initæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼ˆä¸€æ¬¡ï¼‰</li><li>ç”¨æˆ·è¯·æ±‚Servletï¼Œè¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œè¿è¡Œå…¶serviceæ–¹æ³•ï¼ˆæ¯æ¬¡ï¼‰</li><li>serviceæ–¹æ³•ä¸­æ ¹æ®ç”¨æˆ·è¯·æ±‚æ–¹å¼æ¥è°ƒç”¨å¯¹åº”çš„doXXXæ–¹æ³•ï¼ˆæ¯æ¬¡ï¼‰</li><li>é”€æ¯å®ä¾‹æ—¶è°ƒç”¨destroyæ–¹æ³•ï¼ˆä¸€æ¬¡ï¼‰</li></ul><h2 id="12ã€è½¬å‘ï¼ˆforwardï¼‰å’Œé‡å®šå‘ï¼ˆredirectï¼‰çš„åŒºåˆ«"><a href="#12ã€è½¬å‘ï¼ˆforwardï¼‰å’Œé‡å®šå‘ï¼ˆredirectï¼‰çš„åŒºåˆ«" class="headerlink" title="12ã€è½¬å‘ï¼ˆforwardï¼‰å’Œé‡å®šå‘ï¼ˆredirectï¼‰çš„åŒºåˆ«"></a>12ã€è½¬å‘ï¼ˆforwardï¼‰å’Œé‡å®šå‘ï¼ˆredirectï¼‰çš„åŒºåˆ«</h2><ul><li>è¯·æ±‚è½¬å‘æ˜¯å®¹å™¨æ§åˆ¶çš„è·³è½¬ï¼ŒæœåŠ¡å™¨ç›´æ¥è®¿é—®ç›®æ ‡åœ°å€ï¼ŒæŠŠç›®æ ‡åœ°å€å“åº”çš„å†…å®¹è¯»å–å‡ºæ¥ï¼Œç›´æ¥å‘ç»™æµè§ˆå™¨ã€‚æµè§ˆå™¨ä¸çŸ¥é“è¯·æ±‚ä»å“ªé‡Œæ¥ï¼Œ<strong>æµè§ˆå™¨åœ°å€ä¸æ”¹å˜</strong></li><li>é‡å®šå‘æ˜¯æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œè¿”å›ä¸€ä¸ªçŠ¶æ€ç ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨è¯·æ±‚æ–°åœ°å€ï¼Œåœ°å€æ æ”¹å˜</li><li>è¯·æ±‚è½¬å‘æ•ˆç‡æ›´é«˜ï¼Œå°½é‡ç”¨è¯·æ±‚è½¬å‘ï¼Œä½†è¯·æ±‚è½¬å‘ä¸èƒ½è·³è½¬åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šï¼Œé‡å®šå‘å¯ä»¥è·³è½¬åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚</li></ul><h2 id="13ã€jspå†…ç½®å¯¹è±¡"><a href="#13ã€jspå†…ç½®å¯¹è±¡" class="headerlink" title="13ã€jspå†…ç½®å¯¹è±¡"></a>13ã€jspå†…ç½®å¯¹è±¡</h2><ul><li>request</li></ul><blockquote><p>å‘å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®</p></blockquote><ul><li>response</li></ul><blockquote><p>å°è£…äº†jspäº§ç”Ÿçš„å“åº”ï¼Œç„¶åè¢«å‘é€åˆ°å®¢æˆ·ç«¯ä»¥å“åº”å®¢æˆ·è¯·æ±‚ã€‚</p></blockquote><ul><li>pageContext</li></ul><blockquote><p>ä¸ºjspé¡µé¢åŒ…è£…é¡µé¢çš„ä¸Šä¸‹æ–‡</p></blockquote><ul><li>session</li></ul><blockquote><p>ç”¨äºä¿å­˜æ¯ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œä»¥ä¾¿è·Ÿè¸ªæ¯ä¸ªç”¨æˆ·çš„æ“ä½œçŠ¶æ€</p></blockquote><ul><li>application</li></ul><blockquote><p>åº”ç”¨ç¨‹åºå¯¹è±¡</p></blockquote><ul><li>out</li></ul><blockquote><p>å‘å®¢æˆ·ç«¯è¾“å‡ºæ•°æ®</p></blockquote><ul><li>config</li></ul><blockquote><p>è¡¨ç¤ºServletçš„é…ç½®ï¼Œå½“ä¸€ä¸ªServletåˆå§‹åŒ–æ—¶ï¼Œå®¹å™¨æŠŠæŸäº›ä¿¡æ¯é€šè¿‡æ­¤å¯¹è±¡ä¼ é€’ç»™è¿™ä¸ªServlet</p></blockquote><ul><li>page</li></ul><blockquote><p>Jspå®ç°ç±»çš„å®ä¾‹ï¼Œå®ƒæ˜¯Jspæœ¬èº«ï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥å¯¹å®ƒè¿›è¡Œè®¿é—®</p></blockquote><ul><li>exception</li></ul><blockquote><p>åæ˜ è¿è¡Œæ—¶çš„å¼‚å¸¸</p></blockquote><h2 id="14ã€Getå’ŒPostçš„åŒºåˆ«"><a href="#14ã€Getå’ŒPostçš„åŒºåˆ«" class="headerlink" title="14ã€Getå’ŒPostçš„åŒºåˆ«"></a>14ã€Getå’ŒPostçš„åŒºåˆ«</h2><ul><li>Getå°†è¡¨å•ä¸­æ•°æ®æŒ‰ç…§param-valueçš„å½¢å¼æ·»åŠ åˆ°actionæ‰€æŒ‡å‘çš„URLåé¢ï¼Œä¸”ä¸¤è€…ç”¨â€?â€è¿æ¥ï¼Œå„å˜é‡é—´ä½¿ç”¨â€&amp;â€è¿æ¥ã€‚</li><li>Postå°†è¡¨å•ä¸­æ•°æ®å­˜æ”¾å†formæ•°æ®ä½“ä¸­ï¼ŒæŒ‰ç…§å˜é‡å’Œå€¼å¯¹åº”çš„æ–¹å¼ï¼Œä¼ é€’åˆ°actionæ‰€æŒ‡å‘çš„URL</li><li>Getæ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®è¢«æ”¾åœ¨è¯·æ±‚URLä¸­ï¼›è€ŒPostçš„æ‰€æœ‰æ“ä½œå¯¹ç”¨æˆ·æ¥è¯´éƒ½æ˜¯ä¸å¯è§çš„</li><li>Getä¼ è¾“çš„æ•°æ®é‡å°ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºURLæœ‰é•¿åº¦é™åˆ¶ï¼›è€ŒPostå¯ä»¥ä¼ è¾“å¤§é‡çš„æ•°æ®ï¼Œæ‰€ä»¥ä¸Šä¼ æ–‡ä»¶åªèƒ½ç”¨Post</li><li>Geté™åˆ¶formè¡¨å•æ•°æ®å¿…é¡»ä¸ºASCIIå­—ç¬¦ï¼ŒPostæ”¯ä»˜æ•´ä¸ªISOå­—ç¬¦é›†</li></ul><h2 id="15ã€Sessionå’ŒCookieçš„åŒºåˆ«"><a href="#15ã€Sessionå’ŒCookieçš„åŒºåˆ«" class="headerlink" title="15ã€Sessionå’ŒCookieçš„åŒºåˆ«"></a>15ã€Sessionå’ŒCookieçš„åŒºåˆ«</h2><ul><li>sessionä¿å­˜åœ¨æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä¸çŸ¥é“å…¶ä¸­ä¿¡æ¯ï¼›cookieä¿å­˜åœ¨å®¢æˆ·ç«¯ã€‚</li><li>sessionä¸­ä¿å­˜çš„æ˜¯å¯¹è±¡ï¼Œcookieä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²</li><li>sessionä¸èƒ½ åŒºåˆ†è·¯å¾„ï¼ŒåŒä¸€ä¸ªç”¨æˆ·åœ¨è®¿é—®ä¸€ä¸ªç½‘ç«™æœŸé—´ï¼Œæ‰€æœ‰çš„sessionåœ¨ä»»ä½•ä¸€ä¸ªåœ°æ–¹éƒ½å¯ä»¥è®¿é—®åˆ°ã€‚è€Œcookieä¸­å¦‚æœè®¾ç½®äº†è·¯å¾„å‚æ•°ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªç½‘ç«™ä¸­ä¸åŒè·¯å¾„ä¸‹çš„cookieäº’ç›¸æ˜¯è®¿é—®ä¸åˆ°çš„</li><li>sessionéœ€è¦å€ŸåŠ©cookieæ‰èƒ½æ­£å¸¸è®¿é—®ï¼Œå¦‚æœå®¢æˆ·ç«¯å®Œå…¨ç¦æ­¢cookieï¼Œé‚£ä¹ˆsessionå°†å¤±æ•ˆ</li><li>sessionå­˜å‚¨çš„æ•°æ®å¤§å°å—æœåŠ¡å™¨å†…å­˜æ§åˆ¶ï¼Œè€Œcookieä¸€èˆ¬å¤§å°ä¸º4k</li></ul><h2 id="16ã€sleepå’Œwaitçš„åŒºåˆ«"><a href="#16ã€sleepå’Œwaitçš„åŒºåˆ«" class="headerlink" title="16ã€sleepå’Œwaitçš„åŒºåˆ«"></a>16ã€sleepå’Œwaitçš„åŒºåˆ«</h2><ul><li>æ‰€å±çš„ç±»ä¸åŒ</li></ul><blockquote><p>sleepæ–¹æ³•å®šä¹‰åœ¨Threadä¸Š</p><p>waitæ–¹æ³•å®šä¹‰åœ¨Objectä¸Š</p></blockquote><ul><li>å¯¹äºæ‰€èµ„æºçš„å¤„ç†æ–¹å¼ä¸åŒ</li></ul><blockquote><p>sleepä¸ä¼šé‡Šæ”¾é”</p><p>waitä¼šé‡Šæ”¾é”</p></blockquote><ul><li>é€‚ç”¨èŒƒå›´</li></ul><blockquote><p>sleepå¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•ä»£ç å—</p><p>waitå¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­æ‰§è¡Œ</p></blockquote><ul><li>å’Œwaité…å¥—ä½¿ç”¨çš„æ–¹æ³•</li></ul><blockquote><ul><li>void notify()</li></ul><p>å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹</p><ul><li>void notifyAll()</li></ul><p>å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹</p></blockquote><h2 id="17ã€JSPå’ŒServletçš„åŒºåˆ«"><a href="#17ã€JSPå’ŒServletçš„åŒºåˆ«" class="headerlink" title="17ã€JSPå’ŒServletçš„åŒºåˆ«"></a>17ã€JSPå’ŒServletçš„åŒºåˆ«</h2><ul><li>æŠ€æœ¯è§’åº¦</li></ul><blockquote><p>JSPæœ¬è´¨å°±æ˜¯ä¸€ä¸ªServlet<br>JSPçš„å·¥ä½œåŸç†ï¼šJSP-&gt;ç¿»è¯‘-&gt;Servlet(java)-&gt;ç¼–è¯‘-&gt;Classï¼ˆæœ€ç»ˆè·‘çš„æ–‡ä»¶ï¼‰</p></blockquote><ul><li>åº”ç”¨è§’åº¦</li></ul><blockquote><p>JSPç‰¹ç‚¹åœ¨äºå®ç°è§†å›¾ï¼ŒServletç‰¹ç‚¹åœ¨äºå®ç°æ§åˆ¶é€»è¾‘</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•ç›¸å…³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰-é›†åˆç±»ç›¸å…³ã€Callableæ¥å£åŠJUCå¸¸ç”¨è¾…åŠ©ç±»</title>
      <link href="posts/417387534.html"/>
      <url>posts/417387534.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="å››ã€é›†åˆç±»ä¸å®‰å…¨"><a href="#å››ã€é›†åˆç±»ä¸å®‰å…¨" class="headerlink" title="å››ã€é›†åˆç±»ä¸å®‰å…¨"></a>å››ã€é›†åˆç±»ä¸å®‰å…¨</h1><h2 id="4-1ã€ArrayListä¸å®‰å…¨"><a href="#4-1ã€ArrayListä¸å®‰å…¨" class="headerlink" title="4.1ã€ArrayListä¸å®‰å…¨"></a>4.1ã€ArrayListä¸å®‰å…¨</h2><h3 id="1ã€é—®é¢˜è¯´æ˜"><a href="#1ã€é—®é¢˜è¯´æ˜" class="headerlink" title="1ã€é—®é¢˜è¯´æ˜"></a>1ã€é—®é¢˜è¯´æ˜</h3><ul><li>åœ¨å¤šçº¿ç¨‹æ¡ä»¶ä¸‹å¾€ArrayListé›†åˆä¸­æ·»åŠ å¯¹è±¡</li></ul><blockquote><p>åœ¨å¤šçº¿ç¨‹æ¡ä»¶ä¸‹è°ƒç”¨ArrayListå¯¹è±¡çš„addæ–¹æ³•ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">            System.out.println(list);</span><br><span class="line">        &#125;,String.valueOf(i)).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼Œå‘ç°æ¯ä¸€æ¬¡ç¨‹åºçš„æ‰§è¡Œç»“æœä¸­ï¼Œé›†åˆå¯¹è±¡çš„ä¸ªæ•°å‡ä¸ç›¸åŒã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225133747.png" alt="image-20210225133739112"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225133803.png" alt="image-20210225133803329"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225133827.png" alt="image-20210225133827161"></p><ul><li>ä¿®æ”¹ä¸Šä¸€ä¸ªç¨‹åºçš„çº¿ç¨‹æ•°é‡ï¼Œç”±3ä¸ªå˜ä¸º30ä¸ª</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœï¼Œå½“çº¿ç¨‹ä¸ªæ•°è¾¾åˆ°30ï¼Œæ­¤æ—¶è¿è¡Œç¨‹åºï¼Œå‘ç°ç¨‹åºä¼šæŠ¥ConcurrentModificationExceptionå¼‚å¸¸</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225134315.png" alt="Ex"></p><h3 id="2ã€å¯¼è‡´åŸå› "><a href="#2ã€å¯¼è‡´åŸå› " class="headerlink" title="2ã€å¯¼è‡´åŸå› "></a>2ã€å¯¼è‡´åŸå› </h3><blockquote><p>ç”±äºArrayListæ˜¯<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>çš„ï¼ŒArrayListåœ¨è¿­ä»£çš„æ—¶å€™å¦‚æœåŒæ—¶å¯¹å…¶è¿›è¡Œä¿®æ”¹å°±ä¼š</p><p>æŠ›å‡ºjava.util.ConcurrentModificationExceptionå¼‚å¸¸</p><p>è¿™æ˜¯ä¸€ä¸ªå¹¶å‘ä¿®æ”¹å¼‚å¸¸</p></blockquote><h3 id="3ã€è§£å†³æ–¹æ¡ˆ"><a href="#3ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3ã€è§£å†³æ–¹æ¡ˆ"></a>3ã€è§£å†³æ–¹æ¡ˆ</h3><ul><li>å°†ArrayListæ¢æˆVectorï¼ŒVectoræ˜¯çº¿ç¨‹å®‰å…¨çš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Vectorä¸­çš„addæ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225135416.png" alt="image-20210225135416626"></p><ul><li>ä½¿ç”¨Collectionså·¥å…·ç±»çš„synchronizedListæ–¹æ³•ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„ArrayListå˜ä¸ºçº¿ç¨‹å®‰å…¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Collections.synchronizedList(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç¨‹åºï¼Œå‘ç°é—®é¢˜å·²ç»è§£å†³ï¼Œè¿™ç§æ–¹æ³•åœ¨æ•°æ®é‡å°çš„æƒ…å†µä¸‹å®Œå…¨å¤Ÿç”¨</p></blockquote><ul><li>ä½¿ç”¨CopyOnWriteArrayListç±»ä»£æ›¿ArrayList</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2ã€CopyOnWriteArrayList"><a href="#4-2ã€CopyOnWriteArrayList" class="headerlink" title="4.2ã€CopyOnWriteArrayList"></a>4.2ã€CopyOnWriteArrayList</h2><blockquote><p>ä¸åŠ é”æ€§èƒ½æå‡å‡ºé”™è¯¯ï¼ŒåŠ é”æ•°æ®ä¸€è‡´æ€§èƒ½ä¸‹é™</p></blockquote><h3 id="1ã€å®šä¹‰"><a href="#1ã€å®šä¹‰" class="headerlink" title="1ã€å®šä¹‰"></a>1ã€å®šä¹‰</h3><blockquote><p>CopyOnWriteArrayListæ˜¯arraylistçš„ä¸€ç§çº¿ç¨‹å®‰å…¨å˜ä½“ï¼Œ</p><p>å…¶ä¸­æ‰€æœ‰å¯å˜æ“ä½œï¼ˆaddã€setç­‰ï¼‰éƒ½æ˜¯é€šè¿‡ç”Ÿæˆåº•å±‚æ•°ç»„çš„æ–°å‰¯æœ¬æ¥å®ç°çš„ã€‚</p></blockquote><h3 id="2ã€addæ–¹æ³•"><a href="#2ã€addæ–¹æ³•" class="headerlink" title="2ã€addæ–¹æ³•"></a>2ã€addæ–¹æ³•</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225151433.png" alt="image-20210225151432318"></p><blockquote><p>å¾€CopyOnWriteArrayListå¯¹è±¡ä¸­æ·»åŠ æ•°æ®çš„æ­¥éª¤å¦‚ä¸‹</p></blockquote><ul><li>ä¸ºCopyOnWriteArrayListå¯¹è±¡åŠ é”</li><li>ä½¿ç”¨ä¸€ä¸ªObjectæ•°ç»„ä¿å­˜å½“å‰CopyOnWriteArrayListå¯¹è±¡åŸæœ‰çš„æ•°ç»„</li><li>ä½¿ç”¨Arrayså·¥å…·ç±»çš„copyOfæ–¹æ³•å°†åŸæ¥æ•°ç»„çš„æ•°æ®æ‹·è´åˆ°ä¸€ä¸ªæ–°æ•°ç»„ä¸­ï¼Œæ–°æ•°ç»„çš„é•¿åº¦ä¸ºåŸæ¥æ•°ç»„é•¿åº¦  +  1</li><li>ä½¿ç”¨æ–°æ•°ç»„ä»£æ›¿CopyOnWriteArrayListåŸæœ‰çš„æ•°ç»„ï¼Œè¿”å›true</li><li>è§£é”</li></ul><h3 id="3ã€å†™æ—¶å¤åˆ¶"><a href="#3ã€å†™æ—¶å¤åˆ¶" class="headerlink" title="3ã€å†™æ—¶å¤åˆ¶"></a>3ã€å†™æ—¶å¤åˆ¶</h3><blockquote><p>CopyOnWrite å®¹å™¨å³å†™æ—¶å¤åˆ¶å®¹å™¨ï¼Œå¾€ä¸€ä¸ªå®¹å™¨ä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œä¸ç›´æ¥å¾€å½“å‰å®¹å™¨çš„Object[] æ·»åŠ ï¼Œè€Œæ˜¯å…ˆå°†å½“å‰å®¹å™¨çš„Object[] è¿›è¡Œcopyï¼Œå¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„å®¹å™¨object[] newElementsï¼Œç„¶åå¾€æ–°çš„å®¹å™¨ä¸­æ·»åŠ å…ƒç´ ï¼Œæ·»åŠ å®Œå…ƒç´ åï¼Œå†å°†åŸæ¥å®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ï¼ˆsetArray(newElements)ï¼‰ï¼Œè¿™æ ·åšçš„å¥½å¤„å®å¯ä»¥å¯¹CopyOnWrite å®¹å™¨è¿›è¡Œå¹¶å‘çš„è¯»ï¼Œè€Œä¸éœ€è¦åŠ é”ï¼Œå› ä¸ºå½“å‰å®¹å™¨ä¸ä¼šæ·»åŠ ä»»ä½•å…ƒç´ ï¼Œæ‰€ä»¥CopyOnWrite å®¹å™¨ä¹Ÿæ˜¯ä¸€ç§è¯»å†™åˆ†ç¦»çš„æ€æƒ³ï¼Œè¯»å’Œå†™ä½¿ç”¨ä¸åŒçš„å®¹å™¨ã€‚</p></blockquote><h2 id="4-3ã€HashSetçº¿ç¨‹ä¸å®‰å…¨"><a href="#4-3ã€HashSetçº¿ç¨‹ä¸å®‰å…¨" class="headerlink" title="4.3ã€HashSetçº¿ç¨‹ä¸å®‰å…¨"></a>4.3ã€HashSetçº¿ç¨‹ä¸å®‰å…¨</h2><h3 id="1ã€ä¸¾ä¾‹è¯´æ˜"><a href="#1ã€ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="1ã€ä¸¾ä¾‹è¯´æ˜"></a>1ã€ä¸¾ä¾‹è¯´æ˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        set.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼Œå‘ç°åŒæ ·æŠ¥äº†java.util.ConcurrentModificationException å¼‚å¸¸ï¼Œè¯´æ˜HashSetä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</p></blockquote><h3 id="2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»"><a href="#2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»" class="headerlink" title="2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»"></a>2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = Collections.synchronizedSet(<span class="keyword">new</span> HashSet&lt;&gt;());</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        set.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€è§£å†³æ–¹æ³•äºŒ-CopyOnWriteArraySet"><a href="#3ã€è§£å†³æ–¹æ³•äºŒ-CopyOnWriteArraySet" class="headerlink" title="3ã€è§£å†³æ–¹æ³•äºŒ-CopyOnWriteArraySet"></a>3ã€è§£å†³æ–¹æ³•äºŒ-CopyOnWriteArraySet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        set.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€HashSetåº•å±‚"><a href="#4ã€HashSetåº•å±‚" class="headerlink" title="4ã€HashSetåº•å±‚"></a>4ã€HashSetåº•å±‚</h3><blockquote><p>HashSetçš„åº•å±‚æ˜¯HashMapï¼ŒHashSetçš„addæ–¹æ³•åº•å±‚è°ƒç”¨äº†HashMapçš„putæ–¹æ³•ï¼Œå…¶ä¸­æ·»åŠ çš„å…ƒç´ ä¸ºkeyï¼Œè€Œvalueå›ºå®šä¸ºä¸€ä¸ªObjectå¯¹è±¡PRESENT</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225155756.png" alt="image-20210225155755092"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225155841.png" alt="image-20210225155841728"></p><h2 id="4-4ã€HashMapçº¿ç¨‹ä¸å®‰å…¨"><a href="#4-4ã€HashMapçº¿ç¨‹ä¸å®‰å…¨" class="headerlink" title="4.4ã€HashMapçº¿ç¨‹ä¸å®‰å…¨"></a>4.4ã€HashMapçº¿ç¨‹ä¸å®‰å…¨</h2><h3 id="1ã€ä¸¾ä¾‹è¯´æ˜-1"><a href="#1ã€ä¸¾ä¾‹è¯´æ˜-1" class="headerlink" title="1ã€ä¸¾ä¾‹è¯´æ˜"></a>1ã€ä¸¾ä¾‹è¯´æ˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        map.put(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>),UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œç¨‹åºï¼Œå‘ç°åŒæ ·æŠ¥äº†java.util.ConcurrentModificationException å¼‚å¸¸ï¼Œè¯´æ˜HashMapä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„</p></blockquote><h3 id="2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»-1"><a href="#2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»-1" class="headerlink" title="2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»"></a>2ã€è§£å†³æ–¹æ³•ä¸€-ä½¿ç”¨Collectionså·¥å…·ç±»</h3><blockquote><p>ä½¿ç”¨Collections.synchronizedMapæ–¹æ³•å°†çº¿ç¨‹ä¸å®‰å…¨çš„HashMapåŒ…è£…ä¸ºçº¿ç¨‹å®‰å…¨çš„map</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        map.put(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>),UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€è§£å†³æ–¹æ³•äºŒ-ä½¿ç”¨ConcurrentHashMap"><a href="#3ã€è§£å†³æ–¹æ³•äºŒ-ä½¿ç”¨ConcurrentHashMap" class="headerlink" title="3ã€è§£å†³æ–¹æ³•äºŒ-ä½¿ç”¨ConcurrentHashMap"></a>3ã€è§£å†³æ–¹æ³•äºŒ-ä½¿ç”¨ConcurrentHashMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        map.put(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>),UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="äº”ã€Callable"><a href="#äº”ã€Callable" class="headerlink" title="äº”ã€Callable"></a>äº”ã€Callable</h1><h2 id="5-1ã€é¢è¯•é¢˜"><a href="#5-1ã€é¢è¯•é¢˜" class="headerlink" title="5.1ã€é¢è¯•é¢˜"></a>5.1ã€é¢è¯•é¢˜</h2><blockquote><p>è·å¾—å¤šçº¿ç¨‹çš„æ–¹æ³•æœ‰å‡ ç§ï¼Ÿ4ç§</p></blockquote><ul><li>ç»§æ‰¿Threadç±»</li><li>å®ç°Runnableæ¥å£</li></ul><blockquote><p>åœ¨JDK5ä¹‹åè¿˜æä¾›äº†å¦å¤–ä¸¤ç§æ–¹æ³•</p></blockquote><ul><li>å®ç°Callableæ¥å£</li><li>ä½¿ç”¨çº¿ç¨‹æ± è·å¾—</li></ul><h2 id="5-2ã€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-2ã€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5.2ã€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>5.2ã€æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote><p>Callableæ˜¯java.util.concurrentåŒ…ä¸‹çš„ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œå¯ä»¥ç”¨ä½œlambdaè¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨çš„èµ‹å€¼å¯¹è±¡ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225165926.png" alt="img"></p><h2 id="5-3ã€ä¸Runnableå¯¹æ¯”"><a href="#5-3ã€ä¸Runnableå¯¹æ¯”" class="headerlink" title="5.3ã€ä¸Runnableå¯¹æ¯”"></a>5.3ã€ä¸Runnableå¯¹æ¯”</h2><blockquote><p>Callable</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Runnable</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Runnableå’ŒCallableçš„åŒºåˆ«</p></blockquote><ul><li><p>æŠ½è±¡æ–¹æ³•æ˜¯å¦æœ‰è¿”å›å€¼</p><ul><li>Runnableæ²¡æœ‰ï¼ŒCallableæœ‰</li><li>Callableæ¥å£ä¸­æŠ½è±¡æ–¹æ³•çš„è¿”å›å€¼ç”±ä¼ å…¥çš„æ³›å‹å†³å®š</li></ul></li><li><p>æŠ½è±¡æ–¹æ³•æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</p><ul><li>Runnableæ²¡æœ‰ï¼ŒCallableæœ‰</li></ul></li><li><p>è½åœ°å®ç°æ–¹æ³•ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯runï¼Œä¸€ä¸ªæ˜¯call</p></li></ul><h2 id="5-4ã€æ€ä¹ˆä½¿ç”¨ï¼Ÿ"><a href="#5-4ã€æ€ä¹ˆä½¿ç”¨ï¼Ÿ" class="headerlink" title="5.4ã€æ€ä¹ˆä½¿ç”¨ï¼Ÿ"></a>5.4ã€æ€ä¹ˆä½¿ç”¨ï¼Ÿ</h2><h3 id="1ã€ç›´æ¥å°†Callableä¼ å…¥Threadçš„æ„é€ æ–¹æ³•å¯è¡Œå—ï¼Ÿ"><a href="#1ã€ç›´æ¥å°†Callableä¼ å…¥Threadçš„æ„é€ æ–¹æ³•å¯è¡Œå—ï¼Ÿ" class="headerlink" title="1ã€ç›´æ¥å°†Callableä¼ å…¥Threadçš„æ„é€ æ–¹æ³•å¯è¡Œå—ï¼Ÿ"></a>1ã€ç›´æ¥å°†Callableä¼ å…¥Threadçš„æ„é€ æ–¹æ³•å¯è¡Œå—ï¼Ÿ</h3><blockquote><p>ä¸å¯è¡Œï¼Œå› ä¸ºThreadç±»ä¸­æ²¡æœ‰ä¼ å…¥Callableæ¥å£å¯¹è±¡çš„æ„é€ å‡½æ•°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225174322.png" alt="img"></p><h3 id="2ã€FutureTask"><a href="#2ã€FutureTask" class="headerlink" title="2ã€FutureTask"></a>2ã€FutureTask</h3><ul><li>æ ¹æ®Javaçš„å¤šæ€ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»åŒæ—¶å’ŒCallableã€Runnableæœ‰è”ç³»</li></ul><blockquote><p>è€Œåœ¨Runnableå­æ¥å£çš„å®ç°ç±»ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªFutureTaskç±»ï¼Œè¿™ä¸ªç±»å³æ˜¯Runnableå­æ¥å£çš„å®ç°ç±»ï¼Œåˆå’ŒCallableæ¥å£æœ‰è”ç³»</p><p>FutureTaskçš„ç»§æ‰¿å®ç°å…³ç³»å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225174628.png" alt="image-20210225174628473"></p><blockquote><p>FutureTaskç±»ä¸­ä¸Callableæœ‰è”ç³»çš„æ„é€ æ–¹æ³•å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225174835.png" alt="image-20210225174835826"></p><h3 id="3ã€ä½¿ç”¨"><a href="#3ã€ä½¿ç”¨" class="headerlink" title="3ã€ä½¿ç”¨"></a>3ã€ä½¿ç”¨</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç°Callableæ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;********come in here&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;èŠœæ¹–&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨mainæ–¹æ³•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªFutureTaskå¯¹è±¡ï¼Œåœ¨FutureTaskçš„æ„é€ æ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªMyCallableå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FutureTask futureTask = <span class="keyword">new</span> FutureTask&lt;&gt;(<span class="keyword">new</span> MyCallable());</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨Threadçš„æ„é€ å‡½æ•°ä¸­ä¼ å…¥ä¸Šä¸€æ­¥åˆ›å»ºçš„FutureTaskå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(futureTask,<span class="string">&quot;A&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨FutureTaskå¯¹è±¡çš„get()æ–¹æ³•å¯ä»¥è·å¾—call()æ–¹æ³•çš„è¿”å›å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(futureTask.get());</span><br></pre></td></tr></table></figure><blockquote><p>å…¨éƒ¨ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FutureTask futureTask = <span class="keyword">new</span> FutureTask&lt;&gt;(<span class="keyword">new</span> MyCallable());</span><br><span class="line"><span class="keyword">new</span> Thread(futureTask,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">System.out.println(futureTask.get());</span><br></pre></td></tr></table></figure><blockquote><p>æ‰§è¡Œç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225181443.png" alt="image-20210225181442658"></p><h2 id="5-5ã€FutureTask"><a href="#5-5ã€FutureTask" class="headerlink" title="5.5ã€FutureTask"></a>5.5ã€FutureTask</h2><h3 id="1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote><p>FutureTaskä¹Ÿå³æœªæ¥çš„ä»»åŠ¡ï¼Œç”¨å®ƒå°±å¹²ä¸€ä»¶äº‹ï¼Œ<strong>å¼‚æ­¥è°ƒç”¨</strong></p><p>mainæ–¹æ³•å°±åƒä¸€ä¸ªå†°ç³–è‘«èŠ¦ï¼Œä¸€ä¸ªä¸ªæ–¹æ³•ç”±mainä¸²èµ·æ¥ã€‚</p><p>ä½†è§£å†³ä¸äº†ä¸€ä¸ªé—®é¢˜ï¼šæ­£å¸¸è°ƒç”¨æŒ‚èµ·å µå¡é—®é¢˜</p><p>åœ¨ä¸»çº¿ç¨‹ä¸­éœ€è¦æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ—¶ï¼Œä½†åˆä¸æƒ³é˜»å¡ä¸»çº¿ç¨‹æ—¶ï¼Œå¯ä»¥æŠŠè¿™äº›ä½œä¸šäº¤ç»™FutureTaskå¯¹è±¡åœ¨åå°å®Œæˆï¼Œ</p><p>å½“ä¸»çº¿ç¨‹å°†æ¥éœ€è¦æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡FutureTaskå¯¹è±¡è·å¾—åå°ä½œä¸šçš„è®¡ç®—ç»“æœæˆ–è€…æ‰§è¡ŒçŠ¶æ€ã€‚</p><p>ä¸€èˆ¬FutureTaskå¤šç”¨äºè€—æ—¶çš„è®¡ç®—ï¼Œä¸»çº¿ç¨‹å¯ä»¥åœ¨å®Œæˆè‡ªå·±çš„ä»»åŠ¡åï¼Œå†å»è·å–ç»“æœã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225205225.png" alt="img"></p><blockquote><p>ä¸¾ä¾‹è¯´æ˜</p></blockquote><ul><li>è€å¸ˆä¸Šç€è¯¾ï¼Œå£æ¸´äº†ï¼Œå»ä¹°æ°´ä¸åˆé€‚ï¼Œè®²è¯¾çº¿ç¨‹ç»§ç»­ï¼Œæˆ‘å¯ä»¥å•èµ·ä¸ªçº¿ç¨‹æ‰¾ç­é•¿å¸®å¿™ä¹°æ°´ï¼Œæ°´ä¹°å›æ¥äº†æ”¾æ¡Œä¸Šï¼Œæˆ‘éœ€è¦çš„æ—¶å€™å†å»getã€‚</li><li>4ä¸ªåŒå­¦ï¼ŒAç®—1+20,Bç®—21+30,Cç®—31*åˆ°40,Dç®—41+50ï¼Œæ˜¯ä¸æ˜¯Cçš„è®¡ç®—é‡æœ‰ç‚¹å¤§å•Šï¼ŒFutureTaskå•èµ·ä¸ªçº¿ç¨‹ç»™Cè®¡ç®—ï¼Œæˆ‘å…ˆæ±‡æ€»ABDï¼Œæœ€åç­‰Cè®¡ç®—å®Œäº†å†æ±‡æ€»Cï¼Œæ‹¿åˆ°æœ€ç»ˆç»“æœ</li></ul><blockquote><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆCallableçš„callæ–¹æ³•éœ€è¦æœ‰è¿”å›å€¼çš„åŸå› ï¼Œå› ä¸ºç¨‹åºæœ€ç»ˆçš„æ‰§è¡Œç»“æœæ˜¯<strong>mainçº¿ç¨‹æ‰§è¡Œç»“æœ</strong> + FutureTaskçº¿ç¨‹æ‰§è¡Œç»“æœã€‚</p></blockquote><h3 id="2ã€Callableç»†èŠ‚ä¸€"><a href="#2ã€Callableç»†èŠ‚ä¸€" class="headerlink" title="2ã€Callableç»†èŠ‚ä¸€"></a>2ã€Callableç»†èŠ‚ä¸€</h3><blockquote><p>FutureTaskå¯¹è±¡çš„getæ–¹æ³•ä¸€èˆ¬æ”¾åœ¨æœ€åä¸€è¡Œã€‚</p><p><strong>ä»…åœ¨è®¡ç®—å®Œæˆæ—¶æ‰èƒ½æ£€ç´¢ç»“æœ</strong>ï¼›<strong>å¦‚æœè®¡ç®—å°šæœªå®Œæˆï¼Œåˆ™é˜»å¡ get æ–¹æ³•ã€‚</strong>ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å†é‡æ–°å¼€å§‹æˆ–å–æ¶ˆè®¡ç®—ã€‚<strong>getæ–¹æ³•è€Œè·å–ç»“æœåªæœ‰åœ¨è®¡ç®—å®Œæˆæ—¶è·å–ï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡è½¬å…¥å®ŒæˆçŠ¶æ€ï¼Œ</strong>ç„¶åä¼šè¿”å›ç»“æœæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚ </p></blockquote><h3 id="3ã€Callableç»†èŠ‚äºŒ"><a href="#3ã€Callableç»†èŠ‚äºŒ" class="headerlink" title="3ã€Callableç»†èŠ‚äºŒ"></a>3ã€Callableç»†èŠ‚äºŒ</h3><blockquote><p>å¯¹äºåŒä¸€ä¸ªFutureTaskå¯¹è±¡ï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªçº¿ç¨‹è°ƒç”¨ï¼Œæœ€ç»ˆFutureTaskå¯¹è±¡ä¸­çš„<strong>callæ–¹æ³•æ‰§è¡Œè¢«æ‰§è¡Œä¸€æ¬¡ã€‚</strong></p></blockquote><ul><li>MyCallable</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;********come in here&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨mainæ–¹æ³•ä¸­åˆ›å»ºä¸‰ä¸ªçº¿ç¨‹ï¼Œä¼ å…¥åŒä¸€ä¸ªFutureTaskå¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    FutureTask futureTask = <span class="keyword">new</span> FutureTask&lt;&gt;(<span class="keyword">new</span> MyCallable());</span><br><span class="line">    <span class="keyword">new</span> Thread(futureTask,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(futureTask,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(futureTask,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è®¡ç®—å®Œæˆï¼&quot;</span>);</span><br><span class="line">    System.out.println(futureTask.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225213137.png" alt="image-20210225213136697"></p><h1 id="å…­ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»"><a href="#å…­ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»" class="headerlink" title="å…­ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»"></a>å…­ã€JUCå¼ºå¤§çš„è¾…åŠ©ç±»</h1><h2 id="6-1ã€CountDownLatch-å‡å°‘è®¡æ•°ï¼ˆäººèµ°å®Œå†å…³é—¨ï¼‰"><a href="#6-1ã€CountDownLatch-å‡å°‘è®¡æ•°ï¼ˆäººèµ°å®Œå†å…³é—¨ï¼‰" class="headerlink" title="6.1ã€CountDownLatch-å‡å°‘è®¡æ•°ï¼ˆäººèµ°å®Œå†å…³é—¨ï¼‰"></a>6.1ã€CountDownLatch-å‡å°‘è®¡æ•°ï¼ˆäººèµ°å®Œå†å…³é—¨ï¼‰</h2><h3 id="1ã€åŸç†"><a href="#1ã€åŸç†" class="headerlink" title="1ã€åŸç†"></a>1ã€åŸç†</h3><ul><li>CountDownLatchä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šé˜»å¡ã€‚</li><li>å…¶å®ƒçº¿ç¨‹è°ƒç”¨countDownæ–¹æ³•ä¼šå°†è®¡æ•°å™¨å‡1(è°ƒç”¨countDownæ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡)</li><li>å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º0æ—¶ï¼Œå› awaitæ–¹æ³•é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚</li></ul><h3 id="2ã€ä¸¾ä¾‹è¯´æ˜"><a href="#2ã€ä¸¾ä¾‹è¯´æ˜" class="headerlink" title="2ã€ä¸¾ä¾‹è¯´æ˜"></a>2ã€ä¸¾ä¾‹è¯´æ˜</h3><blockquote><p>æ¨¡æ‹Ÿå…­ä¸ªåŒå­¦å’Œä¸€ä¸ªç­é•¿åœ¨æ•™å®¤é‡Œå­¦ä¹ ï¼Œç­é•¿å¿…é¡»ç­‰åˆ°åŒå­¦ä»¬å…¨éƒ¨èµ°äººä¹‹åæ‰å¯ä»¥èµ°äºº</p></blockquote><ul><li>æ²¡æœ‰ç”¨CountDownLatchä¹‹å‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tç¦»å¼€æ•™å®¤ï¼&quot;</span>),String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tç­é•¿å…³ç¯èµ°äºº&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>è¿è¡Œç¨‹åºï¼Œå‘ç°ç­é•¿æ²¡æœ‰ç­‰ç­é‡Œçš„äººèµ°å®Œå°±é”é—¨äº†</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225225726.png" alt="image-20210225225725538"></p><blockquote><p>å¼•å…¥CountDownLatch</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªCountDownLatchå¯¹è±¡ï¼Œç”±äºç­çº§ä¸­é™¤ç­é•¿å¤–æœ‰å…­äººï¼Œæ‰€ä»¥è®¡æ•°å™¨è®¾ç½®ä¸º6</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CountDownLatch downLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br></pre></td></tr></table></figure><ul><li>å¼€è¾Ÿå…­ä¸ªçº¿ç¨‹ï¼Œæ¯èµ°ä¸€ä¸ªåŒå­¦ï¼ˆçº¿ç¨‹æ¯æ‰§è¡Œä¸€ä¸ªï¼‰ï¼Œå°±è°ƒç”¨CountDownLatchå¯¹è±¡çš„countDownæ–¹æ³•ä½¿è®¡æ•°å™¨ - 1</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tç¦»å¼€æ•™å®¤ï¼&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¯èµ°ä¸€ä¸ªåŒå­¦ï¼Œå°±è®©è®¡æ•°å™¨å¯¹è±¡ - 1</span></span><br><span class="line">        downLatch.countDown();</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨è®¡æ•°å™¨å€¼ä¸ä¸º0ä¹‹å‰ï¼ˆæ‰€æœ‰åŒå­¦æ²¡æœ‰èµ°å®Œä¹‹å‰ï¼‰ï¼Œè°ƒç”¨CountDownLatchå¯¹è±¡çš„awaitæ–¹æ³•ä»¤ä¸»çº¿ç¨‹ï¼ˆç­é•¿ï¼‰è¢«é˜»å¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨æ‰€æœ‰åŒå­¦èµ°äººä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è®¡æ•°å™¨æ²¡æœ‰ä¸º0ä¹‹å‰</span></span><br><span class="line"><span class="comment">//ä¸»çº¿ç¨‹ï¼ˆç­é•¿çº¿ç¨‹ï¼‰å¿…é¡»await</span></span><br><span class="line"><span class="comment">//å¿…é¡»ç­‰åˆ°è®¡æ•°å™¨ç”±6å˜ä¸º0ï¼Œä¸»çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­è¿è¡Œ</span></span><br><span class="line">downLatch.await();</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tç­é•¿å…³ç¯èµ°äºº&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>å®Œæ•´ä»£ç å¦‚ä¸‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CountDownLatch downLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tç¦»å¼€æ•™å®¤ï¼&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¯èµ°ä¸€ä¸ªåŒå­¦ï¼Œå°±è®©è®¡æ•°å™¨å¯¹è±¡ - 1</span></span><br><span class="line">        downLatch.countDown();</span><br><span class="line">    &#125;,String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åœ¨æ‰€æœ‰åŒå­¦èµ°äººä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è®¡æ•°å™¨æ²¡æœ‰ä¸º0ä¹‹å‰</span></span><br><span class="line"><span class="comment">//ä¸»çº¿ç¨‹ï¼ˆç­é•¿çº¿ç¨‹ï¼‰å¿…é¡»await</span></span><br><span class="line"><span class="comment">//å¿…é¡»ç­‰åˆ°è®¡æ•°å™¨ç”±6å˜ä¸º0ï¼Œä¸»çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­è¿è¡Œ</span></span><br><span class="line">downLatch.await();</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tç­é•¿å…³ç¯èµ°äºº&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225230737.png" alt="image-20210225230737673"></p><h2 id="6-2ã€CyclicBarrier-å¾ªç¯æ …æ ï¼ˆäººåˆ°é½å†å¼€ä¼šï¼‰"><a href="#6-2ã€CyclicBarrier-å¾ªç¯æ …æ ï¼ˆäººåˆ°é½å†å¼€ä¼šï¼‰" class="headerlink" title="6.2ã€CyclicBarrier-å¾ªç¯æ …æ ï¼ˆäººåˆ°é½å†å¼€ä¼šï¼‰"></a>6.2ã€CyclicBarrier-å¾ªç¯æ …æ ï¼ˆäººåˆ°é½å†å¼€ä¼šï¼‰</h2><h3 id="1ã€åŸç†-1"><a href="#1ã€åŸç†-1" class="headerlink" title="1ã€åŸç†"></a>1ã€åŸç†</h3><blockquote><p>CyclicBarrierçš„å­—é¢æ„æ€æ˜¯å¯å¾ªç¯ï¼ˆCyclicï¼‰ä½¿ç”¨çš„å±éšœï¼ˆBarrierï¼‰ã€‚å®ƒè¦åšçš„äº‹æƒ…æ˜¯ï¼Œè®©ä¸€ç»„çº¿ç¨‹åˆ°è¾¾ä¸€ä¸ªå±éšœï¼ˆä¹Ÿå¯ä»¥å«åŒæ­¥ç‚¹ï¼‰æ—¶è¢«é˜»å¡ï¼Œç›´åˆ°æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾å±éšœæ—¶ï¼Œå±éšœæ‰ä¼šå¼€é—¨ï¼Œæ‰€æœ‰è¢«å±éšœæ‹¦æˆªçš„çº¿ç¨‹æ‰ä¼šç»§ç»­å¹²æ´»ã€‚çº¿ç¨‹è¿›å…¥å±éšœé€šè¿‡CyclicBarrierçš„await()æ–¹æ³•ã€‚</p><p>æœ‰ç‚¹ç±»ä¼¼åˆºå®¢ä¿¡æ¡å¤§é©å‘½å¤šäººä»»åŠ¡ä¸­ï¼Œå®ŒæˆæŒ‘æˆ˜åéœ€è¦æ‰€æœ‰çš„åˆºå®¢åˆ°è¾¾é€ƒè„±ç‚¹åå¤šäººä»»åŠ¡æ‰ç®—å®Œæˆ</p></blockquote><h3 id="2ã€ä¸¾ä¾‹è¯´æ˜-1"><a href="#2ã€ä¸¾ä¾‹è¯´æ˜-1" class="headerlink" title="2ã€ä¸¾ä¾‹è¯´æ˜"></a>2ã€ä¸¾ä¾‹è¯´æ˜</h3><ul><li>åˆ›å»ºä¸€ä¸ªCyclicBarrierå¯¹è±¡ï¼Œéœ€è¦ä¼ å…¥è¦æ±‚çš„çº¿ç¨‹æ•°å’Œä¸€ä¸ªRunnableå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å®šä¹‰äº†æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾åè¦æ‰§è¡Œçš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CyclicBarrier cyclicBarrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">4</span>, () -&gt; System.out.println(<span class="string">&quot;è®°å¿†åŒæ­¥å®Œæˆ.&quot;</span>));</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º4ä¸ªçº¿ç¨‹ï¼Œåœ¨runæ–¹æ³•ä¸­ä½¿ç”¨CyclicBarrierå¯¹è±¡çš„awaitæ–¹æ³•ä½¿å½“å‰çº¿ç¨‹ç­‰å¾…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">4</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tåˆ°è¾¾é€ƒè„±åœ°ç‚¹&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            cyclicBarrier.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;äºšè¯º&quot;</span> + i).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225232216.png" alt="image-20210225232216225"></p><ul><li>å°†forå¾ªç¯ä¸­çš„4æ”¹ä¸º3ï¼Œè¿è¡ŒæŸ¥çœ‹ç»“æœ</li></ul><blockquote><p>æ­¤æ—¶ä¸æ‰§è¡ŒCyclicBarrieræ„é€ å‡½æ•°ä¸­ï¼Œæ‰€æœ‰çº¿ç¨‹å®Œå…¨é€šè¿‡åæ‰§è¡Œçš„æ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225232255.png" alt="image-20210225232255021"></p><h2 id="6-3ã€Semaphore-ä¿¡å·ç¯"><a href="#6-3ã€Semaphore-ä¿¡å·ç¯" class="headerlink" title="6.3ã€Semaphore-ä¿¡å·ç¯"></a>6.3ã€Semaphore-ä¿¡å·ç¯</h2><h3 id="1ã€åŸç†-2"><a href="#1ã€åŸç†-2" class="headerlink" title="1ã€åŸç†"></a>1ã€åŸç†</h3><blockquote><p>åœ¨ä¿¡å·é‡ä¸Šæˆ‘ä»¬å®šä¹‰ä¸¤ç§æ“ä½œï¼š</p></blockquote><ul><li>acquireï¼ˆè·å–ï¼‰ å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨acquireæ“ä½œæ—¶ï¼Œå®ƒè¦ä¹ˆé€šè¿‡æˆåŠŸè·å–ä¿¡å·é‡ï¼ˆä¿¡å·é‡å‡1ï¼‰ï¼Œè¦ä¹ˆä¸€ç›´ç­‰ä¸‹å»ï¼Œç›´åˆ°æœ‰çº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è¶…æ—¶ã€‚</li><li>releaseï¼ˆé‡Šæ”¾ï¼‰å®é™…ä¸Šä¼šå°†ä¿¡å·é‡çš„å€¼åŠ 1ï¼Œç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</li></ul><blockquote><p>ä¿¡å·é‡ä¸»è¦ç”¨äºä¸¤ä¸ªç›®çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¤šä¸ªå…±äº«èµ„æºçš„äº’æ–¥ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªç”¨äºå¹¶å‘çº¿ç¨‹æ•°çš„æ§åˆ¶ã€‚</p></blockquote><h3 id="2ã€ä¸¾ä¾‹è¯´æ˜-2"><a href="#2ã€ä¸¾ä¾‹è¯´æ˜-2" class="headerlink" title="2ã€ä¸¾ä¾‹è¯´æ˜"></a>2ã€ä¸¾ä¾‹è¯´æ˜</h3><blockquote><p>å‡è®¾ç°åœ¨æœ‰ä¸‰ä¸ªèµ„æºï¼ˆç©ºè½¦ä½ï¼‰ï¼Œä¾›å…­ä¸ªçº¿ç¨‹ï¼ˆè½¦ï¼‰äº‰æŠ¢</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªSemaphoreå¯¹è±¡ï¼Œæ„é€ æ–¹æ³•éœ€è¦ä¼ å…¥èµ„æºæ•°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºå…­ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå®Œæ–¹æ³•ï¼ˆå å®Œè½¦ä½ï¼‰åï¼Œéœ€è¦å°†Semaphoreå¯¹è±¡ä¸­çš„èµ„æºæ•° -1 </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            semaphore.acquire();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tæŠ¢åˆ°äº†è½¦ä½ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;è½¦&quot;</span> + i).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨sleepæ–¹æ³•æ¨¡æ‹Ÿçº¿ç¨‹å ç”¨èµ„æºï¼Œå‡è®¾æ¯ä¸ªçº¿ç¨‹éƒ½å ç”¨3ç§’</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠ¢åˆ°èµ„æºåå ç”¨ä¸‰ç§’é’Ÿï¼Œä½¿ç”¨sleepè¿›è¡Œæ¨¡æ‹Ÿ</span></span><br><span class="line">TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br></pre></td></tr></table></figure><ul><li>åœ¨å ç”¨å®Œèµ„æºä¹‹åï¼Œéœ€è¦é‡Šæ”¾èµ„æºï¼Œæ­¤æ—¶è°ƒç”¨Semaphoreå¯¹è±¡çš„releaseæ–¹æ³•ï¼Œåœ¨finallyå—ä¸­è°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å ç”¨èµ„æºåä»¤èµ„æºæ•°-1</span></span><br><span class="line">            semaphore.acquire();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tæŠ¢åˆ°äº†è½¦ä½ï¼&quot;</span>);</span><br><span class="line">            <span class="comment">//æŠ¢åˆ°èµ„æºåå ç”¨ä¸‰ç§’é’Ÿï¼Œä½¿ç”¨sleepè¿›è¡Œæ¨¡æ‹Ÿ</span></span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\tç¦»å¼€äº†ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾èµ„æºåè®©èµ„æºæ•°+1</span></span><br><span class="line">            semaphore.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;è½¦&quot;</span> + i).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210225235029.png" alt="image-20210225235028385"></p><blockquote><p>å½“è®¾ç½®èµ„æºæ•°ä¸º1æ—¶ï¼Œç›¸å½“äºsynchronized.</p><p>ä¾‹å¦‚ï¼šè¦æ±‚å¤šçº¿ç¨‹æŠ¢ä¸€ä¸ªèµ„æºï¼Œä½†åªèƒ½å æœ‰è¿™ä¸ªèµ„æº20sï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨Semaphoreå®Œæˆã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰-å…¥é—¨ä»‹ç»ã€Lockæ¥å£åŠçº¿ç¨‹é—´é€šä¿¡</title>
      <link href="posts/2523931385.html"/>
      <url>posts/2523931385.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€JUCå…¥é—¨ä»‹ç»"><a href="#ä¸€ã€JUCå…¥é—¨ä»‹ç»" class="headerlink" title="ä¸€ã€JUCå…¥é—¨ä»‹ç»"></a>ä¸€ã€JUCå…¥é—¨ä»‹ç»</h1><blockquote><p>JUCå³ <strong>java.util.concurrent</strong></p><p>æ¶‰åŠä¸‰ä¸ªåŒ…ï¼š</p><ul><li>java.util.concurrent</li><li>java.util.concurrent.atomic</li><li>java.util.concurrent.locks</li></ul></blockquote><h2 id="1-1ã€è¿›ç¨‹-çº¿ç¨‹"><a href="#1-1ã€è¿›ç¨‹-çº¿ç¨‹" class="headerlink" title="1.1ã€è¿›ç¨‹/çº¿ç¨‹"></a>1.1ã€è¿›ç¨‹/çº¿ç¨‹</h2><h3 id="1ã€è¿›ç¨‹"><a href="#1ã€è¿›ç¨‹" class="headerlink" title="1ã€è¿›ç¨‹"></a>1ã€è¿›ç¨‹</h3><blockquote><p>ä¸€ä¸ªåœ¨å†…å­˜ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ä¸€å—å†…å­˜ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ¯”å¦‚åœ¨Windowsç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªè¿è¡Œçš„xx.exeå°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚</p></blockquote><h3 id="2ã€çº¿ç¨‹"><a href="#2ã€çº¿ç¨‹" class="headerlink" title="2ã€çº¿ç¨‹"></a>2ã€çº¿ç¨‹</h3><blockquote><p>è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ‰§è¡Œä»»åŠ¡ï¼ˆæ§åˆ¶å•å…ƒï¼‰ï¼Œè´Ÿè´£å½“å‰è¿›ç¨‹ä¸­ç¨‹åºçš„æ‰§è¡Œã€‚ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯å…±äº«æ•°æ®ã€‚</p><p>ä¸è¿›ç¨‹ä¸åŒçš„æ˜¯åŒç±»çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„<strong>å †</strong>å’Œ<strong>æ–¹æ³•åŒº</strong>èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„<strong>ç¨‹åºè®¡æ•°å™¨</strong>ã€<strong>è™šæ‹Ÿæœºæ ˆ</strong>å’Œ<strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼Œæ‰€ä»¥ç³»ç»Ÿåœ¨äº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ–æ˜¯åœ¨å„ä¸ªçº¿ç¨‹ä¹‹é—´ä½œåˆ‡æ¢å·¥ä½œæ—¶ï¼Œè´Ÿæ‹…è¦æ¯”è¿›ç¨‹å°å¾—å¤šï¼Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œçº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»é‡çº§è¿›ç¨‹ã€‚</p></blockquote><h3 id="3ã€ä¸¾ä¾‹"><a href="#3ã€ä¸¾ä¾‹" class="headerlink" title="3ã€ä¸¾ä¾‹"></a>3ã€ä¸¾ä¾‹</h3><blockquote><p>ä½¿ç”¨QQï¼ŒæŸ¥çœ‹è¿›ç¨‹ä¸€å®šæœ‰ä¸€ä¸ªQQ.exeçš„è¿›ç¨‹ï¼Œæˆ‘å¯ä»¥ç”¨qqå’ŒAæ–‡å­—èŠå¤©ï¼Œå’ŒBè§†é¢‘èŠå¤©ï¼Œç»™Cä¼ æ–‡ä»¶ï¼Œç»™Då‘ä¸€æ®µè¯­è¨€ï¼ŒQQæ”¯æŒå½•å…¥ä¿¡æ¯çš„æœç´¢ã€‚</p><p>å¤§å››çš„æ—¶å€™å†™è®ºæ–‡ï¼Œç”¨wordå†™è®ºæ–‡ï¼ŒåŒæ—¶ç”¨QQéŸ³ä¹æ”¾éŸ³ä¹ï¼ŒåŒæ—¶ç”¨QQèŠå¤©ï¼Œå¤šä¸ªè¿›ç¨‹ã€‚</p><p>wordå¦‚æ²¡æœ‰ä¿å­˜ï¼Œåœç”µå…³æœºï¼Œå†é€šç”µåæ‰“å¼€wordå¯ä»¥æ¢å¤ä¹‹å‰æœªä¿å­˜çš„æ–‡æ¡£ï¼Œwordä¹Ÿä¼šæ£€æŸ¥ä½ çš„æ‹¼å†™ï¼Œä¸¤ä¸ªçº¿ç¨‹ï¼šå®¹ç¾å¤‡ä»½ï¼Œè¯­æ³•æ£€æŸ¥</p></blockquote><h3 id="4ã€wait-sleep"><a href="#4ã€wait-sleep" class="headerlink" title="4ã€wait/sleep"></a>4ã€wait/sleep</h3><blockquote><p>åŠŸèƒ½éƒ½æ˜¯å½“å‰çº¿ç¨‹æš‚åœï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p></blockquote><ul><li>waitæ”¾å¼€æ‰‹å»ç¡ï¼Œæ”¾å¼€æ‰‹é‡Œçš„é”</li><li>sleepæ¡ç´§æ‰‹å»ç¡ï¼Œé†’äº†æ‰‹é‡Œè¿˜æœ‰é”</li></ul><h2 id="1-2ã€å¹¶å‘-å¹¶è¡Œ"><a href="#1-2ã€å¹¶å‘-å¹¶è¡Œ" class="headerlink" title="1.2ã€å¹¶å‘/å¹¶è¡Œ"></a>1.2ã€å¹¶å‘/å¹¶è¡Œ</h2><h3 id="1ã€å¹¶å‘"><a href="#1ã€å¹¶å‘" class="headerlink" title="1ã€å¹¶å‘"></a>1ã€å¹¶å‘</h3><blockquote><p><strong>å¹¶å‘ï¼šå¤šä¸ªçº¿ç¨‹ä»»åŠ¡é€šè¿‡ä¸€ä¸ªcpuæ‰§è¡Œï¼Œæ‰€ä»¥è¿™äº›çº¿ç¨‹ä»»åŠ¡åªèƒ½é€šè¿‡åˆ‡æ¢æ‰§è¡Œæ¥å®ç°å¹¶å‘ï¼Œåªä¸è¿‡è¿™äº›çº¿ç¨‹åˆ‡æ¢çš„é€Ÿåº¦å¾ˆå¿«ï¼Œå®è§‚ä¸Šçœ‹ä¼¼ä¹å°±æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œå…¶å®è¿˜æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œçš„ï¼Œåªä¸è¿‡å¯ä»¥åˆ‡æ¢æ‰§è¡Œã€‚</strong></p></blockquote><h3 id="2ã€å¹¶è¡Œ"><a href="#2ã€å¹¶è¡Œ" class="headerlink" title="2ã€å¹¶è¡Œ"></a>2ã€å¹¶è¡Œ</h3><blockquote><p><strong>å¹¶è¡Œï¼šå¤šä¸ªçº¿ç¨‹ä»»åŠ¡é€šè¿‡å¤šä¸ªcpuæ‰§è¡Œï¼ŒçœŸæ­£æ„ä¹‰ä¸Šçš„åŒæ—¶æ‰§è¡Œã€‚å› ä¸ºæœ‰å¤šä¸ªcpuï¼Œä¸€ä¸ªcpuæ‰§è¡Œä¸€ä¸ªä»»åŠ¡å°±å¥½äº†ã€‚</strong></p></blockquote><h2 id="1-3ã€SaleTicket"><a href="#1-3ã€SaleTicket" class="headerlink" title="1.3ã€SaleTicket"></a>1.3ã€SaleTicket</h2><blockquote><p>ä¸‰ä¸ªå”®ç¥¨å‘˜å–å‡ºä¸‰åå¼ ç¥¨</p><p>å¤šçº¿ç¨‹ç¼–ç¨‹å›ºå®šå¥—è·¯ï¼šçº¿ç¨‹  + æ“ä½œ + èµ„æºç±»</p></blockquote><h3 id="1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»Ticket"><a href="#1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»Ticket" class="headerlink" title="1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»Ticket"></a>1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»Ticket</h3><blockquote><p>èµ„æºç±» = å®ä¾‹å˜é‡ + å®ä¾‹æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åŠ é”åœ¨tryå¤–åŠ </span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(number &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;å–å‡ºç¬¬&quot;</span> + (number--) + <span class="string">&quot;\t è¿˜å‰©ä¸‹&quot;</span> + number + <span class="string">&quot;å¼ ç¥¨&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//åŠ å®Œé”åä¸€å®šè¦é‡Šæ”¾</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºä¸€ä¸ªSaleTicketæ–¹æ³•ï¼Œåˆ›å»ºä¸‰ä¸ªçº¿ç¨‹åå¼€å§‹ä¹°ç¥¨"><a href="#2ã€åˆ›å»ºä¸€ä¸ªSaleTicketæ–¹æ³•ï¼Œåˆ›å»ºä¸‰ä¸ªçº¿ç¨‹åå¼€å§‹ä¹°ç¥¨" class="headerlink" title="2ã€åˆ›å»ºä¸€ä¸ªSaleTicketæ–¹æ³•ï¼Œåˆ›å»ºä¸‰ä¸ªçº¿ç¨‹åå¼€å§‹ä¹°ç¥¨"></a>2ã€åˆ›å»ºä¸€ä¸ªSaleTicketæ–¹æ³•ï¼Œåˆ›å»ºä¸‰ä¸ªçº¿ç¨‹åå¼€å§‹ä¹°ç¥¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaleTicket</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket ticket = <span class="keyword">new</span> Ticket();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222214716.png" alt="image-20210222214713300"></p><h3 id="3ã€ä¼˜åŒ–ä¸Šè¿°ä»£ç "><a href="#3ã€ä¼˜åŒ–ä¸Šè¿°ä»£ç " class="headerlink" title="3ã€ä¼˜åŒ–ä¸Šè¿°ä»£ç "></a>3ã€ä¼˜åŒ–ä¸Šè¿°ä»£ç </h3><blockquote><p>ä½¿ç”¨Î»è¡¨è¾¾å¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaleTicket</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Ticket ticket = <span class="keyword">new</span> Ticket();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">                ticket.sale();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-4ã€é”"><a href="#1-4ã€é”" class="headerlink" title="1.4ã€é”"></a>1.4ã€é”</h2><h3 id="1ã€é”æ¦‚è¿°"><a href="#1ã€é”æ¦‚è¿°" class="headerlink" title="1ã€é”æ¦‚è¿°"></a>1ã€é”æ¦‚è¿°</h3><blockquote><p>â€‹    çº¿ç¨‹å®‰å…¨é—®é¢˜çš„äº§ç”Ÿå‰æï¼š<strong>å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«æ•°æ®ã€‚</strong></p><p>â€‹    å°†å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«æ•°æ®çš„å¹¶å‘è®¿é—®è½¬æ¢ä¸ºä¸²è¡Œè®¿é—®ï¼Œå³ä¸€ä¸ªå…±äº«æ•°æ®ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®.</p><p>â€‹    é”å¯ä»¥ç†è§£ä¸ºå¯¹å…±äº«æ•°æ®è¿›è¡Œä¿æŠ¤çš„ä¸€ä¸ªè®¸å¯è¯ï¼Œå¯¹äºåŒä¸€ä¸ªè®¸å¯è¯ä¿æŠ¤çš„å…±äº«æ•°æ®æ¥è¯´ï¼Œä»»ä½•çº¿ç¨‹æƒ³è¦è®¿é—®è¿™äº›å…±äº«æ•°æ®å¿…é¡»å…ˆæŒæœ‰è¯¥è®¸å¯è¯ã€‚ä¸€ä¸ªçº¿ç¨‹åªæœ‰åœ¨æŒæœ‰è®¸å¯è¯çš„æƒ…å†µä¸‹æ‰èƒ½å¯¹è¿™äº›å…±äº«æ•°æ®è¿›è¡Œè®¿é—®ã€‚å¹¶ä¸”ä¸€ä¸ªè®¸å¯è¯ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</p><p>â€‹    é”å…·æœ‰<strong>æ’ä»–æ€§</strong>ï¼Œå³ä¸€ä¸ªé”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰</p></blockquote><h3 id="2ã€é”çš„ä½œç”¨"><a href="#2ã€é”çš„ä½œç”¨" class="headerlink" title="2ã€é”çš„ä½œç”¨"></a>2ã€é”çš„ä½œç”¨</h3><blockquote><p>é”å¯ä»¥å®ç°å¯¹å…±äº«æ•°æ®çš„<strong>å®‰å…¨è®¿é—®</strong></p><p>ä¿éšœçº¿ç¨‹çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§</p></blockquote><h3 id="3ã€æ³¨æ„"><a href="#3ã€æ³¨æ„" class="headerlink" title="3ã€æ³¨æ„"></a>3ã€æ³¨æ„</h3><blockquote><p>ä½¿ç”¨é”ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p></blockquote><ul><li>è¿™äº›çº¿ç¨‹åœ¨è®¿é—®å…±äº«æ•°æ®æ—¶å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ªé”</li><li>å³ä½¿æ˜¯è¯»å–å…±äº«æ•°æ®çš„çº¿ç¨‹ä¹Ÿéœ€è¦ä½¿ç”¨åŒæ­¥é”</li></ul><h2 id="1-5ã€é”çš„ç›¸å…³æ¦‚å¿µ"><a href="#1-5ã€é”çš„ç›¸å…³æ¦‚å¿µ" class="headerlink" title="1.5ã€é”çš„ç›¸å…³æ¦‚å¿µ"></a>1.5ã€é”çš„ç›¸å…³æ¦‚å¿µ</h2><h3 id="1ã€å¯é‡å…¥æ€§-Reentrancy"><a href="#1ã€å¯é‡å…¥æ€§-Reentrancy" class="headerlink" title="1ã€å¯é‡å…¥æ€§(Reentrancy)"></a>1ã€å¯é‡å…¥æ€§(Reentrancy)</h3><blockquote><p>â€‹    å¯é‡å…¥æ€§(Reentrancy)æè¿°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯¥é”çš„æ—¶å€™èƒ½å¦å†æ¬¡ï¼ˆå¤šæ¬¡ï¼‰ç”³è¯·è¯¥é”</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210302203820.png" alt="image-20210302203817738"></p><blockquote><p>â€‹        å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰ä¸€ä¸ªé”çš„æ—¶å€™è¿˜èƒ½æˆåŠŸç”³è¯·è¯¥æ‰€ï¼Œç§°è¯¥é”ä¸ºå¯é‡å…¥é”ï¼Œå¦åˆ™ç§°è¯¥é”ä¸ºä¸å¯é‡å…¥é”</p></blockquote><h3 id="2ã€é”çš„äº‰ç”¨å’Œè°ƒåº¦"><a href="#2ã€é”çš„äº‰ç”¨å’Œè°ƒåº¦" class="headerlink" title="2ã€é”çš„äº‰ç”¨å’Œè°ƒåº¦"></a>2ã€é”çš„äº‰ç”¨å’Œè°ƒåº¦</h3><blockquote><p>â€‹        Javaå¹³å°ä¸­<strong>å†…éƒ¨é”ï¼ˆsynchronizedï¼‰</strong>å±äº<strong>éå…¬å¹³é”</strong>ï¼Œæ˜¾å¼ <code>Lock</code> é”æ—¢æ”¯æŒå…¬å¹³é”ï¼Œä¹Ÿæ”¯æŒéå…¬å¹³é”</p></blockquote><h3 id="3ã€é”çš„ç²’åº¦"><a href="#3ã€é”çš„ç²’åº¦" class="headerlink" title="3ã€é”çš„ç²’åº¦"></a>3ã€é”çš„ç²’åº¦</h3><blockquote><p>â€‹        ä¸€ä¸ªé”å¯ä»¥ä¿æŠ¤çš„å…±äº«æ•°æ®çš„æ•°é‡å¤§å°ç§°ä¸ºé”çš„ç²’åº¦ï¼Œé”çš„ç²’åº¦æ˜¯ç›¸å¯¹çš„ã€‚</p><p>â€‹        é”ä¿æŠ¤çš„å…±äº«æ•°æ®é‡å¤§ï¼Œç§°è¯¥é”çš„ç²’åº¦ç²—ï¼Œå¦åˆ™ç§°é”çš„ç²’åº¦ç»†ã€‚</p><p>â€‹        å¦‚æœé”çš„ç²’åº¦è¿‡ç²—ï¼Œä¼šå¯¼è‡´çº¿ç¨‹åœ¨ç”³è¯·é”æ—¶è¿›è¡Œä¸å¿…è¦çš„ç­‰å¾…ã€‚</p><p>â€‹        å¦‚æœé”çš„ç²’åº¦è¿‡ç»†ï¼Œä¼šå¢åŠ é”è°ƒåº¦çš„å¼€é”€ã€‚</p></blockquote><h2 id="1-6ã€å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§"><a href="#1-6ã€å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§" class="headerlink" title="1.6ã€å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§"></a>1.6ã€å¯è§æ€§ã€æœ‰åºæ€§å’ŒåŸå­æ€§</h2><h3 id="1ã€åŸå­æ€§"><a href="#1ã€åŸå­æ€§" class="headerlink" title="1ã€åŸå­æ€§"></a>1ã€åŸå­æ€§</h3><blockquote><p><strong>åŸå­æ€§</strong> ï¼šåŸå­æ€§æ˜¯æŒ‡<strong>ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¤±è´¥ï¼Œæœ‰ç€â€œåŒç”Ÿå…±æ­»â€çš„æ„Ÿè§‰</strong>ã€‚åŠæ—¶åœ¨å¤šä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€å¹²æ‰°ã€‚</p><p>åˆ¤æ–­ä»¥ä¸‹æŒ‡ä»¤æ˜¯å¦æ»¡è¶³åŸå­æ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br></pre></td></tr></table></figure><blockquote><p>æ»¡è¶³ï¼Œå°†10ç›´æ¥èµ‹å€¼ç»™çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡a</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a++;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸æ»¡è¶³ï¼Œè¯­å¥a++å®é™…ä¸ŠåŒ…æ‹¬äº†ä¸‰ä¸ªæ“ä½œï¼š</p><ul><li>è¯»å–å˜é‡açš„å€¼</li><li>å°†è¯»å–å‡ºæ¥çš„aå€¼ + 1</li><li>å°†+1åçš„å€¼èµ‹ç»™å˜é‡a</li></ul></blockquote><h3 id="2ã€æœ‰åºæ€§"><a href="#2ã€æœ‰åºæ€§" class="headerlink" title="2ã€æœ‰åºæ€§"></a>2ã€æœ‰åºæ€§</h3><blockquote><p><strong>æœ‰åºæ€§</strong> ï¼š ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œå¯¹æŒ‡ä»¤åºåˆ—è¿›è¡Œé‡æ’åºï¼Œä¹Ÿå°±æ˜¯ä½ ç¼–å†™çš„ä»£ç é¡ºåºå’Œæœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤é¡ºåºæ˜¯ä¸ä¸€è‡´çš„ï¼Œé‡æ’åºå¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹ç¨‹åºå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜</p></blockquote><h3 id="3ã€å¯è§æ€§"><a href="#3ã€å¯è§æ€§" class="headerlink" title="3ã€å¯è§æ€§"></a>3ã€å¯è§æ€§</h3><blockquote><p><strong>å¯è§æ€§</strong> ï¼š å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå…±äº«å˜é‡å€¼çš„ä¿®æ”¹ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»è·å¾—ä¿®æ”¹ä»¥åçš„å€¼</p></blockquote><h1 id="äºŒã€Lockæ¥å£"><a href="#äºŒã€Lockæ¥å£" class="headerlink" title="äºŒã€Lockæ¥å£"></a>äºŒã€Lockæ¥å£</h1><h2 id="2-1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-1ã€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2.1ã€æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223115957.png" alt="img"></p><blockquote><p>é”å®ç°æä¾›äº†æ¯”ä½¿ç”¨åŒæ­¥æ–¹æ³•å’Œè¯­å¥å¯ä»¥è·å¾—çš„æ›´å¹¿æ³›çš„é”æ“ä½œã€‚å®ƒä»¬å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯èƒ½å…·æœ‰éå¸¸ä¸åŒçš„å±æ€§ï¼Œå¹¶ä¸”å¯èƒ½æ”¯æŒå¤šä¸ªå…³è”çš„æ¡ä»¶å¯¹è±¡ã€‚</p></blockquote><h2 id="2-2ã€Lockæ¥å£å®ç°â€“ReentrantLockå¯é‡å…¥é”"><a href="#2-2ã€Lockæ¥å£å®ç°â€“ReentrantLockå¯é‡å…¥é”" class="headerlink" title="2.2ã€Lockæ¥å£å®ç°â€“ReentrantLockå¯é‡å…¥é”"></a>2.2ã€Lockæ¥å£å®ç°â€“ReentrantLockå¯é‡å…¥é”</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223120106.png" alt="img"></p><h3 id="1ã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#1ã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="1ã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>1ã€å¦‚ä½•ä½¿ç”¨ï¼Ÿ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();  <span class="comment">// block until condition holds</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ... method body</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€Lockå’Œsynchronizedçš„åŒºåˆ«"><a href="#2ã€Lockå’Œsynchronizedçš„åŒºåˆ«" class="headerlink" title="2ã€Lockå’Œsynchronizedçš„åŒºåˆ«"></a>2ã€Lockå’Œsynchronizedçš„åŒºåˆ«</h3><blockquote><p>äºŒè€…åŒºåˆ«</p></blockquote><ul><li>é¦–å…ˆsynchronizedæ˜¯Javaå†…ç½®å…³é”®å­—ï¼Œåœ¨jvmå±‚é¢ï¼Œè€ŒLockæ˜¯Javaä¸­çš„ä¸€ä¸ªæ¥å£</li><li>synchronizedæ— æ³•åˆ¤æ–­æ˜¯å¦è·å–é”çš„çŠ¶æ€ï¼ŒLockå¯ä»¥åˆ¤æ–­æ˜¯å¦è·å–åˆ°é”ï¼›</li><li>synchronizedä¼šè‡ªåŠ¨é‡Šæ”¾é”(a çº¿ç¨‹æ‰§è¡Œå®ŒåŒæ­¥ä»£ç ä¼šé‡Šæ”¾é” ï¼›b çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ä¼šé‡Šæ”¾é”)ï¼ŒLockéœ€åœ¨finallyä¸­æ‰‹å·¥é‡Šæ”¾é”ï¼ˆunlock()æ–¹æ³•é‡Šæ”¾é”ï¼‰ï¼Œå¦åˆ™å®¹æ˜“é€ æˆçº¿ç¨‹æ­»é”ï¼›</li><li>ç”¨synchronizedå…³é”®å­—çš„ä¸¤ä¸ªçº¿ç¨‹1å’Œçº¿ç¨‹2ï¼Œå¦‚æœå½“å‰çº¿ç¨‹1è·å¾—é”ï¼Œçº¿ç¨‹2çº¿ç¨‹ç­‰å¾…ã€‚å¦‚æœçº¿ç¨‹1é˜»å¡ï¼Œçº¿ç¨‹2åˆ™ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè€ŒLocké”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹å»ï¼Œå¦‚æœå°è¯•è·å–ä¸åˆ°é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…å°±ç»“æŸäº†ï¼›</li><li>synchronizedçš„é”å¯é‡å…¥ã€ä¸å¯ä¸­æ–­ã€éå…¬å¹³ï¼Œè€ŒLocké”å¯é‡å…¥ã€å¯åˆ¤æ–­ã€å¯å…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰</li><li>Locké”é€‚åˆå¤§é‡åŒæ­¥çš„ä»£ç çš„åŒæ­¥é—®é¢˜ï¼Œsynchronizedé”é€‚åˆä»£ç å°‘é‡çš„åŒæ­¥é—®é¢˜ã€‚</li></ul><h1 id="ä¸‰ã€çº¿ç¨‹é—´é€šä¿¡"><a href="#ä¸‰ã€çº¿ç¨‹é—´é€šä¿¡" class="headerlink" title="ä¸‰ã€çº¿ç¨‹é—´é€šä¿¡"></a>ä¸‰ã€çº¿ç¨‹é—´é€šä¿¡</h1><blockquote><p>å¼•å…¥é¢˜ç›®ï¼šç°æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ“ä½œä¸€ä¸ªåˆå§‹å€¼ä¸º0çš„å˜é‡</p><p>å®ç°ä¸€ä¸ªçº¿ç¨‹ä»¤è¯¥å˜é‡ + 1ï¼Œä¸€ä¸ªçº¿ç¨‹ä»¤è¯¥å˜é‡ - 1</p><p>å®ç°äº¤æ›¿.</p></blockquote><h2 id="3-1ã€å…¥é—¨æ¡ˆä¾‹"><a href="#3-1ã€å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="3.1ã€å…¥é—¨æ¡ˆä¾‹"></a>3.1ã€å…¥é—¨æ¡ˆä¾‹</h2><h3 id="1ã€ç¼–å†™èµ„æºç±»"><a href="#1ã€ç¼–å†™èµ„æºç±»" class="headerlink" title="1ã€ç¼–å†™èµ„æºç±»"></a>1ã€ç¼–å†™èµ„æºç±»</h3><blockquote><p>èµ„æºç±»ä¸­åŒ…æ‹¬å˜é‡å’Œæ“æ§å˜é‡çš„æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span>(number != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2 å¦‚æœnumber == 0ï¼Œé‚£ä¹ˆæ‰§è¡Œ+1æ“ä½œ</span></span><br><span class="line">        number++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + number);</span><br><span class="line">        <span class="comment">//3 å”¤é†’</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sub</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span>(number == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2 å¦‚æœnumber != 0ï¼Œé‚£ä¹ˆæ‰§è¡Œ-1æ“ä½œ</span></span><br><span class="line">        number--;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + number);</span><br><span class="line">        <span class="comment">//3 å”¤é†’</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åœ¨mainæ–¹æ³•ä¸­åˆ›å»ºçº¿ç¨‹è¿›è¡Œæµ‹è¯•"><a href="#2ã€åœ¨mainæ–¹æ³•ä¸­åˆ›å»ºçº¿ç¨‹è¿›è¡Œæµ‹è¯•" class="headerlink" title="2ã€åœ¨mainæ–¹æ³•ä¸­åˆ›å»ºçº¿ç¨‹è¿›è¡Œæµ‹è¯•"></a>2ã€åœ¨mainæ–¹æ³•ä¸­åˆ›å»ºçº¿ç¨‹è¿›è¡Œæµ‹è¯•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Counter counter = <span class="keyword">new</span> Counter();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">10</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            counter.add();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">10</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            counter.sub();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><h3 id="3ã€ç»“æœ"><a href="#3ã€ç»“æœ" class="headerlink" title="3ã€ç»“æœ"></a>3ã€ç»“æœ</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223153745.png" alt="image-20210223153744372"></p><h2 id="3-2ã€å°†çº¿ç¨‹æ•°ä»ä¸¤ä¸ªå¢åŠ åˆ°4ä¸ªï¼Œä¸¤ä¸ªåŠ ä¸¤ä¸ªå‡"><a href="#3-2ã€å°†çº¿ç¨‹æ•°ä»ä¸¤ä¸ªå¢åŠ åˆ°4ä¸ªï¼Œä¸¤ä¸ªåŠ ä¸¤ä¸ªå‡" class="headerlink" title="3.2ã€å°†çº¿ç¨‹æ•°ä»ä¸¤ä¸ªå¢åŠ åˆ°4ä¸ªï¼Œä¸¤ä¸ªåŠ ä¸¤ä¸ªå‡"></a>3.2ã€å°†çº¿ç¨‹æ•°ä»ä¸¤ä¸ªå¢åŠ åˆ°4ä¸ªï¼Œä¸¤ä¸ªåŠ ä¸¤ä¸ªå‡</h2><h3 id="1ã€å¢åŠ çº¿ç¨‹æ•°"><a href="#1ã€å¢åŠ çº¿ç¨‹æ•°" class="headerlink" title="1ã€å¢åŠ çº¿ç¨‹æ•°"></a>1ã€å¢åŠ çº¿ç¨‹æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Counter counter = <span class="keyword">new</span> Counter();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">10</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            counter.add();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">10</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            counter.sub();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">10</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            counter.add();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">10</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            counter.sub();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;D&quot;</span>).start();</span><br></pre></td></tr></table></figure><h3 id="2ã€æµ‹è¯•æŸ¥çœ‹ç»“æœ"><a href="#2ã€æµ‹è¯•æŸ¥çœ‹ç»“æœ" class="headerlink" title="2ã€æµ‹è¯•æŸ¥çœ‹ç»“æœ"></a>2ã€æµ‹è¯•æŸ¥çœ‹ç»“æœ</h3><blockquote><p>æ­¤æ—¶å‘ç°ç»“æœä¸ç¬¦åˆé¢„æœŸ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223154436.png" alt="image-20210223154436682"></p><h3 id="3ã€å‡ºç°ä»¥ä¸Šé—®é¢˜çš„åŸå› æ˜¯å¤šçº¿ç¨‹çš„è™šå‡å”¤é†’"><a href="#3ã€å‡ºç°ä»¥ä¸Šé—®é¢˜çš„åŸå› æ˜¯å¤šçº¿ç¨‹çš„è™šå‡å”¤é†’" class="headerlink" title="3ã€å‡ºç°ä»¥ä¸Šé—®é¢˜çš„åŸå› æ˜¯å¤šçº¿ç¨‹çš„è™šå‡å”¤é†’"></a>3ã€å‡ºç°ä»¥ä¸Šé—®é¢˜çš„åŸå› æ˜¯å¤šçº¿ç¨‹çš„è™šå‡å”¤é†’</h3><blockquote><p>å¦‚ä½•è§£å†³ï¼Ÿ</p><p>ä¿®æ”¹èµ„æºç±»ï¼Œåœ¨addæ–¹æ³•å’Œsubæ–¹æ³•ä¸­ä½¿ç”¨<strong>while</strong>ä»£æ›¿<strong>if</strong> ï¼ŒæŸ¥çœ‹Java 8 Apiæ–‡æ¡£</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223160402.png" alt="image-20210223160402330"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">while</span>(number != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2 å¦‚æœnumber == 0ï¼Œé‚£ä¹ˆæ‰§è¡Œ+1æ“ä½œ</span></span><br><span class="line">        number++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + number);</span><br><span class="line">        <span class="comment">//3 å”¤é†’</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sub</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1 åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">while</span>(number == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2 å¦‚æœnumber != 0ï¼Œé‚£ä¹ˆæ‰§è¡Œ-1æ“ä½œ</span></span><br><span class="line">        number--;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + number);</span><br><span class="line">        <span class="comment">//3 å”¤é†’</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶é‡å¯æµ‹è¯•ï¼ŒæŸ¥çœ‹ç»“æœï¼Œå‘ç°é—®é¢˜å·²ç»è§£å†³ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223160525.png" alt="image-20210223160525017"></p><h3 id="4ã€æ€»ç»“"><a href="#4ã€æ€»ç»“" class="headerlink" title="4ã€æ€»ç»“"></a>4ã€æ€»ç»“</h3><ul><li>é«˜å†…èšä½è€¦åˆå‰æä¸‹ï¼Œçº¿ç¨‹æ“ä½œèµ„æºç±»</li><li>åˆ¤æ–­/å·¥ä½œ/é€šçŸ¥</li><li>å¤šçº¿ç¨‹<strong>äº¤äº’</strong>ä¸­ï¼Œå¿…é¡»è¦é˜²æ­¢å¤šçº¿ç¨‹çš„<strong>è™šå‡å”¤é†’</strong>ï¼Œå³åˆ¤æ–­<strong>åªç”¨while</strong>è€Œä¸ç”¨if</li><li>æ³¨æ„æ ‡å¿—ä½çš„ä¿®æ”¹å’Œå®šä½</li></ul><h3 id="5ã€è™šå‡å”¤é†’å‡ºç°åŸå› "><a href="#5ã€è™šå‡å”¤é†’å‡ºç°åŸå› " class="headerlink" title="5ã€è™šå‡å”¤é†’å‡ºç°åŸå› "></a>5ã€è™šå‡å”¤é†’å‡ºç°åŸå› </h3><blockquote><p>ç°æœ‰4ä¸ªçº¿ç¨‹ï¼Œä¸¤ä¸ªç”Ÿäº§è€…ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…</p><p>åœ¨ç¬¬ä¸€ä¸ªç”Ÿäº§è€…ç”Ÿäº§å®Œåï¼Œä¼šè°ƒç”¨notifyAllå”¤é†’å…¶ä½™çº¿ç¨‹ï¼Œæ­¤æ—¶è¢«å”¤é†’çš„çº¿ç¨‹å¯èƒ½æ˜¯æ¶ˆè´¹è€…ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”Ÿäº§è€…ï¼Œå¦‚æœæ˜¯å¦ä¸€ä¸ªç”Ÿäº§è€…å”¤é†’ï¼Œé‚£ä¹ˆç”±äºnumberå·²ç»ä¸ä¸º0ï¼Œæ‰€ä»¥è¿›æ¥çš„ç”Ÿäº§è€…ä¼šæ‰§è¡Œ this.wait() ã€‚</p><p>ç”±äºwaitæ–¹æ³•ä¼šäº¤å‡ºé”çš„æŒæœ‰æƒï¼Œæ‰€ä»¥æ­¤æ—¶ç¬¬ä¸€ä¸ªç”Ÿäº§è€…ã€å…¶ä»–ä¸¤ä¸ªæ¶ˆè´¹è€…ä¼šé‡æ–°æŠ¢å¤ºé”ï¼Œå¦‚æœæ­¤æ—¶æŠ¢åˆ°é”çš„æ˜¯ç¬¬ä¸€ä¸ªç”Ÿäº§è€…ï¼Œé‚£ä¹ˆç”±äºnumberå·²ç»ä¸ä¸º0ï¼Œæ‰€ä»¥è¿›æ¥çš„ç¬¬ä¸€ä¸ªç”Ÿäº§è€…ä¹Ÿä¼šæ‰§è¡Œthis.wait() ã€‚</p><p>æ­¤æ—¶ç”±äºwaitæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªç”Ÿäº§è€…äº¤å‡ºäº†æ‰‹ä¸­çš„é”ï¼Œæ­¤æ—¶ä¸¤ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹é‡æ–°æŠ¢å¤ºæ—¶é—´ç‰‡ï¼Œï¼ˆ<strong>æ³¨æ„æ­¤æ—¶èµ„æºç±»å¯¹è±¡çš„numberä¾ç„¶ä¸º1</strong>ï¼‰ï¼Œåœ¨æ¶ˆè´¹è€…çº¿ç¨‹å°†numberâ€“åä¼šè°ƒç”¨notifyå”¤é†’å…¶ä»–æ‰€æœ‰çº¿ç¨‹ï¼Œæ­¤æ—¶ç”±äºä¸¤ä¸ªç”Ÿäº§è€…çº¿ç¨‹å·²ç»waitå¾ˆä¹…ï¼Œæ‰€ä»¥ä¼šä¼˜å…ˆç»™è¿™ä¸¤ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œæ‰€ä»¥æ­¤æ—¶ä¸¤ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹éƒ½ä¼šæ‰§è¡Œnumber++ï¼Œnumberä»0å˜ä¸º2ã€‚</p><p>å¦‚æœä½¿ç”¨whileä»£æ›¿ifï¼Œé‚£ä¹ˆåœ¨ç”Ÿäº§è€…è¢«æ¶ˆè´¹è€…å”¤é†’åä¼šè¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œæ­¤æ—¶å°±ä¸ä¼šå‡ºç°ä¸¤ä¸ªç”Ÿäº§è€…çº¿ç¨‹éƒ½è®©number+1çš„æƒ…å†µã€‚</p></blockquote><h2 id="3-3ã€ä½¿ç”¨Lockä»£æ›¿synchronized"><a href="#3-3ã€ä½¿ç”¨Lockä»£æ›¿synchronized" class="headerlink" title="3.3ã€ä½¿ç”¨Lockä»£æ›¿synchronized"></a>3.3ã€ä½¿ç”¨Lockä»£æ›¿synchronized</h2><h3 id="1ã€å…³ç³»å›¾"><a href="#1ã€å…³ç³»å›¾" class="headerlink" title="1ã€å…³ç³»å›¾"></a>1ã€å…³ç³»å›¾</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223165518.png" alt="img"></p><blockquote><p>ä½¿ç”¨awaitä»£æ›¿wait</p><p>ä½¿ç”¨signalä»£æ›¿notify</p><p>ä½¿ç”¨signalAllä»£æ›¿notifyAll</p></blockquote><h3 id="2ã€ä¿®æ”¹èµ„æºç±»"><a href="#2ã€ä¿®æ”¹èµ„æºç±»" class="headerlink" title="2ã€ä¿®æ”¹èµ„æºç±»"></a>2ã€ä¿®æ”¹èµ„æºç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LockCounter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> Condition condition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(number != <span class="number">0</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + number);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sub</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(number == <span class="number">0</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number--;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + number);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ"><a href="#3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ" class="headerlink" title="3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ"></a>3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223173218.png" alt="image-20210223173217788"></p><h2 id="3-4ã€ä½¿ç”¨Lockçš„åŸå› "><a href="#3-4ã€ä½¿ç”¨Lockçš„åŸå› " class="headerlink" title="3.4ã€ä½¿ç”¨Lockçš„åŸå› "></a>3.4ã€ä½¿ç”¨Lockçš„åŸå› </h2><h3 id="1ã€å¼•å…¥æ–°é—®é¢˜"><a href="#1ã€å¼•å…¥æ–°é—®é¢˜" class="headerlink" title="1ã€å¼•å…¥æ–°é—®é¢˜"></a>1ã€å¼•å…¥æ–°é—®é¢˜</h3><blockquote><p>å¤šçº¿ç¨‹ä¹‹é—´å®ç°é¡ºåºè°ƒç”¨ï¼Œå³A-&gt;B-&gt;C</p><p>Aæ‰“å°5æ¬¡ï¼ŒBæ‰“å°10æ¬¡ï¼ŒCæ‰“å°15æ¬¡</p><p>æ¥ç€</p><p>Aæ‰“å°5æ¬¡ï¼ŒBæ‰“å°10æ¬¡ï¼ŒCæ‰“å°15æ¬¡</p><p>é‡å¤åè½®</p><p>æ‰“å°é¡ºåºè¦æ±‚å¦‚ä¸‹A-&gt;B-&gt;C-&gt;A</p><p>ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå¦‚æœæ ‡å¿—ä½ä¸º1ï¼Œé‚£ä¹ˆAè¾“å‡ºï¼Œä¸º2åˆ™Bè¾“å‡ºï¼Œä¸º3åˆ™Cè¾“å‡º</p></blockquote><h3 id="2ã€ç¼–å†™èµ„æºç±»"><a href="#2ã€ç¼–å†™èµ„æºç±»" class="headerlink" title="2ã€ç¼–å†™èµ„æºç±»"></a>2ã€ç¼–å†™èµ„æºç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShareResource</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ ‡å¿—ä½</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="comment">//ç»™locké…ä¸‰æŠŠé’¥åŒ™ï¼ŒA-condition1ï¼ŒB-condition2ï¼ŒC-condition3</span></span><br><span class="line">    <span class="keyword">private</span> Condition condition1 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition condition2 = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> Condition condition3 = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span>(number != <span class="number">1</span>) &#123;</span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;A&quot;</span> + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¿®æ”¹æ ‡å¿—ä½ï¼Œè®¾ç½®ä¸º2ï¼Œåªå”¤é†’B</span></span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print10</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span>(number != <span class="number">2</span>) &#123;</span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;B&quot;</span> + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¿®æ”¹æ ‡å¿—ä½ï¼Œè®¾ç½®ä¸º3ï¼Œåªå”¤é†’C</span></span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            condition3.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print15</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">            <span class="keyword">while</span>(number != <span class="number">3</span>) &#123;</span><br><span class="line">                condition3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¹²æ´»</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;C&quot;</span> + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¿®æ”¹æ ‡å¿—ä½ï¼Œè®¾ç½®ä¸º1ï¼Œåªå”¤é†’A</span></span><br><span class="line">            number = <span class="number">1</span>;</span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºçº¿ç¨‹è¿›è¡Œè°ƒç”¨"><a href="#3ã€åˆ›å»ºçº¿ç¨‹è¿›è¡Œè°ƒç”¨" class="headerlink" title="3ã€åˆ›å»ºçº¿ç¨‹è¿›è¡Œè°ƒç”¨"></a>3ã€åˆ›å»ºçº¿ç¨‹è¿›è¡Œè°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ShareResource resource = <span class="keyword">new</span> ShareResource();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        resource.print5();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        resource.print10();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        resource.print15();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;C&quot;</span>).start();</span><br></pre></td></tr></table></figure><h3 id="4ã€æŸ¥çœ‹ç»“æœ"><a href="#4ã€æŸ¥çœ‹ç»“æœ" class="headerlink" title="4ã€æŸ¥çœ‹ç»“æœ"></a>4ã€æŸ¥çœ‹ç»“æœ</h3><blockquote><p>æµ‹è¯•æˆåŠŸ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223183944.png" alt="image-20210223183943895"></p><h3 id="5ã€ç»“è®º"><a href="#5ã€ç»“è®º" class="headerlink" title="5ã€ç»“è®º"></a>5ã€ç»“è®º</h3><blockquote><p>Locké…åˆConditionä½¿ç”¨å¯ä»¥è¾¾åˆ°ç²¾ç¡®å”¤é†’çš„æ•ˆæœ</p></blockquote><h2 id="3-5ã€é¢è¯•é¢˜è§£ç­”"><a href="#3-5ã€é¢è¯•é¢˜è§£ç­”" class="headerlink" title="3.5ã€é¢è¯•é¢˜è§£ç­”"></a>3.5ã€é¢è¯•é¢˜è§£ç­”</h2><blockquote><p>ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰“å°1-52ï¼Œå¦ä¸€ä¸ªæ‰“å°å­—æ¯A-Zæ‰“å°é¡ºåºä¸º12A34Bâ€¦5152Z</p><p>è¦æ±‚ç”¨çº¿ç¨‹é—´é€šä¿¡</p></blockquote><h3 id="1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»"><a href="#1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»" class="headerlink" title="1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»"></a>1ã€ç¼–å†™ä¸€ä¸ªèµ„æºç±»</h3><blockquote><p>ç”±äºæ‰“å°çš„é¡ºåºä¸ºä¸¤ä¸ªæ•°å­—ä¸€ä¸ªå­—æ¯ï¼Œé‚£ä¹ˆåˆ¤æ–­æ¡ä»¶å°±æ˜¯ï¼šå½“numberä¸º3çš„å€æ•°æ—¶ï¼Œæ‰“å°å­—æ¯ï¼Œå…¶ä½™æ—¶é—´æ‰“å°æ•°å­—ã€‚</p><p>å¤šçº¿ç¨‹é—®é¢˜ä¸€èˆ¬çš„è§£å†³å¥—è·¯</p><ul><li>èµ„æºç±»</li><li>åˆ¤æ–­/å·¥ä½œ/å”¤é†’</li><li>æ³¨æ„æ ‡å¿—ä½çš„ä¿®æ”¹å’Œå®šä½</li><li>é˜²æ­¢è™šå‡å”¤é†’</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Printer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Condition engCondition = lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Condition numCondition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printEng</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> i = <span class="string">&#x27;A&#x27;</span>; i &lt;= <span class="string">&#x27;Z&#x27;</span>; i++) &#123;</span><br><span class="line">                <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">                <span class="keyword">while</span>(number % <span class="number">3</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                    engCondition.await();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//å·¥ä½œ</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;--&gt;&quot;</span> + i);</span><br><span class="line">                <span class="comment">//ä¿®æ”¹æ ‡å¿—ä½</span></span><br><span class="line">                number++;</span><br><span class="line">                numCondition.signal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">54</span>; i++) &#123;</span><br><span class="line">                <span class="comment">//åˆ¤æ–­</span></span><br><span class="line">                <span class="keyword">while</span>(number % <span class="number">3</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    numCondition.await();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//å·¥ä½œ</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;--&gt;&quot;</span> + i);</span><br><span class="line">                <span class="comment">//ä¿®æ”¹æ ‡å¿—ä½</span></span><br><span class="line">                number++;</span><br><span class="line">                engCondition.signal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨èµ„æºç±»ä¸­çš„æ–¹æ³•"><a href="#2ã€åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨èµ„æºç±»ä¸­çš„æ–¹æ³•" class="headerlink" title="2ã€åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨èµ„æºç±»ä¸­çš„æ–¹æ³•"></a>2ã€åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨èµ„æºç±»ä¸­çš„æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Printer printer = <span class="keyword">new</span> Printer();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; printer.printEng(),<span class="string">&quot;æ‰“å°å­—æ¯çš„çº¿ç¨‹&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; printer.printNum(),<span class="string">&quot;æ‰“å°æ•°å­—çš„çº¿ç¨‹&quot;</span>).start();</span><br></pre></td></tr></table></figure><h3 id="3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ-1"><a href="#3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ-1" class="headerlink" title="3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ"></a>3ã€è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223231529.png" alt="image-20210223231436737"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223231547.png" alt="image-20210223231547521"></p><h2 id="3-6ã€å¤šçº¿ç¨‹8é”"><a href="#3-6ã€å¤šçº¿ç¨‹8é”" class="headerlink" title="3.6ã€å¤šçº¿ç¨‹8é”"></a>3.6ã€å¤šçº¿ç¨‹8é”</h2><h3 id="1ã€8é”ç°è±¡"><a href="#1ã€8é”ç°è±¡" class="headerlink" title="1ã€8é”ç°è±¡"></a>1ã€8é”ç°è±¡</h3><blockquote><p>åˆ›å»ºä¸€ä¸ªèµ„æºç±»Phone</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;---------sendEmail&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;---------sendSMS&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ ‡å‡†è®¿é—®</li></ul><blockquote><p>åœ¨mainæ–¹æ³•ä¸­ç¼–å†™ä»¥ä¸‹ä»£ç ï¼ŒæŸ¥çœ‹è¾“å‡ºç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å¯åŠ¨ç¨‹åºï¼ŒsendSMSå’ŒsendEmailæ–¹æ³•æ‰§è¡Œçš„å‰åé¡ºåºæ— æ³•ç¡®å®šã€‚</p><p>ABä¸¤ä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªèµ„æºç±»å¯¹è±¡ï¼Œæ­¤æ—¶ç”±äºé”çš„æ˜¯ä¸€ä¸ªèµ„æºç±»å¯¹è±¡ï¼Œæ‰€ä»¥ä¸¤ä¸ªçº¿ç¨‹è°å…ˆæ‹¿åˆ°CPUæ‰§è¡Œæƒï¼Œè°å°±å…ˆæ‰§è¡Œã€‚</p></blockquote><ul><li>åœ¨ä¸¤ä¸ªçº¿ç¨‹çš„å¯åŠ¨ä¸­æ·»åŠ Thread.sleep()æ–¹æ³•ï¼Œæ­¤æ—¶mainå‡½æ•°ä¸­ä»£ç ä¸º</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">Thread.sleep(<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å¯åŠ¨ç¨‹åºï¼Œå…ˆè°ƒç”¨sendEmailæ–¹æ³•ï¼Œè¿™æ˜¯å› ä¸ºABçº¿ç¨‹çš„startæ–¹æ³•é—´æœ‰sleepæ–¹æ³•ï¼Œå¯¼è‡´Aå…ˆæŠ¢åˆ°äº†é”</p></blockquote><ul><li>åœ¨é‚®ä»¶æ–¹æ³•ä¸­ä½¿ç”¨sleepæš‚åœ4ç§’é’Ÿï¼Œä¸”ä¸¤ä¸ªçº¿ç¨‹ä¸­é—´ä»»ä½•ä¼‘çœ ä¸¤ç§’</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">   Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">   System.out.println(<span class="string">&quot;---------sendEmail&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">Thread.sleep(<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å¯åŠ¨ç¨‹åºï¼Œå‘ç°è¿˜æ˜¯å…ˆè°ƒç”¨sendEmailæ–¹æ³•ï¼Œè¿™æ˜¯å› ä¸ºThread.sleep()æ–¹æ³•ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œæ‰€ä»¥AæŠ¢åˆ°é”åå…ˆæŠ±ç€é”ç¡äº†4ç§’ï¼Œç„¶åæ‰§è¡ŒsendEmailæ–¹æ³•ã€‚</p></blockquote><ul><li>åœ¨èµ„æºç±»ä¸­æ–°å¢ä¸€ä¸ªæ™®é€šæ–¹æ³•hello</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;---------Hello&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹mainæ–¹æ³•ä¸­çš„ä»£ç ï¼Œä»¤Bçº¿ç¨‹è°ƒç”¨helloæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">Thread.sleep(<span class="number">2000</span>);</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.hello();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å¯åŠ¨ç¨‹åºï¼Œå…ˆæ‰§è¡Œhello()æ–¹æ³•ï¼Œå†æ‰§è¡ŒsendEmailæ–¹æ³•</p></blockquote><ul><li>å¼•å…¥å¦ä¸€ä¸ªèµ„æºç±»å¯¹è±¡ï¼Œå¹¶ä»¤çº¿ç¨‹Bè°ƒç”¨å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„sendSMSæ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line">Phone phone1 = <span class="keyword">new</span> Phone();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">Thread.sleep(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone1.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨ä»£ç ï¼Œå‘ç°å…ˆè°ƒç”¨sendSmsæ–¹æ³•ï¼Œè¿™æ˜¯ç”±äºé”çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</p></blockquote><ul><li>ä¸¤ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼ŒåŒä¸€ä¸ªé™æ€èµ„æºç±»å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;---------sendEmail&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;---------sendSMS&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;---------Hello&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>mainæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">Thread.sleep(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºsynchronizedä¿®é¥°çš„æ˜¯é™æ€æ–¹æ³•ï¼Œåˆ™ç­‰åŒäºsynchronized(this.getClass)ï¼Œä¸¤ä¸ªæ–¹æ³•é”çš„æ˜¯åŒä¸€ä¸ªç±»å¯¹è±¡ï¼Œæ‰€ä»¥è¿˜æ˜¯sendEmailæ–¹æ³•å…ˆè¢«è°ƒç”¨</p></blockquote><ul><li>ä¸¤ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸¤ä¸ªèµ„æºç±»å¯¹è±¡</li></ul><blockquote><p>ç”±äºé™æ€åŒæ­¥æ–¹æ³•é”çš„æ˜¯èµ„æºç±»ï¼Œæ‰€ä»¥ç»“æœåŒä¸Š</p></blockquote><ul><li>ä¸€ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªèµ„æºç±»å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;---------sendEmail&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSMS</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;---------sendSMS&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;---------Hello&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>mainæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Phone.sendEmail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">Thread.sleep(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        phone.sendSMS();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å…ˆè°ƒç”¨sendSMSæ–¹æ³•ï¼Œç„¶åè°ƒç”¨sendEmailæ–¹æ³•ï¼Œè¿™æ˜¯å› ä¸ºé”çš„å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥å…ˆè°ƒç”¨æ²¡æœ‰sleepçš„sendSMSæ–¹æ³•</p></blockquote><ul><li>ä¸€ä¸ªæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸¤ä¸ªèµ„æºç±»å¯¹è±¡</li></ul><blockquote><p>åŒä¸Š</p></blockquote><h3 id="2ã€8é”çš„è§£é‡Š"><a href="#2ã€8é”çš„è§£é‡Š" class="headerlink" title="2ã€8é”çš„è§£é‡Š"></a>2ã€8é”çš„è§£é‡Š</h3><ul><li>æ€»ç»“ä¸€</li></ul><blockquote><p><strong>ä¸€ä¸ªå¯¹è±¡é‡Œé¢å¦‚æœæœ‰å¤šä¸ªsynchronizedæ–¹æ³•ï¼ŒæŸä¸€æ—¶åˆ»å†…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªsynchronizedæ–¹æ³•äº†ï¼Œé‚£ä¹ˆå…¶ä»–çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œæ¢å¥è¯è¯´ï¼ŒæŸä¸€ä¸ªæ—¶åˆ»å†…ï¼Œåªèƒ½æœ‰å”¯ä¸€ä¸€ä¸ªçº¿ç¨‹å»è®¿é—®è¿™äº›synchronizedæ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰å¯¹è±¡thisï¼Œè¢«é”å®šåï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½ä¸èƒ½è¿›è¡Œåˆ°å½“å‰å¯¹è±¡çš„å…¶ä»–synchronizedæ–¹æ³•ã€‚</strong></p></blockquote><ul><li>æ€»ç»“äºŒ</li></ul><blockquote><p>å¦‚æœæ·»åŠ ä¸€ä¸ªæ™®é€šæ–¹æ³•ï¼Œé‚£ä¹ˆä¸åŒæ­¥é”æ— å…³ã€‚</p></blockquote><ul><li>æ€»ç»“ä¸‰</li></ul><blockquote><p>å¦‚æœæ“æ§ä¸¤ä¸ªèµ„æºç±»å¯¹è±¡ï¼Œé‚£ä¹ˆé”çš„å°±ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡äº†ã€‚</p><p>å¯ä»¥æŠŠæ“ä½œä¸¤ä¸ªèµ„æºç±»å¯¹è±¡çš„æƒ…å†µæƒ³è±¡æˆçº¿ç¨‹Aåœ¨ç”¨è‡ªå·±çš„è‹¹æœæ‰‹æœºå‘çŸ­ä¿¡ï¼Œè€Œçº¿ç¨‹Båœ¨ç”¨è‡ªå·±çš„æ‰‹æœºå‘é‚®ä»¶ï¼Œæ­¤æ—¶ä¸¤çº¿ç¨‹æ“ä½œä¸¤å°æ‰‹æœºï¼Œä¸ç”¨äº‰æŠ¢ï¼Œäº•æ°´ä¸çŠ¯æ²³æ°´ã€‚</p></blockquote><ul><li>æ€»ç»“å››</li></ul><blockquote><p>å¦‚æœä½¿ç”¨synchronizedä¿®é¥°é™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶é”çš„å¯¹è±¡æ˜¯<strong>èµ„æºç±»å¯¹è±¡çš„Class</strong>ï¼Œä¹Ÿå³<strong>synchronized(this.getClass)</strong></p><p>å’Œèµ„æºç±»å¯¹è±¡çš„ä¸ªæ•°æ²¡å…³ç³»</p></blockquote><h3 id="3ã€synchronizedæ€»ç»“"><a href="#3ã€synchronizedæ€»ç»“" class="headerlink" title="3ã€synchronizedæ€»ç»“"></a>3ã€synchronizedæ€»ç»“</h3><blockquote><p>synchronizedå®ç°åŒæ­¥çš„åŸºç¡€ï¼šJavaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚</p><p>å…·ä½“è¡¨ç°ä¸ºä»¥ä¸‹3ç§å½¢å¼ã€‚</p></blockquote><ul><li><p>å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚</p></li><li><p>å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯<strong>å½“å‰ç±»çš„Classå¯¹è±¡ã€‚</strong></p></li><li><p>å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡</p></li></ul><blockquote><p>å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒé¦–å…ˆå¿…é¡»å¾—åˆ°é”ï¼Œé€€å‡ºæˆ–æŠ›å‡ºå¼‚å¸¸æ—¶å¿…é¡»é‡Šæ”¾é”ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„<strong>éé™æ€åŒæ­¥æ–¹æ³•</strong>è·å–é”åï¼Œè¯¥å®ä¾‹å¯¹è±¡çš„å…¶ä»–<strong>éé™æ€åŒæ­¥æ–¹æ³•</strong>å¿…é¡»ç­‰å¾…è·å–é”çš„æ–¹æ³•é‡Šæ”¾é”åæ‰èƒ½è·å–é”ï¼Œ</p><p>å¯æ˜¯åˆ«çš„å®ä¾‹å¯¹è±¡çš„éé™æ€åŒæ­¥æ–¹æ³•å› ä¸ºè·Ÿè¯¥å®ä¾‹å¯¹è±¡çš„éé™æ€åŒæ­¥æ–¹æ³•ç”¨çš„æ˜¯ä¸åŒçš„é”ï¼Œæ‰€ä»¥æ¯‹é¡»ç­‰å¾…è¯¥å®ä¾‹å¯¹è±¡å·²è·å–é”çš„éé™æ€åŒæ­¥æ–¹æ³•é‡Šæ”¾é”å°±å¯ä»¥è·å–ä»–ä»¬è‡ªå·±çš„é”ã€‚</p><p><strong>æ‰€æœ‰çš„é™æ€åŒæ­¥æ–¹æ³•ç”¨çš„ä¹Ÿæ˜¯åŒä¸€æŠŠé”â€”â€”ç±»å¯¹è±¡æœ¬èº«</strong>ï¼Œè¿™ä¸¤æŠŠé”æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥é™æ€åŒæ­¥æ–¹æ³•ä¸éé™æ€åŒæ­¥æ–¹æ³•ä¹‹é—´æ˜¯ä¸ä¼šæœ‰ç«æ€æ¡ä»¶çš„ã€‚</p><p>ä½†æ˜¯ä¸€æ—¦ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•è·å–é”åï¼Œå…¶ä»–çš„é™æ€åŒæ­¥æ–¹æ³•éƒ½å¿…é¡»ç­‰å¾…è¯¥æ–¹æ³•é‡Šæ”¾é”åæ‰èƒ½è·å–é”ï¼Œè€Œä¸ç®¡æ˜¯åŒä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„é™æ€åŒæ­¥æ–¹æ³•ä¹‹é—´ï¼Œè¿˜æ˜¯ä¸åŒçš„å®ä¾‹å¯¹è±¡çš„é™æ€åŒæ­¥æ–¹æ³•ä¹‹é—´ï¼Œåªè¦å®ƒä»¬åŒä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JUC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŸºç¡€ï¼ˆä¸€ï¼‰-Lambdaè¡¨è¾¾å¼å­¦ä¹ </title>
      <link href="posts/3754089101.html"/>
      <url>posts/3754089101.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€lambdaè¡¨è¾¾å¼ç®€ä»‹"><a href="#1ã€lambdaè¡¨è¾¾å¼ç®€ä»‹" class="headerlink" title="1ã€lambdaè¡¨è¾¾å¼ç®€ä»‹"></a>1ã€lambdaè¡¨è¾¾å¼ç®€ä»‹</h2><blockquote><p>Lambdaè¡¨è¾¾å¼æ˜¯Java 8 æ·»åŠ çš„ä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼Œç®€å•æ¥è¯´ï¼ŒLambdaæ®è§†ä¸€ä¸ªåŒ¿åå‡½æ•°</p></blockquote><h2 id="2ã€ä¸ºä»€ä¹ˆä½¿ç”¨Lambdaï¼Ÿ"><a href="#2ã€ä¸ºä»€ä¹ˆä½¿ç”¨Lambdaï¼Ÿ" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆä½¿ç”¨Lambdaï¼Ÿ"></a>2ã€ä¸ºä»€ä¹ˆä½¿ç”¨Lambdaï¼Ÿ</h2><blockquote><p>ä½¿ç”¨Lambdaè¡¨è¾¾å¼å¯ä»¥å¯¹æ¥å£è¿›è¡Œä¸€ä¸ªéå¸¸ç®€æ´çš„å®ç°ã€‚</p><p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œç¼–å†™ä¸€ä¸ªcompareæ¥å£ï¼Œè¿™ä¸ªæ¥å£æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå¹¶æ¯”è¾ƒä¼ å…¥å‚æ•°çš„å¤§å°ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Compare</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºä¸Šé¢çš„è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬æœ‰å¤šç§æ–¹å¼å®ç°æ¥å£ä¸­çš„compareæ–¹æ³•</p></blockquote><h3 id="2-1ã€ç¼–å†™ä¸€ä¸ªcompareæ¥å£çš„å®ç°ç±»"><a href="#2-1ã€ç¼–å†™ä¸€ä¸ªcompareæ¥å£çš„å®ç°ç±»" class="headerlink" title="2.1ã€ç¼–å†™ä¸€ä¸ªcompareæ¥å£çš„å®ç°ç±»"></a>2.1ã€ç¼–å†™ä¸€ä¸ªcompareæ¥å£çš„å®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCompare</span> <span class="keyword">implements</span> <span class="title">Compare</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2ã€ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»"><a href="#2-2ã€ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="2.2ã€ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»"></a>2.2ã€ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Compare compare = <span class="keyword">new</span> Compare() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2-3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼"><a href="#2-3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼" class="headerlink" title="2.3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼"></a>2.3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨Lambdaè¡¨è¾¾å¼</span></span><br><span class="line">Compare lambdaCompare = (a,b) -&gt; a - b;</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥ä¸Šä¸‰ç§å®ç°æ–¹å¼å®Œå…¨ç›¸åŒã€‚</p></blockquote><h2 id="3ã€Lambdaå¯¹æ¥å£çš„è¦æ±‚"><a href="#3ã€Lambdaå¯¹æ¥å£çš„è¦æ±‚" class="headerlink" title="3ã€Lambdaå¯¹æ¥å£çš„è¦æ±‚"></a>3ã€Lambdaå¯¹æ¥å£çš„è¦æ±‚</h2><blockquote><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼å¯¹ <strong>æŸäº›</strong> æ¥å£è¿›è¡Œç®€å•å®ç°ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰æ¥å£éƒ½å¯ä»¥ä½¿ç”¨Lambdaè¡¨è¾¾å¼æ¥å®ç°ã€‚</p><p>Lambdaå¯¹æ¥å£è¦æ±‚ä¸ºï¼šæ¥å£ä¸­å®šä¹‰çš„å¿…é¡»è¦å®ç°çš„æ–¹æ³•åªèƒ½æ˜¯ä¸€ä¸ªã€‚</p></blockquote><p><strong>@FunctionalInterface</strong></p><blockquote><p>è¿™ä¸ªæ³¨è§£ç”¨äºä¿®é¥°å‡½æ•°å¼æ¥å£ï¼Œå³åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚</p></blockquote><h2 id="4ã€LambdaåŸºç¡€è¯­æ³•"><a href="#4ã€LambdaåŸºç¡€è¯­æ³•" class="headerlink" title="4ã€LambdaåŸºç¡€è¯­æ³•"></a>4ã€LambdaåŸºç¡€è¯­æ³•</h2><h3 id="4-1ã€å‰æœŸå‡†å¤‡"><a href="#4-1ã€å‰æœŸå‡†å¤‡" class="headerlink" title="4.1ã€å‰æœŸå‡†å¤‡"></a>4.1ã€å‰æœŸå‡†å¤‡</h3><blockquote><p>åˆ›å»ºä¸€ç³»åˆ—æ¥å£ï¼Œä»¥ä¾¿åé¢çš„å­¦ä¹ </p></blockquote><ul><li>ç¼–å†™ä¸€ä¸ªæ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°å¼æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LambdaWithourReturnAndParam</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå‚æ•°ä¸”ä¸å¸¦è¿”å›å€¼çš„å‡½æ•°å¼æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LambdaNoneReturnSingleParam</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªæœ‰å¤šä¸ªå‚æ•°æ²¡æœ‰è¿”å›å€¼çš„æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LambdaNoneReturnMultiParam</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªæ²¡æœ‰å‚æ•°æœ‰è¿”å›å€¼çš„æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LambdaSingleReturnNoneParam</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªå¸¦å•ä¸ªå‚æ•°ï¼Œå«è¿”å›å€¼çš„æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LambdaSingleReturnSingleParam</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªå¸¦å¤šä¸ªå‚æ•°ï¼Œå«è¿”å›å€¼çš„æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LambdaSingleReturnMultiParam</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„æ¥å£å‡ç”¨@FunctionalInterfaceæ³¨è§£è¿›è¡Œä¿®é¥°</p><p>ä¸‹é¢ä½¿ç”¨Lambdaè¡¨è¾¾å¼å¯¹ä¸Šé¢æ¥å£è¿›è¡Œä¸€ä¸€å®ç°</p></blockquote><h3 id="4-2ã€åŸºç¡€è¯­æ³•"><a href="#4-2ã€åŸºç¡€è¯­æ³•" class="headerlink" title="4.2ã€åŸºç¡€è¯­æ³•"></a>4.2ã€åŸºç¡€è¯­æ³•</h3><blockquote><p>Lambdaæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ç‚¹æœ‰ <strong>è¿”å›å€¼ç±»å‹</strong> ã€ <strong>å‚æ•°åˆ—è¡¨</strong> å’Œ <strong>æ–¹æ³•ä½“</strong></p><p>åœ¨Lambdaè¡¨è¾¾å¼ä¸­ï¼Œè¿”å›å€¼ç±»å‹æˆ‘ä»¬å¯ä»¥ä¸ç”¨æ˜¾å¼çš„å†™å‡ºæ¥ã€‚</p></blockquote><ul><li>() ï¼š ç”¨äºæè¿°å‚æ•°åˆ—è¡¨</li><li>{} ï¼š ç”¨äºæè¿°æ–¹æ³•ä½“</li><li>-&gt; ï¼š ç”¨äºåˆ†éš”å‚æ•°åˆ—è¡¨å’Œæ–¹æ³•ä½“ï¼Œæ˜¯Lambdaè¡¨è¾¾å¼çš„è¿ç®—ç¬¦ï¼Œè¯»ä½œ<strong>goes to</strong></li></ul><h3 id="4-3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æ— è¿”å›æ¥å£"><a href="#4-3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æ— è¿”å›æ¥å£" class="headerlink" title="4.3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æ— è¿”å›æ¥å£"></a>4.3ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æ— è¿”å›æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LambdaWithourReturnAndParam lambda1 = () -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;èŠœæ¹–èµ·é£&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">lambda1.test();</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222234526.png" alt="image-20210222234526505"></p><blockquote><p>æ³¨æ„ï¼š<strong>å½“ {} ä¸­å®šä¹‰çš„æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œä»£ç </strong>æ—¶ï¼Œ{} å¯ä»¥è¢«<strong>çœç•¥ã€‚</strong></p><p>å³ä¸Šé¢çš„ä»£ç å¯ä»¥ç®€åŒ–ä¸º</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LambdaWithourReturnAndParam lambda1 = () -&gt; System.out.println(<span class="string">&quot;èŠœæ¹–èµ·é£&quot;</span>);</span><br><span class="line">lambda1.test();</span><br></pre></td></tr></table></figure><h3 id="4-4ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•ä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£"><a href="#4-4ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•ä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£" class="headerlink" title="4.4ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•ä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£"></a>4.4ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•ä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LambdaNoneReturnSingleParam lambda2 = (a) -&gt; System.out.println(<span class="string">&quot;ä¼ å…¥çš„å‚æ•°ä¸ºï¼š&quot;</span> + a);</span><br><span class="line">lambda2.test(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222234844.png" alt="image-20210222234844579"></p><h3 id="4-5ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£"><a href="#4-5ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£" class="headerlink" title="4.5ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£"></a>4.5ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šä¸ªå‚æ•°æ— è¿”å›å€¼æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LambdaNoneReturnMultiParam lambda = (a, b) -&gt; System.out.println(<span class="string">&quot;ä¼ å…¥çš„å‚æ•°aä¸ºï¼š&quot;</span> + a + <span class="string">&quot;ï¼Œbä¸ºï¼š&quot;</span> + b + <span class="string">&quot;å’Œä¸ºï¼š&quot;</span> + (a + b));</span><br><span class="line">lambda.test(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222235042.png" alt="image-20210222235042067"></p><h3 id="4-6ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æœ‰è¿”å›æ¥å£"><a href="#4-6ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æœ‰è¿”å›æ¥å£" class="headerlink" title="4.6ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æœ‰è¿”å›æ¥å£"></a>4.6ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°æ— å‚æœ‰è¿”å›æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LambdaSingleReturnNoneParam lambda = () -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è¿™æ˜¯æ— å‚å¸¦è¿”å›å€¼æ¥å£çš„å®ç°&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(lambda.test());</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222235340.png" alt="image-20210222235340354"></p><h3 id="4-7ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•å‚æœ‰è¿”å›æ¥å£"><a href="#4-7ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•å‚æœ‰è¿”å›æ¥å£" class="headerlink" title="4.7ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•å‚æœ‰è¿”å›æ¥å£"></a>4.7ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å•å‚æœ‰è¿”å›æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LambdaSingleReturnSingleParam lambda = (a) -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è¿™æ˜¯å•å‚å¸¦è¿”å›å€¼æ¥å£çš„å®ç°ï¼Œä¼ å…¥çš„å‚æ•°ä¸ºï¼š&quot;</span> + a);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(<span class="string">&quot;å¾—åˆ°çš„è¿”å›å€¼ä¸ºï¼š&quot;</span> + lambda.test(<span class="number">3</span>));</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222235512.png" alt="image-20210222235512243"></p><h3 id="4-8ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šå‚æœ‰è¿”å›æ¥å£"><a href="#4-8ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šå‚æœ‰è¿”å›æ¥å£" class="headerlink" title="4.8ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šå‚æœ‰è¿”å›æ¥å£"></a>4.8ã€ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°å¤šå‚æœ‰è¿”å›æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LambdaSingleReturnMultiParam lambda = (a,b) -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è¿™æ˜¯å¤šå‚å¸¦è¿”å›å€¼æ¥å£çš„å®ç°ï¼Œä¼ å…¥çš„å‚æ•°å’Œä¸ºï¼š&quot;</span> + (a + b));</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(<span class="string">&quot;å¾—åˆ°çš„è¿”å›å€¼ä¸ºï¼š&quot;</span> + lambda.test(<span class="number">3</span>,<span class="number">5</span>));</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223000257.png" alt="image-20210223000257626"></p><h2 id="5ã€Lambdaè¯­æ³•ç²¾ç®€"><a href="#5ã€Lambdaè¯­æ³•ç²¾ç®€" class="headerlink" title="5ã€Lambdaè¯­æ³•ç²¾ç®€"></a>5ã€Lambdaè¯­æ³•ç²¾ç®€</h2><h3 id="5-1ã€å‚æ•°ç²¾ç®€"><a href="#5-1ã€å‚æ•°ç²¾ç®€" class="headerlink" title="5.1ã€å‚æ•°ç²¾ç®€"></a>5.1ã€å‚æ•°ç²¾ç®€</h3><blockquote><p>ç”±äºåœ¨æ¥å£çš„æŠ½è±¡æ–¹æ³•ä¸­ï¼Œå·²ç»å®šä¹‰äº†å‚æ•°çš„æ•°é‡å’Œç±»å‹ï¼Œæ‰€ä»¥åœ¨Lambdaè¡¨è¾¾å¼ä¸­ï¼Œå‚æ•°ç±»å‹å¯ä»¥çœç•¥ã€‚</p><p>å³ Lambda lambda = (String a,String b) -&gt; return (a + b);</p><p>å¯ä»¥ç®€å†™ä¸ºLambda lambda = (a,b) -&gt; return (a + b);</p></blockquote><ul><li>æ³¨æ„ï¼šå¦‚æœè¦çœç•¥å‚æ•°ç±»å‹ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªå‚æ•°çš„ç±»å‹éƒ½å¿…é¡»çœç•¥ã€‚</li></ul><h3 id="5-2ã€å°æ‹¬å·ç²¾ç®€"><a href="#5-2ã€å°æ‹¬å·ç²¾ç®€" class="headerlink" title="5.2ã€å°æ‹¬å·ç²¾ç®€"></a>5.2ã€å°æ‹¬å·ç²¾ç®€</h3><blockquote><p>å¦‚æœåœ¨å‚æ•°åˆ—è¡¨ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå°æ‹¬å·ä¹Ÿå¯ä»¥çœç•¥ä¸å†™</p><p>å³ Lambda lambda = (a) -&gt; System.out.println(a);</p><p>å¯ä»¥ç®€å†™ä¸ºï¼š Lambda lambda = a -&gt; System.out.println(a);</p></blockquote><h3 id="5-3ã€å¤§æ‹¬å·ç²¾ç®€"><a href="#5-3ã€å¤§æ‹¬å·ç²¾ç®€" class="headerlink" title="5.3ã€å¤§æ‹¬å·ç²¾ç®€"></a>5.3ã€å¤§æ‹¬å·ç²¾ç®€</h3><blockquote><p>å¦‚æœæ–¹æ³•ä½“ä¸­åªæœ‰ä¸€å¥ä»£ç ï¼Œé‚£ä¹ˆå¤§æ‹¬å·å¯ä»¥çœç•¥ä¸å†™</p><p>å³ Lambda lambda = (a) -&gt; {</p><p>â€‹    System.out.println(a);</p><p>};</p><p>å¯ä»¥ç®€å†™ä¸ºï¼š Lambda lambda = a -&gt; System.out.println(a);</p></blockquote><ul><li><p>æ³¨æ„ï¼šå¦‚æœæ–¹æ³•ä½“ä¸­å”¯ä¸€çš„ä¸€æ¡è¯­å¥æ˜¯ä¸€æ¡è¿”å›è¯­å¥ï¼Œé‚£ä¹ˆåœ¨çœç•¥å¤§æ‹¬å·çš„åŒæ—¶ï¼Œè¿˜éœ€è¦çœç•¥return</p></li><li><p>ä¾‹å¦‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LambdaSingleReturnMultiParam lambda = (a,b) -&gt; a + b;</span><br><span class="line">System.out.println(<span class="string">&quot;å¾—åˆ°çš„è¿”å›å€¼ä¸ºï¼š&quot;</span> + lambda.test(<span class="number">3</span>,<span class="number">5</span>));</span><br></pre></td></tr></table></figure><ul><li>ç»“æœä¸º</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223002012.png" alt="image-20210223002012212"></p><h2 id="6ã€Lambdaè¯­æ³•è¿›é˜¶"><a href="#6ã€Lambdaè¯­æ³•è¿›é˜¶" class="headerlink" title="6ã€Lambdaè¯­æ³•è¿›é˜¶"></a>6ã€Lambdaè¯­æ³•è¿›é˜¶</h2><h3 id="6-1ã€æ–¹æ³•å¼•ç”¨"><a href="#6-1ã€æ–¹æ³•å¼•ç”¨" class="headerlink" title="6.1ã€æ–¹æ³•å¼•ç”¨"></a>6.1ã€æ–¹æ³•å¼•ç”¨</h3><blockquote><p><strong>å¯ä»¥å¿«é€Ÿåœ°å°†ä¸€ä¸ªlambdaè¡¨è¾¾å¼çš„å®ç°æŒ‡å‘ä¸€ä¸ªå·²ç»å®ç°çš„æ–¹æ³•ã€‚</strong></p><p>è¯­æ³•ï¼šæ–¹æ³•çš„éš¶å±è€…::æ–¹æ³•å</p><p>ä¾‹å¦‚ï¼šä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè¦æ±‚è¿”å›ä¼ å…¥å‚æ•°çš„2å€</p></blockquote><ul><li>åŸæ¥çš„å†™æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LambdaSingleReturnSingleParam lambda = a -&gt; a * <span class="number">2</span>;</span><br><span class="line">System.out.println(lambda.test(<span class="number">2</span>));</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨æ–¹æ³•å¼•ç”¨ä¹‹åçš„å†™æ³•</p></blockquote><ul><li>å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ–¹æ³•ä½“å¯ä»¥æœ‰å¤šè¡Œä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;èŠœæ¹–èµ·é£&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨lambdaè¡¨è¾¾å¼çš„æ–¹æ³•ä½“ä¸­å¼•ç”¨ä¸Šé¢å†™çš„é™æ€æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">LambdaSingleReturnSingleParam lambda = a -&gt; change(<span class="number">2</span>);</span><br><span class="line">System.out.println(lambda.test(<span class="number">2</span>));</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223002908.png" alt="image-20210223002908069"></p><h3 id="6-2ã€ä½¿ç”¨-æ–¹æ³•éš¶å±è€…-æ–¹æ³•å-çš„æ–¹å¼å®ç°æ–¹æ³•å¼•ç”¨"><a href="#6-2ã€ä½¿ç”¨-æ–¹æ³•éš¶å±è€…-æ–¹æ³•å-çš„æ–¹å¼å®ç°æ–¹æ³•å¼•ç”¨" class="headerlink" title="6.2ã€ä½¿ç”¨ æ–¹æ³•éš¶å±è€…::æ–¹æ³•å çš„æ–¹å¼å®ç°æ–¹æ³•å¼•ç”¨"></a>6.2ã€ä½¿ç”¨ æ–¹æ³•éš¶å±è€…::æ–¹æ³•å çš„æ–¹å¼å®ç°æ–¹æ³•å¼•ç”¨</h3><blockquote><p>æ–¹æ³•éš¶å±è€…ï¼šå¦‚æœä¸€ä¸ªæ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆå…¶éš¶å±è€…å°±æ˜¯ç±»ï¼Œå¦‚æœä¸æ˜¯é™æ€æ–¹æ³•ï¼Œ é‚£ä¹ˆéš¶å±è€…å°±æ˜¯å¯¹è±¡ã€‚</p><p>æ ¹æ®æ–¹æ³•å¼•ç”¨çš„è¯­æ³•ï¼Œä¸Šé¢çš„æ–¹æ³•å¼•ç”¨å¯ä»¥æ”¹å†™ä¸º</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">LambdaSingleReturnSingleParam lambda = Syntax2::change;</span><br><span class="line">System.out.println(lambda.test(<span class="number">2</span>));</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ç‚¹ï¼š</p></blockquote><ul><li>è¢«å¼•ç”¨çš„æ–¹æ³•çš„å‚æ•°æ•°é‡å’Œç±»å‹ä¸€å®šè¦å’Œæ¥å£ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ä¸€è‡´ã€‚</li><li>è¿”å›å€¼çš„ç±»å‹ä¹Ÿä¸€å®šè¦å’Œæ¥å£ä¸­å®šä¹‰çš„ä¸€è‡´ã€‚</li></ul><h3 id="6-3ã€æ„é€ æ–¹æ³•å¼•ç”¨"><a href="#6-3ã€æ„é€ æ–¹æ³•å¼•ç”¨" class="headerlink" title="6.3ã€æ„é€ æ–¹æ³•å¼•ç”¨"></a>6.3ã€æ„é€ æ–¹æ³•å¼•ç”¨</h3><ul><li>æ–°å»ºä¸€ä¸ªç±»Person</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Personç±»çš„æ— å‚æ„é€ å‡½æ•°æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Personç±»çš„æœ‰å‚æ„é€ å‡½æ•°æ‰§è¡Œäº†...&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºç±»Syntax3ï¼Œåœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ªæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonCreater</span> </span>&#123;</span><br><span class="line">    <span class="function">Person <span class="title">getPerson</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ„é€ æ–¹æ³•å¼•ç”¨çš„åº”ç”¨åœºæ™¯ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿”å›äº†æŸä¸ªç±»çš„å¯¹è±¡</p><p>ä½¿ç”¨å…³é”®å­— <strong>new</strong> æ¥ä»£è¡¨æ„é€ å‡½æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PersonCreater creater2 = Person::<span class="keyword">new</span>;</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PersonCreater creater2 = Person::<span class="keyword">new</span>;</span><br><span class="line">creater2.getPerson();</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223004633.png" alt="image-20210223004633194"></p><blockquote><p>æ³¨æ„ï¼š<strong>æ„é€ å‡½æ•°çš„å‚æ•°ç”±æ¥å£ä¸­çš„å‚æ•°æ¥è‡ªå®šä¹‰</strong>ï¼Œå¦‚æœæ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•æ˜¯ä¸€ä¸ªæœ‰å‚çš„æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°ï¼Œå¦åˆ™åªèƒ½ä½¿ç”¨æ— å‚æ„é€ å‡½æ•°</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªPersonCreater2æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonCreater2</span> </span>&#123;</span><br><span class="line">    <span class="function">Person <span class="title">getPerson</span><span class="params">(String name,<span class="keyword">int</span> age)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¼•ç”¨æœ‰å‚æ„é€ å‡½æ•°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PersonCreater2 creater2 = Person::<span class="keyword">new</span>;</span><br><span class="line">Person person = creater2.getPerson(<span class="string">&quot;èŠœæ¹–&quot;</span>,<span class="number">18</span>);</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223005323.png" alt="image-20210223005323172"></p><blockquote><p>ç»“è®ºï¼š**ä¸ç®¡å¼•ç”¨çš„æ˜¯æœ‰å‚æ„é€ å‡½æ•°è¿˜æ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œåœ¨å¼•ç”¨çš„è¿‡ç¨‹ä¸­ä¸€å¾‹ä½¿ç”¨ æ–¹æ³•éš¶å±å::æ–¹æ³•å ** ï¼Œæœ‰å‚æ„é€ æ–¹æ³•çš„å‚æ•°åœ¨è°ƒç”¨æ¥å£æŠ½è±¡æ–¹æ³•æ—¶ä¼ é€’</p></blockquote><h2 id="7ã€Lambdaç»¼åˆæ¡ˆä¾‹"><a href="#7ã€Lambdaç»¼åˆæ¡ˆä¾‹" class="headerlink" title="7ã€Lambdaç»¼åˆæ¡ˆä¾‹"></a>7ã€Lambdaç»¼åˆæ¡ˆä¾‹</h2><h3 id="7-1ã€é›†åˆæ’åº"><a href="#7-1ã€é›†åˆæ’åº" class="headerlink" title="7.1ã€é›†åˆæ’åº"></a>7.1ã€é›†åˆæ’åº</h3><blockquote><p>å·²çŸ¥åœ¨ä¸€ä¸ªArrayListä¸­ï¼Œæœ‰è‹¥å¹²ä¸ªPersonå¯¹è±¡ï¼Œå°†è¿™äº›Personå¯¹è±¡æŒ‰ç…§<strong>å¹´é¾„</strong>è¿›è¡Œ<strong>é™åºæ’åº</strong>ã€‚</p><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°ArrayListå¯¹è±¡ä¸­çš„sortå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªComparatorå®ç°ç±»å¯¹è±¡ï¼ŒComparatoræ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223010154.png" alt="image-20210223010154107"></p><blockquote><p>Comparator ä¸­çš„ compareæ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223010612.png" alt="image-20210223010612662"></p><blockquote><p>é›†åˆæ’åºçš„ä»£ç å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Person&gt; persons = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;A&quot;</span>,<span class="number">10</span>));</span><br><span class="line">persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;B&quot;</span>,<span class="number">999</span>));</span><br><span class="line">persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;C&quot;</span>,<span class="number">7</span>));</span><br><span class="line">persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;D&quot;</span>,<span class="number">6</span>));</span><br><span class="line">persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;E&quot;</span>,<span class="number">14</span>));</span><br><span class="line">persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;F&quot;</span>,<span class="number">18</span>));</span><br><span class="line"><span class="comment">//é™åºè¦æ±‚</span></span><br><span class="line">persons.sort((p1,p2) -&gt; p2.age - p1.age);</span><br><span class="line">persons.stream().forEach(person -&gt; System.out.println(person));</span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºPersonæ·»åŠ ä¸€ä¸ªtoStringæ–¹æ³•ï¼Œæµ‹è¯•å¹¶æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223011055.png" alt="image-20210223011055014"></p><h3 id="7-2ã€TreeSet"><a href="#7-2ã€TreeSet" class="headerlink" title="7.2ã€TreeSet"></a>7.2ã€TreeSet</h3><blockquote><p>åˆ›å»ºä¸€ä¸ªTreeSetå¯¹è±¡ï¼Œå¾€å¯¹è±¡ä¸­æ·»åŠ å…ƒç´ </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TreeSet set = <span class="keyword">new</span> TreeSet();</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;A&quot;</span>,<span class="number">10</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;B&quot;</span>,<span class="number">999</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;C&quot;</span>,<span class="number">7</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;D&quot;</span>,<span class="number">6</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;E&quot;</span>,<span class="number">14</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;F&quot;</span>,<span class="number">18</span>));</span><br><span class="line">System.out.println(set);</span><br></pre></td></tr></table></figure><ul><li>è¿è¡ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223011530.png" alt="image-20210223011530846"></p><blockquote><p>è¿™æ˜¯å› ä¸ºTreeSetå¯¹è±¡å­˜å‚¨çš„å€¼æ˜¯æœ‰åºçš„ï¼Œè€Œå¯¹äºæˆ‘ä»¬ä¼ å…¥çš„æ³›å‹Personï¼ŒTreeSetä¸çŸ¥é“å¦‚ä½•ä½¿å…¶æœ‰åºï¼Œæ‰€ä»¥æŠ›å‡ºäº†ä¸€ä¸ªç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</p><p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿè§£å†³æ–¹æ³•æœ‰äºŒï¼š</p></blockquote><ul><li><p>è®©Personç±»å®ç° Comparator æ¥å£ï¼Œå¹¶å®ç°compareæ–¹æ³•</p></li><li><p>åœ¨æ„é€ TreeSetå¯¹è±¡æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªComparatorå®ç°å¯¹è±¡</p></li><li><p>TreeSetæ„é€ æ–¹æ³•å¦‚ä¸‹</p></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223011855.png" alt="image-20210223011854725"></p><blockquote><p>åœ¨æ„é€ TreeSetæ—¶ä¼ å…¥ä¸€ä¸ªComparatorå®ç°å¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TreeSet&lt;Person&gt; set = <span class="keyword">new</span> TreeSet&lt;Person&gt;((p1,p2) -&gt; p2.age - p1.age);</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;A&quot;</span>,<span class="number">10</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;B&quot;</span>,<span class="number">999</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;C&quot;</span>,<span class="number">7</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;D&quot;</span>,<span class="number">6</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;E&quot;</span>,<span class="number">14</span>));</span><br><span class="line">set.add(<span class="keyword">new</span> Person(<span class="string">&quot;F&quot;</span>,<span class="number">18</span>));</span><br><span class="line">set.stream().forEach(person -&gt; System.out.println(person));</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹æµ‹è¯•ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223012117.png" alt="image-20210223012117318"></p><h3 id="7-3ã€é›†åˆéå†"><a href="#7-3ã€é›†åˆéå†" class="headerlink" title="7.3ã€é›†åˆéå†"></a>7.3ã€é›†åˆéå†</h3><blockquote><p>ä½¿ç”¨ <strong>é›†åˆå¯¹è±¡.foreach</strong> æ–¹æ³•éå†é›†åˆï¼Œè¿™ä¸ªå¯¹è±¡éœ€è¦ä¼ å…¥ä¸€ä¸ªComsumeræ¥å£å®ç°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223012712.png" alt="image-20210223012712632"></p><blockquote><p>è€ŒComsumeråˆæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œacceptæ–¹æ³•çš„é€»è¾‘æ˜¯å°†é›†åˆä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯¼å…¥åˆ°æ–¹æ³•acceptä¸­ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223012744.png" alt="image-20210223012744761"></p><blockquote><p>éå†é›†åˆï¼Œè¾“å‡ºé›†åˆä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ </p><p>list.foreach(System.out::println);</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Collections.addAll(list,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">999</span>,<span class="number">4396</span>,<span class="number">7777</span>,<span class="number">2800</span>,<span class="number">999</span>,<span class="number">888</span>);</span><br><span class="line"><span class="comment">//éå†é›†åˆ</span></span><br><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223012951.png" alt="image-20210223012951109"></p><blockquote><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨éå†å…ƒç´ çš„è¿‡ç¨‹ä¸­æ·»åŠ ä¸€äº›è‡ªå·±çš„é€»è¾‘ä»£ç ï¼Œä¾‹å¦‚ï¼šéå†é›†åˆå¹¶è¾“å‡ºå…¶ä¸­çš„å¶æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">Collections.addAll(list,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">999</span>,<span class="number">4396</span>,<span class="number">7777</span>,<span class="number">2800</span>,<span class="number">999</span>,<span class="number">888</span>);</span><br><span class="line"><span class="comment">//éå†é›†åˆ</span></span><br><span class="line">list.forEach(ele -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ele % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(ele);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210223013135.png" alt="image-20210223013135333"></p><blockquote><p>ç»“è®ºï¼šåœ¨ä½¿ç”¨lambdaè¡¨è¾¾å¼è¿›è¡Œforeachå¾ªç¯çš„è¿‡ç¨‹ä¸­ï¼Œ-&gt; ç¬¦å·å‰çš„å˜é‡å°±æ˜¯æ¯æ¬¡å¾ªç¯æ—¶çš„å…ƒç´ ï¼Œè€Œ {} å°±æ˜¯æ‰§è¡Œçš„æ–¹æ³•ä½“ï¼Œå½“æ–¹æ³•ä½“åªæœ‰ä¸€è¡Œä»£ç æ—¶ï¼Œ{}å¯ä»¥çœç•¥ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring-Cloudå­¦ä¹ ï¼ˆå…­ï¼‰-Sentinel</title>
      <link href="posts/2120398077.html"/>
      <url>posts/2120398077.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€Sentinel"><a href="#ä¸€ã€Sentinel" class="headerlink" title="ä¸€ã€Sentinel"></a>ä¸€ã€Sentinel</h1><blockquote><p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µï¼Œç±»ä¼¼ä¹‹å‰å­¦çš„Hystrix</p></blockquote><h2 id="1-1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1ã€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1ã€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.1ã€æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote><p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p></blockquote><h2 id="1-2ã€ç‰¹å¾"><a href="#1-2ã€ç‰¹å¾" class="headerlink" title="1.2ã€ç‰¹å¾"></a>1.2ã€ç‰¹å¾</h2><p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p><ul><li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li><li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li><li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Dubboã€gRPC çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚</li><li><strong>å®Œå–„çš„ SPI æ‰©å±•ç‚¹</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li></ul><p>Sentinel çš„ä¸»è¦ç‰¹æ€§ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221121616.png" alt="image-20210221121615924"></p><h2 id="1-3ã€ç»„æˆéƒ¨åˆ†"><a href="#1-3ã€ç»„æˆéƒ¨åˆ†" class="headerlink" title="1.3ã€ç»„æˆéƒ¨åˆ†"></a>1.3ã€ç»„æˆéƒ¨åˆ†</h2><ul><li>æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚</li><li>æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚</li></ul><h2 id="1-4ã€ä¸Hystrixçš„å¯¹æ¯”"><a href="#1-4ã€ä¸Hystrixçš„å¯¹æ¯”" class="headerlink" title="1.4ã€ä¸Hystrixçš„å¯¹æ¯”"></a>1.4ã€ä¸Hystrixçš„å¯¹æ¯”</h2><h3 id="1ã€Hystrix"><a href="#1ã€Hystrix" class="headerlink" title="1ã€Hystrix"></a>1ã€Hystrix</h3><ul><li>éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ‰‹å·¥æ­å»ºç›‘æ§å¹³å°</li><li>æ²¡æœ‰ä¸€å¥—webç•Œé¢å¯ä»¥ç»™æˆ‘ä»¬è¿›è¡Œæ›´ç»†ç²’åº¦åŒ–çš„é…ç½®</li></ul><h3 id="2ã€Sentinel"><a href="#2ã€Sentinel" class="headerlink" title="2ã€Sentinel"></a>2ã€Sentinel</h3><ul><li>å•ç‹¬ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹å‡ºæ¥</li><li>ç›´æ¥ç•Œé¢åŒ–çš„ç»†ç²’åº¦ç»Ÿä¸€é…ç½®</li></ul><h1 id="äºŒã€å®‰è£…ä½¿ç”¨"><a href="#äºŒã€å®‰è£…ä½¿ç”¨" class="headerlink" title="äºŒã€å®‰è£…ä½¿ç”¨"></a>äºŒã€å®‰è£…ä½¿ç”¨</h1><h2 id="2-1ã€ä¸‹è½½sentinel"><a href="#2-1ã€ä¸‹è½½sentinel" class="headerlink" title="2.1ã€ä¸‹è½½sentinel"></a>2.1ã€ä¸‹è½½sentinel</h2><blockquote><p>åˆ° <a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a> ä¸‹è½½sentinelåˆ°æœ¬åœ°</p></blockquote><h2 id="2-2ã€è¿è¡Œ"><a href="#2-2ã€è¿è¡Œ" class="headerlink" title="2.2ã€è¿è¡Œ"></a>2.2ã€è¿è¡Œ</h2><h3 id="1ã€å‰æ"><a href="#1ã€å‰æ" class="headerlink" title="1ã€å‰æ"></a>1ã€å‰æ</h3><ul><li>JDK8ç¯å¢ƒå®‰è£…é…ç½®å®Œæˆ</li><li>8080ç«¯å£ä¸èƒ½è¢«å ç”¨</li></ul><h3 id="2ã€è¿è¡Œå‘½ä»¤"><a href="#2ã€è¿è¡Œå‘½ä»¤" class="headerlink" title="2ã€è¿è¡Œå‘½ä»¤"></a>2ã€è¿è¡Œå‘½ä»¤</h3><blockquote><p>åœ¨sentinel jaråŒ…ç›®å½•ä¸‹æ‰“å¼€cmdçª—å£ï¼Œè¾“å…¥</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar sentinel-dashboard-1.7.0.jar </span><br></pre></td></tr></table></figure><h3 id="3ã€è®¿é—®ç®¡ç†é¡µé¢"><a href="#3ã€è®¿é—®ç®¡ç†é¡µé¢" class="headerlink" title="3ã€è®¿é—®ç®¡ç†é¡µé¢"></a>3ã€è®¿é—®ç®¡ç†é¡µé¢</h3><blockquote><p>è®¿é—®<a href="http://localhost:8080ï¼Œè´¦å·å¯†ç å‡ä¸ºsentinel">http://localhost:8080ï¼Œè´¦å·å¯†ç å‡ä¸ºsentinel</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221140253.png" alt="image-20210221140252835"></p><h1 id="ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"><a href="#ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹" class="headerlink" title="ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹"></a>ä¸‰ã€åˆå§‹åŒ–æ¼”ç¤ºå·¥ç¨‹</h1><blockquote><p>å¯åŠ¨Nacos 8848</p></blockquote><h2 id="3-1ã€åˆ›å»ºSentinelå¾®æœåŠ¡æ¨¡å—"><a href="#3-1ã€åˆ›å»ºSentinelå¾®æœåŠ¡æ¨¡å—" class="headerlink" title="3.1ã€åˆ›å»ºSentinelå¾®æœåŠ¡æ¨¡å—"></a>3.1ã€åˆ›å»ºSentinelå¾®æœåŠ¡æ¨¡å—</h2><h3 id="1ã€å»ºmodule"><a href="#1ã€å»ºmodule" class="headerlink" title="1ã€å»ºmodule"></a>1ã€å»ºmodule</h3><blockquote><p>æ–°å»ºcloudalibaba-sentinel-service8401</p></blockquote><h3 id="2ã€POM"><a href="#2ã€POM" class="headerlink" title="2ã€POM"></a>2ã€POM</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-datasource-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€YML"><a href="#3ã€YML" class="headerlink" title="3ã€YML"></a>3ã€YML</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8401</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloudalibaba-sentinel-service</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment"># nacosæ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="comment"># é…ç½®sentinel dashboardåœ°å€</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="comment"># é»˜è®¤8719ç«¯å£ï¼Œå¦‚æœè¢«å ç”¨ä¼šè‡ªåŠ¨ä»8719å¼€å§‹ä¾æ¬¡+1æ‰«æ</span></span><br><span class="line">        <span class="comment"># ç›´åˆ°æ‰¾åˆ°æœªè¢«å ç”¨çš„ç«¯å£</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">        </span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="4ã€ä¸»å¯åŠ¨ç±»"><a href="#4ã€ä¸»å¯åŠ¨ç±»" class="headerlink" title="4ã€ä¸»å¯åŠ¨ç±»"></a>4ã€ä¸»å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApp8401</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MainApp8401.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€ä¸šåŠ¡ç±»"><a href="#5ã€ä¸šåŠ¡ç±»" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h3><blockquote><p>ä¸šåŠ¡ç±»FlowLimitController</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLimitController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€å¯åŠ¨sentinelå’Œ8401å¾®æœåŠ¡"><a href="#2ã€å¯åŠ¨sentinelå’Œ8401å¾®æœåŠ¡" class="headerlink" title="2ã€å¯åŠ¨sentinelå’Œ8401å¾®æœåŠ¡"></a>2ã€å¯åŠ¨sentinelå’Œ8401å¾®æœåŠ¡</h2><blockquote><p>å‘ç°sentinelæ§åˆ¶å°ä¸­ç©ºç©ºå¦‚ä¹Ÿ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221143519.png" alt="image-20210221143518461"></p><blockquote><p>è¿™æ˜¯ç”±äºsentinelå†…éƒ¨é‡‡ç”¨äº†æ‡’åŠ è½½ï¼Œéœ€è¦æˆ‘ä»¬è®¿é—®ä¸€æ¬¡8401å¾®æœåŠ¡ï¼Œè¿™ä¸ªå¾®æœåŠ¡æ‰ä¼šå±•ç°åœ¨sentinelæ§åˆ¶å°ä¸Šï¼Œè®¿é—® <a href="http://localhost:8401/testA">http://localhost:8401/testA</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221143651.png" alt="image-20210221143651616"></p><blockquote><p>è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°å¾®æœåŠ¡å·²ç»è¢«sentinelæ‰€ç›‘æ§</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221143717.png" alt="image-20210221143717393"></p><h1 id="å››ã€æµæ§ï¼ˆæµé‡æ§åˆ¶ï¼‰è§„åˆ™"><a href="#å››ã€æµæ§ï¼ˆæµé‡æ§åˆ¶ï¼‰è§„åˆ™" class="headerlink" title="å››ã€æµæ§ï¼ˆæµé‡æ§åˆ¶ï¼‰è§„åˆ™"></a>å››ã€æµæ§ï¼ˆæµé‡æ§åˆ¶ï¼‰è§„åˆ™</h1><h2 id="4-1ã€åŸºæœ¬ä»‹ç»"><a href="#4-1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="4.1ã€åŸºæœ¬ä»‹ç»"></a>4.1ã€åŸºæœ¬ä»‹ç»</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221145035.png" alt="img"></p><blockquote><p>è¿›ä¸€æ­¥è§£é‡Šè¯´æ˜</p></blockquote><ul><li>èµ„æºåï¼šå”¯ä¸€åç§°ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„</li><li>é’ˆå¯¹æ¥æºï¼šSentinelå¯ä»¥é’ˆå¯¹è°ƒç”¨è€…è¿›è¡Œé™æµï¼Œå¡«å†™å¾®æœåŠ¡åï¼Œé»˜è®¤defaultï¼ˆä¸åŒºåˆ†æ¥æºï¼‰</li><li>é˜ˆå€¼ç±»å‹/å•æœºé˜€å€¼ï¼š<ul><li>QPSï¼ˆæ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼‰ï¼šå½“è°ƒç”¨è¯¥apiçš„QPSè¾¾åˆ°é˜ˆå€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµã€‚</li><li>çº¿ç¨‹æ•°ï¼šå½“è°ƒç”¨è¯¥apiçš„çº¿ç¨‹æ•°è¾¾åˆ°é—½å€¼çš„æ—¶å€™ï¼Œè¿›è¡Œé™æµ</li></ul></li><li>æ˜¯å¦é›†ç¾¤ï¼šä¸éœ€è¦é›†ç¾¤</li><li>æµæ§æ¨¡å¼ï¼š<ul><li>ç›´æ¥ï¼šapiè¾¾åˆ°é™æµæ¡ä»¶æ—¶ç›´æ¥é™æµ</li><li>å…³è”ï¼šå½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ã€‚</li><li>é“¾è·¯ï¼šåªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼ˆæŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°±è¿›è¡Œé™æµï¼‰ã€APIçº§åˆ«çš„é’ˆå¯¹æ¥æºã€‘</li></ul></li><li>æ•ˆæœ<ul><li>å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥å¤±è´¥ï¼ŒæŠ›å¼‚å¸¸</li><li>Warm upï¼šæ ¹æ®codeFactorï¼ˆå†·åŠ è½½å› å­ï¼Œé»˜è®¤3ï¼‰çš„å€¼ï¼Œä»é˜ˆå€¼/codeFactorï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿ï¼Œæ‰è¾¾åˆ°è®¾ç½®çš„QPSé˜ˆå€¼</li><li>æ’é˜Ÿç­‰å¾…ï¼šåŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥åŒ€é€Ÿé€šè¿‡ï¼Œä¸å€¼ç±»å‹å¿…é¡»è®¾ç½®ä¸ºQPSï¼Œå¦åˆ™æ— æ•ˆã€‚</li></ul></li></ul><h2 id="4-2ã€æµæ§æ¨¡å¼"><a href="#4-2ã€æµæ§æ¨¡å¼" class="headerlink" title="4.2ã€æµæ§æ¨¡å¼"></a>4.2ã€æµæ§æ¨¡å¼</h2><h3 id="1ã€ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"><a href="#1ã€ç›´æ¥ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="1ã€ç›´æ¥ï¼ˆé»˜è®¤ï¼‰"></a>1ã€ç›´æ¥ï¼ˆé»˜è®¤ï¼‰</h3><blockquote><p>ç›´æ¥ï¼šapiè¾¾åˆ°é™æµæ¡ä»¶æ—¶ç›´æ¥é™æµ</p><p>é…ç½®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221151300.png" alt="img"></p><blockquote><p>åœ¨sentinelæ§åˆ¶å°ã€ç°‡ç‚¹é“¾è·¯ã€‘-ã€/testAã€‘ä¸­ï¼Œä¸º/testAèµ„æºæ·»åŠ æµæ§è§„åˆ™</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221150350.png" alt="image-20210221150350774"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221150517.png" alt="image-20210221150516941"></p><blockquote><p>æ­¤æ—¶/testAçš„æµæ§è§„åˆ™ä¸ºæ¯ç§’é’Ÿåªèƒ½ç‚¹1æ¬¡ï¼Œå¦‚æœè¶…è¿‡æ¬¡æ•°å°±ä¼šæŠ¥ã€flow limitingã€‘</p><p>æ­£å¸¸è®¿é—®ï¼Œä¸€ç§’é’Ÿç‚¹ä¸€æ¬¡çš„æƒ…å†µä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221150743.png" alt="image-20210221150743330"></p><blockquote><p>éæ­£å¸¸è®¿é—®æƒ…å†µä¸‹ï¼Œä¸€ç§’é’Ÿè®¿é—®å¤šæ¬¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221150814.png" alt="image-20210221150814186"></p><h3 id="2ã€å…³è”"><a href="#2ã€å…³è”" class="headerlink" title="2ã€å…³è”"></a>2ã€å…³è”</h3><blockquote><p>å…³è”ï¼šå½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ã€‚</p><p>å‡è®¾Controllerä¸­æœ‰ä¸¤ä¸ªèµ„æºABï¼Œå½“ä¸Aå…³è”çš„èµ„æºBè¾¾åˆ°é˜ˆå€¼åï¼Œå°±é™æµAè‡ªå·±ã€‚</p><p>é…ç½®</p><p>å½“Bçš„QPSè¾¾åˆ°1ï¼ˆå³Bä¸€ç§’å†…è¢«è®¿é—®å¤šæ¬¡ï¼‰æ—¶ï¼Œé™æµA</p><p>ä¾‹å¦‚æ”¯ä»˜æ¥å£è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œé™æµä¸‹è®¢å•æ¥å£</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221153406.png" alt="image-20210221153406525"></p><blockquote><p>ä½¿ç”¨POSTMAN æ¨¡æ‹Ÿå¹¶å‘å¯†é›†è®¿é—®testB</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221154556.png" alt="image-20210221154555941"></p><blockquote><p>ä½¿ç”¨postmanå‘é€è¯·æ±‚åè®¿é—®/testAï¼Œæ­¤æ—¶/testAæŒ‚äº†</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221154811.png" alt="image-20210221154811947"></p><h3 id="3ã€é“¾è·¯"><a href="#3ã€é“¾è·¯" class="headerlink" title="3ã€é“¾è·¯"></a>3ã€é“¾è·¯</h3><blockquote><p>å¤šä¸ªè¯·æ±‚è°ƒç”¨äº†åŒä¸€ä¸ªå¾®æœåŠ¡</p></blockquote><h2 id="4-3ã€æµæ§æ•ˆæœ"><a href="#4-3ã€æµæ§æ•ˆæœ" class="headerlink" title="4.3ã€æµæ§æ•ˆæœ"></a>4.3ã€æµæ§æ•ˆæœ</h2><h3 id="1ã€ç›´æ¥-gt-å¿«é€Ÿå¤±è´¥"><a href="#1ã€ç›´æ¥-gt-å¿«é€Ÿå¤±è´¥" class="headerlink" title="1ã€ç›´æ¥-&gt;å¿«é€Ÿå¤±è´¥"></a>1ã€ç›´æ¥-&gt;å¿«é€Ÿå¤±è´¥</h3><blockquote><p>ç›´æ¥å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼šã€Blocked by Sentinelã€‘ï¼ˆflow limitingï¼‰</p></blockquote><h3 id="2ã€é¢„çƒ­"><a href="#2ã€é¢„çƒ­" class="headerlink" title="2ã€é¢„çƒ­"></a>2ã€é¢„çƒ­</h3><blockquote><p>è¯´æ˜ï¼šå…¬å¼ï¼šé˜ˆå€¼é™¤ä»¥coldFactorï¼ˆé»˜è®¤å€¼ä¸º3ï¼‰ï¼Œç»è¿‡é¢„çƒ­æ—¶é•¿åæ‰ä¼šè¾¾åˆ°é˜ˆå€¼</p></blockquote><ul><li>æ¦‚è¿°</li></ul><blockquote><p>å½“æµé‡çªç„¶å¢å¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šå¸Œæœ›ç³»ç»Ÿä»ç©ºé—²çŠ¶æ€åˆ°ç¹å¿™çŠ¶æ€çš„åˆ‡æ¢çš„æ—¶é—´é•¿ä¸€äº›ã€‚å³å¦‚æœç³»ç»Ÿåœ¨æ­¤ä¹‹å‰é•¿æœŸå¤„äºç©ºé—²çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›å¤„ç†è¯·æ±‚çš„æ•°é‡æ˜¯ç¼“æ­¥çš„å¢å¤šï¼Œç»è¿‡é¢„æœŸçš„æ—¶é—´ä»¥åï¼Œåˆ°è¾¾ç³»ç»Ÿå¤„ç†è¯·æ±‚ä¸ªæ•°çš„æœ€å¤§å€¼ã€‚Warm Upï¼ˆå†·å¯åŠ¨ï¼Œé¢„çƒ­ï¼‰æ¨¡å¼å°±æ˜¯ä¸ºäº†å®ç°è¿™ä¸ªç›®çš„çš„ã€‚</p><p>è¿™ä¸ªåœºæ™¯ä¸»è¦ç”¨äºå¯åŠ¨éœ€è¦é¢å¤–å¼€é”€çš„åœºæ™¯ï¼Œä¾‹å¦‚å»ºç«‹æ•°æ®åº“è¿æ¥ç­‰ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221164221.png" alt="image-20210221164220167"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221164649.png" alt="image-20210221164649046"></p><blockquote><p>ä¸ºèµ„æº/testBæ–°å¢ä¸€ä¸ªæµæ§è§„åˆ™</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221164820.png" alt="image-20210221164820127"></p><blockquote><p>åœ¨ä¸€æ®µæ—¶é—´å†…å¿«é€Ÿè®¿é—®/testBï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°ï¼Œèµ„æº/testBè¢«é™æµ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221165340.png" alt="image-20210221165340581"></p><blockquote><p>5såå†è®¿é—®/testBï¼Œå‘ç°å·²ç»å¯ä»¥æ…¢æ…¢æ‰¿å—çš„ä½è¯·æ±‚</p><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>ç§’æ€ç³»ç»Ÿå†å¼€å¯çš„ç¬é—´ä¼šæœ‰å¾ˆå¤šæµé‡ç›´æ¥æ¶Œä¸Šæ¥ï¼Œå¾ˆå¯èƒ½ç›´æ¥æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯ä»¥æ…¢æ…¢æŠŠæµé‡æ”¾è¿›æ¥ï¼Œæ…¢æ…¢åœ°æŠŠé˜ˆå€¼å¢é•¿åˆ°è®¾ç½®çš„é˜ˆå€¼ã€‚</li></ul></blockquote><h3 id="3ã€æ’é˜Ÿç­‰å¾…"><a href="#3ã€æ’é˜Ÿç­‰å¾…" class="headerlink" title="3ã€æ’é˜Ÿç­‰å¾…"></a>3ã€æ’é˜Ÿç­‰å¾…</h3><blockquote><p>åŒ€é€Ÿæ’é˜Ÿï¼Œé˜ˆå€¼å¿…é¡»è®¾ç½®ä¸ºQPS</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221170241.png" alt="img"></p><blockquote><p>è¿™ç§æ–¹å¼ä¸»è¦ç”¨äºå¤„ç†é—´éš”æ€§çªå‘çš„æµé‡ï¼Œä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€‚æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„åœºæ™¯ï¼Œæœ‰æŸä¸€ç§’å†…æœ‰å¤§é‡è¯·æ±‚åˆ°æ¥ï¼Œè€Œæ¥ä¸‹æ¥çš„å‡ ç§’åˆ™å¤„äºç©ºé—²çŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿèƒ½å¤Ÿåœ¨æ¥ä¸‹æ¥çš„ç©ºé—²æœŸé—´é€æ¸å¤„ç†è¿™äº›è¯·æ±‚ï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸€ç§’ç›´æ¥æ‹’ç»å¤šä½™çš„è¯·æ±‚ã€‚</p></blockquote><ul><li>ä¿®æ”¹èµ„æº/testBçš„æµæ§æ•ˆæœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221170612.png" alt="image-20210221170612528"></p><blockquote><p>ä¿®æ”¹ä¸šåŠ¡ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLimitController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testA&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testB&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;testB...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;------testB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨POSTMANè¿›è¡Œæµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221171142.png" alt="image-20210221171142702"></p><blockquote><p>å¯åŠ¨ï¼ŒæŸ¥çœ‹ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ¯ä¸ªä¸€ç§’æœ‰ä¸€ä¸ªè¯·æ±‚æ’é˜Ÿè¿‡æ¥è®¿é—®/testB</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221171637.png" alt="image-20210221171637049"></p><h2 id="4-4ã€é™çº§è§„åˆ™"><a href="#4-4ã€é™çº§è§„åˆ™" class="headerlink" title="4.4ã€é™çº§è§„åˆ™"></a>4.4ã€é™çº§è§„åˆ™</h2><h3 id="1ã€é™çº§è§„åˆ™è¯´æ˜"><a href="#1ã€é™çº§è§„åˆ™è¯´æ˜" class="headerlink" title="1ã€é™çº§è§„åˆ™è¯´æ˜"></a>1ã€é™çº§è§„åˆ™è¯´æ˜</h3><blockquote><p>åœ¨sentinelæ§åˆ¶å°ã€é™çº§è§„åˆ™ã€‘ä¸­ç‚¹å‡»ã€æ–°å¢é™çº§è§„åˆ™ã€‘</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221172312.png" alt="image-20210221172311770"></p><blockquote><p>é…ç½®é™çº§è§„åˆ™å‚æ•°ï¼Œå…¶ä¸­</p><ul><li>RTï¼šå¹³å‡å“åº”æ—¶é—´ï¼Œç§’çº§<ul><li>å¹³å‡å“åº”æ—¶é—´ <strong>è¶…å‡ºé˜ˆå€¼</strong> ä¸” <strong>åœ¨æ—¶é—´çª—å£å†…é€šè¿‡çš„è¯·æ±‚&gt;=5</strong>ï¼Œä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³åè§¦å‘é™çº§ï¼Œçª—å£æœŸè¿‡åå…³é—­æ–­è·¯å™¨</li><li>RTæœ€å¤§ä¸º4900ï¼Œæ›´å¤§çš„éœ€è¦é€šè¿‡ <strong>-Dcsp.sentinel.statistic.max.rt=XXXX</strong> æ‰èƒ½ç”Ÿæ•ˆ</li></ul></li><li>å¼‚å¸¸æ¯”ä¾‹ï¼Œç§’çº§<ul><li>QPS &gt;= 5 ä¸”å¼‚å¸¸æ¯”ä¾‹ï¼ˆç§’çº§ç»Ÿè®¡ï¼‰è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘é™çº§ï¼›æ—¶é—´çª—å£ç»“æŸåï¼Œå…³é—­é™çº§</li></ul></li><li>å¼‚å¸¸æ•°ï¼Œåˆ†é’Ÿçº§<ul><li>å¼‚å¸¸æ•°ï¼ˆåˆ†é’Ÿç»Ÿè®¡ï¼‰è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘é™çº§ï¼›æ—¶é—´çª—å£ç»“æŸåï¼Œå…³é—­é™çº§</li></ul></li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221172755.png" alt="image-20210221172755551"></p><h3 id="2ã€è¿›ä¸€æ­¥è¯´æ˜"><a href="#2ã€è¿›ä¸€æ­¥è¯´æ˜" class="headerlink" title="2ã€è¿›ä¸€æ­¥è¯´æ˜"></a>2ã€è¿›ä¸€æ­¥è¯´æ˜</h3><blockquote><p>Sentinel ç†”æ–­é™çº§ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–è€…å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±æ•ˆï¼Œé¿å…å½±å“åˆ°å…¶ä»–çš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚</p><p>å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ—¶æŠ›å‡ºDegradeExceptionï¼‰</p><p><strong>Sentinelçš„æ–­è·¯å™¨ä¸­æ²¡æœ‰åŠå¼€çŠ¶æ€</strong></p></blockquote><h3 id="3ã€RT"><a href="#3ã€RT" class="headerlink" title="3ã€RT"></a>3ã€RT</h3><ul><li>å¹³å‡å“åº”æ—¶é—´ï¼ˆDEGRADE_GRADE_RTï¼‰ï¼šå½“1så†…æŒç»­è¿›å…¥5ä¸ªè¯·æ±‚ï¼Œå¯¹åº”æ—¶åˆ»çš„<strong>å¹³å‡å“åº”æ—¶é—´</strong>ï¼ˆç§’çº§ï¼‰å‡è¶…è¿‡é˜ˆå€¼ï¼ˆcountï¼Œä»¥msä¸ºå•ä½ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ï¼ˆDegradeRuleä¸­çš„timewindow,ä»¥sä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°ç†”æ–­ï¼ˆæŠ›å‡ºDegradeException)ã€‚æ³¨æ„Sentinelé»˜è®¤ç»Ÿè®¡çš„RTä¸Šé™æ˜¯4900msï¼Œè¶…å‡ºæ­¤é˜€å€¼çš„éƒ½ä¼šç®—ä½œ4900msï¼Œè‹¥éœ€è¦å˜æ›´æ­¤ä¸Šé™å¯ä»¥é€šè¿‡å¯åŠ¨é…ç½®é¡¹-Dcsp.sentinel.statistic.max.rt-xxxæ¥é…ç½®ã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221174427.png" alt="img"></p><blockquote><p>ä¿®æ”¹ä¸šåŠ¡ç±»ä»£ç ï¼Œæ·»åŠ æ–¹æ³•å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testD</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123; TimeUnit.SECONDS.sleep(<span class="number">1</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; e.printStackTrace(); &#125;</span><br><span class="line">    log.info(<span class="string">&quot;testD æµ‹è¯•RT&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testD&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®ï¼Œæ–°å¢é™çº§è§„åˆ™</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221175223.png" alt="image-20210221175222781"></p><blockquote><p>ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221175305.png" alt="image-20210221175305530"></p><blockquote><p>å¯åŠ¨JMeteråè®¿é—®/testDï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221175557.png" alt="image-20210221175557472"></p><blockquote><p>ç»“è®ºï¼šæŒ‰ç…§ä¸Šè¿°é…ç½®ï¼Œæ°¸è¿œä¸€ç§’é’Ÿæ‰“è¿›æ¥10ä¸ªçº¿ç¨‹ï¼ˆå¤§äº5ä¸ªï¼‰è°ƒç”¨testDï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›è¯·æ±‚çš„å¹³å‡å“åº”æ—¶é—´æ˜¯200msï¼Œå¦‚æœå¹³å‡å“åº”æ—¶é—´è¶…è¿‡200msï¼Œåœ¨æœªæ¥çš„ä¸€ç§’é’Ÿå†…ï¼Œæ–­è·¯å™¨æ‰“å¼€ï¼Œä¿é™©ä¸è·³é—¸ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ã€‚</p><p>åç»­åœæ­¢jmeterï¼Œæ²¡æœ‰é‚£ä¹ˆå¤§çš„è®¿é—®é‡åï¼Œæ–­è·¯å™¨å…³é—­ï¼Œå¾®æœåŠ¡æ¢å¤ã€‚</p></blockquote><h3 id="4ã€å¼‚å¸¸æ¯”ä¾‹"><a href="#4ã€å¼‚å¸¸æ¯”ä¾‹" class="headerlink" title="4ã€å¼‚å¸¸æ¯”ä¾‹"></a>4ã€å¼‚å¸¸æ¯”ä¾‹</h3><ul><li>å¼‚å¸¸æ¯”ä¾‹ï¼šå½“èµ„æºçš„æ¯ç§’è®¿é—®é‡ &gt;= 5ï¼Œä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡æ¯”ä¾‹è¶…è¿‡é˜ˆå€¼ä¹‹åï¼Œèµ„æºè¿›å…¥é™çº§çŠ¶æ€ï¼Œå³åœ¨æ¥ä¸‹æ¥çš„æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ï¼Œå¼‚å¸¸æ¯”ä¾‹çš„é˜ˆå€¼èŒƒå›´ä¸º[0.0,1.0]ï¼Œä»£è¡¨0%-100%</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221180654.png" alt="img"></p><blockquote><p>ä¿®æ”¹ä¸šåŠ¡ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testD&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testD</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;testD å¼‚å¸¸æ¯”ä¾‹&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testD&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®ï¼Œè®¾ç½®å¼‚å¸¸æ¯”ä¾‹ä¸º20%</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221181748.png" alt="image-20210221181748353"></p><blockquote><p>ä½¿ç”¨JMeterè¿›è¡Œå‹æµ‹ï¼Œç„¶åå†æ¬¡è®¿é—®/testDï¼ŒæŸ¥çœ‹ç»“æœ</p><p>æ­¤æ—¶èµ„æº/testDæŒ‚äº†</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221181850.png" alt="image-20210221181850537"></p><blockquote><p>å…³é—­jmeterï¼Œåœ¨æ—¶é—´çª—å£æœŸç»“æŸåå†æ¬¡è®¿é—®/testDï¼Œç›´æ¥è¿”å›é”™è¯¯é¡µé¢</p><p><strong>ç”±äºè¿™æ¬¡è¯·æ±‚ä¸­è¯·æ±‚æ•°å°äº5ï¼Œæ‰€ä»¥æ²¡æœ‰æœåŠ¡é™çº§ã€‚</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221181956.png" alt="image-20210221181956643"></p><blockquote><p>ç»“è®º</p></blockquote><ul><li>å•ç‹¬è®¿é—®ä¸€æ¬¡ï¼Œå¿…ç„¶æ¥ä¸€æ¬¡æŠ¥é”™ä¸€æ¬¡ï¼ˆint age = 10 / 0ï¼‰ï¼Œè°ƒä¸€æ¬¡é”™ä¸€æ¬¡</li><li>å¼€å¯JMeteråï¼Œç›´æ¥é«˜å¹¶å‘å‘é€è¯·æ±‚ï¼Œå¤šæ¬¡è°ƒç”¨è¾¾åˆ°æˆ‘ä»¬çš„é…ç½®æ¡ä»¶äº†ï¼Œæ–­è·¯å™¨å¼€å¯ï¼Œå¾®æœåŠ¡ä¸å¯ç”¨ï¼Œæ­¤æ—¶ä¸å†æŠ¥errorè€Œæ˜¯æœåŠ¡é™çº§ã€‚</li></ul><h3 id="5ã€å¼‚å¸¸æ•°"><a href="#5ã€å¼‚å¸¸æ•°" class="headerlink" title="5ã€å¼‚å¸¸æ•°"></a>5ã€å¼‚å¸¸æ•°</h3><ul><li>å¼‚å¸¸æ•°ï¼šå½“èµ„æºè¿‘ä¸€åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­ã€‚æ³¨æ„ï¼Œç”±äºç»Ÿè®¡æ—¶é—´çª—å£æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œè‹¥æ—¶é—´çª—å£å°äº60sï¼Œåˆ™ç»“æŸç†”æ–­åä»å¯èƒ½å†æ¬¡è¿›å…¥ç†”æ–­çŠ¶æ€ã€‚</li><li>æ—¶é—´çª—å£ä¸€å®šè¦å¤§äºç­‰äº60sã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221191750.png" alt="img"></p><blockquote><p>åœ¨ä¸šåŠ¡ç±»ä¸­æ·»åŠ æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testE&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testE</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;testE æµ‹è¯•å¼‚å¸¸æ•°&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testE æµ‹è¯•å¼‚å¸¸æ•°&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ§åˆ¶å°ä¸­ç»™/testEæ·»åŠ é™çº§è§„åˆ™</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221195517.png" alt="image-20210221195516085"></p><blockquote><p>çŸ­æ—¶é—´å†…è¿ç»­è®¿é—®5æ¬¡<a href="http://localhost:8401/testE">http://localhost:8401/testE</a> ï¼Œç„¶åå†æ¬¡è®¿é—®/testEï¼ŒæŸ¥çœ‹ç»“æœ</p><ul><li>å‰é¢äº”æ¬¡ï¼Œè¿”å›çš„æ˜¯Error Page</li><li>ç¬¬å…­æ¬¡è®¿é—®è¿”å›é™çº§æç¤ºã€‚</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221195655.png" alt="image-20210221195655293"></p><h1 id="äº”ã€çƒ­ç‚¹keyé™æµ"><a href="#äº”ã€çƒ­ç‚¹keyé™æµ" class="headerlink" title="äº”ã€çƒ­ç‚¹keyé™æµ"></a>äº”ã€çƒ­ç‚¹keyé™æµ</h1><h2 id="5-1ã€åŸºæœ¬ä»‹ç»"><a href="#5-1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="5.1ã€åŸºæœ¬ä»‹ç»"></a>5.1ã€åŸºæœ¬ä»‹ç»</h2><p>ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š</p><ul><li>å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li><li>ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li></ul><p>çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚</p><blockquote><p>æ ¹æ®è¯·æ±‚å¸¦çš„æŸäº›å‚æ•°è¿›è¡Œé™æµ</p></blockquote><h2 id="5-2ã€é…ç½®çƒ­ç‚¹é™æµ"><a href="#5-2ã€é…ç½®çƒ­ç‚¹é™æµ" class="headerlink" title="5.2ã€é…ç½®çƒ­ç‚¹é™æµ"></a>5.2ã€é…ç½®çƒ­ç‚¹é™æµ</h2><h3 id="1ã€å¤ä¹ hystrix"><a href="#1ã€å¤ä¹ hystrix" class="headerlink" title="1ã€å¤ä¹ hystrix"></a>1ã€å¤ä¹ hystrix</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221212226.png" alt="img"></p><h3 id="2ã€åœ¨ä¸šåŠ¡ç±»ä¸­æ·»åŠ ä»£ç "><a href="#2ã€åœ¨ä¸šåŠ¡ç±»ä¸­æ·»åŠ ä»£ç " class="headerlink" title="2ã€åœ¨ä¸šåŠ¡ç±»ä¸­æ·»åŠ ä»£ç "></a>2ã€åœ¨ä¸šåŠ¡ç±»ä¸­æ·»åŠ ä»£ç </h3><ul><li>è¿™é‡Œ@SentinelResourceæ³¨è§£çš„valueå±æ€§è¦æ±‚å”¯ä¸€ï¼Œä¸€èˆ¬ä¸è¯·æ±‚Mappingç›¸åŒï¼Œå°†æ¥åœ¨sentinelæ§åˆ¶å°æ·»åŠ çƒ­ç‚¹keyé™æµæ—¶å¯ä»¥ç”¨@SentinelResourceæ³¨è§£çš„valueä½œä¸ºèµ„æºåã€‚</li><li>@SentinelResourceæ³¨è§£çš„blockHandlerå±æ€§ç”¨äºæŒ‡å®šå…œåº•æ–¹æ³•ï¼Œéœ€è¦åœ¨å…œåº•æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªBlockExceptionç±»å‹çš„å‚æ•°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testHotkey&quot;,blockHandler = &quot;deal_testHotKey&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testHotKey</span><span class="params">(<span class="meta">@RequestParam(value = &quot;p1&quot;,required = false)</span> String p1,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@RequestParam(value = &quot;p2&quot;,required = false)</span> String p2)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//int age = 10/0;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKey&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deal_testHotKey</span> <span class="params">(String p1, String p2, BlockException exception)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------deal_testHotKey,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€åœ¨sentinelæ§åˆ¶å°ä¸­æ·»åŠ çƒ­ç‚¹è§„åˆ™"><a href="#3ã€åœ¨sentinelæ§åˆ¶å°ä¸­æ·»åŠ çƒ­ç‚¹è§„åˆ™" class="headerlink" title="3ã€åœ¨sentinelæ§åˆ¶å°ä¸­æ·»åŠ çƒ­ç‚¹è§„åˆ™"></a>3ã€åœ¨sentinelæ§åˆ¶å°ä¸­æ·»åŠ çƒ­ç‚¹è§„åˆ™</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221214652.png" alt="image-20210221214650652"></p><h3 id="4ã€åœ¨æ§åˆ¶å°ä¸­æ·»åŠ é…ç½®"><a href="#4ã€åœ¨æ§åˆ¶å°ä¸­æ·»åŠ é…ç½®" class="headerlink" title="4ã€åœ¨æ§åˆ¶å°ä¸­æ·»åŠ é…ç½®"></a>4ã€åœ¨æ§åˆ¶å°ä¸­æ·»åŠ é…ç½®</h3><blockquote><p>æ·»åŠ çš„é…ç½®å¦‚ä¸‹</p><p>ä¸‹é¢çš„é…ç½®è¡¨ç¤ºï¼šå¯¹äº/testHotkeyè¯·æ±‚ï¼Œå¦‚æœå¸¦p1å‚æ•°è®¿é—®ï¼Œé‚£ä¹ˆä¸€ç§’é’Ÿæœ€å¤šè®¿é—®ä¸€æ¬¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221214920.png" alt="image-20210221214920044"></p><h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><blockquote><p>åœ¨ä¸€ç§’é’Ÿå†…å¤šæ¬¡è®¿é—®<a href="http://localhost:8401/testHotkey?p1=a">http://localhost:8401/testHotkey?p1=a</a> </p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221215443.png" alt="image-20210221215443934"></p><h3 id="6ã€ç»“è®º"><a href="#6ã€ç»“è®º" class="headerlink" title="6ã€ç»“è®º"></a>6ã€ç»“è®º</h3><blockquote><p>æ–¹æ³•testHotKeyé‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°åªè¦QPSè¶…è¿‡1æ¬¡/sï¼Œé‚£ä¹ˆç›´æ¥åšé™çº§å¤„ç†ï¼ŒåŒæ—¶è°ƒç”¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å…œåº•æ–¹æ³•ã€‚</p><p>å¦‚æœè¯·æ±‚å‚æ•°ä¸­ä¸å«æœ‰p1å‚æ•°ï¼Œé‚£ä¹ˆå¦‚ä½•è®¿é—®éƒ½ä¸ä¼šæœ‰é—®é¢˜ã€‚</p><p>å¦‚æœåœ¨@SentinelResourceæ³¨è§£ä¸­ä¸æŒ‡å®šblockHandlerå±æ€§ï¼Œé‚£ä¹ˆä¼šç›´æ¥å°†é”™è¯¯é¡µé¢è¿”å›åˆ°å‰å°ï¼Œååˆ†ä¸å‹å¥½ã€‚</p></blockquote><h3 id="7ã€è¡¥å……"><a href="#7ã€è¡¥å……" class="headerlink" title="7ã€è¡¥å……"></a>7ã€è¡¥å……</h3><blockquote><p>ä¿®æ”¹ä¸šåŠ¡ç±»ï¼Œåœ¨testHotkeyæ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œé‡å¯æµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testHotKey&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;testHotkey&quot;,blockHandler = &quot;deal_testHotKey&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testHotKey</span><span class="params">(<span class="meta">@RequestParam(value = &quot;p1&quot;,required = false)</span> String p1,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@RequestParam(value = &quot;p2&quot;,required = false)</span> String p2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">10</span>/<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testHotKey&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">deal_testHotKey</span> <span class="params">(String p1, String p2, BlockException exception)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------deal_testHotKey,o(â•¥ï¹â•¥)o&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœï¼šç›´æ¥è¿”å›äº†Error page</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221223928.png" alt="image-20210221223927546"></p><blockquote><p>è¿™è¡¨æ˜ï¼š@SentinelResouceåªè´Ÿè´£sentinelæ§åˆ¶å°å‡ºçš„é”™ï¼Œä¸è´Ÿè´£ç¨‹åºæœ¬èº«è¿è¡Œæ—¶å¼‚å¸¸ã€‚</p></blockquote><h2 id="5-3ã€å‚æ•°ä¾‹å¤–é¡¹"><a href="#5-3ã€å‚æ•°ä¾‹å¤–é¡¹" class="headerlink" title="5.3ã€å‚æ•°ä¾‹å¤–é¡¹"></a>5.3ã€å‚æ•°ä¾‹å¤–é¡¹</h2><blockquote><p>ä¸Šè¿°æ¡ˆä¾‹æ¼”ç¤ºäº†ç¬¬ä¸€ä¸ªå‚æ•°p1ï¼Œå½“QPSè¶…è¿‡1sä¸€æ¬¡ç‚¹å‡»åé©¬ä¸Šè¢«é™æµã€‚</p></blockquote><h3 id="1ã€é…ç½®"><a href="#1ã€é…ç½®" class="headerlink" title="1ã€é…ç½®"></a>1ã€é…ç½®</h3><blockquote><p>æ™®é€šæƒ…å†µä¸‹ï¼šå½“p1çš„QPSè¾¾åˆ°1æ¬¡1sæ—¶é©¬ä¸Šè¢«é™æµ</p><p>æˆ‘ä»¬å¸Œæœ›p1å‚æ•°æ˜¯æŸä¸ªç‰¹æ®Šå€¼æ—¶ï¼Œä»–çš„é™æµå€¼å’Œå¹³æ—¶ä¸ä¸€æ ·ã€‚</p></blockquote><ul><li>ç»™p1è®¾ç½®ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ŒåŠ å…¥å½“p1çš„å€¼ä¸º5æ—¶ï¼Œä»–çš„é˜ˆå€¼å¯ä»¥è¾¾åˆ°200</li><li>ä¿®æ”¹é…ç½®</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221222425.png" alt="image-20210221222425693"></p><blockquote><p>æµ‹è¯•ï¼šåœ¨ä¸€ç§’å†…å¤šæ¬¡è®¿é—®<a href="http://localhost:8401/testHotkey?p1=3">http://localhost:8401/testHotkey?p1=3</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221222553.png" alt="image-20210221222553598"></p><blockquote><p>æµ‹è¯•ï¼šåœ¨ä¸€ç§’å†…å¤šæ¬¡è®¿é—®<a href="http://localhost:8401/testHotkey?p1=5">http://localhost:8401/testHotkey?p1=5</a></p><p>æ­¤æ—¶ç”±äºé…ç½®äº†å‚æ•°ä¾‹å¤–é¡¹ï¼Œæ‰€ä»¥åœ¨ä¸€ç§’å†…å¤šæ¬¡è®¿é—®ä¹Ÿä¸ä¼šé™çº§ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221222652.png" alt="image-20210221222652243"></p><h3 id="2ã€å‰æè¯´æ˜"><a href="#2ã€å‰æè¯´æ˜" class="headerlink" title="2ã€å‰æè¯´æ˜"></a>2ã€å‰æè¯´æ˜</h3><blockquote><p>çƒ­ç‚¹å‚æ•°çš„æ³¨æ„ç‚¹ï¼Œå‚æ•°å¿…é¡»æ˜¯<strong>åŸºæœ¬ç±»å‹</strong>æˆ–è€…<strong>String</strong></p></blockquote><h1 id="å…­ã€ç³»ç»Ÿè§„åˆ™"><a href="#å…­ã€ç³»ç»Ÿè§„åˆ™" class="headerlink" title="å…­ã€ç³»ç»Ÿè§„åˆ™"></a>å…­ã€ç³»ç»Ÿè§„åˆ™</h1><h2 id="6-1ã€ä»‹ç»"><a href="#6-1ã€ä»‹ç»" class="headerlink" title="6.1ã€ä»‹ç»"></a>6.1ã€ä»‹ç»</h2><blockquote><p>Sentinel ç³»ç»Ÿè‡ªé€‚åº”é™æµä»<strong>æ•´ä½“ç»´åº¦</strong>å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚</p><p>åœ¨ç³»ç»Ÿå±‚é¢å¯¹è¿›å…¥çš„æµé‡è¿›è¡Œæ§åˆ¶ã€‚</p></blockquote><h2 id="6-2ã€æ–°å¢ç³»ç»Ÿè§„åˆ™"><a href="#6-2ã€æ–°å¢ç³»ç»Ÿè§„åˆ™" class="headerlink" title="6.2ã€æ–°å¢ç³»ç»Ÿè§„åˆ™"></a>6.2ã€æ–°å¢ç³»ç»Ÿè§„åˆ™</h2><blockquote><p>åœ¨sentinelæ§åˆ¶å°ä¸­é€‰æ‹©ã€ç³»ç»Ÿè§„åˆ™ã€‘-ã€æ–°å¢ç³»ç»Ÿè§„åˆ™ã€‘</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221225151.png" alt="image-20210221225151304"></p><blockquote><p>æ·»åŠ é…ç½®é¡µé¢åŠæ¨¡å¼è¯´æ˜å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221225306.png" alt="image-20210221225306468"></p><ul><li><strong>Load è‡ªé€‚åº”</strong>ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ <code>maxQps * minRt</code> ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ <code>CPU cores * 2.5</code>ã€‚</li><li><strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li><li><strong>å¹³å‡ RT</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li><li><strong>å¹¶å‘çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li><li><strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li></ul><blockquote><p>æ·»åŠ ç³»ç»Ÿè§„åˆ™ï¼Œè®¾ç½®å…¥å£QPSé˜ˆå€¼ä¸º1</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221225529.png" alt="image-20210221225529528"></p><blockquote><p>åœ¨ä¸šåŠ¡ç±»ä¸­æ–°å¢æ–¹æ³•å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testC&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    log.info(Thread.currentThread().getName() + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;testB...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;------testC&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯å¾®æœåŠ¡ï¼Œåœ¨ä¸€ç§’å†…å¤šæ¬¡è®¿é—®<a href="http://localhost:8401/testC">http://localhost:8401/testC</a> ï¼ŒæŸ¥çœ‹ç»“æœï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°æ²¡æœ‰åœ¨æµæ§è§„åˆ™ä¸­é…ç½®è¿‡çš„testCä¹Ÿè¢«é™æµäº†</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221230134.png" alt="image-20210221230134803"></p><h1 id="ä¸ƒã€-SentinelResource"><a href="#ä¸ƒã€-SentinelResource" class="headerlink" title="ä¸ƒã€@SentinelResource"></a>ä¸ƒã€@SentinelResource</h1><h2 id="7-1ã€æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†"><a href="#7-1ã€æŒ‰èµ„æºåç§°é™æµ-åç»­å¤„ç†" class="headerlink" title="7.1ã€æŒ‰èµ„æºåç§°é™æµ + åç»­å¤„ç†"></a>7.1ã€æŒ‰èµ„æºåç§°é™æµ + åç»­å¤„ç†</h2><h3 id="1ã€å¯åŠ¨Nacoså’ŒSentinel"><a href="#1ã€å¯åŠ¨Nacoså’ŒSentinel" class="headerlink" title="1ã€å¯åŠ¨Nacoså’ŒSentinel"></a>1ã€å¯åŠ¨Nacoså’ŒSentinel</h3><h3 id="2ã€ä¿®æ”¹8401å¾®æœåŠ¡"><a href="#2ã€ä¿®æ”¹8401å¾®æœåŠ¡" class="headerlink" title="2ã€ä¿®æ”¹8401å¾®æœåŠ¡"></a>2ã€ä¿®æ”¹8401å¾®æœåŠ¡</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªRateLimitControllerä¸šåŠ¡ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RateLimitController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/byResource&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;byResource&quot;, blockHandler = &quot;handleException&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">byResource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;æŒ‰èµ„æºåç§°é™æµæµ‹è¯•OK&quot;</span>, <span class="keyword">new</span> Payment(<span class="number">2020L</span>, <span class="string">&quot;serial001&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">handleException</span><span class="params">(BlockException exception)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>, exception.getClass().getCanonicalName() + <span class="string">&quot;\t æœåŠ¡ä¸å¯ç”¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‡æ–°å¯åŠ¨ï¼Œæµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221234008.png" alt="image-20210221234008117"></p><h3 id="3ã€æŒ‰èµ„æºåè¿›è¡Œé™æµ"><a href="#3ã€æŒ‰èµ„æºåè¿›è¡Œé™æµ" class="headerlink" title="3ã€æŒ‰èµ„æºåè¿›è¡Œé™æµ"></a>3ã€æŒ‰èµ„æºåè¿›è¡Œé™æµ</h3><blockquote><p>åœ¨sentinelæ§åˆ¶å°ä¸­ç‚¹å‡»ã€ç°‡ç‚¹é“¾è·¯ã€‘ï¼Œå…¶ä¸­byResouceå°±æ˜¯èµ„æºåç§°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221234150.png" alt="image-20210221234150402"></p><blockquote><p>åœ¨ã€ç°‡ç‚¹é“¾è·¯ã€‘-ã€byResourceã€‘ä¸€è¡Œä¸­ç‚¹å‡»ã€æµæ§ã€‘ï¼Œæ·»åŠ é…ç½®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221234835.png" alt="image-20210221234835362"></p><blockquote><p>æµ‹è¯•ï¼Œåœ¨çŸ­æ—¶é—´å†…å¤šæ¬¡è®¿é—®<a href="http://localhost:8401/byResource">http://localhost:8401/byResource</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221235142.png" alt="image-20210221235142379"></p><h3 id="4ã€é¢å¤–é—®é¢˜"><a href="#4ã€é¢å¤–é—®é¢˜" class="headerlink" title="4ã€é¢å¤–é—®é¢˜"></a>4ã€é¢å¤–é—®é¢˜</h3><blockquote><p>æ­¤æ—¶å…³é—­8401å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹Sentinelæ§åˆ¶å°ï¼Œå¯ä»¥å‘ç°æµæ§è§„åˆ™æ¶ˆå¤±äº†</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221235400.png" alt="image-20210221235400848"></p><ul><li>æµæ§è§„åˆ™æ˜¯<strong>ä¸´æ—¶</strong>çš„</li></ul><h2 id="7-2ã€æŒ‰ç…§Urlåœ°å€é™æµ-åç»­å¤„ç†"><a href="#7-2ã€æŒ‰ç…§Urlåœ°å€é™æµ-åç»­å¤„ç†" class="headerlink" title="7.2ã€æŒ‰ç…§Urlåœ°å€é™æµ + åç»­å¤„ç†"></a>7.2ã€æŒ‰ç…§Urlåœ°å€é™æµ + åç»­å¤„ç†</h2><blockquote><p>é€šè¿‡è®¿é—®çš„URLæ¥é™æµï¼Œä¼šè¿”å›Sentinelè‡ªå¸¦é»˜è®¤çš„é™æµå¤„ç†ä¿¡æ¯ã€‚</p></blockquote><h3 id="1ã€ä¿®æ”¹RateLimitController"><a href="#1ã€ä¿®æ”¹RateLimitController" class="headerlink" title="1ã€ä¿®æ”¹RateLimitController"></a>1ã€ä¿®æ”¹RateLimitController</h3><blockquote><p>æ–°å¢ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡æœ‰è‡ªå®šä¹‰çš„å…œåº•æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/byUrl&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;byUrl&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult <span class="title">byUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;æŒ‰urlé™æµæµ‹è¯•OK&quot;</span>,<span class="keyword">new</span> Payment(<span class="number">2020L</span>,<span class="string">&quot;serial002&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€è®¿é—®æ–°å¢çš„æ–¹æ³•"><a href="#2ã€è®¿é—®æ–°å¢çš„æ–¹æ³•" class="headerlink" title="2ã€è®¿é—®æ–°å¢çš„æ–¹æ³•"></a>2ã€è®¿é—®æ–°å¢çš„æ–¹æ³•</h3><blockquote><p>è®¿é—® <a href="http://localhost:8401/rateLimit/byUrl">http://localhost:8401/rateLimit/byUrl</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210221235934.png" alt="image-20210221235934057"></p><h3 id="3ã€åœ¨Sentinelæ§åˆ¶å°è¿›è¡Œé…ç½®"><a href="#3ã€åœ¨Sentinelæ§åˆ¶å°è¿›è¡Œé…ç½®" class="headerlink" title="3ã€åœ¨Sentinelæ§åˆ¶å°è¿›è¡Œé…ç½®"></a>3ã€åœ¨Sentinelæ§åˆ¶å°è¿›è¡Œé…ç½®</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222000127.png" alt="image-20210222000127076"></p><h3 id="4ã€æµ‹è¯•"><a href="#4ã€æµ‹è¯•" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h3><blockquote><p>åœ¨ä¸€ç§’å†…å¤šæ¬¡è®¿é—® <a href="http://localhost:8401/rateLimit/byUrl">http://localhost:8401/rateLimit/byUrl</a> ï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222000301.png" alt="image-20210222000301562"></p><blockquote><p>å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæ²¡æœ‰è‡ªå®šä¹‰å…œåº•æ–¹æ³•ï¼Œå°±ç›´æ¥ç”¨sentinelè‡ªå¸¦çš„å…œåº•æ–¹æ³•</p></blockquote><h2 id="7-3ã€ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜"><a href="#7-3ã€ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜" class="headerlink" title="7.3ã€ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜"></a>7.3ã€ä¸Šé¢å…œåº•æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜</h2><ul><li>ç³»ç»Ÿé»˜è®¤çš„ï¼Œæ²¡æœ‰ä½“ç°æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚</li><li>ä¾ç…§ç°æœ‰æ¡ä»¶ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„å¤„ç†æ–¹æ³•åˆå’Œä¸šåŠ¡ä»£ç è€¦åˆåœ¨ä¸€å—ï¼Œä¸ç›´è§‚</li><li>æ¯ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•éƒ½æœ‰è‡ªå·±çš„å…œåº•æ–¹æ³•ï¼Œä»£ç è†¨èƒ€åŠ å‰§</li><li>å…¨å±€ç»Ÿä¸€çš„å¤„ç†æ–¹æ³•æ²¡æœ‰ä½“ç°ã€‚</li></ul><h2 id="7-4ã€å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"><a href="#7-4ã€å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘" class="headerlink" title="7.4ã€å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘"></a>7.4ã€å®¢æˆ·è‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</h2><h3 id="1ã€åˆ›å»ºCustomerBlockerHandlerç±»"><a href="#1ã€åˆ›å»ºCustomerBlockerHandlerç±»" class="headerlink" title="1ã€åˆ›å»ºCustomerBlockerHandlerç±»"></a>1ã€åˆ›å»ºCustomerBlockerHandlerç±»</h3><blockquote><p>è¿™ä¸ªç±»ç”¨äºè‡ªå®šä¹‰é™æµå¤„ç†é€»è¾‘</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerBlockerHandler</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title">handlerException</span> <span class="params">(BlockException blockException)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">7777</span>,<span class="string">&quot;å®¢æˆ·è‡ªå®šä¹‰ï¼Œglobal handlerException ------------1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CommonResult <span class="title">handlerException2</span> <span class="params">(BlockException blockException)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">7777</span>,<span class="string">&quot;å®¢æˆ·è‡ªå®šä¹‰ï¼Œglobal handlerException ------------2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹ä¸šåŠ¡ç±»"><a href="#2ã€ä¿®æ”¹ä¸šåŠ¡ç±»" class="headerlink" title="2ã€ä¿®æ”¹ä¸šåŠ¡ç±»"></a>2ã€ä¿®æ”¹ä¸šåŠ¡ç±»</h3><blockquote><p>æ·»åŠ æ–¹æ³•å¦‚ä¸‹ï¼Œ@SentinleResourceå‚æ•°ä¸­</p><ul><li>valueæŒ‡å®šèµ„æºå</li><li>blockHandlerClassæŒ‡å®šé™æµå¤„ç†ç±»</li><li>blockHandleræŒ‡å®šé™æµå¤„ç†ç±»ä¸­çš„é™æµå¤„ç†æ–¹æ³•</li></ul><p>å³customerBlockerHandleræ–¹æ³•çš„é™æµå¤„ç†ä¸šåŠ¡ç”±<strong>CustomerBlockerHandlerç±»</strong>ä¸­çš„<strong>handlerException2æ–¹æ³•</strong>å¤„ç†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/rateLimit/customerBlockerHandler&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(</span></span><br><span class="line"><span class="meta">    value = &quot;customerBlockerHandler&quot;,</span></span><br><span class="line"><span class="meta">    blockHandlerClass = CustomerBlockerHandler.class,</span></span><br><span class="line"><span class="meta">    blockHandler = &quot;handlerException2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult <span class="title">customerBlockerHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">200</span>,<span class="string">&quot;å®¢æˆ·è‡ªå®šä¹‰å¤„ç†ç±»&quot;</span>,<span class="keyword">new</span> Payment(<span class="number">2020L</span>,<span class="string">&quot;serial002&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€é‡å¯æœåŠ¡ï¼Œæµ‹è¯•æ–°æ–¹æ³•ï¼Œæ·»åŠ æµæ§è§„åˆ™"><a href="#3ã€é‡å¯æœåŠ¡ï¼Œæµ‹è¯•æ–°æ–¹æ³•ï¼Œæ·»åŠ æµæ§è§„åˆ™" class="headerlink" title="3ã€é‡å¯æœåŠ¡ï¼Œæµ‹è¯•æ–°æ–¹æ³•ï¼Œæ·»åŠ æµæ§è§„åˆ™"></a>3ã€é‡å¯æœåŠ¡ï¼Œæµ‹è¯•æ–°æ–¹æ³•ï¼Œæ·»åŠ æµæ§è§„åˆ™</h3><blockquote><p>è®¿é—®<a href="http://localhost/rateLimit/customerBlockerHandler">http://localhost/rateLimit/customerBlockerHandler</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222002549.png" alt="image-20210222002549684"></p><blockquote><p>ä¸ºcustomerBlockerHandleræ–¹æ³•æ·»åŠ æµæ§è§„åˆ™</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222002539.png" alt="image-20210222002538578"></p><h3 id="4ã€æµ‹è¯•æˆ‘ä»¬è‡ªå®šä¹‰çš„é™æµå¤„ç†ä¸šåŠ¡ç±»"><a href="#4ã€æµ‹è¯•æˆ‘ä»¬è‡ªå®šä¹‰çš„é™æµå¤„ç†ä¸šåŠ¡ç±»" class="headerlink" title="4ã€æµ‹è¯•æˆ‘ä»¬è‡ªå®šä¹‰çš„é™æµå¤„ç†ä¸šåŠ¡ç±»"></a>4ã€æµ‹è¯•æˆ‘ä»¬è‡ªå®šä¹‰çš„é™æµå¤„ç†ä¸šåŠ¡ç±»</h3><blockquote><p>åœ¨ä¸€ç§’é’Ÿå†…è¿ç»­è®¿é—® <a href="http://localhost/rateLimit/customerBlockerHandler">http://localhost/rateLimit/customerBlockerHandler</a> æŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222002732.png" alt="image-20210222002732531"></p><h3 id="5ã€Controlleræ–¹æ³•ä¸è‡ªå®šä¹‰é™æµä¸šåŠ¡å¤„ç†æ–¹æ³•å¯¹äºå…³ç³»"><a href="#5ã€Controlleræ–¹æ³•ä¸è‡ªå®šä¹‰é™æµä¸šåŠ¡å¤„ç†æ–¹æ³•å¯¹äºå…³ç³»" class="headerlink" title="5ã€Controlleræ–¹æ³•ä¸è‡ªå®šä¹‰é™æµä¸šåŠ¡å¤„ç†æ–¹æ³•å¯¹äºå…³ç³»"></a>5ã€Controlleræ–¹æ³•ä¸è‡ªå®šä¹‰é™æµä¸šåŠ¡å¤„ç†æ–¹æ³•å¯¹äºå…³ç³»</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222002830.png" alt="image-20210222002830021"></p><h1 id="å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½"><a href="#å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½" class="headerlink" title="å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½"></a>å…«ã€æœåŠ¡ç†”æ–­åŠŸèƒ½</h1><blockquote><p>sentinelæ•´åˆ<strong>ribbon</strong> + <strong>openFeign</strong> + <strong>fallback</strong></p></blockquote><h2 id="8-1ã€sentinelæ•´åˆRibbon"><a href="#8-1ã€sentinelæ•´åˆRibbon" class="headerlink" title="8.1ã€sentinelæ•´åˆRibbon"></a>8.1ã€sentinelæ•´åˆRibbon</h2><blockquote><p>ç¨‹åºæ¶æ„å›¾å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222104755.png" alt="image-20210222104747783"></p><h3 id="1ã€åˆ›å»ºæœåŠ¡æä¾›è€…9003"><a href="#1ã€åˆ›å»ºæœåŠ¡æä¾›è€…9003" class="headerlink" title="1ã€åˆ›å»ºæœåŠ¡æä¾›è€…9003"></a>1ã€åˆ›å»ºæœåŠ¡æä¾›è€…9003</h3><blockquote><p>åˆ›å»ºå¾®æœåŠ¡æ¨¡å— ã€cloudalibaba-provider-payment9003ã€‘</p></blockquote><ul><li>pom</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>yml</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9003</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>ä¸»å¯åŠ¨ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain9003</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9003.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸šåŠ¡ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;Long, Payment&gt; hashMap = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        hashMap.put(<span class="number">1L</span>, <span class="keyword">new</span> Payment(<span class="number">1L</span>, <span class="string">&quot;28a8c1e3bc2742d8848569891fb42181&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">2L</span>, <span class="keyword">new</span> Payment(<span class="number">2L</span>, <span class="string">&quot;bba8c1e3bc2742d8848569891ac32182&quot;</span>));</span><br><span class="line">        hashMap.put(<span class="number">3L</span>, <span class="keyword">new</span> Payment(<span class="number">3L</span>, <span class="string">&quot;6ua8c1e3bc2742d8848569891xt92183&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        Payment payment = hashMap.get(id);</span><br><span class="line">        CommonResult&lt;Payment&gt; result = <span class="keyword">new</span> CommonResult(<span class="number">200</span>, <span class="string">&quot;from mysql,serverPort:  &quot;</span> + serverPort, payment);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><blockquote><p>å¯åŠ¨9003ï¼Œè®¿é—® <a href="http://localhost:9003/paymentSQL/1">http://localhost:9003/paymentSQL/1</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222113152.png" alt="image-20210222113152026"></p><h3 id="2ã€æ ¹æ®9003åˆ›å»ºæœåŠ¡æä¾›è€…9004"><a href="#2ã€æ ¹æ®9003åˆ›å»ºæœåŠ¡æä¾›è€…9004" class="headerlink" title="2ã€æ ¹æ®9003åˆ›å»ºæœåŠ¡æä¾›è€…9004"></a>2ã€æ ¹æ®9003åˆ›å»ºæœåŠ¡æä¾›è€…9004</h3><h3 id="3ã€åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…84"><a href="#3ã€åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…84" class="headerlink" title="3ã€åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…84"></a>3ã€åˆ›å»ºæœåŠ¡æ¶ˆè´¹è€…84</h3><ul><li>pom</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>ymlé…ç½®æ–‡ä»¶</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">84</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-comsumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8080</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8179</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><ul><li>ä¸»å¯åŠ¨ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderNacosMain84</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderNacosMain84.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ApplicationContextConfig</li></ul><blockquote><p>å¾€Spring å®¹å™¨ä¸­æ³¨å…¥ä¸€ä¸ªRestTemplateå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€84å¾®æœåŠ¡ä¸­çš„ä¸šåŠ¡ç±»"><a href="#4ã€84å¾®æœåŠ¡ä¸­çš„ä¸šåŠ¡ç±»" class="headerlink" title="4ã€84å¾®æœåŠ¡ä¸­çš„ä¸šåŠ¡ç±»"></a>4ã€84å¾®æœåŠ¡ä¸­çš„ä¸šåŠ¡ç±»</h3><blockquote><p>CircleBreakerControllerçš„å…¨éƒ¨ä»£ç </p><ul><li>å…¶ä¸­fallbackç®¡javaè¿è¡Œæ—¶å¼‚å¸¸</li><li>blockHandlerç®¡sentinelè¿è§„å¼‚å¸¸</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleBreakerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SERVICE_URL = <span class="string">&quot;http://nacos-payment-provider&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/consumer/fallback/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="comment">//@SentinelResource(value = &quot;fallback&quot;) //æ²¡æœ‰é…ç½®</span></span><br><span class="line"><span class="comment">//@SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;) //fallbackåªè´Ÿè´£ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment">//@SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;) //blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„</span></span><br><span class="line">    <span class="comment">//@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handlerFallback&quot;, blockHandler = &quot;blockHandler&quot;,</span></span><br><span class="line">            exceptionsToIgnore = &#123;IllegalArgumentException.class&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">fallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> </span>&#123;</span><br><span class="line">        CommonResult&lt;Payment &gt; result = restTemplate.getForObject(SERVICE_URL + <span class="string">&quot;/paymentSQL/&quot;</span> + id, CommonResult.class, id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (id == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;IllegalArgumentException,éæ³•å‚æ•°å¼‚å¸¸....&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result.getData() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;NullPointerException,è¯¥IDæ²¡æœ‰å¯¹åº”è®°å½•,ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//fallback</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">handlerFallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Throwable e)</span> </span>&#123;</span><br><span class="line">        Payment payment = <span class="keyword">new</span> Payment(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>, <span class="string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span> + e.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//blockHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult <span class="title">blockHandler</span><span class="params">(<span class="meta">@PathVariable</span> Long id, BlockException blockException)</span> </span>&#123;</span><br><span class="line">        Payment payment = <span class="keyword">new</span> Payment(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  &quot;</span> + blockException.getMessage(), payment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨9003ã€9004ã€84å¾®æœåŠ¡ï¼Œè¾“å…¥æµ‹è¯•åœ°å€ï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><blockquote><p>æµ‹è¯•åœ°å€ï¼š<a href="http://localhost:84/consumer/fallback/1">http://localhost:84/consumer/fallback/1</a></p><p>å®ç°äº†è´Ÿè½½å‡è¡¡å’Œå¾®æœåŠ¡è°ƒç”¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222121549.png" alt="image-20210222121547497"></p><h3 id="5ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»ä¸åšä»»ä½•é…ç½®çš„æƒ…å†µä¸‹"><a href="#5ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»ä¸åšä»»ä½•é…ç½®çš„æƒ…å†µä¸‹" class="headerlink" title="5ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»ä¸åšä»»ä½•é…ç½®çš„æƒ…å†µä¸‹"></a>5ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»ä¸åšä»»ä½•é…ç½®çš„æƒ…å†µä¸‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;)</span> <span class="comment">//æ²¡æœ‰é…ç½®</span></span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶è®¿é—® <a href="http://localhost:84/consumer/fallback/4">http://localhost:84/consumer/fallback/4</a> ï¼Œé‚£ä¹ˆä¼šæŠ¥éæ³•å‚æ•°å¼‚å¸¸ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªé”™è¯¯é¡µé¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222122142.png" alt="image-20210222122142619"></p><blockquote><p>æ­¤æ—¶å¦‚æœè®¿é—®  <a href="http://localhost:84/consumer/fallback/5">http://localhost:84/consumer/fallback/5</a> ï¼Œé‚£ä¹ˆæ±‡æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä¹Ÿæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªé”™è¯¯é¡µé¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222122258.png" alt="image-20210222122258779"></p><h3 id="6ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®fallback"><a href="#6ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®fallback" class="headerlink" title="6ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®fallback"></a>6ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®fallback</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fallbackåªè´Ÿè´£ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;,fallback = &quot;handlerFallback&quot;)</span> </span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶è®¿é—® <a href="http://localhost:84/consumer/fallback/4">http://localhost:84/consumer/fallback/4</a> ï¼Œé‚£ä¹ˆä¼šæŠ¥éæ³•å‚æ•°å¼‚å¸¸ï¼Œæ­¤æ—¶è°ƒç”¨fallbacké…ç½®çš„å…œåº•æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fallback</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult <span class="title">handlerFallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Throwable e)</span> </span>&#123;</span><br><span class="line">    Payment payment = <span class="keyword">new</span> Payment(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>, <span class="string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span> + e.getMessage(), payment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222123003.png" alt="image-20210222123003397"></p><blockquote><p>æ­¤æ—¶è®¿é—® <a href="http://localhost:84/consumer/fallback/5">http://localhost:84/consumer/fallback/5</a> ï¼Œé‚£ä¹ˆä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ­¤æ—¶è°ƒç”¨fallbacké…ç½®çš„å…œåº•æ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222123246.png" alt="image-20210222123246739"></p><h3 id="7ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®blockHandler"><a href="#7ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®blockHandler" class="headerlink" title="7ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®blockHandler"></a>7ã€84å¾®æœåŠ¡ä¸šåŠ¡ç±»åªé…ç½®blockHandler</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//blockHandleråªè´Ÿè´£sentinelæ§åˆ¶å°é…ç½®è¿è§„</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;,blockHandler = &quot;blockHandler&quot;)</span> </span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶blockHandleré…ç½®çš„å…œåº•æ–¹æ³•åªç®¡sentinelæ§åˆ¶å°è¿è§„é…ç½®ï¼Œä¸ç®¡javaç¨‹åºè¿è¡Œæ—¶å¼‚å¸¸é”™è¯¯ã€‚</p><p>æ­¤æ—¶è®¿é—®<a href="http://localhost:84/consumer/fallback/5">http://localhost:84/consumer/fallback/5</a> ï¼Œç”±äºè¾“å…¥çš„idä¸åˆæ³•ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›é”™è¯¯é¡µé¢</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222124841.png" alt="image-20210222124841012"></p><blockquote><p>åœ¨sentinelä¸­æ–°å¢ä¸€ä¸ªé™çº§è§„åˆ™</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222125259.png" alt="image-20210222125258965"></p><blockquote><p>åœ¨çŸ­æ—¶é—´å†…è¿ç»­è®¿é—®ä¸¤æ¬¡ <a href="http://localhost:84/consumer/fallback/4">http://localhost:84/consumer/fallback/4</a> åï¼Œç”±äºè§¦çŠ¯äº†sentinelé…ç½®çš„é™çº§è§„åˆ™ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•è¢«é™çº§ï¼Œè°ƒç”¨äº†blockHandleré…ç½®çš„é™çº§æ–¹æ³•ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222125359.png" alt="image-20210222125359108"></p><h3 id="8ã€84å¾®æœåŠ¡fallbackå’ŒblockHandleréƒ½é…ç½®"><a href="#8ã€84å¾®æœåŠ¡fallbackå’ŒblockHandleréƒ½é…ç½®" class="headerlink" title="8ã€84å¾®æœåŠ¡fallbackå’ŒblockHandleréƒ½é…ç½®"></a>8ã€84å¾®æœåŠ¡fallbackå’ŒblockHandleréƒ½é…ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handlerFallback&quot;, blockHandler = &quot;blockHandler&quot;)</span></span><br></pre></td></tr></table></figure><blockquote><p>fallbackå’ŒblockHandlerå¯¹åº”çš„å…œåº•æ–¹æ³•å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fallback</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult <span class="title">handlerFallback</span><span class="params">(<span class="meta">@PathVariable</span> Long id, Throwable e)</span> </span>&#123;</span><br><span class="line">    Payment payment = <span class="keyword">new</span> Payment(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">444</span>, <span class="string">&quot;å…œåº•å¼‚å¸¸handlerFallback,exceptionå†…å®¹  &quot;</span> + e.getMessage(), payment);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//blockHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult <span class="title">blockHandler</span><span class="params">(<span class="meta">@PathVariable</span> Long id, BlockException blockException)</span> </span>&#123;</span><br><span class="line">    Payment payment = <span class="keyword">new</span> Payment(id, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">445</span>, <span class="string">&quot;blockHandler-sentinelé™æµ,æ— æ­¤æµæ°´: blockException  &quot;</span> + blockException.getMessage(), payment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨sentinelæ§åˆ¶å°ä¸­ä¸ºèµ„æºfallbackæ–°å¢ä¸€ä¸ªæµæ§è§„åˆ™</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222130542.png" alt="image-20210222130541531"></p><blockquote><p>åœ¨çŸ­æ—¶é—´å†…å¤šæ¬¡è®¿é—® <a href="http://localhost:84/consumer/fallback/1">http://localhost:84/consumer/fallback/1</a> ï¼Œè¿åsentinelçš„æµæ§è§„åˆ™ï¼Œè§¦å‘blockHandlerä¸­é…ç½®çš„å…œåº•æ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222130711.png" alt="image-20210222130711708"></p><blockquote><p>è®¿é—® <a href="http://localhost:84/consumer/fallback/4">http://localhost:84/consumer/fallback/4</a> ï¼Œè§¦å‘fallbackä¸­é…ç½®çš„å…œåº•æ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222130912.png" alt="image-20210222130912853"></p><blockquote><p>å¦‚æœåœ¨çŸ­æ—¶é—´å†…å¤šæ¬¡è®¿é—® <a href="http://localhost:84/consumer/fallback/4">http://localhost:84/consumer/fallback/4</a> ï¼Œæ—¢æŠ¥å¼‚å¸¸åˆè¿åsentinelçš„é™æµè§„åˆ™ï¼Œæ­¤æ—¶å½’blockHandleré…ç½®çš„å…œåº•æ–¹æ³•ç®¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222131141.png" alt="image-20210222131140908"></p><h3 id="9ã€ç»“è®º"><a href="#9ã€ç»“è®º" class="headerlink" title="9ã€ç»“è®º"></a>9ã€ç»“è®º</h3><blockquote><p>è‹¥ <strong>blockHandler</strong> å’Œ <strong>fallback</strong> éƒ½è¿›è¡Œäº†é…ç½®ï¼Œåˆ™è¢«<strong>é™æµé™çº§</strong>è€ŒæŠ›å‡º <strong>BlockException **æ—¶åªä¼šè¿›å…¥ **blockHandler å¤„ç†é€»è¾‘ã€‚</strong></p></blockquote><h3 id="10ã€å¼‚å¸¸å¿½ç•¥å±æ€§"><a href="#10ã€å¼‚å¸¸å¿½ç•¥å±æ€§" class="headerlink" title="10ã€å¼‚å¸¸å¿½ç•¥å±æ€§"></a>10ã€å¼‚å¸¸å¿½ç•¥å±æ€§</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222132107.png" alt="image-20210222132107534"></p><blockquote><p>åœ¨ä¸šåŠ¡ç±»ä¸­æ·»åŠ é…ç½®å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SentinelResource(value = &quot;fallback&quot;, fallback = &quot;handlerFallback&quot;, blockHandler = &quot;blockHandler&quot;, exceptionsToIgnore = &#123;IllegalArgumentException.class&#125;)</span></span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶å†æ¬¡è®¿é—® <a href="http://localhost:84/consumer/fallback/4">http://localhost:84/consumer/fallback/4</a> </p><p>ç”±äºIllegalArgumentExceptionå¼‚å¸¸è¢«å¿½ç•¥ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›äº†error page</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222132208.png" alt="image-20210222132208156"></p><h2 id="8-2ã€sentinelæ•´åˆOpenFeign"><a href="#8-2ã€sentinelæ•´åˆOpenFeign" class="headerlink" title="8.2ã€sentinelæ•´åˆOpenFeign"></a>8.2ã€sentinelæ•´åˆOpenFeign</h2><h3 id="1ã€ä¿®æ”¹å¾®æœåŠ¡æ¶ˆè´¹è€…84æ¨¡å—"><a href="#1ã€ä¿®æ”¹å¾®æœåŠ¡æ¶ˆè´¹è€…84æ¨¡å—" class="headerlink" title="1ã€ä¿®æ”¹å¾®æœåŠ¡æ¶ˆè´¹è€…84æ¨¡å—"></a>1ã€ä¿®æ”¹å¾®æœåŠ¡æ¶ˆè´¹è€…84æ¨¡å—</h3><ul><li>ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®ï¼Œ æ¿€æ´»Sentinelå¯¹feignçš„æ”¯æŒ</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¿€æ´»Sentinelå¯¹feignçš„æ”¯æŒ</span></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableFeignClientsæ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªPaymentServiceæ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;nacos-payment-provider&quot;,fallback = PaymentFallbackService.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªPaymentFallbackServiceå®ç°PaymentServiceæ¥å£</li></ul><blockquote><p>è¿™ä¸ªç±»ç”¨äºå¯¹PayServiceæ¥å£ä¸­çš„æ–¹æ³•åšå…œåº•å¤„ç†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title">PaymentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult(<span class="number">44444</span>, <span class="string">&quot;æœåŠ¡é™çº§è¿”å›,---PaymentFallbackService&quot;</span>, <span class="keyword">new</span> Payment(id, <span class="string">&quot;errorSerial&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹Controllerå±‚"><a href="#2ã€ä¿®æ”¹Controllerå±‚" class="headerlink" title="2ã€ä¿®æ”¹Controllerå±‚"></a>2ã€ä¿®æ”¹Controllerå±‚</h3><blockquote><p>CircleBreakerController</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//===========================OpenFeign</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/paymentSQL/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">paymentSQL</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> paymentService.paymentSQL(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€å¯åŠ¨9003ã€9004å’Œ84å¾®æœåŠ¡ï¼Œæµ‹è¯•"><a href="#3ã€å¯åŠ¨9003ã€9004å’Œ84å¾®æœåŠ¡ï¼Œæµ‹è¯•" class="headerlink" title="3ã€å¯åŠ¨9003ã€9004å’Œ84å¾®æœåŠ¡ï¼Œæµ‹è¯•"></a>3ã€å¯åŠ¨9003ã€9004å’Œ84å¾®æœåŠ¡ï¼Œæµ‹è¯•</h3><blockquote><p>è®¿é—® <a href="http://localhost:84/consumer/paymentSQL/1">http://localhost:84/consumer/paymentSQL/1</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222143053.png" alt="image-20210222143051685"></p><h3 id="4ã€æŸ¥çœ‹é™çº§æ•ˆæœ"><a href="#4ã€æŸ¥çœ‹é™çº§æ•ˆæœ" class="headerlink" title="4ã€æŸ¥çœ‹é™çº§æ•ˆæœ"></a>4ã€æŸ¥çœ‹é™çº§æ•ˆæœ</h3><blockquote><p>æµ‹è¯•84è°ƒç”¨9003ï¼Œæ­¤æ—¶<strong>æ•…æ„å…³é—­9003å¾®æœåŠ¡æä¾›è€…</strong>ï¼Œçœ‹84æ¶ˆè´¹ä¾§è‡ªåŠ¨é™çº§ï¼Œä¸ä¼šè¢«è€—æ­»</p></blockquote><ul><li><p>å…³é—­9003å’Œ9004</p></li><li><p>è®¿é—®  <a href="http://localhost:84/consumer/paymentSQL/1">http://localhost:84/consumer/paymentSQL/1</a>  </p></li><li><p>æŸ¥çœ‹ç»“æœ</p></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210222143834.png" alt="image-20210222143834182"></p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ‘¨â€âœˆï¸Sentinel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆå…­ï¼‰-HashMapæºç è§£è¯»</title>
      <link href="posts/717860798.html"/>
      <url>posts/717860798.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€é›†åˆå®¹å™¨"><a href="#1ã€é›†åˆå®¹å™¨" class="headerlink" title="1ã€é›†åˆå®¹å™¨"></a>1ã€é›†åˆå®¹å™¨</h2><h3 id="1-1ã€æ¦‚è¿°"><a href="#1-1ã€æ¦‚è¿°" class="headerlink" title="1.1ã€æ¦‚è¿°"></a>1.1ã€æ¦‚è¿°</h3><blockquote><p>Javaé›†åˆå®¹å™¨ä¸»è¦åŒ…å«äº†ä¸‰ä¸ªæ¥å£ï¼Œåˆ†åˆ«ä¸º<strong>List</strong>ï¼Œ<strong>Set</strong>å’Œ<strong>Map</strong>ï¼Œä»¥åŠå®ç°äº†è¿™äº›æ¥å£çš„è¯¸å¤šå­ç±»ã€‚</p><p>å…¶ä¸­Listå’ŒSetç»§æ‰¿äº†Collectionæ¥å£ï¼Œè€ŒMapæ˜¯å•ç‹¬çš„æ¥å£ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217221746.png" alt="image-20210217221746006"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217221735.png" alt="image-20210217221733459"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217221829.png" alt="image-20210217221829486"></p><h3 id="1-2ã€å¯¹æ¯”"><a href="#1-2ã€å¯¹æ¯”" class="headerlink" title="1.2ã€å¯¹æ¯”"></a>1.2ã€å¯¹æ¯”</h3><blockquote><p>Listæ˜¯æœ‰åºçš„ï¼Œæœ‰åºæŒ‡æ’å…¥å…ƒç´ çš„é¡ºåºï¼Œå…¶ä¸­å¯ä»¥å­˜æ”¾é‡å¤å€¼å’Œnullå€¼</p><p>Setæ˜¯æ— åºçš„ï¼Œä¸”å…ƒç´ å…·æœ‰å”¯ä¸€æ€§ï¼Œæ‰€ä»¥åªèƒ½å­˜æ”¾ä¸€ä¸ªnullå€¼</p><p>Mapå­˜æ”¾çš„æ˜¯Entryé”®å€¼å¯¹ï¼Œé”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥åªèƒ½å­˜æ”¾ä¸€ä¸ªkeyä¸ºnullçš„entryï¼Œä½†å¯ä»¥å­˜æ”¾å¤šä¸ªå€¼ä¸ºnullçš„entry</p></blockquote><h3 id="1-3ã€HashMapçš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-3ã€HashMapçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.3ã€HashMapçš„åŸºæœ¬æ¦‚å¿µ"></a>1.3ã€HashMapçš„åŸºæœ¬æ¦‚å¿µ</h3><blockquote><p>HashMapåŸºäºå“ˆå¸Œè¡¨çš„Mapæ¥å£å®ç°ï¼Œæ˜¯ä»¥key-valueå­˜å‚¨å½¢å¼å­˜åœ¨ï¼Œå³ä¸»è¦ç”¨äºå­˜æ”¾é”®å€¼å¯¹ã€‚HashMapçš„å®ç°ä¸æ˜¯åŒæ­¥çš„ï¼Œè¿™æ„å‘³ç€å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å®ƒçš„key-valueéƒ½å¯ä»¥ä¸ºnullï¼ˆåªèƒ½æœ‰ä¸€ä¸ªkeyä¸ºnullï¼Œå¯ä»¥æœ‰å¤šä¸ªå€¼ä¸ºnullï¼‰ï¼Œæ­¤å¤–ï¼ŒHashMapä¸­çš„æ˜ å°„ä¸æ˜¯æœ‰åºçš„ï¼ˆä¸ä¿è¯å­˜å–é¡ºåºï¼‰ã€‚</p><p>JDK1.8ä¹‹å‰HashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªï¼ˆä¸¤ä¸ªå¯¹è±¡è°ƒç”¨çš„hashCodeæ–¹æ³•è®¡ç®—çš„å“ˆå¸Œç å€¼ä¸€è‡´å¯¼è‡´è®¡ç®—çš„æ•°ç»„ç³»å¼•å€¼ç›¸åŒï¼‰è€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€œè§£å†³å†²çªï¼‰JDK1.8ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œ<strong>å½“é“¾è¡¨é•¿åº¦å¤§äºé˜€å€¼ï¼ˆæˆ–è€…çº¢é»‘æ ‘çš„è¾¹ç•Œå€¼ï¼Œé»˜è®¤ä¸º8ï¼‰å¹¶ä¸”å½“å‰æ•°ç»„çš„é•¿åº¦å¤§äº64æ—¶</strong>ï¼Œæ­¤æ—¶æ­¤æ¡ˆå¼•ä½ç½®ä¸Šçš„æ‰€æœ‰æ•°æ®æ”¹ä¸ºä½¿ç”¨<strong>çº¢é»‘æ ‘</strong>å­˜å‚¨ã€‚</p><p>è¡¥å……ï¼šå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå³ä¾¿é˜ˆå€¼å¤§äº8ï¼Œä½†æ˜¯æ•°ç»„é•¿åº¦å°äº64ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šå°†é“¾è¡¨å˜ä¸ºçº¢é»‘æ ‘ã€‚è€Œæ˜¯é€‰æ‹©è¿›è¡Œæ•°ç»„æ‰©å®¹ã€‚</p><p>è¿™æ ·åšçš„ç›®çš„æ˜¯å› ä¸ºæ•ˆç»„æ¯”è¾ƒå°ï¼Œå°½é‡é¿å¼€çº¢é»‘æ ‘ç»“æ„ï¼Œè¿™ç§æƒ…å†µä¸‹å˜ä¸ºçº¢é»‘æ ‘ç»“æ„ï¼Œåè€Œä¼šé™ä½æ•ˆç‡ï¼Œå› ä¸ºçº¢é»‘æ ‘éœ€è¦è¿›è¡Œå·¦æ—‹ï¼Œå³æ—‹ï¼Œå˜è‰²è¿™äº›æ“ä½œæ¥ä¿æŒå¹³è¡¡ã€‚åŒæ—¶æ•°ç»„é•¿åº¦å°äº64æ—¶ï¼Œæœç´¢æ—¶é—´ç›¸å¯¹è¦å¿«äº›ã€‚æ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘æœç´¢æ—¶é—´ï¼Œåº•å±‚åœ¨è°ƒå€¼å¤§äº8å¹¶ä¸”æ•°ç»„é•¿åº¦å¤§äº64æ—¶ï¼Œé“¾è¡¨æ‰è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚å´ä½“å¯ä»¥å‚è€ƒtreeifyBinæ–¹æ³•ã€‚</p><p>å½“ç„¶è™½ç„¶å¢äº†çº¢é»‘æ ‘ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„ï¼Œç»“æ„å˜å¾—å¤æ‚äº†ï¼Œä½†æ˜¯é˜ˆå€¼å¤§äº8å¹¶ä¸”æ•°ç»„é•¿åº¦å¤§äº64æ—¶ï¼Œé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘æ—¶ï¼Œæ•ˆç‡ä¹Ÿå˜çš„æ›´é«˜æ•ˆã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210218113025.png" alt="image-20210218113018160"></p><blockquote><p>ç‰¹ç‚¹æ€»ç»“ï¼š</p></blockquote><ul><li>å­˜å–æ˜¯æ— åºçš„</li><li>é”®å’Œå€¼ä½ç½®éƒ½å¯ä»¥æ˜¯nullï¼Œä½†æ˜¯é”®ä½ç½®åªèƒ½æœ‰ä¸€ä¸ªnull</li><li>é”®ä½ç½®æ˜¯å”¯ä¸€çš„</li><li>1.8ä¹‹å‰æ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨ï¼›1.8ä¹‹åæ•°æ®ç»“æ„æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</li><li>é˜ˆå€¼ï¼ˆè¾¹ç•Œå€¼ï¼‰ã€‹8ä¸”æ•°ç»„é•¿åº¦å¤§äº64ï¼Œæ‰å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå˜ä¸ºçº¢é»‘æ ‘çš„ç›®çš„æ˜¯ä¸ºäº†æ›´é«˜æ•ˆçš„æŸ¥è¯¢ã€‚</li></ul><h3 id="1-4ã€Hashå’ŒHashç®—æ³•"><a href="#1-4ã€Hashå’ŒHashç®—æ³•" class="headerlink" title="1.4ã€Hashå’ŒHashç®—æ³•"></a>1.4ã€Hashå’ŒHashç®—æ³•</h3><blockquote><p>Hashä¹Ÿç§°æ•£åˆ—ã€å“ˆå¸Œï¼ŒåŸºæœ¬åŸç†å°±æ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œé€šè¿‡Hashç®—æ³•å˜ä¸ºå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¿™ä¸ªæ˜ å°„çš„è§„åˆ™å°±æ˜¯å¯¹åº”çš„Hashç®—æ³•ï¼Œè€ŒåŸå§‹æ•°æ®æ˜ å°„åçš„äºŒè¿›åˆ¶ä¸²å°±æ˜¯å“ˆå¸Œå€¼ã€‚</p><p>Hashçš„ç‰¹ç‚¹ï¼š</p></blockquote><ul><li>ä»Hashå€¼ä¸èƒ½åå‘æ¨å¯¼å‡ºåŸå§‹çš„æ•°æ®</li><li>è¾“å…¥æ•°æ®çš„å¾®å°å˜åŒ–ä¼šå¾—åˆ°å®Œå…¨ä¸åŒçš„Hashå€¼ï¼Œç›¸åŒçš„æ•°æ®ä¼šå¾—åˆ°ç›¸åŒçš„å€¼ã€‚</li><li>Hashç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¦é«˜æ•ˆï¼Œé•¿çš„æ–‡æœ¬ä¹Ÿèƒ½å¿«é€Ÿè®¡ç®—å‡ºHashå€¼</li><li>Hashç®—æ³•çš„å†²çªæ¦‚ç‡è¦å°</li></ul><blockquote><p>ç”±äºHashç®—æ³•çš„åŸç†æ˜¯å°†è¾“å…¥ç©ºé—´çš„å€¼æ˜ å°„æˆHashç©ºé—´å†…ï¼Œè€Œhashå€¼çš„ç©ºé—´è¿œå°äºè¾“å…¥çš„ç©ºé—´ï¼Œæ ¹æ®æŠ½å±‰åŸç†ï¼Œä¸€å®šä¼šå­˜åœ¨ä¸åŒçš„è¾“å…¥è¢«æ˜ å°„ä¸ºç›¸åŒè¾“å‡ºçš„æƒ…å†µã€‚</p><p>æŠ½å±‰åŸç†ï¼š10ä¸ªè‹¹æœæ”¾åˆ°9ä¸ªæŠ½å±‰ä¸­ï¼Œæ— è®ºæ€ä¹ˆæ”¾ï¼Œæˆ‘ä»¬ä¼šå‘ç°è‡³å°‘ä¼šæœ‰ä¸€ä¸ªæŠ½å±‰é‡Œé¢æ”¾ä¸å°‘äºä¸¤ä¸ªè‹¹æœã€‚</p></blockquote><h2 id="2ã€HashMapåŸç†"><a href="#2ã€HashMapåŸç†" class="headerlink" title="2ã€HashMapåŸç†"></a>2ã€HashMapåŸç†</h2><h3 id="2-1ã€HashMapçš„ç»§æ‰¿ä½“ç³»"><a href="#2-1ã€HashMapçš„ç»§æ‰¿ä½“ç³»" class="headerlink" title="2.1ã€HashMapçš„ç»§æ‰¿ä½“ç³»"></a>2.1ã€HashMapçš„ç»§æ‰¿ä½“ç³»</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210218123331.png" alt="image-20210218123330894"></p><h3 id="2-3ã€åº•å±‚æ•°æ®ç»“æ„ä»‹ç»"><a href="#2-3ã€åº•å±‚æ•°æ®ç»“æ„ä»‹ç»" class="headerlink" title="2.3ã€åº•å±‚æ•°æ®ç»“æ„ä»‹ç»"></a>2.3ã€åº•å±‚æ•°æ®ç»“æ„ä»‹ç»</h3><ul><li>JDK1.7åŠä¹‹å‰</li></ul><blockquote><p>HashMapåº•å±‚ä½¿ç”¨æ•°ç»„ + é“¾è¡¨çš„å½¢å¼æ¥å®ç°HashMapï¼Œå½“åˆ›å»ºHashMapé›†åˆå¯¹è±¡æ—¶ï¼Œæ„é€ æ–¹æ³•ä¸­ä¼š<strong>åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º16çš„Entry[] table</strong>æ¥å­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚</p></blockquote><ul><li>JDK1.8ä¹‹å</li></ul><blockquote><p>HashMapåº•å±‚ä½¿ç”¨æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘æ¥å®ç°HashMapï¼Œåœ¨JDK8ä¹‹åä¸å†ä½¿ç”¨HashMapçš„æ„é€ æ–¹æ³•åº•å±‚åˆ›å»ºæ•°ç»„äº†ï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨putå­˜å‚¨æ—¶æ‰åˆ›å»ºæ•°ç»„ï¼Œä½¿ç”¨Node[] tableæ¥å­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚</p></blockquote><h3 id="2-4ã€Hashè¡¨ä½¿ç”¨ä»€ä¹ˆç®—æ³•è®¡ç®—hashå€¼ï¼Ÿ"><a href="#2-4ã€Hashè¡¨ä½¿ç”¨ä»€ä¹ˆç®—æ³•è®¡ç®—hashå€¼ï¼Ÿ" class="headerlink" title="2.4ã€Hashè¡¨ä½¿ç”¨ä»€ä¹ˆç®—æ³•è®¡ç®—hashå€¼ï¼Ÿ"></a>2.4ã€Hashè¡¨ä½¿ç”¨ä»€ä¹ˆç®—æ³•è®¡ç®—hashå€¼ï¼Ÿ</h3><ul><li>åº•å±‚é‡‡ç”¨çš„æ˜¯keyçš„hashCodeæ–¹æ³•çš„å€¼ç»“åˆæ•°ç»„é•¿åº¦è¿›è¡Œæ— ç¬¦å·å³ç§»(&gt;&gt;&gt;),æŒ‰ä½å¼‚æˆ–(^),æŒ‰ä½ä¸(&amp;)è®¡ç®—å‡ºç´¢å¼•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>è¿˜å¯ä»¥ä½¿ç”¨å¹³æ–¹å–ä¸­æ³•ã€å–ä½™æ•°ã€ä¼ªéšæœºæ•°æ³•è®¡ç®—hashå€¼</p></li><li><p>ä¸ºä»€ä¹ˆåº•å±‚é‡‡ç”¨çš„æ— ç¬¦å·å³ç§»ã€æŒ‰ä½å¼‚æˆ–ã€æŒ‰ä½ä¸è€Œä¸æ˜¯é‡‡ç”¨å–ä½™å‘¢ï¼Ÿ</p></li></ul><blockquote><p>å…¶ä»–è®¡ç®—æ–¹å¼æ•ˆç‡æ¯”è¾ƒä½ï¼Œè€Œä¸Šè¿°ä½è¿ç®—æ•ˆç‡è¾ƒé«˜ã€‚</p></blockquote><h3 id="2-5ã€putæ•°æ®åŸç†åˆ†æ"><a href="#2-5ã€putæ•°æ®åŸç†åˆ†æ" class="headerlink" title="2.5ã€putæ•°æ®åŸç†åˆ†æ"></a>2.5ã€putæ•°æ®åŸç†åˆ†æ</h3><ul><li>map.put(â€œèŠœæ¹–â€,â€èµ·é£â€);</li><li>è·å–é”®â€èŠœæ¹–â€å­—ç¬¦ä¸²çš„Hashå€¼</li><li>ç»è¿‡hashå€¼æ‰°åŠ¨å‡½æ•°ï¼Œä½¿æ­¤hashå€¼æ›´æ•£åˆ—</li><li>æ„é€ å‡ºNodeå¯¹è±¡</li><li>é€šè¿‡è·¯ç”±ç®—æ³•ï¼Œæ‰¾å‡ºNodeåº”å½“å­˜æ”¾åœ¨æ•°ç»„ä¸­çš„ä½ç½®</li></ul><blockquote><p>è·¯ç”±å¯»å€å…¬å¼ï¼š(table.length - 1) &amp; node.hash</p><p>è¿™é‡Œè¦æ³¨æ„ï¼Œtableæ•°ç»„çš„å¤§å°ä¸º2^n</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210218220841.png" alt="2021-02-18_220529"></p><h3 id="2-6ã€ä»€ä¹ˆæ˜¯Hashç¢°æ’"><a href="#2-6ã€ä»€ä¹ˆæ˜¯Hashç¢°æ’" class="headerlink" title="2.6ã€ä»€ä¹ˆæ˜¯Hashç¢°æ’"></a>2.6ã€ä»€ä¹ˆæ˜¯Hashç¢°æ’</h3><blockquote><p>å¦‚æœä¸¤ä¸ªè¾“å…¥ä¸²çš„hashå‡½æ•°çš„å€¼ä¸€æ ·ï¼Œåˆ™ç§°è¿™ä¸¤ä¸ªä¸²æ˜¯ä¸€ä¸ªç¢°æ’(Collision)ã€‚æ—¢ç„¶æ˜¯æŠŠä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²å˜æˆå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¿…æœ‰ä¸€ä¸ªè¾“å‡ºä¸²å¯¹åº”æ— ç©·å¤šä¸ªè¾“å…¥ä¸²ï¼Œç¢°æ’æ˜¯å¿…ç„¶å­˜åœ¨çš„ã€‚</p><p>å³å…ƒç´ çš„keyä¸åŒï¼Œä½†å¾—å‡ºçš„hashå€¼ç›¸åŒ</p></blockquote><h3 id="2-7ã€ä»€ä¹ˆå¼•å…¥çº¢é»‘æ ‘ï¼Ÿ"><a href="#2-7ã€ä»€ä¹ˆå¼•å…¥çº¢é»‘æ ‘ï¼Ÿ" class="headerlink" title="2.7ã€ä»€ä¹ˆå¼•å…¥çº¢é»‘æ ‘ï¼Ÿ"></a>2.7ã€ä»€ä¹ˆå¼•å…¥çº¢é»‘æ ‘ï¼Ÿ</h3><blockquote><p>åœ¨jdk8ä¹‹å‰HashMapçš„å®ç°æ˜¯æ•°ç»„ï¼‹é“¾è¡¨ï¼Œå³ä½¿å“ˆå¸Œå‡½æ•°å–å¾—å†å¥½ï¼Œä¹Ÿå¾ˆéš¾è¾¾åˆ°å…ƒç´ ç™¾åˆ†ç™¾å‡åŒ€åˆ†å¸ƒã€‚å½“HashMapä¸­æœ‰å¤§é‡çš„å…ƒç´ éƒ½å­˜æ”¾åœ¨åŒä¸€ä¸ªæ¡¶ä¸­æ—¶ï¼Œè¿™ä¸ªæ¡¶ä¸‹æœ‰ä¸€æ¡é•¿é•¿çš„é“¾è¡¨ï¼Œè¿™ä¸ªæ—¶å€™HashMapå°±ç›¸å½“äºä¸€ä¸ªå•é“¾è¡¨ï¼Œå‡å¦‚å•é“¾è¡¨æœ‰nä¸ªå…ƒç´ ï¼Œéå†çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(n)ï¼Œå®Œå…¨å¤±å»äº†å®ƒçš„ä¼˜åŠ¿ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒJDK1.8ä¸­å¼•å…¥äº†çº¢é»‘æ ‘ï¼ˆæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ï¼‰æ¥ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ã€‚å½“é“¾è¡¨é•¿åº¦å¾ˆå°çš„æ—¶å€™ï¼Œå³ä½¿éå†ï¼Œé€Ÿåº¦ä¹Ÿéå¸¸å¿«ï¼Œä½†æ˜¯å½“é“¾è¡¨é•¿åº¦ä¸æ–­å˜é•¿ï¼Œè‚¯å®šä¼šå¯¹æŸ¥è¯¢æ€§èƒ½æœ‰ä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥æ‰éœ€è¦è½¬æˆæ ‘ã€‚</p></blockquote><h2 id="3ã€HashMapæºç åˆ†æ"><a href="#3ã€HashMapæºç åˆ†æ" class="headerlink" title="3ã€HashMapæºç åˆ†æ"></a>3ã€HashMapæºç åˆ†æ</h2><h3 id="3-1ã€æ ¸å¿ƒå±æ€§åˆ†æ"><a href="#3-1ã€æ ¸å¿ƒå±æ€§åˆ†æ" class="headerlink" title="3.1ã€æ ¸å¿ƒå±æ€§åˆ†æ"></a>3.1ã€æ ¸å¿ƒå±æ€§åˆ†æ</h3><blockquote><p>DEFAULT_INITIAL_CAPACITY</p></blockquote><ul><li>tableæ•°ç»„çš„é»˜è®¤å¤§å°ï¼Œå½“ä½¿ç”¨æ— å‚å‡½æ•°æ„é€ HashMapæ—¶ï¼ŒHashMapå¯¹è±¡çš„å¤§å°é»˜è®¤ä¸º16</li></ul><blockquote><p>TREEIFY_THRESHOLD</p></blockquote><ul><li>æ ‘åŒ–é˜ˆå€¼ä¹‹ä¸€ï¼Œé»˜è®¤ä¸º8</li></ul><blockquote><p>UNTREEIFY_THRESHOLD</p></blockquote><ul><li>æ ‘é™çº§ä¸ºé“¾è¡¨çš„é˜ˆå€¼ï¼Œé»˜è®¤ä¸º6</li></ul><blockquote><p>MIN_TREEIFY_CAPACITY</p></blockquote><ul><li>æ ‘åŒ–é˜ˆå€¼ä¹‹ä¸€ï¼Œåªæœ‰å½“tableæ•°ç»„ä¸­å…ƒç´ å¤§å°è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œæ•°ç»„ä¸­é•¿åº¦å¤§äºTREEIFY_THRESHOLDçš„é“¾è¡¨æ‰èƒ½è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</li></ul><blockquote><p>transient Node&lt;K,V&gt;[] table</p></blockquote><ul><li>ashmapä¸­ç»´æŠ¤çš„æ•£åˆ—è¡¨ç»“æ„ï¼Œæ˜¯ä¸€ä¸ªNodeæ•°ç»„</li><li>JDK1.8åï¼ŒHashMapå¯¹è±¡åœ¨è¢«æ„é€ å‡ºæ¥æ—¶ä¸åˆå§‹åŒ–æ•£åˆ—è¡¨ï¼Œè€Œæ˜¯ç­‰åˆ°ç¬¬ä¸€æ¬¡å¾€è¯¥å¯¹è±¡ä¸­puté”®å€¼å¯¹æ—¶æ‰åˆå§‹åŒ–æ•£åˆ—è¡¨ã€‚</li></ul><blockquote><p>transient int size</p></blockquote><ul><li>å½“å‰å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œå³HashMapå¯¹è±¡ä¸­é”®å€¼å¯¹ä¸ªæ•°ã€‚</li></ul><blockquote><p>transient int modCount</p></blockquote><ul><li>å½“å‰hashè¡¨ç»“æ„çš„ä¿®æ”¹æ¬¡æ•°,å¾€hashMapä¸­æ”¾å…¥ä¸€ä¸ªé”®å€¼å¯¹ï¼Œåˆ é™¤ä¸€ä¸ªé”®å€¼å¯¹æ—¶ï¼ŒmodCount+1ï¼Œä½†ä½¿ç”¨ç›¸åŒkeyï¼Œä¸åŒvalueçš„Nodeè¦†ç›–æ—§å€¼æ—¶ï¼ŒmodCountä¸ä¼š+1</li></ul><blockquote><p>threshold</p></blockquote><ul><li>æ‰©å®¹é˜ˆå€¼ï¼Œå½“Hashè¡¨ä¸­çš„å…ƒç´ è¶…è¿‡æ­¤å€¼æ—¶è§¦å‘æ‰©å®¹</li><li>threshold = capacity * loadFactoryï¼Œå…¶ä¸­capacityè¡¨ç¤ºå½“å‰hashè¡¨çš„æ•°ç»„é•¿åº¦</li></ul><blockquote><p>loadFactory</p></blockquote><ul><li>è´Ÿè½½å› å­ï¼Œé»˜è®¤è´Ÿè½½å› å­å¤§å°ä¸º0.75</li></ul><h3 id="3-2ã€æ„é€ æ–¹æ³•åˆ†æ"><a href="#3-2ã€æ„é€ æ–¹æ³•åˆ†æ" class="headerlink" title="3.2ã€æ„é€ æ–¹æ³•åˆ†æ"></a>3.2ã€æ„é€ æ–¹æ³•åˆ†æ</h3><ul><li>æ„é€ æ–¹æ³•ä¸€ï¼Œè‡ªå®šä¹‰åˆå§‹åŒ–å¤§å°å’Œè´Ÿè½½å› å­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal initial capacity: &quot;</span> +</span><br><span class="line">                                           initialCapacity);</span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">        initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">    <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal load factor: &quot;</span> +</span><br><span class="line">                                           loadFactor);</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">    <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>tableSizeFor(initialCapacity)æ–¹æ³•ï¼Œ<strong>å°±æ˜¯è¿”å›ä¸€ä¸ªå¤§äºç­‰äºå½“å‰capacityçš„ä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯2çš„æ¬¡æ–¹æ•°ã€‚</strong></p><p>å‡è®¾ä¼ å…¥çš„capä¸º10</p><p>é‚£ä¹ˆn = cap - 1 = 9</p><p>å°†nè½¬æ¢ä¸ºäºŒè¿›åˆ¶ï¼Œnå˜ä¸º1001</p><p>n &gt;&gt;&gt; 1 = 0100ï¼Œå³ç§»å°±æ˜¯åœ¨1001çš„æœ€å‰é¢è¡¥ä¸Šä¸€ä¸ª0ï¼Œä½¿å…¶å˜ä¸º01001ï¼Œç„¶åæˆªå»æœ€åä¸€ä½ï¼Œå˜ä¸º0100ï¼Œè€Œ1001 | 0100 = 1101ï¼Œæ­¤æ—¶n = 1101</p><p>åŒç†å¯å¾—1101 &gt;&gt;&gt; 2 = 0011ï¼Œ1101 | 0011 = 1111</p><p>åŒç†å¯å¾—1111  &gt;&gt;&gt;&gt; 4 = 0000ï¼Œ1111 | 0000 = 1111</p><p>æ­¤æ—¶n&gt;&gt;&gt;8ã€n&gt;&gt;&gt;16çš„ç»“æœå’Œä¸Šé¢ä¸€è‡´ï¼Œæ•…n = 1111(2) = 15(10)</p><p>æœ€åæ‰§è¡Œreturnè¯­å¥ï¼Œæ­¤æ—¶è¿”å›15 + 1 = 16ï¼Œä¸º2^ 4</p><p>å¦‚æœä¸å‡ä¸€ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°ä¸€ä¸ªæ¯”é¢„æœŸç»“æœå¤§ä¸€å€çš„æ•°å­—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ„é€ æ–¹æ³•äºŒï¼šè‡ªå®šä¹‰åˆå§‹åŒ–å¤§å°ï¼Œè°ƒç”¨äº†ä¸Šé¢çš„æ„é€ æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ„é€ æ–¹æ³•ä¸‰ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ„é€ æ–¹æ³•å››ï¼šæ ¹æ®ä¼ å…¥çš„Mapæ„é€ HashMap</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">    putMapEntries(m, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3ã€putæ–¹æ³•åˆ†æ"><a href="#3-3ã€putæ–¹æ³•åˆ†æ" class="headerlink" title="3.3ã€putæ–¹æ³•åˆ†æ"></a>3.3ã€putæ–¹æ³•åˆ†æ</h3><blockquote><p>åˆ†ææºç å¯çŸ¥ï¼Œputæ–¹æ³•å†…éƒ¨è°ƒç”¨äº†putValæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>hash(key)æ–¹æ³•ï¼Œæ‰°åŠ¨å‡½æ•°ï¼Œä½œç”¨æ˜¯è®©keyçš„hashå€¼çš„é«˜16ä½ä¹Ÿå‚ä¸è¿ç®—ï¼Œå¢åŠ æ•£åˆ—æ€§ï¼Œå‡å°‘hashå†²çªçš„æ¦‚ç‡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ ¸å¿ƒputValæ–¹æ³•</p><p>æ³¨æ„ï¼šè¿™é‡ŒHashMapå®ç°äº†å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå³new HashMapçš„æ—¶å€™ä¸åˆ›å»ºæ•£åˆ—è¡¨ï¼Œç­‰åˆ°ç¬¬ä¸€æ¬¡å¾€hashMapä¸­puté”®å€¼å¯¹æ—¶æ‰åˆå§‹åŒ–ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//tabï¼šå¼•ç”¨å½“å‰hashMapçš„æ•£åˆ—è¡¨</span></span><br><span class="line"><span class="comment">//pï¼šè¡¨ç¤ºå½“å‰æ•£åˆ—è¡¨çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">//nï¼šè¡¨ç¤ºæ•£åˆ—è¡¨æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">//iï¼šè¡¨ç¤ºè·¯ç”±å¯»å€ç»“æœçš„ä¸‹æ ‡</span></span><br><span class="line">      Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">      <span class="comment">//å¦‚æœå½“å‰hashmapä¸­çš„æ•£åˆ—è¡¨ä¸ºnullï¼Œæˆ–è€…æ•£åˆ—è¡¨é•¿åº¦ä¸º0</span></span><br><span class="line">      <span class="comment">//n = (tab = resize()).length;åˆ›å»ºæ•£åˆ—è¡¨</span></span><br><span class="line">      <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">          n = (tab = resize()).length;</span><br><span class="line">      <span class="comment">//i = (n - 1) &amp; hashï¼Œä½¿ç”¨è·¯ç”±å¯»å€ç®—æ³•è®¡ç®—å‡ºè¦å½“å‰é”®å€¼å¯¹è¦å­˜æ”¾çš„ä½ç½®</span></span><br><span class="line">      <span class="comment">//å¦‚æœæ•£åˆ—è¡¨ä¸­è¯¥ä¸‹æ ‡å¯¹åº”å…ƒç´ ä¸ºnullï¼Œé‚£ä¹ˆå°±new ä¸€ä¸ªNodeèŠ‚ç‚¹</span></span><br><span class="line">      <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">          tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//eï¼šnodeä¸´æ—¶å…ƒç´ </span></span><br><span class="line"><span class="comment">//kï¼šè¡¨ç¤ºä¸´æ—¶çš„ä¸€ä¸ªkey</span></span><br><span class="line">          Node&lt;K,V&gt; e; K k;</span><br><span class="line">          <span class="comment">//è¡¨ç¤ºæ¡¶ä½ä¸­çš„è¯¥å…ƒç´ ï¼Œä¸ä½ å½“å‰æ’å…¥çš„å…ƒç´ çš„keyå®Œå…¨ä¸€è‡´ï¼Œè¡¨ç¤ºåç»­éœ€è¦è¿›è¡Œæ›¿æ¢æ“ä½œã€‚</span></span><br><span class="line">          <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">              ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">              e = p;</span><br><span class="line">          <span class="comment">//å¦‚æœè¦æ’å…¥çš„æ¡¶ä½å¯¹åº”çš„å…ƒç´ å·²ç»æ ‘åŒ–ï¼Œå³è¦æ’å…¥çš„ä½ç½®ä¸æ˜¯ä¸€æ ¹é“¾è¡¨è€Œæ˜¯ä¸€æ£µçº¢é»‘æ ‘</span></span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">              e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">          <span class="comment">//å¦‚æœä¸æ˜¯æ ‘ä¹Ÿä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆåªèƒ½æ˜¯é“¾è¡¨äº†</span></span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">//å¾ªç¯éå†æ‰¾åˆ°çš„é“¾è¡¨ï¼Œå¦‚æœé“¾è¡¨ä¸­æœ‰keyä¸å¾…æ’å…¥é”®å€¼å¯¹ç›¸åŒçš„å…ƒç´ ï¼Œé‚£ä¹ˆç”¨æ–°çš„å€¼æ›¿æ¢æ—§çš„å€¼</span></span><br><span class="line">              <span class="comment">//å¦åˆ™å°†å¾…æ’å…¥å…ƒç´ åŠ å…¥åˆ°è¯¥é“¾è¡¨ä¸­</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                  <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                      p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                      <span class="comment">//è¡¨ç¤ºå½“å‰é“¾è¡¨ä¸­çš„å…ƒç´ å¤§äºä¸´ç•Œå€¼ï¼Œæ­¤æ—¶å¯èƒ½éœ€è¦æ ‘åŒ–</span></span><br><span class="line">                      <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                          treeifyBin(tab, hash);</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="comment">//æ‰¾åˆ°äº†å«æœ‰ç›¸åŒkeyçš„å…ƒç´ ï¼Œéœ€è¦è¿›è¡Œæ›¿æ¢æ“ä½œ</span></span><br><span class="line">                  <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                      ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                  p = e;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//å¦‚æœeä¸ä¸ºnullï¼Œè¯´æ˜æ‰¾åˆ°äº†ä¸€ä¸ªä¸ä½ æ’å…¥å…ƒç´ keyå®Œå…¨ä¸€è‡´çš„å…ƒç´ ï¼Œéœ€è¦æ›¿æ¢</span></span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">              V oldValue = e.value;</span><br><span class="line">              <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                  e.value = value;</span><br><span class="line">              afterNodeAccess(e);</span><br><span class="line">              <span class="keyword">return</span> oldValue;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//è®©æ•£åˆ—è¡¨è¢«ä¿®æ”¹çš„æ¬¡æ•°+1</span></span><br><span class="line">      ++modCount;</span><br><span class="line">      <span class="comment">//å¦‚æœsizeè‡ªå¢åå€¼å¤§äºæ‰©å®¹é˜ˆå€¼ï¼Œåˆ™è§¦å‘æ‰©å®¹ã€‚</span></span><br><span class="line">      <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">          resize();</span><br><span class="line">      afterNodeInsertion(evict);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ€»ç»“å¦‚ä¸‹ï¼š</p></blockquote><ul><li>å…ˆé€šè¿‡hashå€¼è®¡ç®—å‡ºkeyæ˜ å°„åˆ°å“ªä¸ªæ¡¶</li><li>å¦‚æœæ¡¶ä¸Šæ²¡æœ‰Hashå†²çªï¼Œåˆ™ç›´æ¥æ’å…¥</li><li>å¦‚æœå‡ºç°hashå†²çªï¼Œåˆ™éœ€è¦å¤„ç†å†²çª<ul><li>å¦‚æœè¯¥æ¡¶é‡‡ç”¨çº¢é»‘æ ‘å¤„ç†å†²çªï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ–¹æ³•æ’å…¥æ•°æ®ã€‚</li><li>å¦åˆ™é‡‡ç”¨ä¼ ç»Ÿçš„é“¾å¼æ–¹æ³•æ’å…¥ï¼Œå¦‚æœé“¾è¡¨é•¿åº¦è¾¾åˆ°ä¸´ç•Œå€¼ä¸”æ¡¶ä¸ªæ•°è¾¾åˆ°64ä¸ªï¼Œåˆ™æŠŠé“¾å˜ä¸ºçº¢é»‘æ ‘ã€‚</li></ul></li><li>å¦‚æœæ¡¶ä¸­å­˜åœ¨é‡å¤çš„å€¼ï¼Œåˆ™ä¸ºè¯¥é”®æ›¿æ¢æ–°å€¼value</li><li>å¦‚æœsizeå¤§äºé˜ˆå€¼thresholdï¼Œåˆ™è¿›è¡Œæ‰©å®¹</li></ul><blockquote><p>å…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>hash(key)ï¼Œè·å–keyçš„hashå€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> h;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1)å¦‚æœkeyç­‰äºnull;</span></span><br><span class="line"><span class="comment">å¯ä»¥çœ‹åˆ°å½“keyç­‰äºnullçš„æ—¶å€™ä¹Ÿæ˜¯æœ‰å“ˆå¸Œå€¼çš„ï¼Œè¿”å›çš„æ˜¯0.</span></span><br><span class="line"><span class="comment">2)å¦‚æœkeyä¸ç­‰äºnull;</span></span><br><span class="line"><span class="comment">é¦–å…ˆè®¡ç®—å‡ºkeyçš„hashCodeèµ‹å€¼ç»™h,ç„¶åä¸hæ— ç¬¦å·å³ç§»16ä½åçš„äºŒè¿›åˆ¶è¿›è¡ŒæŒ‰ä½å¼‚æˆ–å¾—åˆ°æœ€åçš„hashå€¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨putValå‡½æ•°ä¸­ä½¿ç”¨äº†ä¸Šè¿°hashå‡½æ•°è®¡ç®—å‡ºçš„hashå€¼ï¼Œæ ¹æ®å…¬å¼(n - 1) &amp; hashæ¥å†³å®šè¦æ”¾å…¥å“ªä¸ªæ¡¶ä¸­ï¼Œå…¶ä¸­nä¸ºHashMapå¯¹è±¡ä¸­çš„æ¡¶ä¸ªæ•°ï¼ˆæ•°ç»„é•¿åº¦ï¼‰ã€‚</p><ul><li>&amp;ï¼ˆæŒ‰ä½ä¸è¿ç®—ï¼‰ï¼šè¿ç®—è§„åˆ™ï¼šç›¸åŒäºŒè¿›åˆ¶ä½ä¸Šï¼Œéƒ½æ˜¯1çš„æ—¶å€™ï¼Œç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0ã€‚</li><li>^ï¼ˆæŒ‰ä½å¼‚æˆ–è¿ç®—ï¼‰ï¼šè¿ç®—è§„åˆ™ï¼šç›¸åŒçš„äºŒè¿›åˆ¶æ•°ä½ä¸Šï¼Œæ•°å­—ç›¸åŒï¼Œç»“æœä¸º0ï¼Œä¸åŒåˆ™ä¸º1ã€‚</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent, <span class="keyword">boolean</span> evict)</span></span>&#123;</span><br><span class="line">......</span><br><span class="line"><span class="keyword">if</span>((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)<span class="comment">//è¿™é‡Œçš„nè¡¨ç¤ºæ•°ç»„çš„é•¿åº¦16</span></span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4ã€resizeæ‰©å®¹æ–¹æ³•åˆ†æ"><a href="#3-4ã€resizeæ‰©å®¹æ–¹æ³•åˆ†æ" class="headerlink" title="3.4ã€resizeæ‰©å®¹æ–¹æ³•åˆ†æ"></a>3.4ã€resizeæ‰©å®¹æ–¹æ³•åˆ†æ</h3><blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦æ‰©å®¹ï¼Ÿ</p><p>ä¸ºäº†è§£å†³å› å“ˆå¸Œå†²çªè€Œå¯¼è‡´çš„é“¾åŒ–å½±å“æŸ¥è¯¢æ•ˆç‡çš„é—®é¢˜ï¼Œæ‰©å®¹å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    <span class="comment">//odTabå¼•ç”¨æœªæ‰©å®¹çš„å“ˆå¸Œè¡¨</span></span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="comment">//oldCapï¼šè¡¨ç¤ºæ‰©å®¹å‰çš„tableæ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="comment">//å¦‚æœæ‰©å®¹å‰çš„tableä¸ºç©ºï¼Œåˆ™oldCap = 0</span></span><br><span class="line">    <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="comment">//è¡¨ç¤ºæ‰©å®¹å‰çš„æ‰©å®¹é˜ˆå€¼ï¼Œè§¦å‘æœ¬è¯æ‰©å®¹çš„é˜ˆå€¼</span></span><br><span class="line">    <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">    <span class="comment">//newCapï¼šæ‰©å®¹ä¹‹åæƒ³è¦è¾¾åˆ°çš„å¤§å°</span></span><br><span class="line">    <span class="comment">//newThrï¼šæ‰©å®¹åå†æ¬¡è§¦å‘æ‰©å®¹çš„æ¡ä»¶</span></span><br><span class="line">    <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//å¦‚æœoldCap&gt;0ï¼Œé‚£ä¹ˆè¯æ˜å“ˆå¸Œè¡¨ä¸­çš„æ•£åˆ—è¡¨å·²ç»è¢«åˆå§‹åŒ–è¿‡äº†</span></span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ‰©å®¹å‰æ•°ç»„é•¿åº¦å·²ç»è¾¾åˆ°HashMapå®šä¹‰çš„æœ€å¤§å€¼ï¼Œæ­¤æ—¶æ— æ³•æ‰©å®¹</span></span><br><span class="line">        <span class="comment">//å°†æ‰©å®¹é˜ˆå€¼èµ‹å€¼ä¸ºIntegerç±»å‹çš„æœ€å¤§å€¼åè¿”å›æ—§çš„æ•£åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ä»¤newCap = 2 * oldCapï¼Œå¦‚æœæ‰©å®¹åçš„newCapå°äºHashMapè§„å®šçš„æœ€å°å€¼ä¸”åŸæ¥çš„oldCapå¤§äºç­‰äºé»˜è®¤åˆå§‹åŒ–å¤§å°ï¼Œè®©æ–°çš„æ‰©å®¹é˜ˆå€¼ = 2 * åŸæ¥çš„æ‰©å®¹é˜ˆå€¼</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿™é‡Œå’Œä¸‹é¢ä¸¤ç§æƒ…å†µå‡è¯´æ˜oldCap == 0</span></span><br><span class="line">    <span class="comment">//ä¼šæ‰§è¡Œè¿™ä¸€æ­¥çš„æƒ…å†µå¦‚ä¸‹ï¼š</span></span><br><span class="line">    <span class="comment">//1 new HashMap(initCap,loadFactory)</span></span><br><span class="line">    <span class="comment">//2 new HashMap(initCap)</span></span><br><span class="line">    <span class="comment">//3 new HashMap(map)ï¼Œå¹¶ä¸”è¿™ä¸ªmapæœ‰æ•°æ®</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="comment">//oldCap == 0</span></span><br><span class="line">    <span class="comment">//æ‰§è¡Œè¿™ä¸€æ­¥çš„æƒ…å†µå¦‚ä¸‹</span></span><br><span class="line">    <span class="comment">//new HashMap()</span></span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;<span class="comment">//16</span></span><br><span class="line">        <span class="comment">//12</span></span><br><span class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//newThrä¸º0æ—¶ï¼Œé€šè¿‡è´Ÿè½½å› å­å’Œæ‰©å®¹åçš„å®¹é‡è®¡ç®—å¾—åˆ°ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å°†æ‰©å®¹é˜ˆå€¼è®¾ç½®ä¸ºnewThr</span></span><br><span class="line">    threshold = newThr;</span><br><span class="line">    <span class="comment">//æ ¹æ®newCapåˆ›å»ºä¸€ä¸ªæ–°çš„Nodeæ•°ç»„</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="comment">//æ­¤æ¡ä»¶è¯´æ˜Hashmapåœ¨æœ¬æ¬¡æ‰©å®¹ä¹‹å‰ä¸ä¸ºnullï¼Œé‡Œé¢å¯èƒ½æœ‰æ•°æ®</span></span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="comment">//è¯´æ˜å½“å‰æ¡¶ä½æœ‰æ•°æ®ï¼Œä½†å…·ä½“æ˜¯å•ä¸ªæ•°æ®ã€é“¾è¡¨è¿˜æ˜¯æ ‘å°šæœªå¾—çŸ¥</span></span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æ–¹ä¾¿jvmå›æ”¶å†…å­˜</span></span><br><span class="line">                oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">//è¡¨ç¤ºè¯¥æ¡¶ä½ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä»æœªå‘ç”Ÿè¿‡Hashç¢°æ’</span></span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="comment">//ç›´æ¥è®¡ç®—å‡ºå½“å‰å…ƒç´ åº”è¯¥å­˜æ”¾åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ï¼Œç„¶åæ”¾è¿›å»</span></span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="comment">//å½“å‰çš„æ¡¶ä½å­˜æ”¾äº†ä¸€ä¸ªæ ‘</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="comment">//æ¡¶ä½å·²ç»å½¢æˆé“¾è¡¨</span></span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                    <span class="comment">//ä½ä½é“¾è¡¨ï¼šå­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ï¼Œä¸å½“å‰æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ä¸€è‡´</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                    <span class="comment">//é«˜ä½é“¾è¡¨ï¼šå­˜æ”¾å†æ‰©å®¹ä¹‹åçš„æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ä¸ºå½“å‰æ•°ç»„ä¸‹æ ‡ä½ç½®+æ‰©å®¹ä¹‹å‰æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="comment">//å¦‚æœç­‰äº0ï¼Œé‚£ä¹ˆè¯æ˜æ”¾åœ¨ä½ä½æ¡¶</span></span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">//ä¸ä¸º0åˆ™æ”¾åœ¨é«˜ä½æ¡¶</span></span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>HashMapçš„æ‰©å®¹æ˜¯ä»€ä¹ˆ?</p></blockquote><ul><li><p><strong>è¿›è¡Œæ‰©å®¹ï¼Œä¼šä¼´éšç€ä¸€æ¬¡é‡æ–°hashåˆ†é…ï¼Œå¹¶ä¸”ä¼šéå†hashè¡¨ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œæ˜¯éå¸¸è€—æ—¶çš„ã€‚åœ¨ç¼–å†™ç¨‹åºä¸­ï¼Œè¦å°½å¯èƒ½é¿å…resizeã€‚</strong></p></li><li><p><strong>HashMapåœ¨è¿›è¡Œæ‰©å®¹æ—¶ï¼Œä½¿ç”¨çš„rehashæ–¹å¼éå¸¸å·§å¦™ï¼Œå› ä¸ºæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯ç¿»å€ï¼Œä¸åŸæ¥è®¡ç®—çš„ï¼ˆn-1ï¼‰&amp;hashçš„ç»“æœç›¸æ¯”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªbitä½ï¼Œæ‰€ä»¥èŠ‚ç‚¹è¦ä¹ˆå°±åœ¨åŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆå°±è¢«åˆ†é…åˆ°â€åŸä½ç½®+æ—§å®¹é‡â€è¿™ä¸ªä½ç½®ã€‚</strong></p></li><li><p><strong>æ€ä¹ˆç†è§£å‘¢ï¼Ÿä¾‹å¦‚æˆ‘ä»¬ä»16æ‰©å±•ä¸º32æ—¶ï¼Œå…·ä½“çš„å˜åŒ–å¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210218232608.png" alt="image-20210218232607701"></p><blockquote><p><strong>æ‰©å®¹ä¹‹åçš„ç´¢å¼•ä½è¦ä¹ˆæ˜¯åŸæ¥ç´¢å¼•ï¼Œè¦ä¹ˆæ˜¯åŸæ¥ç´¢å¼•+æ—§æ•°ç»„å®¹é‡<br>å› æ­¤å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„æ ‡è®°èŒƒå›´åœ¨é«˜ä½å¤š1bitï¼ˆçº¢è‰²ï¼‰ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</strong></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210218232714.png" alt="image-20210218232713970"></p><blockquote><p>*è¯´æ˜ï¼š5æ˜¯å‡è®¾è®¡ç®—å‡ºæ¥çš„åŸæ¥çš„ç´¢å¼•ã€‚è¿™æ ·å°±éªŒè¯äº†ä¸Šè¿°æè¿°çš„ï¼šæ‰©å®¹ä¹‹åæ‰€ä»¥èŠ‚ç‚¹è¦ä¹ˆæ”¾åœ¨åŸæ¥çš„ä½ç½®ï¼Œè¦ä¹ˆè¢«åˆ†é…åˆ°<strong>â€œåŸä½ç½®+æ—§å®¹é‡â€**è¿™ä¸ªä½ç½®ã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å®¹HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¯ä»¥äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•å°±ä¸å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆ</strong>â€œåŸç´¢å¼•+oldCap(åŸä½ç½®+æ—§å®¹é‡)â€**ã€‚å¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å®¹ä¸º32çš„resizeç¤ºæ„å›¾ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210218232749.png" alt="image-20210218232749785"></p><blockquote><p>æ­£æ˜¯å› ä¸ºè¿™æ ·å·§å¦™çš„rehashæ–¹å¼ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œåœ¨resizeçš„è¿‡ç¨‹ä¸­ä¿è¯äº†rehashä¹‹åæ¯ä¸ªæ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°ä¸€å®šå°äºç­‰äºåŸæ¥æ¡¶ä¸Šçš„èŠ‚ç‚¹æ•°ï¼Œä¿è¯äº†rehashä¹‹åä¸ä¼šå‡ºç°æ›´ä¸¥é‡çš„hashå†²çªï¼Œå‡åŒ€çš„æŠŠä¹‹å‰hashå†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„æ¡¶ä¸­äº†ã€‚</p></blockquote><h3 id="3-5ã€getæ–¹æ³•åˆ†æ"><a href="#3-5ã€getæ–¹æ³•åˆ†æ" class="headerlink" title="3.5ã€getæ–¹æ³•åˆ†æ"></a>3.5ã€getæ–¹æ³•åˆ†æ</h3><blockquote><p>å®ç°æ€è·¯</p></blockquote><ul><li>è®¡ç®—ä¼ å…¥keyçš„hashå€¼</li><li>é€šè¿‡hashå€¼è·å–è¯¥keyæ˜ å°„åˆ°çš„æ¡¶</li><li>æ¡¶ä¸Šçš„keyæ­£å¥½æ˜¯è¦åˆ é™¤çš„keyï¼Œåˆ™ç›´æ¥æ‰¾åˆ°å¹¶è¿”å›</li><li>æ¡¶å•†çš„keyä¸æ˜¯è¦æ‰¾çš„keyï¼Œåˆ™æŸ¥çœ‹åç»­èŠ‚ç‚¹<ul><li>å¦‚æœåç»­èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡è°ƒç”¨çº¢é»‘æ ‘æ–¹æ³•æ ¹æ®keyè·å–value</li><li>å¦‚æœåç»­èŠ‚ç‚¹æ˜¯é“¾è¡¨èŠ‚ç‚¹ï¼Œåˆ™é€šè¿‡å¾ªç¯éå†é“¾è¡¨æ ¹æ®keyè·å–value</li></ul></li></ul><blockquote><p>getæ–¹æ³•ä¸­è°ƒç”¨äº†getNodeæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>getNodeæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//tabï¼šå¼•ç”¨å½“å‰HashMapçš„æ•£åˆ—è¡¨</span></span><br><span class="line">    <span class="comment">//firstï¼šæ¡¶ä½ä¸­çš„å¤´å…ƒç´ </span></span><br><span class="line">    <span class="comment">//eï¼šä¸´æ—¶Nodeå…ƒç´ </span></span><br><span class="line">    <span class="comment">//nï¼štableæ•°ç»„é•¿åº¦</span></span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="comment">//æ•£åˆ—è¡¨ä¸ä¸ºç©ºä¸”tableæ•°ç»„ä¸­hashå¯¹åº”çš„æ¡¶ä¸ä¸ºç©ºæ—¶æ‰è¿›è¡Œå–å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//è¯´æ˜è·¯ç”±å¯»å€å‡ºæ¥çš„æ¡¶çš„å¤´å…ƒç´ å°±æ˜¯è¦å¯»æ‰¾çš„å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="comment">//å¯»æ‰¾å‡ºæ¥çš„æ¡¶ä½ä¸æ˜¯å•ä¸ªå…ƒç´ ï¼Œä¸”å¤´å…ƒç´ ä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼Œæ­¤æ—¶æ¡¶ä½å…ƒç´ å¯èƒ½æ˜¯ä¸€æ¡é“¾è¡¨æˆ–ä¸€æ£µçº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//æ¡¶ä½å…ƒç´ å‡çº§æˆäº†çº¢é»‘æ ‘</span></span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="comment">//æ¡¶ä½å…ƒç´ æ˜¯ä¸€æ¡é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="comment">//éå†æ•´ä¸ªé“¾è¡¨ï¼Œæ‰¾åˆ°å°±è¿”å›ï¼Œå¦åˆ™è·³å‡ºå¾ªç¯è¿”å›null</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6ã€removeæ–¹æ³•åˆ†æ"><a href="#3-6ã€removeæ–¹æ³•åˆ†æ" class="headerlink" title="3.6ã€removeæ–¹æ³•åˆ†æ"></a>3.6ã€removeæ–¹æ³•åˆ†æ</h3><blockquote><p>removeæ–¹æ³•åº•å±‚è°ƒç”¨äº†removeNodeæ–¹æ³•</p><p>æ€è·¯</p></blockquote><ul><li>æ ¹æ®ä¼ å…¥çš„keyè®¡ç®—å‡ºkeyçš„hashå€¼</li><li>å†æ ¹æ®è·¯ç”±å¯»å€å…¬å¼(n - 1) &amp; hashæ‰¾åˆ°æ¡¶çš„ä½ç½®<ul><li>å¦‚æœæ‰¾åˆ°çš„æ¡¶æ˜¯é“¾è¡¨ï¼Œåˆ™éå†é“¾è¡¨ä½¿ç”¨equalsæ–¹æ³•æ‰¾åˆ°å…ƒç´ ååˆ é™¤ï¼Œ</li><li>å¦‚æœæ˜¯çº¢é»‘æ ‘å°±éœ€è¦éå†æ ‘ç„¶ååˆ é™¤å…ƒç´ ï¼Œæ¡¶å…ƒç´ å°äº6åè½¬ä¸ºé“¾è¡¨ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>)) == <span class="keyword">null</span> ?</span><br><span class="line">        <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>removeNodeæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> hash, Object key, Object value,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">boolean</span> matchValue, <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//tabï¼šå¼•ç”¨å½“å‰hashMapçš„æ•£åˆ—è¡¨</span></span><br><span class="line">       <span class="comment">//pï¼šå½“å‰nodeå…ƒç´ </span></span><br><span class="line">       <span class="comment">//nï¼šè¡¨ç¤ºæ•£åˆ—è¡¨æ•°ç»„é•¿åº¦</span></span><br><span class="line">       <span class="comment">//indexï¼šè¡¨ç¤ºå¯»å€ç»“æœ</span></span><br><span class="line">       Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, index;</span><br><span class="line">       <span class="comment">//åªæœ‰å½“æ•£åˆ—è¡¨ä¸ä¸ºç©ºä¸”tableæ•°ç»„ä¸­å¯»å€ç»“æœå¯¹åº”çš„æ¡¶ä¸ä¸ºç©ºæ—¶ï¼Œæ‰ç»§ç»­åˆ é™¤</span></span><br><span class="line">       <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">           (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">           Node&lt;K,V&gt; node = <span class="keyword">null</span>, e; K k; V v;</span><br><span class="line">           <span class="comment">//å¦‚æœå¯»å€ç»“æœå¯¹åº”çš„æ¡¶å…ƒç´ å°±æ˜¯è¦åˆ é™¤çš„Nodeï¼Œæ­¤æ—¶å°†pèµ‹å€¼ç»™node</span></span><br><span class="line">           <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">               ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">               node = p;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="comment">//è¡¨ç¤ºæ¡¶ä½ä¸­çš„å…ƒç´ æ˜¯ä¸€æ£µçº¢é»‘æ ‘</span></span><br><span class="line">               <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                   node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">               <span class="comment">//è¡¨ç¤ºæ¡¶ä½ä¸­çš„å…ƒç´ æ˜¯ä¸€æ¡é“¾è¡¨</span></span><br><span class="line">               <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">do</span> &#123;</span><br><span class="line">                       <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                           ((k = e.key) == key ||</span><br><span class="line">                            (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">                           node = e;</span><br><span class="line">                           <span class="keyword">break</span>;</span><br><span class="line">                       &#125;</span><br><span class="line">                       p = e;</span><br><span class="line">                   &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//ä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†æ‰¾åˆ°è¦åˆ é™¤çš„å…ƒç´ ï¼Œç„¶åå°†å…¶èµ‹ç»™nodeå¼•ç”¨</span></span><br><span class="line">           <span class="comment">//å½“nodeä¸ä¸ºç©ºæ—¶è¿›è¡Œåˆ é™¤</span></span><br><span class="line">           <span class="keyword">if</span> (node != <span class="keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                                (value != <span class="keyword">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">               <span class="comment">//æ ¹æ®nodeçš„ç±»å‹åˆ é™¤</span></span><br><span class="line">               <span class="comment">//nodeæ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹</span></span><br><span class="line">               <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                   ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="keyword">this</span>, tab, movable);</span><br><span class="line">               <span class="comment">//è®©table[å¯»å€ç»“æœ]æŒ‡å‘nodeçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸ºç©ºï¼Œå¯èƒ½ä¸ºä¸€ä¸ªNode</span></span><br><span class="line">               <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                   tab[index] = node.next;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                   <span class="comment">//å¦‚æœnodeåœ¨ä¸€æ¡é“¾è¡¨ä¸­ï¼Œå°±æŒ‰ç…§é“¾è¡¨çš„åˆ é™¤æ–¹å¼åˆ é™¤æ­¤node</span></span><br><span class="line">                   p.next = node.next;</span><br><span class="line">               <span class="comment">//modCount++</span></span><br><span class="line">               ++modCount;</span><br><span class="line">               <span class="comment">//æ•£åˆ—è¡¨ä¸­å…ƒç´ ä¸ªæ•°-1</span></span><br><span class="line">               --size;</span><br><span class="line">               </span><br><span class="line">               afterNodeRemoval(node);</span><br><span class="line">               <span class="keyword">return</span> node;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="3-7ã€replaceæ–¹æ³•åˆ†æ"><a href="#3-7ã€replaceæ–¹æ³•åˆ†æ" class="headerlink" title="3.7ã€replaceæ–¹æ³•åˆ†æ"></a>3.7ã€replaceæ–¹æ³•åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replace</span><span class="params">(K key, V oldValue, V newValue)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e; V v;</span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">        ((v = e.value) == oldValue || (v != <span class="keyword">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</span><br><span class="line">        e.value = newValue;</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªreplaceä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œåªæœ‰å½“keyåŒ¹é…ä¸”oldValueç­‰äºHashMapä¸­é”®å€¼å¯¹çš„å€¼æ—¶ï¼Œæ‰ä½¿ç”¨newValueè¿›è¡Œæ›¿æ¢ã€‚</p></blockquote><p>æœ¬æ–‡å‚è€ƒè‡ªï¼š</p><ul><li><p>[1]  <a href="https://www.bilibili.com/video/BV1LJ411W7dP">å°åˆ˜è®²æºç </a></p></li><li><p>[2]  <a href="https://blog.csdn.net/qq_38616503/article/details/111218480">Javaè¿›é˜¶ä¹‹HashMap</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆäº”ï¼‰-é›ªèŠ±ç®—æ³•ç”Ÿæˆå”¯ä¸€ID</title>
      <link href="posts/3410178450.html"/>
      <url>posts/3410178450.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><blockquote><p>é¢è¯•é¢˜: é›†ç¾¤é«˜å¹¶å‘æƒ…å†µä¸‹å¦‚ä½•ä¿è¯åˆ†å¸ƒå¼å”¯ä¸€å…¨å±€IDç”Ÿæˆ?</p></blockquote><h2 id="1ã€é—®é¢˜"><a href="#1ã€é—®é¢˜" class="headerlink" title="1ã€é—®é¢˜"></a>1ã€é—®é¢˜</h2><h3 id="1-1ã€ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€IDä»¥åŠåˆ†å¸ƒå¼IDçš„ä¸šåŠ¡éœ€æ±‚"><a href="#1-1ã€ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€IDä»¥åŠåˆ†å¸ƒå¼IDçš„ä¸šåŠ¡éœ€æ±‚" class="headerlink" title="1.1ã€ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€IDä»¥åŠåˆ†å¸ƒå¼IDçš„ä¸šåŠ¡éœ€æ±‚"></a>1.1ã€ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€IDä»¥åŠåˆ†å¸ƒå¼IDçš„ä¸šåŠ¡éœ€æ±‚</h3><blockquote><p>åœ¨å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹å¤§é‡çš„æ•°æ®å’Œæ¶ˆæ¯è¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚</p><p>å¦‚åœ¨ç¾å›¢ç‚¹è¯„çš„é‡‘èã€æ”¯ä»˜ã€é¤é¥®ã€é…’åº—ï¼›</p><p>çŒ«çœ¼ç”µå½±ç­‰äº§å“çš„ç³»ç»Ÿä¸­æ•°æ®æ—¥æ¸å¢é•¿ï¼Œå¯¹æ•°æ®åˆ†åº“åˆ†è¡¨åéœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€IDæ¥è¡¨ç¤ºä¸€æ¡æ•°æ®æˆ–è€…æ¶ˆæ¯ã€‚</p><p>ç‰¹åˆ«ä¸€ç‚¹çš„å¦‚è®¢å•ã€éª‘æ‰‹ã€ä¼˜æƒ åŠµä¹Ÿéƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€IDåšä¸ºæ ‡è¯†ã€‚</p><p>æ­¤æ—¶ä¸€ä¸ªèƒ½<strong>ç”Ÿæˆå”¯ä¸€IDçš„ç³»ç»Ÿæ˜¯éå¸¸å¿…è¦çš„</strong>ã€‚</p></blockquote><h3 id="1-2ã€IDç”Ÿæˆè§„åˆ™éƒ¨åˆ†ç¡¬æ€§è¦æ±‚"><a href="#1-2ã€IDç”Ÿæˆè§„åˆ™éƒ¨åˆ†ç¡¬æ€§è¦æ±‚" class="headerlink" title="1.2ã€IDç”Ÿæˆè§„åˆ™éƒ¨åˆ†ç¡¬æ€§è¦æ±‚"></a>1.2ã€IDç”Ÿæˆè§„åˆ™éƒ¨åˆ†ç¡¬æ€§è¦æ±‚</h3><ul><li>å…¨å±€å”¯ä¸€</li></ul><blockquote><p>æ—¢ç„¶æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œé‚£ä¹ˆ<strong>å…¨å±€å”¯ä¸€æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚</strong>ã€‚</p></blockquote><ul><li>è¶‹åŠ¿é€’å¢</li></ul><blockquote><p>åœ¨MySQLçš„InnoDBå¼•æ“ä¸­ä½¿ç”¨çš„æ˜¯èšé›†ç´¢å¼•ï¼Œç”±äºå¤šæ•°RDBMSä½¿ç”¨Btreeçš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œåœ¨ä¸»é”®çš„é€‰æ‹©ä¸Šé¢æˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨æœ‰åºçš„ä¸»é”®æ¥ä¿è¯å†™å…¥æ€§èƒ½ã€‚</p></blockquote><ul><li>å•è°ƒé€’å¢</li></ul><blockquote><p>ä¿è¯ä¸‹ä¸€ä¸ªIDä¸€å®šå¤§äºä¸Šä¸€ä¸ªIDï¼Œä¾‹å¦‚äº‹åŠ¡ç‰ˆæœ¬å·ã€IMå¢é‡æ¶ˆæ¯ã€æ’åºç­‰ç‰¹æ®Šéœ€æ±‚ã€‚</p></blockquote><ul><li>ä¿¡æ¯å®‰å…¨</li></ul><blockquote><p>å¦‚æœIDæ˜¯è¿ç»­çš„ï¼Œé‚£ä¹ˆæ¶æ„ç”¨æˆ·çš„æ‰’å–å·¥ä½œå°±éå¸¸å®¹æ˜“åšäº†ï¼Œç›´æ¥æŒ‰ç…§é¡ºåºä¸‹è½½æŒ‡å®šURLå³å¯ï¼›</p><p>å¦‚æœæ˜¯è®¢å•å·é‚£ä¹ˆæ›´åŠ å±é™©ï¼Œç«äº‰å¯¹æ‰‹å¯ä»¥çŸ¥é“æˆ‘ä»¬ä¸€å¤©çš„å•é‡ã€‚</p><p>æ‰€ä»¥åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œéœ€è¦IDæ— è§„åˆ™ä¸è§„åˆ™ï¼Œè®©ç«äº‰å¯¹æ‰‹ä¸å¥½çŒœã€‚</p></blockquote><ul><li>å«æ—¶é—´æˆ³</li></ul><blockquote><p>è¿™æ ·å°±èƒ½åœ¨å¼€å‘ä¸­å¿«é€Ÿäº†è§£è¿™ä¸ªåˆ†å¸ƒå¼IDçš„ç”Ÿæˆæ—¶é—´ã€‚</p></blockquote><h3 id="1-3ã€IDç”Ÿæˆç³»ç»Ÿçš„å¯ç”¨æ€§è¦æ±‚"><a href="#1-3ã€IDç”Ÿæˆç³»ç»Ÿçš„å¯ç”¨æ€§è¦æ±‚" class="headerlink" title="1.3ã€IDç”Ÿæˆç³»ç»Ÿçš„å¯ç”¨æ€§è¦æ±‚"></a>1.3ã€IDç”Ÿæˆç³»ç»Ÿçš„å¯ç”¨æ€§è¦æ±‚</h3><ul><li>é«˜å¯ç”¨</li></ul><blockquote><p>å‘ä¸€ä¸ªè·å–åˆ†å¸ƒå¼IDçš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±è¦ä¿è¯99.999%çš„æƒ…å†µä¸‹ç»™æˆ‘åˆ›å»ºä¸€ä¸ªå”¯ä¸€åˆ†å¸ƒå¼ID</p></blockquote><ul><li>ä½å»¶è¿Ÿ</li></ul><blockquote><p>å‘ä¸€ä¸ªè·å–åˆ†å¸ƒå¼IDçš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±è¦å¿«ï¼Œæé€Ÿ</p></blockquote><ul><li>é«˜QPS</li></ul><blockquote><p>å‡å¦‚å¹¶å‘ä¸€å£æ°”10ä¸‡ä¸ªåˆ›å»ºåˆ†å¸ƒå¼IDè¯·æ±‚åŒæ—¶è¿‡æ¥ï¼ŒæœåŠ¡å™¨éœ€è¦é¡¶å¾—ä½ä¸”æˆåŠŸåˆ›å»º10ä¸‡ä¸ªåˆ†å¸ƒå¼ID</p></blockquote><h2 id="2ã€ä¸€èˆ¬é€šç”¨æ–¹æ¡ˆ"><a href="#2ã€ä¸€èˆ¬é€šç”¨æ–¹æ¡ˆ" class="headerlink" title="2ã€ä¸€èˆ¬é€šç”¨æ–¹æ¡ˆ"></a>2ã€ä¸€èˆ¬é€šç”¨æ–¹æ¡ˆ</h2><h3 id="2-1ã€UUID"><a href="#2-1ã€UUID" class="headerlink" title="2.1ã€UUID"></a>2.1ã€UUID</h3><ul><li>æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String uuid = UUID.randomUUID().toString();</span><br><span class="line">    System.out.println(uuid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217110837.png" alt="image-20210217110837065"></p><blockquote><p>å¦‚æœåªæ˜¯è€ƒè™‘å”¯ä¸€æ€§ï¼Œé‚£ä¹ˆUUIDåŸºæœ¬å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚</p></blockquote><ul><li>ç¼ºç‚¹ï¼šå…¥æ•°æ®åº“æ€§èƒ½å·®ï¼ŒåŸå› å¦‚ä¸‹</li></ul><blockquote><p>1 æ— åºï¼Œæ— æ³•é¢„æµ‹ä»–çš„ç”Ÿæˆé¡ºåºï¼Œä¸èƒ½ç”Ÿæˆé€’å¢æœ‰åºçš„æ•°å­—</p><p>2 ä¸»é”®ï¼ŒIDä½œä¸ºä¸»é”®æ—¶åœ¨ç‰¹å®šçš„ç¯å¢ƒä¸‹ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚åšDBä¸»é”®çš„åœºæ™¯ä¸‹ï¼ŒUUIDéå¸¸ä¸é€‚ç”¨ï¼ŒMySQLå®˜æ–¹æœ‰æ˜ç¡®çš„å»ºè®®ä¸»é”®è¦å°½é‡è¶ŠçŸ­è¶Šå¥½ï¼Œ36ä½çš„UUIDä¸åˆè¦æ±‚ã€‚</p><p>3 ç´¢å¼•ï¼Œä¼šå¯¼è‡´B+æ ‘ç´¢å¼•çš„åˆ†è£‚ã€‚</p></blockquote><h3 id="2-2ã€æ•°æ®åº“è‡ªå¢ä¸»é”®"><a href="#2-2ã€æ•°æ®åº“è‡ªå¢ä¸»é”®" class="headerlink" title="2.2ã€æ•°æ®åº“è‡ªå¢ä¸»é”®"></a>2.2ã€æ•°æ®åº“è‡ªå¢ä¸»é”®</h3><blockquote><p>åœ¨é«˜å¹¶å‘é›†ç¾¤ä¸Šæ­¤ç­–ç•¥ä¸å¯ç”¨ã€‚</p></blockquote><h3 id="2-3ã€åŸºäºRedisç”Ÿæˆå…¨å±€IDç­–ç•¥"><a href="#2-3ã€åŸºäºRedisç”Ÿæˆå…¨å±€IDç­–ç•¥" class="headerlink" title="2.3ã€åŸºäºRedisç”Ÿæˆå…¨å±€IDç­–ç•¥"></a>2.3ã€åŸºäºRedisç”Ÿæˆå…¨å±€IDç­–ç•¥</h3><ul><li>å› ä¸ºRedisæ˜¯å•çº¿ç¨‹ï¼Œå¤©ç”Ÿä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨INCRå’ŒINCRBYæ¥å®ç°ã€‚</li><li>é›†ç¾¤åˆ†å¸ƒå¼</li></ul><blockquote><p>åœ¨Redisé›†ç¾¤ä¸‹ï¼ŒåŒæ ·å’ŒMySQLä¸€æ ·éœ€è¦<strong>è®¾ç½®ä¸åŒçš„å¢é•¿æ­¥æ•°</strong>ï¼ŒåŒæ—¶keyéœ€è¦è®¾ç½®æœ‰æ•ˆæœŸã€‚</p><p>å¯ä»¥ä½¿ç”¨Redisé›†ç¾¤æ¥è·å–æ›´é«˜çš„ååé‡ã€‚</p><p>å‡å¦‚ä¸€ä¸ªé›†ç¾¤ä¸­æœ‰äº”ä¸ªRedisï¼Œé‚£ä¹ˆåˆå§‹åŒ–æ¯å°Redisæ­¥é•¿åˆ†åˆ«æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œç„¶åæ­¥é•¿éƒ½æ˜¯5ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217113313.png" alt="image-20210217113312811"></p><h2 id="3ã€snowflake"><a href="#3ã€snowflake" class="headerlink" title="3ã€snowflake"></a>3ã€snowflake</h2><h3 id="3-1ã€æ¦‚è¿°"><a href="#3-1ã€æ¦‚è¿°" class="headerlink" title="3.1ã€æ¦‚è¿°"></a>3.1ã€æ¦‚è¿°</h3><ul><li><p>é›ªèŠ±ç®—æ³•æ˜¯æ¨ç‰¹çš„åˆ†å¸ƒå¼å”¯ä¸€IDç”Ÿæˆç®—æ³•ã€‚</p></li><li><p>ç»æµ‹è¯•é›ªèŠ±ç®—æ³•æ¯ç§’é’Ÿå¯ä»¥ç”Ÿäº§26ä¸‡ä¸ªè‡ªå¢å¯æ’åºçš„ID</p></li></ul><blockquote><p>1 æ¨ç‰¹çš„é›ªèŠ±ç®—æ³•ç”ŸæˆIDèƒ½å¤ŸæŒ‰ç…§æ—¶é—´æœ‰åºç”Ÿæˆã€‚</p><p>2 é›ªèŠ±ç®—æ³•ç”ŸæˆIDçš„ç»“æœæ˜¯ä¸€ä¸ª64bitå¤§å°çš„æ•´æ•°ï¼Œä¸ºä¸€ä¸ªLongå‹ï¼ˆè½¬æ¢ä¸ºå­—ç¬¦ä¸²åé•¿åº¦æœ€å¤š19ï¼‰</p><p>3 åˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’ï¼ˆç”±datecenterå’ŒworkerIdä½œåŒºåˆ†ï¼‰ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ã€‚</p></blockquote><ul><li>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€äº›éœ€è¦ä½¿ç”¨å…¨å±€å”¯ä¸€IDçš„åœºæ™¯ï¼Œç”ŸæˆIDçš„åŸºæœ¬éœ€æ±‚</li></ul><blockquote><p>1 åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¿…é¡»å…¨å±€ä¸”å”¯ä¸€ã€‚</p><p>2 ä¸€èˆ¬éƒ½éœ€è¦å•è°ƒé€’å¢ï¼Œå› ä¸ºä¸€èˆ¬å”¯ä¸€IDéƒ½ä¼šå­˜åˆ°æ•°æ®åº“ï¼Œè€Œlnnodbçš„ç‰¹æ€§å°±æ˜¯å°†å†…å®¹å­˜å‚¨åœ¨ä¸»é”®ç´¢å¼•æ ‘ä¸Šçš„å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”æ˜¯ä»å·¦å¾€å³ï¼Œé€’å¢çš„ï¼Œæ‰€ä»¥è€ƒè™‘åˆ°æ•°æ®åº“æ€§èƒ½ï¼Œä¸€èˆ¬ç”Ÿæˆçš„idä¹Ÿæœ€å¥½æ˜¯å•è°ƒé€’å¢ã€‚ä¸ºäº†é˜²æ­¢IDå†²çªå¯ä»¥ä½¿ç”¨36ä½çš„UUIDï¼Œä½†æ˜¯UUIDæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œé¦–å…ˆä»–ç›¸å¯¹æ¯”è¾ƒé•¿ï¼Œå¦å¤–UUIDèˆ¬æ˜¯æ— åºçš„ã€‚</p><p>3 å¯èƒ½è¿˜ä¼šéœ€è¦æ— è§„åˆ™ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨å”¯ä¸€lDä½œä¸ºè®¢å•å·è¿™ç§ï¼Œä¸ºäº†ä¸ç„¶åˆ«äººçŸ¥é“ä¸€å¤©çš„è®¢å•é‡æ˜¯å¤šå°‘ï¼Œå°±éœ€è¦è¿™ä¸ªè§„åˆ™ã€‚</p></blockquote><h3 id="3-2ã€ç»“æ„"><a href="#3-2ã€ç»“æ„" class="headerlink" title="3.2ã€ç»“æ„"></a>3.2ã€ç»“æ„</h3><blockquote><p>é›ªèŠ±ç®—æ³•çš„å‡ ä¸ªæ ¸å¿ƒç»„æˆéƒ¨åˆ†</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217114752.png" alt="image-20210217114752319"></p><blockquote><p>å·æ®µè§£æ</p></blockquote><ul><li><p>1bitç¬¦å·ä½ï¼šä¸ç”¨ï¼Œå› ä¸ºäºŒè¿›åˆ¶æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ1è¡¨ç¤ºè´Ÿæ•°ï¼Œ0è¡¨ç¤ºæ­£æ•°ï¼Œç”Ÿæˆçš„idä¸€èˆ¬éƒ½æ˜¯ç”¨æ­£æ•°ï¼Œæ‰€ä»¥æœ€é«˜ä½å›ºå®šä½0</p></li><li><p>41bitæ—¶é—´æˆ³ï¼Œç”¨äºè®°å½•æ—¶é—´æˆ³ï¼Œæ¯«ç§’çº§</p><ul><li>41ä½å¯ä»¥è¡¨ç¤º2^41 - 1ä¸ªæ•°å­—</li><li>å¦‚æœåªç”¨æ¥è¡¨ç¤ºæ­£æ•´æ•°ï¼ˆè®¡ç®—æœºæ­£æ•°åŒ…å«0ï¼‰ï¼Œå¯ä»¥è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´æ˜¯0-2^41 - 1ï¼Œ<strong>å‡ä¸€æ˜¯å› ä¸ºå¯è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´æ˜¯ä»0å¼€å§‹ç®—çš„ï¼Œè€Œä¸æ˜¯1</strong></li><li>ä¹Ÿå°±æ˜¯è¯´41ä½å¯ä»¥è¡¨ç¤º2^41 - 1ä¸ªæ¯«ç§’çš„å€¼ï¼Œè½¬æ¢ä¸ºå•ä½å¹´åˆ™æ˜¯69å¹´ã€‚</li></ul></li><li><p>10bitå·¥ä½œè¿›ç¨‹ä½ï¼Œç”¨äºè®°å½•å·¥ä½œæœºå™¨id</p><ul><li>å¯ä»¥éƒ¨ç½²åœ¨2^10 = 1024ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬äº”ä½datacenterIdå’Œäº”ä½workerId</li><li>äº”ä½å¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ•´æ•°ä½2^5 - 1 = 31ï¼Œå³å¯ä»¥ä½¿ç”¨0ï¼Œ1ï¼Œ2â€¦31è¿™32ä¸ªæ•°å­—æ¥è¡¨ç¤ºä¸åŒçš„datacenterIdå’ŒworkerId</li></ul></li><li><p>12bitåºåˆ—å·ï¼Œåºåˆ—å·ï¼Œç”¨æ¥è®°å½•åŒ<strong>æ¯«ç§’å†…</strong> äº§ç”Ÿçš„ä¸åŒçš„ID</p><ul><li>12bitå¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ­£æ•´æ•°ä½2^12 - 1 = 4095ï¼Œå³å¯ä»¥è¡¨ç¤º0ï¼Œ1â€¦.4094è¿™4095ä¸ªæ•°å­—</li><li>è¡¨ç¤ºåŒä¸€æœºå™¨åŒä¸€æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ä¸­äº§ç”Ÿçš„4095ä¸ªIDåºå·</li></ul></li></ul><blockquote><p>é›ªèŠ±ç®—æ³•å¯ä»¥ä¿è¯</p></blockquote><ul><li>æ‰€æœ‰ç”Ÿæˆçš„idæŒ‰æ—¶é—´è¶‹åŠ¿é€’å¢</li><li>æ•´ä¸ªåˆ†å¸ƒå¼å†…ä¸ä¼šäº§ç”Ÿé‡å¤idï¼Œå› ä¸ºæœ‰datacenterIdå’ŒworkerIdæ¥åšåŒºåˆ†ã€‚</li></ul><h3 id="3-3ã€æºç "><a href="#3-3ã€æºç " class="headerlink" title="3.3ã€æºç "></a>3.3ã€æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * twitterçš„snowflakeç®—æ³• -- javaå®ç°</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> beyond</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2016/11/26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SnowFlake</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èµ·å§‹çš„æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> START_STMP = <span class="number">1480166465631L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯ä¸€éƒ¨åˆ†å ç”¨çš„ä½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> SEQUENCE_BIT = <span class="number">12</span>; <span class="comment">//åºåˆ—å·å ç”¨çš„ä½æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MACHINE_BIT = <span class="number">5</span>;   <span class="comment">//æœºå™¨æ ‡è¯†å ç”¨çš„ä½æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> DATACENTER_BIT = <span class="number">5</span>;<span class="comment">//æ•°æ®ä¸­å¿ƒå ç”¨çš„ä½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯ä¸€éƒ¨åˆ†çš„æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MAX_DATACENTER_NUM = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; DATACENTER_BIT);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MAX_MACHINE_NUM = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; MACHINE_BIT);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MAX_SEQUENCE = -<span class="number">1L</span> ^ (-<span class="number">1L</span> &lt;&lt; SEQUENCE_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯ä¸€éƒ¨åˆ†å‘å·¦çš„ä½ç§»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> MACHINE_LEFT = SEQUENCE_BIT;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> DATACENTER_LEFT = SEQUENCE_BIT + MACHINE_BIT;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> TIMESTMP_LEFT = DATACENTER_LEFT + DATACENTER_BIT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> datacenterId;  <span class="comment">//æ•°æ®ä¸­å¿ƒ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> machineId;     <span class="comment">//æœºå™¨æ ‡è¯†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> sequence = <span class="number">0L</span>; <span class="comment">//åºåˆ—å·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> lastStmp = -<span class="number">1L</span>;<span class="comment">//ä¸Šä¸€æ¬¡æ—¶é—´æˆ³</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SnowFlake</span><span class="params">(<span class="keyword">long</span> datacenterId, <span class="keyword">long</span> machineId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (datacenterId &gt; MAX_DATACENTER_NUM || datacenterId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;datacenterId can&#x27;t be greater than MAX_DATACENTER_NUM or less than 0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (machineId &gt; MAX_MACHINE_NUM || machineId &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;machineId can&#x27;t be greater than MAX_MACHINE_NUM or less than 0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.datacenterId = datacenterId;</span><br><span class="line">        <span class="keyword">this</span>.machineId = machineId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äº§ç”Ÿä¸‹ä¸€ä¸ªID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">long</span> <span class="title">nextId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> currStmp = getNewstmp();</span><br><span class="line">        <span class="keyword">if</span> (currStmp &lt; lastStmp) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Clock moved backwards.  Refusing to generate id&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currStmp == lastStmp) &#123;</span><br><span class="line">            <span class="comment">//ç›¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·è‡ªå¢</span></span><br><span class="line">            sequence = (sequence + <span class="number">1</span>) &amp; MAX_SEQUENCE;</span><br><span class="line">            <span class="comment">//åŒä¸€æ¯«ç§’çš„åºåˆ—æ•°å·²ç»è¾¾åˆ°æœ€å¤§</span></span><br><span class="line">            <span class="keyword">if</span> (sequence == <span class="number">0L</span>) &#123;</span><br><span class="line">                currStmp = getNextMill();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//ä¸åŒæ¯«ç§’å†…ï¼Œåºåˆ—å·ç½®ä¸º0</span></span><br><span class="line">            sequence = <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lastStmp = currStmp;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (currStmp - START_STMP) &lt;&lt; TIMESTMP_LEFT <span class="comment">//æ—¶é—´æˆ³éƒ¨åˆ†</span></span><br><span class="line">                | datacenterId &lt;&lt; DATACENTER_LEFT       <span class="comment">//æ•°æ®ä¸­å¿ƒéƒ¨åˆ†</span></span><br><span class="line">                | machineId &lt;&lt; MACHINE_LEFT             <span class="comment">//æœºå™¨æ ‡è¯†éƒ¨åˆ†</span></span><br><span class="line">                | sequence;                             <span class="comment">//åºåˆ—å·éƒ¨åˆ†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">getNextMill</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> mill = getNewstmp();</span><br><span class="line">        <span class="keyword">while</span> (mill &lt;= lastStmp) &#123;</span><br><span class="line">            mill = getNewstmp();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mill;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">getNewstmp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SnowFlake snowFlake = <span class="keyword">new</span> SnowFlake(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="number">1</span> &lt;&lt; <span class="number">12</span>); i++) &#123;</span><br><span class="line">            System.out.println(snowFlake.nextId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ï¼Œä½¿ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆid</p></blockquote><ul><li>æ„é€ SnowFlakeå¯¹è±¡ï¼Œæ„é€ æ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ªdatacenterIdå’ŒworkerId</li><li>ä½¿ç”¨SnowFlakeå¯¹è±¡çš„nextIdæ–¹æ³•ç”Ÿæˆå”¯ä¸€Id</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•ä½¿ç”¨é›ªèŠ±ç®—æ³•ç”ŸæˆID</span></span><br><span class="line"><span class="comment">//æ„é€ å‡½æ•°ä¸­ä¼ å…¥datacenterIdå’ŒworkerId</span></span><br><span class="line">SnowFlake snowFlake = <span class="keyword">new</span> SnowFlake(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">long</span> id = snowFlake.nextId();</span><br><span class="line">    System.out.println(<span class="string">&quot;idï¼š&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + String.valueOf(id).length() + <span class="string">&quot;ä½&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;------------------------------------------&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217143342.png" alt="image-20210217143341390"></p><h3 id="3-4ã€Spring-Bootæ•´åˆé›ªèŠ±ç®—æ³•"><a href="#3-4ã€Spring-Bootæ•´åˆé›ªèŠ±ç®—æ³•" class="headerlink" title="3.4ã€Spring Bootæ•´åˆé›ªèŠ±ç®—æ³•"></a>3.4ã€Spring Bootæ•´åˆé›ªèŠ±ç®—æ³•</h3><blockquote><p>å¼•å…¥<strong>hutool-all</strong>ï¼Œmavenä¾èµ–å¼•å…¥å¦‚ä¸‹</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨SnowFlakeå¯¹è±¡çš„nextIdæ–¹æ³•å³å¯ç”Ÿæˆå”¯ä¸€ID</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ªSnowFlakeé…ç½®ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SnowFlakeConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;application.datacenterId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long datacenterId;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;application.workerId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long workerId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æ³¨å…¥ä¸€ä¸ªç”Ÿæˆé›ªèŠ±IDçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Snowflake <span class="title">snowflake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Snowflake(workerId,datacenterId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ymlé…ç½®æ–‡ä»¶</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">application:</span></span><br><span class="line">  <span class="attr">datacenterId:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">workerId:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7777</span></span><br></pre></td></tr></table></figure><ul><li>Serviceå±‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Snowflake snowflake;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIdBySnowFlake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(snowflake.nextId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Controllerå±‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/snowflake&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderService.getIdBySnowFlake();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼Œè®¿é—®<a href="http://localhost:7777/snowflake">http://localhost:7777/snowflake</a></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210217151414.png" alt="image-20210217151414112"></p><h3 id="3-4ã€ä¼˜ç‚¹"><a href="#3-4ã€ä¼˜ç‚¹" class="headerlink" title="3.4ã€ä¼˜ç‚¹"></a>3.4ã€ä¼˜ç‚¹</h3><blockquote><ul><li>æ¯«ç§’æ•°åœ¨é«˜ä½ï¼Œè‡ªå¢åºåˆ—åœ¨ä½ä½ï¼Œæ•´ä¸ªIDéƒ½æ˜¯è¶‹åŠ¿é€’å¢çš„</li><li>ä¸ä¾èµ–æ•°æ®åº“ã€redisç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”ŸæˆIDçš„æ€§èƒ½ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚</li><li>å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡åˆ†é…bitä½ï¼Œéå¸¸çµæ´»ã€‚</li></ul></blockquote><h3 id="3-5ã€ç¼ºç‚¹"><a href="#3-5ã€ç¼ºç‚¹" class="headerlink" title="3.5ã€ç¼ºç‚¹"></a>3.5ã€ç¼ºç‚¹</h3><blockquote><ul><li><strong>ä¾èµ–æœºå™¨æ—¶é’Ÿï¼Œå¦‚æœæœºå™¨æ—¶é’Ÿå›é€€ï¼Œä¼šå¯¼è‡´é‡å¤IDç”Ÿæˆ</strong></li><li>åœ¨å•æœºä¸Šæ˜¯é€’å¢çš„ï¼Œä½†æ˜¯ç”±äºè®¾è®¡åˆ°åˆ†å¸ƒå¼ç¯å¢ƒï¼Œæ¯å°æœºå™¨ä¸Šçš„æ—¶é’Ÿä¸å¯èƒ½å®Œå…¨åŒæ­¥ï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°ä¸æ˜¯å…¨å±€é€’å¢çš„æƒ…å†µã€‚ï¼ˆæ­¤ç¼ºç‚¹å¯ä»¥è®¤ä¸ºèŠœé”èƒƒï¼Œä¸€èˆ¬åˆ†å¸ƒå¼IDåªè¦æ±‚è¶‹åŠ¿é€’å¢ï¼Œå¹¶ä¸ä¼šä¸¥æ ¼è¦æ±‚é€’å¢ï¼Œ90%çš„éœ€æ±‚éƒ½åªéœ€è¦è¶‹åŠ¿é€’å¢ï¼‰</li></ul></blockquote><h2 id="4ã€å…¶ä»–è¡¥å……"><a href="#4ã€å…¶ä»–è¡¥å……" class="headerlink" title="4ã€å…¶ä»–è¡¥å……"></a>4ã€å…¶ä»–è¡¥å……</h2><blockquote><p>é›ªèŠ±ç®—æ³•çš„æ”¹è¿›æ–¹æ¡ˆï¼š</p></blockquote><ul><li>ç™¾åº¦å¼€æºçš„åˆ†å¸ƒå¼å”¯ä¸€IDç”Ÿæˆå™¨UidGenerator</li><li>Leafâ€“ç¾å›¢ç‚¹è¯„åˆ†å¸ƒå¼IDç”Ÿæˆç³»ç»Ÿ</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> â„é›ªèŠ±ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloudå­¦ä¹ ï¼ˆäº”ï¼‰-NacosæœåŠ¡æ³¨å†Œä¸é…ç½®ä¸­å¿ƒ</title>
      <link href="posts/87309235.html"/>
      <url>posts/87309235.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€Nacosç®€ä»‹"><a href="#ä¸€ã€Nacosç®€ä»‹" class="headerlink" title="ä¸€ã€Nacosç®€ä»‹"></a>ä¸€ã€Nacosç®€ä»‹</h1><h2 id="1-1ã€ä¸ºä»€ä¹ˆå«Nacosï¼Ÿ"><a href="#1-1ã€ä¸ºä»€ä¹ˆå«Nacosï¼Ÿ" class="headerlink" title="1.1ã€ä¸ºä»€ä¹ˆå«Nacosï¼Ÿ"></a>1.1ã€ä¸ºä»€ä¹ˆå«Nacosï¼Ÿ</h2><blockquote><p>å‰å››ä¸ªå­—æ¯åˆ†åˆ«ä¸ºNamingå’ŒConfigurationçš„å‰ä¸¤ä¸ªå­—æ¯ï¼Œæœ€åçš„sä¸ºServiceã€‚</p></blockquote><h2 id="1-2ã€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-2ã€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.2ã€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.2ã€æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote><p>ä¸€ä¸ªæ›´æ˜“äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ï¼Œé…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†ä¸­å¿ƒ</p><p><strong>Nacos</strong>å°±æ˜¯<strong>æ³¨å†Œä¸­å¿ƒ</strong>+<strong>é…ç½®ä¸­å¿ƒ</strong>çš„ç»„åˆ</p></blockquote><h2 id="1-3ã€èƒ½å¹²å˜›ï¼Ÿ"><a href="#1-3ã€èƒ½å¹²å˜›ï¼Ÿ" class="headerlink" title="1.3ã€èƒ½å¹²å˜›ï¼Ÿ"></a>1.3ã€èƒ½å¹²å˜›ï¼Ÿ</h2><blockquote><p>æ›¿ä»£EurekaåšæœåŠ¡æ³¨å†Œä¸­å¿ƒ</p><p>æ›¿ä»£Configåšå¾®æœåŠ¡é…ç½®ä¸­å¿ƒ</p></blockquote><h1 id="äºŒã€å®‰è£…å¹¶è¿è¡ŒNacos"><a href="#äºŒã€å®‰è£…å¹¶è¿è¡ŒNacos" class="headerlink" title="äºŒã€å®‰è£…å¹¶è¿è¡ŒNacos"></a>äºŒã€å®‰è£…å¹¶è¿è¡ŒNacos</h1><blockquote><p>è¿›å…¥Nacosçš„å®˜ç½‘ä¸‹è½½ï¼Œåœ°å€ï¼š<a href="http://nacos.io/">http://nacos.io</a></p></blockquote><ul><li>å¯åŠ¨ï¼Œæ‰“å¼€nacos/binï¼Œwindowsç¯å¢ƒä¸‹ç‚¹å‡»startup.cmdå¯åŠ¨nacos</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215154748.png" alt="image-20210215154741130"></p><ul><li>å¯åŠ¨åè®¿é—®localhost:8848/nacoså¯åŠ¨nacos</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215154854.png" alt="image-20210215154854073"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215154937.png" alt="image-20210215154937350"></p><ul><li>ç™»å½•åé¡µé¢å¦‚ä¸‹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215155000.png" alt="image-20210215155000197"></p><h1 id="ä¸‰ã€Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"><a href="#ä¸‰ã€Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="ä¸‰ã€Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º"></a>ä¸‰ã€Nacosä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒæ¼”ç¤º</h1><h2 id="3-1ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æä¾›è€…"><a href="#3-1ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æä¾›è€…" class="headerlink" title="3.1ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æä¾›è€…"></a>3.1ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æä¾›è€…</h2><h3 id="1ã€æ–°å»ºModule"><a href="#1ã€æ–°å»ºModule" class="headerlink" title="1ã€æ–°å»ºModule"></a>1ã€æ–°å»ºModule</h3><blockquote><p>æ–°å»ºcloudalibaba-provider-payment9001</p></blockquote><h3 id="2ã€å¼•å…¥ä¾èµ–"><a href="#2ã€å¼•å…¥ä¾èµ–" class="headerlink" title="2ã€å¼•å…¥ä¾èµ–"></a>2ã€å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"><a href="#3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶" class="headerlink" title="3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"></a>3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-payment-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#é…ç½®Nacosåœ°å€</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="4ã€ä¸»å¯åŠ¨ç±»"><a href="#4ã€ä¸»å¯åŠ¨ç±»" class="headerlink" title="4ã€ä¸»å¯åŠ¨ç±»"></a>4ã€ä¸»å¯åŠ¨ç±»</h3><blockquote><p>åœ¨éœ€è¦æ³¨å†Œå…¥æ³¨å†Œä¸­å¿ƒçš„æ¨¡å—ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableDiscoveryClientæ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentMain9001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentMain9001.class,args);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost:8848/nacos&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€ä¸šåŠ¡ç±»"><a href="#5ã€ä¸šåŠ¡ç±»" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPayment</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;nacos registry, serverPort: &quot;</span>+ serverPort+<span class="string">&quot;\t id&quot;</span>+id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€å¯åŠ¨9001å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°"><a href="#6ã€å¯åŠ¨9001å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°" class="headerlink" title="6ã€å¯åŠ¨9001å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°"></a>6ã€å¯åŠ¨9001å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215161607.png" alt="image-20210215161605817"></p><h3 id="7ã€ä»¿ç…§9001åˆ›å»º9002å¾®æœåŠ¡ï¼Œå¯åŠ¨æŸ¥çœ‹ç»“æœ"><a href="#7ã€ä»¿ç…§9001åˆ›å»º9002å¾®æœåŠ¡ï¼Œå¯åŠ¨æŸ¥çœ‹ç»“æœ" class="headerlink" title="7ã€ä»¿ç…§9001åˆ›å»º9002å¾®æœåŠ¡ï¼Œå¯åŠ¨æŸ¥çœ‹ç»“æœ"></a>7ã€ä»¿ç…§9001åˆ›å»º9002å¾®æœåŠ¡ï¼Œå¯åŠ¨æŸ¥çœ‹ç»“æœ</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215162714.png" alt="image-20210215162714116"></p><h2 id="3-2ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…"><a href="#3-2ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="3.2ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…"></a>3.2ã€åˆ›å»ºåŸºäºNacosçš„æœåŠ¡æ¶ˆè´¹è€…</h2><h3 id="1ã€æ–°å»ºModule-1"><a href="#1ã€æ–°å»ºModule-1" class="headerlink" title="1ã€æ–°å»ºModule"></a>1ã€æ–°å»ºModule</h3><blockquote><p>æ–°å»ºcloudalibaba-consumer-nacos-order83</p></blockquote><h3 id="2ã€å¼•å…¥ä¾èµ–-1"><a href="#2ã€å¼•å…¥ä¾èµ–-1" class="headerlink" title="2ã€å¼•å…¥ä¾èµ–"></a>2ã€å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringCloud ailibaba nacos --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆNacosæ”¯æŒè´Ÿè½½å‡è¡¡?</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215164039.png" alt="image-20210215164039536"></p><h3 id="3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶-1"><a href="#3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶-1" class="headerlink" title="3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"></a>3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">83</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-order-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"><span class="comment"># æ¶ˆè´¹è€…è¦è®¿é—®çš„æœåŠ¡æä¾›è€…ã€‚</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">nacos-user-service:</span> <span class="string">http://nacos-payment-provider</span></span><br></pre></td></tr></table></figure><h3 id="4ã€ä¸»å¯åŠ¨ç±»-1"><a href="#4ã€ä¸»å¯åŠ¨ç±»-1" class="headerlink" title="4ã€ä¸»å¯åŠ¨ç±»"></a>4ã€ä¸»å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderNacosMain83</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderNacosMain83.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€ä¸šåŠ¡ç±»-1"><a href="#5ã€ä¸šåŠ¡ç±»-1" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h3><blockquote><p>OrderNacosController</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderNacosController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;service-url.nacos-user-service&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverURL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/consumer/payment/nacos/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(serverURL+<span class="string">&quot;/payment/nacos/&quot;</span>+id,String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ApplicationContextConfig</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationContextConfig</span></span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€å¯åŠ¨83å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°"><a href="#6ã€å¯åŠ¨83å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°" class="headerlink" title="6ã€å¯åŠ¨83å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°"></a>6ã€å¯åŠ¨83å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹nacosæ§åˆ¶å°</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215165717.png" alt="image-20210215165716365"></p><h3 id="7ã€ä½¿ç”¨83æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æä¾›æ–¹"><a href="#7ã€ä½¿ç”¨83æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æä¾›æ–¹" class="headerlink" title="7ã€ä½¿ç”¨83æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æä¾›æ–¹"></a>7ã€ä½¿ç”¨83æ¶ˆè´¹è€…è°ƒç”¨æœåŠ¡æä¾›æ–¹</h3><blockquote><p>è®¿é—®<a href="http://localhost:83/consumer/payment/nacos/13">http://localhost:83/consumer/payment/nacos/13</a></p></blockquote><ul><li>ç¬¬ä¸€æ¬¡</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215165922.png" alt="image-20210215165922630"></p><ul><li>ç¬¬äºŒæ¬¡</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215165950.png" alt="image-20210215165950241"></p><blockquote><p>è¿™æ ·å°±å®ç°äº†è´Ÿè½½å‡è¡¡å’Œè¿œç¨‹è°ƒç”¨</p></blockquote><h2 id="3-3ã€å„ç§æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"><a href="#3-3ã€å„ç§æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”" class="headerlink" title="3.3ã€å„ç§æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”"></a>3.3ã€å„ç§æœåŠ¡æ³¨å†Œä¸­å¿ƒå¯¹æ¯”</h2><h3 id="1ã€Nacoså…¨æ™¯å›¾"><a href="#1ã€Nacoså…¨æ™¯å›¾" class="headerlink" title="1ã€Nacoså…¨æ™¯å›¾"></a>1ã€Nacoså…¨æ™¯å›¾</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215171620.png" alt="img"></p><h3 id="2ã€Nacoså’ŒCAP"><a href="#2ã€Nacoså’ŒCAP" class="headerlink" title="2ã€Nacoså’ŒCAP"></a>2ã€Nacoså’ŒCAP</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215171729.png" alt="image-20210215171729262"></p><h1 id="å››ã€Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"><a href="#å››ã€Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º" class="headerlink" title="å››ã€Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º"></a>å››ã€Nacosä½œä¸ºæœåŠ¡é…ç½®ä¸­å¿ƒæ¼”ç¤º</h1><h2 id="4-1ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åŸºç¡€é…ç½®"><a href="#4-1ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åŸºç¡€é…ç½®" class="headerlink" title="4.1ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åŸºç¡€é…ç½®"></a>4.1ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åŸºç¡€é…ç½®</h2><h3 id="1ã€æ–°å»ºModule-2"><a href="#1ã€æ–°å»ºModule-2" class="headerlink" title="1ã€æ–°å»ºModule"></a>1ã€æ–°å»ºModule</h3><blockquote><p>åˆ›å»ºå¾®æœåŠ¡æ¨¡å—ï¼šcloudalibaba-config-nacos-client3377</p></blockquote><h3 id="2ã€å¼•å…¥ä¾èµ–-2"><a href="#2ã€å¼•å…¥ä¾èµ–-2" class="headerlink" title="2ã€å¼•å…¥ä¾èµ–"></a>2ã€å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶-2"><a href="#3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶-2" class="headerlink" title="3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"></a>3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶</h3><blockquote><p>bootstrap.yml</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nacosé…ç½®</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3377</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-config-client</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment"># NacosæœåŠ¡æ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="comment"># æŒ‡å®šNacosé…ç½®ä¸­å¿ƒçš„åœ°å€</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># æŒ‡å®šyamlæ ¼å¼çš„é…ç½®</span></span><br></pre></td></tr></table></figure><blockquote><p>application.yml</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸ºä½•ç¼–å†™ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Ÿ</p><p>NacosåŒSpring Cloud Configä¸€è‡´ï¼Œåœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œè¦ä¿è¯å…ˆä»é…ç½®ä¸­å¿ƒè¿›è¡Œé…ç½®æ‹‰å–ï¼Œæ‹‰å–é…ç½®åï¼Œæ‰èƒ½ä¿è¯é¡¹ç›®çš„æ­£å¸¸å¯åŠ¨ã€‚</p><p>Spring Bootä¸­é…ç½®æ–‡ä»¶çš„åŠ è½½æ˜¯å­˜åœ¨ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œ<strong>bootstrapï¼ˆå…¨å±€ï¼‰ä¼˜å…ˆçº§é«˜äºapplicationï¼ˆè‡ªå®šä¹‰ï¼‰</strong></p></blockquote><h3 id="4ã€ä¸»å¯åŠ¨ç±»-2"><a href="#4ã€ä¸»å¯åŠ¨ç±»-2" class="headerlink" title="4ã€ä¸»å¯åŠ¨ç±»"></a>4ã€ä¸»å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NacosConfigClientMain3377</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(NacosConfigClientMain3377.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€ä¸šåŠ¡ç±»-2"><a href="#5ã€ä¸šåŠ¡ç±»-2" class="headerlink" title="5ã€ä¸šåŠ¡ç±»"></a>5ã€ä¸šåŠ¡ç±»</h3><blockquote><p>@RefreshScopeæ³¨è§£ç”¨äºåŠ¨æ€åˆ·æ–°ï¼Œä½œç”¨åœ¨Controllerå±‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.context.config.annotation.RefreshScope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigClientController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;config.info&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String configInfo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/config/info&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getConfigInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> configInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€Nacosçš„é…ç½®è§„åˆ™"><a href="#6ã€Nacosçš„é…ç½®è§„åˆ™" class="headerlink" title="6ã€Nacosçš„é…ç½®è§„åˆ™"></a>6ã€Nacosçš„é…ç½®è§„åˆ™</h3><ul><li>ç†è®ºï¼šNacosä¸­çš„dataidçš„ç»„æˆæ ¼å¼ä¸SpringBooté…ç½®æ–‡ä»¶ä¸­çš„åŒ¹é…è§„åˆ™</li></ul><blockquote><p>è¯´æ˜ï¼šä¹‹æ‰€ä»¥è¦é…ç½®<em>spring.application.name</em> ï¼Œç¤ºéŸ³ä¸ºå®ƒæ˜¯æ„æˆNacosé…ç½®ç®¡ç†<em>dataId</em>å­—æ®µçš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨Nacos Spring Cloudä¸­ï¼ŒdataIdçš„å®Œæ•´æ ¼å¼å¦‚ä¸‹</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;prefix&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>prefix</strong> é»˜è®¤ä¸º <strong>spring.application.name</strong> çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®é¡¹ <strong>spring.cloud.nacos.config.prefix</strong> æ¥é…ç½®ã€‚</li><li><strong>spring.profile.active</strong> å³ä¸ºå½“å‰ç¯å¢ƒå¯¹äºçš„profileï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://www.docs4dev.com/docs/zh/spring-boot/2.1.1.RELEASE/reference">Spring Bootæ–‡æ¡£</a> æ³¨æ„ï¼šå½“<strong>spring.profile.active</strong> ä¸ºç©ºæ—¶ï¼Œå¯¹åº”çš„ <strong>-</strong> ä¹Ÿå°†ä¸å­˜åœ¨ï¼Œæ­¤æ—¶dataIdçš„æ‹¼æ¥æ ¼å¼å˜ä¸º <strong>${prefix}-${file-extension}</strong> ï¼Œ<strong>file-extension</strong> ä¸ºé…ç½®å†…å®¹çš„æ•°æ®æ ¼å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ <strong>spring.cloud.nacos.config.file-extension</strong> æ¥é…ç½®ï¼Œç›®å‰åªæ”¯æŒ<strong>properties</strong>  å’Œ <strong>yaml</strong> ç±»å‹ã€‚</li><li>é€šè¿‡Spring CloudåŸç”Ÿæ³¨è§£ <strong>@RefreshScope</strong> å®ç°é…ç½®è‡ªåŠ¨æ›´æ–°ã€‚</li></ul><blockquote><p>æœ€åå…¬å¼ä¸ºï¼š</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ®ä¸Šé¢çš„å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°cloudalibaba-config-nacos-client3377å¾®æœåŠ¡é…ç½®çš„dataIdä¸ºï¼š<strong>nacos-config-client-dev.yaml</strong></p></blockquote><h3 id="7ã€å®æ“"><a href="#7ã€å®æ“" class="headerlink" title="7ã€å®æ“"></a>7ã€å®æ“</h3><blockquote><p>åœ¨nacosæ§åˆ¶å°ä¸­é€‰æ‹©<strong>é…ç½®ç®¡ç†</strong>-<strong>é…ç½®åˆ—è¡¨</strong>ï¼Œç‚¹å‡»â€œ+â€å·æ·»åŠ é…ç½®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215203233.png" alt="image-20210215203231682"></p><blockquote><p>æ·»åŠ çš„é…ç½®å¦‚ä¸‹ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215203636.png" alt="image-20210215203636355"></p><h3 id="8ã€æµ‹è¯•"><a href="#8ã€æµ‹è¯•" class="headerlink" title="8ã€æµ‹è¯•"></a>8ã€æµ‹è¯•</h3><blockquote><p>è¿è¡Œcloudalibaba-config-nacos-client3377å¾®æœåŠ¡ï¼Œè°ƒç”¨æ¥å£æŸ¥çœ‹é…ç½®ä¿¡æ¯ï¼Œæ¥å£åœ°å€ä¸ºï¼š<a href="http://localhost:3377/config/info">http://localhost:3377/config/info</a></p></blockquote><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215205027.png" alt="image-20210215205027075"></p><h3 id="9ã€é…ç½®çš„åŠ¨æ€åˆ·æ–°"><a href="#9ã€é…ç½®çš„åŠ¨æ€åˆ·æ–°" class="headerlink" title="9ã€é…ç½®çš„åŠ¨æ€åˆ·æ–°"></a>9ã€é…ç½®çš„åŠ¨æ€åˆ·æ–°</h3><blockquote><p>ä¿®æ”¹ä¸‹Nacosä¸­çš„yamlé…ç½®æ–‡ä»¶ï¼Œå†æ¬¡è°ƒç”¨æŸ¥çœ‹é…ç½®çš„ç«¯å£ï¼Œå°±ä¼šå‘ç°é…ç½®å·²ç»åˆ·æ–°ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215210048.png" alt="image-20210215210048752"></p><blockquote><p>é‡æ–°è°ƒç”¨æŸ¥çœ‹é…ç½®çš„æ¥å£ï¼ŒæŸ¥çœ‹é…ç½®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215210140.png" alt="image-20210215210140349"></p><h2 id="4-2ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åˆ†ç±»é…ç½®"><a href="#4-2ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åˆ†ç±»é…ç½®" class="headerlink" title="4.2ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åˆ†ç±»é…ç½®"></a>4.2ã€Nacosä½œä¸ºé…ç½®ä¸­å¿ƒâ€“åˆ†ç±»é…ç½®</h2><h3 id="1ã€é—®é¢˜ä¸€"><a href="#1ã€é—®é¢˜ä¸€" class="headerlink" title="1ã€é—®é¢˜ä¸€"></a>1ã€é—®é¢˜ä¸€</h3><blockquote><p>å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸ä¸€ä¸ªç³»ç»Ÿä¼šå‡†å¤‡</p><ul><li>devå¼€å‘ç¯å¢ƒ</li><li>testæµ‹è¯•ç¯å¢ƒ</li><li>prodç”Ÿäº§ç¯å¢ƒ</li></ul><p>å¦‚ä½•ä¿è¯æŒ‡å®šç¯å¢ƒå¯åŠ¨æ—¶æœåŠ¡èƒ½æ­£ç¡®è¯»å–åˆ°Nacosä¸Šç›¸åº”ç¯å¢ƒçš„é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ</p></blockquote><h3 id="2ã€é—®é¢˜äºŒ"><a href="#2ã€é—®é¢˜äºŒ" class="headerlink" title="2ã€é—®é¢˜äºŒ"></a>2ã€é—®é¢˜äºŒ</h3><blockquote><p>ä¸€ä¸ªå¤§å‹åˆ†å¸ƒå¼å¾®æœåŠ¡ç³»ç»Ÿä¼šæœ‰å¾ˆå¤šä¸ªå¾®æœåŠ¡å­é¡¹ç›®</p><p>æ¯ä¸ªå¾®æœåŠ¡åˆæœ‰å¯¹åº”çš„å¼€å‘ç¯å¢ƒã€é¢„å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€æ­£å¼ç¯å¢ƒâ€¦</p><p>é‚£ä¹ˆåˆæ€ä¹ˆå¯¹è¿™äº›é…ç½®è¿›è¡Œå¤„ç†å‘¢ï¼Ÿ</p></blockquote><h3 id="3ã€ä»€ä¹ˆæ˜¯åˆ†ç±»é…ç½®ï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯åˆ†ç±»é…ç½®ï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯åˆ†ç±»é…ç½®ï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯åˆ†ç±»é…ç½®ï¼Ÿ</h3><blockquote><p>ç±»ä¼¼Javaä¸­çš„package + ç±»å</p><p>æœ€å¤–å±‚çš„namespaceç”¨äºåŒºåˆ«éƒ¨ç½²ç¯å¢ƒï¼ŒGroupå’ŒDataIdä»é€»è¾‘ä¸ŠåŒºåˆ†ä¸¤ä¸ªå¯¹è±¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215212745.png" alt="image-20210215212745121"></p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹</p></blockquote><ul><li>Namespace=public</li><li>Group=DEFAULT_GROUP</li></ul><blockquote><p>Nacosé»˜è®¤çš„å‘½åç©ºé—´ä¸ºpublicï¼ŒNamespaceä¸»è¦ç”¨æ¥éš”ç¦»ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æœ‰ä¸‰ä¸ªï¼ˆç”Ÿäº§ã€å¼€å‘ã€æµ‹è¯•ï¼‰ç¯å¢ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸‰ä¸ªNamespaceï¼Œä¸åŒçš„Namespaceä¹‹é—´æ˜¯éš”ç¦»çš„ã€‚</p><p>Groupé»˜è®¤æ˜¯DEFAULT_GROUPï¼ŒGroupå¯ä»¥æŠŠä¸åŒå¾®æœåŠ¡åˆ’åˆ†åˆ°ä¸€ä¸ªåˆ†ç»„ä¸­ã€‚</p><p>Serviceå°±æ˜¯å¾®æœåŠ¡ï¼Œä¸€ä¸ªServiceå¯ä»¥åŒ…æ‹¬å¤šä¸ªClusterï¼ˆé›†ç¾¤ï¼‰ï¼ŒNacosé»˜è®¤Clusteræ˜¯Defaultï¼ŒClusteræ˜¯å¯¹æŒ‡å®šå¾®æœåŠ¡çš„ä¸€ä¸ªè™šæ‹Ÿåˆ’åˆ†ã€‚</p><p>æ¯”å¦‚è¯´ä¸ºäº†å®¹ç¾ï¼Œå°†Serviceå¾®æœåŠ¡åˆ†åˆ«éƒ¨ç½²åœ¨äº†æ­å·æœºæˆ¿å’Œå¹¿å·æœºæˆ¿ï¼Œè¿™ä¸ªæ—¶å€™ç»™æ­å·æœºæˆ¿çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆHZï¼‰ï¼Œç»™å¹¿å·è®¡æ–¹çš„Serviceå¾®æœåŠ¡èµ·ä¸€ä¸ªé›†ç¾¤åç§°ï¼ˆGZï¼‰ï¼Œè¿˜å¯ä»¥å°½é‡è®©åŒä¸€ä¸ªæœºæˆ¿ä¸­çš„å¾®æœåŠ¡ç›¸äº’è°ƒç”¨ï¼Œæå‡æ€§èƒ½ã€‚</p><p>Instanceï¼šå¾®æœåŠ¡å®ä¾‹</p></blockquote><h3 id="4ã€é€šè¿‡DataIdè¯»å–ä¸åŒé…ç½®"><a href="#4ã€é€šè¿‡DataIdè¯»å–ä¸åŒé…ç½®" class="headerlink" title="4ã€é€šè¿‡DataIdè¯»å–ä¸åŒé…ç½®"></a>4ã€é€šè¿‡DataIdè¯»å–ä¸åŒé…ç½®</h3><blockquote><p>é»˜è®¤ç©ºé—´+é»˜è®¤åˆ†ç»„+æ–°å»ºdevå’Œtestä¸¤ä¸ªDataId</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215233720.png" alt="image-20210215233719100"></p><ul><li>ä¿®æ”¹3377å¾®æœåŠ¡çš„application.ymlé…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šè®°è½½ç¯å¢ƒ</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="comment"># é…ç½®ä»€ä¹ˆç¯å¢ƒå°±åŠ è½½ä»€ä¹ˆé…ç½®</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">test</span></span><br><span class="line">  <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="comment"># active: dev</span></span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶è¯»å–çš„é…ç½®çš„DataIdä¸º <strong>nacos-config-client-test.yaml</strong> ï¼Œé…ç½®ä¸º</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215234528.png" alt="image-20210215234528455"></p><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215234506.png" alt="image-20210215234506773"></p><h3 id="5ã€é€šè¿‡Groupè¯»å–ä¸åŒé…ç½®"><a href="#5ã€é€šè¿‡Groupè¯»å–ä¸åŒé…ç½®" class="headerlink" title="5ã€é€šè¿‡Groupè¯»å–ä¸åŒé…ç½®"></a>5ã€é€šè¿‡Groupè¯»å–ä¸åŒé…ç½®</h3><blockquote><p>æ–°å»ºä¸€ä¸ªå¼€å‘ç»„DEV_GROUP</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210215235657.png" alt="image-20210215235657328"></p><blockquote><p>æ–°å»ºä¸€ä¸ªæµ‹è¯•ç»„TEST_GROUP</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216000114.png" alt="image-20210216000114864"></p><blockquote><p>æ­¤æ—¶é…ç½®åˆ—è¡¨å¦‚ä¸‹ï¼Œä¸¤ä¸ªä¸åŒç»„æœ‰ç›¸åŒDataIdçš„é…ç½®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216000529.png" alt="image-20210216000529294"></p><blockquote><p>åœ¨bootstrap.ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¸€æ¡é…ç½®ï¼ŒæŒ‡å®šè¦åŠ è½½çš„é…ç½®ç»„</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="comment"># é…ç½®å“ªä¸ªç»„å°±åŠ è½½å“ªä¸ªç»„</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">TEST_GROUP</span></span><br></pre></td></tr></table></figure><blockquote><p>åŒæ—¶ä¿®æ”¹application.ymlé…ç½®æ–‡ä»¶ä¸­å¯åŠ¨çš„ç¯å¢ƒ</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="comment"># é…ç½®ä»€ä¹ˆç¯å¢ƒå°±åŠ è½½ä»€ä¹ˆé…ç½®</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">info</span></span><br><span class="line">  <span class="comment"># è¡¨ç¤ºå¼€å‘ç¯å¢ƒ</span></span><br><span class="line">    <span class="comment"># active: dev</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯3377ï¼Œè®¿é—®<a href="http://localhost:3377/config/info">http://localhost:3377/config/info</a> ï¼Œç»“æœå¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216001128.png" alt="image-20210216001128542"></p><blockquote><p>ä¿®æ”¹bootstrap.ymlé…ç½®æ–‡ä»¶ï¼Œé‡å¯</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="comment"># é…ç½®å“ªä¸ªç»„å°±åŠ è½½å“ªä¸ªç»„</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEV_GROUP</span></span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœä¸ºï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216001326.png" alt="image-20210216001326298"></p><h3 id="6ã€é€šè¿‡Namespaceè¯»å–ä¸åŒé…ç½®"><a href="#6ã€é€šè¿‡Namespaceè¯»å–ä¸åŒé…ç½®" class="headerlink" title="6ã€é€šè¿‡Namespaceè¯»å–ä¸åŒé…ç½®"></a>6ã€é€šè¿‡Namespaceè¯»å–ä¸åŒé…ç½®</h3><blockquote><p>é»˜è®¤çš„namespaceä¸èƒ½åˆ é™¤ï¼Œæ–°å»ºDEV/TESTå‘½åç©ºé—´</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216001648.png" alt="image-20210216001648259"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216001734.png" alt="image-20210216001734240"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216002033.png" alt="image-20210216002033214"></p><blockquote><p>åˆ‡æ¢åˆ°dev namespaceï¼Œæ–°å»ºä¸‰ä¸ªåˆ†ç»„ï¼Œåˆ†ç»„ä¸­é…ç½®DataIdä¸€è‡´ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216002615.png" alt="image-20210216002615825"></p><blockquote><p>åˆ‡æ¢namespaceï¼Œåœ¨bootstrap.ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼ŒåŒæ—¶ä¿®æ”¹application.ymlä¸­é…ç½®ç¯å¢ƒä¸ºdevï¼š</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">a9ec0b1e-e254-4b99-84ec-fa4ca62bf5a6</span></span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216003211.png" alt="image-20210216003211534"></p><h1 id="äº”ã€Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰"><a href="#äº”ã€Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰" class="headerlink" title="äº”ã€Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰"></a>äº”ã€Nacosé›†ç¾¤å’ŒæŒä¹…åŒ–é…ç½®ï¼ˆé‡è¦ï¼‰</h1><h2 id="5-1ã€å®˜ç½‘è¯´æ˜"><a href="#5-1ã€å®˜ç½‘è¯´æ˜" class="headerlink" title="5.1ã€å®˜ç½‘è¯´æ˜"></a>5.1ã€å®˜ç½‘è¯´æ˜</h2><h3 id="1ã€å®˜ç½‘æ–‡æ¡£"><a href="#1ã€å®˜ç½‘æ–‡æ¡£" class="headerlink" title="1ã€å®˜ç½‘æ–‡æ¡£"></a>1ã€å®˜ç½‘æ–‡æ¡£</h3><blockquote><p><a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</a></p></blockquote><h3 id="2ã€å®˜ç½‘æ¶æ„å›¾"><a href="#2ã€å®˜ç½‘æ¶æ„å›¾" class="headerlink" title="2ã€å®˜ç½‘æ¶æ„å›¾"></a>2ã€å®˜ç½‘æ¶æ„å›¾</h3><blockquote><p>VIPï¼švirtual IPï¼Œè™šæ‹ŸIPï¼Œä¹Ÿå°±æ˜¯nginx</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216111649.png" alt="img"></p><h3 id="3ã€æ ¹æ®å®˜ç½‘ç¿»è¯‘ï¼Œæˆ‘ä»¬å¯å¾—ä»¥ä¸‹æ¶æ„å›¾"><a href="#3ã€æ ¹æ®å®˜ç½‘ç¿»è¯‘ï¼Œæˆ‘ä»¬å¯å¾—ä»¥ä¸‹æ¶æ„å›¾" class="headerlink" title="3ã€æ ¹æ®å®˜ç½‘ç¿»è¯‘ï¼Œæˆ‘ä»¬å¯å¾—ä»¥ä¸‹æ¶æ„å›¾"></a>3ã€æ ¹æ®å®˜ç½‘ç¿»è¯‘ï¼Œæˆ‘ä»¬å¯å¾—ä»¥ä¸‹æ¶æ„å›¾</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216112702.jpg" alt="æœªå‘½åæ–‡ä»¶ (1)"></p><h3 id="4ã€è¯´æ˜"><a href="#4ã€è¯´æ˜" class="headerlink" title="4ã€è¯´æ˜"></a>4ã€è¯´æ˜</h3><blockquote><p>æŒ‰ç…§ä¸Šé¢çš„æ¶æ„å›¾ï¼Œæˆ‘ä»¬éœ€è¦Mysqlæ•°æ®åº“ï¼›</p><p>é»˜è®¤Nacosä½¿ç”¨åµŒå…¥å¼æ•°æ®åº“å®ç°äº†æ•°æ®çš„å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯åŠ¨å¤šä¸ªé»˜è®¤é…ç½®çš„NacosèŠ‚ç‚¹ï¼Œæ•°æ®å­˜å‚¨æ˜¯å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒNacosé‡‡ç”¨äº†<strong>é›†ä¸­å¼å­˜å‚¨çš„æ–¹å¼æ”¯æŒé›†ç¾¤ä½“éƒ¨ç½²ï¼Œç›®å‰åªæ”¯æŒMySQLçš„å­˜å‚¨ã€‚</strong></p></blockquote><h2 id="5-2ã€NacosæŒä¹…åŒ–é…ç½®è§£é‡Š"><a href="#5-2ã€NacosæŒä¹…åŒ–é…ç½®è§£é‡Š" class="headerlink" title="5.2ã€NacosæŒä¹…åŒ–é…ç½®è§£é‡Š"></a>5.2ã€NacosæŒä¹…åŒ–é…ç½®è§£é‡Š</h2><h3 id="1ã€Nacosè‡ªå¸¦äº†åµŒå…¥å¼æ•°æ®åº“"><a href="#1ã€Nacosè‡ªå¸¦äº†åµŒå…¥å¼æ•°æ®åº“" class="headerlink" title="1ã€Nacosè‡ªå¸¦äº†åµŒå…¥å¼æ•°æ®åº“"></a>1ã€Nacosè‡ªå¸¦äº†åµŒå…¥å¼æ•°æ®åº“</h3><blockquote><p>Nacosé»˜è®¤è‡ªå¸¦<strong>åµŒå…¥å¼æ•°æ®åº“derby</strong>ï¼Œæ‰“å¼€Nacosçš„ä¾èµ–åæ ‡ï¼š<a href="https://github.com/alibaba/nacos/blob/develop/config/pom.xml">https://github.com/alibaba/nacos/blob/develop/config/pom.xml</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216114401.png" alt="image-20210216114401758"></p><blockquote><p>ä½†å½“æˆ‘ä»¬åšNacosé›†ç¾¤æ—¶ï¼Œæ¯ä¸ªNacoséƒ½å„è‡ªå¸¦ç€ä¸€ä¸ªderbyåµŒå…¥å¼æ•°æ®åº“ï¼Œæ­¤æ—¶ä¼šå‡ºç°æŒä¹…åŒ–æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæ­¤æ—¶æˆ‘ä»¬å¼•å…¥å¤–éƒ¨çš„MySQLæ•°æ®åº“ï¼Œå°†é…ç½®æ•°æ®æŒä¹…åŒ–åˆ°MySQLä¸­ã€‚ </p></blockquote><h3 id="2ã€derbyåˆ°MySQLåˆ‡æ¢é…ç½®æ­¥éª¤"><a href="#2ã€derbyåˆ°MySQLåˆ‡æ¢é…ç½®æ­¥éª¤" class="headerlink" title="2ã€derbyåˆ°MySQLåˆ‡æ¢é…ç½®æ­¥éª¤"></a>2ã€derbyåˆ°MySQLåˆ‡æ¢é…ç½®æ­¥éª¤</h3><blockquote><p>åœ¨<strong>nacos-server-1.1.4\nacos\conf</strong>ç›®å½•ä¸‹æ‰¾åˆ°å¹¶æ‰§è¡Œ <strong>nacos-mysql.sql</strong> è„šæœ¬</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210216115406.png" alt="image-20210216115406872"></p><blockquote><p>åœ¨<strong>nacos-server-1.1.4\nacos\conf</strong>ç›®å½•ä¸‹æ‰¾åˆ°<strong>application.properties</strong>ï¼Œå¢åŠ æ”¯æŒmysqlæ•°æ®æºé…ç½®ï¼Œæ·»åŠ mysqlæ•°æ®åº“çš„urlã€ç”¨æˆ·åå’Œå¯†ç </p><p>æ³¨ï¼šnacosé»˜è®¤ä¸æ”¯æŒmysql8.0ï¼Œå¦‚éœ€æ”¯æŒ8.0ï¼Œéœ€è¦ä¸‹è½½mysql8.0é©±åŠ¨è¿›è¡Œæ›´æ¢ã€‚</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æŒä¹…åŒ–é…ç½®ä»derbyè¿ç§»åˆ°mysqlé…ç½®</span></span><br><span class="line"><span class="meta">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">db.url.0</span>=<span class="string">jdbc:mysql://localhost:3306/nacos_config?&amp;connectTimeout=10000&amp;socketTimeout=30000&amp;serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="meta">db.user</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">db.password</span>=<span class="string">tianxin1230.</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯Nacosï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸ªå…¨æ–°çš„ç©ºè®°å½•é¡µé¢</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloudå­¦ä¹ ï¼ˆå››ï¼‰-EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ</title>
      <link href="posts/995752607.html"/>
      <url>posts/995752607.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€EurekaåŸºç¡€çŸ¥è¯†"><a href="#ä¸€ã€EurekaåŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸€ã€EurekaåŸºç¡€çŸ¥è¯†"></a>ä¸€ã€EurekaåŸºç¡€çŸ¥è¯†</h1><h2 id="1-1ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†"><a href="#1-1ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†" class="headerlink" title="1.1ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†"></a>1.1ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†</h2><blockquote><p>Spring Cloud å°è£…äº†Netflixå…¬å¸å¼€å‘çš„Eurekaæ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç†</p><p>åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡äºæœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚</p></blockquote><h2 id="1-2ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ"><a href="#1-2ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ" class="headerlink" title="1.2ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ"></a>1.2ã€ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œ</h2><blockquote><p>â€‹        Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Serverä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ°Eureka Serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡Eureka Serveræ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</p><p>â€‹        åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯æ¯”å¦‚æœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…æœåŠ¡æä¾›è€…ï¼‰ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»ï¼ˆæœåŠ¡æ²»ç†æ¦‚å¿µï¼‰ã€‚åœ¨ä»»ä½•rpcè¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒï¼ˆå­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯ï¼ˆæ¥å£åœ°å€ï¼‰ï¼‰</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214161851.png" alt="img"></p><h2 id="1-3ã€Eurekaä¸¤ç»„ä»¶"><a href="#1-3ã€Eurekaä¸¤ç»„ä»¶" class="headerlink" title="1.3ã€Eurekaä¸¤ç»„ä»¶"></a>1.3ã€Eurekaä¸¤ç»„ä»¶</h2><blockquote><p>EurekaåŒ…æ‹¬ä¸¤ä¸ªç»„ä»¶ï¼šEureka Serverå’ŒEureka Clientï¼Œå…¶ä¸­</p></blockquote><ul><li><strong>Eureka Serveræä¾›æœåŠ¡æ³¨å†ŒæœåŠ¡</strong>ï¼Œå„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨Eureka Serverä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·Eureka Serverä¸­çš„æœåŠ¡æ³¨å†Œè¡¨å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´è§‚çœ‹åˆ°ã€‚</li><li><strong>Eureka Clienté€šè¿‡æœåŠ¡æ³¨å†Œä¸­å¿ƒè®¿é—®</strong>ï¼Œæ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–Eureka Serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ã€ä½¿ç”¨è½®è¯¢ï¼ˆRound-robinï¼‰è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘Eureka Serverå‘é€å¿ƒè·³ï¼ˆé»˜è®¤æ—¶é—´å‘¨æœŸä¸º30sï¼‰ã€‚å¦‚æœEureka Serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼ŒEureka Serverå°†ä¼šä»æ³¨å†ŒæœåŠ¡è¡¨ä¸­æŠŠè¿™ä¸ªæœåŠ¡èŠ‚ç‚¹ç§»é™¤ï¼ˆé»˜è®¤ä¸º90sï¼‰ã€‚</li></ul><h1 id="äºŒã€å•å‡»Eurekaæ„å»ºæ­¥éª¤"><a href="#äºŒã€å•å‡»Eurekaæ„å»ºæ­¥éª¤" class="headerlink" title="äºŒã€å•å‡»Eurekaæ„å»ºæ­¥éª¤"></a>äºŒã€å•å‡»Eurekaæ„å»ºæ­¥éª¤</h1><h2 id="2-1ã€åˆ›å»ºcloud-eureka-server-7001"><a href="#2-1ã€åˆ›å»ºcloud-eureka-server-7001" class="headerlink" title="2.1ã€åˆ›å»ºcloud-eureka-server-7001"></a>2.1ã€åˆ›å»ºcloud-eureka-server-7001</h2><blockquote><p>è¿™ä¸ªå¾®æœåŠ¡å°±æ˜¯eureka ServeræœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œä¸ºå…¶ä»–å¾®æœåŠ¡æä¾›æœåŠ¡æ³¨å†Œã€‚</p></blockquote><h2 id="2-2ã€å¼•å…¥ä¾èµ–"><a href="#2-2ã€å¼•å…¥ä¾èµ–" class="headerlink" title="2.2ã€å¼•å…¥ä¾èµ–"></a>2.2ã€å¼•å…¥ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>Eureka 1.xå’ŒEureka 2.xçš„åŒºåˆ«</p></blockquote><ul><li>Eureka 1.x è€ç‰ˆæœ¬ï¼Œä¾èµ–ä¸­ä¸åˆ†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Eureka 2.x æ–°ç‰ˆæœ¬</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"><a href="#2-3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶" class="headerlink" title="2.3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"></a>2.3ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">erver:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">  <span class="comment"># è¡¨ç¤ºä¸å‘æœåŠ¡æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># è¡¨ç¤ºè‡ªå·±å°±æ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span></span><br></pre></td></tr></table></figure><h2 id="2-4ã€ä¸»å¯åŠ¨ç±»"><a href="#2-4ã€ä¸»å¯åŠ¨ç±»" class="headerlink" title="2.4ã€ä¸»å¯åŠ¨ç±»"></a>2.4ã€ä¸»å¯åŠ¨ç±»</h2><blockquote><p>åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableEurekaServeræ³¨è§£ï¼Œè¡¨ç¤ºè¿™ä¸ªå¾®æœåŠ¡ä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EurekaServer7001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(EurekaServer7001.class,args);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost:7001&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-5ã€å¯åŠ¨eureka7001"><a href="#2-5ã€å¯åŠ¨eureka7001" class="headerlink" title="2.5ã€å¯åŠ¨eureka7001"></a>2.5ã€å¯åŠ¨eureka7001</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214171752.png" alt="image-20210214171751846"></p><h2 id="2-6ã€ä¿®æ”¹payment8001å’Œorder80"><a href="#2-6ã€ä¿®æ”¹payment8001å’Œorder80" class="headerlink" title="2.6ã€ä¿®æ”¹payment8001å’Œorder80"></a>2.6ã€ä¿®æ”¹payment8001å’Œorder80</h2><blockquote><p>å¼•å…¥eureka Clientä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨payment8001ã€order80ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br></pre></td></tr></table></figure><blockquote><p>å¯åŠ¨payment8001ã€order80</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214173444.png" alt="image-20210214173444635"></p><blockquote><p>Eureka Serveråˆ—è¡¨ä¸­ä¼šæ˜¾ç¤ºå·²ç»æ³¨å†Œå…¥æ³¨å†Œä¸­å¿ƒçš„å¾®æœåŠ¡çš„spring.application.name</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214173637.png" alt="image-20210214173637695"></p><h1 id="ä¸‰ã€é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤"><a href="#ä¸‰ã€é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤" class="headerlink" title="ä¸‰ã€é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤"></a>ä¸‰ã€é›†ç¾¤Eurekaæ„å»ºæ­¥éª¤</h1><h2 id="3-1ã€å•æœºeurekaå­˜åœ¨çš„é—®é¢˜"><a href="#3-1ã€å•æœºeurekaå­˜åœ¨çš„é—®é¢˜" class="headerlink" title="3.1ã€å•æœºeurekaå­˜åœ¨çš„é—®é¢˜"></a>3.1ã€å•æœºeurekaå­˜åœ¨çš„é—®é¢˜</h2><blockquote><p><strong>å¾®æœåŠ¡RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æœ€æ ¸å¿ƒçš„æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>é«˜å¯ç”¨ï¼Œå¦‚æœæ³¨å†Œä¸­å¿ƒä¸ºå•æœºï¼Œé‚£ä¹ˆä¸€æ—¦å®ƒå‡ºç°æ•…éšœï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚</li></ul><p><strong>è§£å†³æ–¹æ³•</strong></p><ul><li>æ­å»ºEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼Œå®ç°è´Ÿè½½å‡è¡¡+æ•…éšœå®¹é”™</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214181019.png" alt="img"></p><h2 id="3-2ã€eurekaé›†ç¾¤çš„å®è´¨"><a href="#3-2ã€eurekaé›†ç¾¤çš„å®è´¨" class="headerlink" title="3.2ã€eurekaé›†ç¾¤çš„å®è´¨"></a>3.2ã€eurekaé›†ç¾¤çš„å®è´¨</h2><blockquote><p>äº’ç›¸æ³¨å†Œï¼Œç›¸äº’å®ˆæœ›ã€‚</p><p>é›†ç¾¤ä¸­çš„æ¯ä¸€å°eureka Serverè¦æœ‰<strong>é™¤è‡ªå·±ä¹‹å¤–çš„æ‰€æœ‰eureka server</strong>çš„ä¿¡æ¯ã€‚</p></blockquote><h2 id="3-3ã€æ–°å»ºEureka-7002å¾®æœåŠ¡"><a href="#3-3ã€æ–°å»ºEureka-7002å¾®æœåŠ¡" class="headerlink" title="3.3ã€æ–°å»ºEureka 7002å¾®æœåŠ¡"></a>3.3ã€æ–°å»ºEureka 7002å¾®æœåŠ¡</h2><blockquote><p>ä¿®æ”¹æœ¬åœ°hostsæ–‡ä»¶ï¼Œæ·»åŠ åŸŸåå’Œipæ˜ å°„</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># My hosts</span><br><span class="line">127.0.0.1 eureka7001.com</span><br><span class="line">127.0.0.1 eureka7002.com</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºä¾èµ–ã€ä¸»å¯åŠ¨ç±»ä¸7001ç±»ä¼¼ï¼Œæ‰€ä»¥è¿™é‡Œåªç»™å‡ºymlé…ç½®æ–‡ä»¶</p><p>æ­¤æ—¶éœ€è¦ä¿®æ”¹ä¸€ä¸‹7001çš„é…ç½®æ–‡ä»¶</p></blockquote><ul><li>7001</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7001.com</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="comment">#é›†ç¾¤æ—¶7001éœ€è¦æ³¨å†Œåˆ°7002</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7002.com:7002/eureka/</span></span><br></pre></td></tr></table></figure><ul><li>7002</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7002</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka7002.com</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span>     <span class="comment">#è®¾ç½®ä¸eureka serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br></pre></td></tr></table></figure><h2 id="3-4ã€å¯åŠ¨7001å’Œ7002ï¼Œæµ‹è¯•"><a href="#3-4ã€å¯åŠ¨7001å’Œ7002ï¼Œæµ‹è¯•" class="headerlink" title="3.4ã€å¯åŠ¨7001å’Œ7002ï¼Œæµ‹è¯•"></a>3.4ã€å¯åŠ¨7001å’Œ7002ï¼Œæµ‹è¯•</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214201207.png" alt="image-20210214201206201"></p><h2 id="3-5ã€å°†payment8001å’Œorder80æ³¨å†Œåˆ°eurekaé›†ç¾¤"><a href="#3-5ã€å°†payment8001å’Œorder80æ³¨å†Œåˆ°eurekaé›†ç¾¤" class="headerlink" title="3.5ã€å°†payment8001å’Œorder80æ³¨å†Œåˆ°eurekaé›†ç¾¤"></a>3.5ã€å°†payment8001å’Œorder80æ³¨å†Œåˆ°eurekaé›†ç¾¤</h2><blockquote><p>ä¿®æ”¹payment8001å’Œorder80çš„ymlæ–‡ä»¶</p></blockquote><ul><li>payment8001</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span>    <span class="comment">#è¡¨è¯†ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span>   <span class="comment">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span>    <span class="comment">#è®¾ç½®ä¸eureka serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-payment</span></span><br></pre></td></tr></table></figure><ul><li>order80</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-order-service</span></span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214210220.png" alt="image-20210214210219113"></p><h1 id="å››ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"><a href="#å››ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„" class="headerlink" title="å››ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„"></a>å››ã€actuatorå¾®æœåŠ¡ä¿¡æ¯å®Œå–„</h1><h2 id="4-1ã€ä¸»æœºåï¼ŒæœåŠ¡åç§°ä¿®æ”¹"><a href="#4-1ã€ä¸»æœºåï¼ŒæœåŠ¡åç§°ä¿®æ”¹" class="headerlink" title="4.1ã€ä¸»æœºåï¼ŒæœåŠ¡åç§°ä¿®æ”¹"></a>4.1ã€ä¸»æœºåï¼ŒæœåŠ¡åç§°ä¿®æ”¹</h2><h3 id="1ã€å½“å‰é—®é¢˜"><a href="#1ã€å½“å‰é—®é¢˜" class="headerlink" title="1ã€å½“å‰é—®é¢˜"></a>1ã€å½“å‰é—®é¢˜</h3><blockquote><p>eurekaæ³¨å†Œè¡¨ä¸­å«æœ‰ä¸»æœºåç§°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214211411.png" alt="image-20210214211411127"></p><h3 id="2ã€ä¿®æ”¹payment8001"><a href="#2ã€ä¿®æ”¹payment8001" class="headerlink" title="2ã€ä¿®æ”¹payment8001"></a>2ã€ä¿®æ”¹payment8001</h3><blockquote><p>ä¿®æ”¹payment8001å¾®æœåŠ¡çš„ymlé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®å¦‚ä¸‹</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">payment8001</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯ï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214212223.png" alt="image-20210214212222852"></p><h2 id="4-2ã€è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º"><a href="#4-2ã€è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º" class="headerlink" title="4.2ã€è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º"></a>4.2ã€è®¿é—®ä¿¡æ¯æœ‰IPä¿¡æ¯æç¤º</h2><h3 id="1ã€é‡åˆ°çš„é—®é¢˜"><a href="#1ã€é‡åˆ°çš„é—®é¢˜" class="headerlink" title="1ã€é‡åˆ°çš„é—®é¢˜"></a>1ã€é‡åˆ°çš„é—®é¢˜</h3><blockquote><p>åœ¨eurekaç‚¹å‡»å¾®æœåŠ¡æ—¶æ²¡æœ‰ipæç¤º</p></blockquote><h3 id="2ã€æ·»åŠ é…ç½®"><a href="#2ã€æ·»åŠ é…ç½®" class="headerlink" title="2ã€æ·»åŠ é…ç½®"></a>2ã€æ·»åŠ é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214212622.png" alt="image-20210214212622010"></p><h2 id="4-3ã€æ€»ç»“"><a href="#4-3ã€æ€»ç»“" class="headerlink" title="4.3ã€æ€»ç»“"></a>4.3ã€æ€»ç»“</h2><blockquote><p>ä¿®æ”¹ä¸»æœºåã€æ·»åŠ IPä¿¡æ¯æç¤ºçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p></blockquote><h3 id="1ã€å¼•å…¥ä¾èµ–"><a href="#1ã€å¼•å…¥ä¾èµ–" class="headerlink" title="1ã€å¼•å…¥ä¾èµ–"></a>1ã€å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€ymlæ–‡ä»¶æ·»åŠ é…ç½®"><a href="#2ã€ymlæ–‡ä»¶æ·»åŠ é…ç½®" class="headerlink" title="2ã€ymlæ–‡ä»¶æ·»åŠ é…ç½®"></a>2ã€ymlæ–‡ä»¶æ·»åŠ é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">æœåŠ¡åç§°</span></span><br><span class="line">    <span class="comment"># å¼€å¯IPä¿¡æ¯æç¤º</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h1 id="äº”ã€æœåŠ¡å‘ç°Discovery"><a href="#äº”ã€æœåŠ¡å‘ç°Discovery" class="headerlink" title="äº”ã€æœåŠ¡å‘ç°Discovery"></a>äº”ã€æœåŠ¡å‘ç°Discovery</h1><h2 id="5-1ã€æ¦‚è¿°"><a href="#5-1ã€æ¦‚è¿°" class="headerlink" title="5.1ã€æ¦‚è¿°"></a>5.1ã€æ¦‚è¿°</h2><blockquote><p>å¯¹äºæ³¨å†Œå…¥Eurekaä¸­çš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯ã€‚</p></blockquote><h2 id="5-2ã€ä½¿ç”¨"><a href="#5-2ã€ä½¿ç”¨" class="headerlink" title="5.2ã€ä½¿ç”¨"></a>5.2ã€ä½¿ç”¨</h2><blockquote><p>è¿™é‡Œä»¥payment8001ä¸ºä¾‹</p></blockquote><h3 id="1ã€ä¿®æ”¹payment8001çš„Controller"><a href="#1ã€ä¿®æ”¹payment8001çš„Controller" class="headerlink" title="1ã€ä¿®æ”¹payment8001çš„Controller"></a>1ã€ä¿®æ”¹payment8001çš„Controller</h3><blockquote><p>æ³¨å…¥ä¸€ä¸ªDiscoveryClientå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨Controllerä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æˆ·è·å–å¾®æœåŠ¡çš„ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/payment/discovery&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">discovery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; services = discoveryClient.getServices();</span><br><span class="line">    services.stream().forEach(service -&gt; &#123;</span><br><span class="line">        log.info(<span class="string">&quot;-----------element:&quot;</span> + service);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨getInstancesæ–¹æ³•ä¸­è¾“å…¥æ³¨å†Œåˆ°eurekaä¸­çš„å¾®æœåŠ¡åç§°</span></span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span>);</span><br><span class="line">    instances.stream().forEach(instance -&gt; &#123;</span><br><span class="line">        log.info(instance.getServiceId() + <span class="string">&quot;\t&quot;</span> + instance.getHost() + <span class="string">&quot;\t&quot;</span> + instance.getPort() + <span class="string">&quot;\t&quot;</span> + instance.getUri());</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.discoveryClient;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åœ¨payment8001ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£"><a href="#2ã€åœ¨payment8001ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£" class="headerlink" title="2ã€åœ¨payment8001ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£"></a>2ã€åœ¨payment8001ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br></pre></td></tr></table></figure><h3 id="3ã€é‡å¯payment8001"><a href="#3ã€é‡å¯payment8001" class="headerlink" title="3ã€é‡å¯payment8001"></a>3ã€é‡å¯payment8001</h3><blockquote><p>è®¿é—® <a href="http://localhost:8001/payment/discovery">http://localhost:8001/payment/discovery</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214214947.png" alt="image-20210214214946293"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214215325.png" alt="image-20210214215324991"></p><h1 id="å…­ã€Eurekaè‡ªæˆ‘ä¿æŠ¤"><a href="#å…­ã€Eurekaè‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="å…­ã€Eurekaè‡ªæˆ‘ä¿æŠ¤"></a>å…­ã€Eurekaè‡ªæˆ‘ä¿æŠ¤</h1><h2 id="6-1ã€æ¦‚è¿°"><a href="#6-1ã€æ¦‚è¿°" class="headerlink" title="6.1ã€æ¦‚è¿°"></a>6.1ã€æ¦‚è¿°</h2><blockquote><p>ä¿æŠ¤æ¨¡å¼ä¸»è¦ç”¨äºä¸€ç»„å®¢æˆ·ç«¯å’ŒEureka Serverä¹‹é—´å­˜åœ¨ç½‘ç»œåˆ†åŒºåœºæ™¯ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œ<strong>Eureka Serverå°†ä¼šå°è¯•ä¿æŠ¤å…¶æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†åˆ é™¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šæ³¨é”€ä»»ä½•æœåŠ¡</strong>ã€‚</p><p>å³ï¼šæŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒEurekaä¸ä¼šç«‹å³æ¸…ç†ï¼Œä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜ã€‚</p></blockquote><ul><li>å¦‚æœåœ¨Eureka Serveré¦–é¡µä¸­çœ‹åˆ°ä»¥ä¸‹è¿™æ®µæç¤ºï¼Œåˆ™è¯´æ˜Eurekaè¿›å…¥äº†ä¿æŠ¤æ¨¡å¼</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214220119.png" alt="image-20210214220118806"></p><h2 id="6-2ã€å¯¼è‡´åŸå› "><a href="#6-2ã€å¯¼è‡´åŸå› " class="headerlink" title="6.2ã€å¯¼è‡´åŸå› "></a>6.2ã€å¯¼è‡´åŸå› </h2><h3 id="1ã€ä¸ºä»€ä¹ˆä¼šäº§ç”ŸEurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ"><a href="#1ã€ä¸ºä»€ä¹ˆä¼šäº§ç”ŸEurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ" class="headerlink" title="1ã€ä¸ºä»€ä¹ˆä¼šäº§ç”ŸEurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ"></a>1ã€ä¸ºä»€ä¹ˆä¼šäº§ç”ŸEurekaè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ</h3><blockquote><p>ä¸ºäº†é˜²æ­¢EurekaClientå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¸EurekaServerç½‘ç»œä¸é€šæƒ…å†µä¸‹ï¼ŒEurekaserverä¸ä¼šç«‹åˆ»å°†EurekaClientæœåŠ¡å‰”é™¤</p></blockquote><h3 id="2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼"><a href="#2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼"></a>2ã€ä»€ä¹ˆæ˜¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</h3><blockquote><p>â€‹    é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœEurekaServeråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤90ç§’ï¼‰ã€‚ä½†å½“ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿï¼ˆå»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤ï¼‰æ—¶ï¼Œå¾®æœåŠ¡ä¸EurekaServerä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†â€”â€”å› ä¸ºå¾®åŠ¡æœ¬èº«å…¶å®æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å½“EurekaServerèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214221434.png" alt="img"></p><h2 id="6-3ã€ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"><a href="#6-3ã€ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤" class="headerlink" title="6.3ã€ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤"></a>6.3ã€ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤</h2><blockquote><p>ä»¥eureka7001å’Œpayment8001ä¸¾ä¾‹è¯´æ˜</p></blockquote><h3 id="1ã€ä¿®æ”¹eureka7001çš„é…ç½®æ–‡ä»¶"><a href="#1ã€ä¿®æ”¹eureka7001çš„é…ç½®æ–‡ä»¶" class="headerlink" title="1ã€ä¿®æ”¹eureka7001çš„é…ç½®æ–‡ä»¶"></a>1ã€ä¿®æ”¹eureka7001çš„é…ç½®æ–‡ä»¶</h3><blockquote><p>ç¦ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="comment"># å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">enable-self-preservation:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯7001ï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214222939.png" alt="image-20210214222939563"></p><h3 id="2ã€ä¿®æ”¹payment8001çš„é…ç½®æ–‡ä»¶"><a href="#2ã€ä¿®æ”¹payment8001çš„é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€ä¿®æ”¹payment8001çš„é…ç½®æ–‡ä»¶"></a>2ã€ä¿®æ”¹payment8001çš„é…ç½®æ–‡ä»¶</h3><blockquote><p>è®¾ç½®eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="comment">#Eurekaå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼ˆé»˜è®¤ä¸º10sï¼‰</span></span><br><span class="line">    <span class="attr">lease-renewal-interval-in-seconds:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment">#EurekaæœåŠ¡ç«¯åœ¨æ”¶åˆ°æœ€åä¸€æ¬¡å¿ƒè·³åç­‰å¾…æ—¶é—´ä¸Šé™ï¼Œå•ä½ä¸ºsï¼Œè¶…æ—¶ç›´æ¥å‰”é™¤æœåŠ¡</span></span><br><span class="line">    <span class="attr">lease-expiration-duration-in-seconds:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯payment8001ï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214223337.png" alt="image-20210214223337465"></p><blockquote><p>å…³é—­payment8001ï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214223531.png" alt="image-20210214223531487"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¦ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œå…³é—­payment8001åæœåŠ¡è¢«å‰”é™¤</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloudå­¦ä¹ ï¼ˆä¸‰ï¼‰-Hystrixçš„ä½¿ç”¨</title>
      <link href="posts/4157920692.html"/>
      <url>posts/4157920692.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€æ¦‚è¿°"><a href="#ä¸€ã€æ¦‚è¿°" class="headerlink" title="ä¸€ã€æ¦‚è¿°"></a>ä¸€ã€æ¦‚è¿°</h1><h2 id="1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"><a href="#1-1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜" class="headerlink" title="1.1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜"></a>1.1ã€åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜</h2><blockquote><p><strong>å¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…çš„å¤±è´¥ã€‚</strong></p><p>å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œä¸€ä¸ªè¯·æ±‚ï¼Œå¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡æ¥å£æ‰èƒ½å®ç°ï¼Œä¼šå½¢æˆéå¸¸å¤æ‚çš„è°ƒç”¨é“¾è·¯ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212114450.png" alt="img"></p><h2 id="1-2ã€æœåŠ¡é›ªå´©"><a href="#1-2ã€æœåŠ¡é›ªå´©" class="headerlink" title="1.2ã€æœåŠ¡é›ªå´©"></a>1.2ã€æœåŠ¡é›ªå´©</h2><blockquote><p>å¤šä¸ªå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾å¾®æœåŠ¡Aè°ƒç”¨å¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cï¼Œå¾®æœåŠ¡Bå’Œå¾®æœåŠ¡Cåˆè°ƒç”¨å…¶å®ƒçš„å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„**â€œæ‰‡å‡ºâ€**ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨å“åº”æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹å¾®æœåŠ¡Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œæ‰€è°“çš„â€œé›ªå´©æ•ˆåº”â€ã€‚</p><p>å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œã€‚æ¯”å¤±è´¥æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºè¿˜å¯èƒ½å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå‘ç”Ÿæ›´å¤šçš„çº§è”æ•…éšœã€‚è¿™äº›éƒ½è¡¨ç¤ºéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚</p><p>æ‰€ä»¥ï¼Œé€šå¸¸å½“ä½ å‘ç°ä¸€ä¸ªæ¨¡å—ä¸‹çš„æŸä¸ªå®ä¾‹å¤±è´¥åï¼Œè¿™æ—¶å€™è¿™ä¸ªæ¨¡å—ä¾ç„¶è¿˜ä¼šæ¥æ”¶æµé‡ï¼Œç„¶åè¿™ä¸ªæœ‰é—®é¢˜çš„æ¨¡å—è¿˜è°ƒç”¨äº†å…¶ä»–çš„æ¨¡å—ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿ<strong>çº§è”æ•…éšœ</strong>ï¼Œæˆ–è€…å«<strong>é›ªå´©</strong>ã€‚</p></blockquote><p>å¦‚å›¾ï¼Œä¸€æ¬¡ä¸šåŠ¡è¯·æ±‚ï¼Œéœ€è¦è°ƒç”¨Aã€Pã€Hã€Iå››ä¸ªæœåŠ¡ï¼Œè¿™å››ä¸ªæœåŠ¡åˆå¯èƒ½è°ƒç”¨å…¶å®ƒæœåŠ¡ã€‚</p><p>å¦‚æœæ­¤æ—¶ï¼ŒæŸä¸ªæœåŠ¡å‡ºç°å¼‚å¸¸ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212115722.png" alt="image-20210212115722168"></p><p>ä¾‹å¦‚å¾®æœåŠ¡Iå‘ç”Ÿå¼‚å¸¸ï¼Œè¯·æ±‚é˜»å¡ï¼Œç”¨æˆ·ä¸ä¼šå¾—åˆ°å“åº”ï¼Œåˆ™tomcatçš„è¿™ä¸ªçº¿ç¨‹ä¸ä¼šé‡Šæ”¾ï¼Œäºæ˜¯è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·è¯·æ±‚åˆ°æ¥ï¼Œè¶Šæ¥è¶Šå¤šçš„çº¿ç¨‹ä¼šé˜»å¡ï¼š</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212115754.png" alt="image-20210212115754001"></p><p><strong>æœåŠ¡å™¨æ”¯æŒçš„çº¿ç¨‹å’Œå¹¶å‘æ•°æœ‰é™ï¼Œè¯·æ±‚ä¸€ç›´é˜»å¡ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œä»è€Œå¯¼è‡´æ‰€æœ‰å…¶å®ƒæœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œå½¢æˆé›ªå´©æ•ˆåº”ã€‚</strong></p><p>è¿™å°±å¥½æ¯”ï¼Œä¸€ä¸ªæ±½è½¦ç”Ÿäº§çº¿ï¼Œç”Ÿäº§ä¸åŒçš„æ±½è½¦ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„é›¶ä»¶ï¼Œå¦‚æœæŸä¸ªé›¶ä»¶å› ä¸ºç§ç§åŸå› æ— æ³•ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆæ•´å°è½¦æ— æ³•è£…é…ï¼Œé™·å…¥ç­‰å¾…é›¶ä»¶çš„çŠ¶æ€ï¼Œç›´åˆ°é›¶ä»¶åˆ°ä½ï¼Œæ‰èƒ½ç»§ç»­ç»„è£…ã€‚Â  æ­¤æ—¶å¦‚æœæœ‰å¾ˆå¤šä¸ªè½¦å‹éƒ½éœ€è¦è¿™ä¸ªé›¶ä»¶ï¼Œé‚£ä¹ˆæ•´ä¸ªå·¥å‚éƒ½å°†é™·å…¥ç­‰å¾…çš„çŠ¶æ€ï¼Œå¯¼è‡´æ‰€æœ‰ç”Ÿäº§éƒ½é™·å…¥ç˜«ç—ªã€‚ä¸€ä¸ªé›¶ä»¶çš„æ³¢åŠèŒƒå›´ä¸æ–­æ‰©å¤§ã€‚ </p><blockquote><p>Hystixè§£å†³é›ªå´©é—®é¢˜çš„æ‰‹æ®µæœ‰ä¸¤ä¸ªï¼š</p></blockquote><ul><li>çº¿ç¨‹éš”ç¦»</li><li>æœåŠ¡ç†”æ–­</li></ul><h2 id="1-3ã€Hystrixæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-3ã€Hystrixæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.3ã€Hystrixæ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.3ã€Hystrixæ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote><p>â€‹    Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„<strong>å»¶è¿Ÿ</strong>å’Œ<strong>å®¹é”™</strong>çš„å¼€æºåº“ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰ï¼ŒHystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œ<strong>ä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚</strong><br>â€‹    â€œæ–­è·¯å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœä¹‹åï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œ<strong>å‘è°ƒç”¨æ–¹è¿”å›ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„ã€å¯å¤„ç†çš„å¤‡é€‰å“åº”ï¼ˆFallBack)**ï¼Œè€Œ</strong>ä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸**ï¼Œè¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ã€ä¸å¿…è¦åœ°å ç”¨ï¼Œä»è€Œé¿å…äº†æ•…éšœåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è”“å»¶ï¼Œä¹ƒè‡³é›ªå´©ã€‚</p></blockquote><h1 id="äºŒã€Hystrixé‡è¦æ¦‚å¿µ"><a href="#äºŒã€Hystrixé‡è¦æ¦‚å¿µ" class="headerlink" title="äºŒã€Hystrixé‡è¦æ¦‚å¿µ"></a>äºŒã€Hystrixé‡è¦æ¦‚å¿µ</h1><h2 id="2-1ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰"><a href="#2-1ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰" class="headerlink" title="2.1ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰"></a>2.1ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰</h2><h3 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h3><blockquote><p>å‡è®¾è¦è°ƒç”¨çš„å¾®æœåŠ¡/ç³»ç»Ÿ<strong>å‡ºç°æ•…éšœä¸å¯ç”¨</strong>äº†ï¼Œæ­¤æ—¶ä¸è®©å®¢æˆ·ç«¯<strong>ç­‰å¾…</strong>å¹¶<strong>ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤º</strong>ï¼Œfallback</p></blockquote><h3 id="2ã€ä¼šè§¦å‘æœåŠ¡é™çº§çš„æƒ…å†µ"><a href="#2ã€ä¼šè§¦å‘æœåŠ¡é™çº§çš„æƒ…å†µ" class="headerlink" title="2ã€ä¼šè§¦å‘æœåŠ¡é™çº§çš„æƒ…å†µ"></a>2ã€ä¼šè§¦å‘æœåŠ¡é™çº§çš„æƒ…å†µ</h3><ul><li>ç¨‹åºè¿è¡Œå¼‚å¸¸</li><li>è¶…æ—¶</li><li>æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§</li><li>çº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šè§¦å‘æœåŠ¡é™çº§ã€‚</li></ul><h2 id="2-2ã€æœåŠ¡ç†”æ–­ï¼ˆbreakï¼‰"><a href="#2-2ã€æœåŠ¡ç†”æ–­ï¼ˆbreakï¼‰" class="headerlink" title="2.2ã€æœåŠ¡ç†”æ–­ï¼ˆbreakï¼‰"></a>2.2ã€æœåŠ¡ç†”æ–­ï¼ˆbreakï¼‰</h2><h3 id="1ã€ä»‹ç»-1"><a href="#1ã€ä»‹ç»-1" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h3><blockquote><p>ç±»æ¯”ä¿é™©ä¸ï¼Œå½“ç”µå™¨æ€»åŠŸç‡è¾¾åˆ°ä¸€å®šé™åº¦åç›´æ¥ç†”æ–­ï¼Œä¸è®©ç”µå™¨ç»§ç»­å·¥ä½œã€‚å³<strong>æœåŠ¡è¾¾åˆ°æœ€å¤§è®¿é—®é‡åç›´æ¥æ‹’ç»è®¿é—®</strong>ï¼Œæ‹‰é—¸é™ç”µï¼Œç„¶å<strong>è°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º</strong>ï¼Œè¿™æ ·å¯ä»¥æ”¾ç½®æ•´ä¸ªç³»ç»Ÿè¢«æ‹–å®ã€‚</p><p>æ•…æœåŠ¡ç†”æ–­ä¼š<strong>è§¦å‘</strong>æœåŠ¡é™çº§ã€‚</p></blockquote><p>æœåŠ¡ç†”æ–­å°±æ˜¯ä¿é™©ä¸ï¼š<strong>æœåŠ¡çš„é™çº§</strong>-&gt;<strong>è¿›è€Œç†”æ–­</strong>-&gt;<strong>æ¢å¤è°ƒç”¨é“¾è·¯</strong></p><h3 id="2ã€Hystrixçš„å¼¹æ€§å®¹é”™"><a href="#2ã€Hystrixçš„å¼¹æ€§å®¹é”™" class="headerlink" title="2ã€Hystrixçš„å¼¹æ€§å®¹é”™"></a>2ã€Hystrixçš„å¼¹æ€§å®¹é”™</h3><blockquote><p>â€‹    ä¸åŒäºç”µè·¯ç†”æ–­åªèƒ½æ–­ä¸èƒ½è‡ªåŠ¨é‡è¿ï¼ŒHystrixå¯ä»¥å®ç°å¼¹æ€§å®¹é”™ï¼Œå½“æƒ…å†µå¥½è½¬ä¹‹åï¼Œå¯ä»¥è‡ªåŠ¨é‡è¿ã€‚è¿™å°±å¥½æ¯”é­”æœ¯å¸ˆæŠŠé¸½å­å˜æ²¡äº†å®¹æ˜“ï¼Œä½†æ˜¯çœŸæ­£è€ƒéªŒæŠ€æœ¯çš„æ˜¯å¦‚ä½•æŠŠæ¶ˆå¤±çš„é¸½å­å†å˜å›æ¥ã€‚<br>â€‹    é€šè¿‡æ–­è·¯çš„æ–¹å¼ï¼Œå¯ä»¥å°†åç»­è¯·æ±‚ç›´æ¥æ‹’ç»æ‰ï¼Œä¸€æ®µæ—¶é—´ä¹‹åå…è®¸éƒ¨åˆ†è¯·æ±‚é€šè¿‡ï¼Œå¦‚æœè°ƒç”¨æˆåŠŸåˆ™å›åˆ°ç”µè·¯é—­åˆçŠ¶æ€ï¼Œå¦åˆ™ç»§ç»­æ–­å¼€ã€‚</p></blockquote><h3 id="3ã€Hystrixç†”æ–­çŠ¶æ€æœºçš„ä¸‰ä¸ªçŠ¶æ€"><a href="#3ã€Hystrixç†”æ–­çŠ¶æ€æœºçš„ä¸‰ä¸ªçŠ¶æ€" class="headerlink" title="3ã€Hystrixç†”æ–­çŠ¶æ€æœºçš„ä¸‰ä¸ªçŠ¶æ€"></a>3ã€Hystrixç†”æ–­çŠ¶æ€æœºçš„ä¸‰ä¸ªçŠ¶æ€</h3><ul><li>Closedï¼šå…³é—­çŠ¶æ€ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æ­£å¸¸è®¿é—®ã€‚</li><li>Openï¼šæ‰“å¼€çŠ¶æ€ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«é™çº§ã€‚Hystixä¼šå¯¹è¯·æ±‚æƒ…å†µè®¡æ•°ï¼Œå½“ä¸€å®šæ—¶é—´å†…å¤±è´¥è¯·æ±‚ç™¾åˆ†æ¯”è¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ï¼Œæ–­è·¯å™¨ä¼šå®Œå…¨æ‰“å¼€ã€‚é»˜è®¤å¤±è´¥æ¯”ä¾‹çš„é˜ˆå€¼æ˜¯50%ï¼Œè¯·æ±‚æ¬¡æ•°æœ€å°‘ä¸ä½äº20æ¬¡ã€‚</li><li>Half Openï¼šåŠå¼€çŠ¶æ€ï¼ŒopençŠ¶æ€ä¸æ˜¯æ°¸ä¹…çš„ï¼Œæ‰“å¼€åä¼šè¿›å…¥ä¼‘çœ æ—¶é—´ï¼ˆé»˜è®¤æ˜¯5Sï¼‰ã€‚éšåæ–­è·¯å™¨ä¼šè‡ªåŠ¨è¿›å…¥åŠå¼€çŠ¶æ€ã€‚æ­¤æ—¶ä¼šé‡Šæ”¾éƒ¨åˆ†è¯·æ±‚é€šè¿‡ï¼Œè‹¥è¿™äº›è¯·æ±‚éƒ½æ˜¯å¥åº·çš„ï¼Œåˆ™ä¼šå®Œå…¨å…³é—­æ–­è·¯å™¨ï¼Œå¦åˆ™ç»§ç»­ä¿æŒæ‰“å¼€ï¼Œå†æ¬¡è¿›è¡Œä¼‘çœ è®¡æ—¶</li></ul><h2 id="2-3ã€æœåŠ¡é™æµï¼ˆfloat-limitedï¼‰"><a href="#2-3ã€æœåŠ¡é™æµï¼ˆfloat-limitedï¼‰" class="headerlink" title="2.3ã€æœåŠ¡é™æµï¼ˆfloat limitedï¼‰"></a>2.3ã€æœåŠ¡é™æµï¼ˆfloat limitedï¼‰</h2><blockquote><p>ç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œä¸­ï¼Œä¸¥ç¦è¯·æ±‚ä¸€çªèœ‚åœ°è¿‡æ¥æ‹¥æŒ¤ï¼Œéœ€è¦ä½¿è¯·æ±‚æ’é˜Ÿï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œã€‚</p></blockquote><h1 id="ä¸‰ã€Hystrixæ¡ˆä¾‹"><a href="#ä¸‰ã€Hystrixæ¡ˆä¾‹" class="headerlink" title="ä¸‰ã€Hystrixæ¡ˆä¾‹"></a>ä¸‰ã€Hystrixæ¡ˆä¾‹</h1><h2 id="3-1ã€æ„å»ºåŸºç¡€é¡¹ç›®"><a href="#3-1ã€æ„å»ºåŸºç¡€é¡¹ç›®" class="headerlink" title="3.1ã€æ„å»ºåŸºç¡€é¡¹ç›®"></a>3.1ã€æ„å»ºåŸºç¡€é¡¹ç›®</h2><blockquote><p>æ–°å»ºcloud-provider-hystrix-payment8001å¾®æœåŠ¡</p></blockquote><h3 id="1ã€POM"><a href="#1ã€POM" class="headerlink" title="1ã€POM"></a>1ã€POM</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ–°å¢hystrix--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€YML"><a href="#2ã€YML" class="headerlink" title="2ã€YML"></a>2ã€YML</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-payment</span>  </span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span>    <span class="comment">#è¡¨è¯†ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span>   <span class="comment">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br></pre></td></tr></table></figure><h3 id="3ã€ä¸»å¯åŠ¨ç±»"><a href="#3ã€ä¸»å¯åŠ¨ç±»" class="headerlink" title="3ã€ä¸»å¯åŠ¨ç±»"></a>3ã€ä¸»å¯åŠ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentHystrixMain8001</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(PaymentHystrixMain8001.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ä¸šåŠ¡ç±»"><a href="#4ã€ä¸šåŠ¡ç±»" class="headerlink" title="4ã€ä¸šåŠ¡ç±»"></a>4ã€ä¸šåŠ¡ç±»</h3><blockquote><p>åœ¨serviceå±‚ä¸­ç¼–å†™ä¸€ä¸ªæ­£å¸¸è®¿é—®å’Œä¸€ä¸ªè¶…æ—¶çš„æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentServiceImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_OK,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;ğŸ˜„&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> timeOut = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(timeOut);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOut,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;ğŸ˜¢è€—æ—¶(S):&quot;</span> + timeOut;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€Controllerå±‚"><a href="#5ã€Controllerå±‚" class="headerlink" title="5ã€Controllerå±‚"></a>5ã€Controllerå±‚</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªæ­£å¸¸è®¿é—®æ¥å£å’Œä¸€ä¸ªè¶…æ—¶æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentServiceImpl paymentService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_Ok</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        String result = paymentService.paymentInfo_OK(id);</span><br><span class="line">        log.info(<span class="string">&quot;*********result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        String result = paymentService.paymentInfo_TimeOut(id);</span><br><span class="line">        log.info(<span class="string">&quot;*********result:&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€æµ‹è¯•"><a href="#6ã€æµ‹è¯•" class="headerlink" title="6ã€æµ‹è¯•"></a>6ã€æµ‹è¯•</h3><blockquote><p>æ‰“å¼€eureka7001ã€hystrix-payment8001ï¼Œæµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212132513.png" alt="image-20210212132512369"></p><blockquote><p>è°ƒç”¨æˆåŠŸçš„æ–¹æ³•ï¼š<a href="http://localhost:8001/payment/hystrix/ok/31">http://localhost:8001/payment/hystrix/ok/31</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212132619.png" alt="image-20210212132619143"></p><blockquote><p>è°ƒç”¨è¶…æ—¶æ–¹æ³•ï¼š<a href="http://localhost:8001/payment/hystrix/timeout/31">http://localhost:8001/payment/hystrix/timeout/31</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212132704.png" alt="image-20210212132704481"></p><h2 id="3-2ã€é«˜å¹¶å‘æµ‹è¯•"><a href="#3-2ã€é«˜å¹¶å‘æµ‹è¯•" class="headerlink" title="3.2ã€é«˜å¹¶å‘æµ‹è¯•"></a>3.2ã€é«˜å¹¶å‘æµ‹è¯•</h2><blockquote><p>ä»¥ä¸Šé¢çš„é¡¹ç›®ä¸ºæ ¹åŸº</p></blockquote><h3 id="1ã€ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•"><a href="#1ã€ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•" class="headerlink" title="1ã€ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•"></a>1ã€ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212133943.png" alt="image-20210212133943440"></p><blockquote><p>å¯åŠ¨Jmeteråå†æ¬¡è®¿é—®<a href="http://localhost:8001/payment/hystrix/ok/31%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%93%8D%E5%BA%94%E6%98%8E%E6%98%BE%E5%8F%98%E6%85%A2%EF%BC%8C%E5%8D%B3http://localhost:8001/payment/hystrix/timeout/31%E6%8E%A5%E5%8F%A3%E8%A2%AB%E6%8C%A4%E7%88%86%E5%90%8E%EF%BC%8Chttp://localhost:8001/payment/hystrix/ok/31%E6%8E%A5%E5%8F%A3%E4%B9%9F%E4%BC%9A%E8%A2%AB%E6%8B%96%E7%B4%AF%E3%80%82">http://localhost:8001/payment/hystrix/ok/31æ¥å£ï¼Œå‘ç°å“åº”æ˜æ˜¾å˜æ…¢ï¼Œå³http://localhost:8001/payment/hystrix/timeout/31æ¥å£è¢«æŒ¤çˆ†åï¼Œhttp://localhost:8001/payment/hystrix/ok/31æ¥å£ä¹Ÿä¼šè¢«æ‹–ç´¯ã€‚</a></p></blockquote><h3 id="2ã€ä½¿ç”¨æ¶ˆè´¹è€…è°ƒç”¨Payment8001"><a href="#2ã€ä½¿ç”¨æ¶ˆè´¹è€…è°ƒç”¨Payment8001" class="headerlink" title="2ã€ä½¿ç”¨æ¶ˆè´¹è€…è°ƒç”¨Payment8001"></a>2ã€ä½¿ç”¨æ¶ˆè´¹è€…è°ƒç”¨Payment8001</h3><blockquote><p>æ–°å»ºä¸€ä¸ªcloud-consumer-feign-hystrix-order80å¾®æœåŠ¡</p></blockquote><blockquote><p>å¼•å…¥ä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ–°å¢hystrix--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™ymlæ–‡ä»¶</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">true</span>    <span class="comment">#è¡¨è¯†ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">true</span>   <span class="comment">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-provider-hystrix-order</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸»å¯åŠ¨ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hzx.springcloud&quot;,&quot;com.hzx.common&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderHystrixMain80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderHystrixMain80.class,args);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost/swagger-ui.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸šåŠ¡ç±»ï¼šservice</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;cloud-provider-hystrix-payment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentHystrixService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸šåŠ¡ç±»ï¼šController</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderHystrixController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentHystrixService paymentHystrixService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/ok/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        String result = paymentHystrixService.paymentInfo_OK(id);</span><br><span class="line">        log.info(<span class="string">&quot;ç»“æœä¸ºï¼š&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TIMEOUT</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">        log.info(<span class="string">&quot;ç»“æœä¸ºï¼š&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ•…éšœåŸå› ï¼š</p><p>8001åŒä¸€å±‚æ¬¡çš„å…¶ä»–æ¥å£æœåŠ¡è¢«å›°æ­»ï¼Œå› ä¸ºtomcatçº¿ç¨‹é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯•</p><p>80æ­¤æ—¶è°ƒç”¨8001ï¼Œå®¢æˆ·ç«¯è®¿é—®å“åº”ç¼“æ…¢ï¼Œè½¬åœˆåœˆ</p></blockquote><h2 id="3-3ã€è§£å†³æ–¹æ¡ˆ"><a href="#3-3ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3.3ã€è§£å†³æ–¹æ¡ˆ"></a>3.3ã€è§£å†³æ–¹æ¡ˆ</h2><h3 id="1ã€é—®é¢˜1"><a href="#1ã€é—®é¢˜1" class="headerlink" title="1ã€é—®é¢˜1"></a>1ã€é—®é¢˜1</h3><blockquote><p>è¶…æ—¶å¯¼è‡´æœåŠ¡å™¨å˜æ…¢ï¼ˆè½¬åœˆï¼‰</p></blockquote><p>è¶…æ—¶ä¸å†ç­‰å¾…</p><h3 id="2ã€é—®é¢˜2"><a href="#2ã€é—®é¢˜2" class="headerlink" title="2ã€é—®é¢˜2"></a>2ã€é—®é¢˜2</h3><blockquote><p>å‡ºé”™ï¼ˆæœåŠ¡å™¨å®•æœºæˆ–è€…ç¨‹åºè¿è¡Œé”™è¯¯ï¼‰</p></blockquote><p>å‡ºé”™è¦æœ‰å…œåº•æ–¹æ¡ˆ</p><h3 id="3ã€è§£å†³"><a href="#3ã€è§£å†³" class="headerlink" title="3ã€è§£å†³"></a>3ã€è§£å†³</h3><blockquote><p>å¯¹æ–¹æœåŠ¡ï¼ˆ8001ï¼‰è¶…æ—¶äº†ï¼Œè°ƒç”¨è€…ï¼ˆ80ï¼‰ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§</p><p>å¯¹æ–¹æœåŠ¡ï¼ˆ8001ï¼‰downæœºäº†ï¼Œè°ƒç”¨è€…ï¼ˆ80ï¼‰ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§</p><p>å¯¹æ–¹æœåŠ¡ï¼ˆ8001ï¼‰OKï¼Œè°ƒç”¨è€…ï¼ˆ80ï¼‰è‡ªå·±å‡ºæ•…éšœæˆ–æœ‰è‡ªæˆ‘è¦æ±‚ï¼ˆè‡ªå·±çš„ç­‰å¾…æ—¶é—´å°äºæœåŠ¡æä¾›è€…ï¼‰ï¼Œè‡ªå·±å¤„ç†é™çº§</p></blockquote><h2 id="3-4ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰"><a href="#3-4ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰" class="headerlink" title="3.4ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰"></a>3.4ã€æœåŠ¡é™çº§ï¼ˆfallbackï¼‰</h2><h3 id="1ã€å¯¹è‡ªèº«è¿›è¡Œé™çº§é…ç½®"><a href="#1ã€å¯¹è‡ªèº«è¿›è¡Œé™çº§é…ç½®" class="headerlink" title="1ã€å¯¹è‡ªèº«è¿›è¡Œé™çº§é…ç½®"></a>1ã€å¯¹è‡ªèº«è¿›è¡Œé™çº§é…ç½®</h3><blockquote><p>å…ˆä»8001è‡ªèº«æ‰¾é—®é¢˜ï¼šéœ€è¦è®¾ç½®è‡ªèº«è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼ï¼Œåœ¨å³°å€¼æ—¶é—´å†…å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¶…è¿‡å³°å€¼åéœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†ï¼Œåšé™çº§å¤„ç†ã€‚</p><p>ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹</p></blockquote><ul><li>åœ¨ä¸šåŠ¡ç±»ä¸­å¯ç”¨@HystrixCommandæ³¨è§£</li><li>ä½¿ç”¨@HystrixCommandæ³¨è§£çš„fallbackMethodå±æ€§æŒ‡å®šå…œåº•æ–¹æ³•</li><li>ä½¿ç”¨@HystrixCommandæ³¨è§£çš„commandPropertieså±æ€§æŒ‡å®šè‡ªèº«è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;3000&quot;)  //3ç§’é’Ÿä»¥å†…å°±æ˜¯æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure><ul><li>è‹¥ä¸šåŠ¡æ—¶é—´åœ¨è¶…æ—¶æ—¶é—´å³°å€¼ä¹‹å†…ï¼Œé‚£ä¹ˆèµ°æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¶…è¿‡å³°å€¼åç›´æ¥è°ƒç”¨å…œåº•æ–¹æ³•ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentServiceImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_OK,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;ğŸ˜„&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">            @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;3000&quot;)  //3ç§’é’Ÿä»¥å†…å°±æ˜¯æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> timeOut = <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(timeOut);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">            interruptedException.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOut,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;ğŸ˜¢è€—æ—¶(S):&quot;</span> + timeOut;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOutHandler</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOutHandler,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;ğŸ˜“&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableCircuitBreakeræ³¨è§£æ¿€æ´»æœåŠ¡é™çº§</li><li>æµ‹è¯•ï¼Œç”±äºæˆ‘ä»¬è®¾ç½®äº†å³°å€¼æ—¶é—´ä¸º3sï¼Œè€Œæˆ‘ä»¬åœ¨ä¸šåŠ¡ä¸­ä¼‘çœ äº†5sï¼Œæ‰€ä»¥ä¼šè§¦å‘æœåŠ¡é™çº§</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212153100.png" alt="image-20210212153058330"></p><blockquote><p>é™¤è¶…å¸‚å¤–ï¼Œç³»ç»Ÿå‡ºç°å¼‚å¸¸æ—¶ä¹Ÿä¼šè°ƒç”¨å…œåº•æ–¹æ¡ˆ</p></blockquote><h3 id="2ã€å¯¹æ¶ˆè´¹ç«¯è¿›è¡Œé™çº§é…ç½®"><a href="#2ã€å¯¹æ¶ˆè´¹ç«¯è¿›è¡Œé™çº§é…ç½®" class="headerlink" title="2ã€å¯¹æ¶ˆè´¹ç«¯è¿›è¡Œé™çº§é…ç½®"></a>2ã€å¯¹æ¶ˆè´¹ç«¯è¿›è¡Œé™çº§é…ç½®</h3><blockquote><p>å¯¹äºéœ€è¦<strong>è¿œç¨‹è°ƒç”¨payment8001çš„è®¢å•å¾®æœåŠ¡80</strong>ï¼Œå®ƒä¹Ÿå¯ä»¥æ›´å¥½åœ°ä¿æŠ¤è‡ªå·±ï¼Œ<strong>å¯¹è‡ªå·±è¿›è¡Œå®¢æˆ·ç«¯é™çº§ä¿æŠ¤</strong>ã€‚</p><p>hystrixçš„æœåŠ¡é™çº§æ—¢å¯ä»¥åšåœ¨æ¶ˆè´¹ï¼ˆè°ƒç”¨æœåŠ¡ï¼‰ç«¯ï¼Œä¹Ÿå¯ä»¥åšåœ¨æœåŠ¡ï¼ˆæä¾›æœåŠ¡ï¼‰ç«¯ï¼Œä½†æœåŠ¡é™çº§ä¸€èˆ¬åšåœ¨æ¶ˆè´¹ç«¯</p></blockquote><ul><li>åœ¨80è®¢å•å¾®æœåŠ¡çš„ymlæ–‡ä»¶ä¸­æ·»åŠ é…ç½®</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">hystrix:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#å¦‚æœå¤„ç†è‡ªèº«çš„å®¹é”™å°±å¼€å¯ã€‚å¼€å¯æ–¹å¼ä¸ç”Ÿäº§ç«¯ä¸ä¸€æ ·ã€‚</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨80è®¢å•å¾®æœåŠ¡çš„ä¸»å¯åŠ¨ç±»ä¸Šæ·»åŠ @EnableHystrixæ³¨è§£æ¿€æ´»Hystrix</li><li>ä¿®æ”¹ä¸šåŠ¡ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentTimeOutFallbackMethod&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;1500&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TIMEOUT</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">    String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentTimeOutFallbackMethod</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ˜¯æ¶ˆè´¹è€…80ï¼Œå¯¹ä»˜æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,(â”¬ï¼¿â”¬)&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æµ‹è¯•</p><ul><li>ä¿®æ”¹paymentHystrix8001ä¸­çš„ä¸šåŠ¡ç±»ï¼Œç¡®ä¿8001ä¸­çš„æ–¹æ³•å¯ä»¥æ­£å¸¸è¿è¡Œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentInfo_TimeOutHandler&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;,value = &quot;5000&quot;)  //3ç§’é’Ÿä»¥å†…å°±æ˜¯æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> timeOut = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(timeOut);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">        interruptedException.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;çº¿ç¨‹æ± ï¼š&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;paymentInfo_TimeOut,id:&quot;</span> + id + <span class="string">&quot;\t&quot;</span> + <span class="string">&quot;ğŸ˜¢è€—æ—¶(S):&quot;</span> + timeOut;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨å¾®æœåŠ¡ï¼Œæ­¤æ—¶ç”±äº80è®¢å•ä¸­å¾®æœåŠ¡çš„è¶…æ—¶æ—¶é—´å³°å€¼ä¸º1.5sï¼Œè€Œ8001ä¼‘çœ äº†3sï¼Œæ‰€ä»¥80ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨è‡ªèº«çš„å…œåº•æ–¹æ³•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213205233.png"></p></li></ul><blockquote><p>å¦‚æœ80å¾®æœåŠ¡ç«¯å‘ç”Ÿè¿è¡Œæ—¶å¼‚å¸¸ï¼Œé‚£ä¹ˆä¹Ÿä¼šç›´æ¥æ‰§è¡Œå…œåº•æ–¹æ¡ˆã€‚</p></blockquote><h3 id="3ã€ä»¥ä¸Šé…ç½®å­˜åœ¨çš„é—®é¢˜"><a href="#3ã€ä»¥ä¸Šé…ç½®å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="3ã€ä»¥ä¸Šé…ç½®å­˜åœ¨çš„é—®é¢˜"></a>3ã€ä»¥ä¸Šé…ç½®å­˜åœ¨çš„é—®é¢˜</h3><ul><li>æ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€</li><li>ä¸šåŠ¡é€»è¾‘å’Œå…œåº•æ–¹æ³•æ··æ‚åœ¨ä¸€èµ·ï¼Œä»£ç æ··ä¹±ã€‚</li><li>å…¨å±€å…œåº•æ–¹æ³•å’Œè‡ªå®šä¹‰å…œåº•æ–¹æ³•åˆ†å¼€</li></ul><blockquote><p>é…ç½®ä¸€ä¸ªå…¨å±€å…œåº•æ–¹æ³•ï¼Œä½¿ç”¨@DefaultProperties(defaultFallback = â€œå…¨å±€å…œåº•æ–¹æ³•åâ€) æ¥æŒ‡å®šå…¨å±€å…œåº•æ–¹æ³•ã€‚</p><p>åŠ å…¥å…¨å±€å…œåº•æ–¹æ³•åï¼Œä»£ç ç»“æ„å¯å˜ä¸º</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213210443.png" alt="img"></p><blockquote><p>1å¯¹Nï¼Œé™¤äº†ä¸ªåˆ«é‡è¦æ ¸å¿ƒä¸šåŠ¡æœ‰ä¸“å±å…œåº•æ–¹æ³•ï¼Œå…¶ä½™æ™®é€šçš„æ–¹æ³•éƒ½å¯ä»¥é€šè¿‡å…¨å±€å…œåº•æ–¹æ³•ç»Ÿä¸€å…œåº•ã€‚</p><p>ä¿®æ”¹80è®¢å•å¾®æœåŠ¡çš„Controllerå±‚</p></blockquote><ul><li>æ·»åŠ ä¸€ä¸ªå…¨å±€å…œåº•æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * ä¸‹é¢æ˜¯å…¨å±€fallbackæ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">payment_Global_FallbackMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•...ğŸ˜“&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ§åˆ¶å™¨ä¸Šæ·»åŠ æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DefaultProperties(defaultFallback = &quot;payment_Global_FallbackMethod&quot;)</span></span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ä¸šåŠ¡ç±»ï¼Œä½¿ç”¨å…¨å±€å…œåº•æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/consumer/payment/hystrix/timeout/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@HystrixCommand</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TIMEOUT</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">    String result = paymentHystrixService.paymentInfo_TimeOut(id);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ä¸ºè¿œç¨‹è°ƒç”¨æ¥å£æ·»åŠ ä¸€ä¸ªç»Ÿä¸€é™çº§ç±»"><a href="#4ã€ä¸ºè¿œç¨‹è°ƒç”¨æ¥å£æ·»åŠ ä¸€ä¸ªç»Ÿä¸€é™çº§ç±»" class="headerlink" title="4ã€ä¸ºè¿œç¨‹è°ƒç”¨æ¥å£æ·»åŠ ä¸€ä¸ªç»Ÿä¸€é™çº§ç±»"></a>4ã€ä¸ºè¿œç¨‹è°ƒç”¨æ¥å£æ·»åŠ ä¸€ä¸ªç»Ÿä¸€é™çº§ç±»</h3><blockquote><p>æœåŠ¡é™çº§ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ç«¯ï¼Œç¢°ä¸ŠæœåŠ¡ç«¯å®•æœºæˆ–å…³é—­ã€‚</p><p>ä¿®æ”¹order80è®¢å•å¾®æœåŠ¡ï¼Œæ ¹æ®order80è®¢å•å¾®æœåŠ¡å·²ç»æœ‰çš„PaymentHystrixServiceæ¥å£ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ªç±»ï¼ˆPaymentFallbackServiceï¼‰å®ç°è¯¥æ¥å£ï¼Œç»Ÿä¸€ä¸ºæ¥å£é‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚</p><p>ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ç°PaymentHystrixServiceæ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentFallbackService</span> <span class="keyword">implements</span> <span class="title">PaymentHystrixService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_OK</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;----PaymentFallbackService fall back-payment_OKï¼ŒğŸ˜‚&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">paymentInfo_TimeOut</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;----PaymentFallbackService fall back-paymentInfo_TimeOutï¼ŒğŸ˜‚&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤æ—¶æ²¡æœ‰é…ç½®ä»»ä½•å…œåº•æ–¹æ³•çš„paymentInfo_OKæ–¹æ³•ç”±PaymentFallbackServiceç±»ä¸­çš„å®ç°æ–¹æ³•å…œåº•</p><p>æµ‹è¯•</p></blockquote><ul><li>æ­£å¸¸æµ‹è¯•ï¼Œè®¿é—®ï¼š<a href="http://localhost/consumer/payment/hystrix/ok/31">http://localhost/consumer/payment/hystrix/ok/31</a></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213214055.png" alt="image-20210213214054384"></p><ul><li>å…³é—­payment8001ï¼Œæ¨¡æ‹ŸæœåŠ¡ç«¯å®•æœºï¼Œé‡æ–°è®¿é—®ï¼š<a href="http://localhost/consumer/payment/hystrix/ok/31">http://localhost/consumer/payment/hystrix/ok/31</a> ï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†PaymentFallbackServiceç±»ä¸­çš„å®ç°æ–¹æ³•å…œåº•ã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213214153.png" alt="image-20210213214152979"></p><blockquote><p>æ­¤æ—¶æœåŠ¡ç«¯providerå·²ç»downäº†ï¼Œä½†æ˜¯æˆ‘ä»¬åšäº†æœåŠ¡é™çº§å¤„ç†ï¼Œè®©å®¢æˆ·ç«¯åœ¨æœåŠ¡ç«¯ä¸å¯ç”¨æ—¶ä¹Ÿä¼šè·å¾—æç¤ºä¿¡æ¯è€Œä¸ä¼šæŒ‚èµ·è€—æ­»æœåŠ¡å™¨</p></blockquote><h2 id="3-5ã€æœåŠ¡ç†”æ–­"><a href="#3-5ã€æœåŠ¡ç†”æ–­" class="headerlink" title="3.5ã€æœåŠ¡ç†”æ–­"></a>3.5ã€æœåŠ¡ç†”æ–­</h2><h3 id="1ã€ä¿®æ”¹cloud-provider-hystrix-payment8001"><a href="#1ã€ä¿®æ”¹cloud-provider-hystrix-payment8001" class="headerlink" title="1ã€ä¿®æ”¹cloud-provider-hystrix-payment8001"></a>1ã€ä¿®æ”¹cloud-provider-hystrix-payment8001</h3><ul><li>ä¿®æ”¹PaymentService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(fallbackMethod = &quot;paymentCircuitBreaker_fallback&quot;,commandProperties = &#123;</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.enabled&quot;,value = &quot;true&quot;),  //æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.requestVolumeThreshold&quot;,value = &quot;10&quot;),   //è¯·æ±‚æ¬¡æ•°</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.sleepWindowInMilliseconds&quot;,value = &quot;10000&quot;),  //æ—¶é—´èŒƒå›´</span></span><br><span class="line"><span class="meta">        @HystrixProperty(name = &quot;circuitBreaker.errorThresholdPercentage&quot;,value = &quot;60&quot;), //å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (id &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;*****id ä¸èƒ½è´Ÿæ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    String serialNumber = IdUtil.simpleUUID();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Thread.currentThread().getName()+<span class="string">&quot;\t&quot;</span>+<span class="string">&quot;è°ƒç”¨æˆåŠŸ,æµæ°´å·ï¼š&quot;</span>+serialNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…œåº•æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentCircuitBreaker_fallback</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨å€™å†è¯•,(â”¬ï¼¿â”¬)/~~     id: &quot;</span> +id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å±æ€§</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>@HystrixProperty(name = â€œcircuitBreaker.enabledâ€,value = â€œtrueâ€)</td><td>æ˜¯å¦å¼€å¯æ–­è·¯å™¨</td></tr><tr><td>@HystrixProperty(name = â€œcircuitBreaker.requestVolumeThresholdâ€,value = â€œ10â€)</td><td>è¯·æ±‚æ¬¡æ•°</td></tr><tr><td>@HystrixProperty(name = â€œcircuitBreaker.sleepWindowInMillisecondsâ€,value = â€œ10000â€)</td><td>æ—¶é—´çª—å£æœŸ/æ—¶é—´èŒƒå›´</td></tr><tr><td>@HystrixProperty(name = â€œcircuitBreaker.errorThresholdPercentageâ€,value = â€œ60â€)</td><td>å¤±è´¥ç‡åˆ°è¾¾å¤šå°‘åè·³é—¸</td></tr></tbody></table><blockquote><p>ä¸Šé¢è®¾ç½®çš„æ„æ€æ—¶ï¼Œå¦‚æœ10ç§’å†…10æ¬¡è¯·æ±‚ä¸­æœ‰60ä»¥ä¸Šå¤±è´¥ï¼Œå°±ç›´æ¥è·³é—¸</p></blockquote><ul><li>Controllerå±‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//===æœåŠ¡ç†”æ–­</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/payment/circuit/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentCircuitBreaker</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span></span>&#123;</span><br><span class="line">    String result = paymentService.paymentCircuitBreaker(id);</span><br><span class="line">    log.info(<span class="string">&quot;*******result:&quot;</span>+result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€æµ‹è¯•ç¬¦åˆæ¡ä»¶çš„å‚æ•°"><a href="#2ã€æµ‹è¯•ç¬¦åˆæ¡ä»¶çš„å‚æ•°" class="headerlink" title="2ã€æµ‹è¯•ç¬¦åˆæ¡ä»¶çš„å‚æ•°"></a>2ã€æµ‹è¯•ç¬¦åˆæ¡ä»¶çš„å‚æ•°</h3><ul><li>è®¿é—® <a href="http://localhost:8001/payment/circuit/31">http://localhost:8001/payment/circuit/31</a> ï¼Œç”±äºidä¸ºæ­£æ•°ï¼Œæ‰€ä»¥æµ‹è¯•é€šè¿‡ã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213220833.png" alt="image-20210213220832634"></p><h3 id="3ã€æ¼”ç¤ºæœåŠ¡ç†”æ–­"><a href="#3ã€æ¼”ç¤ºæœåŠ¡ç†”æ–­" class="headerlink" title="3ã€æ¼”ç¤ºæœåŠ¡ç†”æ–­"></a>3ã€æ¼”ç¤ºæœåŠ¡ç†”æ–­</h3><ul><li>æ¼”ç¤ºæœåŠ¡ç†”æ–­ï¼Œåœ¨çŸ­æ—¶é—´å†…è¿ç»­å¤šæ¬¡è¾“å…¥å°äº0çš„idå·ï¼Œç„¶åå†è¾“å…¥æ­£ç¡®çš„idï¼ŒæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213221321.png" alt="image-20210213221321526"></p><blockquote><p>ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ã€‚å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼Œè‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚</p></blockquote><h3 id="4ã€ç»“è®º"><a href="#4ã€ç»“è®º" class="headerlink" title="4ã€ç»“è®º"></a>4ã€ç»“è®º</h3><blockquote><p>ç†”æ–­ç±»å‹</p><ul><li>ç†”æ–­æ‰“å¼€ï¼šè¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡ï¼Œå†…éƒ¨è®¾ç½®æ—¶é’Ÿä¸€èˆ¬ä¸ºMTTR(å¹³å‡æ•…éšœå¤„ç†æ—¶é—´)ï¼Œå½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›å…¥ç†”æ–­çŠ¶æ€</li><li>ç†”æ–­å…³é—­ï¼šç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­</li><li>ç†”æ–­åŠå¼€ï¼šéƒ¨åˆ†è¯·æ±‚æ ¹æ®è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸ï¼Œå…³é—­ç†”æ–­</li></ul><p>ç†”æ–­å™¨å¼€å¯ã€åŠå¼€ã€å…³é—­çš„è½¬åŒ–å…³ç³»å¤§è‡´å¦‚ä¸‹</p><ul><li>å½“è¯·æ±‚é”™è¯¯æ¬¡æ•°åœ¨ä¸€å®šæ—¶é—´å†…æ²¡è¾¾åˆ°å³°å€¼æˆ–è€…è¯·æ±‚æˆåŠŸçš„æƒ…å†µä¸‹ï¼Œç†”æ–­å™¨å…³é—­ã€‚</li><li>å½“è¯·æ±‚é”™è¯¯æ¬¡æ•°åœ¨ä¸€å®šæ—¶é—´å†…è¾¾åˆ°å³°å€¼æ—¶ï¼Œç†”æ–­å™¨æ‰“å¼€ï¼Œæ­¤æ—¶è¿›å…¥æœåŠ¡ç†”æ–­çŠ¶æ€ï¼Œé€šè¿‡æœåŠ¡é™çº§å¯¹ä»»ä½•è¯·æ±‚è¿”å›æç¤ºã€‚</li><li>å½“ç†”æ–­ä¸€å®šæ—¶é—´åï¼Œç†”æ–­å™¨ä¼šè¿›å…¥åŠå¼€çŠ¶æ€ï¼Œæ­¤æ—¶å®ƒä¼šè¯•ç€é€šè¿‡ä¸€äº›è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é€šè¿‡ï¼Œé‚£ä¹ˆå®ƒä¼šä»åŠå¼€çŠ¶æ€è½¬æ¢ä¸ºå…³é—­çŠ¶æ€ï¼Œæ­¤æ—¶æœåŠ¡æ¢å¤ï¼Œå¦åˆ™ä»ç„¶è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼ŒæœåŠ¡ç»§ç»­ç†”æ–­ã€‚</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213222919.png" alt="image-20210213222918954"></p><h3 id="5ã€æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°"><a href="#5ã€æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°" class="headerlink" title="5ã€æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°"></a>5ã€æ–­è·¯å™¨çš„ä¸‰ä¸ªé‡è¦å‚æ•°</h3><blockquote><p>åˆ†åˆ«æ˜¯<strong>å¿«ç…§æ—¶é—´çª—</strong>ã€<strong>è¯·æ±‚æ€»æ•°é˜ˆå€¼</strong>å’Œ<strong>é”™è¯¯ç™¾åˆ†æ¯”é˜ˆå€¼</strong></p></blockquote><ul><li>å¿«ç…§æ—¶é—´çª—ï¼šæ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®ï¼Œè€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—ï¼Œé»˜è®¤ä¸ºæœ€è¿‘çš„10ç§’ã€‚</li><li>è¯·æ±‚æ€»æ•°é˜€å€¼ï¼šåœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜€å€¼æ‰æœ‰èµ„æ ¼ç†”æ–­ã€‚é»˜è®¤ä¸º20ï¼Œæ„å‘³ç€åœ¨10ç§’å†…ï¼Œå¦‚æœè¯¥hystrixå‘½ä»¤çš„è°ƒç”¨æ¬¡æ•°ä¸è¶³20æ¬¡ï¼Œå³ä½¿æ‰€æœ‰çš„è¯·æ±‚éƒ½è¶…æ—¶æˆ–å…¶ä»–åŸå› å¤±è´¥ï¼Œæ–­è·¯å™¨éƒ½ä¸ä¼šæ‰“å¼€ã€‚</li><li>é”™è¯¯ç™¾åˆ†æ¯”é˜€å€¼ï¼šå½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡äº†é˜€å€¼ï¼Œæ¯”å¦‚å‘ç”Ÿäº†30æ¬¡è°ƒç”¨ï¼Œå¦‚æœåœ¨è¿™30æ¬¡è°ƒç”¨ä¸­ï¼Œæœ‰15æ¬¡å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¶…è¿‡50%çš„é”™è¯¯ç™¾åˆ†æ¯”ï¼Œåœ¨é»˜è®¤è®¾å®š50%é˜€å€¼æƒ…å†µä¸‹ï¼Œè¿™æ—¶å€™å°±ä¼šå°†æ–­è·¯å™¨æ‰“å¼€ã€‚</li></ul><h3 id="6ã€Hystrixå¦‚ä½•è‡ªåŠ¨æ¢å¤ï¼Ÿ"><a href="#6ã€Hystrixå¦‚ä½•è‡ªåŠ¨æ¢å¤ï¼Ÿ" class="headerlink" title="6ã€Hystrixå¦‚ä½•è‡ªåŠ¨æ¢å¤ï¼Ÿ"></a>6ã€Hystrixå¦‚ä½•è‡ªåŠ¨æ¢å¤ï¼Ÿ</h3><blockquote><p>å¯¹äºè¿™ä¸€é—®é¢˜ï¼Œhystrixä¹Ÿä¸ºæˆ‘ä»¬å®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚<br>å½“æ–­è·¯å™¨æ‰“å¼€ï¼Œå¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­ä¹‹åï¼Œhystrixä¼šå¯åŠ¨ä¸€ä¸ª<strong>ä¼‘çœ æ—¶é—´çª—</strong>ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯ä¸´æ—¶çš„æˆä¸ºä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸï¼Œæ–­è·¯å™¨å°†è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥çš„ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœæ­¤æ¬¡è¯·æ±‚æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†ç»§ç»­é—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼Œå¦‚æœè¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œæ–­è·¯å™¨ç»§ç»­è¿›å…¥æ‰“å¼€çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶ã€‚</p></blockquote><h2 id="3-6ã€æœåŠ¡é™æµ"><a href="#3-6ã€æœåŠ¡é™æµ" class="headerlink" title="3.6ã€æœåŠ¡é™æµ"></a>3.6ã€æœåŠ¡é™æµ</h2><blockquote><p>æš‚æ—¶ç•™ç©º</p></blockquote><h1 id="å››ã€Hystrixå·¥ä½œæµç¨‹"><a href="#å››ã€Hystrixå·¥ä½œæµç¨‹" class="headerlink" title="å››ã€Hystrixå·¥ä½œæµç¨‹"></a>å››ã€Hystrixå·¥ä½œæµç¨‹</h1><h2 id="4-1ã€æµç¨‹å›¾"><a href="#4-1ã€æµç¨‹å›¾" class="headerlink" title="4.1ã€æµç¨‹å›¾"></a>4.1ã€æµç¨‹å›¾</h2><p><img src= "/img/loading.gif" data-lazy-src="https://github.com/Netflix/Hystrix/wiki/images/hystrix-command-flow-chart-640.png" alt="img"></p><h2 id="4-2ã€æ­¥éª¤è¯´æ˜"><a href="#4-2ã€æ­¥éª¤è¯´æ˜" class="headerlink" title="4.2ã€æ­¥éª¤è¯´æ˜"></a>4.2ã€æ­¥éª¤è¯´æ˜</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210213225605.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ·Hystrix </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäº”ï¼‰-ç»Ÿä¸€è¿”å›ç»“æœã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢ã€è®¢å•æ“ä½œå’Œå®šæ—¶ä»»åŠ¡</title>
      <link href="posts/1717741625.html"/>
      <url>posts/1717741625.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€ç»Ÿä¸€è¿”å›æ ¼å¼"><a href="#1ã€ç»Ÿä¸€è¿”å›æ ¼å¼" class="headerlink" title="1ã€ç»Ÿä¸€è¿”å›æ ¼å¼"></a>1ã€ç»Ÿä¸€è¿”å›æ ¼å¼</h2><blockquote><p>åœ¨å‰åç«¯æ¥å£äº¤äº’ä¸­ï¼Œå‰ç«¯æŒ‰ç…§çº¦å®šè¯·æ±‚URLè·¯å¾„ï¼Œå¹¶ä¼ å…¥ç›¸å…³å‚æ•°ï¼Œåç«¯æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œè¿”å›æ•°æ®ç»™å‰ç«¯ã€‚åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šå°†åç«¯çš„ç»“æœ<strong>å°è£…ä¸ºJSONæ•°æ®</strong>è¿”å›ï¼Œç»Ÿä¸€çš„æ•°æ®æ ¼å¼ä¼šä½¿å‰ç«¯å¯¹æ•°æ®çš„æ“ä½œæ›´ä¸€è‡´ã€è½»æ¾ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»Ÿä¸€è¿”å›æ•°æ®æ ¼å¼æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œåªè¦èƒ½æè¿°æ¸…æ¥šè¿”å›çš„æ•°æ®çŠ¶æ€ä»¥åŠè¦è¿”å›çš„å…·ä½“æ•°æ®å°±å¯ä»¥ã€‚ä½†æ˜¯ä¸€èˆ¬ä¼šåŒ…å«<strong>çŠ¶æ€ç </strong>ã€<strong>è¿”å›æ¶ˆæ¯</strong>ã€<strong>æ•°æ®</strong>è¿™å‡ éƒ¨åˆ†å†…å®¹</p></blockquote><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¦æ±‚è¿”å›çš„åŸºæœ¬æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li><strong>åˆ—è¡¨ï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;success&quot;</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;åˆ˜å¾·å&quot;</span>,</span><br><span class="line">        <span class="string">&quot;intro&quot;</span>: <span class="string">&quot;æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>åˆ†é¡µï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;success&quot;</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span>: <span class="number">17</span>,</span><br><span class="line">    <span class="string">&quot;rows&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;åˆ˜å¾·å&quot;</span>,</span><br><span class="line">        <span class="string">&quot;intro&quot;</span>: <span class="string">&quot;æ¯•ä¸šäºå¸ˆèŒƒå¤§å­¦æ•°å­¦ç³»ï¼Œçƒ­çˆ±æ•™è‚²äº‹ä¸šï¼Œæ‰§æ•™æ•°å­¦æ€ç»´6å¹´æœ‰ä½™&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ²¡æœ‰è¿”å›æ•°æ®ï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;success&quot;</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å¤±è´¥ï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;success&quot;</span>: <span class="keyword">false</span>,</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="number">20001</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;å¤±è´¥&quot;</span>,</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬å®šä¹‰ç»Ÿä¸€è¿”å›æ ¼å¼ä¸ºï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;success&quot;</span>: å¸ƒå°”, <span class="comment">//å“åº”æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">  <span class="string">&quot;code&quot;</span>: æ•°å­—, <span class="comment">//å“åº”ç </span></span><br><span class="line">  <span class="string">&quot;message&quot;</span>: å­—ç¬¦ä¸², <span class="comment">//è¿”å›æ¶ˆæ¯</span></span><br><span class="line">  <span class="string">&quot;data&quot;</span>: HashMap <span class="comment">//è¿”å›æ•°æ®ï¼Œæ”¾åœ¨é”®å€¼å¯¹ä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€å®šä¹‰ç»Ÿä¸€è¿”å›ç»“æœ"><a href="#2ã€å®šä¹‰ç»Ÿä¸€è¿”å›ç»“æœ" class="headerlink" title="2ã€å®šä¹‰ç»Ÿä¸€è¿”å›ç»“æœ"></a>2ã€å®šä¹‰ç»Ÿä¸€è¿”å›ç»“æœ</h2><h3 id="2-1ã€åˆ›å»ºè¿”å›ç å®šä¹‰æšä¸¾ç±»"><a href="#2-1ã€åˆ›å»ºè¿”å›ç å®šä¹‰æšä¸¾ç±»" class="headerlink" title="2.1ã€åˆ›å»ºè¿”å›ç å®šä¹‰æšä¸¾ç±»"></a>2.1ã€åˆ›å»ºè¿”å›ç å®šä¹‰æšä¸¾ç±»</h3><blockquote><p>çŠ¶æ€ç å®šä¹‰æšä¸¾ç±»å¯¹äºç‰¹æ®Šå“åº”æƒ…å†µåšäº†å®šä¹‰ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ResultCodeEnum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="keyword">true</span>, <span class="number">20000</span>,<span class="string">&quot;æˆåŠŸ&quot;</span>),</span><br><span class="line">    UNKNOWN_REASON(<span class="keyword">false</span>, <span class="number">20001</span>, <span class="string">&quot;æœªçŸ¥é”™è¯¯&quot;</span>),</span><br><span class="line"></span><br><span class="line">    BAD_SQL_GRAMMAR(<span class="keyword">false</span>, <span class="number">21001</span>, <span class="string">&quot;sqlè¯­æ³•é”™è¯¯&quot;</span>),</span><br><span class="line">    JSON_PARSE_ERROR(<span class="keyword">false</span>, <span class="number">21002</span>, <span class="string">&quot;jsonè§£æå¼‚å¸¸&quot;</span>),</span><br><span class="line">    PARAM_ERROR(<span class="keyword">false</span>, <span class="number">21003</span>, <span class="string">&quot;å‚æ•°ä¸æ­£ç¡®&quot;</span>),</span><br><span class="line"></span><br><span class="line">    FILE_UPLOAD_ERROR(<span class="keyword">false</span>, <span class="number">21004</span>, <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ é”™è¯¯&quot;</span>),</span><br><span class="line">    FILE_DELETE_ERROR(<span class="keyword">false</span>, <span class="number">21005</span>, <span class="string">&quot;æ–‡ä»¶åˆªé™¤é”™è¯¯&quot;</span>),</span><br><span class="line">    EXCEL_DATA_IMPORT_ERROR(<span class="keyword">false</span>, <span class="number">21006</span>, <span class="string">&quot;Excelæ•°æ®å¯¼å…¥é”™è¯¯&quot;</span>),</span><br><span class="line"></span><br><span class="line">    VIDEO_UPLOAD_ALIYUN_ERROR(<span class="keyword">false</span>, <span class="number">22001</span>, <span class="string">&quot;è§†é¢‘ä¸Šä¼ è‡³é˜¿é‡Œäº‘å¤±è´¥&quot;</span>),</span><br><span class="line">    VIDEO_UPLOAD_TOMCAT_ERROR(<span class="keyword">false</span>, <span class="number">22002</span>, <span class="string">&quot;è§†é¢‘ä¸Šä¼ è‡³ä¸šåŠ¡æœåŠ¡å™¨å¤±è´¥&quot;</span>),</span><br><span class="line">    VIDEO_DELETE_ALIYUN_ERROR(<span class="keyword">false</span>, <span class="number">22003</span>, <span class="string">&quot;é˜¿é‡Œäº‘è§†é¢‘æ–‡ä»¶åˆ é™¤å¤±è´¥&quot;</span>),</span><br><span class="line">    FETCH_VIDEO_UPLOADAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22004</span>, <span class="string">&quot;è·å–ä¸Šä¼ åœ°å€å’Œå‡­è¯å¤±è´¥&quot;</span>),</span><br><span class="line">    REFRESH_VIDEO_UPLOADAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22005</span>, <span class="string">&quot;åˆ·æ–°ä¸Šä¼ åœ°å€å’Œå‡­è¯å¤±è´¥&quot;</span>),</span><br><span class="line">    FETCH_PLAYAUTH_ERROR(<span class="keyword">false</span>, <span class="number">22006</span>, <span class="string">&quot;è·å–æ’­æ”¾å‡­è¯å¤±è´¥&quot;</span>),</span><br><span class="line"></span><br><span class="line">    URL_ENCODE_ERROR(<span class="keyword">false</span>, <span class="number">23001</span>, <span class="string">&quot;URLç¼–ç å¤±è´¥&quot;</span>),</span><br><span class="line">    ILLEGAL_CALLBACK_REQUEST_ERROR(<span class="keyword">false</span>, <span class="number">23002</span>, <span class="string">&quot;éæ³•å›è°ƒè¯·æ±‚&quot;</span>),</span><br><span class="line">    FETCH_ACCESSTOKEN_FAILD(<span class="keyword">false</span>, <span class="number">23003</span>, <span class="string">&quot;è·å–accessTokenå¤±è´¥&quot;</span>),</span><br><span class="line">    FETCH_USERINFO_ERROR(<span class="keyword">false</span>, <span class="number">23004</span>, <span class="string">&quot;è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥&quot;</span>),</span><br><span class="line">    LOGIN_ERROR(<span class="keyword">false</span>, <span class="number">23005</span>, <span class="string">&quot;ç™»å½•å¤±è´¥&quot;</span>),</span><br><span class="line"></span><br><span class="line">    COMMENT_EMPTY(<span class="keyword">false</span>, <span class="number">24006</span>, <span class="string">&quot;è¯„è®ºå†…å®¹å¿…é¡»å¡«å†™&quot;</span>),</span><br><span class="line"></span><br><span class="line">    PAY_RUN(<span class="keyword">false</span>, <span class="number">25000</span>, <span class="string">&quot;æ”¯ä»˜ä¸­&quot;</span>),</span><br><span class="line">    PAY_UNIFIEDORDER_ERROR(<span class="keyword">false</span>, <span class="number">25001</span>, <span class="string">&quot;ç»Ÿä¸€ä¸‹å•é”™è¯¯&quot;</span>),</span><br><span class="line">    PAY_ORDERQUERY_ERROR(<span class="keyword">false</span>, <span class="number">25002</span>, <span class="string">&quot;æŸ¥è¯¢æ”¯ä»˜ç»“æœé”™è¯¯&quot;</span>),</span><br><span class="line"></span><br><span class="line">    ORDER_EXIST_ERROR(<span class="keyword">false</span>, <span class="number">25003</span>, <span class="string">&quot;è¯¾ç¨‹å·²è´­ä¹°&quot;</span>),</span><br><span class="line"></span><br><span class="line">    GATEWAY_ERROR(<span class="keyword">false</span>, <span class="number">26000</span>, <span class="string">&quot;æœåŠ¡ä¸èƒ½è®¿é—®&quot;</span>),</span><br><span class="line"></span><br><span class="line">    CODE_ERROR(<span class="keyword">false</span>, <span class="number">28000</span>, <span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>),</span><br><span class="line"></span><br><span class="line">    LOGIN_PHONE_ERROR(<span class="keyword">false</span>, <span class="number">28009</span>, <span class="string">&quot;æ‰‹æœºå·ç ä¸æ­£ç¡®&quot;</span>),</span><br><span class="line">    LOGIN_MOBILE_ERROR(<span class="keyword">false</span>, <span class="number">28001</span>, <span class="string">&quot;è´¦å·ä¸æ­£ç¡®&quot;</span>),</span><br><span class="line">    LOGIN_PASSWORD_ERROR(<span class="keyword">false</span>, <span class="number">28008</span>, <span class="string">&quot;å¯†ç ä¸æ­£ç¡®&quot;</span>),</span><br><span class="line">    LOGIN_DISABLED_ERROR(<span class="keyword">false</span>, <span class="number">28002</span>, <span class="string">&quot;è¯¥ç”¨æˆ·å·²è¢«ç¦ç”¨&quot;</span>),</span><br><span class="line">    REGISTER_MOBLE_ERROR(<span class="keyword">false</span>, <span class="number">28003</span>, <span class="string">&quot;æ‰‹æœºå·å·²è¢«æ³¨å†Œ&quot;</span>),</span><br><span class="line">    LOGIN_AUTH(<span class="keyword">false</span>, <span class="number">28004</span>, <span class="string">&quot;éœ€è¦ç™»å½•&quot;</span>),</span><br><span class="line">    LOGIN_ACL(<span class="keyword">false</span>, <span class="number">28005</span>, <span class="string">&quot;æ²¡æœ‰æƒé™&quot;</span>),</span><br><span class="line">    SMS_SEND_ERROR(<span class="keyword">false</span>, <span class="number">28006</span>, <span class="string">&quot;çŸ­ä¿¡å‘é€å¤±è´¥&quot;</span>),</span><br><span class="line">    SMS_SEND_ERROR_BUSINESS_LIMIT_CONTROL(<span class="keyword">false</span>, <span class="number">28007</span>, <span class="string">&quot;çŸ­ä¿¡å‘é€è¿‡äºé¢‘ç¹&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    ResultCodeEnum(Boolean success, Integer code, String message) &#123;</span><br><span class="line">        <span class="keyword">this</span>.success = success;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2ã€åˆ›å»ºç»“æœç±»"><a href="#2-2ã€åˆ›å»ºç»“æœç±»" class="headerlink" title="2.2ã€åˆ›å»ºç»“æœç±»"></a>2.2ã€åˆ›å»ºç»“æœç±»</h3><blockquote><p>å¯¹äºè¿”å›æ•°æ®æœ‰ä¸¤ç§èµ‹å€¼æ–¹æ³•ï¼Œä¸€æ˜¯ä¼ å…¥ä¸€ä¸ªMapå¯¹è±¡ï¼ŒäºŒæ˜¯ä¼ å…¥ä¸€ä¸ªKeyå’Œä¸€ä¸ªValueã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;å…¨å±€ç»Ÿä¸€è¿”å›ç»“æœ&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æ˜¯å¦æˆåŠŸ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¿”å›ç &quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¿”å›æ¶ˆæ¯&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¿”å›æ•°æ®&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">R</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">()</span></span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(ResultCodeEnum.SUCCESS.getSuccess());</span><br><span class="line">        r.setCode(ResultCodeEnum.SUCCESS.getCode());</span><br><span class="line">        r.setMessage(ResultCodeEnum.SUCCESS.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">()</span></span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(ResultCodeEnum.UNKNOWN_REASON.getSuccess());</span><br><span class="line">        r.setCode(ResultCodeEnum.UNKNOWN_REASON.getCode());</span><br><span class="line">        r.setMessage(ResultCodeEnum.UNKNOWN_REASON.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">setResult</span><span class="params">(ResultCodeEnum resultCodeEnum)</span></span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(resultCodeEnum.getSuccess());</span><br><span class="line">        r.setCode(resultCodeEnum.getCode());</span><br><span class="line">        r.setMessage(resultCodeEnum.getMessage());</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">success</span><span class="params">(Boolean success)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">message</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">code</span><span class="params">(Integer code)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(String key, Object value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3ã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢"><a href="#3ã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢" class="headerlink" title="3ã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢"></a>3ã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢</h2><h3 id="3-1ã€éœ€æ±‚è¯´æ˜"><a href="#3-1ã€éœ€æ±‚è¯´æ˜" class="headerlink" title="3.1ã€éœ€æ±‚è¯´æ˜"></a>3.1ã€éœ€æ±‚è¯´æ˜</h3><blockquote><p>åœ¨è®²å¸ˆåˆ†é¡µåˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è®²å¸ˆåè¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ ¹æ®è®²å¸ˆå¤´è¡”ã€è®²å¸ˆå…¥é©»æ—¶é—´è¿›è¡ŒæŸ¥è¯¢ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212210910.png" alt="image-20210212210909529"></p><h3 id="3-2ã€åˆ›å»ºæŸ¥è¯¢å¯¹è±¡"><a href="#3-2ã€åˆ›å»ºæŸ¥è¯¢å¯¹è±¡" class="headerlink" title="3.2ã€åˆ›å»ºæŸ¥è¯¢å¯¹è±¡"></a>3.2ã€åˆ›å»ºæŸ¥è¯¢å¯¹è±¡</h3><blockquote><p>åˆ›å»ºè®²å¸ˆæ¡ä»¶æŸ¥è¯¢ç±»TeacherQueryVoï¼Œè¯¥ç±»å®šä¹‰äº†3.1ä¸­çš„å››ä¸ªæ¡ä»¶å±æ€§ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherQueryVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line">    <span class="keyword">private</span> String joinDateBegin;</span><br><span class="line">    <span class="keyword">private</span> String joinDateEnd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3ã€åœ¨TeacherControllerä¸­ç¼–å†™ä¸€ä¸ªåˆ†é¡µæ¡ä»¶æŸ¥è¯¢æ¥å£"><a href="#3-3ã€åœ¨TeacherControllerä¸­ç¼–å†™ä¸€ä¸ªåˆ†é¡µæ¡ä»¶æŸ¥è¯¢æ¥å£" class="headerlink" title="3.3ã€åœ¨TeacherControllerä¸­ç¼–å†™ä¸€ä¸ªåˆ†é¡µæ¡ä»¶æŸ¥è¯¢æ¥å£"></a>3.3ã€åœ¨TeacherControllerä¸­ç¼–å†™ä¸€ä¸ªåˆ†é¡µæ¡ä»¶æŸ¥è¯¢æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å®ç°æ¡ä»¶æŸ¥è¯¢å¸¦åˆ†é¡µæŸ¥è¯¢çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page å½“å‰é¡µ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> limit æ¯é¡µè®°å½•æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> queryVo æ¡ä»¶å°è£…æˆçš„æŸ¥è¯¢å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> æ€»è®°å½•æ•°åŠè®²å¸ˆåˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;list/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å®ç°æ¡ä»¶æŸ¥è¯¢å¸¦åˆ†é¡µ&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">listPage</span><span class="params">(<span class="meta">@ApiParam(value = &quot;å½“å‰é¡µ&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;page&quot;)</span> Long page,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="meta">@ApiParam(value = &quot;æ¯é¡µè®°å½•æ•°&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;limit&quot;)</span> Long limit,</span></span></span><br><span class="line"><span class="function"><span class="params">                  TeacherQueryVo queryVo)</span> </span>&#123;</span><br><span class="line">    Page&lt;Teacher&gt; pageParam = <span class="keyword">new</span> Page&lt;&gt;(page, limit);</span><br><span class="line">    IPage&lt;Teacher&gt; pageModel = teacherService.selectPage(pageParam, queryVo);</span><br><span class="line">    List&lt;Teacher&gt; records = pageModel.getRecords();</span><br><span class="line">    <span class="keyword">long</span> total = pageModel.getTotal();</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;total&quot;</span>, total).data(<span class="string">&quot;rows&quot;</span>, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4ã€åœ¨Serviceå±‚å®ç°selectPageæ–¹æ³•"><a href="#3-4ã€åœ¨Serviceå±‚å®ç°selectPageæ–¹æ³•" class="headerlink" title="3.4ã€åœ¨Serviceå±‚å®ç°selectPageæ–¹æ³•"></a>3.4ã€åœ¨Serviceå±‚å®ç°selectPageæ–¹æ³•</h3><blockquote><p>è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¼ å…¥çš„åˆ†é¡µå¯¹è±¡å’Œæ¡ä»¶æŸ¥è¯¢å¯¹è±¡ï¼Œé¦–å…ˆå¯¹ä¼ å…¥çš„æ¡ä»¶å¯¹è±¡è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶å¯¹è±¡ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥è¿›è¡Œä¸€æ¬¡æ™®é€šçš„åˆ†é¡µæŸ¥è¯¢;</p><p>å¦‚æœæ¡ä»¶å¯¹è±¡ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆåˆ†åˆ«å–å‡ºå…¶ä¸­çš„å››ä¸ªå±æ€§ï¼Œæ ¹æ®å±æ€§ç±»å‹ä½¿ç”¨QueryWrapperæ‹¼æ¥ä¸ä¸ºç©ºçš„æ¡ä»¶å±æ€§ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IPage&lt;Teacher&gt; <span class="title">selectPage</span><span class="params">(Page&lt;Teacher&gt; pageParam, TeacherQueryVo teacherQueryVo)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºåˆ†é¡µæŸ¥è¯¢åˆ—è¡¨</span></span><br><span class="line"><span class="comment">//        1ã€æ’åºï¼šæŒ‰ç…§sortå­—æ®µæ’åº</span></span><br><span class="line">    QueryWrapper&lt;Teacher&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByAsc(<span class="string">&quot;sort&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        2ã€åˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">if</span>(teacherQueryVo == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectPage(pageParam, queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        3ã€æ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line">    String name = teacherQueryVo.getName();</span><br><span class="line">    Integer level = teacherQueryVo.getLevel();</span><br><span class="line">    String joinDateBegin = teacherQueryVo.getJoinDateBegin();</span><br><span class="line">    String joinDateEnd = teacherQueryVo.getJoinDateEnd();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(name))&#123;</span><br><span class="line">        queryWrapper.likeRight(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(level != <span class="keyword">null</span>)&#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;level&quot;</span>, level);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(joinDateBegin))&#123;</span><br><span class="line">        queryWrapper.ge(<span class="string">&quot;join_date&quot;</span>, joinDateBegin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(joinDateEnd))&#123;</span><br><span class="line">        queryWrapper.le(<span class="string">&quot;join_date&quot;</span>, joinDateEnd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> baseMapper.selectPage(pageParam, queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5ã€æµ‹è¯•"><a href="#3-5ã€æµ‹è¯•" class="headerlink" title="3.5ã€æµ‹è¯•"></a>3.5ã€æµ‹è¯•</h3><blockquote><p>æ‰“å¼€swaggerï¼Œè¿›è¡Œæµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212213414.png" alt="image-20210212213413862"></p><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212213429.png" alt="image-20210212213429863"></p><h2 id="4ã€è®¢å•æ“ä½œ"><a href="#4ã€è®¢å•æ“ä½œ" class="headerlink" title="4ã€è®¢å•æ“ä½œ"></a>4ã€è®¢å•æ“ä½œ</h2><blockquote><p>ç”±äºåªæœ‰ç™»å½•åçš„ç”¨æˆ·æ‰å¯ä»¥ä¸‹è®¢å•ï¼Œè€Œä¸”è®¢å•é™¤äº†å¿…éœ€çš„å•†å“å·å¤–ï¼Œè¿˜å¿…é¡»æœ‰ç”¨æˆ·å·ï¼Œåœ¨åˆæ³•ç”¨æˆ·ç™»å½•åï¼Œæˆ‘ä»¬ä¼šä¸‹å‘ç»™ç”¨æˆ·ä¸€ä¸ªtokenï¼Œåœ¨ä¹‹åçš„è®¢å•æ“ä½œä¸­ï¼Œç”¨æˆ·éœ€è¦åœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™åœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸Šè¿™ä¸ªtokenï¼ŒæœåŠ¡å™¨è§£æè¯·æ±‚å¤´ä¸­çš„tokenåå³å¯è·å–ç”¨æˆ·idã€‚</p></blockquote><h3 id="4-1ã€åˆ›å»ºJWTUtils"><a href="#4-1ã€åˆ›å»ºJWTUtils" class="headerlink" title="4.1ã€åˆ›å»ºJWTUtils"></a>4.1ã€åˆ›å»ºJWTUtils</h3><blockquote><p>è¿™ä¸ªå·¥å…·ç±»å°è£…äº†ä¸€ç³»åˆ—æœ‰å…³tokençš„æ–¹æ³•ï¼ŒåŒ…æ‹¬æ ¹æ®å¯†é’¥ç”Ÿæˆtokenï¼Œé‰´å®štokenæ˜¯å¦åˆæ³•ï¼Œä»è¯·æ±‚ä¸­çš„tokenè§£æå‡ºç”¨æˆ·ä¿¡æ¯ç­‰ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_SECRET = <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Key <span class="title">getKeyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = DatatypeConverter.parseBase64Binary(APP_SECRET);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SecretKeySpec(bytes,signatureAlgorithm.getJcaName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJwtToken</span><span class="params">(JwtInfo jwtInfo, <span class="keyword">int</span> expire)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String JwtToken = Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">                .setSubject(<span class="string">&quot;guli-user&quot;</span>)<span class="comment">//ä¸»é¢˜</span></span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())<span class="comment">//é¢å‘æ—¶é—´</span></span><br><span class="line">                .setExpiration(DateTime.now().plusSeconds(expire).toDate())<span class="comment">//è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, jwtInfo.getId())<span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, jwtInfo.getNickname())<span class="comment">//ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">                .claim(<span class="string">&quot;avatar&quot;</span>, jwtInfo.getAvatar())<span class="comment">//ç”¨æˆ·å¤´åƒ</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, getKeyInstance())</span><br><span class="line">                .compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkJwtTToken</span><span class="params">(String jwtToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkJwtTToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®tokenè·å–ä¼šå‘˜id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JwtInfo <span class="title">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        Claims claims = claimsJws.getBody();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtInfo(claims.get(<span class="string">&quot;id&quot;</span>).toString(), claims.get(<span class="string">&quot;nickname&quot;</span>).toString(), claims.get(<span class="string">&quot;avatar&quot;</span>).toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2ã€æ–°å¢è®¢å•â€“Controllerå±‚"><a href="#4-2ã€æ–°å¢è®¢å•â€“Controllerå±‚" class="headerlink" title="4.2ã€æ–°å¢è®¢å•â€“Controllerå±‚"></a>4.2ã€æ–°å¢è®¢å•â€“Controllerå±‚</h3><blockquote><p>è¿™ä¸ªæ–¹æ³•é™¤äº†æ¥æ”¶è¯¾ç¨‹Idå¤–ï¼Œè¿˜éœ€è¦æ¥æ”¶ä¸€ä¸ªHttpServletRequestå¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿™ä¸ªrequestå¯¹è±¡ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·idï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;æ–°å¢è®¢å•&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;auth/save/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">save</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@ApiParam(value = &quot;è¯¾ç¨‹Id&quot;,required = true)</span></span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@PathVariable</span> String courseId, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    JwtInfo jwtInfo = JwtUtils.getMemberIdByJwtToken(request);</span><br><span class="line">    <span class="comment">// è°ƒç”¨serviceå±‚æ·»åŠ è®¢å•çš„æ–¹æ³•ï¼Œéœ€è¦ä¼ å…¥è¯¾ç¨‹idå’Œç”¨æˆ·id</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•å°†è¿”å›æ–°å¢çš„è®¢å•id</span></span><br><span class="line">    String orderId = orderService.saveOrder(courseId,jwtInfo.getId());</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;orderId&quot;</span>,orderId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3ã€æ–°å¢è®¢å•â€“Serviceå±‚"><a href="#4-3ã€æ–°å¢è®¢å•â€“Serviceå±‚" class="headerlink" title="4.3ã€æ–°å¢è®¢å•â€“Serviceå±‚"></a>4.3ã€æ–°å¢è®¢å•â€“Serviceå±‚</h3><blockquote><p>Serviceå±‚ä¸­æ–°å¢è®¢å•çš„æµç¨‹å¦‚ä¸‹ï¼š</p></blockquote><ul><li>æ ¹æ®ä¼ å…¥çš„memberIdå’ŒcourseIdä½œä¸ºæ¡ä»¶ï¼Œä½¿ç”¨QueryWrapperæŸ¥è¯¢è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»å­˜åœ¨å½“å‰è¯¾ç¨‹çš„è®¢å•<ul><li>å¦‚æœå·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›å·²å­˜åœ¨çš„è®¢å•å·å³å¯</li></ul></li><li>æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯å’Œç”¨æˆ·ä¿¡æ¯æ˜¯å¦å­˜åœ¨</li><li>åˆ›å»ºè®¢å•ï¼Œä½¿ç”¨ä¸€ä¸ªå·¥å…·ç±»ç”Ÿæˆè®¢å•å·ï¼Œç„¶åå°†ä¸Šé¢æ ¹æ®è¯¾ç¨‹å·æŸ¥è¯¢åˆ°çš„è¯¾ç¨‹ä¿¡æ¯ï¼Œæ ¹æ®ç”¨æˆ·idæŸ¥è¯¢åˆ°çš„ç”¨æˆ·ä¿¡æ¯å¡«å…¥è®¢å•å¯¹è±¡ä¸­ã€‚</li><li>å‘æ•°æ®åº“ä¸­æ’å…¥è¯¥å¯¹è±¡ï¼Œæ ¹æ®Mybatis-Plusçš„idè‡ªåŠ¨å›å¡«åŠŸèƒ½å°†è®¢å•å¯¹è±¡Idè¿”å›ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">saveOrder</span><span class="params">(String courseId, String memberId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 æŸ¥è¯¢å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»å­˜åœ¨å½“å‰è¯¾ç¨‹çš„è®¢å•</span></span><br><span class="line">    QueryWrapper&lt;Order&gt; orderQueryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    orderQueryWrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId);</span><br><span class="line">    orderQueryWrapper.eq(<span class="string">&quot;member_id&quot;</span>,memberId);</span><br><span class="line">    Order orderExist = baseMapper.selectOne(orderQueryWrapper);</span><br><span class="line">    <span class="comment">//å¦‚æœå·²ç»å­˜åœ¨è®¢å•ï¼Œç›´æ¥è¿”å›æŸ¥æ‰¾åˆ°çš„è®¢å•idå³å¯</span></span><br><span class="line">    <span class="keyword">if</span>(orderExist != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> orderExist.getId();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2 æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span></span><br><span class="line">    CourseDto courseDto = eduCourseService.getCourseDtoById(courseId);</span><br><span class="line">    <span class="keyword">if</span>(courseDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæŸ¥è¯¢courseDtoä¸ºç©ºï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3 æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">    MemberDto memberDto = eduMemberService.getMemberDtoByMemberId(memberId);</span><br><span class="line">    <span class="keyword">if</span>(memberDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæŸ¥è¯¢memberDtoä¸ºç©ºï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4 åˆ›å»ºè®¢å•</span></span><br><span class="line">    Order order = <span class="keyword">new</span> Order();</span><br><span class="line">    order.setOrderNo(OrderNoUtils.getOrderNo());</span><br><span class="line">    order.setCourseId(courseId);</span><br><span class="line">    order.setCourseTitle(courseDto.getTitle());</span><br><span class="line">    order.setCourseCover(courseDto.getCover());</span><br><span class="line">    order.setTeacherName(courseDto.getTeacherName());</span><br><span class="line">    <span class="comment">//åˆ†</span></span><br><span class="line">    order.setTotalFee(courseDto.getPrice().multiply(<span class="keyword">new</span> BigDecimal(<span class="number">100</span>)));</span><br><span class="line">    order.setMemberId(memberId);</span><br><span class="line">    order.setMobile(memberDto.getMobile());</span><br><span class="line">    order.setNickname(memberDto.getNickname());</span><br><span class="line">    <span class="comment">//æœªæ”¯ä»˜</span></span><br><span class="line">    order.setStatus(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//å¾®ä¿¡æ”¯ä»˜</span></span><br><span class="line">    order.setPayType(<span class="number">1</span>);</span><br><span class="line">    baseMapper.insert(order);</span><br><span class="line">    <span class="keyword">return</span> order.getId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5ã€å®šæ—¶ä»»åŠ¡"><a href="#5ã€å®šæ—¶ä»»åŠ¡" class="headerlink" title="5ã€å®šæ—¶ä»»åŠ¡"></a>5ã€å®šæ—¶ä»»åŠ¡</h2><h3 id="5-1ã€å®šæ—¶ä»»åŠ¡å®ç°æ–¹å¼"><a href="#5-1ã€å®šæ—¶ä»»åŠ¡å®ç°æ–¹å¼" class="headerlink" title="5.1ã€å®šæ—¶ä»»åŠ¡å®ç°æ–¹å¼"></a>5.1ã€å®šæ—¶ä»»åŠ¡å®ç°æ–¹å¼</h3><blockquote><p>Timer</p></blockquote><p>ä½¿ç”¨jdkçš„Timerå’ŒTimerTaskå¯ä»¥å®ç°ç®€å•çš„é—´éš”æ‰§è¡Œä»»åŠ¡ï¼Œæ— æ³•å®ç°æŒ‰æ—¥å†å»è°ƒåº¦æ‰§è¡Œä»»åŠ¡</p><blockquote><p>ScheduledThreadPoolçº¿ç¨‹æ± </p></blockquote><p>åˆ›å»ºå¯ä»¥å»¶è¿Ÿæˆ–å®šæ—¶æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ— æ³•å®ç°æŒ‰æ—¥å†å»è°ƒåº¦æ‰§è¡Œä»»åŠ¡</p><blockquote><p>quartz</p></blockquote><p>ä½¿ç”¨Quartzå®ç° Quartz æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡è°ƒåº¦æ¡†æ¶ï¼ŒåŠŸèƒ½ä¸°å¯Œï¼Œå¯ä»¥å®ç°æŒ‰æ—¥å†è°ƒåº¦</p><blockquote><p>Spring Task</p></blockquote><p>Spring 3.0åæä¾›Spring Taskå®ç°ä»»åŠ¡è°ƒåº¦ï¼Œæ”¯æŒæŒ‰æ—¥å†è°ƒåº¦ï¼Œç›¸æ¯”QuartzåŠŸèƒ½ç¨ç®€å•ï¼Œä½†æ˜¯å¼€å‘åŸºæœ¬å¤Ÿç”¨ï¼Œæ”¯æŒæ³¨è§£ç¼–ç¨‹æ–¹å¼</p><h3 id="5-2ã€é›†æˆSpring-Task"><a href="#5-2ã€é›†æˆSpring-Task" class="headerlink" title="5.2ã€é›†æˆSpring Task"></a>5.2ã€é›†æˆSpring Task</h3><blockquote><p>åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£@EnableScheduling</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hzx.grain&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceStatisticsApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ServiceStatisticsApplication.class, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost:8180/doc.html&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost:8180/swagger-ui.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»"><a href="#5-3ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»" class="headerlink" title="5.3ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»"></a>5.3ã€åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DailyService dailyService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled(cron=&quot;0/3 * * * * *&quot;)</span> <span class="comment">// æ¯éš”3ç§’æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">task1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;task1 æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-4ã€æµ‹è¯•"><a href="#5-4ã€æµ‹è¯•" class="headerlink" title="5.4ã€æµ‹è¯•"></a>5.4ã€æµ‹è¯•</h3><blockquote><p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œå¯ä»¥å‘ç°æ§åˆ¶å°å®šæ—¶è¾“å‡ºæ—¥å¿—</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212215219.png" alt="image-20210212215219245"></p><h3 id="5-5ã€åœ¨çº¿ç”Ÿæˆcronè¡¨è¾¾å¼"><a href="#5-5ã€åœ¨çº¿ç”Ÿæˆcronè¡¨è¾¾å¼" class="headerlink" title="5.5ã€åœ¨çº¿ç”Ÿæˆcronè¡¨è¾¾å¼"></a>5.5ã€åœ¨çº¿ç”Ÿæˆcronè¡¨è¾¾å¼</h3><blockquote><p><a href="http://cron.qqe2.com/">http://cron.qqe2.com/</a></p></blockquote><blockquote><p>å‚è€ƒæ•™ç¨‹å¦‚ä¸‹ï¼š</p></blockquote><ul><li>[1]  <a href="https://www.bilibili.com/video/BV1fi4y1x7on">å°šç¡…è°·åœ¨çº¿æ•™è‚²é¡¹ç›®</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ†”JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆå››ï¼‰-äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</title>
      <link href="posts/1801475703.html"/>
      <url>posts/1801475703.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•"><a href="#1ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•" class="headerlink" title="1ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•"></a>1ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</h2><blockquote><p>äºŒåˆ†æŸ¥æ‰¾ï¼ˆBinary Searchï¼‰ä¹Ÿå«ä½œæŠ˜åŠæŸ¥æ‰¾ã€‚äºŒåˆ†æŸ¥æ‰¾æœ‰ä¸¤ä¸ªè¦æ±‚ï¼Œä¸€ä¸ªæ˜¯æ•°åˆ—æœ‰åºï¼Œå¦ä¸€ä¸ªæ˜¯æ•°åˆ—ä½¿ç”¨é¡ºåºå­˜å‚¨ç»“æ„ï¼ˆæ¯”å¦‚æ•°ç»„ï¼‰ã€‚</p></blockquote><h2 id="2ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„æ€è·¯åˆ†æ"><a href="#2ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„æ€è·¯åˆ†æ" class="headerlink" title="2ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„æ€è·¯åˆ†æ"></a>2ã€äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„æ€è·¯åˆ†æ</h2><blockquote><p>è¿™é‡Œä»¥æ•°ç»„[1,8,10,89,1000,1234]ä¸ºä¾‹</p></blockquote><ul><li>é¦–å…ˆç¡®å®šè¯¥æ•°ç»„ä¸­é—´å…ƒç´ çš„ä¸‹æ ‡mid</li></ul><blockquote><p>mid = [left+right] / 2</p></blockquote><ul><li>è®©éœ€è¦æŸ¥æ‰¾çš„æ•°findValå’Œarr[mid]æ¯”è¾ƒï¼Œæ­¤æ—¶ä¼šå‡ºç°ä»¥ä¸‹å‡ ç§æƒ…å†µ<ul><li>findVal&gt;arr[mid]ï¼Œè¯´æ˜è¦æŸ¥æ‰¾çš„æ•°åœ¨midçš„å³è¾¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€’å½’å‘å³æŸ¥æ‰¾</li><li>findVal&lt;arr[mid]ï¼Œè¯´æ˜è¦æŸ¥æ‰¾çš„æ•°åœ¨midçš„å·¦è¾¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€’å½’å‘å·¦æŸ¥æ‰¾</li><li>findVal=arr[mid]ï¼Œè¯´æ˜arr[mid]å°±æ˜¯æˆ‘ä»¬è¦å¯»æ‰¾çš„å€¼ï¼Œç›´æ¥è¿”å›mid</li></ul></li><li>ç»“æŸé€’å½’çš„æ¡ä»¶æœ‰<ul><li>æ‰¾åˆ°ç›®æ ‡å€¼ç»“æŸé€’å½’ã€‚</li><li>é€’å½’å®Œæ•´ä¸ªæ•°ç»„ä»ç„¶æ²¡æœ‰æ‰¾åˆ°findValï¼Œä¹Ÿéœ€è¦ç»“æŸé€’å½’ã€‚å³å½“left&gt;rightæ—¶ç»“æŸé€’å½’ã€‚</li></ul></li></ul><h2 id="3ã€é€’å½’äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„ä»£ç å®ç°"><a href="#3ã€é€’å½’äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„ä»£ç å®ç°" class="headerlink" title="3ã€é€’å½’äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„ä»£ç å®ç°"></a>3ã€é€’å½’äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„ä»£ç å®ç°</h2><blockquote><p>é€’å½’é€€å‡ºæ¡ä»¶1ï¼šå¯»æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œæ­¤æ—¶è¿”å›mid</p><p>é€’å½’é€€å‡ºæ¡ä»¶2ï¼šé€’å½’å®Œæ•´ä¸ªæ•°ç»„æ²¡æœ‰æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œæ­¤æ—¶left &gt; rightï¼Œè¿”å›-1</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr è¦æŸ¥æ‰¾çš„ç›®æ ‡æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left æœ¬æ¬¡æŸ¥æ‰¾çš„å·¦è¾¹ç•Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right æœ¬æ¬¡æŸ¥æ‰¾çš„å³è¾¹ç•Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> findVal è¦æŸ¥æ‰¾çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> findValåœ¨arrä¸­çš„ä¸‹æ ‡ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿”å›-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] arr,<span class="keyword">int</span> left,<span class="keyword">int</span> right,<span class="keyword">int</span> findVal)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left &gt; right) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå‘ç°leftå€¼å¤§äºrightå€¼ï¼Œé‚£ä¹ˆè¯æ˜æ­¤æ—¶æ•°ç»„å·²ç»é€’å½’å®Œæ¯•ä¸”æ•°ç»„ä¸­æ²¡æœ‰è¦å¯»æ‰¾çš„å€¼</span></span><br><span class="line">        <span class="comment">//æ­¤æ—¶éœ€è¦è¿”å›-1</span></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> midVal = arr[mid];</span><br><span class="line">    <span class="comment">//å¦‚æœè¦å¯»æ‰¾çš„å€¼å°äºå½“å‰çš„midVal</span></span><br><span class="line">    <span class="keyword">if</span>(findVal &gt; midVal) &#123;</span><br><span class="line">        <span class="comment">//å‘å³é€’å½’</span></span><br><span class="line">        <span class="keyword">return</span> binarySearch(arr,mid + <span class="number">1</span>,right,findVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(findVal &lt; midVal) &#123;</span><br><span class="line">        <span class="comment">//å‘å·¦é€’å½’</span></span><br><span class="line">        <span class="keyword">return</span> binarySearch(arr,left,mid - <span class="number">1</span>,findVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4ã€æµ‹è¯•"><a href="#4ã€æµ‹è¯•" class="headerlink" title="4ã€æµ‹è¯•"></a>4ã€æµ‹è¯•</h2><blockquote><p>æµ‹è¯•æ‰¾ä¸åˆ°çš„æƒ…å†µ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">89</span>,<span class="number">1000</span>,<span class="number">1234</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> resultIndex = binarySearch(arr,<span class="number">0</span>, arr.length - <span class="number">1</span>,<span class="number">10000</span>);</span><br><span class="line">    System.out.println(resultIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212170117.png" alt="image-20210212170116299"></p><blockquote><p>æµ‹è¯•æ‰¾å¾—åˆ°çš„æƒ…å†µ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">89</span>,<span class="number">1000</span>,<span class="number">1234</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> resultIndex = binarySearch(arr,<span class="number">0</span>, arr.length - <span class="number">1</span>,<span class="number">8</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;resultIndex:&quot;</span> + resultIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212170225.png" alt="image-20210212170225794"></p><h2 id="5ã€æ”¹è¿›äºŒåˆ†æŸ¥æ‰¾ç®—æ³•"><a href="#5ã€æ”¹è¿›äºŒåˆ†æŸ¥æ‰¾ç®—æ³•" class="headerlink" title="5ã€æ”¹è¿›äºŒåˆ†æŸ¥æ‰¾ç®—æ³•"></a>5ã€æ”¹è¿›äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</h2><blockquote><p>åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªå€¼ä¸findValå€¼ç›¸åŒæ—¶ï¼Œè¦æ±‚å°†è¿™äº›å€¼çš„ä¸‹æ ‡éƒ½æ‰¾åˆ°</p><p>æ€è·¯åˆ†æå¦‚ä¸‹:</p></blockquote><ul><li><p>åœ¨æ‰¾åˆ°midç´¢å¼•å€¼æ—¶ï¼Œä¸è¦é©¬ä¸Šè¿”å›</p></li><li><p>å‘midç´¢å¼•å€¼çš„å·¦è¾¹æ‰«æï¼Œå°†æ‰€æœ‰ç­‰äºfindValçš„å…ƒç´ ä¸‹æ ‡è¿›å…¥åˆ°ä¸€ä¸ªé›†åˆä¸­</p></li><li><p>å‘midç´¢å¼•å€¼çš„å³è¾¹æ‰«æï¼Œå°†æ‰€æœ‰ç­‰äºfindValçš„å…ƒç´ ä¸‹æ ‡è¿›å…¥åˆ°ä¸€ä¸ªé›†åˆä¸­</p></li><li><p>è¿”å›ä¸‹æ ‡é›†åˆ</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr è¦æŸ¥æ‰¾çš„ç›®æ ‡æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left æœ¬æ¬¡æŸ¥æ‰¾çš„å·¦è¾¹ç•Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right æœ¬æ¬¡æŸ¥æ‰¾çš„å³è¾¹ç•Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> findVal è¦æŸ¥æ‰¾çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> findValåœ¨arrä¸­çš„ä¸‹æ ‡ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿”å›-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Integer&gt; <span class="title">binarySearchAllElements</span><span class="params">(<span class="keyword">int</span>[] arr,<span class="keyword">int</span> left,<span class="keyword">int</span> right,<span class="keyword">int</span> findVal)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left &gt; right) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå‘ç°leftå€¼å¤§äºrightå€¼ï¼Œé‚£ä¹ˆè¯æ˜æ­¤æ—¶æ•°ç»„å·²ç»é€’å½’å®Œæ¯•ä¸”æ•°ç»„ä¸­æ²¡æœ‰è¦å¯»æ‰¾çš„å€¼</span></span><br><span class="line">        <span class="comment">//æ­¤æ—¶éœ€è¦è¿”å›null</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> midVal = arr[mid];</span><br><span class="line">    <span class="comment">//å¦‚æœè¦å¯»æ‰¾çš„å€¼å°äºå½“å‰çš„midVal</span></span><br><span class="line">    <span class="keyword">if</span>(findVal &gt; midVal) &#123;</span><br><span class="line">        <span class="comment">//å‘å³é€’å½’</span></span><br><span class="line">        <span class="keyword">return</span> binarySearchAllElements(arr,mid + <span class="number">1</span>,right,findVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(findVal &lt; midVal) &#123;</span><br><span class="line">        <span class="comment">//å‘å·¦é€’å½’</span></span><br><span class="line">        <span class="keyword">return</span> binarySearchAllElements(arr,left,mid - <span class="number">1</span>,findVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; resIndexList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//å®ç°å‘å·¦è¾¹æ‰«æ</span></span><br><span class="line">        <span class="keyword">int</span> temp = mid - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœæ•°ç»„ä¸‹æ ‡è¶Šç•Œæˆ–è€…å·¦è¾¹å·²ç»æ²¡æœ‰ä¸findValç›¸ç­‰çš„å€¼</span></span><br><span class="line">            <span class="keyword">if</span>(temp &lt; <span class="number">0</span> || arr[temp] != findVal) &#123;</span><br><span class="line">                <span class="comment">//é€€å‡º</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            resIndexList.add(temp);</span><br><span class="line">            temp -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å°†midåŠ å…¥åˆ°é›†åˆä¸­</span></span><br><span class="line">        resIndexList.add(mid);</span><br><span class="line">        <span class="comment">//å‘å³è¾¹æ‰«æ</span></span><br><span class="line">        temp = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(temp &gt; arr.length - <span class="number">1</span> || arr[temp] != findVal) &#123;</span><br><span class="line">                <span class="comment">//é€€å‡º</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            resIndexList.add(temp);</span><br><span class="line">            temp += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resIndexList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1234</span>,<span class="number">1999</span>&#125;;</span><br><span class="line">    List&lt;Integer&gt; result = binarySearchAllElements(arr,<span class="number">0</span>, arr.length - <span class="number">1</span>,<span class="number">1000</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;ç»“æœä¸‹æ ‡ä¸ºï¼š&quot;</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212171648.png" alt="image-20210212171648097"></p><h2 id="6ã€éé€’å½’å®ç°äºŒåˆ†æŸ¥æ‰¾ç®—æ³•"><a href="#6ã€éé€’å½’å®ç°äºŒåˆ†æŸ¥æ‰¾ç®—æ³•" class="headerlink" title="6ã€éé€’å½’å®ç°äºŒåˆ†æŸ¥æ‰¾ç®—æ³•"></a>6ã€éé€’å½’å®ç°äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] arr,<span class="keyword">int</span> findVal)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœæ•°ç»„ä¸ºç©ºç›´æ¥return -1</span></span><br><span class="line">    <span class="keyword">if</span>(arr == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = arr.length - <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//åœ¨leftå°äºrightçš„æƒ…å†µä¸‹è¿›è¡Œå¾ªç¯</span></span><br><span class="line">    <span class="keyword">while</span>(left &lt;= right) &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(findVal &lt; arr[mid]) &#123;</span><br><span class="line">            <span class="comment">//è¯´æ˜æ­¤æ—¶éœ€è¦å‘å·¦è¿›è¡ŒæŸ¥æ‰¾</span></span><br><span class="line">            right = mid - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(findVal &gt; arr[mid]) &#123;</span><br><span class="line">            <span class="comment">//è¯´æ˜æ­¤æ—¶éœ€è¦å‘å³è¿›è¡ŒæŸ¥æ‰¾</span></span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¦‚æœä¸Šé¢æ²¡æœ‰è¿”å›ï¼Œè¯æ˜æ•°ç»„ä¸­æ²¡æœ‰findValï¼Œç›´æ¥è¿”å›-1</span></span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">888</span>,<span class="number">1000</span>,<span class="number">1111</span>,<span class="number">1234</span>,<span class="number">1999</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> resIndex = binarySearch(arr,<span class="number">5</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;resIndexçš„å€¼ä¸º:&quot;</span> + resIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212172431.png" alt="image-20210212172431234"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloudå­¦ä¹ ï¼ˆäºŒï¼‰-OpenFeignå¾®æœåŠ¡è°ƒç”¨</title>
      <link href="posts/2863462089.html"/>
      <url>posts/2863462089.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€OpenFeign"><a href="#ä¸€ã€OpenFeign" class="headerlink" title="ä¸€ã€OpenFeign"></a>ä¸€ã€OpenFeign</h1><blockquote><p>OpenFeignæ˜¯Spring Cloudæä¾›çš„ä¸€ä¸ªå£°æ˜å¼çš„ä¼ªHttpå®¢æˆ·ç«¯ï¼Œ å®ƒä½¿å¾—è°ƒç”¨è¿œç¨‹æœåŠ¡å°±åƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¸€æ ·ç®€å•ï¼Œ åªéœ€è¦<strong>åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶æ·»åŠ ä¸€ä¸ªæ³¨è§£</strong>å³å¯ã€‚</p><p>Nacoså¾ˆå¥½çš„å…¼å®¹äº†OpenFeignï¼Œ OpenFeigné»˜è®¤<strong>é›†æˆäº† Ribbon</strong>ï¼Œ æ‰€ä»¥åœ¨Nacosä¸‹ä½¿ç”¨OpenFeigné»˜è®¤å°±å®ç°äº†è´Ÿè½½å‡è¡¡çš„æ•ˆæœã€‚</p><p>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„webæœåŠ¡å®¢æˆ·ç«¯ï¼Œè®©ç¼–å†™webæœåŠ¡å®¢æˆ·ç«¯å˜å¾—éå¸¸å®¹æ˜“ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£å³å¯</p></blockquote><h2 id="1-1ã€ä½œç”¨"><a href="#1-1ã€ä½œç”¨" class="headerlink" title="1.1ã€ä½œç”¨"></a>1.1ã€ä½œç”¨</h2><ul><li>Feignä½¿å¾—ç¼–å†™Java Httpå®¢æˆ·ç«¯å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</li><li>åœ¨Feignçš„å®ç°ä¸‹ï¼Œæˆ‘ä»¬åªéœ€åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½®å®ƒï¼ˆä»¥å‰æ˜¯Daoæ¥å£ä¸Šé¢æ ‡æ³¨Mapperæ³¨è§£ï¼Œç°åœ¨æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šé¢æ ‡æ³¨ä¸€ä¸ªFeignæ³¨è§£å³å¯ï¼‰ï¼Œå³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šï¼Œç®€åŒ–äº†ä½¿ç”¨Spring cloud Ribbonæ—¶ï¼Œè‡ªåŠ¨å°è£…æœåŠ¡è°ƒç”¨å®¢æˆ·ç«¯çš„å¼€å‘é‡ã€‚</li><li>Feigné›†æˆäº†Ribbonåˆ©ç”¨Ribbonç»´æŠ¤äº†Paymentçš„æœåŠ¡åˆ—è¡¨ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡è½®è¯¢å®ç°äº†å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ã€‚è€Œä¸Ribbonä¸åŒçš„æ˜¯ï¼Œé€šè¿‡feignåªéœ€è¦å®šä¹‰æœåŠ¡ç»‘å®šæ¥å£ç›®ä»¥å£°æ˜å¼çš„æ–¹æ³•ï¼Œä¼˜é›…è€Œç®€å•çš„å®ç°äº†æœåŠ¡è°ƒç”¨ã€‚</li></ul><h2 id="1-2ã€Feignå’ŒOpenFeign"><a href="#1-2ã€Feignå’ŒOpenFeign" class="headerlink" title="1.2ã€Feignå’ŒOpenFeign"></a>1.2ã€Feignå’ŒOpenFeign</h2><table><thead><tr><th>Feign</th><th>OpenFeign</th></tr></thead><tbody><tr><td>Feignæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚</td><td>OpenFeignæ˜¯Spring Cloud åœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†Spring MVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ç­‰ã€‚OpenFeignçš„@FeignClientå¯ä»¥è§£æSpring MVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</td></tr></tbody></table><h2 id="1-3ã€OpenFeignä½¿ç”¨æ­¥éª¤"><a href="#1-3ã€OpenFeignä½¿ç”¨æ­¥éª¤" class="headerlink" title="1.3ã€OpenFeignä½¿ç”¨æ­¥éª¤"></a>1.3ã€OpenFeignä½¿ç”¨æ­¥éª¤</h2><h3 id="1ã€åˆ›å»ºå¾®æœåŠ¡æä¾›è€…é›†ç¾¤"><a href="#1ã€åˆ›å»ºå¾®æœåŠ¡æä¾›è€…é›†ç¾¤" class="headerlink" title="1ã€åˆ›å»ºå¾®æœåŠ¡æä¾›è€…é›†ç¾¤"></a>1ã€åˆ›å»ºå¾®æœåŠ¡æä¾›è€…é›†ç¾¤</h3><blockquote><p>åˆ›å»ºå¾®æœåŠ¡æ¨¡å—cloud-provider-payment8001å’Œcloud-provider-payment8002ï¼Œpaymentå¾®æœåŠ¡çš„æ§åˆ¶å™¨ä¸ºï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;æ”¯ä»˜åŠŸèƒ½æ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String serverPort;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢è®¢å•&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        Payment result = paymentService.getPaymentById(id);</span><br><span class="line">        <span class="keyword">if</span>(result == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">404</span>,<span class="string">&quot;æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥è®¢å•ï¼ç«¯å£ä¸ºï¼š&quot;</span> + serverPort,<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">200</span>,<span class="string">&quot;æˆåŠŸï¼ç«¯å£ä¸ºï¼š&quot;</span> + serverPort,result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºOpenFeignå®¢æˆ·ç«¯"><a href="#2ã€åˆ›å»ºOpenFeignå®¢æˆ·ç«¯" class="headerlink" title="2ã€åˆ›å»ºOpenFeignå®¢æˆ·ç«¯"></a>2ã€åˆ›å»ºOpenFeignå®¢æˆ·ç«¯</h3><blockquote><p>åˆ›å»ºå¾®æœåŠ¡æ¨¡å—cloud-consumer-feign-order80ï¼Œè¿™ä¸ªå¾®æœåŠ¡éœ€è¦è°ƒç”¨paymentå¾®æœåŠ¡ä¸­çš„æ¥å£ã€‚</p><p>æ³¨ï¼šOpenFeignæ˜¯åœ¨<strong>æ¶ˆè´¹ç«¯ï¼ˆå¾®æœåŠ¡è°ƒç”¨è€…ç«¯ï¼‰</strong>ä½¿ç”¨çš„ã€‚</p></blockquote><h3 id="3ã€å¼•å…¥ä¾èµ–"><a href="#3ã€å¼•å…¥ä¾èµ–" class="headerlink" title="3ã€å¼•å…¥ä¾èµ–"></a>3ã€å¼•å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--openfeign--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>OpenFeignä¸­è‡ªåŠ¨é›†æˆäº†Ribbonï¼Œå®ç°äº†è´Ÿè½½å‡è¡¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211214254.png" alt="image-20210211214254211"></p><h3 id="4ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"><a href="#4ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶" class="headerlink" title="4ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶"></a>4ã€ç¼–å†™ymlé…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="comment"># ä¸æ³¨å†Œå…¥eureka</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka,</span> <span class="string">http://eureka7002.com:7002/eureka</span></span><br></pre></td></tr></table></figure><h3 id="5ã€ç¼–å†™å¯åŠ¨ç±»ï¼Œæ·»åŠ -EnableFeignClientsæ³¨è§£æ¿€æ´»OpenFeign"><a href="#5ã€ç¼–å†™å¯åŠ¨ç±»ï¼Œæ·»åŠ -EnableFeignClientsæ³¨è§£æ¿€æ´»OpenFeign" class="headerlink" title="5ã€ç¼–å†™å¯åŠ¨ç±»ï¼Œæ·»åŠ @EnableFeignClientsæ³¨è§£æ¿€æ´»OpenFeign"></a>5ã€ç¼–å†™å¯åŠ¨ç±»ï¼Œæ·»åŠ @EnableFeignClientsæ³¨è§£æ¿€æ´»OpenFeign</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¿€æ´»å¹¶å¼€å¯OpenFeign</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFeignMain80</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(OrderFeignMain80.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€ç¼–å†™ä¸€ä¸ªServiceæ¥å£ï¼Œç”¨äºè¿œç¨‹è°ƒç”¨paymentå¾®æœåŠ¡"><a href="#6ã€ç¼–å†™ä¸€ä¸ªServiceæ¥å£ï¼Œç”¨äºè¿œç¨‹è°ƒç”¨paymentå¾®æœåŠ¡" class="headerlink" title="6ã€ç¼–å†™ä¸€ä¸ªServiceæ¥å£ï¼Œç”¨äºè¿œç¨‹è°ƒç”¨paymentå¾®æœåŠ¡"></a>6ã€ç¼–å†™ä¸€ä¸ªServiceæ¥å£ï¼Œç”¨äºè¿œç¨‹è°ƒç”¨paymentå¾®æœåŠ¡</h3><blockquote><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>åœ¨Serviceæ¥å£ä¸Šæ·»åŠ ä¸€ä¸ª@FeignClientæ³¨è§£ï¼Œvalueå€¼ä¸ºè¦è°ƒç”¨çš„å¾®æœåŠ¡åœ¨æ³¨å†Œä¸­å¿ƒä¸­æ³¨å†Œçš„æœåŠ¡åï¼›</li><li>éœ€è¦å®Œæ•´æ·»åŠ è¿œç¨‹è°ƒç”¨æ¥å£çš„å…¨è·¯å¾„</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;cloud-payment-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentFeignService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function">CommonResult&lt;Payment&gt; <span class="title">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­ç¼–å†™Controller"><a href="#7ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­ç¼–å†™Controller" class="headerlink" title="7ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­ç¼–å†™Controller"></a>7ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­ç¼–å†™Controller</h3><blockquote><p>è¿™ä¸ªControllerè°ƒç”¨ä¸Šé¢å†™çš„OpenFeignæœåŠ¡æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderFeignController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentFeignService paymentFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/consumer/payment/get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paymentFeignService.getPaymentById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8ã€æµ‹è¯•"><a href="#8ã€æµ‹è¯•" class="headerlink" title="8ã€æµ‹è¯•"></a>8ã€æµ‹è¯•</h3><blockquote><p>å¯åŠ¨eureka7001ã€payment8001ã€payment8002é›†ç¾¤å’Œopenfeignå¾®æœåŠ¡ã€‚</p></blockquote><ul><li>ç”±äºopenfeignå¾®æœåŠ¡æ²¡æœ‰è¢«æˆ‘ä»¬æ³¨å†Œå…¥eurekaï¼Œæ‰€ä»¥eurekaæ³¨å†Œä¸­å¿ƒæ˜¾ç¤ºå¦‚ä¸‹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211220835.png" alt="image-20210211220835349"></p><ul><li>ä½¿ç”¨openfeignå¾®æœåŠ¡è¿œç¨‹è°ƒç”¨paymentå¾®æœåŠ¡ä¸­çš„æ–¹æ³•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211221340.png" alt="image-20210211221340700"></p><h2 id="1-4ã€OpenFeignè¶…æ—¶æ§åˆ¶"><a href="#1-4ã€OpenFeignè¶…æ—¶æ§åˆ¶" class="headerlink" title="1.4ã€OpenFeignè¶…æ—¶æ§åˆ¶"></a>1.4ã€OpenFeignè¶…æ—¶æ§åˆ¶</h2><h3 id="1ã€OpenFeigné»˜è®¤ç­‰å¾…æ—¶é—´"><a href="#1ã€OpenFeigné»˜è®¤ç­‰å¾…æ—¶é—´" class="headerlink" title="1ã€OpenFeigné»˜è®¤ç­‰å¾…æ—¶é—´"></a>1ã€OpenFeigné»˜è®¤ç­‰å¾…æ—¶é—´</h3><blockquote><p>OpenFeigné»˜è®¤ç­‰å¾…æ—¶é—´ä¸º1ç§’é’Ÿï¼Œè‹¥æœåŠ¡æä¾›æ–¹è¶…è¿‡è¿™ä¸ªæ—¶é—´åˆ™ç›´æ¥æŠ¥é”™ã€‚</p></blockquote><h3 id="2ã€æ¼”ç¤ºè¶…æ—¶å‡ºé”™æƒ…å†µ"><a href="#2ã€æ¼”ç¤ºè¶…æ—¶å‡ºé”™æƒ…å†µ" class="headerlink" title="2ã€æ¼”ç¤ºè¶…æ—¶å‡ºé”™æƒ…å†µ"></a>2ã€æ¼”ç¤ºè¶…æ—¶å‡ºé”™æƒ…å†µ</h3><blockquote><p>åœ¨æœåŠ¡æä¾›æ–¹paymentå¾®æœåŠ¡ä¸­æ–°æ·»ä¸€ä¸ªæ¥å£ï¼Œåœ¨æ¥å£ä¸­æ¨¡æ‹Ÿè¶…æ—¶æƒ…å†µ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">paymentFeignTimeOut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åœ¨è¢«è°ƒç”¨çš„æœåŠ¡æä¾›æ–¹ä¸­ä¼‘çœ ä¸‰ç§’</span></span><br><span class="line">    <span class="comment">//ç”¨äºæ¨¡æ‹Ÿé•¿æµç¨‹è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException interruptedException) &#123;</span><br><span class="line">        interruptedException.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­æ·»åŠ è¿œç¨‹è°ƒç”¨æ¥å£"><a href="#3ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­æ·»åŠ è¿œç¨‹è°ƒç”¨æ¥å£" class="headerlink" title="3ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­æ·»åŠ è¿œç¨‹è°ƒç”¨æ¥å£"></a>3ã€åœ¨OpenFeignå¾®æœåŠ¡ä¸­æ·»åŠ è¿œç¨‹è°ƒç”¨æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/payment/feign/timeout&quot;)</span></span><br><span class="line">   <span class="function">String <span class="title">paymentFeignTimeOut</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><h3 id="4ã€åœ¨OpenFeignå¾®æœåŠ¡æ§åˆ¶å™¨ä¸­æ·»åŠ æ¥å£"><a href="#4ã€åœ¨OpenFeignå¾®æœåŠ¡æ§åˆ¶å™¨ä¸­æ·»åŠ æ¥å£" class="headerlink" title="4ã€åœ¨OpenFeignå¾®æœåŠ¡æ§åˆ¶å™¨ä¸­æ·»åŠ æ¥å£"></a>4ã€åœ¨OpenFeignå¾®æœåŠ¡æ§åˆ¶å™¨ä¸­æ·»åŠ æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/consumer/feign/timeout&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">paymentFeignTimeOut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> paymentFeignService.paymentFeignTimeOut();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><blockquote><p>å…ˆè®¿é—®paymentå¾®æœåŠ¡ä¸­æ–°å¢çš„æ¥å£</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211222304.png" alt="image-20210211222304721"></p><blockquote><p>æµ‹è¯•è¿œç¨‹è°ƒç”¨paymentå¾®æœåŠ¡çš„è¶…æ—¶æ¥å£</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211222545.png" alt="image-20210211222545603"></p><h3 id="6ã€è®¾ç½®OpenFeignçš„è¶…æ—¶æ—¶é—´"><a href="#6ã€è®¾ç½®OpenFeignçš„è¶…æ—¶æ—¶é—´" class="headerlink" title="6ã€è®¾ç½®OpenFeignçš„è¶…æ—¶æ—¶é—´"></a>6ã€è®¾ç½®OpenFeignçš„è¶…æ—¶æ—¶é—´</h3><blockquote><p>ä¿®æ”¹ymlé…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®Feignå®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒRibbon)</span></span><br><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span></span><br><span class="line">  <span class="attr">ReadTimeout:</span> <span class="number">5000</span></span><br><span class="line">  <span class="comment">#æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œæ­£å¸¸çš„æƒ…å†µä¸‹</span></span><br><span class="line">  <span class="attr">ConnectTimeout:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯OpenFeignå¾®æœåŠ¡ï¼Œæµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211222811.png" alt="image-20210211222811217"></p><h2 id="1-5ã€OpenFeignçš„æ—¥å¿—æ‰“å°åŠŸèƒ½"><a href="#1-5ã€OpenFeignçš„æ—¥å¿—æ‰“å°åŠŸèƒ½" class="headerlink" title="1.5ã€OpenFeignçš„æ—¥å¿—æ‰“å°åŠŸèƒ½"></a>1.5ã€OpenFeignçš„æ—¥å¿—æ‰“å°åŠŸèƒ½</h2><h3 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h3><blockquote><p>Feign æä¾›äº†æ—¥å¿—æ‰“å°åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«ï¼Œä»è€Œäº†è§£ Feignä¸­Httpè¯·æ±‚çš„ç»†èŠ‚ã€‚<br>è¯´ç™½äº†å°±æ˜¯å¯¹Feignæ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º</p></blockquote><h3 id="2ã€çº§åˆ«è¯´æ˜"><a href="#2ã€çº§åˆ«è¯´æ˜" class="headerlink" title="2ã€çº§åˆ«è¯´æ˜"></a>2ã€çº§åˆ«è¯´æ˜</h3><ul><li>NONE:é»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—ï¼›</li><li>BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€å“åº”çŠ¶æ€ç åŠæ‰§è¡Œæ—¶é—´ï¼›</li><li>HEADERS:é™¤äº†BASICä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯ï¼›</li><li>FULL:é™¤äº†HEADERSä¸­å®šä¹‰çš„ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡åŠå…ƒæ•°æ®ã€‚</li></ul><h3 id="3ã€ç¼–å†™é…ç½®ç±»ï¼Œé…ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«"><a href="#3ã€ç¼–å†™é…ç½®ç±»ï¼Œé…ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«" class="headerlink" title="3ã€ç¼–å†™é…ç½®ç±»ï¼Œé…ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«"></a>3ã€ç¼–å†™é…ç½®ç±»ï¼Œé…ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignLogConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * å¼€å¯è¯¦ç»†æ—¥å¿—</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.<span class="function">Level <span class="title">feignLoggerLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€åœ¨ymlæ–‡ä»¶ä¸­å¼€å¯æ—¥å¿—çš„Feignå®¢æˆ·ç«¯"><a href="#4ã€åœ¨ymlæ–‡ä»¶ä¸­å¼€å¯æ—¥å¿—çš„Feignå®¢æˆ·ç«¯" class="headerlink" title="4ã€åœ¨ymlæ–‡ä»¶ä¸­å¼€å¯æ—¥å¿—çš„Feignå®¢æˆ·ç«¯"></a>4ã€åœ¨ymlæ–‡ä»¶ä¸­å¼€å¯æ—¥å¿—çš„Feignå®¢æˆ·ç«¯</h3><blockquote><p>æŒ‡å®šFeignä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="comment"># feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</span></span><br><span class="line">    <span class="attr">com.hzx.springcloud.service.PaymentFeignService:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure><h3 id="5ã€å†æ¬¡æµ‹è¯•ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡º"><a href="#5ã€å†æ¬¡æµ‹è¯•ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡º" class="headerlink" title="5ã€å†æ¬¡æµ‹è¯•ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡º"></a>5ã€å†æ¬¡æµ‹è¯•ï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡º</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211223406.png" alt="image-20210211223406662"></p><blockquote><p>æ—¥å¿—è¾“å‡ºæƒ…å†µ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211223450.png" alt="image-20210211223450652"></p><h1 id="äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆOpenFeign"><a href="#äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆOpenFeign" class="headerlink" title="äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆOpenFeign"></a>äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆOpenFeign</h1><blockquote><p>åœ¨çº¿æ•™è‚²ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªç”¨äºä¸é˜¿é‡Œäº‘äº¤äº’çš„å¾®æœåŠ¡ï¼Œåˆ†åˆ«ä¸ºç”¨äºæ–‡ä»¶ä¸Šä¼ çš„osså¾®æœåŠ¡å’Œç”¨äºè§†é¢‘ç‚¹æ’­çš„vodå¾®æœåŠ¡ï¼Œåœ¨å…¶ä»–å¾®æœåŠ¡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿œç¨‹è°ƒç”¨è¿™ä¸¤ä¸ªå¾®æœåŠ¡ä¸­çš„æ¥å£æ¥å®Œæˆä¸šåŠ¡éœ€æ±‚ã€‚</p></blockquote><h2 id="2-1ã€è¿œç¨‹è°ƒç”¨OSSå¾®æœåŠ¡"><a href="#2-1ã€è¿œç¨‹è°ƒç”¨OSSå¾®æœåŠ¡" class="headerlink" title="2.1ã€è¿œç¨‹è°ƒç”¨OSSå¾®æœåŠ¡"></a>2.1ã€è¿œç¨‹è°ƒç”¨OSSå¾®æœåŠ¡</h2><blockquote><p>åœ¨åˆ é™¤è®²å¸ˆä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€åŒåˆ é™¤è¯¥è®²å¸ˆä¸Šä¼ è‡³é˜¿é‡Œäº‘ä¸­çš„å¤´åƒæ–‡ä»¶ï¼Œè¯¥è¿‡ç¨‹ä¸­éœ€è¦è¿œç¨‹è°ƒç”¨osså¾®æœåŠ¡ä¸­çš„æ–‡ä»¶åˆ é™¤æ¥å£</p></blockquote><h3 id="1ã€Osså¾®æœåŠ¡ä¸­çš„æ–‡ä»¶åˆ é™¤æ¥å£"><a href="#1ã€Osså¾®æœåŠ¡ä¸­çš„æ–‡ä»¶åˆ é™¤æ¥å£" class="headerlink" title="1ã€Osså¾®æœåŠ¡ä¸­çš„æ–‡ä»¶åˆ é™¤æ¥å£"></a>1ã€Osså¾®æœåŠ¡ä¸­çš„æ–‡ä»¶åˆ é™¤æ¥å£</h3><ul><li>Controllerå±‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;remove&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;å›¾ç‰‡æ–‡ä»¶åˆ é™¤&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">removeFile</span><span class="params">(<span class="meta">@RequestBody</span> String url)</span> </span>&#123;</span><br><span class="line">    fileService.removeFile(url);</span><br><span class="line">    <span class="keyword">return</span> R.ok().message(<span class="string">&quot;æ–‡ä»¶åˆ é™¤æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Serviceå®ç°ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeFile</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è¯»å–é…ç½®ä¿¡æ¯</span></span><br><span class="line">    String endpoint = ossProperties.getEndpoint();</span><br><span class="line">    String keyid = ossProperties.getKeyid();</span><br><span class="line">    String keysecret = ossProperties.getKeysecret();</span><br><span class="line">    String bucketname = ossProperties.getBucketname();</span><br><span class="line">    <span class="comment">//åˆ›å»ºOSSClientå®ä¾‹</span></span><br><span class="line">    OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint,keyid,keysecret);</span><br><span class="line">    <span class="comment">//è·å–è¦åˆ é™¤çš„æ–‡ä»¶åï¼Œæ ¹æ®urlè·å–</span></span><br><span class="line">    <span class="comment">//ä¸»æœºå</span></span><br><span class="line">    String host = <span class="string">&quot;https://&quot;</span> + bucketname + <span class="string">&quot;.&quot;</span> + endpoint + <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    <span class="comment">//ä»ä¸»æœºåé•¿åº¦çš„ä¸‹æ ‡å¼€å§‹æˆªå–ï¼Œå°±å¯ä»¥è·å–æ–‡ä»¶å</span></span><br><span class="line">    String objectName = url.substring(host.length());</span><br><span class="line">    System.out.println(objectName);</span><br><span class="line">    ossClient.deleteObject(bucketname,objectName);</span><br><span class="line">    <span class="comment">//å…³é—­OSSClient</span></span><br><span class="line">    ossClient.shutdown();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åœ¨eduå¾®æœåŠ¡ä¸­è¿œç¨‹è°ƒç”¨Osså¾®æœåŠ¡"><a href="#2ã€åœ¨eduå¾®æœåŠ¡ä¸­è¿œç¨‹è°ƒç”¨Osså¾®æœåŠ¡" class="headerlink" title="2ã€åœ¨eduå¾®æœåŠ¡ä¸­è¿œç¨‹è°ƒç”¨Osså¾®æœåŠ¡"></a>2ã€åœ¨eduå¾®æœåŠ¡ä¸­è¿œç¨‹è°ƒç”¨Osså¾®æœåŠ¡</h3><blockquote><p>åœ¨eduå¾®æœåŠ¡ä¸­åˆ›å»ºä¸€ä¸ªfeignåŒ…ï¼ŒåŒ…ä¸‹å­˜æ”¾è¿œç¨‹è°ƒç”¨æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;service-oss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OssFileService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * è¿œç¨‹è°ƒç”¨OSSå¾®æœåŠ¡ä¸­çš„æ§åˆ¶å™¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/admin/oss/file/remove&quot;)</span></span><br><span class="line">    <span class="function">R <span class="title">removeFile</span><span class="params">(<span class="meta">@RequestBody</span> String url)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨eduå¾®æœåŠ¡ä¸­è°ƒç”¨feignæ¥å£åˆ é™¤è®²å¸ˆå¤´åƒ</p><p>teacherService.removeAvatarById(id);</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idåˆ é™¤è®²å¸ˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id è¦åˆ é™¤çš„è®²å¸ˆid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> åˆ é™¤ç»“æœåŠæç¤ºä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;æ ¹æ®IDåˆ é™¤è®²å¸ˆ&quot;, notes = &quot;æ ¹æ®IDåˆ é™¤è®²å¸ˆ&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">removeById</span><span class="params">(<span class="meta">@ApiParam(value = &quot;è®²å¸ˆid&quot;,required = true)</span> <span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆ é™¤è®²å¸ˆå‰å…ˆåˆ é™¤è®²å¸ˆå¤´åƒ</span></span><br><span class="line">    teacherService.removeAvatarById(id);</span><br><span class="line">    <span class="keyword">boolean</span> flag = teacherService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> flag ? R.ok().message(<span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span>) : R.error().message(<span class="string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>removeAvatarById(id)æ–¹æ³•å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TeacherServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">TeacherMapper</span>, <span class="title">Teacher</span>&gt; <span class="keyword">implements</span> <span class="title">TeacherService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æ³¨å…¥è¿œç¨‹è°ƒç”¨æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OssFileService ossFileService;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAvatarById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1 æ ¹æ®idè·å–è®²å¸ˆavatarçš„url</span></span><br><span class="line">        Teacher teacher = baseMapper.selectById(id);</span><br><span class="line">        <span class="keyword">if</span>(teacher != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String avatarUrl = teacher.getAvatar();</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isNotBlank(avatarUrl)) &#123;</span><br><span class="line">                <span class="comment">//å¤´åƒä¸ä¸ºç©ºæ‰è¿›è¡Œè¿œç¨‹è°ƒç”¨</span></span><br><span class="line">                R r = ossFileService.removeFile(avatarUrl);</span><br><span class="line">                <span class="keyword">return</span> r.getSuccess();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ‘¥OpenFeign </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cloudå­¦ä¹ ï¼ˆä¸€ï¼‰-GateWayç½‘å…³</title>
      <link href="posts/337037609.html"/>
      <url>posts/337037609.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€ç½‘å…³åŸºæœ¬æ¦‚å¿µ"><a href="#ä¸€ã€ç½‘å…³åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¸€ã€ç½‘å…³åŸºæœ¬æ¦‚å¿µ"></a>ä¸€ã€ç½‘å…³åŸºæœ¬æ¦‚å¿µ</h1><h2 id="1-1ã€APIç½‘å…³ä»‹ç»"><a href="#1-1ã€APIç½‘å…³ä»‹ç»" class="headerlink" title="1.1ã€APIç½‘å…³ä»‹ç»"></a>1.1ã€APIç½‘å…³ä»‹ç»</h2><blockquote><p>API ç½‘å…³å‡ºç°çš„åŸå› æ˜¯å¾®æœåŠ¡æ¶æ„çš„å‡ºç°ï¼Œä¸åŒçš„å¾®æœåŠ¡ä¸€èˆ¬ä¼šæœ‰ä¸åŒçš„ç½‘ç»œåœ°å€ï¼Œè€Œå¤–éƒ¨å®¢æˆ·ç«¯å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡çš„æ¥å£æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè®©å®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡é€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š</p></blockquote><ul><li><p>å®¢æˆ·ç«¯ä¼šå¤šæ¬¡è¯·æ±‚ä¸åŒçš„å¾®æœåŠ¡ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ã€‚</p></li><li><p>å­˜åœ¨è·¨åŸŸè¯·æ±‚ï¼Œåœ¨ä¸€å®šåœºæ™¯ä¸‹å¤„ç†ç›¸å¯¹å¤æ‚ã€‚</p></li><li><p>è®¤è¯å¤æ‚ï¼Œæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦ç‹¬ç«‹è®¤è¯ã€‚</p></li><li><p>éš¾ä»¥é‡æ„ï¼Œéšç€é¡¹ç›®çš„è¿­ä»£ï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ’åˆ†å¾®æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½å°†å¤šä¸ªæœåŠ¡åˆå¹¶æˆä¸€ä¸ªæˆ–è€…å°†ä¸€ä¸ªæœåŠ¡æ‹†åˆ†æˆå¤šä¸ªã€‚å¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸å¾®æœåŠ¡é€šä¿¡ï¼Œé‚£ä¹ˆé‡æ„å°†ä¼šå¾ˆéš¾å®æ–½ã€‚</p></li></ul><p>ä»¥ä¸Šè¿™äº›é—®é¢˜å¯ä»¥å€ŸåŠ© API ç½‘å…³è§£å†³ã€‚API ç½‘å…³æ˜¯ä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œæ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ API ç½‘å…³è¿™ä¸€å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒAPI çš„å®ç°æ–¹é¢æ›´å¤šçš„è€ƒè™‘ä¸šåŠ¡é€»è¾‘ï¼Œè€Œå®‰å…¨ã€æ€§èƒ½ã€ç›‘æ§å¯ä»¥äº¤ç”± API ç½‘å…³æ¥åšï¼Œè¿™æ ·æ—¢æé«˜ä¸šåŠ¡çµæ´»æ€§åˆä¸ç¼ºå®‰å…¨æ€§</p><blockquote><p>å‡è®¾ä¸€ä¸ªç”µå•†é¡¹ç›®ï¼Œè´­ä¹°ä¸€ä»¶å•†å“éœ€è¦è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡æ¥å£ï¼Œæ‰èƒ½å®Œæˆä¸‹å•æ“ä½œï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨ç½‘å…³ä¹‹å‰ï¼Œç”¨æˆ·çš„æ“ä½œæµç¨‹å›¾æ˜¯è¿™æ ·çš„ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211121506.png" alt="image-20210211121505821"></p><blockquote><p>åœ¨å¼•å…¥ç½‘å…³åï¼Œæ¶æ„å¯ä»¥æ¼”å˜ä¸ºä¸‹å›¾</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211121759.png" alt="image-20210211121759523"></p><blockquote><p>å¾®æœåŠ¡ç½‘å…³æ˜¯ç¨‹åºçš„å¤§é—¨ï¼Œå°è£…äº†åº”ç”¨ç¨‹åºçš„å†…éƒ¨ç»“æ„ï¼Œç”¨æˆ·åªéœ€è¦è·Ÿç½‘å…³äº¤äº’ï¼Œæ— éœ€è°ƒç”¨ç‰¹å®šå¾®æœåŠ¡æ¥å£ã€‚</p><p>è¿™æ ·ï¼Œå¼€å‘å°±å¯ä»¥å¾—åˆ°ç®€åŒ–ã€‚ä¸ä»…å¦‚æ­¤ï¼Œä½¿ç”¨å¾®æœåŠ¡ç½‘å…³è¿˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p></blockquote><ul><li>æ˜“äºç›‘æ§ã€‚å¯åœ¨å¾®æœåŠ¡ç½‘å…³æ”¶é›†ç›‘æ§æ•°æ®å¹¶å°†å…¶æ¨é€åˆ°å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œåˆ†æã€‚</li><li>æ˜“äºè®¤è¯ã€‚å¯åœ¨å¾®æœåŠ¡ç½‘å…³ä¸Šè¿›è¡Œè®¤è¯ï¼Œç„¶åå†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ï¼Œè€Œæ— é¡»åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­è¿›è¡Œè®¤è¯ã€‚</li><li>å‡å°‘äº†å®¢æˆ·ç«¯ä¸å„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„äº¤äº’æ¬¡æ•°ã€‚</li></ul><h2 id="1-2ã€Spring-Cloud-GateWay"><a href="#1-2ã€Spring-Cloud-GateWay" class="headerlink" title="1.2ã€Spring Cloud GateWay"></a>1.2ã€Spring Cloud GateWay</h2><h3 id="1ã€æ¦‚è¿°"><a href="#1ã€æ¦‚è¿°" class="headerlink" title="1ã€æ¦‚è¿°"></a>1ã€æ¦‚è¿°</h3><blockquote><p><strong>Spring cloud gateway</strong>æ˜¯springå®˜æ–¹åŸºäºSpring 5.0ã€Spring Boot2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼ŒSpring Cloud Gatewayæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ç®€å•ã€æœ‰æ•ˆå’Œç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ï¼ŒSpring Cloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£Netflix Zuulï¼Œå…¶ä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”è¿˜åŸºäºFileré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ã€ç›‘æ§/åŸ‹ç‚¹ã€é™æµç­‰ã€‚</p><p>Spring Cloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®çš„æ˜¯ä¸ºäº†æ›¿ä»£Zuulï¼Œåœ¨Spring Cloud2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šçš„æ–°é«˜ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚Gatewayæ˜¯<strong>åŸºäºwebFluxæ¡†æ¶å®ç°çš„</strong>ï¼Œ<strong>WebFluxæ¡†æ¶åº•å±‚</strong>ä½¿ç”¨äº†<strong>é«˜æ€§èƒ½</strong>çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶<strong>Netty</strong>ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211130506.png" alt="img"></p><blockquote><p>ä½œç”¨ï¼š</p></blockquote><ul><li>åå‘ä»£ç†</li><li>ç»Ÿä¸€é‰´æƒ</li><li>æµé‡æ§åˆ¶</li><li>ç†”æ–­</li><li>æ—¥å¿—ç›‘æ§</li></ul><blockquote><p>æ‰€å¤„ä½ç½®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211130628.png" alt="img"></p><h3 id="2ã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#2ã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2ã€æ ¸å¿ƒæ¦‚å¿µ"></a>2ã€æ ¸å¿ƒæ¦‚å¿µ</h3><ul><li><p><strong>è·¯ç”±</strong>ï¼šè·¯ç”±æ˜¯ç½‘å…³æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œè·¯ç”±ä¿¡æ¯æœ‰ä¸€ä¸ªIDã€ä¸€ä¸ªç›®çš„URLã€ä¸€ç»„æ–­è¨€å’Œä¸€ç»„Filterç»„æˆã€‚å¦‚æœæ–­è¨€è·¯ç”±ä¸ºçœŸï¼Œåˆ™è¯´æ˜è¯·æ±‚çš„URLå’Œé…ç½®åŒ¹é…</p><ul><li>idï¼šè·¯ç”±idï¼Œæ²¡æœ‰èµ·åè§„åˆ™ï¼Œä½†è¦æ±‚å”¯ä¸€</li><li>uriï¼šåŒ¹é…è·¯ç”±çš„è½¬å‘åœ°å€</li><li>predicatesï¼šé…ç½®è¯¥è·¯ç”±çš„æ–­è¨€ï¼Œè‹¥ç¬¦åˆè¯¥æ–­è¨€åˆ™ä¼šè½¬å‘åˆ°åŒ¹é…çš„åœ°å€</li><li>orderï¼šè·¯ç”±çš„ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</li></ul></li><li><p><strong>æ–­è¨€</strong>ï¼šJava8ä¸­çš„æ–­è¨€å‡½æ•°ã€‚Spring Cloud Gatewayä¸­çš„æ–­è¨€å‡½æ•°å…è®¸å¼€å‘è€…å»å®šä¹‰åŒ¹é…æ¥è‡ªäºhttp requestä¸­çš„ä»»ä½•ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚å¤´å’Œå‚æ•°ç­‰ã€‚</p></li><li><p><strong>è¿‡æ»¤å™¨</strong>ï¼šä¸€ä¸ªæ ‡å‡†çš„Spring webFilterã€‚Spring cloud gatewayä¸­çš„filteråˆ†ä¸ºä¸¤ç§ç±»å‹çš„Filterï¼Œåˆ†åˆ«æ˜¯Gateway Filterå’ŒGlobal Filterã€‚è¿‡æ»¤å™¨Filterå°†ä¼šå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œä¿®æ”¹å¤„ç†ã€‚</p></li></ul><h3 id="3ã€æ‰§è¡Œæµç¨‹"><a href="#3ã€æ‰§è¡Œæµç¨‹" class="headerlink" title="3ã€æ‰§è¡Œæµç¨‹"></a>3ã€æ‰§è¡Œæµç¨‹</h3><blockquote><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒSpring cloud Gatewayå‘å‡ºè¯·æ±‚ã€‚ç„¶åå†ç”±Gateway Handler Mappingä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ°Gateway web handlerã€‚Handlerå†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211130419.png" alt="image-20210211130417182"></p><ul><li>Filterä¸­ï¼Œâ€preâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡æ§åˆ¶ã€æ—¥å¿—è¾“å‡ºå’Œåè®®è½¬æ¢ç­‰ã€‚â€postâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšç›¸åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ã€æ—¥å¿—çš„è¾“å‡ºã€æµé‡ç›‘æ§ã€‚</li><li>æ ¸å¿ƒé€»è¾‘ï¼šè·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤å™¨é“¾ã€‚</li></ul><h3 id="4ã€ç‰¹ç‚¹"><a href="#4ã€ç‰¹ç‚¹" class="headerlink" title="4ã€ç‰¹ç‚¹"></a>4ã€ç‰¹ç‚¹</h3><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ€§èƒ½å¼ºåŠ²ï¼šæ˜¯ç¬¬ä¸€ä»£ç½‘å…³Zuulçš„1.6å€</li><li>åŠŸèƒ½å¼ºå¤§ï¼šå†…ç½®äº†å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è½¬å‘ã€ç›‘æ§ã€é™æµç­‰</li><li>è®¾è®¡ä¼˜é›…ï¼Œå®¹æ˜“æ‰©å±•</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å…¶å®ç°ä¾èµ–Nettyä¸WebFluxï¼Œä¸æ˜¯ä¼ ç»Ÿçš„Servletç¼–ç¨‹æ¨¡å‹ï¼Œå­¦ä¹ æˆæœ¬é«˜</li><li>ä¸èƒ½å°†å…¶éƒ¨ç½²åœ¨Tomcatã€Jettyç­‰Servletå®¹å™¨é‡Œï¼Œåªèƒ½æ‰“æˆjaråŒ…æ‰§è¡Œ</li><li>éœ€è¦Spring Boot 2.0åŠä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œæ‰æ”¯æŒ</li></ul><h1 id="äºŒã€ç½‘å…³ä½¿ç”¨"><a href="#äºŒã€ç½‘å…³ä½¿ç”¨" class="headerlink" title="äºŒã€ç½‘å…³ä½¿ç”¨"></a>äºŒã€ç½‘å…³ä½¿ç”¨</h1><h2 id="2-1ã€åˆ›å»ºç½‘å…³å¾®æœåŠ¡cloud-gateway-9527"><a href="#2-1ã€åˆ›å»ºç½‘å…³å¾®æœåŠ¡cloud-gateway-9527" class="headerlink" title="2.1ã€åˆ›å»ºç½‘å…³å¾®æœåŠ¡cloud-gateway-9527"></a>2.1ã€åˆ›å»ºç½‘å…³å¾®æœåŠ¡cloud-gateway-9527</h2><blockquote><p>pom.xml</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ–°å¢gateway--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cloudstudy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>application.ymlé…ç½®æ–‡ä»¶</p></blockquote><p>application.ymlæ–‡ä»¶ä¸­æ·»åŠ è·¯ç”±é…ç½®</p><ul><li>-ï¼šè¡¨ç¤ºæ•°ç»„å…ƒç´ ï¼Œå¯ä»¥é…ç½®å¤šä¸ªèŠ‚ç‚¹</li><li>idï¼šé…ç½®çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥å’Œå¾®æœåŠ¡åŒåï¼Œä¹Ÿå¯ä»¥èµ·åˆ«çš„åå­—ï¼ŒåŒºåˆ«äºå…¶ä»– Routeã€‚</li><li>uriï¼šè·¯ç”±æŒ‡å‘çš„ç›®çš„åœ° uriï¼Œå³å®¢æˆ·ç«¯è¯·æ±‚æœ€ç»ˆè¢«è½¬å‘åˆ°çš„å¾®æœåŠ¡ã€‚</li><li>predicatesï¼šæ–­è¨€çš„ä½œç”¨æ˜¯è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œåªæœ‰æ–­è¨€éƒ½è¿”å›çœŸï¼Œæ‰ä¼šçœŸæ­£çš„æ‰§è¡Œè·¯ç”±ã€‚</li><li>Pathï¼šè·¯å¾„å½¢å¼çš„æ–­è¨€ã€‚å½“åŒ¹é…è¿™ä¸ªè·¯å¾„æ—¶ï¼Œæ–­è¨€æ¡ä»¶æˆç«‹</li><li>/**ï¼šä¸€ä¸ªæˆ–å¤šä¸ªå±‚æ¬¡çš„è·¯å¾„</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span> <span class="comment">#æ³¨å†Œåˆ°eurekaä¸­çš„åº”ç”¨å</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment">#è·¯ç”±idï¼Œæ²¡æœ‰å‘½åè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">http://localhost:8001</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸»å¯åŠ¨ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatewayMain9527</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(GatewayMain9527.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2ã€Payment8001"><a href="#2-2ã€Payment8001" class="headerlink" title="2.2ã€Payment8001"></a>2.2ã€Payment8001</h2><blockquote><p>åœ¨paymentå¾®æœåŠ¡ä¸­æœ‰ä¸¤ä¸ªé‡è¦æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/get/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®idæŸ¥è¯¢è®¢å•&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CommonResult&lt;Payment&gt; <span class="title">getPaymentById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">    Payment result = paymentService.getPaymentById(id);</span><br><span class="line">    <span class="keyword">if</span>(result == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">404</span>,<span class="string">&quot;æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥è®¢å•ï¼ç«¯å£ä¸ºï¼š&quot;</span> + serverPort,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CommonResult&lt;&gt;(<span class="number">200</span>,<span class="string">&quot;æˆåŠŸï¼ç«¯å£ä¸ºï¼š&quot;</span> + serverPort,result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/lb&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPaymentLB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> serverPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘ä»¬å¸Œæœ›é€šè¿‡ç½‘å…³åœ¨paymentæœåŠ¡çš„8001ç«¯å£å¤–å†åŒ…è£¹ä¸€å±‚9527ç«¯å£ï¼Œè®©ç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—®8001ç«¯å£ã€‚</p></blockquote><h2 id="2-3ã€å¯åŠ¨å¾®æœåŠ¡ï¼Œè¿›è¡Œæµ‹è¯•"><a href="#2-3ã€å¯åŠ¨å¾®æœåŠ¡ï¼Œè¿›è¡Œæµ‹è¯•" class="headerlink" title="2.3ã€å¯åŠ¨å¾®æœåŠ¡ï¼Œè¿›è¡Œæµ‹è¯•"></a>2.3ã€å¯åŠ¨å¾®æœåŠ¡ï¼Œè¿›è¡Œæµ‹è¯•</h2><blockquote><p>å¯åŠ¨eureka7001ã€payment8001å’Œgateway9527</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211132551.png" alt="image-20210211132551232"></p><blockquote><p>é€šè¿‡localhost:8001/payment/lbè®¿é—®paymentå¾®æœåŠ¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211132713.png" alt="image-20210211132713170"></p><blockquote><p>é€šè¿‡ç½‘å…³ï¼Œå³9527ç«¯å£è®¿é—®paymentå¾®æœåŠ¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211133144.png" alt="image-20210211133144911"></p><blockquote><p>è®¿é—®è¯´æ˜</p></blockquote><ul><li>paymentå¾®æœåŠ¡æ§åˆ¶å™¨çš„è®¿é—®è·¯å¾„</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211133943.png" alt="image-20210211133942958"></p><ul><li>å¦‚æœè®¿é—®è·¯å¾„åŒ¹é…è·¯ç”±æ–­è¨€ï¼Œåˆ™è½¬å‘åˆ°æŒ‡å®šuri</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211134300.png" alt="image-20210211134259898"></p><h2 id="2-4ã€é…ç½®è·¯ç”±çš„å¦ä¸€ç§æ–¹å¼"><a href="#2-4ã€é…ç½®è·¯ç”±çš„å¦ä¸€ç§æ–¹å¼" class="headerlink" title="2.4ã€é…ç½®è·¯ç”±çš„å¦ä¸€ç§æ–¹å¼"></a>2.4ã€é…ç½®è·¯ç”±çš„å¦ä¸€ç§æ–¹å¼</h2><blockquote><p>ä½¿ç”¨ç½‘å…³ï¼Œè®©ç½‘å…³å¸®æˆ‘ä»¬è·³è½¬åˆ°ç™¾åº¦æ–°é—»é¡µé¢</p></blockquote><ul><li>å¦‚æœè®¿é—®è·¯å¾„åŒ¹é…è·¯ç”±æ–­è¨€/guojiï¼Œåˆ™å¸®æˆ‘ä»¬è·³è½¬åˆ°<a href="http://news.baidu.com/guoji">http://news.baidu.com/guoji</a></li><li>å¦‚æœè®¿é—®è·¯å¾„åŒ¹é…è·¯ç”±æ–­è¨€/guoneiï¼Œåˆ™å¸®æˆ‘ä»¬è·³è½¬åˆ°<a href="http://news.baidu.com/guonei">http://news.baidu.com/guonei</a></li></ul><h3 id="1ã€åˆ›å»ºä¸€ä¸ªGateWayConfigé…ç½®ç±»"><a href="#1ã€åˆ›å»ºä¸€ä¸ªGateWayConfigé…ç½®ç±»" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªGateWayConfigé…ç½®ç±»"></a>1ã€åˆ›å»ºä¸€ä¸ªGateWayConfigé…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GatewayConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouteLocator <span class="title">customRouteLocator</span><span class="params">(RouteLocatorBuilder routeLocatorBuilder)</span> </span>&#123;</span><br><span class="line">        RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes();</span><br><span class="line">        routes.route(<span class="string">&quot;path_route_wuhu&quot;</span>,</span><br><span class="line">                r -&gt; r.path(<span class="string">&quot;/guonei&quot;</span>).uri(<span class="string">&quot;http://news.baidu.com/guonei&quot;</span>));</span><br><span class="line">        routes.route(<span class="string">&quot;path_route_qifei&quot;</span>,</span><br><span class="line">                r -&gt; r.path(<span class="string">&quot;/guoji&quot;</span>).uri(<span class="string">&quot;http://news.baidu.com/guoji&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> routes.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨routeså¯¹è±¡çš„routeæ–¹æ³•æ¥é…ç½®è·¯ç”±æ–­è¨€åŠè¦è½¬å‘çš„uri</li><li>å…¶ä¸­routeæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªä¸ºè·¯ç”±idï¼Œå¦ä¸€ä¸ªä¸ºjdk8æ–°æ·»åŠ çš„Functionæ¥å£å¯¹è±¡</li><li>å¦‚æœè®¿é—®è·¯å¾„ä¸­æœ‰/guoneiï¼Œé‚£ä¹ˆç½‘å…³ä¼šå¸®æˆ‘ä»¬è·³è½¬åˆ°<a href="http://news.baidu.com/guonei%EF%BC%9B%E5%A6%82%E6%9E%9C%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84%E4%B8%AD%E6%9C%89/guoji%EF%BC%8C%E9%82%A3%E4%B9%88%E7%BD%91%E5%85%B3%E4%BC%9A%E5%B8%AE%E6%88%91%E4%BB%AC%E8%B7%B3%E8%BD%AC%E5%88%B0http://news.baidu.com/guoji">http://news.baidu.com/guoneiï¼›å¦‚æœè®¿é—®è·¯å¾„ä¸­æœ‰/guojiï¼Œé‚£ä¹ˆç½‘å…³ä¼šå¸®æˆ‘ä»¬è·³è½¬åˆ°http://news.baidu.com/guoji</a></li></ul><h3 id="2ã€æµ‹è¯•"><a href="#2ã€æµ‹è¯•" class="headerlink" title="2ã€æµ‹è¯•"></a>2ã€æµ‹è¯•</h3><blockquote><p>è®¿é—®<a href="http://localhost:9527/guoji">http://localhost:9527/guoji</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211135216.png" alt="image-20210211135215779"></p><blockquote><p>åŒç†è®¿é—®<a href="http://localhost:9527/guonei">http://localhost:9527/guonei</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211135303.png" alt="image-20210211135303881"></p><h2 id="2-5ã€é…åˆæ³¨å†Œä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±"><a href="#2-5ã€é…åˆæ³¨å†Œä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±" class="headerlink" title="2.5ã€é…åˆæ³¨å†Œä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±"></a>2.5ã€é…åˆæ³¨å†Œä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±</h2><blockquote><p>é»˜è®¤æƒ…å†µä¸‹Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡åˆ—è¡¨ï¼Œä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½</p></blockquote><h3 id="1ã€å¯åŠ¨"><a href="#1ã€å¯åŠ¨" class="headerlink" title="1ã€å¯åŠ¨"></a>1ã€å¯åŠ¨</h3><blockquote><p>æ ¹æ®payment8001å¾®æœåŠ¡å¤åˆ»å‡ºå¦ä¸€ä¸ªç±»ä¼¼çš„paymentå¾®æœåŠ¡ï¼Œç«¯å£å·ä¸º8002</p><p>å¯åŠ¨eureka7001+payment8001+payment8002</p></blockquote><h3 id="2ã€ä¿®æ”¹ç½‘å…³å¾®æœåŠ¡é…ç½®æ–‡ä»¶"><a href="#2ã€ä¿®æ”¹ç½‘å…³å¾®æœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€ä¿®æ”¹ç½‘å…³å¾®æœåŠ¡é…ç½®æ–‡ä»¶"></a>2ã€ä¿®æ”¹ç½‘å…³å¾®æœåŠ¡é…ç½®æ–‡ä»¶</h3><blockquote><p>åœ¨è·¯ç”±çš„uriä¸­ä½¿ç”¨lb://å¾®æœåŠ¡åç§°çš„æ–¹æ³•æ¥åŠ¨æ€é…ç½®è·¯ç”±ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ï¼Œä½¿ç”¨æ­¥éª¤å¦‚ä¸‹</p></blockquote><ul><li>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œä½¿ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œä½¿ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨é…ç½®æ–‡ä»¶ä¸­å°†è·¯ç”±uriä¿®æ”¹ä¸ºlb://å¾®æœåŠ¡åæ¥æŒ‡å®šè·³è½¬åœ°å€ï¼Œå¹¶å®ç°è´Ÿè½½å‡è¡¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯uriçš„åè®®ä¸ºlbï¼Œè¡¨ç¤ºå¯ç”¨Gatewayçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">routes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment">#è·¯ç”±idï¼Œæ²¡æœ‰å‘½åè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">    <span class="comment"># ä½¿ç”¨æ³¨å†Œä¸­å¿ƒä¸­æ³¨å†Œçš„å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±</span></span><br><span class="line">    <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">    <span class="attr">predicates:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">    <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">    <span class="attr">predicates:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ç½‘å…³å¾®æœåŠ¡å®Œæ•´é…ç½®æ–‡ä»¶å¦‚ä¸‹</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9527</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-gateway</span> <span class="comment">#æ³¨å†Œåˆ°eurekaä¸­çš„åº”ç”¨å</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="comment"># å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œä½¿ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh</span> <span class="comment">#è·¯ç”±idï¼Œæ²¡æœ‰å‘½åè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span></span><br><span class="line">          <span class="comment"># ä½¿ç”¨æ³¨å†Œä¸­å¿ƒä¸­æ³¨å†Œçš„å¾®æœåŠ¡åå®ç°åŠ¨æ€è·¯ç”±</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/get/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">cloud-gateway-service</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">register-with-eureka:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">fetch-registry:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka7001.com:7001/eureka</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><blockquote><p>å¯åŠ¨ç½‘å…³å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹eurekaæ³¨å†Œä¸­å¿ƒæƒ…å†µ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211144519.png" alt="image-20210211144518120"></p><blockquote><p>æµ‹è¯•ï¼Œè®¿é—®paymentå¾®æœåŠ¡çš„lbæ–¹æ³•ï¼ŒæŸ¥çœ‹è°ƒç”¨ç«¯å£æƒ…å†µ</p></blockquote><ul><li>ç¬¬ä¸€æ¬¡</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211144610.png" alt="image-20210211144610176"></p><ul><li>ç¬¬äºŒæ¬¡</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211144625.png" alt="image-20210211144625837"></p><blockquote><p>è¿™æ ·å°±å®ç°äº†åŠ¨æ€è·¯ç”±å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</p></blockquote><h2 id="2-6ã€Predicateçš„ä½¿ç”¨"><a href="#2-6ã€Predicateçš„ä½¿ç”¨" class="headerlink" title="2.6ã€Predicateçš„ä½¿ç”¨"></a>2.6ã€Predicateçš„ä½¿ç”¨</h2><blockquote><p>Spring Cloud Gatewayå†…ç½®æ–­è¨€å·¥å‚ï¼Œç”¨äºè¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œåªæœ‰æ–­è¨€éƒ½è¿”å›çœŸï¼Œæ‰ä¼šçœŸæ­£æ‰§è¡Œè·¯ç”±ã€‚</p><p>å†…ç½®çš„æ–­è¨€å·¥å‚å…·ä½“å¦‚ä¸‹</p></blockquote><h3 id="1ã€åŸºäºDateTime"><a href="#1ã€åŸºäºDateTime" class="headerlink" title="1ã€åŸºäºDateTime"></a>1ã€åŸºäºDateTime</h3><blockquote><p>æ­¤ç±»å‹çš„æ–­è¨€æ ¹æ®æ—¶é—´åšåˆ¤æ–­ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªï¼š</p></blockquote><ul><li>AfterRoutePredicateFactoryï¼š æ¥æ”¶ä¸€ä¸ªæ—¥æœŸå‚æ•°ï¼Œåˆ¤æ–­è¯·æ±‚æ—¥æœŸæ˜¯å¦æ™šäºæŒ‡å®šæ—¥æœŸ</li><li>BeforeRoutePredicateFactoryï¼š æ¥æ”¶ä¸€ä¸ªæ—¥æœŸå‚æ•°ï¼Œåˆ¤æ–­è¯·æ±‚æ—¥æœŸæ˜¯å¦æ—©äºæŒ‡å®šæ—¥æœŸ</li><li>BetweenRoutePredicateFactoryï¼š æ¥æ”¶ä¸¤ä¸ªæ—¥æœŸå‚æ•°ï¼Œåˆ¤æ–­è¯·æ±‚æ—¥æœŸæ˜¯å¦åœ¨æŒ‡å®šæ—¶é—´æ®µå†…</li></ul><blockquote><p>è¿™é‡Œçš„æ—¶é—´æ ¼å¼å¯ä»¥ç”±JDK8è‡ªå¸¦çš„ZoneDateTimeç”Ÿæˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ZonedDateTime dateTime = ZonedDateTime.now();</span><br><span class="line">    System.out.println(dateTime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211153541.png" alt="image-20210211153541725"></p><blockquote><p>AfterRoutePredicateFactory</p></blockquote><ul><li>åœ¨ymlé…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®å¦‚ä¸‹ï¼Œè¿™é‡Œå°†afteråé¢çš„æ—¶é—´è®¾ç½®ä¸ºæˆ‘å½“å‰æ—¶é—´çš„ä¸€ä¸ªç¬‘æ˜¯å</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">After=2021-02-11T16:37:54.926+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211153734.png" alt="image-20210211153734924"></p><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211153920.png" alt="image-20210211153920543"></p><ul><li>ä¿®æ”¹ymlé…ç½®æ–‡ä»¶ï¼Œå°†æ—¶é—´æ”¹ä¸ºå½“å‰æ—¶é—´ä¸€ä¸ªå°æ—¶å‰ï¼Œé‡å¯å¾®æœåŠ¡</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">After=2021-02-11T14:37:54.926+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211154031.png" alt="image-20210211154031133"></p><blockquote><p>åŒç†ï¼ŒBeforeæ–­è¨€å’ŒBetweenæ–­è¨€ä¸Afterçš„ä½¿ç”¨æ–¹å¼ç±»å‹ï¼Œåªæ˜¯Betweenæ–­è¨€éœ€è¦ä¼ å…¥ä¸¤ä¸ªæ—¶é—´ï¼Œå¦‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Between=2020-03-08T10:59:34.102+08:00[Asia/Shanghai]</span> <span class="string">,</span>  <span class="number">2020-03-08T10:59:34.102+08:00</span>[<span class="string">Asia/Shanghai</span>]</span><br></pre></td></tr></table></figure><h3 id="2ã€åŸºäºè¿œç¨‹åœ°å€"><a href="#2ã€åŸºäºè¿œç¨‹åœ°å€" class="headerlink" title="2ã€åŸºäºè¿œç¨‹åœ°å€"></a>2ã€åŸºäºè¿œç¨‹åœ°å€</h3><blockquote><p>RemoteAddrRoutePredicateFactoryï¼šæ¥æ”¶ä¸€ä¸ªIPåœ°å€æ®µï¼Œåˆ¤æ–­è¯·æ±‚ä¸»æœºåœ°å€æ˜¯å¦åœ¨åœ°å€æ®µä¸­</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">RemoteAddr=192.168.1.1/24</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹ymlé…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œæµ‹è¯•</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">    <span class="comment">#- After=2021-02-11T14:37:54.926+08:00[Asia/Shanghai]</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RemoteAddr=192.168.1.1/24</span></span><br></pre></td></tr></table></figure><ul><li>ç»“æœï¼šç”±äºæœ¬æœºåœ°å€ä¸åœ¨é…ç½®çš„åœ°å€å†…ï¼Œæ‰€ä»¥æŠ¥é”™</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211155533.png" alt="image-20210211155532617"></p><h3 id="3ã€åŸºäºCookie"><a href="#3ã€åŸºäºCookie" class="headerlink" title="3ã€åŸºäºCookie"></a>3ã€åŸºäºCookie</h3><blockquote><p>CookieRoutePredicateFactoryï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œcookie åå­—å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€‚ åˆ¤æ–­è¯·æ±‚cookieæ˜¯å¦å…·æœ‰ç»™å®šåç§°ä¸”å€¼ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Cookie=chocolate,</span> <span class="string">ch.</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®è®¿é—®æ—¶éœ€è¦å¸¦ä¸Šçš„Cookie</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Cookie=wuhu,qifei</span></span><br></pre></td></tr></table></figure><blockquote><p>æ‰“å¼€å‘½ä»¤è¡Œï¼Œä½¿ç”¨curlè¿›è¡Œè®¿é—®</p></blockquote><ul><li>ä¸å¸¦Cookieæ—¶ï¼šcurl <a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211155943.png" alt="image-20210211155943876"></p><ul><li>å¸¦ä¸ŠCookieæ—¶ï¼šcurl <a href="http://localhost:9527/payment/lb">http://localhost:9527/payment/lb</a> â€“cookie â€œwuhu=qifeiâ€</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211160356.png" alt="image-20210211160356405"></p><h3 id="4ã€åŸºäºè¯·æ±‚å¤´Header"><a href="#4ã€åŸºäºè¯·æ±‚å¤´Header" class="headerlink" title="4ã€åŸºäºè¯·æ±‚å¤´Header"></a>4ã€åŸºäºè¯·æ±‚å¤´Header</h3><blockquote><p>HeaderRoutePredicateFactoryï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œæ ‡é¢˜åç§°å’Œæ­£åˆ™è¡¨è¾¾å¼ã€‚ åˆ¤æ–­è¯·æ±‚Headeræ˜¯å¦å…·æœ‰ç»™å®šåç§°ä¸”å€¼ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p></blockquote><ul><li>ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå½“å±æ€§å€¼ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…æ—¶æ‰§è¡Œ</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹ymlæ–‡ä»¶</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚å¤´ä¸­éœ€è¦å«æœ‰X-Request-Idå±æ€§ï¼Œä¸”X-Request-Idå±æ€§å€¼éœ€è¦ä¸ºæ­£æ•´æ•°</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Header=X-Request-Id,</span> <span class="string">\d+</span></span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨curlè¿›è¡Œæµ‹è¯•</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">curl</span> http://localhost:<span class="number">9527</span>/payment/lb <span class="literal">-H</span> <span class="string">&quot;X-Request-Id:123&quot;</span></span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211161019.png" alt="image-20210211161019074"></p><ul><li>ä½¿ç”¨curlè¿›è¡Œé”™è¯¯ç¤ºèŒƒ</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">curl</span> http://localhost:<span class="number">9527</span>/payment/lb <span class="literal">-H</span> <span class="string">&quot;X-Request-Id:-123&quot;</span></span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211161133.png" alt="image-20210211161133476"></p><h3 id="5ã€åŸºäºMethodè¯·æ±‚æ–¹æ³•"><a href="#5ã€åŸºäºMethodè¯·æ±‚æ–¹æ³•" class="headerlink" title="5ã€åŸºäºMethodè¯·æ±‚æ–¹æ³•"></a>5ã€åŸºäºMethodè¯·æ±‚æ–¹æ³•</h3><blockquote><p>MethodRoutePredicateFactoryï¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œåˆ¤æ–­è¯·æ±‚ç±»å‹æ˜¯å¦è·ŸæŒ‡å®šçš„ç±»å‹åŒ¹é…ã€‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Method=GET</span></span><br></pre></td></tr></table></figure><h3 id="6ã€åŸºäºPathè¯·æ±‚è·¯å¾„"><a href="#6ã€åŸºäºPathè¯·æ±‚è·¯å¾„" class="headerlink" title="6ã€åŸºäºPathè¯·æ±‚è·¯å¾„"></a>6ã€åŸºäºPathè¯·æ±‚è·¯å¾„</h3><blockquote><p>PathRoutePredicateFactoryï¼šæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œåˆ¤æ–­è¯·æ±‚çš„URIéƒ¨åˆ†æ˜¯å¦æ»¡è¶³è·¯å¾„è§„åˆ™ã€‚</p><p>æœ€å¸¸è§çš„ä¸€ç§æ–­è¨€</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Path=/foo/**</span></span><br></pre></td></tr></table></figure><h3 id="7ã€åŸºäºQueryè¯·æ±‚å‚æ•°"><a href="#7ã€åŸºäºQueryè¯·æ±‚å‚æ•°" class="headerlink" title="7ã€åŸºäºQueryè¯·æ±‚å‚æ•°"></a>7ã€åŸºäºQueryè¯·æ±‚å‚æ•°</h3><blockquote><p>QueryRoutePredicateFactory ï¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œè¯·æ±‚paramå’Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œ åˆ¤æ–­è¯·æ±‚å‚æ•°æ˜¯å¦å…·æœ‰ç»™å®šåç§°ä¸”å€¼ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="string">Query=baz,</span> <span class="string">ba.</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p></blockquote><ul><li>Query=uname, wuhuæ–­è¨€è¦æ±‚è¯·æ±‚ä¸­å¿…é¡»æœ‰unameå‚æ•°ï¼Œä¸”å‚æ•°å€¼å¿…é¡»ä¸ºwuhu</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">payment_routh2</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://cloud-payment-service</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/payment/lb/**</span>  <span class="comment">#æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Query=uname,</span> <span class="string">wuhu</span></span><br></pre></td></tr></table></figure><ul><li>è¿›è¡Œæµ‹è¯•ï¼Œè®¿é—®<a href="http://localhost:9527/payment/lb%EF%BC%8C%E6%9F%A5%E7%9C%8B%E7%BB%93%E6%9E%9C">http://localhost:9527/payment/lbï¼ŒæŸ¥çœ‹ç»“æœ</a></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211162140.png" alt="image-20210211162139906"></p><ul><li>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®<a href="http://localhost:9527/payment/lb?uname=wuhu">http://localhost:9527/payment/lb?uname=wuhu</a></li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211162254.png" alt="image-20210211162254068"></p><h1 id="ä¸‰ã€è¿‡æ»¤å™¨"><a href="#ä¸‰ã€è¿‡æ»¤å™¨" class="headerlink" title="ä¸‰ã€è¿‡æ»¤å™¨"></a>ä¸‰ã€è¿‡æ»¤å™¨</h1><h2 id="3-1ã€è¿‡æ»¤å™¨åŸºæœ¬æ¦‚å¿µ"><a href="#3-1ã€è¿‡æ»¤å™¨åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.1ã€è¿‡æ»¤å™¨åŸºæœ¬æ¦‚å¿µ"></a>3.1ã€è¿‡æ»¤å™¨åŸºæœ¬æ¦‚å¿µ</h2><h3 id="1ã€ä½œç”¨"><a href="#1ã€ä½œç”¨" class="headerlink" title="1ã€ä½œç”¨"></a>1ã€ä½œç”¨</h3><p>è¿‡æ»¤å™¨å°±æ˜¯åœ¨è¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå¯¹è¯·æ±‚å’Œå“åº”åšä¸€äº›ä¿®æ”¹</p><h3 id="2ã€ç”Ÿå‘½å‘¨æœŸ"><a href="#2ã€ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2ã€ç”Ÿå‘½å‘¨æœŸ"></a>2ã€ç”Ÿå‘½å‘¨æœŸ</h3><p>å®¢æˆ·ç«¯çš„è¯·æ±‚å…ˆç»è¿‡â€œpreâ€ç±»å‹çš„filterï¼Œç„¶åå°†è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„ä¸šåŠ¡æœåŠ¡ï¼Œæ”¶åˆ°ä¸šåŠ¡æœåŠ¡çš„å“åº”ä¹‹åï¼Œå†ç»è¿‡â€œpostâ€ç±»å‹çš„filterå¤„ç†ï¼Œæœ€åè¿”å›å“åº”åˆ°å®¢æˆ·ç«¯ã€‚</p><p>preï¼š è¿™ç§è¿‡æ»¤å™¨åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚æˆ‘ä»¬å¯åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨å®ç°å‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ï¼›</p><p>postï¼šè¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°è¾¾å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚è¿™ç§è¿‡æ»¤å™¨å¯ç”¨åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰ã€‚</p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211162518.png" alt="image-20210211162518791"></p><h3 id="3ã€åˆ†ç±»"><a href="#3ã€åˆ†ç±»" class="headerlink" title="3ã€åˆ†ç±»"></a>3ã€åˆ†ç±»</h3><p>å±€éƒ¨è¿‡æ»¤å™¨ GatewayFilterï¼šä½œç”¨åœ¨æŸä¸€ä¸ªè·¯ç”±ä¸Š</p><p>å…¨å±€è¿‡æ»¤å™¨ GlobalFilterï¼šä½œç”¨å…¨éƒ¨è·¯ç”±ä¸Š</p><h2 id="3-2ã€å±€éƒ¨è¿‡æ»¤å™¨"><a href="#3-2ã€å±€éƒ¨è¿‡æ»¤å™¨" class="headerlink" title="3.2ã€å±€éƒ¨è¿‡æ»¤å™¨"></a>3.2ã€å±€éƒ¨è¿‡æ»¤å™¨</h2><h3 id="1ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨"><a href="#1ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨" class="headerlink" title="1ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨"></a>1ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨</h3><p>åœ¨SpringCloud Gatewayä¸­å†…ç½®äº†å¾ˆå¤šä¸åŒç±»å‹çš„ç½‘å…³è·¯ç”±è¿‡æ»¤å™¨ã€‚å…·ä½“å¦‚ä¸‹</p><table><thead><tr><th>è¿‡æ»¤å™¨å·¥å‚</th><th>ä½œç”¨</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>AddRequestHeader</td><td>ä¸ºåŸå§‹è¯·æ±‚æ·»åŠ Header</td><td>Headerçš„åç§°åŠå€¼</td></tr><tr><td>AddRequestParameter</td><td>ä¸ºåŸå§‹è¯·æ±‚æ·»åŠ è¯·æ±‚å‚æ•°</td><td>å‚æ•°åç§°åŠå€¼</td></tr><tr><td>AddResponseHeader</td><td>ä¸ºåŸå§‹å“åº”æ·»åŠ Header</td><td>Headerçš„åç§°åŠå€¼</td></tr><tr><td>DedupeResponseHeader</td><td>å‰”é™¤å“åº”å¤´ä¸­é‡å¤çš„å€¼</td><td>éœ€è¦å»é‡çš„Headeråç§°åŠå»é‡ç­–ç•¥</td></tr><tr><td>Hystrix</td><td>ä¸ºè·¯ç”±å¼•å…¥Hystrixçš„æ–­è·¯å™¨ä¿æŠ¤</td><td>HystrixCommand çš„åç§°</td></tr><tr><td>FallbackHeaders</td><td>ä¸ºfallbackUriçš„è¯·æ±‚å¤´ä¸­æ·»åŠ å…·ä½“çš„å¼‚å¸¸ä¿¡æ¯</td><td>Headerçš„åç§°</td></tr><tr><td>Preï¬xPath</td><td>ä¸ºåŸå§‹è¯·æ±‚è·¯å¾„æ·»åŠ å‰ç¼€</td><td>å‰ç¼€è·¯å¾„</td></tr><tr><td>PreserveHostHeader</td><td>ä¸ºè¯·æ±‚æ·»åŠ ä¸€ä¸ªpreserveHostHeader=trueçš„å±æ€§ï¼Œè·¯ç”±è¿‡æ»¤å™¨ä¼šæ£€æŸ¥è¯¥å±æ€§ä»¥å†³å®šæ˜¯å¦è¦å‘é€åŸå§‹çš„Host</td><td>æ— </td></tr><tr><td>RequestRateLimiter</td><td>ç”¨äºå¯¹è¯·æ±‚é™æµï¼Œé™æµç®—æ³•ä¸ºä»¤ç‰Œæ¡¶</td><td>keyResolverã€rateLimiterã€statusCodeã€denyEmptyKeyã€emptyKeyStatus</td></tr><tr><td>RedirectTo</td><td>å°†åŸå§‹è¯·æ±‚é‡å®šå‘åˆ°æŒ‡å®šçš„URL</td><td>httpçŠ¶æ€ç åŠé‡å®šå‘çš„url</td></tr><tr><td>RemoveHopByHopHeadersFilter</td><td>ä¸ºåŸå§‹è¯·æ±‚åˆ é™¤IETFç»„ç»‡è§„å®šçš„ä¸€ç³»åˆ—Header</td><td>é»˜è®¤å°±ä¼šå¯ç”¨ï¼Œå¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šä»…åˆ é™¤å“ªäº›Header</td></tr><tr><td>RemoveRequestHeader</td><td>ä¸ºåŸå§‹è¯·æ±‚åˆ é™¤æŸä¸ªHeader</td><td>Headeråç§°</td></tr><tr><td>RemoveResponseHeader</td><td>ä¸ºåŸå§‹å“åº”åˆ é™¤æŸä¸ªHeader</td><td>Headeråç§°</td></tr><tr><td>RewritePath</td><td>é‡å†™åŸå§‹çš„è¯·æ±‚è·¯å¾„</td><td>åŸå§‹è·¯å¾„æ­£åˆ™è¡¨è¾¾å¼ä»¥åŠé‡å†™åè·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼</td></tr><tr><td>RewriteResponseHeader</td><td>é‡å†™åŸå§‹å“åº”ä¸­çš„æŸä¸ªHeader</td><td>Headeråç§°ï¼Œå€¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‡å†™åçš„å€¼</td></tr><tr><td>SaveSession</td><td>åœ¨è½¬å‘è¯·æ±‚ä¹‹å‰ï¼Œå¼ºåˆ¶æ‰§è¡ŒWebSession::save æ“ä½œ</td><td>æ— </td></tr><tr><td>secureHeaders</td><td>ä¸ºåŸå§‹å“åº”æ·»åŠ ä¸€ç³»åˆ—èµ·å®‰å…¨ä½œç”¨çš„å“åº”å¤´</td><td>æ— ï¼Œæ”¯æŒä¿®æ”¹è¿™äº›å®‰å…¨å“åº”å¤´çš„å€¼</td></tr><tr><td>SetPath</td><td>ä¿®æ”¹åŸå§‹çš„è¯·æ±‚è·¯å¾„</td><td>ä¿®æ”¹åçš„è·¯å¾„</td></tr><tr><td>SetResponseHeader</td><td>ä¿®æ”¹åŸå§‹å“åº”ä¸­æŸä¸ªHeaderçš„å€¼</td><td>Headeråç§°ï¼Œä¿®æ”¹åçš„å€¼</td></tr><tr><td>SetStatus</td><td>ä¿®æ”¹åŸå§‹å“åº”çš„çŠ¶æ€ç </td><td>HTTP çŠ¶æ€ç ï¼Œå¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²</td></tr><tr><td>StripPreï¬x</td><td>ç”¨äºæˆªæ–­åŸå§‹è¯·æ±‚çš„è·¯å¾„</td><td>ä½¿ç”¨æ•°å­—è¡¨ç¤ºè¦æˆªæ–­çš„è·¯å¾„çš„æ•°é‡</td></tr><tr><td>Retry</td><td>é’ˆå¯¹ä¸åŒçš„å“åº”è¿›è¡Œé‡è¯•</td><td>retriesã€statusesã€methodsã€series</td></tr><tr><td>RequestSize</td><td>è®¾ç½®å…è®¸æ¥æ”¶æœ€å¤§è¯·æ±‚åŒ…çš„å¤§ å°ã€‚å¦‚æœè¯·æ±‚åŒ…å¤§å°è¶…è¿‡è®¾ç½®çš„å€¼ï¼Œåˆ™è¿”å› 413 Payload TooLarge</td><td>è¯·æ±‚åŒ…å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œé»˜è®¤å€¼ä¸º5M</td></tr><tr><td>ModifyRequestBody</td><td>åœ¨è½¬å‘è¯·æ±‚ä¹‹å‰ä¿®æ”¹åŸå§‹è¯·æ±‚ä½“å†…å®¹</td><td>ä¿®æ”¹åçš„è¯·æ±‚ä½“å†…å®¹</td></tr><tr><td>ModifyResponseBody</td><td>ä¿®æ”¹åŸå§‹å“åº”ä½“çš„å†…å®¹</td><td>ä¿®æ”¹åçš„å“åº”ä½“å†…å®¹</td></tr></tbody></table><h3 id="2ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨çš„ä½¿ç”¨"><a href="#2ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨çš„ä½¿ç”¨" class="headerlink" title="2ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨çš„ä½¿ç”¨"></a>2ã€å†…ç½®å±€éƒ¨è¿‡æ»¤å™¨çš„ä½¿ç”¨</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">routes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-edu</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://service-edu</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Path=/user/**,</span> <span class="string">/*/edu/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">SetStatus=250</span> <span class="comment"># ä¿®æ”¹è¿”å›çŠ¶æ€ç </span></span><br></pre></td></tr></table></figure><h2 id="3-3ã€å…¨å±€è¿‡æ»¤å™¨"><a href="#3-3ã€å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="3.3ã€å…¨å±€è¿‡æ»¤å™¨"></a>3.3ã€å…¨å±€è¿‡æ»¤å™¨</h2><h3 id="1ã€å†…ç½®å…¨å±€è¿‡æ»¤å™¨"><a href="#1ã€å†…ç½®å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="1ã€å†…ç½®å…¨å±€è¿‡æ»¤å™¨"></a>1ã€å†…ç½®å…¨å±€è¿‡æ»¤å™¨</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211162756.png" alt="image-20210211162756079"></p><p>å†…ç½®å…¨å±€è¿‡æ»¤å™¨çš„ä½¿ç”¨ä¸¾ä¾‹ï¼šè´Ÿè½½å‡è¡¡è¿‡æ»¤å™¨</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">lb://service-edu</span></span><br></pre></td></tr></table></figure><h2 id="3-4ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"><a href="#3-4ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="3.4ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"></a>3.4ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</h2><blockquote><p>å®šä¹‰ä¸€ä¸ªFilterå®ç° GlobalFilter å’Œ Orderedæ¥å£</p></blockquote><h3 id="1ã€ä½œç”¨-1"><a href="#1ã€ä½œç”¨-1" class="headerlink" title="1ã€ä½œç”¨"></a>1ã€ä½œç”¨</h3><ul><li>å…¨å±€æ—¥å¿—è®°å½•</li><li>ç»Ÿä¸€ç½‘å…³é‰´æƒ</li><li>â€¦</li></ul><h3 id="2ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"><a href="#2ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨" class="headerlink" title="2ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨"></a>2ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</h3><blockquote><p>ç¼–å†™ä¸€ä¸ªè¿‡æ»¤å™¨ç±»ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨ç”¨äºè®°å½•æ—¥å¿—å·²ç»é‰´æƒ</p></blockquote><ul><li>å¦‚æœè¯·æ±‚ä¸­unameå‚æ•°å€¼ä¸ºç©ºï¼Œåˆ™ä¸æ”¾è¡Œï¼Œç›´æ¥å“åº”406</li><li>è¿™ä¸ªç±»éœ€è¦å®ç°GlobalFilterå’ŒOrderedæ¥å£ï¼Œå¹¶é‡å†™ä¸¤ä¸ªæ–¹æ³•</li><li>åœ¨getOrderæ–¹æ³•ä¸­ï¼Œå®šä¹‰è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§ï¼Œorderè¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> HIGHEST_PRECEDENCE = -<span class="number">2147483648</span>;</span><br><span class="line">    <span class="keyword">int</span> LOWEST_PRECEDENCE = <span class="number">2147483647</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨filteræ–¹æ³•ä¸­è¿›è¡Œæ—¥å¿—è®°å½•å’Œé‰´æƒæ“ä½œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLogGateWayFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;*************è¿›å…¥è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œæ—¶é—´ä¸ºï¼š&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">        String uname = exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;uname&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(uname == <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;********ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·ï¼&quot;</span>);</span><br><span class="line">            <span class="comment">//ç»™å“åº”å¯¹è±¡è¿”å›ä¸€ä¸ªçŠ¶æ€ç ï¼šè¯·æ±‚ä¸è¢«æ¥å—</span></span><br><span class="line">            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);</span><br><span class="line">            <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ”¾è¡Œï¼Œè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æ­¤æ–¹æ³•ç”¨äºå®šä¹‰è¿™ä¸ªè¿‡æ»¤å™¨åœ¨è¿‡æ»¤å™¨é“¾ä¸­çš„ä½ç½®</span></span><br><span class="line"><span class="comment">     * è¿”å›çš„orderè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><blockquote><p>è®¿é—®<a href="http://localhost:9257/payment/lb">http://localhost:9257/payment/lb</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211164137.png" alt="image-20210211164137410"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211164206.png" alt="image-20210211164206315"></p><blockquote><p>è®¿é—®<a href="http://localhost:9257/payment/lb%EF%BC%8C%E5%B8%A6%E4%B8%8A%E5%8F%82%E6%95%B0uname">http://localhost:9257/payment/lbï¼Œå¸¦ä¸Šå‚æ•°uname</a></p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211164402.png" alt="image-20210211164402908"></p><h1 id="å››ã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆGateWay"><a href="#å››ã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆGateWay" class="headerlink" title="å››ã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆGateWay"></a>å››ã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆGateWay</h1><blockquote><p><strong>æ³¨æ„</strong>ï¼šgatewayåº•å±‚ä½¿ç”¨çš„æ˜¯webfluxä¼šä¸webå†²çªï¼Œæ‰€ä»¥åœ¨gatewayä¸­ä¸è¦å¼•å…¥spring-boot-starter-webä¾èµ–</p></blockquote><h2 id="4-1ã€ç»Ÿä¸€ç½‘å…³é‰´æƒ"><a href="#4-1ã€ç»Ÿä¸€ç½‘å…³é‰´æƒ" class="headerlink" title="4.1ã€ç»Ÿä¸€ç½‘å…³é‰´æƒ"></a>4.1ã€ç»Ÿä¸€ç½‘å…³é‰´æƒ</h2><blockquote><p>æˆ‘ä»¬éœ€è¦åœ¨å¾®æœåŠ¡ç½‘å…³ä¸­è‡ªå®šä¹‰ä¸€ä¸ªå…¨å±€è¿‡æ»¤å™¨ï¼Œç»Ÿä¸€å¤„ç†éœ€è¦é‰´æƒçš„æœåŠ¡</p></blockquote><h3 id="1ã€é‰´æƒé€»è¾‘æè¿°"><a href="#1ã€é‰´æƒé€»è¾‘æè¿°" class="headerlink" title="1ã€é‰´æƒé€»è¾‘æè¿°"></a>1ã€é‰´æƒé€»è¾‘æè¿°</h3><ul><li>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯å¯¹ç”¨æˆ·è¿›è¡Œä¿¡æ¯è®¤è¯ï¼ˆç™»å½•ï¼‰</li><li>è®¤è¯é€šè¿‡ï¼Œå°†ç”¨æˆ·ä¿¡æ¯è¿›è¡ŒåŠ å¯†å½¢æˆtokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯</li><li>ä½œä¸ºç™»å½•å‡­è¯ä»¥åæ¯æ¬¡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯éƒ½æºå¸¦è®¤è¯çš„token</li><li>æœåŠ¡ç«¯å¯¹tokenè¿›è¡Œè§£å¯†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211165219.png" alt="image-20210211165219298"></p><blockquote><p>å¯¹äºéªŒè¯ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•é‰´æƒçš„è¿‡ç¨‹å¯ä»¥åœ¨ç½‘å…³ç»Ÿä¸€æ£€éªŒã€‚æ£€éªŒçš„æ ‡å‡†å°±æ˜¯è¯·æ±‚ä¸­æ˜¯å¦æºå¸¦tokenå‡­è¯ä»¥åŠtokençš„æ­£ç¡®æ€§ã€‚</p><p>ä¸‹é¢çš„æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªGlobalFilterï¼Œå»æ ¡éªŒæ‰€æœ‰çš„è¯·æ±‚å‚æ•°ä¸­æ˜¯å¦åŒ…å«â€œtokenâ€ï¼Œå¦‚æœä¸åŒ…å«è¯·æ±‚å‚æ•°â€œtokenâ€åˆ™ä¸è½¬å‘è·¯ç”±ï¼Œå¦åˆ™æ‰§è¡Œæ­£å¸¸çš„é€»è¾‘ã€‚</p></blockquote><h3 id="2ã€åˆ›å»ºè‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#2ã€åˆ›å»ºè‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="2ã€åˆ›å»ºè‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>2ã€åˆ›å»ºè‡ªå®šä¹‰è¿‡æ»¤å™¨</h3><ul><li>å¦‚æœtokenä¸ºç©ºæˆ–è€…tokenä¸åˆæ³•ï¼Œåˆ™ä¸æ”¾è¡Œã€‚</li><li>è¿™ä¸ªè¿‡æ»¤å™¨çš„orderä¸º0</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthGlobalFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line">        ServerHttpRequest request = exchange.getRequest();</span><br><span class="line">        String path = request.getURI().getPath();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°·ç²’å­¦é™¢apiæ¥å£ï¼Œæ ¡éªŒç”¨æˆ·å¿…é¡»ç™»å½•</span></span><br><span class="line">        AntPathMatcher antPathMatcher = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line">        <span class="keyword">if</span>(antPathMatcher.match(<span class="string">&quot;/api/**/auth/**&quot;</span>, path)) &#123;</span><br><span class="line">            List&lt;String&gt; tokenList = request.getHeaders().get(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ²¡æœ‰token</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span> == tokenList) &#123;</span><br><span class="line">                ServerHttpResponse response = exchange.getResponse();</span><br><span class="line">                <span class="keyword">return</span> out(response);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//tokenæ ¡éªŒå¤±è´¥</span></span><br><span class="line">            Boolean isCheck = JwtUtils.checkJwtTToken(tokenList.get(<span class="number">0</span>));</span><br><span class="line">            <span class="keyword">if</span>(!isCheck) &#123;</span><br><span class="line">                ServerHttpResponse response = exchange.getResponse();</span><br><span class="line">                <span class="keyword">return</span> out(response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰å½“å‰è¿‡æ»¤å™¨çš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Mono&lt;Void&gt; <span class="title">out</span><span class="params">(ServerHttpResponse response)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        JsonObject message = <span class="keyword">new</span> JsonObject();</span><br><span class="line">        message.addProperty(<span class="string">&quot;success&quot;</span>, <span class="keyword">false</span>);</span><br><span class="line">        message.addProperty(<span class="string">&quot;code&quot;</span>, <span class="number">28004</span>);</span><br><span class="line">        message.addProperty(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        message.addProperty(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;é‰´æƒå¤±è´¥&quot;</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = message.toString().getBytes(StandardCharsets.UTF_8);</span><br><span class="line">        DataBuffer buffer = response.bufferFactory().wrap(bytes);</span><br><span class="line">        <span class="comment">//æŒ‡å®šç¼–ç ï¼Œå¦åˆ™åœ¨æµè§ˆå™¨ä¸­ä¼šä¸­æ–‡ä¹±ç </span></span><br><span class="line">        response.getHeaders().add(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">//è¾“å‡ºhttpå“åº”</span></span><br><span class="line">        <span class="keyword">return</span> response.writeWith(Mono.just(buffer));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€ä¿®æ”¹å‰ç«¯"><a href="#3ã€ä¿®æ”¹å‰ç«¯" class="headerlink" title="3ã€ä¿®æ”¹å‰ç«¯"></a>3ã€ä¿®æ”¹å‰ç«¯</h3><blockquote><p>guli-siteçš„utils/request.jsä¸­ä¿®æ”¹å“åº”è¿‡æ»¤å™¨ ï¼Œæ·»åŠ åˆ†æ”¯ï¼š</p></blockquote><ul><li>å¦‚æœå“åº”ç ä¸º20004ï¼Œåˆ™è¯æ˜è®¤è¯å¤±è´¥ï¼Œç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œæ­¤æ—¶è®©ç”¨æˆ·è·³è½¬åˆ°ç™»å½•é¡µ</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (res.code === <span class="number">28004</span>) &#123; <span class="comment">// é‰´æƒå¤±è´¥</span></span><br><span class="line">    <span class="built_in">window</span>.location.href = <span class="string">&#x27;/login&#x27;</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹pages/login.vueçš„submitLoginæ–¹æ³•ï¼šç™»å½•åå›åˆ°åŸæ¥çš„é¡µé¢</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·³è½¬åˆ°é¦–é¡µ</span></span><br><span class="line"><span class="comment">// window.location.href = &#x27;/&#x27;</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span>.referrer.indexOf(<span class="string">&#x27;register&#x27;</span>) !== -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">window</span>.location.href = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    history.go(-<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2ã€ç»Ÿä¸€å¤„ç†è·¨åŸŸé—®é¢˜"><a href="#4-2ã€ç»Ÿä¸€å¤„ç†è·¨åŸŸé—®é¢˜" class="headerlink" title="4.2ã€ç»Ÿä¸€å¤„ç†è·¨åŸŸé—®é¢˜"></a>4.2ã€ç»Ÿä¸€å¤„ç†è·¨åŸŸé—®é¢˜</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ</h3><blockquote><p>å½“ä¸€ä¸ªè¯·æ±‚urlçš„<strong>åè®®ã€åŸŸåã€ç«¯å£</strong>ä¸‰è€…ä¹‹é—´ä»»æ„ä¸€ä¸ªä¸å½“å‰é¡µé¢urlä¸åŒå³ä¸ºè·¨åŸŸ</p></blockquote><table><thead><tr><th><strong>å½“å‰é¡µé¢url</strong></th><th><strong>è¢«è¯·æ±‚é¡µé¢url</strong></th><th><strong>æ˜¯å¦è·¨åŸŸ</strong></th><th><strong>åŸå› </strong></th></tr></thead><tbody><tr><td><a href="http://www.test.com/">http://www.test.com/</a></td><td><a href="http://www.test.com/index.html">http://www.test.com/index.html</a></td><td>å¦</td><td>åŒæºï¼ˆåè®®ã€åŸŸåã€ç«¯å£å·ç›¸åŒï¼‰</td></tr><tr><td><a href="http://www.test.com/">http://www.test.com/</a></td><td><a href="https://www.test.com/index.html">https://www.test.com/index.html</a></td><td>è·¨åŸŸ</td><td>åè®®ä¸åŒï¼ˆhttp/httpsï¼‰</td></tr><tr><td><a href="http://www.test.com/">http://www.test.com/</a></td><td><a href="http://www.baidu.com/">http://www.baidu.com/</a></td><td>è·¨åŸŸ</td><td>ä¸»åŸŸåä¸åŒï¼ˆtest/baiduï¼‰</td></tr><tr><td><a href="http://www.test.com/">http://www.test.com/</a></td><td><a href="http://blog.test.com/">http://blog.test.com/</a></td><td>è·¨åŸŸ</td><td>å­åŸŸåä¸åŒï¼ˆwww/blogï¼‰</td></tr><tr><td><a href="http://www.test.com:8080/">http://www.test.com:8080/</a></td><td><a href="http://www.test.com:7001/">http://www.test.com:7001/</a></td><td>è·¨åŸŸ</td><td>ç«¯å£å·ä¸åŒï¼ˆ8080/7001ï¼‰</td></tr></tbody></table><h3 id="2ã€Spring-Bootä¸­è§£å†³è·¨åŸŸçš„å‡ ç§æ–¹æ³•"><a href="#2ã€Spring-Bootä¸­è§£å†³è·¨åŸŸçš„å‡ ç§æ–¹æ³•" class="headerlink" title="2ã€Spring Bootä¸­è§£å†³è·¨åŸŸçš„å‡ ç§æ–¹æ³•"></a>2ã€Spring Bootä¸­è§£å†³è·¨åŸŸçš„å‡ ç§æ–¹æ³•</h3><blockquote><p>åœ¨gatewayä¸­åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œè¿™ä¸ªé…ç½®ç±»ç”¨äºè§£å†³è·¨åŸŸé—®é¢˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CorsWebFilter <span class="title">corsFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CorsConfiguration config = <span class="keyword">new</span> CorsConfiguration();</span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        UrlBasedCorsConfigurationSource source = <span class="keyword">new</span> UrlBasedCorsConfigurationSource(<span class="keyword">new</span> PathPatternParser());</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CorsWebFilter(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨Spring Bootæ§åˆ¶å™¨ä¸­æ·»åŠ @CrossOriginæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥åŠ åœ¨<strong>ç±»ä¸Š</strong>æˆ–è€…<strong>æ–¹æ³•</strong>ä¸Š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;è¯¾ç¨‹åˆ†ç±»ç®¡ç†&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/edu/subject&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubjectController</span> </span>&#123;</span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼Œè¿™ä¸¤ç§æ–¹æ³•åªå–ä¸€ç§ä½¿ç”¨å³å¯ï¼Œå¦‚æœä½¿ç”¨äº†é…ç½®ç±»ï¼Œé‚£ä¹ˆæœ€å¥½å°†æ§åˆ¶å™¨ä¸Šçš„æ³¨è§£åˆ å»ã€‚</p></blockquote><blockquote><p>å‚è€ƒæ•™ç¨‹å¦‚ä¸‹ï¼š</p></blockquote><ul><li><p>[1]  <a href="https://www.bilibili.com/video/BV1fi4y1x7on">å°šç¡…è°·åœ¨çº¿æ•™è‚²é¡¹ç›®</a></p></li><li><p>[2]  <a href="https://blog.csdn.net/qq_38128179/article/details/84956552">ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿè·¨åŸŸçš„ç»“å±€æ–¹æ³•</a></p></li><li><p>[3]  <a href="https://www.bilibili.com/video/BV18E411x7eT">å°šç¡…è°·SpringCloud(Hç‰ˆ&amp;alibaba)æ¡†æ¶å¼€å‘æ•™ç¨‹</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸšªç½‘å…³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆå››ï¼‰-ä½¿ç”¨é€’å½’æŸ¥è¯¢åµŒå¥—åˆ—è¡¨å’Œåˆ é™¤åµŒå¥—åˆ—è¡¨</title>
      <link href="posts/4109687940.html"/>
      <url>posts/4109687940.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€éœ€æ±‚åŠæ•°æ®åº“è¯´æ˜"><a href="#ä¸€ã€éœ€æ±‚åŠæ•°æ®åº“è¯´æ˜" class="headerlink" title="ä¸€ã€éœ€æ±‚åŠæ•°æ®åº“è¯´æ˜"></a>ä¸€ã€éœ€æ±‚åŠæ•°æ®åº“è¯´æ˜</h1><blockquote><p>åœ¨åœ¨çº¿æ•™è‚²é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Spring Securityä½œä¸ºå®‰å…¨æ¡†æ¶ï¼Œåœ¨æƒé™ç®¡ç†éœ€æ±‚ä¸­ï¼Œ<strong>ä¸åŒè§’è‰²çš„ç”¨æˆ·ç™»å½•åå°ç®¡ç†ç³»ç»Ÿæ‹¥æœ‰ä¸åŒçš„èœå•æƒé™ä¸åŠŸèƒ½æƒé™ï¼Œ</strong>æƒé™ç®¡ç†åŒ…å«ä¸‰ä¸ªåŠŸèƒ½æ¨¡å—ï¼šèœå•ç®¡ç†ã€è§’è‰²ç®¡ç†å’Œç”¨æˆ·ç®¡ç†ã€‚</p><p>åœ¨èœå•ç®¡ç†ä¸­ï¼Œè¦æ±‚æˆ‘ä»¬ä½¿ç”¨æ ‘å½¢ç»“æ„å±•ç¤ºèœå•åˆ—è¡¨ã€‚</p></blockquote><blockquote><p>åˆ›å»ºacl_permissionè¡¨ï¼Œçœç•¥éƒ¨åˆ†æ•°æ®</p></blockquote><ul><li>åœ¨permissionè¡¨ä¸­ï¼Œpidä¸º0çš„ä¸ºæƒé™èœå•é¡¶å±‚æ•°æ®</li><li>æ ¹æ®pid =  idæ¥ç¡®å®šæ•°æ®é—´çš„çˆ¶å­å…³ç³»</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;acl_permission&#96; (</span><br><span class="line">  &#96;id&#96; char(19) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;ç¼–å·&#39;,</span><br><span class="line">  &#96;pid&#96; char(19) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;æ‰€å±ä¸Šçº§&#39;,</span><br><span class="line">  &#96;name&#96; varchar(20) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;åç§°&#39;,</span><br><span class="line">  &#96;type&#96; tinyint(3) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;ç±»å‹(1:èœå•,2:æŒ‰é’®)&#39;,</span><br><span class="line">  &#96;permission_value&#96; varchar(50) DEFAULT NULL COMMENT &#39;æƒé™å€¼&#39;,</span><br><span class="line">  &#96;path&#96; varchar(100) DEFAULT NULL COMMENT &#39;è®¿é—®è·¯å¾„&#39;,</span><br><span class="line">  &#96;component&#96; varchar(100) DEFAULT NULL COMMENT &#39;ç»„ä»¶è·¯å¾„&#39;,</span><br><span class="line">  &#96;icon&#96; varchar(50) DEFAULT NULL COMMENT &#39;å›¾æ ‡&#39;,</span><br><span class="line">  &#96;status&#96; tinyint(4) DEFAULT NULL COMMENT &#39;çŠ¶æ€(0:ç¦æ­¢,1:æ­£å¸¸)&#39;,</span><br><span class="line">  &#96;is_deleted&#96; tinyint(1) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;é€»è¾‘åˆ é™¤ 1ï¼ˆtrueï¼‰å·²åˆ é™¤ï¼Œ 0ï¼ˆfalseï¼‰æœªåˆ é™¤&#39;,</span><br><span class="line">  &#96;gmt_create&#96; datetime DEFAULT NULL COMMENT &#39;åˆ›å»ºæ—¶é—´&#39;,</span><br><span class="line">  &#96;gmt_modified&#96; datetime DEFAULT NULL COMMENT &#39;æ›´æ–°æ—¶é—´&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;),</span><br><span class="line">  KEY &#96;idx_pid&#96; (&#96;pid&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8mb4 COMMENT&#x3D;&#39;æƒé™&#39;;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Data for table &quot;acl_permission&quot;</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;acl_permission&#96; VALUES (&#39;1&#39;,&#39;0&#39;,&#39;å…¨éƒ¨æ•°æ®&#39;,0,NULL,NULL,NULL,NULL,NULL,0,&#39;2019-11-15 17:13:06&#39;,&#39;2019-11-15 17:13:06&#39;),(&#39;1195268474480156673&#39;,&#39;1&#39;,&#39;æƒé™ç®¡ç†&#39;,1,NULL,&#39;&#x2F;acl&#39;,&#39;Layout&#39;,NULL,NULL,0,&#39;2019-11-15 17:13:06&#39;,&#39;2019-11-18 13:54:25&#39;),(&#39;1195268616021139457&#39;,&#39;1195268474480156673&#39;,&#39;ç”¨æˆ·ç®¡ç†&#39;,1,NULL,&#39;user&#x2F;list&#39;,&#39;&#x2F;acl&#x2F;user&#x2F;list&#39;,NULL,NULL,0,&#39;2019-11-15 17:13:40&#39;,&#39;2019-11-18 13:53:12&#39;),(&#39;1195268788138598401&#39;,&#39;1195268474480156673&#39;,&#39;è§’è‰²ç®¡ç†&#39;,1,NULL,&#39;role&#x2F;list&#39;,&#39;&#x2F;acl&#x2F;role&#x2F;list&#39;,NULL,NULL,0,&#39;2019-11-15 17:14:21&#39;,&#39;2019-11-15 17:14:21&#39;),(&#39;1195268893830864898&#39;,&#39;1195268474480156673&#39;,&#39;èœå•ç®¡ç†&#39;,1,NULL,&#39;menu&#x2F;list&#39;,&#39;&#x2F;acl&#x2F;menu&#x2F;list&#39;,NULL,NULL,0,&#39;2019-11-15 17:14:46&#39;,&#39;2019-11-15 17:14:46&#39;),(&#39;1195269143060602882&#39;,&#39;1195268616021139457&#39;,&#39;æŸ¥çœ‹&#39;,2,&#39;user.list&#39;,&#39;&#39;,&#39;&#39;,NULL,NULL,0,&#39;2019-11-15 17:15:45&#39;,&#39;2019-11-17 21:57:16&#39;),(&#39;1195269295926206466&#39;,&#39;1195268616021139457&#39;,&#39;æ·»åŠ &#39;,2,&#39;user.add&#39;,&#39;user&#x2F;add&#39;,&#39;&#x2F;acl&#x2F;user&#x2F;form&#39;,NULL,NULL,0,&#39;2019-11-15 17:16:22&#39;,&#39;2019-11-15 17:16:22&#39;),(&#39;1195269473479483394&#39;,&#39;1195268616021139457&#39;,&#39;ä¿®æ”¹&#39;,2,&#39;user.update&#39;,&#39;user&#x2F;update&#x2F;:id&#39;,&#39;&#x2F;acl&#x2F;user&#x2F;form&#39;,NULL,NULL,0,&#39;2019-11-15 17:17:04&#39;,&#39;2019-11-15 17:17:04&#39;),(&#39;1195269547269873666&#39;,&#39;1195268616021139457&#39;,&#39;åˆ é™¤&#39;,2,&#39;user.remove&#39;,&#39;&#39;,&#39;&#39;,NULL,NULL,0,&#39;2019-11-15 17:17:22&#39;,&#39;2019-11-15 17:17:22&#39;),(&#39;1195269821262782465&#39;,&#39;1195268788138598401&#39;,&#39;ä¿®æ”¹&#39;,2,&#39;role.update&#39;,&#39;role&#x2F;update&#x2F;:id&#39;,&#39;&#x2F;acl&#x2F;role&#x2F;form&#39;,NULL,NULL,0,&#39;2019-11-15 17:18:27&#39;,&#39;2019-11-15 17:19:53&#39;),(&#39;1195269903542444034&#39;,&#39;1195268788138598401&#39;,&#39;æŸ¥çœ‹&#39;,2,&#39;role.list&#39;,&#39;&#39;,&#39;&#39;,NULL,NULL,0,&#39;2019-11-15 17:18:47&#39;,&#39;2019-11-15 17:18:47&#39;);</span><br></pre></td></tr></table></figure><h1 id="äºŒã€ä½¿ç”¨é€’å½’æŸ¥è¯¢åµŒå¥—åˆ—è¡¨"><a href="#äºŒã€ä½¿ç”¨é€’å½’æŸ¥è¯¢åµŒå¥—åˆ—è¡¨" class="headerlink" title="äºŒã€ä½¿ç”¨é€’å½’æŸ¥è¯¢åµŒå¥—åˆ—è¡¨"></a>äºŒã€ä½¿ç”¨é€’å½’æŸ¥è¯¢åµŒå¥—åˆ—è¡¨</h1><h2 id="2-1ã€å®ä½“ç±»"><a href="#2-1ã€å®ä½“ç±»" class="headerlink" title="2.1ã€å®ä½“ç±»"></a>2.1ã€å®ä½“ç±»</h2><blockquote><p>ä¸ºäº†å®ç°åµŒå¥—åˆ—è¡¨çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå®ä½“ç±»æ·»åŠ ä¸€äº›é¢å¤–çš„å±æ€§</p></blockquote><ul><li>æ·»åŠ ä¸€ä¸ªIntegerç±»å‹çš„levelå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨äºè¡¨ç¤ºå½“å‰permissionå¯¹è±¡åœ¨å“ªä¸€çº§èœå•</li><li>æ·»åŠ ä¸€ä¸ªList&lt; Permission &gt;ç±»å‹çš„childrenå±æ€§ï¼Œè¿™ä¸ªå±æ€§ç”¨äºå­˜æ”¾å½“å‰permissionå¯¹è±¡çš„å­èœå•</li><li>ç”±äºè¿™ä¸¤ä¸ªå±æ€§ä¸å±äºæ•°æ®åº“ä¸­çš„å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ @TableField(exist = false) æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@TableName(&quot;acl_permission&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(value=&quot;Permissionå¯¹è±¡&quot;, description=&quot;æƒé™&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Permission</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æ‰€å±ä¸Šçº§&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String pid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;åç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;ç±»å‹(1:èœå•,2:æŒ‰é’®)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æƒé™å€¼&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String permissionValue;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è®¿é—®è·¯å¾„&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;ç»„ä»¶è·¯å¾„&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String component;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;å›¾æ ‡&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;çŠ¶æ€(0:ç¦æ­¢,1:æ­£å¸¸)&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;é€»è¾‘åˆ é™¤ 1ï¼ˆtrueï¼‰å·²åˆ é™¤ï¼Œ 0ï¼ˆfalseï¼‰æœªåˆ é™¤&quot;)</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ä¸‹é¢æ˜¯ä¸šåŠ¡ä¸­æ‰‹åŠ¨æ·»åŠ çš„å±æ€§</span></span><br><span class="line"><span class="comment">     * å¹¶éæ•°æ®åº“ä¸­çš„å­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;è¡¨ç¤ºå½“å‰permissionå¯¹è±¡æ˜¯å“ªä¸€çº§èœå•&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;ä¸‹çº§&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Permission&gt; children;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ˜¯å¦è¢«é€‰ä¸­&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isSelect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2ã€Controllerå±‚"><a href="#2-2ã€Controllerå±‚" class="headerlink" title="2.2ã€Controllerå±‚"></a>2.2ã€Controllerå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æŸ¥è¯¢æ‰€æœ‰èœå•&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">indexAllPermission</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Permission&gt; list = permissionService.queryAllMenu();</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;children&quot;</span>,list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3ã€Serviceå±‚"><a href="#2-3ã€Serviceå±‚" class="headerlink" title="2.3ã€Serviceå±‚"></a>2.3ã€Serviceå±‚</h2><blockquote><p>ç¬¬ä¸€æ­¥ï¼Œå…ˆæŸ¥è¯¢å‡ºpermissionè¡¨ä¸­æ‰€æœ‰æ•°æ®ï¼Œæ ¹æ®idæ’åº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * é€’å½’æŸ¥è¯¢æ‰€æœ‰èœå•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Permission&gt; <span class="title">queryAllMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 æŸ¥è¯¢èœå•è¡¨ä¸­æ‰€æœ‰æ•°æ®ï¼Œæ ¹æ®idæ’åº</span></span><br><span class="line">    QueryWrapper&lt;Permission&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.orderByAsc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    List&lt;Permission&gt; permissionList = baseMapper.selectList(wrapper);</span><br><span class="line">    <span class="comment">//2 å°†æŸ¥è¯¢å‡ºæ¥çš„èœå•Listé›†åˆæŒ‰ç…§è¦æ±‚è¿›è¡Œå°è£…</span></span><br><span class="line">    <span class="keyword">return</span> buildPermission(permissionList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªbuildPermissionæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†æŸ¥è¯¢å‡ºæ¥çš„permissioné›†åˆè½¬æ¢ä¸ºåµŒå¥—åˆ—è¡¨é›†åˆ</p></blockquote><ul><li>å…ˆæŸ¥è¯¢å‡ºæ‰€æœ‰permissionå¯¹è±¡ä¸­pidä¸º0ï¼Œå³æœ€é¡¶å±‚çš„å…ƒç´ </li><li>å°†è¯¥permissionå¯¹è±¡çš„levelè®¾ç½®ä¸º1</li><li>å°†è¿™ä¸ªé¡¶å±‚å…ƒç´ åŠ å…¥åˆ°è¦è¿”å›ç»™Controllerå±‚çš„Listé›†åˆä¸­</li><li>å†™ä¸€ä¸ªselectChildrenæ–¹æ³•ï¼Œä¼ å…¥å½“å‰permissionå’Œç¬¬ä¸€æ­¥æŸ¥è¯¢å‡ºçš„æ‰€æœ‰permissioné›†åˆï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºé€’å½’ç»„è£…é¡¶å±‚å…ƒç´ çš„å­å…ƒç´ å’Œåä»£å…ƒç´ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * å°è£…ä¼ å…¥çš„èœå•é›†åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> permissionList è¦å°è£…çš„èœå•åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å°è£…å¥½çš„åµŒå¥—èœå•åˆ—è¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Permission&gt; <span class="title">buildPermission</span><span class="params">(List&lt;Permission&gt; permissionList)</span> </span>&#123;</span><br><span class="line">    List&lt;Permission&gt; finalNode = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//éå†ä¼ å…¥çš„èœå•åˆ—è¡¨ï¼Œå¾—åˆ°æœ€é¡¶å±‚å…ƒç´ ï¼Œå³pid = 0çš„èœå•å¯¹è±¡ï¼Œè®¾ç½®å…¶levelå€¼ä¸º1</span></span><br><span class="line">    <span class="keyword">for</span> (Permission permission : permissionList) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;0&quot;</span>.equals(permission.getPid())) &#123;</span><br><span class="line">            <span class="comment">//è®¾ç½®é¡¶å±‚èœå•çš„levelå€¼ä¸º1</span></span><br><span class="line">            permission.setLevel(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">//æ ¹æ®é¡¶å±‚èœå•ï¼Œå‘é‡Œé¢è¿›è¡ŒæŸ¥è¯¢å­èœå•ï¼Œå°è£…åˆ°finalNode</span></span><br><span class="line">            finalNode.add(selectChildren(permission,permissionList));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> finalNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸‰æ­¥ï¼Œå†™ä¸€ä¸ªselectChildrenæ–¹æ³•ï¼Œæ ¹æ®ä¼ å…¥çš„permissionå¯¹è±¡å’Œpermissioné›†åˆé€’å½’ç»„è£…åµŒå¥—åˆ—è¡¨ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * çœŸæ­£çš„é€’å½’åœ¨è¿™é‡Œè¿›è¡Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> permission</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> permissionList</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Permission <span class="title">selectChildren</span><span class="params">(Permission permission, List&lt;Permission&gt; permissionList)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 ç”±äºæˆ‘ä»¬è¦å‘ä¸Šä¸€å±‚èœå•å¯¹è±¡çš„childrenä¸­æ”¾ç½®å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆåˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line">    permission.setChildren(<span class="keyword">new</span> ArrayList&lt;Permission&gt;());</span><br><span class="line">    <span class="comment">//2 éå†æ‰€æœ‰èœå•åˆ—è¡¨ï¼Œè¿›è¡Œåˆ¤æ–­æ¯”è¾ƒï¼Œæ¯”è¾ƒidå€¼ä¸pidæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">    permissionList.forEach(per -&gt; &#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­idå’Œpidæ˜¯å¦ç›¸åŒ</span></span><br><span class="line">        <span class="keyword">if</span>(permission.getId().equals(per.getPid())) &#123;</span><br><span class="line">            <span class="comment">//æ­¤æ—¶è¯æ˜å½“å‰perå¯¹è±¡æ˜¯permissionå¯¹è±¡çš„å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">//æ‰€ä»¥å­èŠ‚ç‚¹çš„levelå€¼åº”è¯¥ä¸ºçˆ¶èŠ‚ç‚¹çš„level+1</span></span><br><span class="line">            per.setLevel(permission.getLevel() + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(CollectionUtils.isEmpty(permission.getChildren())) &#123;</span><br><span class="line">                permission.setChildren(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æŠŠæŸ¥è¯¢å‡ºæ¥çš„å½“å‰èœå•æ”¾åœ¨ä¸Šä¸€å±‚èœå•å¯¹è±¡çš„childrenä¸­</span></span><br><span class="line">            permission.getChildren().add(selectChildren(per,permissionList));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> permission;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-4ã€æµ‹è¯•"><a href="#2-4ã€æµ‹è¯•" class="headerlink" title="2.4ã€æµ‹è¯•"></a>2.4ã€æµ‹è¯•</h2><blockquote><p>ä½¿ç”¨Swaggerè¿›è¡Œæµ‹è¯•</p></blockquote><ul><li>ç•Œé¢</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210233136.png" alt="image-20210210233136804"></p><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210233105.png" alt="image-20210210233104615"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210233608.png" alt="image-20210210233608819"></p><h1 id="ä¸‰ã€é€šè¿‡idé€’å½’åˆ é™¤åµŒå¥—èœå•"><a href="#ä¸‰ã€é€šè¿‡idé€’å½’åˆ é™¤åµŒå¥—èœå•" class="headerlink" title="ä¸‰ã€é€šè¿‡idé€’å½’åˆ é™¤åµŒå¥—èœå•"></a>ä¸‰ã€é€šè¿‡idé€’å½’åˆ é™¤åµŒå¥—èœå•</h1><blockquote><p>éœ€è¦åˆ é™¤è‡ªèº«åŠæ‰€æœ‰çš„åä»£å…ƒç´ </p></blockquote><h2 id="3-1ã€Controllerå±‚"><a href="#3-1ã€Controllerå±‚" class="headerlink" title="3.1ã€Controllerå±‚"></a>3.1ã€Controllerå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;é€’å½’åˆ é™¤èœå•&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">deletePermission</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> </span>&#123;</span><br><span class="line">    permissionService.recurDeletePermissionById(id);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2ã€Serviceå±‚"><a href="#3-2ã€Serviceå±‚" class="headerlink" title="3.2ã€Serviceå±‚"></a>3.2ã€Serviceå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æ ¹æ®idé€’å½’åˆ é™¤èœå•åŠå­èœå•</span></span><br><span class="line"><span class="comment"> * è·å–idä¸ºä¼ å…¥idçš„èœå•åŠå­èœå•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recurDeletePermissionById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 åˆ›å»ºä¸€ä¸ªlisté›†åˆï¼Œç”¨äºå°è£…æ‰€æœ‰åˆ é™¤èœå•idå€¼</span></span><br><span class="line">    List&lt;String&gt; idList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//2 å‘idListä¸­è®¾ç½®è¦åˆ é™¤çš„èœå•id</span></span><br><span class="line">    <span class="keyword">this</span>.selectPermissionChildById(id,idList);</span><br><span class="line">    <span class="comment">//æ”¾å…¥è¦åˆ é™¤çš„idï¼Œé€’å½’å°è£…çš„åªæ˜¯å­èœå•çš„id</span></span><br><span class="line">    idList.add(id);</span><br><span class="line">    permissionMapper.deleteBatchIds(idList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™selectPermissionChildByIdæ–¹æ³•ï¼Œä¼ å…¥çˆ¶çº§idå’Œç”¨äºæ‰¹é‡åˆ é™¤çš„idåˆ—è¡¨ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºæŸ¥è¯¢æ‰€æœ‰å¾…åˆ é™¤å…ƒç´ çš„åä»£å…ƒç´ çš„id</p></blockquote><ul><li>ä½¿ç”¨Mybatis-Plusè‡ªå¸¦çš„QueryWrapperæŸ¥è¯¢å‡ºpidä¸ºä¼ å…¥idçš„permissionå…ƒç´ </li><li>éå†ä¸Šä¸€æ­¥æŸ¥è¯¢åˆ°çš„permissionåˆ—è¡¨ï¼Œç„¶åä»¥åˆ—è¡¨ä¸­æ¯ä¸€ä¸ªå…ƒç´ çš„idä½œä¸ºpidï¼Œè¿›è¡Œé€’å½’æŸ¥è¯¢</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ä¼ å…¥çš„èœå•idï¼ŒæŸ¥è¯¢èœå•ä¸­çš„æ‰€æœ‰å­èœå•idï¼Œç„¶åå°è£…åˆ°listé›†åˆä¸­</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> idList</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">selectPermissionChildById</span><span class="params">(String id, List&lt;String&gt; idList)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;Permission&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;pid&quot;</span>,id);</span><br><span class="line">    wrapper.select(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    List&lt;Permission&gt; childIdList = permissionMapper.selectList(wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŠŠchildIdListä¸­çš„èœå•idä¸€ä¸€å–å‡ºï¼Œå°è£…åˆ°idListä¸­ï¼Œåšé€’å½’æŸ¥è¯¢</span></span><br><span class="line">    childIdList.forEach(item -&gt; &#123;</span><br><span class="line">        idList.add(item.getId());</span><br><span class="line">        <span class="comment">//é€’å½’æŸ¥è¯¢</span></span><br><span class="line">        <span class="keyword">this</span>.selectPermissionChildById(item.getId(),idList);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3ã€æµ‹è¯•"><a href="#3-3ã€æµ‹è¯•" class="headerlink" title="3.3ã€æµ‹è¯•"></a>3.3ã€æµ‹è¯•</h2><blockquote><p>åœ¨æ•°æ®åº“ä¸­æ’å…¥å‡ æ¡æµ‹è¯•æ•°æ®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210235954.png" alt="image-20210210235953698"></p><blockquote><p>æ‰“å¼€swaggerï¼Œæˆ‘ä»¬æµ‹è¯•åˆ é™¤idä¸º2çš„èœå•åŠå…¶åä»£ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211000114.png" alt="image-20210211000114430"></p><blockquote><p>æŸ¥çœ‹æ•°æ®åº“ï¼Œå‘ç°æµ‹è¯•æ•°æ®å·²ç»è¢«é€»è¾‘åˆ é™¤ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211000230.png" alt="image-20210211000230171"></p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆä¸‰ï¼‰-EasyExcelçš„ä½¿ç”¨</title>
      <link href="posts/765379126.html"/>
      <url>posts/765379126.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€ä»‹ç»å’Œå…¥é—¨ä½¿ç”¨"><a href="#ä¸€ã€ä»‹ç»å’Œå…¥é—¨ä½¿ç”¨" class="headerlink" title="ä¸€ã€ä»‹ç»å’Œå…¥é—¨ä½¿ç”¨"></a>ä¸€ã€ä»‹ç»å’Œå…¥é—¨ä½¿ç”¨</h1><h2 id="1-1ã€Excelçš„åº”ç”¨åœºæ™¯"><a href="#1-1ã€Excelçš„åº”ç”¨åœºæ™¯" class="headerlink" title="1.1ã€Excelçš„åº”ç”¨åœºæ™¯"></a>1.1ã€Excelçš„åº”ç”¨åœºæ™¯</h2><blockquote><p>æ•°æ®å¯¼å…¥ï¼š<strong>å‡è½»å½•å…¥å·¥ä½œé‡</strong></p></blockquote><blockquote><p>æ•°æ®å¯¼å‡ºï¼š<strong>ç»Ÿè®¡ä¿¡æ¯å½’æ¡£</strong></p></blockquote><blockquote><p>æ•°æ®ä¼ è¾“ï¼š<strong>å¼‚æ„ç³»ç»Ÿä¹‹é—´æ•°æ®ä¼ è¾“</strong></p></blockquote><h2 id="1-2ã€EasyExcel"><a href="#1-2ã€EasyExcel" class="headerlink" title="1.2ã€EasyExcel"></a>1.2ã€EasyExcel</h2><blockquote><p><strong>Githubåœ°å€ï¼š</strong><a href="https://github.com/alibaba/easyexcel">EasyExcel</a></p><p><strong>å®˜æ–¹ç½‘ç«™ï¼š</strong><a href="https://www.yuque.com/easyexcel/doc/easyexcel">EasyExcel</a></p></blockquote><h3 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h3><blockquote><p>EasyExcelæ˜¯ä¸€ä¸ªåŸºäºJavaçš„ç®€å•ã€çœå†…å­˜çš„è¯»å†™Excelçš„å¼€æºé¡¹ç›®ã€‚åœ¨å°½å¯èƒ½èŠ‚çº¦å†…å­˜çš„æƒ…å†µä¸‹æ”¯æŒè¯»å†™ç™¾Mçš„Excelã€‚</p></blockquote><h3 id="2ã€ç‰¹ç‚¹"><a href="#2ã€ç‰¹ç‚¹" class="headerlink" title="2ã€ç‰¹ç‚¹"></a>2ã€ç‰¹ç‚¹</h3><ul><li>Javaé¢†åŸŸè§£æã€ç”ŸæˆExcelæ¯”è¾ƒæœ‰åçš„æ¡†æ¶æœ‰Apache poiã€jxlç­‰ã€‚ä½†ä»–ä»¬éƒ½å­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜å°±æ˜¯éå¸¸çš„è€—å†…å­˜ã€‚å¦‚æœä½ çš„ç³»ç»Ÿå¹¶å‘é‡ä¸å¤§çš„è¯å¯èƒ½è¿˜è¡Œï¼Œä½†æ˜¯ä¸€æ—¦å¹¶å‘ä¸Šæ¥åä¸€å®šä¼šOOMæˆ–è€…JVMé¢‘ç¹çš„full gcã€‚</li><li>EasyExcelæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€ä¸ªexcelå¤„ç†æ¡†æ¶ï¼Œ<strong>ä»¥ä½¿ç”¨ç®€å•ã€èŠ‚çœå†…å­˜è‘—ç§°</strong>ã€‚EasyExcelèƒ½å¤§å¤§å‡å°‘å ç”¨å†…å­˜çš„ä¸»è¦åŸå› æ˜¯åœ¨è§£æExcelæ—¶æ²¡æœ‰å°†æ–‡ä»¶æ•°æ®ä¸€æ¬¡æ€§å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯ä»ç£ç›˜ä¸Šä¸€è¡Œè¡Œè¯»å–æ•°æ®ï¼Œé€ä¸ªè§£æã€‚</li><li>EasyExcelé‡‡ç”¨ä¸€è¡Œä¸€è¡Œçš„è§£ææ¨¡å¼ï¼Œå¹¶å°†ä¸€è¡Œçš„è§£æç»“æœä»¥è§‚å¯Ÿè€…çš„æ¨¡å¼é€šçŸ¥å¤„ç†ï¼ˆAnalysisEventListenerï¼‰ã€‚</li></ul><h2 id="1-3ã€å…¥é—¨ä½¿ç”¨"><a href="#1-3ã€å…¥é—¨ä½¿ç”¨" class="headerlink" title="1.3ã€å…¥é—¨ä½¿ç”¨"></a>1.3ã€å…¥é—¨ä½¿ç”¨</h2><h3 id="1ã€åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–"><a href="#1ã€åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–" class="headerlink" title="1ã€åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–"></a>1ã€åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–</h3><blockquote><p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨<strong>Maven</strong>é¡¹ç›®ï¼Œå¹¶å¯¼å…¥ä»¥ä¸‹ä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.xmlbeans<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xmlbeans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€æœ€ç®€å•çš„å†™"><a href="#2ã€æœ€ç®€å•çš„å†™" class="headerlink" title="2ã€æœ€ç®€å•çš„å†™"></a>2ã€æœ€ç®€å•çš„å†™</h3><blockquote><p>åˆ›å»ºå®ä½“ç±»</p></blockquote><ul><li>ä½¿ç”¨@ExcelPropertyæ³¨è§£å¯ä»¥æŒ‡å®šexcelåˆ—åï¼Œå³nameå¯¹åº”excelä¸­çš„â€å§“åâ€åˆ—ï¼Œbirthdayå±æ€§å¯¹åº”excelä¸­çš„ç”Ÿæ—¥åˆ—â€¦</li><li>ä½¿ç”¨Lombokæ’ä»¶ç®€åŒ–å¼€å‘</li><li>å¯ä»¥ä½¿ç”¨@ExcelIgnoreå­—æ®µæ¥è®©EasyExcelå¿½ç•¥è¯¥å±æ€§</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelEmpData</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;å§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;ç”Ÿæ—¥&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;è–ªèµ„&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨<span class="doctag">@ExcelIgnore</span>æ³¨è§£æ¥ä½¿EasyExcelå¿½ç•¥è¿™ä¸ªå±æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨teståŒ…ä¸‹åˆ›å»ºä¸€ä¸ªTestWriteExcelDataæµ‹è¯•ç±»ï¼Œç”¨äºæµ‹è¯•EasyExcelçš„å†™åŠŸèƒ½</p></blockquote><ul><li>07ç‰ˆæœ¬çš„Excelå’Œ03ç‰ˆæœ¬çš„å†™å…¥æ–¹å¼æœ‰æ‰€ä¸åŒ</li><li>03ç‰ˆæœ¬çš„Excelå†™å…¥æœ€å¤šä¸€æ¬¡å¯å†™65536è¡Œ</li></ul><blockquote><p>ç¼–å†™ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºç”Ÿæˆæµ‹è¯•æ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;ExcelEmpData&gt; <span class="title">getEmpData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;ExcelEmpData&gt; excelEmpDataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    ExcelEmpData data = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">65535</span>; i++) &#123;</span><br><span class="line">        data = <span class="keyword">new</span> ExcelEmpData();</span><br><span class="line">        data.setName(<span class="string">&quot;èŠœæ¹–&quot;</span> + i);</span><br><span class="line">        <span class="comment">//passwordå±æ€§çš„å€¼ä¸ä¼šè¢«å†™å…¥Excelä¸­</span></span><br><span class="line">        data.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        data.setSalary(<span class="number">43.96</span>);</span><br><span class="line">        data.setBirthday(<span class="keyword">new</span> Date());</span><br><span class="line">        excelEmpDataList.add(data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> excelEmpDataList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æµ‹è¯•ç±»ä¸­ç¼–å†™ä¸€ä¸ªtestWrite07æ–¹æ³•ï¼Œç”¨äºå¯¹.xlsxæ–‡ä»¶è¿›è¡Œæ•°æ®å†™å…¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWrite07</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ•°æ®å†™å…¥åˆ°å“ªä¸ªexcelæ–‡ä»¶</span></span><br><span class="line">    String fileName = <span class="string">&quot;F:/testExcel/01-simpleWrite-07.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ éœ€è¦æŒ‡å®šå†™ç”¨å“ªä¸ªclasså»å†™ï¼Œç„¶åå†™åˆ°ç¬¬ä¸€ä¸ªsheetï¼Œåå­—ä¸ºæ¨¡æ¿ ç„¶åæ–‡ä»¶æµä¼šè‡ªåŠ¨å…³é—­</span></span><br><span class="line">    EasyExcel.write(fileName, ExcelEmpData.class).sheet(<span class="string">&quot;æ¨¡æ¿&quot;</span>).doWrite(getEmpData());</span><br><span class="line">    System.out.println(<span class="string">&quot;excelå†™å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210209235417.png" alt="image-20210209235416173"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210209235558.png" alt="image-20210209235558290"></p><blockquote><p>åœ¨æµ‹è¯•ç±»ä¸­ç¼–å†™ä¸€ä¸ªtestWrite03æ–¹æ³•ï¼Œç”¨äºå¯¹.xlsæ–‡ä»¶è¿›è¡Œæ•°æ®å†™å…¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simpleWrite03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String fileName = <span class="string">&quot;F:/testExcel/02-simpleWrite-03.xls&quot;</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœè¿™é‡Œæƒ³ä½¿ç”¨03 åˆ™ ä¼ å…¥excelTypeå‚æ•°å³å¯</span></span><br><span class="line">    EasyExcel.write(fileName, ExcelEmpData.class).excelType(ExcelTypeEnum.XLS).sheet(<span class="string">&quot;æ¨¡æ¿&quot;</span>).doWrite(getEmpData());</span><br><span class="line">    System.out.println(<span class="string">&quot;excelå†™å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210209235836.png" alt="image-20210209235835844"></p><blockquote><p>å‘.xlsæ–‡ä»¶å†™å…¥æ•°æ®æ—¶ï¼Œä¸€æ¬¡æœ€å¤šå†™å…¥65536è¡Œ</p></blockquote><ul><li>å°†getData()å‡½æ•°ä¸­çš„å¾ªç¯æ¬¡æ•°æé«˜åˆ°65537</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWrongWrite03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String fileName = <span class="string">&quot;F:/testExcel/03-simpleWrite-03.xls&quot;</span>;</span><br><span class="line">    <span class="comment">// å¦‚æœè¿™é‡Œæƒ³ä½¿ç”¨03 åˆ™ ä¼ å…¥excelTypeå‚æ•°å³å¯</span></span><br><span class="line">    EasyExcel.write(fileName, ExcelEmpData.class).excelType(ExcelTypeEnum.XLS).sheet(<span class="string">&quot;æ¨¡æ¿&quot;</span>).doWrite(getEmpData());</span><br><span class="line">    System.out.println(<span class="string">&quot;excelå†™å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210000144.png" alt="image-20210210000144286"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210000202.png" alt="image-20210210000202523"></p><h3 id="3ã€æŒ‡å®šeasyExcelçš„å†™å…¥åˆ—"><a href="#3ã€æŒ‡å®šeasyExcelçš„å†™å…¥åˆ—" class="headerlink" title="3ã€æŒ‡å®šeasyExcelçš„å†™å…¥åˆ—"></a>3ã€æŒ‡å®šeasyExcelçš„å†™å…¥åˆ—</h3><blockquote><p>ä¸ºå®ä½“ç±»ä¸­çš„å­—æ®µé…ç½®indexå±æ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelEmpData</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;å§“å&quot;,index = 1)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;ç”Ÿæ—¥&quot;,index = 3)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;è–ªèµ„&quot;,index = 5)</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨<span class="doctag">@ExcelIgnore</span>æ³¨è§£æ¥ä½¿EasyExcelå¿½ç•¥è¿™ä¸ªå±æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‡æ–°æ‰§è¡Œæµ‹è¯•æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWrite07</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ•°æ®å†™å…¥åˆ°å“ªä¸ªexcelæ–‡ä»¶</span></span><br><span class="line">    String fileName = <span class="string">&quot;F:/testExcel/04-simpleWrite-07.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ éœ€è¦æŒ‡å®šå†™ç”¨å“ªä¸ªclasså»å†™ï¼Œç„¶åå†™åˆ°ç¬¬ä¸€ä¸ªsheetï¼Œåå­—ä¸ºæ¨¡æ¿ ç„¶åæ–‡ä»¶æµä¼šè‡ªåŠ¨å…³é—­</span></span><br><span class="line">    EasyExcel.write(fileName, ExcelEmpData.class).sheet(<span class="string">&quot;æ¨¡æ¿&quot;</span>).doWrite(getEmpData());</span><br><span class="line">    System.out.println(<span class="string">&quot;excelå†™å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210000729.png" alt="image-20210210000729446"></p><h3 id="4ã€æŒ‡å®šå±æ€§çš„æ ¼å¼åŒ–"><a href="#4ã€æŒ‡å®šå±æ€§çš„æ ¼å¼åŒ–" class="headerlink" title="4ã€æŒ‡å®šå±æ€§çš„æ ¼å¼åŒ–"></a>4ã€æŒ‡å®šå±æ€§çš„æ ¼å¼åŒ–</h3><blockquote><p>æ ¹æ®å®ä½“ç±»å±æ€§çš„ç±»å‹ä¸ºå±æ€§æ·»åŠ ä¸åŒçš„æ ¼å¼åŒ–æ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelEmpData</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;å§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DateTimeFormat(&quot;yyyyå¹´MMæœˆddæ—¥HHæ—¶mmåˆ†ssç§’&quot;)</span></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;ç”Ÿæ—¥&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NumberFormat(&quot;#.##%&quot;)</span><span class="comment">//ç™¾åˆ†æ¯”è¡¨ç¤ºï¼Œä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;è–ªèµ„&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨<span class="doctag">@ExcelIgnore</span>æ³¨è§£æ¥ä½¿EasyExcelå¿½ç•¥è¿™ä¸ªå±æ€§</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é‡æ–°æ‰§è¡Œæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWrite07</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ•°æ®å†™å…¥åˆ°å“ªä¸ªexcelæ–‡ä»¶</span></span><br><span class="line">    String fileName = <span class="string">&quot;F:/testExcel/05-simpleWrite-07.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ éœ€è¦æŒ‡å®šå†™ç”¨å“ªä¸ªclasså»å†™ï¼Œç„¶åå†™åˆ°ç¬¬ä¸€ä¸ªsheetï¼Œåå­—ä¸ºæ¨¡æ¿ ç„¶åæ–‡ä»¶æµä¼šè‡ªåŠ¨å…³é—­</span></span><br><span class="line">    EasyExcel.write(fileName, ExcelEmpData.class).sheet(<span class="string">&quot;æ¨¡æ¿&quot;</span>).doWrite(getEmpData());</span><br><span class="line">    System.out.println(<span class="string">&quot;excelå†™å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210001029.png" alt="image-20210210001029235"></p><h3 id="5ã€xlsxå’Œxlsçš„åŒºåˆ«"><a href="#5ã€xlsxå’Œxlsçš„åŒºåˆ«" class="headerlink" title="5ã€xlsxå’Œxlsçš„åŒºåˆ«"></a>5ã€xlsxå’Œxlsçš„åŒºåˆ«</h3><blockquote><p>å­˜å‚¨ç›¸åŒæ•°é‡çš„æ•°æ®ï¼Œç”¨xlsxå ç”¨çš„ç©ºé—´è¾ƒå°</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210001155.png" alt="image-20210210001155925"></p><blockquote><p>xlsä¸€æ¬¡æ€§æœ€å¤šå†™å…¥65536æ¡æ•°æ®</p></blockquote><h2 id="1-4ã€ä½¿ç”¨EasyExcelè¯»å–æ–‡ä»¶"><a href="#1-4ã€ä½¿ç”¨EasyExcelè¯»å–æ–‡ä»¶" class="headerlink" title="1.4ã€ä½¿ç”¨EasyExcelè¯»å–æ–‡ä»¶"></a>1.4ã€ä½¿ç”¨EasyExcelè¯»å–æ–‡ä»¶</h2><blockquote><p>å‚è€ƒåœ°å€ï¼š<a href="https://www.yuque.com/easyexcel/doc/read">https://www.yuque.com/easyexcel/doc/read</a></p></blockquote><h3 id="1ã€åˆ›å»ºç›‘å¬å™¨"><a href="#1ã€åˆ›å»ºç›‘å¬å™¨" class="headerlink" title="1ã€åˆ›å»ºç›‘å¬å™¨"></a>1ã€åˆ›å»ºç›‘å¬å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelEmpDataListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">ExcelEmpData</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯éš”5æ¡å­˜å‚¨æ•°æ®åº“ï¼Œå®é™…ä½¿ç”¨ä¸­å¯ä»¥3000æ¡ï¼Œç„¶åæ¸…ç†list ï¼Œæ–¹ä¾¿å†…å­˜å›æ”¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> BATCH_COUNT = <span class="number">5</span>;</span><br><span class="line">    List&lt;ExcelEmpData&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ¯ä¸€æ¡æ•°æ®è§£æéƒ½ä¼šæ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     *            one row value. Is is same as &#123;<span class="doctag">@link</span> AnalysisContext#readRowHolder()&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(ExcelEmpData data, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è§£æåˆ°ä¸€æ¡æ•°æ®:&#123;&#125;&quot;</span>, data);</span><br><span class="line">        list.add(data);</span><br><span class="line">        <span class="comment">// è¾¾åˆ°BATCH_COUNTäº†ï¼Œéœ€è¦å»å­˜å‚¨ä¸€æ¬¡æ•°æ®åº“ï¼Œé˜²æ­¢æ•°æ®å‡ ä¸‡æ¡æ•°æ®åœ¨å†…å­˜ï¼Œå®¹æ˜“OOM</span></span><br><span class="line">        <span class="keyword">if</span> (list.size() &gt;= BATCH_COUNT) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;å­˜æ•°æ®åº“&quot;</span>);</span><br><span class="line">            <span class="comment">// å­˜å‚¨å®Œæˆæ¸…ç† list</span></span><br><span class="line">            list.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰€æœ‰æ•°æ®è§£æå®Œæˆäº† éƒ½ä¼šæ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;æ‰€æœ‰æ•°æ®è§£æå®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€æµ‹è¯•"><a href="#2ã€æµ‹è¯•" class="headerlink" title="2ã€æµ‹è¯•"></a>2ã€æµ‹è¯•</h3><blockquote><p>åˆ›å»ºtestRead.xlsxæ–‡ä»¶ï¼Œæ·»åŠ æµ‹è¯•æ•°æ®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210002105.png" alt="image-20210210002105220"></p><blockquote><p>åˆ›å»ºæµ‹è¯•æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœ€ç®€å•çš„è¯»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simpleRead07</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String fileName = <span class="string">&quot;F:/testExcel/testRead.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œé»˜è®¤è¯»å–ç¬¬ä¸€ä¸ªsheet</span></span><br><span class="line">    EasyExcel.read(fileName, ExcelEmpData.class, <span class="keyword">new</span> ExcelEmpDataListener()).sheet().doRead();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simpleRead03</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String fileName = <span class="string">&quot;F:/testExcel/testRead.xls&quot;</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œé»˜è®¤è¯»å–ç¬¬ä¸€ä¸ªsheet</span></span><br><span class="line">    EasyExcel.read(fileName, ExcelEmpData.class, <span class="keyword">new</span> ExcelEmpDataListener()).excelType(ExcelTypeEnum.XLS).sheet().doRead();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210002620.png" alt="image-20210210002619823"></p><h1 id="äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆEasyExcel"><a href="#äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆEasyExcel" class="headerlink" title="äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆEasyExcel"></a>äºŒã€åœ¨çº¿æ•™è‚²é¡¹ç›®æ•´åˆEasyExcel</h1><blockquote><p>åœ¨åœ¨çº¿æ•™è‚²é¡¹ç›®çš„è¯¾ç¨‹åˆ†ç±»ç®¡ç†ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ¥æ”¶ç®¡ç†å‘˜ä»å‰ç«¯ä¼ è¿‡æ¥çš„è¯¾ç¨‹åˆ†ç±»excelï¼Œåœ¨è§£æåå°†excelä¸­çš„æ•°æ®å­˜å…¥è¯¾ç¨‹åˆ†ç±»è¡¨</p></blockquote><h2 id="2-1ã€æ·»åŠ ä¾èµ–"><a href="#2-1ã€æ·»åŠ ä¾èµ–" class="headerlink" title="2.1ã€æ·»åŠ ä¾èµ–"></a>2.1ã€æ·»åŠ ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.xmlbeans<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xmlbeans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-2ã€åˆ›å»ºä¸Excelå¯¹åº”çš„å®ä½“ç±»"><a href="#2-2ã€åˆ›å»ºä¸Excelå¯¹åº”çš„å®ä½“ç±»" class="headerlink" title="2.2ã€åˆ›å»ºä¸Excelå¯¹åº”çš„å®ä½“ç±»"></a>2.2ã€åˆ›å»ºä¸Excelå¯¹åº”çš„å®ä½“ç±»</h2><blockquote><p>excelæ¨¡æ¿æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210003102.png" alt="image-20210210003102353"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelSubjectData</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;ä¸€çº§åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String levelOneTitle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;äºŒçº§åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String levelTwoTitle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-3ã€å®ç°Excelå¯¼å…¥"><a href="#2-3ã€å®ç°Excelå¯¼å…¥" class="headerlink" title="2.3ã€å®ç°Excelå¯¼å…¥"></a>2.3ã€å®ç°Excelå¯¼å…¥</h2><h3 id="1ã€åˆ›å»ºç›‘å¬å™¨-1"><a href="#1ã€åˆ›å»ºç›‘å¬å™¨-1" class="headerlink" title="1ã€åˆ›å»ºç›‘å¬å™¨"></a>1ã€åˆ›å»ºç›‘å¬å™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">//å…¨å‚</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">//æ— å‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelSubjectDataListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">ExcelSubjectData</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡è®¾è¿™ä¸ªæ˜¯ä¸€ä¸ªDAOï¼Œå½“ç„¶æœ‰ä¸šåŠ¡é€»è¾‘è¿™ä¸ªä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªserviceã€‚å½“ç„¶å¦‚æœä¸ç”¨å­˜å‚¨è¿™ä¸ªå¯¹è±¡æ²¡ç”¨ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> SubjectMapper subjectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *éå†æ¯ä¸€è¡Œçš„è®°å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(ExcelSubjectData data, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è§£æåˆ°ä¸€æ¡è®°å½•: &#123;&#125;&quot;</span>, data);</span><br><span class="line">        <span class="comment">//å¤„ç†è¯»å–å‡ºæ¥çš„æ•°æ®</span></span><br><span class="line">        String levelOneTitle = data.getLevelOneTitle();<span class="comment">//ä¸€çº§æ ‡é¢˜</span></span><br><span class="line">        String levelTwoTitle = data.getLevelTwoTitle();<span class="comment">//äºŒçº§æ ‡é¢˜</span></span><br><span class="line">        log.info(<span class="string">&quot;levelOneTitle: &#123;&#125;&quot;</span>, levelOneTitle);</span><br><span class="line">        log.info(<span class="string">&quot;levelTwoTitle: &#123;&#125;&quot;</span>, levelTwoTitle);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»„è£…æ•°æ®ï¼šSubject</span></span><br><span class="line">        <span class="comment">// å­˜å…¥æ•°æ®åº“ï¼šsubjectMapper.insert()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰€æœ‰æ•°æ®è§£æå®Œæˆäº† éƒ½ä¼šæ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;æ‰€æœ‰æ•°æ®è§£æå®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ç›‘å¬å™¨ä¸­æ·»åŠ è¾…åŠ©æ–¹æ³•"><a href="#2ã€ç›‘å¬å™¨ä¸­æ·»åŠ è¾…åŠ©æ–¹æ³•" class="headerlink" title="2ã€ç›‘å¬å™¨ä¸­æ·»åŠ è¾…åŠ©æ–¹æ³•"></a>2ã€ç›‘å¬å™¨ä¸­æ·»åŠ è¾…åŠ©æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»åç§°æŸ¥è¯¢è¿™ä¸ªä¸€çº§åˆ†ç±»æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Subject <span class="title">getByTitle</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;Subject&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;title&quot;</span>, title);</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;parent_id&quot;</span>, <span class="string">&quot;0&quot;</span>);<span class="comment">//ä¸€çº§åˆ†ç±»</span></span><br><span class="line">    <span class="keyword">return</span> subjectMappter.selectOne(queryWrapper);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åˆ†ç±»åç§°å’Œçˆ¶idæŸ¥è¯¢è¿™ä¸ªäºŒçº§åˆ†ç±»æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Subject <span class="title">getSubByTitle</span><span class="params">(String title, String parentId)</span> </span>&#123;</span><br><span class="line">    QueryWrapper&lt;Subject&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;title&quot;</span>, title);</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;parent_id&quot;</span>, parentId);</span><br><span class="line">    <span class="keyword">return</span> subjectMappter.selectOne(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€å®Œå–„invokeæ–¹æ³•"><a href="#3ã€å®Œå–„invokeæ–¹æ³•" class="headerlink" title="3ã€å®Œå–„invokeæ–¹æ³•"></a>3ã€å®Œå–„invokeæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ¯ä¸€æ¡æ•°æ®è§£æéƒ½ä¼šæ¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(ExcelSubjectData data, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;è§£æåˆ°ä¸€æ¡æ•°æ®:&#123;&#125;&quot;</span>, data);</span><br><span class="line">    <span class="comment">//å¤„ç†è¯»å–è¿›æ¥çš„æ•°æ®</span></span><br><span class="line">    String titleLevelOne = data.getLevelOneTitle();</span><br><span class="line">    String titleLevelTwo = data.getLevelTwoTitle();</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ä¸€çº§åˆ†ç±»æ˜¯å¦é‡å¤</span></span><br><span class="line">    Subject subjectLevelOne = <span class="keyword">this</span>.getByTitle(titleLevelOne);</span><br><span class="line">    String parentId = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(subjectLevelOne == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//å°†ä¸€çº§åˆ†ç±»å­˜å…¥æ•°æ®åº“</span></span><br><span class="line">        Subject subject = <span class="keyword">new</span> Subject();</span><br><span class="line">        subject.setParentId(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">        subject.setTitle(titleLevelOne);<span class="comment">//ä¸€çº§åˆ†ç±»åç§°</span></span><br><span class="line">        subjectMappter.insert(subject);</span><br><span class="line">        parentId = subject.getId();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        parentId = subjectLevelOne.getId();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­äºŒçº§åˆ†ç±»æ˜¯å¦é‡å¤</span></span><br><span class="line">    Subject subjectLevelTwo = <span class="keyword">this</span>.getSubByTitle(titleLevelTwo, parentId);</span><br><span class="line">    <span class="keyword">if</span>(subjectLevelTwo == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">//å°†äºŒçº§åˆ†ç±»å­˜å…¥æ•°æ®åº“</span></span><br><span class="line">        Subject subject = <span class="keyword">new</span> Subject();</span><br><span class="line">        subject.setTitle(titleLevelTwo);</span><br><span class="line">        subject.setParentId(parentId);</span><br><span class="line">        subjectMappter.insert(subject);<span class="comment">//æ·»åŠ </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€SubjectService"><a href="#4ã€SubjectService" class="headerlink" title="4ã€SubjectService"></a><strong>4ã€SubjectService</strong></h3><p>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">batchImport</span><span class="params">(InputStream inputStream)</span></span>;</span><br></pre></td></tr></table></figure><p>å®ç°ï¼šè·å–Excelè®°å½•å¹¶é€æ¡å¯¼å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchImport</span><span class="params">(InputStream inputStream)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œ éœ€è¦æŒ‡å®šè¯»ç”¨å“ªä¸ªclasså»è¯»ï¼Œç„¶åè¯»å–ç¬¬ä¸€ä¸ªsheet æ–‡ä»¶æµä¼šè‡ªåŠ¨å…³é—­</span></span><br><span class="line">    EasyExcel.read(inputStream, ExcelSubjectData.class, <span class="keyword">new</span> ExcelSubjectDataListener(baseMapper))</span><br><span class="line">        .excelType(ExcelTypeEnum.XLS).sheet().doRead();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€Controller"><a href="#5ã€Controller" class="headerlink" title="5ã€Controller"></a>5ã€Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;è¯¾ç¨‹åˆ†ç±»ç®¡ç†&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/edu/subject&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubjectController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SubjectService subjectService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;import&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;Excelæ‰¹é‡å¯¼å…¥è¯¾ç¨‹åˆ†ç±»&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">batchImport</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@ApiParam(value = &quot;Excelæ–‡ä»¶&quot;,required = true)</span></span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨serviceå±‚çš„æ‰¹é‡å¯¼å…¥æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            subjectService.batchImport(file.getInputStream());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//æ‰“å°æ—¥å¿—</span></span><br><span class="line">            log.error(ExceptionUtils.getMessage(e));</span><br><span class="line">            <span class="comment">//æŠ›å‡ºä¸€ä¸ªExcelå¯¼å…¥å¤±è´¥å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.EXCEL_DATA_IMPORT_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">&quot;æ‰¹é‡å¯¼å…¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;nested&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;åµŒå¥—åˆ†ç±»æ•°æ®åˆ—è¡¨&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">nestedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è¿”å›åˆ†ç±»VOåˆ—è¡¨</span></span><br><span class="line">        List&lt;SubjectVo&gt; subjectVoList = subjectService.nestedList();</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;items&quot;</span>,subjectVoList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€ä½¿ç”¨swaggerè¿›è¡Œæµ‹è¯•"><a href="#6ã€ä½¿ç”¨swaggerè¿›è¡Œæµ‹è¯•" class="headerlink" title="6ã€ä½¿ç”¨swaggerè¿›è¡Œæµ‹è¯•"></a>6ã€ä½¿ç”¨swaggerè¿›è¡Œæµ‹è¯•</h3><blockquote><p>åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¯¾ç¨‹åˆ†ç±»</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210003822.png" alt="image-20210210003821966"></p><blockquote><p>æ‰“å¼€swaggerï¼Œé€‰æ‹©æ–‡ä»¶è¿›è¡Œä¸Šä¼ </p></blockquote><ul><li>swaggeré¡µé¢</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210004001.png" alt="image-20210210004001328"></p><ul><li>è¦ä¸Šä¼ çš„æ–‡ä»¶</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210003944.png" alt="image-20210210003944206"></p><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210004050.png" alt="image-20210210004050124"></p><ul><li>æ•°æ®åº“</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210004116.png" alt="image-20210210004116897"></p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> âœ¨EasyExcel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäºŒï¼‰-ç”¨æˆ·è®¤è¯</title>
      <link href="posts/650479038.html"/>
      <url>posts/650479038.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•"><a href="#ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•" class="headerlink" title="ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•"></a>ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•</h1><h2 id="1-1-ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ" class="headerlink" title="1.1.ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ"></a>1.1.ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ</h2><blockquote><p>æœ‰çŠ¶æ€æœåŠ¡ï¼Œå³æœåŠ¡ç«¯éœ€è¦è®°å½•æ¯æ¬¡ä¼šè¯çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä»è€Œè¯†åˆ«å®¢æˆ·ç«¯èº«ä»½ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½è¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œå…¸å‹çš„è®¾è®¡å¦‚tomcatä¸­çš„sessionã€‚</p><p>ä¾‹å¦‚ç™»å½•ï¼šç”¨æˆ·ç™»å½•åï¼Œæˆ‘ä»¬æŠŠç™»å½•è€…çš„ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡ç«¯sessionä¸­ï¼Œå¹¶ä¸”ç»™ç”¨æˆ·ä¸€ä¸ªcookieå€¼ï¼Œè®°å½•å¯¹åº”çš„sessionã€‚ç„¶åä¸‹æ¬¡è¯·æ±‚ï¼Œç”¨æˆ·æºå¸¦cookieå€¼æ¥ï¼Œæˆ‘ä»¬å°±èƒ½è¯†åˆ«åˆ°å¯¹åº”sessionï¼Œä»è€Œæ‰¾åˆ°ç”¨æˆ·çš„ä¿¡æ¯ã€‚</p></blockquote><p>ç¼ºç‚¹ï¼š</p><ul><li>æœåŠ¡ç«¯ä¿å­˜å¤§é‡æ•°æ®ï¼Œå¢åŠ æœåŠ¡ç«¯å‹åŠ›</li><li>æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œæ°´å¹³æ‰©å±•</li><li>å®¢æˆ·ç«¯è¯·æ±‚ä¾èµ–æœåŠ¡ç«¯ï¼Œå¤šæ¬¡è¯·æ±‚å¿…é¡»è®¿é—®åŒä¸€å°æœåŠ¡å™¨</li></ul><h2 id="1-2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ"><a href="#1-2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ" class="headerlink" title="1.2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ"></a>1.2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ</h2><blockquote><p>æœåŠ¡å™¨ä¸ä¿å­˜ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼</p><p>å¾®æœåŠ¡é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡ï¼Œå¯¹å¤–æä¾›çš„éƒ½æ˜¯Resté£æ ¼çš„æ¥å£ã€‚è€ŒResté£æ ¼çš„ä¸€ä¸ªæœ€é‡è¦çš„è§„èŒƒå°±æ˜¯ï¼šæœåŠ¡çš„æ— çŠ¶æ€æ€§ï¼Œå³ï¼š</p><ul><li><strong>æœåŠ¡ç«¯ä¸ä¿å­˜ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚è€…ä¿¡æ¯</strong></li><li>å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å¿…é¡»å…·å¤‡è‡ªæè¿°ä¿¡æ¯ï¼ˆjwtï¼‰ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯è¯†åˆ«å®¢æˆ·ç«¯èº«ä»½</li></ul></blockquote><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ— çŠ¶æ€ï¼š tokenæ˜¯æ— çŠ¶æ€ï¼Œsessionæ˜¯æœ‰çŠ¶æ€çš„</li><li>åŸºäºæ ‡å‡†åŒ–ï¼šä½ çš„APIå¯ä»¥é‡‡ç”¨æ ‡å‡†åŒ–çš„ JSON Web Token (JWT)</li><li>å®¢æˆ·ç«¯è¯·æ±‚ä¸ä¾èµ–æœåŠ¡ç«¯çš„ä¿¡æ¯ï¼Œä»»ä½•å¤šæ¬¡è¯·æ±‚ä¸éœ€è¦å¿…é¡»è®¿é—®åˆ°åŒä¸€å°æœåŠ¡</li><li>æœåŠ¡ç«¯çš„é›†ç¾¤å’ŒçŠ¶æ€å¯¹å®¢æˆ·ç«¯é€æ˜</li><li>æœåŠ¡ç«¯å¯ä»¥ä»»æ„çš„è¿ç§»å’Œä¼¸ç¼©</li><li>å‡å°æœåŠ¡ç«¯å­˜å‚¨å‹åŠ›</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å ç”¨å¸¦å®½</li><li>æ— æ³•åœ¨æœåŠ¡å™¨ç«¯é”€æ¯</li></ul><h1 id="äºŒã€å¸¸è§ç™»å½•æ–¹å¼"><a href="#äºŒã€å¸¸è§ç™»å½•æ–¹å¼" class="headerlink" title="äºŒã€å¸¸è§ç™»å½•æ–¹å¼"></a>äºŒã€å¸¸è§ç™»å½•æ–¹å¼</h1><h2 id="2-1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼"><a href="#2-1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼" class="headerlink" title="2.1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼"></a>2.1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205210527.png" alt="image-20210205210527360"></p><p><strong>ä¸€èˆ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š</strong></p><ol><li>ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li>éªŒè¯æœåŠ¡å™¨åï¼Œç›¸å…³æ•°æ®ï¼ˆå¦‚ç”¨æˆ·åï¼Œç”¨æˆ·è§’è‰²ç­‰ï¼‰å°†ä¿å­˜åœ¨å½“å‰ä¼šè¯ï¼ˆsessionï¼‰ä¸­ã€‚</li><li>æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›session_idï¼Œsessionä¿¡æ¯éƒ½ä¼šå†™å…¥åˆ°ç”¨æˆ·çš„Cookieã€‚</li><li>ç”¨æˆ·çš„æ¯ä¸ªåç»­è¯·æ±‚éƒ½å°†é€šè¿‡åœ¨Cookieä¸­å–å‡ºsession_idä¼ ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°session_idå¹¶å¯¹æ¯”ä¹‹å‰ä¿å­˜çš„æ•°æ®ï¼Œç¡®è®¤ç”¨æˆ·çš„èº«ä»½ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å•ç‚¹æ€§èƒ½å‹åŠ›ï¼Œæ— æ³•æ‰©å±•ã€‚</li><li>åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œéœ€è¦sessionå…±äº«æ–¹æ¡ˆï¼Œsessionå…±äº«æ–¹æ¡ˆå­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚</li></ul><h2 id="2-2ã€å•ç‚¹ç™»å½•ï¼ˆSingle-Sign-Onï¼‰"><a href="#2-2ã€å•ç‚¹ç™»å½•ï¼ˆSingle-Sign-Onï¼‰" class="headerlink" title="2.2ã€å•ç‚¹ç™»å½•ï¼ˆSingle  Sign  Onï¼‰"></a>2.2ã€å•ç‚¹ç™»å½•ï¼ˆSingle  Sign  Onï¼‰</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205210648.png" alt="image-20210205210648124"></p><p>åˆ†å¸ƒå¼ï¼ŒSSO(single sign on)æ¨¡å¼ï¼šå•ç‚¹ç™»å½•è‹±æ–‡å…¨ç§°Single Sign Onï¼Œç®€ç§°å°±æ˜¯SSOã€‚å®ƒçš„è§£é‡Šæ˜¯ï¼šåœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œåªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±å¯ä»¥è®¿é—®å…¶ä»–ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚</p><ul><li>å¦‚å›¾æ‰€ç¤ºï¼Œå›¾ä¸­æœ‰3ä¸ªç³»ç»Ÿï¼Œåˆ†åˆ«æ˜¯ä¸šåŠ¡Aã€ä¸šåŠ¡Bã€å’ŒSSOã€‚</li><li>ä¸šåŠ¡Aã€ä¸šåŠ¡Bæ²¡æœ‰ç™»å½•æ¨¡å—ã€‚</li><li>è€ŒSSOåªæœ‰ç™»å½•æ¨¡å—ï¼Œæ²¡æœ‰å…¶ä»–çš„ä¸šåŠ¡æ¨¡å—ã€‚</li></ul><p><strong>ä¸€èˆ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š</strong></p><ol><li>å½“ä¸šåŠ¡Aã€ä¸šåŠ¡Béœ€è¦ç™»å½•æ—¶ï¼Œå°†è·³åˆ°SSOç³»ç»Ÿã€‚</li><li>SSOä»ç”¨æˆ·ä¿¡æ¯æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯å¹¶æ ¡éªŒç”¨æˆ·ä¿¡æ¯ï¼ŒSSOç³»ç»Ÿå®Œæˆç™»å½•ã€‚</li><li>ç„¶åå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ç¼“å­˜ï¼ˆä¾‹å¦‚redisï¼‰ã€‚</li><li>å½“ç”¨æˆ·è®¿é—®ä¸šåŠ¡Aæˆ–ä¸šåŠ¡Bï¼Œéœ€è¦åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•æ—¶ï¼Œå°†è·³è½¬åˆ°SSOç³»ç»Ÿä¸­è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ï¼ŒSSOåˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚</li><li>è¿™æ ·ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªç³»ç»Ÿå®Œæˆç™»å½•ï¼Œå…¶ä»–çš„åº”ç”¨ç³»ç»Ÿä¹Ÿå°±éšä¹‹ç™»å½•äº†ã€‚è¿™å°±æ˜¯å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰çš„å®šä¹‰ã€‚</li></ol><p><strong>ä¼˜ç‚¹ ï¼š</strong>  </p><p>ç”¨æˆ·èº«ä»½ä¿¡æ¯ç‹¬ç«‹ç®¡ç†ï¼Œæ›´å¥½çš„åˆ†å¸ƒå¼ç®¡ç†ã€‚å¯ä»¥è‡ªå·±æ‰©å±•å®‰å…¨ç­–ç•¥</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>è®¤è¯æœåŠ¡å™¨è®¿é—®å‹åŠ›è¾ƒå¤§ã€‚</p><h2 id="2-3ã€Tokenæ¨¡å¼"><a href="#2-3ã€Tokenæ¨¡å¼" class="headerlink" title="2.3ã€Tokenæ¨¡å¼"></a>2.3ã€Tokenæ¨¡å¼</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205210734.png" alt="image-20210205210734269"></p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ— çŠ¶æ€ï¼š tokenæ˜¯æ— çŠ¶æ€ï¼Œsessionæ˜¯æœ‰çŠ¶æ€çš„</li><li>åŸºäºæ ‡å‡†åŒ–ï¼šä½ çš„APIå¯ä»¥é‡‡ç”¨æ ‡å‡†åŒ–çš„ JSON Web Token (JWT)</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å ç”¨å¸¦å®½</li><li>æ— æ³•åœ¨æœåŠ¡å™¨ç«¯é”€æ¯</li></ul><blockquote><p>æ— çŠ¶æ€ç™»å½•çš„æµç¨‹ï¼š</p></blockquote><ul><li>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯å¯¹ç”¨æˆ·è¿›è¡Œä¿¡æ¯è®¤è¯ï¼ˆç™»å½•ï¼‰</li><li>è®¤è¯é€šè¿‡ï¼Œå°†ç”¨æˆ·ä¿¡æ¯è¿›è¡ŒåŠ å¯†å½¢æˆtokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä½œä¸ºç™»å½•å‡­è¯</li><li>ä»¥åæ¯æ¬¡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯éƒ½æºå¸¦è®¤è¯çš„token</li><li>æœåŠ¡çš„å¯¹tokenè¿›è¡Œè§£å¯†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆã€‚</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205211358.png" alt="image-20210205211358667"></p><p>æ•´ä¸ªç™»å½•è¿‡ç¨‹ä¸­ï¼Œæœ€å…³é”®çš„ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><strong>tokençš„å®‰å…¨æ€§</strong></p><h1 id="ä¸‰ã€JWT"><a href="#ä¸‰ã€JWT" class="headerlink" title="ä¸‰ã€JWT"></a>ä¸‰ã€JWT</h1><h2 id="3-1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ"><a href="#3-1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ" class="headerlink" title="3.1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ"></a>3.1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ</h2><blockquote><p>JWTæ˜¯JSON Web Tokençš„ç¼©å†™ï¼Œå³JSON Webä»¤ç‰Œï¼Œæ˜¯ä¸€ç§è‡ªåŒ…å«ä»¤ç‰Œã€‚ </p></blockquote><h3 id="1ã€ä½¿ç”¨åœºæ™¯"><a href="#1ã€ä½¿ç”¨åœºæ™¯" class="headerlink" title="1ã€ä½¿ç”¨åœºæ™¯"></a>1ã€ä½¿ç”¨åœºæ™¯</h3><ul><li>ä¸€ç§æƒ…å†µæ˜¯webapiï¼Œç±»ä¼¼é˜¿é‡Œäº‘æ’­æ”¾å‡­è¯çš„åŠŸèƒ½ã€‚</li><li>å¦ä¸€ç§æƒ…å†µæ˜¯å¤šwebæœåŠ¡å™¨ä¸‹å®ç°æ— çŠ¶æ€åˆ†å¸ƒå¼èº«ä»½éªŒè¯ã€‚</li></ul><h3 id="2ã€äº¤äº’æµç¨‹"><a href="#2ã€äº¤äº’æµç¨‹" class="headerlink" title="2ã€äº¤äº’æµç¨‹"></a>2ã€äº¤äº’æµç¨‹</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205211838.png" alt="image-20210205211838506"></p><p>æ­¥éª¤ç¿»è¯‘ï¼š</p><ul><li>1ã€ç”¨æˆ·ç™»å½•</li><li>2ã€æœåŠ¡çš„è®¤è¯ï¼Œé€šè¿‡åæ ¹æ®secretç”Ÿæˆtoken</li><li>3ã€å°†ç”Ÿæˆçš„tokenè¿”å›ç»™æµè§ˆå™¨</li><li>4ã€ç”¨æˆ·æ¯æ¬¡è¯·æ±‚æºå¸¦token</li><li>5ã€æœåŠ¡ç«¯åˆ©ç”¨å…¬é’¥è§£è¯»jwtç­¾åï¼Œåˆ¤æ–­ç­¾åæœ‰æ•ˆåï¼Œä»Payloadä¸­è·å–ç”¨æˆ·ä¿¡æ¯</li><li>6ã€å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ç»“æœ</li></ul><p>å› ä¸ºJWTç­¾å‘çš„tokenä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦ï¼Œè¿™æ ·æœåŠ¡çš„å°±æ— éœ€ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œç”šè‡³æ— éœ€å»æ•°æ®åº“æŸ¥è¯¢ï¼Œå®Œå…¨ç¬¦åˆäº†Restçš„æ— çŠ¶æ€è§„èŒƒã€‚</p><h3 id="3ã€ä½œç”¨"><a href="#3ã€ä½œç”¨" class="headerlink" title="3ã€ä½œç”¨"></a>3ã€ä½œç”¨</h3><blockquote><p>JWT æœ€é‡è¦çš„ä½œç”¨å°±æ˜¯å¯¹ tokenä¿¡æ¯çš„é˜²ä¼ªä½œç”¨</p></blockquote><h3 id="4ã€åŸç†"><a href="#4ã€åŸç†" class="headerlink" title="4ã€åŸç†"></a>4ã€åŸç†</h3><ul><li>ä¸€ä¸ªJWTç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šJWTå¤´ã€æœ‰æ•ˆè½½è·ã€ç­¾åå“ˆå¸Œ</li><li>æœ€åç”±è¿™ä¸‰è€…ç»„åˆè¿›è¡Œbase64ç¼–ç å¾—åˆ°JWT</li></ul><h2 id="3-2ã€JWTä»¤ç‰Œçš„ç»„æˆ"><a href="#3-2ã€JWTä»¤ç‰Œçš„ç»„æˆ" class="headerlink" title="3.2ã€JWTä»¤ç‰Œçš„ç»„æˆ"></a>3.2ã€JWTä»¤ç‰Œçš„ç»„æˆ</h2><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205212928.png" alt="image-20210205212928770"></p><p><strong>JWTå¤´</strong></p><p>JWTå¤´éƒ¨åˆ†æ˜¯ä¸€ä¸ªæè¿°JWTå…ƒæ•°æ®çš„JSONå¯¹è±¡ï¼Œé€šå¸¸å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œalgå±æ€§è¡¨ç¤ºç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºHMAC SHA256ï¼ˆå†™ä¸ºHS256ï¼‰ï¼›typå±æ€§è¡¨ç¤ºä»¤ç‰Œçš„ç±»å‹ï¼ŒJWTä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚æœ€åï¼Œä½¿ç”¨Base64 URLç®—æ³•å°†ä¸Šè¿°JSONå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¿å­˜ã€‚</p><p><strong>æœ‰æ•ˆè½½è·</strong></p><p>æœ‰æ•ˆè½½è·éƒ¨åˆ†ï¼Œæ˜¯JWTçš„ä¸»ä½“å†…å®¹éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼ŒåŒ…å«éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚ JWTæŒ‡å®šä¸ƒä¸ªé»˜è®¤å­—æ®µä¾›é€‰æ‹©ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iss: jwtç­¾å‘è€…</span><br><span class="line">sub: ä¸»é¢˜</span><br><span class="line">aud: æ¥æ”¶jwtçš„ä¸€æ–¹</span><br><span class="line">exp: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´</span><br><span class="line">nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.</span><br><span class="line">iat: jwtçš„ç­¾å‘æ—¶é—´</span><br><span class="line">jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚</span><br></pre></td></tr></table></figure><p>é™¤ä»¥ä¸Šé»˜è®¤å­—æ®µå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç§æœ‰å­—æ®µï¼Œå¦‚ä¸‹ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;Helen&quot;,</span><br><span class="line">  &quot;admin&quot;: true,</span><br><span class="line">  &quot;avatar&quot;: &quot;helen.jpg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹JWTæ˜¯æœªåŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è§£è¯»å…¶å†…å®¹ï¼Œå› æ­¤ä¸è¦æ„å»ºéšç§ä¿¡æ¯å­—æ®µï¼Œå­˜æ”¾ä¿å¯†ä¿¡æ¯ï¼Œä»¥é˜²æ­¢ä¿¡æ¯æ³„éœ²ã€‚</p><p>JSONå¯¹è±¡ä¹Ÿä½¿ç”¨Base64 URLç®—æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¿å­˜ã€‚</p><p><strong>ç­¾åå“ˆå¸Œ</strong></p><p>ç­¾åå“ˆå¸Œéƒ¨åˆ†æ˜¯å¯¹ä¸Šé¢ä¸¤éƒ¨åˆ†æ•°æ®ç­¾åï¼Œé€šè¿‡æŒ‡å®šçš„ç®—æ³•ç”Ÿæˆå“ˆå¸Œï¼Œä»¥ç¡®ä¿æ•°æ®ä¸ä¼šè¢«ç¯¡æ”¹ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†ç ï¼ˆsecretï¼‰ã€‚è¯¥å¯†ç ä»…ä»…ä¸ºä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä¸”ä¸èƒ½å‘ç”¨æˆ·å…¬å¼€ã€‚ç„¶åï¼Œä½¿ç”¨æ ‡å¤´ä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸ºHMAC SHA256ï¼‰æ ¹æ®ä»¥ä¸‹å…¬å¼ç”Ÿæˆç­¾åã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(claims), secret)</span><br></pre></td></tr></table></figure><p>åœ¨è®¡ç®—å‡ºç­¾åå“ˆå¸Œåï¼ŒJWTå¤´ï¼Œæœ‰æ•ˆè½½è·å’Œç­¾åå“ˆå¸Œçš„ä¸‰ä¸ªéƒ¨åˆ†ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”¨â€.â€åˆ†éš”ï¼Œå°±æ„æˆæ•´ä¸ªJWTå¯¹è±¡ã€‚</p><p><strong>Base64URLç®—æ³•</strong></p><p>å¦‚å‰æ‰€è¿°ï¼ŒJWTå¤´å’Œæœ‰æ•ˆè½½è·åºåˆ—åŒ–çš„ç®—æ³•éƒ½ç”¨åˆ°äº†Base64URLã€‚è¯¥ç®—æ³•å’Œå¸¸è§Base64ç®—æ³•ç±»ä¼¼ï¼Œç¨æœ‰å·®åˆ«ã€‚</p><p>ä½œä¸ºä»¤ç‰Œçš„JWTå¯ä»¥æ”¾åœ¨URLä¸­ï¼ˆä¾‹å¦‚api.example/?token=xxxï¼‰ã€‚ Base64ä¸­ç”¨çš„ä¸‰ä¸ªå­—ç¬¦æ˜¯â€+â€ï¼Œâ€/â€œå’Œâ€=â€ï¼Œç”±äºåœ¨URLä¸­æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå› æ­¤Base64URLä¸­å¯¹ä»–ä»¬åšäº†æ›¿æ¢ï¼šâ€=â€å»æ‰ï¼Œâ€+â€ç”¨â€-â€œæ›¿æ¢ï¼Œâ€/â€œç”¨â€_â€æ›¿æ¢ï¼Œè¿™å°±æ˜¯Base64URLç®—æ³•ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>base64ç¼–ç ï¼Œå¹¶ä¸æ˜¯åŠ å¯†ï¼Œåªæ˜¯æŠŠæ˜æ–‡ä¿¡æ¯å˜æˆäº†ä¸å¯è§çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯å…¶å®åªè¦ç”¨ä¸€äº›å·¥å…·å°±å¯ä»¥æŠŠbase64ç¼–ç è§£æˆæ˜æ–‡ï¼Œæ‰€ä»¥ä¸è¦åœ¨JWTä¸­æ”¾å…¥æ¶‰åŠç§å¯†çš„ä¿¡æ¯ã€‚</p><h2 id="3-3ã€JWTçš„ç”¨æ³•"><a href="#3-3ã€JWTçš„ç”¨æ³•" class="headerlink" title="3.3ã€JWTçš„ç”¨æ³•"></a>3.3ã€JWTçš„ç”¨æ³•</h2><blockquote><p>å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡å™¨è¿”å›çš„JWTï¼Œå°†å…¶å­˜å‚¨åœ¨Cookieæˆ–localStorageä¸­ã€‚</p><p>æ­¤åï¼Œå®¢æˆ·ç«¯å°†åœ¨ä¸æœåŠ¡å™¨äº¤äº’ä¸­éƒ½ä¼šå¸¦JWTã€‚å¦‚æœå°†å®ƒå­˜å‚¨åœ¨Cookieä¸­ï¼Œå°±å¯ä»¥è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯ä¸ä¼šè·¨åŸŸï¼Œå› æ­¤ä¸€èˆ¬æ˜¯å°†å®ƒæ”¾å…¥HTTPè¯·æ±‚çš„Header Authorizationå­—æ®µä¸­ã€‚</p><p>å½“è·¨åŸŸæ—¶ï¼Œä¹Ÿå¯ä»¥å°†JWTæ”¾ç½®äºPOSTè¯·æ±‚çš„æ•°æ®ä¸»ä½“ä¸­ã€‚</p></blockquote><h2 id="3-4ã€é—®é¢˜å’Œè¶‹åŠ¿"><a href="#3-4ã€é—®é¢˜å’Œè¶‹åŠ¿" class="headerlink" title="3.4ã€é—®é¢˜å’Œè¶‹åŠ¿"></a>3.4ã€é—®é¢˜å’Œè¶‹åŠ¿</h2><p>1ã€JWTé»˜è®¤ä¸åŠ å¯†ï¼Œä½†å¯ä»¥åŠ å¯†ã€‚ç”ŸæˆåŸå§‹ä»¤ç‰Œåï¼Œå¯ä»¥ä½¿ç”¨è¯¥ä»¤ç‰Œå†æ¬¡å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚</p><p>2ã€å½“JWTæœªåŠ å¯†æ—¶ï¼Œä¸€äº›ç§å¯†æ•°æ®æ— æ³•é€šè¿‡JWTä¼ è¾“ã€‚</p><p>3ã€JWTä¸ä»…å¯ç”¨äºè®¤è¯ï¼Œè¿˜å¯ç”¨äºä¿¡æ¯äº¤æ¢ã€‚å–„ç”¨JWTæœ‰åŠ©äºå‡å°‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®åº“çš„æ¬¡æ•°ã€‚</p><p>4ã€JWTçš„æœ€å¤§ç¼ºç‚¹æ˜¯æœåŠ¡å™¨ä¸ä¿å­˜ä¼šè¯çŠ¶æ€ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æœŸé—´ä¸å¯èƒ½å–æ¶ˆä»¤ç‰Œæˆ–æ›´æ”¹ä»¤ç‰Œçš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦JWTç­¾å‘ï¼Œåœ¨æœ‰æ•ˆæœŸå†…å°†ä¼šä¸€ç›´æœ‰æ•ˆã€‚</p><p>5ã€JWTæœ¬èº«åŒ…å«è®¤è¯ä¿¡æ¯ï¼Œå› æ­¤ä¸€æ—¦ä¿¡æ¯æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWTçš„æœ‰æ•ˆæœŸä¸å®œè®¾ç½®å¤ªé•¿ã€‚å¯¹äºæŸäº›é‡è¦æ“ä½œï¼Œç”¨æˆ·åœ¨ä½¿ç”¨æ—¶åº”è¯¥æ¯æ¬¡éƒ½è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p><p>6ã€ä¸ºäº†å‡å°‘ç›—ç”¨å’Œçªƒå–ï¼ŒJWTä¸å»ºè®®ä½¿ç”¨HTTPåè®®æ¥ä¼ è¾“ä»£ç ï¼Œè€Œæ˜¯ä½¿ç”¨åŠ å¯†çš„HTTPSåè®®è¿›è¡Œä¼ è¾“ã€‚</p><h1 id="å››ã€ç”¨æˆ·èº«ä»½è®¤è¯"><a href="#å››ã€ç”¨æˆ·èº«ä»½è®¤è¯" class="headerlink" title="å››ã€ç”¨æˆ·èº«ä»½è®¤è¯"></a>å››ã€ç”¨æˆ·èº«ä»½è®¤è¯</h1><h2 id="4-1ã€å¼•å…¥ä¾èµ–"><a href="#4-1ã€å¼•å…¥ä¾èµ–" class="headerlink" title="4.1ã€å¼•å…¥ä¾èµ–"></a>4.1ã€å¼•å…¥ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»"><a href="#4-2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»" class="headerlink" title="4.2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»"></a>4.2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»</h2><blockquote><p>JwtUtils.javaï¼Œç”¨äºæ ¹æ®<strong>ç”¨æˆ·ä¿¡æ¯</strong>ç”Ÿæˆ<strong>token</strong>ã€åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆçš„å·¥å…·ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_SECRET = <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Key <span class="title">getKeyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = DatatypeConverter.parseBase64Binary(APP_SECRET);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SecretKeySpec(bytes,signatureAlgorithm.getJcaName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJwtToken</span><span class="params">(JwtInfo jwtInfo, <span class="keyword">int</span> expire)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String JwtToken = Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">                .setSubject(<span class="string">&quot;guli-user&quot;</span>)<span class="comment">//ä¸»é¢˜</span></span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())<span class="comment">//é¢å‘æ—¶é—´</span></span><br><span class="line">                .setExpiration(DateTime.now().plusSeconds(expire).toDate())<span class="comment">//è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, jwtInfo.getId())<span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, jwtInfo.getNickname())<span class="comment">//ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">                .claim(<span class="string">&quot;avatar&quot;</span>, jwtInfo.getAvatar())<span class="comment">//ç”¨æˆ·å¤´åƒ</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, getKeyInstance())</span><br><span class="line">                .compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkJwtTToken</span><span class="params">(String jwtToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkJwtTToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®tokenè·å–ä¼šå‘˜id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JwtInfo <span class="title">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        Claims claims = claimsJws.getBody();</span><br><span class="line">        JwtInfo jwtInfo = <span class="keyword">new</span> JwtInfo(claims.get(<span class="string">&quot;id&quot;</span>).toString(), claims.get(<span class="string">&quot;nickname&quot;</span>).toString(), claims.get(<span class="string">&quot;avatar&quot;</span>).toString());</span><br><span class="line">        <span class="keyword">return</span> jwtInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>JwtInfoï¼Œå­˜æ”¾ç”¨æˆ·çš„æœ‰æ•ˆä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInfo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="comment">//æƒé™ã€è§’è‰²ç­‰</span></span><br><span class="line">    <span class="comment">//ä¸è¦å­˜æ•æ„Ÿä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3ã€å®šä¹‰LoginVo"><a href="#4-3ã€å®šä¹‰LoginVo" class="headerlink" title="4.3ã€å®šä¹‰LoginVo"></a>4.3ã€å®šä¹‰LoginVo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£"><a href="#4-4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£" class="headerlink" title="4.4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£"></a>4.4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£</h2><blockquote><p>è¯¥æ¥å£æ¥æ”¶Serviceå±‚ç”Ÿæˆçš„Tokenï¼Œç„¶åå°†tokenè¿”å›è‡³å‰ç«¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;ä¼šå‘˜ç™»å½•&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginVo loginVo)</span> </span>&#123;</span><br><span class="line">    String token = memberService.login(loginVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-5ã€å®šä¹‰Serviceå±‚"><a href="#4-5ã€å®šä¹‰Serviceå±‚" class="headerlink" title="4.5ã€å®šä¹‰Serviceå±‚"></a>4.5ã€å®šä¹‰Serviceå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(LoginVo loginVo)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String mobile = loginVo.getMobile();</span><br><span class="line">    String password = loginVo.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¡éªŒå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(mobile)</span><br><span class="line">        || !FormUtils.isMobile(mobile)</span><br><span class="line">        || StringUtils.isEmpty(password)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    QueryWrapper&lt;Member&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;mobile&quot;</span>, mobile);</span><br><span class="line">    Member member = baseMapper.selectOne(queryWrapper);</span><br><span class="line">    <span class="keyword">if</span>(member == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.LOGIN_MOBLE_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¡éªŒå¯†ç </span></span><br><span class="line">    <span class="keyword">if</span>(!MD5.encrypt(password).equals(member.getPassword()))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.LOGIN_PASSWORD_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ£€éªŒç”¨æˆ·æ˜¯å¦è¢«ç¦ç”¨</span></span><br><span class="line">    <span class="keyword">if</span>(member.getDisabled())&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.LOGIN_DISABLED_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    JwtInfo jwtInfo = <span class="keyword">new</span> JwtInfo();</span><br><span class="line">    jwtInfo.setId(member.getId());</span><br><span class="line">    jwtInfo.setNickname(member.getNickname());</span><br><span class="line">    jwtInfo.setAvatar(member.getAvatar());</span><br><span class="line">    String jwtToken = JwtUtils.getJwtToken(jwtInfo, <span class="number">1800</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jwtToken;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-6ã€æµ‹è¯•"><a href="#4-6ã€æµ‹è¯•" class="headerlink" title="4.6ã€æµ‹è¯•"></a>4.6ã€æµ‹è¯•</h2><blockquote><p>å¾€æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æµ‹è¯•æ•°æ®ï¼Œmobileä¸º13711111111ï¼Œå¯†ç ä¸º123</p></blockquote><blockquote><p>æ‰“å¼€swaggerï¼Œè¿›è¡Œæµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215334.png" alt="image-20210205215334387"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215350.png" alt="image-20210205215350880"></p><blockquote><p>å½“mobileå’Œå¯†ç å‡è¾“å…¥æ— è¯¯æ—¶ï¼Œåç«¯ä¼šè¿”å›ä¸€ä¸ªtoken</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215435.png" alt="image-20210205215435940"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215449.png" alt="image-20210205215449715"></p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ†”JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆä¸‰ï¼‰-äºŒå‰æ’åºæ ‘è¯¦è§£</title>
      <link href="posts/3310991137.html"/>
      <url>posts/3310991137.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h1><blockquote><p><strong>äºŒå‰æ’åºæ ‘</strong>äº¦ç§°<strong>äºŒå‰æŸ¥æ‰¾æ ‘</strong>ï¼Œæ˜¯æ ‘å½¢æ•°æ®ç»“æ„çš„ä¸€ç§ï¼Œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒäºŒå‰æ’åºæ ‘çš„æŸ¥æ‰¾æ•ˆç‡è¦<strong>é«˜äº</strong>æ™®é€šé“¾è¡¨ï¼Œå®ƒè¦ä¹ˆæ˜¯ä¸€æ£µç©ºæ ‘ï¼Œè¦ä¹ˆå…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p><ul><li>è‹¥å®ƒçš„å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™<strong>å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼</strong>ï¼›</li><li>è‹¥å®ƒçš„å³å­æ ‘ä¸ä¸ºç©ºï¼Œåˆ™<strong>å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼</strong>ï¼›</li><li><strong>å®ƒçš„å·¦ã€å³å­æ ‘åˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘</strong>ã€‚</li><li>ä¸‹é¢æ˜¯ä¸€æ£µæ ‡å‡†çš„äºŒå‰æ’åºæ ‘</li></ul></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205180351.png" alt="image-20210205180344323"></p><h1 id="äºŒã€äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆä¸èŠ‚ç‚¹æ’å…¥"><a href="#äºŒã€äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆä¸èŠ‚ç‚¹æ’å…¥" class="headerlink" title="äºŒã€äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆä¸èŠ‚ç‚¹æ’å…¥"></a>äºŒã€äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆä¸èŠ‚ç‚¹æ’å…¥</h1><h2 id="2-1ã€ç”Ÿæˆ"><a href="#2-1ã€ç”Ÿæˆ" class="headerlink" title="2.1ã€ç”Ÿæˆ"></a>2.1ã€ç”Ÿæˆ</h2><h3 id="1ã€åˆ›å»ºNodeç±»å’ŒTreeç±»"><a href="#1ã€åˆ›å»ºNodeç±»å’ŒTreeç±»" class="headerlink" title="1ã€åˆ›å»ºNodeç±»å’ŒTreeç±»"></a>1ã€åˆ›å»ºNodeç±»å’ŒTreeç±»</h3><blockquote><p>åˆ›å»ºä¸€ä¸ª<strong>Node</strong>ç±»ä½œä¸ºäºŒå‰æ’åºæ ‘çš„<strong>èŠ‚ç‚¹ç±»</strong>ï¼Œè¿™é‡Œçœç•¥getterã€setterå’ŒtoStringæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="comment">// å½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">    Node left;</span><br><span class="line">    <span class="comment">// å½“å‰èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">    Node right;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºä¸€ä¸ª<strong>Tree</strong>ç±»ï¼Œè¿™ä¸ªç±»åŒ…å«ä¸€ä¸ªNodeç±»å‹çš„rootå±æ€§ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tree</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å½“å‰æ ‘çš„æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    Node root;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><h3 id="2ã€ç”Ÿæˆæ€è·¯"><a href="#2ã€ç”Ÿæˆæ€è·¯" class="headerlink" title="2ã€ç”Ÿæˆæ€è·¯"></a>2ã€ç”Ÿæˆæ€è·¯</h3><blockquote><p>æ—¢å¯ä»¥åœ¨åˆ›å»ºäºŒå‰æ ‘å¯¹è±¡æ—¶ç›´æ¥ä½¿ç”¨æœ‰å‚æ„é€ å‡½æ•°ä¼ å…¥æ ¹èŠ‚ç‚¹å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åœ¨æ·»åŠ èŠ‚ç‚¹æ—¶æ‰æ’å…¥rootèŠ‚ç‚¹</p><p>æ³¨ï¼šå½“ä¸€æ£µæ ‘rootèŠ‚ç‚¹ä¸ºç©ºæ—¶ï¼Œç¬¬ä¸€ä¸ªæ’å…¥è¯¥æ ‘çš„èŠ‚ç‚¹å°±æ˜¯æ ¹èŠ‚ç‚¹ã€‚</p></blockquote><h2 id="2ã€èŠ‚ç‚¹æ’å…¥"><a href="#2ã€èŠ‚ç‚¹æ’å…¥" class="headerlink" title="2ã€èŠ‚ç‚¹æ’å…¥"></a>2ã€èŠ‚ç‚¹æ’å…¥</h2><h3 id="1ã€æ€è·¯"><a href="#1ã€æ€è·¯" class="headerlink" title="1ã€æ€è·¯"></a>1ã€æ€è·¯</h3><blockquote><p>åœ¨Treeç±»ä¸­æ·»åŠ ä¸€ä¸ªaddNodeæ–¹æ³•ï¼Œ<strong>å¦‚æœå½“å‰æ ‘çš„æ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œé‚£ä¹ˆå°†è¦æ·»åŠ åˆ°äºŒå‰æ’åºæ ‘çš„èŠ‚ç‚¹è®¾ç½®ä¸ºæ ¹èŠ‚ç‚¹</strong>ï¼Œå¦åˆ™å°±<strong>è°ƒç”¨rootèŠ‚ç‚¹å¯¹è±¡çš„addæ–¹æ³•</strong>ï¼Œåœ¨rootå¯¹è±¡çš„addæ–¹æ³•ä¸­ï¼š</p><ul><li>  å¦‚æœä¼ å…¥è¦æ·»åŠ çš„èŠ‚ç‚¹nodeä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ï¼Œä¸åšæ·»åŠ ã€‚</li><li>å¦‚æœä¼ å…¥è¦æ·»åŠ çš„èŠ‚ç‚¹nodeçš„æ•°å€¼å°äºå½“å‰èŠ‚ç‚¹çš„æ•°å€¼ï¼Œé‚£ä¹ˆè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥è®©å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ºè¦æ·»åŠ çš„èŠ‚ç‚¹nodeã€‚å¦åˆ™å‘å·¦è¿›è¡Œé€’å½’æ·»åŠ ï¼Œåˆ¤æ–­å¾…æ·»åŠ èŠ‚ç‚¹nodeçš„æ•°æ®ä¸å½“å‰å·¦å­èŠ‚ç‚¹æ•°æ®çš„å…³ç³»ï¼Œé‡å¤ä»¥ä¸Šæ“ä½œã€‚</li><li>å¦‚æœä¼ å…¥è¦æ·»åŠ çš„èŠ‚ç‚¹nodeçš„æ•°å€¼å¤§äºç­‰äºå½“å‰èŠ‚ç‚¹çš„æ•°å€¼ï¼Œè¿™ç§æƒ…å†µéœ€è¦å°½é‡é¿å…ï¼Œè¿™ä¸ªæ—¶å€™è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹å³å­æ ‘ä¸ºç©ºï¼Œé‚£ä¹ˆä»¤å½“å‰èŠ‚ç‚¹å³å­æ ‘ç­‰äºè¦æ·»åŠ çš„èŠ‚ç‚¹nodeã€‚å¦åˆ™å‘å³è¿›è¡Œé€’å½’æ·»åŠ ï¼Œåˆ¤æ–­å¾…æ·»åŠ èŠ‚ç‚¹nodeçš„æ•°æ®ä¸å½“å‰å³å­èŠ‚ç‚¹æ•°æ®çš„å…³ç³»ï¼Œé‡å¤ä»¥ä¸Šæ“ä½œã€‚</li></ul></blockquote><h3 id="2ã€æ’å…¥èŠ‚ç‚¹â€“Tree"><a href="#2ã€æ’å…¥èŠ‚ç‚¹â€“Tree" class="headerlink" title="2ã€æ’å…¥èŠ‚ç‚¹â€“Tree"></a>2ã€æ’å…¥èŠ‚ç‚¹â€“Tree</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNode</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.root == <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.root = node; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="keyword">this</span>.root.add(node); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€èŠ‚ç‚¹çš„æ¯”è¾ƒä¸æ’å…¥â€“Node"><a href="#3ã€èŠ‚ç‚¹çš„æ¯”è¾ƒä¸æ’å…¥â€“Node" class="headerlink" title="3ã€èŠ‚ç‚¹çš„æ¯”è¾ƒä¸æ’å…¥â€“Node"></a>3ã€èŠ‚ç‚¹çš„æ¯”è¾ƒä¸æ’å…¥â€“Node</h3><blockquote><p><strong>æ¯”è¾ƒèŠ‚ç‚¹æ ‘çš„é™æ€æ–¹æ³•</strong>å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">compare</span><span class="params">(Node node1,Node node2)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> node1.data &gt; node2.data; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>Nodeç±»ä¸­æ’å…¥èŠ‚ç‚¹çš„æ–¹æ³•å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(node == <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(compare(<span class="keyword">this</span>,node)) &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.left == <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="keyword">this</span>.left = node; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">this</span>.left.add(node); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.right == <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="keyword">this</span>.right = node; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">this</span>.right.add(node); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸‰ã€äºŒå‰æ ‘çš„å‰ä¸­ååºéå†"><a href="#ä¸‰ã€äºŒå‰æ ‘çš„å‰ä¸­ååºéå†" class="headerlink" title="ä¸‰ã€äºŒå‰æ ‘çš„å‰ä¸­ååºéå†"></a>ä¸‰ã€äºŒå‰æ ‘çš„å‰ä¸­ååºéå†</h1><blockquote><p>å‰åºéå†çš„é¡ºåºï¼š<strong>æ ¹èŠ‚ç‚¹â€“å·¦å­èŠ‚ç‚¹â€“å³å­èŠ‚ç‚¹</strong></p><p>ä¸­åºéå†çš„é¡ºåºï¼š<strong>å·¦å­èŠ‚ç‚¹â€“æ ¹èŠ‚ç‚¹â€“å³å­èŠ‚ç‚¹</strong></p><p>ååºéå†çš„é¡ºåºï¼š<strong>å·¦å­èŠ‚ç‚¹â€“å³å­èŠ‚ç‚¹â€“æ ¹èŠ‚ç‚¹</strong></p></blockquote><h2 id="3-1ã€é€’å½’å®ç°"><a href="#3-1ã€é€’å½’å®ç°" class="headerlink" title="3.1ã€é€’å½’å®ç°"></a>3.1ã€é€’å½’å®ç°</h2><h3 id="1ã€å‰åºéå†"><a href="#1ã€å‰åºéå†" class="headerlink" title="1ã€å‰åºéå†"></a>1ã€å‰åºéå†</h3><blockquote><p>å…ˆè¾“å‡ºå½“å‰èŠ‚ç‚¹ï¼Œç„¶ååˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œå°±å‘å·¦é€’å½’è¿›è¡Œå‰åºéå†ã€‚ç„¶ååˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å³å­æ ‘æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ä¸ºç©ºï¼Œå‘å³é€’å½’è¿›è¡Œå‰åºéå†ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Treeç±» </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.root != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.root.preOrder(); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå‰æ ‘ä¸ºç©ºï¼Œæ— æ³•éå†ï¼&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//Nodeç±» </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    System.out.println(<span class="keyword">this</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.getLeft() != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.getLeft().preOrder(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.getRight() != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.getRight().preOrder(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¸­åºéå†"><a href="#2ã€ä¸­åºéå†" class="headerlink" title="2ã€ä¸­åºéå†"></a>2ã€ä¸­åºéå†</h3><blockquote><p>å…ˆåˆ¤æ–­å½“å‰èŠ‚ç‚¹å·¦å­æ ‘æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ä¸ºç©ºï¼Œå‘å·¦é€’å½’è¿›è¡Œä¸­åºéå†ï¼Œç„¶åè¾“å‡ºå½“å‰èŠ‚ç‚¹ï¼›æœ€ååˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å³å­æ ‘æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ä¸ºç©ºï¼Œå‘å³é€’å½’è¿›è¡Œä¸­åºéå†ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Treeç±» </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.root != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.root.infixOrder(); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå‰æ ‘ä¸ºç©ºï¼Œæ— æ³•éå†ï¼&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//Nodeç±» </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.getLeft() != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.getLeft().infixOrder(); </span><br><span class="line">    &#125; </span><br><span class="line">    System.out.println(<span class="keyword">this</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.getRight() != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.getRight().infixOrder(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€ååºéå†"><a href="#3ã€ååºéå†" class="headerlink" title="3ã€ååºéå†"></a>3ã€ååºéå†</h3><blockquote><p>å…ˆåˆ¤æ–­å½“å‰èŠ‚ç‚¹å·¦å­æ ‘æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ä¸ºç©ºï¼Œå‘å·¦é€’å½’è¿›è¡Œååºéå†ï¼›ç„¶ååˆ¤æ–­å½“å‰èŠ‚ç‚¹çš„å³å­æ ‘æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ä¸ºç©ºï¼Œå‘å³é€’å½’è¿›è¡Œååºéå†ã€‚æœ€åè¾“å‡ºå½“å‰èŠ‚ç‚¹ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Treeç±» </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.root != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.root.postOrder(); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå‰æ ‘ä¸ºç©ºï¼Œæ— æ³•éå†ï¼&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//Nodeç±» </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.getLeft() != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.getLeft().postOrder(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.getRight() != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.getRight().postOrder(); </span><br><span class="line">    &#125; </span><br><span class="line">    System.out.println(<span class="keyword">this</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2ã€éé€’å½’å®ç°"><a href="#3-2ã€éé€’å½’å®ç°" class="headerlink" title="3.2ã€éé€’å½’å®ç°"></a>3.2ã€éé€’å½’å®ç°</h2><blockquote><p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°<strong>æ ˆ</strong>è¿™ä¸€æ•°æ®ç»“æ„æ¥è§£å†³é—®é¢˜</p></blockquote><h3 id="1ã€å‰åºéå†-1"><a href="#1ã€å‰åºéå†-1" class="headerlink" title="1ã€å‰åºéå†"></a>1ã€å‰åºéå†</h3><blockquote><p>å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå…ˆè¾“å‡ºå½“å‰èŠ‚ç‚¹ä¿¡æ¯ï¼Œç„¶åå°†è¯¥èŠ‚ç‚¹å‹å…¥æ ˆï¼Œå¹¶å°†æŒ‡é’ˆç§»åŠ¨åˆ°å½“å‰èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶å¦‚æœè¯¥å·¦å­æ ‘ä¸ºç©ºï¼Œå°±é€€å‡ºå¾ªç¯ï¼Œæ­¤æ—¶å¦‚æœæ ˆä¸ä¸ºç©ºï¼Œå°±å¼¹å‡ºæ ˆé¡¶æ•°æ®ï¼Œå°†æŒ‡é’ˆç§»åŠ¨åˆ°å½“å‰ç»“ç‚¹å³å­æ ‘ï¼Œå¾ªç¯ï¼Œç›´åˆ°æ ˆç©ºæˆ–è€…å½“å‰èŠ‚ç‚¹ä¸ºç©ºã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    Stack&lt;Node&gt; nodeStack = <span class="keyword">new</span> Stack&lt;&gt;(); </span><br><span class="line">    <span class="keyword">while</span>(node != <span class="keyword">null</span> || !nodeStack.empty()) &#123; </span><br><span class="line">        <span class="keyword">while</span>(node != <span class="keyword">null</span>) &#123; </span><br><span class="line">            System.out.println(node); </span><br><span class="line">            nodeStack.push(node); </span><br><span class="line">            node = node.getLeft(); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span>(!nodeStack.empty()) &#123; </span><br><span class="line">            node = nodeStack.pop(); </span><br><span class="line">            node = node.getRight(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ä¸­åºéå†-1"><a href="#2ã€ä¸­åºéå†-1" class="headerlink" title="2ã€ä¸­åºéå†"></a>2ã€ä¸­åºéå†</h3><blockquote><p>å¦‚æœå½“å‰èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œå°†å½“å‰èŠ‚ç‚¹å‹å…¥æ ˆä¸­ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹å·¦å­æ ‘ï¼Œç›´åˆ°å·¦å­æ ‘ä¸ºç©ºï¼Œæ­¤æ—¶æ ˆä¸ä¸ºç©ºï¼Œå°†æ ˆé¡¶å…ƒç´ å¼¹å‡ºå¹¶è¾“å‡ºåï¼Œå°†æŒ‡é’ˆç§»åŠ¨åˆ°å½“å‰ç»“ç‚¹å³å­æ ‘ï¼Œå¾ªç¯ï¼Œç›´åˆ°æ ˆç©ºæˆ–è€…å½“å‰èŠ‚ç‚¹ä¸ºç©ºã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">midOrder</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    Stack&lt;Node&gt; nodeStack = <span class="keyword">new</span> Stack&lt;&gt;(); </span><br><span class="line">    <span class="keyword">while</span>(node != <span class="keyword">null</span> || !nodeStack.empty()) &#123; </span><br><span class="line">        <span class="keyword">while</span>(node != <span class="keyword">null</span>) &#123; </span><br><span class="line">            nodeStack.push(node); </span><br><span class="line">            node = node.getLeft(); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span>(!nodeStack.empty()) &#123; </span><br><span class="line">            node = nodeStack.pop(); </span><br><span class="line">            System.out.println(node); </span><br><span class="line">            node = node.getRight(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€ååºéå†-1"><a href="#3ã€ååºéå†-1" class="headerlink" title="3ã€ååºéå†"></a>3ã€ååºéå†</h3><blockquote><p>éœ€è¦åˆ©ç”¨åˆ°ä¸€ä¸ªè¾…åŠ©æ ˆç”¨äºè¾“å‡ºç»“æœï¼Œç”±äºæ ˆå…·æœ‰å…ˆè¿›åå‡ºçš„ç‰¹ç‚¹ï¼Œè€Œååºéå†çš„é¡ºåºæ˜¯å·¦å³æ ¹ï¼Œæ‰€ä»¥å‹å…¥æ ˆé¡ºåºä¸ºæ ¹ã€å³ã€å·¦ã€‚æœ€åä½¿ç”¨è¾…åŠ©æ ˆè¾“å‡º</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(node == <span class="keyword">null</span>) &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;è¦éå†çš„äºŒå‰æ ‘ä¸ºç©ºï¼&quot;</span>); </span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    Stack&lt;Node&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;(); </span><br><span class="line">    <span class="comment">//è¾…åŠ©æ ˆ </span></span><br><span class="line">    Stack&lt;Node&gt; assistStack = <span class="keyword">new</span> Stack&lt;&gt;(); </span><br><span class="line">    <span class="keyword">while</span>(node != <span class="keyword">null</span> || !stack.isEmpty()) &#123; </span><br><span class="line">        <span class="keyword">while</span>(node != <span class="keyword">null</span>) &#123; </span><br><span class="line">            stack.push(node); </span><br><span class="line">            assistStack.push(node); </span><br><span class="line">            node = node.getRight(); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">if</span>(!stack.isEmpty()) &#123; </span><br><span class="line">            node = stack.pop(); </span><br><span class="line">            node = node.getLeft(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">while</span>(!assistStack.isEmpty()) &#123; </span><br><span class="line">        System.out.println(assistStack.pop()); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å››ã€äºŒå‰æ’åºæ ‘èŠ‚ç‚¹çš„åˆ é™¤"><a href="#å››ã€äºŒå‰æ’åºæ ‘èŠ‚ç‚¹çš„åˆ é™¤" class="headerlink" title="å››ã€äºŒå‰æ’åºæ ‘èŠ‚ç‚¹çš„åˆ é™¤"></a>å››ã€äºŒå‰æ’åºæ ‘èŠ‚ç‚¹çš„åˆ é™¤</h1><blockquote><p>äºŒå‰æ’åºæ ‘ä¸­çš„èŠ‚ç‚¹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>å¶å­èŠ‚ç‚¹</li><li>æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹</li><li>æœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹</li></ul><p>æˆ‘ä»¬éœ€è¦åˆ¤æ–­å¾…åˆ é™¤èŠ‚ç‚¹ä¸ºä»€ä¹ˆç±»å‹ï¼Œç„¶åæ ¹æ®èŠ‚ç‚¹ç±»å‹è¿›è¡Œåˆ é™¤æ“ä½œã€‚</p></blockquote><h2 id="4-1ã€ç¼–å†™ç”¨äºæœç´¢å¾…åˆ é™¤èŠ‚ç‚¹å’Œå¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•"><a href="#4-1ã€ç¼–å†™ç”¨äºæœç´¢å¾…åˆ é™¤èŠ‚ç‚¹å’Œå¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•" class="headerlink" title="4.1ã€ç¼–å†™ç”¨äºæœç´¢å¾…åˆ é™¤èŠ‚ç‚¹å’Œå¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•"></a>4.1ã€ç¼–å†™ç”¨äºæœç´¢å¾…åˆ é™¤èŠ‚ç‚¹å’Œå¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•</h2><h3 id="1ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•"><a href="#1ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•" class="headerlink" title="1ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•"></a>1ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•</h3><blockquote><p>æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹ï¼Œé¦–å…ˆåˆ¤æ–­å½“å‰äºŒå‰æ’åºæ ‘æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºï¼Œç›´æ¥è¿”å›ï¼Œå¦åˆ™è°ƒç”¨å½“å‰äºŒå‰æ’åºæ ‘æ ¹èŠ‚ç‚¹çš„searchæ–¹æ³•</p><ul><li><p>å¦‚æœå½“å‰ä¼ å…¥çš„æ•°æ®dataçš„å€¼åˆšå¥½ç­‰äºå½“å‰èŠ‚ç‚¹çš„dataå€¼ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹å°±æ˜¯å¾…åˆ é™¤èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›å³å¯</p></li><li><p> å¦‚æœå½“å‰ä¼ å…¥çš„æ•°æ®dataçš„å€¼å°äºå½“å‰èŠ‚ç‚¹çš„å€¼ä¸”å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ºç©ºï¼Œè¯æ˜å½“å‰äºŒå‰æ’åºæ ‘ä¸­æ²¡æœ‰è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼›å¦‚æœå½“å‰ä¼ å…¥æ•°æ®dataå€¼å°äºå½“å‰èŠ‚ç‚¹å€¼ä¸”å½“å‰èŠ‚ç‚¹å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè°ƒç”¨å½“å‰èŠ‚ç‚¹å·¦å­æ ‘çš„searchæ–¹æ³•ï¼Œå‘å·¦é€’å½’æŸ¥è¯¢ã€‚</p></li><li><p>åŒç†ï¼Œå¦‚æœå½“å‰ä¼ å…¥çš„æ•°æ®dataå€¼å¤§äºå½“å‰èŠ‚ç‚¹å€¼ä¸”å½“å‰èŠ‚ç‚¹å³å­æ ‘ä¸ºç©ºï¼Œè¯æ˜å½“å‰äºŒå‰æ’åºæ ‘æ²¡æœ‰è¦åˆ é™¤èŠ‚ç‚¹ï¼Œæ­¤åˆ»åªèƒ½è¿”å›nullï¼›å¦‚æœå½“å‰ä¼ å…¥æ•°æ®dataå€¼å¤§äºå½“å‰èŠ‚ç‚¹ä¸”å½“å‰èŠ‚ç‚¹å³å­æ ‘ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè°ƒç”¨å½“å‰å³å­æ ‘çš„searchæ–¹æ³•ï¼Œå‘å³é€’å½’æŸ¥è¯¢ã€‚</p></li></ul><p>ä»£ç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * æ ¹æ®èŠ‚ç‚¹çš„dataæ•°æ®æœç´¢NodeèŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data ç›®æ ‡èŠ‚ç‚¹çš„dataå€¼ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¦‚æœæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„nodeèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿”å›è¯¥nodeèŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> *         å¦åˆ™è¿”å›null </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">search</span><span class="params">(<span class="keyword">int</span> data)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(data == <span class="keyword">this</span>.data) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(data &lt; <span class="keyword">this</span>.data) &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.left == <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.left.search(data); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.right == <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.right.search(data); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•"><a href="#2ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•" class="headerlink" title="2ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•"></a>2ã€æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•</h3><blockquote><p>æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„æ–¹æ³•ï¼ŒåŒç†å…ˆåˆ¤æ–­å½“å‰äºŒå‰æ’åºæ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºï¼Œè¿”å›nullï¼Œå¦åˆ™è°ƒç”¨å½“å‰äºŒå‰æ’åºæ ‘çš„æ ¹èŠ‚ç‚¹çš„æœç´¢å¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹ï¼ˆsearchParentï¼‰çš„æ–¹æ³•ã€‚</p><ul><li><p>å¦‚æœå½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ä¸ºç©ºä¸”å½“å‰èŠ‚ç‚¹å·¦å­æ ‘çš„dataå€¼ç­‰äºç”¨æˆ·ä¼ å…¥çš„è¦æ£€ç´¢çš„dataå€¼æˆ–è€…å½“å‰èŠ‚ç‚¹å³å­æ ‘ä¸ä¸ºç©ºä¸”å½“å‰èŠ‚ç‚¹å³å­æ ‘çš„dataå€¼ç­‰äºç”¨æˆ·ä¼ å…¥çš„è¦æ£€ç´¢çš„dataå€¼ï¼Œé‚£ä¹ˆè¯æ˜å½“å‰èŠ‚ç‚¹å°±æ˜¯å¾…æ£€ç´¢èŠ‚ç‚¹ï¼Œè¿”å›å½“å‰èŠ‚ç‚¹ã€‚</p></li><li><p>å¦‚æœä¼ å…¥çš„dataå€¼å°äºå½“å‰èŠ‚ç‚¹å€¼ä¸”å½“å‰å·¦å­æ ‘ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè°ƒç”¨å½“å‰å·¦å­èŠ‚ç‚¹çš„searchParentçš„æ–¹æ³•ã€‚</p></li><li><p>åŒç†ï¼Œå¦‚æœä¼ å…¥dataå€¼å¤§äºç­‰äºå½“å‰èŠ‚ç‚¹çš„dataå€¼ä¸”å½“å‰èŠ‚ç‚¹å³å­æ ‘ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè°ƒç”¨å½“å‰èŠ‚ç‚¹å³å­èŠ‚ç‚¹çš„searchParentæ–¹æ³•ã€‚</p></li><li><p>å¦‚æœç¨‹åºèµ°åˆ°æ­¤å¤„ï¼Œè¯æ˜æ²¡æœ‰æ‰¾åˆ°å¾…åˆ é™¤æ•°æ®çš„çˆ¶èŠ‚ç‚¹ï¼Œæ­¤æ—¶è¿”å›nullã€‚</p></li></ul><p>ä»£ç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * æŸ¥æ‰¾è¦åˆ é™¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data è¦åˆ é™¤çš„èŠ‚ç‚¹çš„æ•°æ® </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¾…åˆ é™¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">searchParent</span><span class="params">(<span class="keyword">int</span> data)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">this</span>.left != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.left.data == data) || (<span class="keyword">this</span>.right != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.right.data == data)) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="comment">//å¦‚æœè¦æŸ¥æ‰¾çš„å€¼å°äºå½“å‰èŠ‚ç‚¹å€¼ï¼Œä¸”å½“å‰èŠ‚ç‚¹å·¦å­èŠ‚ç‚¹ä¸ä¸ºç©º </span></span><br><span class="line">        <span class="comment">//é€’å½’å‘å·¦ </span></span><br><span class="line">        <span class="keyword">if</span>(data &lt; <span class="keyword">this</span>.data &amp;&amp; <span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.left.searchParent(data); </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(data &gt;= <span class="keyword">this</span>.data &amp;&amp; <span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.right.searchParent(data); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2ã€åˆ é™¤å¶å­èŠ‚ç‚¹"><a href="#4-2ã€åˆ é™¤å¶å­èŠ‚ç‚¹" class="headerlink" title="4.2ã€åˆ é™¤å¶å­èŠ‚ç‚¹"></a>4.2ã€åˆ é™¤å¶å­èŠ‚ç‚¹</h2><blockquote><p>å¯¹äºå¶å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹targetå’Œå¾…åˆ é™¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹parentï¼Œç„¶ååˆ¤æ–­å¾…åˆ é™¤å¶å­èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ï¼Œå¦‚æœä¸ºå·¦å­æ ‘ï¼Œé‚£ä¹ˆä»¤parent.left = nullï¼Œå¦åˆ™è®©parent.right = nullã€‚</p></blockquote><ul><li>äºŒå‰æ’åºæ ‘ä¸­åˆ¤æ–­å¾…åˆ é™¤èŠ‚ç‚¹æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹çš„é™æ€æ–¹æ³•ä¸Nodeç±»ä¸­åˆ¤æ–­ä¼ å…¥èŠ‚ç‚¹ä¸ºå½“å‰å·¦å­æ ‘/å³å­æ ‘çš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­nodeèŠ‚ç‚¹æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> node.left == <span class="keyword">null</span> &amp;&amp; node.right == <span class="keyword">null</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ä¼ å…¥èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰èŠ‚ç‚¹å·¦å­èŠ‚ç‚¹çš„æ–¹æ³• </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeft</span><span class="params">(Node target)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.left != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.left.data == target.data; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ä¼ å…¥èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰èŠ‚ç‚¹å³å­èŠ‚ç‚¹çš„æ–¹æ³• </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isRight</span><span class="params">(Node target)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.right != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.right.data == target.data; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹"><a href="#4-3ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹" class="headerlink" title="4.3ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹"></a>4.3ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹</h2><blockquote><p>å¯¹äºæœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹çš„åˆ é™¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹å’Œå¾…åˆ é™¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œç„¶ååˆ¤æ–­ä¸¤ä¸ªæ¡ä»¶ï¼š1ï¼ˆå¾…åˆ é™¤èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ï¼‰ã€2ï¼ˆå¾…åˆ é™¤èŠ‚ç‚¹æœ‰å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ï¼‰</p><ul><li><p>å¦‚æœå¾…åˆ é™¤èŠ‚ç‚¹æœ‰å·¦å­æ ‘ä¸”ä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼šæ­¤æ—¶è®©å¾…åˆ é™¤èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘ç­‰äºå¾…åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œå³parent.left = target.leftã€‚</p></li><li><p> å¦‚æœå¾…åˆ é™¤èŠ‚ç‚¹æœ‰å·¦å­æ ‘ä¸”ä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘ï¼šæ­¤æ—¶æ ¹æ®äºŒå‰æ’åºæ ‘çš„æ€§è´¨ï¼Œå¾…åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘çš„æ•°æ®è¦å…¨éƒ¨å¤§äºï¼ˆç­‰äºï¼‰å…¶çˆ¶èŠ‚ç‚¹çš„æ•°æ®ï¼Œæ‰€ä»¥ä»¤å¾…åˆ é™¤èŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘ç­‰äºå¾…åˆ é™¤èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼Œå³parent.right = target.leftã€‚</p></li><li><p>å¦‚æœå¾…åˆ é™¤èŠ‚ç‚¹æœ‰å³å­æ ‘ä¸”ä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼šæ­¤æ—¶è®©parent.left = target.right</p></li><li><p>å¦‚æœå¾…åˆ é™¤èŠ‚ç‚¹æœ‰å³å­æ ‘ä¸”ä¸ºå…¶çˆ¶èŠ‚ç‚¹çš„å³å­æ ‘ï¼Œæ­¤æ—¶è®©parent.right = target.right</p></li></ul></blockquote><ul><li>Nodeç±»ä¸­åˆ¤æ–­ä¼ å…¥èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰èŠ‚ç‚¹å·¦/å³å­æ ‘çš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ä¼ å…¥èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰èŠ‚ç‚¹å·¦å­èŠ‚ç‚¹çš„æ–¹æ³• </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLeft</span><span class="params">(Node target)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.left != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.left.data == target.data; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ä¼ å…¥èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰èŠ‚ç‚¹å³å­èŠ‚ç‚¹çš„æ–¹æ³• </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isRight</span><span class="params">(Node target)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.right != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.right.data == target.data; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4ã€åˆ é™¤æœ‰ä¸¤æ£µæ ‘çš„èŠ‚ç‚¹"><a href="#4-4ã€åˆ é™¤æœ‰ä¸¤æ£µæ ‘çš„èŠ‚ç‚¹" class="headerlink" title="4.4ã€åˆ é™¤æœ‰ä¸¤æ£µæ ‘çš„èŠ‚ç‚¹"></a>4.4ã€åˆ é™¤æœ‰ä¸¤æ£µæ ‘çš„èŠ‚ç‚¹</h2><blockquote><p>å¯¹äºæœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹çš„åˆ é™¤ï¼šéœ€è¦å…ˆå–åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„å³å­æ ‘çš„æœ€å°èŠ‚ç‚¹çš„å€¼ï¼Œç„¶åå°†æ•°å€¼æœ€å°çš„èŠ‚ç‚¹åˆ é™¤ï¼Œæœ€åå°†å‰é¢å–åˆ°çš„æœ€å°èŠ‚ç‚¹çš„å€¼èµ‹å€¼ç»™å¾…åˆ é™¤èŠ‚ç‚¹ã€‚</p></blockquote><ul><li>è·å–å¾…åˆ é™¤èŠ‚ç‚¹å³å­æ ‘ä¸­æœ€å°èŠ‚ç‚¹çš„å€¼å¹¶åˆ é™¤æœ€å°èŠ‚ç‚¹çš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * 1 è¿”å›ä»¥nodeä¸ºæ ¹èŠ‚ç‚¹çš„äºŒå‰æ’åºæ ‘çš„æœ€å°èŠ‚ç‚¹çš„å€¼ </span></span><br><span class="line"><span class="comment"> * 2 åˆ é™¤ä»¥nodeä¸ºæ ¹èŠ‚ç‚¹çš„äºŒå‰æ’åºæ ‘çš„æœ€å°èŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node ä¼ å…¥çš„èŠ‚ç‚¹ï¼ˆäºŒå‰æ’åºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼‰ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›çš„ä»¥Nodeä¸ºæ ¹èŠ‚ç‚¹çš„äºŒå‰æ’åºæ ‘çš„æ ¹èŠ‚ç‚¹çš„å€¼ </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delTreeMin</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    Node target = node; </span><br><span class="line">    <span class="comment">//å¾ªç¯çš„æŸ¥æ‰¾å·¦èŠ‚ç‚¹ï¼Œå°±èƒ½æ‰¾åˆ°æœ€å°å€¼ </span></span><br><span class="line">    <span class="keyword">while</span>(target.left != <span class="keyword">null</span>) &#123; </span><br><span class="line">        target = target.left; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">//æ­¤æ—¶å¾ªç¯ç»“æŸåï¼ŒtargetæŒ‡å‘æœ€å°èŠ‚ç‚¹ </span></span><br><span class="line">    <span class="comment">//åˆ é™¤æœ€å°èŠ‚ç‚¹ </span></span><br><span class="line">    delNode(target.data); </span><br><span class="line">    <span class="keyword">return</span> target.data; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰ä¸¤æ£µå­æ ‘çš„æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * åˆ¤æ–­ä¼ å…¥èŠ‚ç‚¹æ˜¯å¦æœ‰å·¦å³å­æ ‘çš„æ–¹æ³• </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasTwoSon</span><span class="params">(Node node)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> node.left != <span class="keyword">null</span> &amp;&amp; node.right != <span class="keyword">null</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-5ã€äºŒå‰æ’åºæ ‘ä¸­æ ¹æ®èŠ‚ç‚¹æ•°æ®åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•"><a href="#4-5ã€äºŒå‰æ’åºæ ‘ä¸­æ ¹æ®èŠ‚ç‚¹æ•°æ®åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•" class="headerlink" title="4.5ã€äºŒå‰æ’åºæ ‘ä¸­æ ¹æ®èŠ‚ç‚¹æ•°æ®åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•"></a>4.5ã€äºŒå‰æ’åºæ ‘ä¸­æ ¹æ®èŠ‚ç‚¹æ•°æ®åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * æ ¹æ®dataåˆ é™¤èŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data è¦åˆ é™¤çš„èŠ‚ç‚¹çš„data </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delNode</span><span class="params">(<span class="keyword">int</span> data)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(root == <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="comment">//1 å…ˆæ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹target </span></span><br><span class="line">        Node target = search(data); </span><br><span class="line">        <span class="comment">//1.1 å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å› </span></span><br><span class="line">        <span class="keyword">if</span>(target == <span class="keyword">null</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">//1.2 å¦‚æœå½“å‰æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸”ä¸ºå¾…åˆ é™¤èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥ç½®ç©º </span></span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="keyword">null</span> &amp;&amp; root.right == <span class="keyword">null</span>) &#123; </span><br><span class="line">            root = <span class="keyword">null</span>; </span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">//2 å»æ‰¾åˆ°targetçš„çˆ¶èŠ‚ç‚¹ </span></span><br><span class="line">        Node parent = searchParent(data); </span><br><span class="line">        <span class="comment">//2.1 å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ </span></span><br><span class="line">        <span class="keyword">if</span>(isLeaf(target)) &#123; </span><br><span class="line">            <span class="comment">//a åˆ¤æ–­targetæ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹è¿˜æ˜¯æœ‰å­èŠ‚ç‚¹ </span></span><br><span class="line">            <span class="keyword">if</span>(parent.isLeft(target)) &#123; </span><br><span class="line">                <span class="comment">//å¦‚æœæ˜¯å·¦å­èŠ‚ç‚¹ </span></span><br><span class="line">                parent.left = <span class="keyword">null</span>; </span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(parent.isRight(target)) &#123; </span><br><span class="line">                <span class="comment">//å¦‚æœæ˜¯å³å­èŠ‚ç‚¹ </span></span><br><span class="line">                parent.right = <span class="keyword">null</span>; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(hasTwoSon(target)) &#123; </span><br><span class="line">            <span class="comment">//2.2 å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰å·¦å³å­æ ‘ </span></span><br><span class="line">            <span class="comment">//åˆ é™¤å³å­æ ‘æœ€å°èŠ‚ç‚¹ï¼ŒåŒæ—¶å°†æœ€å°èŠ‚ç‚¹çš„å€¼å–å‡ºæ¥ </span></span><br><span class="line">            <span class="keyword">int</span> minData = delTreeMin(target.right); </span><br><span class="line">            target.data = minData; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="comment">//2.3 åˆ é™¤åªæœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹ </span></span><br><span class="line">            <span class="comment">//å¦‚æœå¾…åˆ é™¤èŠ‚ç‚¹æœ‰å·¦å­èŠ‚ç‚¹ </span></span><br><span class="line">            <span class="keyword">if</span>(target.left != <span class="keyword">null</span>) &#123; </span><br><span class="line">                <span class="comment">//å¦‚æœtargetæ˜¯parentçš„å·¦å­èŠ‚ç‚¹ </span></span><br><span class="line">                <span class="keyword">if</span>(parent.isLeft(target)) &#123; </span><br><span class="line">                    parent.left = target.left; </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                    <span class="comment">//è¯´æ˜targetæ˜¯parentçš„å³å­èŠ‚ç‚¹ </span></span><br><span class="line">                    parent.right = target.left; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                <span class="comment">//å¾…åˆ é™¤èŠ‚ç‚¹æœ‰å³å­èŠ‚ç‚¹ </span></span><br><span class="line">                <span class="comment">//å¦‚æœtargetæ˜¯parentçš„å·¦èŠ‚ç‚¹ </span></span><br><span class="line">                <span class="keyword">if</span>(parent.isLeft(target)) &#123; </span><br><span class="line">                    parent.left = target.right; </span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                    parent.right = target.right; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="äº”ã€ä½¿ç”¨é€’å½’è·å–äºŒå‰æ ‘æ·±åº¦"><a href="#äº”ã€ä½¿ç”¨é€’å½’è·å–äºŒå‰æ ‘æ·±åº¦" class="headerlink" title="äº”ã€ä½¿ç”¨é€’å½’è·å–äºŒå‰æ ‘æ·±åº¦"></a>äº”ã€ä½¿ç”¨é€’å½’è·å–äºŒå‰æ ‘æ·±åº¦</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** </span></span><br><span class="line"><span class="comment"> * é€’å½’è·å–äºŒå‰æ ‘æ·±åº¦çš„æ–¹æ³• </span></span><br><span class="line"><span class="comment"> * å¦‚æœæ ¹ä¸ºç©ºï¼šè¿”å›0 </span></span><br><span class="line"><span class="comment"> * å¦åˆ™åˆ†åˆ«é€’å½’æ·±å…¥å·¦å³èŠ‚ç‚¹ï¼Œè¿”å›æ·±åº¦ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> root äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> äºŒå‰æ ‘æ·±åº¦ </span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getTreeDepth</span><span class="params">(Node root)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> root == <span class="keyword">null</span> ? <span class="number">0</span> : (<span class="number">1</span> + Math.max(getTreeDepth(root.left), getTreeDepth(root.right))); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…­ã€æµ‹è¯•"><a href="#å…­ã€æµ‹è¯•" class="headerlink" title="å…­ã€æµ‹è¯•"></a>å…­ã€æµ‹è¯•</h1><h2 id="6-1ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆå’Œæ’å…¥"><a href="#6-1ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆå’Œæ’å…¥" class="headerlink" title="6.1ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆå’Œæ’å…¥"></a>6.1ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„ç”Ÿæˆå’Œæ’å…¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Tree tree = <span class="keyword">new</span> Tree(<span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">int</span>[] arr = &#123;<span class="number">7</span>,<span class="number">8</span>,<span class="number">19</span>,-<span class="number">1</span>,<span class="number">26</span>,<span class="number">100</span>,<span class="number">777</span>,-<span class="number">1012</span>,<span class="number">222</span>,<span class="number">18</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    <span class="keyword">int</span> data = arr[i];</span><br><span class="line">    Node node = <span class="keyword">new</span> Node(data);</span><br><span class="line">    tree.addNode(node);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;tree:&quot;</span>);</span><br><span class="line">Tree.show(tree.root);</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205232121.png" alt="image-20210205232120723"></p><h2 id="6-2ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„åˆ é™¤"><a href="#6-2ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„åˆ é™¤" class="headerlink" title="6.2ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„åˆ é™¤"></a>6.2ã€æµ‹è¯•äºŒå‰æ’åºæ ‘çš„åˆ é™¤</h2><h3 id="1ã€åˆ é™¤å¶å­èŠ‚ç‚¹"><a href="#1ã€åˆ é™¤å¶å­èŠ‚ç‚¹" class="headerlink" title="1ã€åˆ é™¤å¶å­èŠ‚ç‚¹"></a>1ã€åˆ é™¤å¶å­èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;---------------------------------åˆ é™¤å¶å­èŠ‚ç‚¹-1012ï¼Œåˆ é™¤å‰ï¼š&quot;</span>); </span><br><span class="line">Tree.show(tree.root); </span><br><span class="line">tree.delNode(-<span class="number">1012</span>); </span><br><span class="line">System.out.println(<span class="string">&quot;---------------------------------åˆ é™¤å¶å­èŠ‚ç‚¹-1012ï¼Œåˆ é™¤åï¼š&quot;</span>); </span><br><span class="line">Tree.show(tree.root);</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤å‰ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205232357.png" alt="image-20210205232357649"></p><blockquote><p>åˆ é™¤åï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205232418.png" alt="image-20210205232417944"></p><h3 id="2ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹"><a href="#2ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹" class="headerlink" title="2ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹"></a>2ã€åˆ é™¤æœ‰ä¸€æ£µå­æ ‘çš„èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;---------------------------------åˆ é™¤æœ‰ä¸€æ£µæ ‘çš„èŠ‚ç‚¹-1ï¼Œåˆ é™¤å‰ï¼š&quot;</span>); </span><br><span class="line">Tree.show(tree.root); </span><br><span class="line">tree.delNode(-<span class="number">1</span>); </span><br><span class="line">System.out.println(<span class="string">&quot;---------------------------------åˆ é™¤æœ‰ä¸€æ£µæ ‘çš„èŠ‚ç‚¹-1ï¼Œåˆ é™¤åï¼š&quot;</span>); </span><br><span class="line">Tree.show(tree.root);</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤å‰ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205232621.png" alt="image-20210205232621385"></p><blockquote><p>åˆ é™¤åï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205232636.png" alt="image-20210205232635923"></p><h3 id="3ã€åˆ é™¤æœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹"><a href="#3ã€åˆ é™¤æœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹" class="headerlink" title="3ã€åˆ é™¤æœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹"></a>3ã€åˆ é™¤æœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;---------------------------------åˆ é™¤æœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹7ï¼Œåˆ é™¤å‰ï¼š&quot;</span>); </span><br><span class="line">Tree.show(tree.root); </span><br><span class="line">tree.delNode(<span class="number">7</span>); </span><br><span class="line">System.out.println(<span class="string">&quot;---------------------------------åˆ é™¤æœ‰ä¸¤æ£µå­æ ‘çš„èŠ‚ç‚¹7ï¼Œåˆ é™¤åï¼š&quot;</span>); </span><br><span class="line">Tree.show(tree.root);</span><br></pre></td></tr></table></figure><blockquote><p>åˆ é™¤å‰ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205232821.png" alt="image-20210205232820859"></p><blockquote><p>åˆ é™¤åï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205232835.png" alt="image-20210205232834775"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ„æ ‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså­¦ä¹ æ‰‹å†Œï¼ˆä¸‰ï¼‰--é…ç½®æ–‡ä»¶ã€æŒä¹…åŒ–ä¸å­˜å‚¨éªŒè¯ç </title>
      <link href="posts/3873979871.html"/>
      <url>posts/3873979871.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸ƒã€Redis-confé…ç½®æ–‡ä»¶"><a href="#ä¸ƒã€Redis-confé…ç½®æ–‡ä»¶" class="headerlink" title="ä¸ƒã€Redis.confé…ç½®æ–‡ä»¶"></a>ä¸ƒã€Redis.confé…ç½®æ–‡ä»¶</h1><h2 id="7-1ã€ç½‘ç»œ"><a href="#7-1ã€ç½‘ç»œ" class="headerlink" title="7.1ã€ç½‘ç»œ"></a>7.1ã€ç½‘ç»œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span>  127.0.0.1  <span class="comment"># ç»‘å®šçš„ip </span></span><br><span class="line">protected-mode  yes  <span class="comment">#  ä¿æŠ¤æ¨¡å¼ï¼Œé»˜è®¤å¼€å¯</span></span><br><span class="line">port  6379  <span class="comment">#  ç«¯å£è®¾ç½®</span></span><br></pre></td></tr></table></figure><h2 id="7-2ã€å¿«ç…§"><a href="#7-2ã€å¿«ç…§" class="headerlink" title="7.2ã€å¿«ç…§"></a>7.2ã€å¿«ç…§</h2><h3 id="1ã€æŒä¹…åŒ–"><a href="#1ã€æŒä¹…åŒ–" class="headerlink" title="1ã€æŒä¹…åŒ–"></a>1ã€æŒä¹…åŒ–</h3><blockquote><p>åœ¨è§„å®šæ—¶é—´å†…æ‰§è¡Œäº†å¤šå°‘æ“ä½œï¼Œå°±ä¼šæŒä¹…åˆ°æ–‡ä»¶ï¼ˆ.rdbã€.aofï¼‰</p><p><strong>ç”±äºredisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ•°æ®æ–­ç”µå³å¤±</strong></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¦‚æœ900så†…è‡³å°‘æœ‰ä¸€ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬å°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line">save 900 1</span><br><span class="line"><span class="comment"># å¦‚æœ300så†…è‡³å°‘æœ‰10ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬å°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line">save 300 10</span><br><span class="line"><span class="comment"># å¦‚æœ60så†…è‡³å°‘æœ‰ä¸€ä¸‡ä¸ªkeyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬å°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line">save 60 10000</span><br><span class="line"><span class="comment"># ä¹‹åæˆ‘ä»¬å¯ä»¥è®¾ç½®è‡ªå·±çš„</span></span><br></pre></td></tr></table></figure><h3 id="2ã€é™åˆ¶Clients"><a href="#2ã€é™åˆ¶Clients" class="headerlink" title="2ã€é™åˆ¶Clients"></a>2ã€é™åˆ¶Clients</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maxclients   10000  <span class="comment"># æœ€å¤šæœ‰10000ä¸ªå®¢æˆ·ç«¯èƒ½è¿æ¥ä¸Šæ­¤redis</span></span><br><span class="line"></span><br><span class="line">maxmemory    &lt;bytes&gt;  <span class="comment"># redisè®¾ç½®æœ€å¤§å†…å­˜å®¹é‡</span></span><br></pre></td></tr></table></figure><h3 id="3ã€å†…å­˜è¾¾åˆ°ä¸Šé™çš„å¤„ç†ç­–ç•¥"><a href="#3ã€å†…å­˜è¾¾åˆ°ä¸Šé™çš„å¤„ç†ç­–ç•¥" class="headerlink" title="3ã€å†…å­˜è¾¾åˆ°ä¸Šé™çš„å¤„ç†ç­–ç•¥"></a>3ã€å†…å­˜è¾¾åˆ°ä¸Šé™çš„å¤„ç†ç­–ç•¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory-policy   noeviction   <span class="comment"># å†…å­˜åˆ°è¾¾ä¸Šé™åçš„å¤„ç†ç­–ç•¥ï¼Œé»˜è®¤ä¸åˆ é™¤æ•°æ®ï¼Œç›´æ¥æŠ¥é”™</span></span><br></pre></td></tr></table></figure><blockquote><p>æœ‰å…­ç§ç­–ç•¥ï¼š</p><p>1   volatile-lru:ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„å†…å­˜æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ® æ·˜æ±°ï¼›</p><p>2    volatile-ttl: ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„å†…å­˜æ•°æ®é›†ä¸­æŒ‘é€‰å³å°†è¿‡æœŸçš„æ•°æ® æ·˜æ±°ï¼›</p><p>3    volatile-random:ä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„å†…å­˜æ•°æ®é›†ä¸­ä»»æ„æŒ‘é€‰æ•°æ® æ·˜æ±°ï¼›</p><p>4    allkeys-lru:ä»å†…å­˜æ•°æ®é›†ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ® æ·˜æ±°ï¼›</p><p>5     allkeys-random:ä»æ•°æ®é›†ä¸­ä»»æ„æŒ‘é€‰æ•°æ® æ·˜æ±°ï¼›</p><p>6     noenviction(é©±é€)ï¼šç¦æ­¢é©±é€æ•°æ®ã€‚</p></blockquote><h1 id="å…«ã€æŒä¹…åŒ–"><a href="#å…«ã€æŒä¹…åŒ–" class="headerlink" title="å…«ã€æŒä¹…åŒ–"></a>å…«ã€æŒä¹…åŒ–</h1><blockquote><p>Redisæ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œå¦‚æœä¸å¯¹Redisæ•°æ®è¿›è¡ŒæŒä¹…åŒ–æ“ä½œï¼Œé‚£ä¹ˆä¸€æ—¦æœåŠ¡å™¨è¿›ç¨‹é€€å‡ºï¼ŒæœåŠ¡å™¨ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¹Ÿä¼šæ¶ˆå¤±ã€‚</p><p>Redisçš„æŒä¹…åŒ–å¯åˆ†ä¸ºRDBï¼ˆRedis DataBaseï¼‰å’ŒAOFï¼ˆAppend Only Fileï¼‰</p></blockquote><h2 id="8-1ã€RDB"><a href="#8-1ã€RDB" class="headerlink" title="8.1ã€RDB"></a>8.1ã€RDB</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯RDB"><a href="#1ã€ä»€ä¹ˆæ˜¯RDB" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯RDB"></a>1ã€ä»€ä¹ˆæ˜¯RDB</h3><blockquote><p>åœ¨æŒ‡å®šæ—¶é—´é—´éš”å°†å†…å­˜é›†çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œæ¢å¤æ—¶å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»å…¥å†…å­˜ã€‚åœ¨è¿›è¡Œå†™å…¥çš„è¿‡ç¨‹ä¸­ï¼ŒRedisä¼š<strong>å•ç‹¬åˆ›å»º</strong>ä¸€ä¸ª<strong>å­è¿›ç¨‹</strong>ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹ç»“æŸåï¼Œå†å°†è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<strong>ä¸»çº¿ç¨‹ä¸è¿›è¡Œä»»ä½•IOæ“ä½œ</strong>ï¼Œç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚</p><p>å¦‚æœè¦è¿›è¡Œå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤å®Œæ•´æ€§å¹¶ä¸æ˜¯ç‰¹åˆ«æ•æ„Ÿï¼Œåˆ™RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ é«˜æ•ˆï¼ŒRdbçš„<strong>ç¼ºç‚¹</strong>æ˜¯<strong>æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±</strong>ï¼ŒRedis<strong>é»˜è®¤ä½¿ç”¨RDBè¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</strong>ã€‚</p></blockquote><h3 id="2ã€RDBä¿å­˜çš„æ–‡ä»¶æ˜¯dump-rdb"><a href="#2ã€RDBä¿å­˜çš„æ–‡ä»¶æ˜¯dump-rdb" class="headerlink" title="2ã€RDBä¿å­˜çš„æ–‡ä»¶æ˜¯dump.rdb"></a>2ã€RDBä¿å­˜çš„æ–‡ä»¶æ˜¯dump.rdb</h3><h3 id="3ã€ä¼˜ç‚¹ï¼š"><a href="#3ã€ä¼˜ç‚¹ï¼š" class="headerlink" title="3ã€ä¼˜ç‚¹ï¼š"></a>3ã€ä¼˜ç‚¹ï¼š</h3><ul><li>é€‚åˆå¤§è§„æ¨¡æ•°æ®æ¢å¤</li><li>å¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚ä¸é«˜</li></ul><h3 id="4ã€ç¼ºç‚¹ï¼š"><a href="#4ã€ç¼ºç‚¹ï¼š" class="headerlink" title="4ã€ç¼ºç‚¹ï¼š"></a>4ã€ç¼ºç‚¹ï¼š</h3><ul><li>éœ€è¦ä¸€å®šçš„æ—¶é—´é—´éš”è¿›ç¨‹æ“ä½œï¼Œå¦‚æœredisæ„å¤–å®•æœºï¼Œæœ€åä¸€æ¬¡ä¿®æ”¹æ•°æ®ä¼šæ¶ˆå¤±</li><li>forkè¿›ç¨‹æ—¶ä¼šå ç”¨ä¸€å®šç©ºé—´</li></ul><h3 id="5ã€è§¦å‘æœºåˆ¶"><a href="#5ã€è§¦å‘æœºåˆ¶" class="headerlink" title="5ã€è§¦å‘æœºåˆ¶"></a>5ã€è§¦å‘æœºåˆ¶</h3><ul><li>saveçš„è§„åˆ™æ»¡è¶³çš„æ¡ä»¶ä¸‹ï¼Œä¼šè‡ªåŠ¨è§¦å‘RDBè§„åˆ™</li><li>æ‰§è¡Œflashallå‘½ä»¤ï¼Œä¼šè§¦å‘RDBè§„åˆ™</li><li>é€€å‡ºredisï¼Œä¹Ÿä¼šäº§ç”Ÿrdbæ–‡ä»¶</li><li>å¤‡ä»½ç”Ÿæˆä¸€ä¸ªdump.rdbæ–‡ä»¶</li></ul><h3 id="6ã€å¦‚ä½•æ¢å¤rdbæ–‡ä»¶"><a href="#6ã€å¦‚ä½•æ¢å¤rdbæ–‡ä»¶" class="headerlink" title="6ã€å¦‚ä½•æ¢å¤rdbæ–‡ä»¶"></a>6ã€å¦‚ä½•æ¢å¤rdbæ–‡ä»¶</h3><blockquote><p>åªéœ€è¦å°†rdbæ–‡ä»¶æ”¾åœ¨rediså¯åŠ¨ç›®å½•ä¸‹å³å¯ï¼Œrediså¯åŠ¨æ—¶ä¼šæ£€æŸ¥å¹¶æ¢å¤dump.rdbä¸­çš„æ•°æ®</p></blockquote><h2 id="8-2ã€AOF"><a href="#8-2ã€AOF" class="headerlink" title="8.2ã€AOF"></a>8.2ã€AOF</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯AOF"><a href="#1ã€ä»€ä¹ˆæ˜¯AOF" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯AOF?"></a>1ã€ä»€ä¹ˆæ˜¯AOF?</h3><blockquote><p>ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰æŒ‡ä»¤<strong>ï¼ˆè¯»æ“ä½œä¸è®°å½•ï¼‰</strong>è®°å½•ä¸‹æ¥ï¼Œåªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šè¯»å–æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredisé‡å¯çš„è¯å°±è¦æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤<strong>ä»å¤´åˆ°å°¾</strong>æ‰§è¡Œä¸€æ¬¡ä»¥<strong>å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ</strong></p></blockquote><h3 id="2ã€ä½¿ç”¨"><a href="#2ã€ä½¿ç”¨" class="headerlink" title="2ã€ä½¿ç”¨"></a>2ã€ä½¿ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure><h1 id="ä¹ã€Rediså®ç°æ‰‹æœºéªŒè¯ç "><a href="#ä¹ã€Rediså®ç°æ‰‹æœºéªŒè¯ç " class="headerlink" title="ä¹ã€Rediså®ç°æ‰‹æœºéªŒè¯ç "></a>ä¹ã€Rediså®ç°æ‰‹æœºéªŒè¯ç </h1><h2 id="9-1ã€å®ç°åŸç†"><a href="#9-1ã€å®ç°åŸç†" class="headerlink" title="9.1ã€å®ç°åŸç†"></a>9.1ã€å®ç°åŸç†</h2><ul><li>ä½¿ç”¨å·¥å…·ç±»ç”Ÿæˆ4ä½æˆ–6ä½çš„æ•°å­—éªŒè¯ç </li><li>æ ¡éªŒæ‰‹æœºå·ä¸ºåˆæ³•åé€šè¿‡çŸ­ä¿¡å¾®æœåŠ¡å‘é€éªŒè¯ç </li><li>å°†æ‰‹æœºå·ä½œä¸ºkeyï¼ŒéªŒè¯ç ä½œä¸ºvalueå­˜å…¥redisä¸­ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´</li><li>ç”¨æˆ·è¿›è¡Œç™»å½•/æ³¨å†Œæ—¶é€šè¿‡keyï¼ˆæ‰‹æœºå·ï¼‰åˆ°redisä¸­å–å‡ºéªŒè¯ç </li><li>è¿›è¡ŒéªŒè¯ç æ¯”å¯¹ï¼Œè‹¥åŒ¹é…åˆ™ç™»å½•/æ³¨å†Œé€šè¿‡ï¼Œéšæœºåˆ é™¤redisä¸­çš„key-value</li></ul><h2 id="9-2ã€å®ç°"><a href="#9-2ã€å®ç°" class="headerlink" title="9.2ã€å®ç°"></a>9.2ã€å®ç°</h2><h3 id="1ã€æ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•çš„å·¥å…·ç±»"><a href="#1ã€æ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•çš„å·¥å…·ç±»" class="headerlink" title="1ã€æ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•çš„å·¥å…·ç±»"></a>1ã€æ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•çš„å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FormUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Pattern NUMBER_PATTERN = Pattern.compile(<span class="string">&quot;^[1][3,4,5,7,8,9][0-9]&#123;9&#125;$&quot;</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰‹æœºå·éªŒè¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isMobile</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//éªŒè¯æ‰‹æœºå·çš„æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">        <span class="keyword">return</span> NUMBER_PATTERN.matcher(str).matches();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ç”ŸæˆéªŒè¯ç çš„å·¥å…·ç±»"><a href="#2ã€ç”ŸæˆéªŒè¯ç çš„å·¥å…·ç±»" class="headerlink" title="2ã€ç”ŸæˆéªŒè¯ç çš„å·¥å…·ç±»"></a>2ã€ç”ŸæˆéªŒè¯ç çš„å·¥å…·ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DecimalFormat fourdf = <span class="keyword">new</span> DecimalFormat(<span class="string">&quot;0000&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DecimalFormat sixdf = <span class="keyword">new</span> DecimalFormat(<span class="string">&quot;000000&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFourBitRandom</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> fourdf.format(random.nextInt(<span class="number">10000</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSixBitRandom</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sixdf.format(random.nextInt(<span class="number">1000000</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»™å®šæ•°ç»„ï¼ŒæŠ½å–nä¸ªæ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList <span class="title">getRandom</span><span class="params">(List list, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;Object, Object&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆéšæœºæ•°å­—å¹¶å­˜å…¥HashMap</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> number = random.nextInt(<span class="number">100</span>) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">hashMap.put(number, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»HashMapå¯¼å…¥æ•°ç»„</span></span><br><span class="line">Object[] robjs = hashMap.values().toArray();</span><br><span class="line"></span><br><span class="line">ArrayList r = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ•°ç»„å¹¶æ‰“å°æ•°æ®</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">r.add(list.get((<span class="keyword">int</span>) robjs[i]));</span><br><span class="line">System.out.print(list.get((<span class="keyword">int</span>) robjs[i]) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€çŸ­ä¿¡å¾®æœåŠ¡Controller"><a href="#3ã€çŸ­ä¿¡å¾®æœåŠ¡Controller" class="headerlink" title="3ã€çŸ­ä¿¡å¾®æœåŠ¡Controller"></a>3ã€çŸ­ä¿¡å¾®æœåŠ¡Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;çŸ­ä¿¡ç®¡ç†æ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiSmsController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SmsService smsService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ä¼ å…¥çš„æ‰‹æœºå·æ¥ç”Ÿæˆå¹¶å‘é€éªŒè¯ç </span></span><br><span class="line"><span class="comment">     * å¹¶å°†éªŒè¯ç å­˜å…¥redisç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mobile æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;send/&#123;mobile&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¸€ä¸ªç”¨äºç”ŸæˆéªŒè¯ç ï¼Œå¹¶å°†éªŒè¯ç å­˜å…¥redisä¸­çš„æ¥å£&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getCode</span><span class="params">(<span class="meta">@PathVariable(&quot;mobile&quot;)</span> String mobile)</span> <span class="keyword">throws</span> ClientException </span>&#123;</span><br><span class="line">        <span class="comment">//0 æ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(mobile) || !FormUtils.isMobile(mobile)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœæ‰‹æœºå·ä¸ºç©ºæˆ–æ‰‹æœºå·ä¸åˆæ³•</span></span><br><span class="line">            log.error(<span class="string">&quot;æ‰‹æœºå·ä¸åˆæ³•ï¼&quot;</span>);</span><br><span class="line">            <span class="comment">// new GrainException(ResultCodeEnum.LOGIN_MOBILE_ERROR);</span></span><br><span class="line">            <span class="keyword">return</span> R.error().message(<span class="string">&quot;æ‰‹æœºå·ä¸æ­£ç¡®ï¼&quot;</span>).code(<span class="number">28001</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//1 ä½¿ç”¨å·¥å…·ç±»ç”Ÿæˆç”ŸæˆéªŒè¯ç </span></span><br><span class="line">        String checkCode = RandomUtils.getSixBitRandom();</span><br><span class="line">        <span class="comment">//2 å‘é€éªŒè¯ç </span></span><br><span class="line">        smsService.send(mobile,checkCode);</span><br><span class="line">        <span class="comment">//3 å­˜å‚¨éªŒè¯ç åˆ°redis</span></span><br><span class="line">        <span class="comment">//ä½¿ç”¨redisTemplateï¼Œä½¿ç”¨æ‰‹æœºå·ä½œä¸ºé”®ï¼Œä¿å­˜æ—¶é•¿ä¸º5åˆ†é’Ÿ</span></span><br><span class="line">        redisTemplate.opsForValue().set(mobile,checkCode,<span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">&quot;çŸ­ä¿¡å‘é€æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€çŸ­ä¿¡å¾®æœåŠ¡Serviceå±‚"><a href="#4ã€çŸ­ä¿¡å¾®æœåŠ¡Serviceå±‚" class="headerlink" title="4ã€çŸ­ä¿¡å¾®æœåŠ¡Serviceå±‚"></a>4ã€çŸ­ä¿¡å¾®æœåŠ¡Serviceå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SmsServiceImpl</span> <span class="keyword">implements</span> <span class="title">SmsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SmsProperties smsProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String mobile, String checkCode)</span> <span class="keyword">throws</span> ClientException, ClientException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è°ƒç”¨çŸ­ä¿¡å‘é€SDKï¼Œåˆ›å»ºclientå¯¹è±¡</span></span><br><span class="line">        DefaultProfile profile = DefaultProfile.getProfile(</span><br><span class="line">                smsProperties.getRegionId(),</span><br><span class="line">                smsProperties.getKeyId(),</span><br><span class="line">                smsProperties.getKeySecret());</span><br><span class="line">        IAcsClient client = <span class="keyword">new</span> DefaultAcsClient(profile);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»„è£…è¯·æ±‚å‚æ•°</span></span><br><span class="line">        CommonRequest request = <span class="keyword">new</span> CommonRequest();</span><br><span class="line">        request.setSysMethod(MethodType.POST);</span><br><span class="line">        request.setSysDomain(<span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span>);</span><br><span class="line">        request.setSysVersion(<span class="string">&quot;2017-05-25&quot;</span>);</span><br><span class="line">        request.setSysAction(<span class="string">&quot;SendSms&quot;</span>);</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;RegionId&quot;</span>, smsProperties.getRegionId());</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;PhoneNumbers&quot;</span>, mobile);</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;SignName&quot;</span>, smsProperties.getSignName());</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;TemplateCode&quot;</span>, smsProperties.getTemplateCode());</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; param = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        param.put(<span class="string">&quot;code&quot;</span>, checkCode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°†åŒ…å«éªŒè¯ç çš„é›†åˆè½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;TemplateParam&quot;</span>, gson.toJson(param));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘é€çŸ­ä¿¡</span></span><br><span class="line">        CommonResponse response = client.getCommonResponse(request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾—åˆ°jsonå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”ç»“æœ</span></span><br><span class="line">        String data = response.getData();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è§£æjsonå­—ç¬¦ä¸²æ ¼å¼çš„å“åº”ç»“æœ</span></span><br><span class="line">        HashMap&lt;String, String&gt; map = gson.fromJson(data, HashMap.class);</span><br><span class="line">        String code = map.get(<span class="string">&quot;Code&quot;</span>);</span><br><span class="line">        String message = map.get(<span class="string">&quot;Message&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é…ç½®å‚è€ƒï¼šçŸ­ä¿¡æœåŠ¡-&gt;ç³»ç»Ÿè®¾ç½®-&gt;å›½å†…æ¶ˆæ¯è®¾ç½®</span></span><br><span class="line">        <span class="comment">//é”™è¯¯ç å‚è€ƒï¼š</span></span><br><span class="line">        <span class="comment">//https://help.aliyun.com/document_detail/101346.html?spm=a2c4g.11186623.6.613.3f6e2246sDg6Ry</span></span><br><span class="line">        <span class="comment">//æ§åˆ¶æ‰€æœ‰çŸ­ä¿¡æµå‘é™åˆ¶ï¼ˆåŒä¸€æ‰‹æœºå·ï¼šä¸€åˆ†é’Ÿä¸€æ¡ã€ä¸€ä¸ªå°æ—¶äº”æ¡ã€ä¸€å¤©åæ¡ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;isv.BUSINESS_LIMIT_CONTROL&quot;</span>.equals(code)) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;çŸ­ä¿¡å‘é€è¿‡äºé¢‘ç¹ &quot;</span> + <span class="string">&quot;ã€codeã€‘&quot;</span> + code + <span class="string">&quot;, ã€messageã€‘&quot;</span> + message);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.SMS_SEND_ERROR_BUSINESS_LIMIT_CONTROL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;OK&quot;</span>.equals(code)) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;çŸ­ä¿¡å‘é€å¤±è´¥ &quot;</span> + <span class="string">&quot; - code: &quot;</span> + code + <span class="string">&quot;, message: &quot;</span> + message);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.SMS_SEND_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Controller"><a href="#5ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Controller" class="headerlink" title="5ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Controller"></a>5ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;ä¼šå‘˜ç®¡ç†æ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/ucenter/member&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiMemberController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberService memberService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¼šå‘˜æ³¨å†Œ&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;register&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">register</span><span class="params">(<span class="meta">@RequestBody</span> RegisterVo registerVo)</span> </span>&#123;</span><br><span class="line">        memberService.register(registerVo);</span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">&quot;æ³¨å†ŒæˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Service"><a href="#6ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Service" class="headerlink" title="6ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Service"></a>6ã€ç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡Service</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">MemberMapper</span>, <span class="title">Member</span>&gt; <span class="keyword">implements</span> <span class="title">MemberService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MemberMapper memberMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(RegisterVo registerVo)</span> </span>&#123;</span><br><span class="line">        String nickname = registerVo.getNickname();</span><br><span class="line">        String mobile = registerVo.getMobile();</span><br><span class="line">        String code = registerVo.getCode();</span><br><span class="line">        String password = registerVo.getPassword();</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(mobile) || !FormUtils.isMobile(mobile)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.LOGIN_MOBILE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(nickname) || StringUtils.isBlank(password) || StringUtils.isBlank(code)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ ¡éªŒéªŒè¯ç </span></span><br><span class="line">        String checkCode = (String)redisTemplate.opsForValue().get(mobile);</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.equals(code,checkCode)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœç”¨æˆ·è¾“å…¥éªŒè¯ç å’Œredisä¸­éªŒè¯ç ä¸ç›¸ç­‰</span></span><br><span class="line">            <span class="comment">//æ ¡éªŒå¤±è´¥</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.CODE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç”¨æˆ·æ‰‹æœºå·æ˜¯å¦æ³¨å†Œ</span></span><br><span class="line">        QueryWrapper&lt;Member&gt; memberQueryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        memberQueryWrapper.eq(<span class="string">&quot;mobile&quot;</span>,mobile);</span><br><span class="line">        Integer result = memberMapper.selectCount(memberQueryWrapper);</span><br><span class="line">        <span class="keyword">if</span>(result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GrainException(ResultCodeEnum.REGISTER_MOBLE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ³¨å†Œ</span></span><br><span class="line">        Member member = <span class="keyword">new</span> Member();</span><br><span class="line">        member.setNickname(nickname);</span><br><span class="line">        member.setMobile(mobile);</span><br><span class="line">        <span class="comment">//å¯†ç éœ€è¦åŠ å¯†</span></span><br><span class="line">        member.setPassword(MD5.encrypt(password));</span><br><span class="line">        member.setAvatar(<span class="string">&quot;http://tiebapic.baidu.com/forum/w%3D580/sign=21e19fd45010b912bfc1f6f6f3fcfcb5/c0d5d04b20a44623e5077d0d8f22720e0ef3d78e.jpg&quot;</span>);</span><br><span class="line">        member.setDisabled(<span class="keyword">false</span>);</span><br><span class="line">        memberMapper.insert(member);</span><br><span class="line">        <span class="comment">//å°†redisç¼“å­˜ä¸­çš„éªŒè¯ç åˆ é™¤</span></span><br><span class="line">        redisTemplate.delete(mobile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-3ã€æµ‹è¯•"><a href="#9-3ã€æµ‹è¯•" class="headerlink" title="9.3ã€æµ‹è¯•"></a>9.3ã€æµ‹è¯•</h2><blockquote><p>å¯åŠ¨çŸ­ä¿¡å¾®æœåŠ¡å’Œç”¨æˆ·æ³¨å†Œå¾®æœåŠ¡ï¼Œä½¿ç”¨Swaggerè¿›è¡Œæµ‹è¯•</p></blockquote><h3 id="1ã€ä½¿ç”¨çŸ­ä¿¡å¾®æœåŠ¡å‘æŒ‡å®šæ‰‹æœºå·å‘é€éªŒè¯ç "><a href="#1ã€ä½¿ç”¨çŸ­ä¿¡å¾®æœåŠ¡å‘æŒ‡å®šæ‰‹æœºå·å‘é€éªŒè¯ç " class="headerlink" title="1ã€ä½¿ç”¨çŸ­ä¿¡å¾®æœåŠ¡å‘æŒ‡å®šæ‰‹æœºå·å‘é€éªŒè¯ç "></a>1ã€ä½¿ç”¨çŸ­ä¿¡å¾®æœåŠ¡å‘æŒ‡å®šæ‰‹æœºå·å‘é€éªŒè¯ç </h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204000422.png" alt="image-20210204000422442"></p><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204000623.png" alt="image-20210204000623694"></p><h3 id="2ã€æŸ¥çœ‹Redisç¼“å­˜å’ŒçŸ­ä¿¡"><a href="#2ã€æŸ¥çœ‹Redisç¼“å­˜å’ŒçŸ­ä¿¡" class="headerlink" title="2ã€æŸ¥çœ‹Redisç¼“å­˜å’ŒçŸ­ä¿¡"></a>2ã€æŸ¥çœ‹Redisç¼“å­˜å’ŒçŸ­ä¿¡</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204000652.png" alt="image-20210204000652056"></p><blockquote><p>çŸ­ä¿¡</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204001029.png" alt="image-20210204001029230"></p><h3 id="3ã€æ‰“å¼€ç”¨æˆ·ä¸­å¿ƒå¾®æœåŠ¡è¿›è¡Œæµ‹è¯•"><a href="#3ã€æ‰“å¼€ç”¨æˆ·ä¸­å¿ƒå¾®æœåŠ¡è¿›è¡Œæµ‹è¯•" class="headerlink" title="3ã€æ‰“å¼€ç”¨æˆ·ä¸­å¿ƒå¾®æœåŠ¡è¿›è¡Œæµ‹è¯•"></a>3ã€æ‰“å¼€ç”¨æˆ·ä¸­å¿ƒå¾®æœåŠ¡è¿›è¡Œæµ‹è¯•</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204000749.png" alt="image-20210204000749533"></p><h3 id="4ã€ç»“æœ"><a href="#4ã€ç»“æœ" class="headerlink" title="4ã€ç»“æœ"></a>4ã€ç»“æœ</h3><blockquote><p>swaggeræç¤ºæ³¨å†ŒæˆåŠŸ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204000814.png" alt="image-20210204000813999"></p><blockquote><p>redisç¼“å­˜ä¸­è¯¥é”®å€¼å¯¹è¢«åˆ é™¤</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204000908.png" alt="image-20210204000908928"></p><blockquote><p>æ•°æ®åº“</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204000944.png" alt="image-20210204000944206"></p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså­¦ä¹ æ‰‹å†Œï¼ˆäºŒï¼‰--äº‹åŠ¡ã€Jediså’ŒSpring Bootæ•´åˆRedis</title>
      <link href="posts/2589988718.html"/>
      <url>posts/2589988718.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="å››ã€äº‹åŠ¡"><a href="#å››ã€äº‹åŠ¡" class="headerlink" title="å››ã€äº‹åŠ¡"></a>å››ã€äº‹åŠ¡</h1><h2 id="4-1ã€ä»‹ç»"><a href="#4-1ã€ä»‹ç»" class="headerlink" title="4.1ã€ä»‹ç»"></a>4.1ã€ä»‹ç»</h2><blockquote><p>Redisäº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»è¿‡ç¨‹ï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ï¼Œredisäº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚</p></blockquote><h2 id="4-2ã€Redisäº‹åŠ¡çš„ç‰¹æ€§"><a href="#4-2ã€Redisäº‹åŠ¡çš„ç‰¹æ€§" class="headerlink" title="4.2ã€Redisäº‹åŠ¡çš„ç‰¹æ€§"></a>4.2ã€Redisäº‹åŠ¡çš„ç‰¹æ€§</h2><blockquote><p>å•ç‹¬çš„éš”ç¦»æ“ä½œï¼š</p><ul><li>äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­</li></ul></blockquote><blockquote><p>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</p><ul><li>é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…çš„è¢«æ‰§è¡Œã€‚</li></ul></blockquote><blockquote><p>ä¸ä¿è¯åŸå­æ€§</p><ul><li>RedisåŒä¸€ä¸ªäº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</li></ul></blockquote><h2 id="4-3ã€ä½¿ç”¨"><a href="#4-3ã€ä½¿ç”¨" class="headerlink" title="4.3ã€ä½¿ç”¨"></a>4.3ã€ä½¿ç”¨</h2><ul><li>å¼€å¯äº‹åŠ¡ï¼ˆmultiï¼‰</li><li>å‘½ä»¤å…¥é˜Ÿ</li><li>æ‰§è¡Œäº‹åŠ¡ï¼ˆexecï¼‰</li></ul><blockquote><p>æ­£å¸¸æ‰§è¡Œäº‹åŠ¡</p></blockquote><ul><li>ä½¿ç”¨redisäº‹åŠ¡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi    <span class="comment"># å¼€å¯äº‹åŠ¡</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1   <span class="comment"># QUEUEDä»£è¡¨å‘½ä»¤å…¥é˜Ÿåˆ—</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k4 1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>       <span class="comment"># execä»£è¡¨æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) <span class="string">&quot;v1&quot;</span></span><br><span class="line">4) OK</span><br><span class="line">5) OK</span><br><span class="line">6) (<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure><blockquote><p>æ”¾å¼ƒäº‹åŠ¡ï¼ˆdiscardï¼‰</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k3 1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby k3 50</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; decrby k3 26</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; DISCARD</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">(nil)         <span class="comment">#æ”¾å¼ƒäº‹åŠ¡åå‘ç°k3å€¼ä¸ºnull</span></span><br></pre></td></tr></table></figure><blockquote><p>ï¼ˆæŠ¥å‘Šé”™è¯¯ï¼‰ç¼–è¯‘å‹å¼‚å¸¸ï¼ˆä»£ç /å‘½ä»¤æœ‰é—®é¢˜ï¼‰ï¼Œ<strong>äº‹åŠ¡ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šè¢«æ‰§è¡Œ</strong></p></blockquote><blockquote><p>ï¼ˆæ‰§è¡Œé”™è¯¯ï¼‰è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆä¾‹å¦‚ï¼š1/0æˆ–ç©ºæŒ‡é’ˆï¼‰ï¼Œå¦‚æœäº‹åŠ¡é˜Ÿåˆ—ä¸­å­˜åœ¨è¿è¡Œæ—¶å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™æ¡å‘ç”Ÿå¼‚å¸¸çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œå…¶ä»–å‘½ä»¤ç»§ç»­æ‰§è¡Œï¼ˆredisäº‹åŠ¡æ²¡æœ‰ä¸€è‡´æ€§ï¼‰ï¼Œé”™è¯¯å‘½ä»¤æŠ›å‡ºå¼‚å¸¸</p></blockquote><blockquote><p>åŸå­æ€§ï¼šæŒ‡äº‹åŠ¡çš„ä¸å¯åˆ†å‰²æ€§ï¼Œä¸€ä¸ªäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œè¦ä¹ˆä¸é—´æ–­åœ°å…¨éƒ¨è¢«æ‰§è¡Œï¼Œè¦ä¹ˆä¸€ä¸ªä¹Ÿæ²¡æœ‰æ‰§è¡Œã€‚</p></blockquote><h2 id="4-4ã€æ³¨æ„ç‚¹"><a href="#4-4ã€æ³¨æ„ç‚¹" class="headerlink" title="4.4ã€æ³¨æ„ç‚¹"></a>4.4ã€æ³¨æ„ç‚¹</h2><blockquote><p><strong>Rediså•æ¡å‘½ä»¤æ˜¯ä¿è¯åŸå­æ€§çš„ï¼Œä½†æ˜¯Redisçš„äº‹åŠ¡æ˜¯ä¸ä¿è¯åŸå­æ€§çš„ï¼</strong></p></blockquote><h2 id="4-5ã€ç›‘æ§"><a href="#4-5ã€ç›‘æ§" class="headerlink" title="4.5ã€ç›‘æ§"></a>4.5ã€ç›‘æ§</h2><h3 id="1ã€æ‚²è§‚é”"><a href="#1ã€æ‚²è§‚é”" class="headerlink" title="1ã€æ‚²è§‚é”"></a>1ã€æ‚²è§‚é”</h3><ul><li>æ— è®ºåšä»€ä¹ˆéƒ½åŠ é”ï¼ˆä¼šå½±å“æ€§èƒ½ï¼‰</li></ul><h3 id="2ã€ä¹è§‚é”"><a href="#2ã€ä¹è§‚é”" class="headerlink" title="2ã€ä¹è§‚é”"></a>2ã€ä¹è§‚é”</h3><ul><li>è®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¸ä¼šå‡ºé—®é¢˜ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼æ›´æ–°æ•°æ®æ—¶å»åˆ¤æ–­ä»¥ä¸‹æœŸé—´æœ‰æ²¡æœ‰äººä¿®æ”¹è¿‡æ­¤æ•°æ®ã€‚</li><li>mysqlä¸­ï¼šè·å–versionï¼Œæ¯”è¾ƒversion</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203224610.png" alt="image-20210203224610835"></p><h3 id="3ã€ä½¿ç”¨watchæ¥ç›‘æ§"><a href="#3ã€ä½¿ç”¨watchæ¥ç›‘æ§" class="headerlink" title="3ã€ä½¿ç”¨watchæ¥ç›‘æ§"></a>3ã€ä½¿ç”¨watchæ¥ç›‘æ§</h3><blockquote><p>åœ¨æ‰§è¡Œmultiä¹‹å‰ï¼Œå…ˆæ‰§è¡Œwatch key1 [key2]ï¼Œå¯ä»¥ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkeyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ªï¼ˆæˆ–è¿™äº›ï¼‰keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«<strong>æ‰“æ–­</strong></p></blockquote><ul><li>æ­£å¸¸æ‰§è¡ŒæˆåŠŸ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money       <span class="comment">#ä½¿ç”¨watchç›‘è§†moneyå¯¹è±¡</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure><h1 id="äº”ã€Jedis"><a href="#äº”ã€Jedis" class="headerlink" title="äº”ã€Jedis"></a>äº”ã€Jedis</h1><blockquote><p>JRedisæ˜¯Rediså®˜æ–¹æ¨èçš„javaè¿æ¥å¼€å‘å·¥å…·ï¼Œä½¿ç”¨javaæ“ä½œredisçš„ä¸­é—´ä»¶ï¼Œç±»ä¼¼JDBCDriver</p></blockquote><h2 id="5-1ã€å¸¸ç”¨API"><a href="#5-1ã€å¸¸ç”¨API" class="headerlink" title="5.1ã€å¸¸ç”¨API"></a>5.1ã€å¸¸ç”¨API</h2><h3 id="1ã€å¯¼å…¥ä¾èµ–"><a href="#1ã€å¯¼å…¥ä¾èµ–" class="headerlink" title="1ã€å¯¼å…¥ä¾èµ–"></a>1ã€å¯¼å…¥ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¯¼å…¥Jedisçš„åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€ç¼–ç æµ‹è¯•"><a href="#2ã€ç¼–ç æµ‹è¯•" class="headerlink" title="2ã€ç¼–ç æµ‹è¯•"></a>2ã€ç¼–ç æµ‹è¯•</h3><blockquote><p>ä½¿ç”¨Jedisè¿æ¥Redis</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPing</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1 new ä¸€ä¸ªJediså¯¹è±¡ï¼Œæ„é€ å‚æ•°å¡«å…¥åœ°å€å’Œç«¯å£å·</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//jedis çš„å‡½æ•°å°±æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„æ‰€æœ‰å‘½ä»¤</span></span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203225023.png" alt="image-20210203225023793"></p><h3 id="3ã€æ“ä½œå‘½ä»¤"><a href="#3ã€æ“ä½œå‘½ä»¤" class="headerlink" title="3ã€æ“ä½œå‘½ä»¤"></a>3ã€æ“ä½œå‘½ä»¤</h3><blockquote><p>Jedisçš„æ–¹æ³•å’Œä¸Šé¢çš„å‘½ä»¤å‡ ä¹ä¸€æ ·ï¼Œè¿™é‡Œåˆ—å‡ºRedis-keyçš„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;æ¸…ç©ºæŒ‡å®šæ•°æ®åº“ä¸­çš„æ•°æ®ï¼š&quot;</span> + jedis.flushDB());</span><br><span class="line">System.out.println(<span class="string">&quot;æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼š&quot;</span> + jedis.flushAll());</span><br><span class="line">System.out.println(<span class="string">&quot;æ–°å¢&lt;&#x27;username&#x27;,&#x27;wuhu&#x27;&gt;çš„é”®å€¼å¯¹ï¼š&quot;</span> + jedis.set(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;wuhu&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;æ–°å¢&lt;&#x27;password&#x27;,&#x27;qifei&#x27;&gt;çš„é”®å€¼å¯¹ï¼š&quot;</span> + jedis.set(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;qifei&quot;</span>));</span><br><span class="line">System.out.print(<span class="string">&quot;ç³»ç»Ÿä¸­æ‰€æœ‰çš„é”®å¦‚ä¸‹ï¼š&quot;</span>);</span><br><span class="line">Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">System.out.println(keys);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ é™¤é”®passwordï¼š&quot;</span> + jedis.del(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ¤æ–­é”®passwordæ˜¯å¦å­˜åœ¨ï¼š&quot;</span> + jedis.exists(<span class="string">&quot;password&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;æŸ¥çœ‹é”®usernameæ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹&quot;</span> + jedis.type(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;éšæœºè¿”å›keyç©ºé—´çš„ä¸€ä¸ª&quot;</span> + jedis.randomKey());</span><br><span class="line">System.out.println(<span class="string">&quot;é‡å‘½åkeyï¼š&quot;</span> + jedis.rename(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;userName&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;å–å‡ºæ”¹åçš„userNameï¼š&quot;</span> + jedis.get(<span class="string">&quot;userName&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;æŒ‰ç´¢å¼•æŸ¥è¯¢ï¼š&quot;</span> + jedis.select(<span class="number">0</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;è¿”å›å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°é‡ï¼š&quot;</span> + jedis.dbSize());</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­æ‰€æœ‰çš„keyï¼š&quot;</span> + jedis.flushDB());</span><br><span class="line">System.out.println(<span class="string">&quot;è¿”å›å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°é‡ï¼š&quot;</span> + jedis.dbSize());</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­é‚£ä¸ªæ‰€æœ‰keyï¼š&quot;</span> + jedis.flushAll());</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203225132.png" alt="image-20210203225132042"></p><blockquote><p>æ–­å¼€è¿æ¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jedis.close();</span><br></pre></td></tr></table></figure><h2 id="5-2ã€ä½¿ç”¨Jedisæ¨¡æ‹ŸRedisä¸­çš„äº‹åŠ¡"><a href="#5-2ã€ä½¿ç”¨Jedisæ¨¡æ‹ŸRedisä¸­çš„äº‹åŠ¡" class="headerlink" title="5.2ã€ä½¿ç”¨Jedisæ¨¡æ‹ŸRedisä¸­çš„äº‹åŠ¡"></a>5.2ã€ä½¿ç”¨Jedisæ¨¡æ‹ŸRedisä¸­çš„äº‹åŠ¡</h2><h3 id="1ã€æ¨¡æ‹Ÿäº‹åŠ¡æˆåŠŸæ‰§è¡Œ"><a href="#1ã€æ¨¡æ‹Ÿäº‹åŠ¡æˆåŠŸæ‰§è¡Œ" class="headerlink" title="1ã€æ¨¡æ‹Ÿäº‹åŠ¡æˆåŠŸæ‰§è¡Œ"></a>1ã€æ¨¡æ‹Ÿäº‹åŠ¡æˆåŠŸæ‰§è¡Œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">jsonObject.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wuhu&quot;</span>);</span><br><span class="line">jsonObject.put(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">String jsonStr = jsonObject.toJSONString();</span><br><span class="line"><span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">Transaction multi = jedis.multi();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//å°†æ–¹æ³•æ”¾å…¥æ‰§è¡Œé˜Ÿåˆ—</span></span><br><span class="line">    multi.set(<span class="string">&quot;user1&quot;</span>,jsonStr);</span><br><span class="line">    multi.set(<span class="string">&quot;user2&quot;</span>,jsonStr);</span><br><span class="line">    multi.set(<span class="string">&quot;user3&quot;</span>,jsonStr);</span><br><span class="line">    multi.set(<span class="string">&quot;user4&quot;</span>,jsonStr);</span><br><span class="line">    <span class="comment">//æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">    multi.exec();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå°±æ”¾å¼ƒäº‹åŠ¡</span></span><br><span class="line">    multi.discard();</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥è¾“å‡ºå€¼</span></span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user1&quot;</span>));</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user2&quot;</span>));</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user3&quot;</span>));</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user4&quot;</span>));</span><br><span class="line">    jedis.close();<span class="comment">//å…³é—­è¿æ¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203225306.png" alt="image-20210203225306161"></p><h3 id="2ã€æ¨¡æ‹Ÿäº‹åŠ¡å‡ºç°å¼‚å¸¸çš„æƒ…å†µ"><a href="#2ã€æ¨¡æ‹Ÿäº‹åŠ¡å‡ºç°å¼‚å¸¸çš„æƒ…å†µ" class="headerlink" title="2ã€æ¨¡æ‹Ÿäº‹åŠ¡å‡ºç°å¼‚å¸¸çš„æƒ…å†µ"></a>2ã€æ¨¡æ‹Ÿäº‹åŠ¡å‡ºç°å¼‚å¸¸çš„æƒ…å†µ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">jedis.flushAll();<span class="comment">//å…ˆæ¸…é™¤æ‰€æœ‰é”®å€¼å¯¹</span></span><br><span class="line">JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">jsonObject.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wuhu&quot;</span>);</span><br><span class="line">jsonObject.put(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">String jsonStr = jsonObject.toJSONString();</span><br><span class="line"><span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">Transaction multi = jedis.multi();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//å°†æ–¹æ³•æ”¾å…¥æ‰§è¡Œé˜Ÿåˆ—</span></span><br><span class="line">    multi.set(<span class="string">&quot;user1&quot;</span>,jsonStr);</span><br><span class="line">    multi.set(<span class="string">&quot;user2&quot;</span>,jsonStr);</span><br><span class="line">    multi.set(<span class="string">&quot;user3&quot;</span>,jsonStr);</span><br><span class="line">    multi.set(<span class="string">&quot;user4&quot;</span>,jsonStr);</span><br><span class="line">    <span class="comment">//æ¨¡æ‹Ÿå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">    multi.exec();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå°±æ”¾å¼ƒäº‹åŠ¡</span></span><br><span class="line">    multi.discard();</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼Œé‚£ä¹ˆå¯ä»¥è¾“å‡ºå€¼</span></span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user1&quot;</span>));</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user2&quot;</span>));</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user3&quot;</span>));</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;user4&quot;</span>));</span><br><span class="line">    jedis.close();<span class="comment">//å…³é—­è¿æ¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203225346.png" alt="image-20210203225346130"></p><h1 id="å…­ã€Spring-Bootæ•´åˆRedis"><a href="#å…­ã€Spring-Bootæ•´åˆRedis" class="headerlink" title="å…­ã€Spring Bootæ•´åˆRedis"></a>å…­ã€Spring Bootæ•´åˆRedis</h1><blockquote><p>Spring Boot Data redisæä¾›äº†<strong>RedisTemplate</strong>å’Œ<strong>StringTemplate</strong>ï¼Œå…¶ä¸­StringTemplateæ˜¯RedisTemplateçš„å­ç±»ï¼ŒRedisTemplateä¸­ä¸¤ä¸ªæ³›å‹éƒ½æ˜¯Objectï¼Œæ„å‘³ç€å­˜å‚¨çš„keyå’Œvalueéƒ½å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€ŒStringTemplateä¸¤ä¸ªæ³›å‹éƒ½æ˜¯String</p><p><strong>æ³¨ï¼šå¯¹è±¡çš„ä¿å­˜éœ€è¦åºåˆ—åŒ–</strong></p></blockquote><h2 id="6-1ã€å¼•å…¥ä¾èµ–"><a href="#6-1ã€å¼•å…¥ä¾èµ–" class="headerlink" title="6.1ã€å¼•å…¥ä¾èµ–"></a>6.1ã€å¼•å…¥ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ“ä½œredis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨springboot2.xåï¼ŒåŸæ¥çš„jedisè¢«æ›¿æ¢ä¸ºäº†lecture</li><li>jedisï¼šé‡‡ç”¨ç›´è¿ï¼Œå¤šçº¿ç¨‹æ“ä½œä¸å®‰å…¨ï¼Œéœ€è¦ä½¿ç”¨è¿æ¥æ± ï¼ŒBIO</li><li>lectureï¼šåº•å±‚ä½¿ç”¨nettyï¼Œä¸å­˜åœ¨æ€§èƒ½ä¸å®‰å…¨çš„æƒ…å†µ,NIO</li></ul><h2 id="6-2ã€é…ç½®"><a href="#6-2ã€é…ç½®" class="headerlink" title="6.2ã€é…ç½®"></a>6.2ã€é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure><h2 id="6-3ã€æµ‹è¯•"><a href="#6-3ã€æµ‹è¯•" class="headerlink" title="6.3ã€æµ‹è¯•"></a>6.3ã€æµ‹è¯•</h2><blockquote><p>åˆ†ææºç å¯çŸ¥ï¼ŒSpring Bootå·²ç»ä¸ºæˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ª<strong>keyå’Œvalueå‡ä¸ºObject</strong>çš„RedisTemplateï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ³¨å†Œä¸€ä¸ª<strong>RedisTemplate</strong>æ¥æ›¿æ¢Spring Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨æ³¨å…¥çš„RedisTemplate</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203225717.png" alt="image-20210203225717224"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//redisTemplate</span></span><br><span class="line">    <span class="comment">//opsForValue æ“ä½œå­—ç¬¦ä¸²ï¼Œç±»ä¼¼String</span></span><br><span class="line">    <span class="comment">//opsForList  æ“ä½œlistï¼Œç±»ä¼¼List</span></span><br><span class="line">    <span class="comment">//opsForSet   æ“ä½œSetï¼Œç±»ä¼¼Set</span></span><br><span class="line">    <span class="comment">//opsForZset  æ“ä½œZsetï¼Œç±»ä¼¼Zset</span></span><br><span class="line">    <span class="comment">//opsForHash  æ“ä½œHashï¼Œç±»ä¼¼Hash</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŸºæœ¬æ“ä½œå·²ç»å°è£…åˆ°redisTemplateä¸­</span></span><br><span class="line">    <span class="comment">//        RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span></span><br><span class="line">    <span class="comment">//        connection.flushAll();</span></span><br><span class="line">    <span class="comment">//        connection.flushDb();</span></span><br><span class="line"></span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;value&quot;</span>);</span><br><span class="line">    System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;key&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Spring Boot é»˜è®¤ä½¿ç”¨JDKåºåˆ—åŒ–ï¼ŒJDKåºåˆ—åŒ–ä¼šä½¿å­—ç¬¦è½¬ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰é…ç½®ç±»ï¼Œä½¿ç”¨JSONè¿›è¡Œåºåˆ—åŒ–ã€‚</p></blockquote><h2 id="6-4ã€è‡ªå®šä¹‰RedisTemplate"><a href="#6-4ã€è‡ªå®šä¹‰RedisTemplate" class="headerlink" title="6.4ã€è‡ªå®šä¹‰RedisTemplate"></a>6.4ã€è‡ªå®šä¹‰RedisTemplate</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è‡ªå®šä¹‰çš„RedisTemplateä¸­ï¼Œå°†é”®ä»Objectæ¢ä¸ºStringï¼ŒåŒæ—¶ä½¿ç”¨JSONåºåˆ—åŒ–å¯¹è±¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       User user = <span class="keyword">new</span> User(<span class="number">1</span>,<span class="string">&quot;èŠœæ¹–&quot;</span>,<span class="string">&quot;èµ·é£&quot;</span>);</span><br><span class="line">       String userJson = JSON.toJSONString(user);</span><br><span class="line">       redisTemplate.opsForValue().set(<span class="string">&quot;user2&quot;</span>,userJson);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="1ã€ä½¿ç”¨JDKåºåˆ—åŒ–å¯¹è±¡"><a href="#1ã€ä½¿ç”¨JDKåºåˆ—åŒ–å¯¹è±¡" class="headerlink" title="1ã€ä½¿ç”¨JDKåºåˆ—åŒ–å¯¹è±¡"></a>1ã€ä½¿ç”¨JDKåºåˆ—åŒ–å¯¹è±¡</h3><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203231614.png" alt="image-20210203231614676"></p><h3 id="2ã€ä½¿ç”¨JSONåºåˆ—åŒ–å¯¹è±¡"><a href="#2ã€ä½¿ç”¨JSONåºåˆ—åŒ–å¯¹è±¡" class="headerlink" title="2ã€ä½¿ç”¨JSONåºåˆ—åŒ–å¯¹è±¡"></a>2ã€ä½¿ç”¨JSONåºåˆ—åŒ–å¯¹è±¡</h3><blockquote><p>åˆ é™¤Redisä¸­çš„é”®å€¼å¯¹ï¼Œå¼•å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„RedisTemplateï¼Œé‡æ–°æ‰§è¡Œä¸Šé¢çš„æ–¹æ³•ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203231754.png" alt="image-20210203231753977"></p><h2 id="6-5ã€RedisUtils"><a href="#6-5ã€RedisUtils" class="headerlink" title="6.5ã€RedisUtils"></a>6.5ã€RedisUtils</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hzx.springboot_redis.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// =============================common============================</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ falseä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================String=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜è·å–</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜æ”¾å…¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueæˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueæˆåŠŸ false å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta è¦å¢åŠ å‡ (å¤§äº0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;é€’å¢å› å­å¿…é¡»å¤§äº0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta è¦å‡å°‘å‡ (å°äº0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;é€’å‡å› å­å¿…é¡»å¤§äº0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================Map=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯¹åº”çš„å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hmget</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map å¯¹åº”å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet å¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map  å¯¹åº”å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueæˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’) æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤hashè¡¨ä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ falseä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   è¦å¢åŠ å‡ (å¤§äº0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hashé€’å‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   è¦å‡å°‘è®°(å°äº0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================set=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ falseä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆåŠŸä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆåŠŸä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">                expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–setç¼“å­˜çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤å€¼ä¸ºvalueçš„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç§»é™¤çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRemove</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–listç¼“å­˜çš„å†…å®¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start å¼€å§‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   ç»“æŸ 0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lGet</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–listç¼“å­˜çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼• index&gt;=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index&lt;0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">                expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">                expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count ç§»é™¤å¤šå°‘ä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç§»é™¤çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rediså­¦ä¹ æ‰‹å†Œï¼ˆä¸€ï¼‰--NoSQLã€rediså…¥é—¨åŠåŸºæœ¬æ•°æ®ç±»å‹</title>
      <link href="posts/2005124203.html"/>
      <url>posts/2005124203.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€NoSQL"><a href="#ä¸€ã€NoSQL" class="headerlink" title="ä¸€ã€NoSQL"></a>ä¸€ã€NoSQL</h1><blockquote><p>NoSQL = Not Only SQLï¼Œä¸ä»…ä»…æ˜¯SQLï¼Œæ³›æŒ‡éå…³ç³»æ•°æ®åº“</p><p>ä½¿ç”¨åœºæ™¯ï¼šæ•°æ®å˜åŒ–ä¸æ˜¯å¾ˆé¢‘ç¹ï¼Œè®¿é—®é‡ç›¸å¯¹è¾ƒå¤§</p></blockquote><h1 id="äºŒã€Rediså…¥é—¨"><a href="#äºŒã€Rediså…¥é—¨" class="headerlink" title="äºŒã€Rediså…¥é—¨"></a>äºŒã€Rediså…¥é—¨</h1><h2 id="2-1ã€æ¦‚è¿°"><a href="#2-1ã€æ¦‚è¿°" class="headerlink" title="2.1ã€æ¦‚è¿°"></a>2.1ã€æ¦‚è¿°</h2><ul><li><p>RedisæŒ‡Remote Dictionary Serverï¼Œå³<strong>è¿œç¨‹å­—å…¸æœåŠ¡</strong></p></li><li><p>ä¸€ä¸ªå¼€æºçš„ç”±ANSI Cè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜ä¹Ÿå¯æŒä¹…åŒ–çš„æ—¥å¿—å‹Key-valueæ•°æ®åº“ï¼Œæ”¯æŒå¤šç§è¯­è¨€</p></li><li><p>redisä¼šå‘¨æœŸæ€§å°†æ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶</p></li></ul><h2 id="2-2ã€ç‰¹æ€§"><a href="#2-2ã€ç‰¹æ€§" class="headerlink" title="2.2ã€ç‰¹æ€§"></a>2.2ã€ç‰¹æ€§</h2><ul><li>å¼€æº</li><li>æ”¯æŒå¤šç§è¯­è¨€</li><li>æ”¯æŒæŒä¹…åŒ–ã€é›†ç¾¤å’Œäº‹åŠ¡</li></ul><h2 id="2-3ã€åŸºç¡€çŸ¥è¯†"><a href="#2-3ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="2.3ã€åŸºç¡€çŸ¥è¯†"></a>2.3ã€åŸºç¡€çŸ¥è¯†</h2><ul><li>redisæœ‰16ä¸ªæ•°æ®åº“ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬1ä¸ªæ•°æ®åº“ï¼ˆä¸‹æ ‡ä¸º0ï¼‰</li><li>ä½¿ç”¨selectå¯ä»¥åˆ‡æ¢æ•°æ®åº“ï¼Œä½¿ç”¨DBSIZEå¯ä»¥æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„æ•°æ®æ•°é‡</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203220924.png"></p><ul><li>æ¸…é™¤å½“å‰æ•°æ®åº“ï¼šflushdb</li><li>æ¸…æ¥šæ‰€æœ‰æ•°æ®åº“ï¼šflushall</li><li>redisæ˜¯å•çº¿ç¨‹çš„ï¼Œredisçš„ç“¶é¢ˆæ˜¯æ ¹æ®æœºå™¨çš„å†…å­˜å’Œç½‘ç»œå¸¦å®½ã€‚</li></ul><h1 id="ä¸‰ã€äº”å¤§æ•°æ®ç±»å‹"><a href="#ä¸‰ã€äº”å¤§æ•°æ®ç±»å‹" class="headerlink" title="ä¸‰ã€äº”å¤§æ•°æ®ç±»å‹"></a>ä¸‰ã€äº”å¤§æ•°æ®ç±»å‹</h1><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203221317.png" alt="image-20210203221317019"></p><h2 id="3-1ã€Redis-key"><a href="#3-1ã€Redis-key" class="headerlink" title="3.1ã€Redis-key"></a>3.1ã€Redis-key</h2><blockquote><p>EXISTS é”®åï¼Œå¦‚æœæœ‰è¿™ä¸ªé”®ï¼Œè¿”å›1ï¼Œå¦åˆ™è¿”å›0<br>exists é”®å</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203221451.png" alt="image-20201011214514520"></p><h2 id="3-2ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰"><a href="#3-2ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰" class="headerlink" title="3.2ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰"></a>3.2ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</h2><h3 id="1ã€append-é”®å-è¦è¿½åŠ çš„å†…å®¹ï¼š"><a href="#1ã€append-é”®å-è¦è¿½åŠ çš„å†…å®¹ï¼š" class="headerlink" title="1ã€append é”®å è¦è¿½åŠ çš„å†…å®¹ï¼š"></a>1ã€append é”®å è¦è¿½åŠ çš„å†…å®¹ï¼š</h3><blockquote><p>å¾€å·²æœ‰çš„é”®å€¼å¯¹çš„å€¼ä¸­æ‹¼æ¥æ–°å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰è¯¥é”®ï¼Œé‚£ä¹ˆå°±æ–°å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼ˆç›¸å½“äºsetï¼‰</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> name hello</span><br><span class="line">get name</span><br><span class="line">è¾“å‡ºhello</span><br><span class="line">append name world</span><br><span class="line">è¾“å‡º10--&gt;è¿”å›æ‹¼æ¥åå€¼çš„é•¿åº¦</span><br><span class="line">get name</span><br><span class="line">è¾“å‡ºhelloworld</span><br></pre></td></tr></table></figure><ul><li>å…ˆè®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå³nameâ€“&gt;helloï¼Œç„¶åå¾€è¯¥é”®å€¼å¯¹çš„å€¼ä¸­æ‹¼æ¥å­—ç¬¦worldï¼Œæœ€åä½¿ç”¨get nameæŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142557.png" alt="image-20201011222603013"></p><h3 id="2ã€strlen-é”®å-ï¼š"><a href="#2ã€strlen-é”®å-ï¼š" class="headerlink" title="2ã€strlen é”®å ï¼š"></a>2ã€strlen é”®å ï¼š</h3><blockquote><p>è·å–è¯¥é”®å€¼å¯¹ä¸­å€¼çš„é•¿åº¦</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strlen name</span><br><span class="line">è¾“å‡º10</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142558.png" alt="image-20201011222916865"></p><h3 id="3ã€incr-é”®åï¼š"><a href="#3ã€incr-é”®åï¼š" class="headerlink" title="3ã€incr é”®åï¼š"></a>3ã€incr é”®åï¼š</h3><blockquote><p>é’ˆå¯¹æ•°å€¼ä½¿ç”¨ï¼Œè®©æ•°å€¼çš„å€¼+1</p></blockquote><ul><li>åˆå§‹åŒ–ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆviewsâ€“0ï¼‰ï¼Œç„¶åä½¿ç”¨incr å‘½ä»¤è®©å…¶+1</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> views 0</span><br><span class="line">è¾“å‡º0</span><br><span class="line">incr views</span><br><span class="line">get views</span><br><span class="line">è¾“å‡º1</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142559.png" alt="image-20201011224023734"></p><h3 id="4ã€decr-é”®åï¼š"><a href="#4ã€decr-é”®åï¼š" class="headerlink" title="4ã€decr é”®åï¼š"></a>4ã€decr é”®åï¼š</h3><blockquote><p>åŒé’ˆå¯¹æ•°å€¼ä½¿ç”¨ï¼Œè®©è¯¥æ•°å€¼çš„å€¼-1</p></blockquote><ul><li>å°†ä¸Šé¢çš„viewsä»3å‡åˆ°2</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decr views</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142600.png" alt="image-20201011224227673"></p><h3 id="5ã€incrby-decrbyï¼š"><a href="#5ã€incrby-decrbyï¼š" class="headerlink" title="5ã€incrby/decrbyï¼š"></a>5ã€incrby/decrbyï¼š</h3><blockquote><p>ç±»ä¼¼incr/decrï¼Œå¤šäº†ä¸ªæ­¥é•¿</p></blockquote><ul><li>å°†viewsçš„å€¼ä»2ç›´æ¥åŠ åˆ°12ï¼ˆæ­¥é•¿è®¾ç½®ä¸º10ï¼‰ï¼Œç„¶åæŠŠviewsçš„å€¼ä»12é™åˆ°7ï¼ˆæ­¥é•¿ä¸º5ï¼‰</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">incrby views 10</span><br><span class="line">decrby views 5</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142601.png" alt="image-20201011224913175"></p><h3 id="6ã€GETRANGE-é”®å-èµ·å§‹åæ ‡-ç»ˆæ­¢åæ ‡ï¼ˆç±»ä¼¼javaä¸­Stringç±»çš„substringï¼‰"><a href="#6ã€GETRANGE-é”®å-èµ·å§‹åæ ‡-ç»ˆæ­¢åæ ‡ï¼ˆç±»ä¼¼javaä¸­Stringç±»çš„substringï¼‰" class="headerlink" title="6ã€GETRANGE é”®å èµ·å§‹åæ ‡ ç»ˆæ­¢åæ ‡ï¼ˆç±»ä¼¼javaä¸­Stringç±»çš„substringï¼‰"></a>6ã€GETRANGE é”®å èµ·å§‹åæ ‡ ç»ˆæ­¢åæ ‡ï¼ˆç±»ä¼¼javaä¸­Stringç±»çš„substringï¼‰</h3><blockquote><p>æˆªå–ï¼ˆç»ˆæ­¢åæ ‡ - èµ·å§‹åæ ‡ï¼‰ + 1ä¸ªå­—ç¬¦ï¼Œé—­åŒºé—´[èµ·å§‹,ç»ˆæ­¢]</p></blockquote><ul><li>è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œç„¶åæˆªå–è¯¥å€¼çš„ä¸€éƒ¨åˆ†</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142602.png" alt="image-20201011225254904"></p><blockquote><p>ä½¿ç”¨GETRANGE é”®å 0  -1è·å–å€¼å¯¹åº”çš„æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œç›¸å½“äºget é”®å</p></blockquote><ul><li>è·å–è¯¥é”®å€¼å¯¹å€¼çš„å…¨éƒ¨å†…å®¹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142603.png" alt="image-20201011225441783"></p><h3 id="7ã€SETRANGE-é”®å-åç§»é‡n-è¦æ›¿æ¢çš„å­—ç¬¦ä¸²"><a href="#7ã€SETRANGE-é”®å-åç§»é‡n-è¦æ›¿æ¢çš„å­—ç¬¦ä¸²" class="headerlink" title="7ã€SETRANGE é”®å åç§»é‡n è¦æ›¿æ¢çš„å­—ç¬¦ä¸²"></a>7ã€SETRANGE é”®å åç§»é‡n è¦æ›¿æ¢çš„å­—ç¬¦ä¸²</h3><blockquote><p>æ›¿æ¢æŒ‡å®šå­—ç¬¦å¼€å§‹çš„å­—ç¬¦ä¸²</p></blockquote><ul><li>å…ˆè®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼škey2â€“&gt;abcdefgï¼Œç„¶ååç§»ä¸€ä¸ªå•ä½ï¼Œå°†xxæ›¿æ¢åˆ°ç›®æ ‡ä¸²ä¸­</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142604.png" alt="image-20201011230122084"></p><h3 id="8ã€setex-é”®å-è¿‡æœŸæ—¶é—´-å€¼"><a href="#8ã€setex-é”®å-è¿‡æœŸæ—¶é—´-å€¼" class="headerlink" title="8ã€setex é”®å è¿‡æœŸæ—¶é—´ å€¼"></a>8ã€setex é”®å è¿‡æœŸæ—¶é—´ å€¼</h3><blockquote><p>ä¸ºæŒ‡å®šçš„keyè®¾ç½®å€¼å’Œè¿‡æœŸæ—¶é—´ï¼Œå¦‚æœkeyå·²ç»å­˜åœ¨ï¼ŒSETEXå‘½ä»¤ä¼šæ›¿æ¢æ—§çš„å€¼</p></blockquote><ul><li>å…ˆè®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œç„¶åä½¿ç”¨setexè¦†ç›–</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142605.png" alt="image-20201011232438878"></p><h3 id="9ã€setnx-SET-IF-NOT-EXISTS-é”®å-å€¼"><a href="#9ã€setnx-SET-IF-NOT-EXISTS-é”®å-å€¼" class="headerlink" title="9ã€setnx(SET IF NOT EXISTS) é”®å å€¼"></a>9ã€setnx(SET IF NOT EXISTS) é”®å å€¼</h3><blockquote><p>å½“æŒ‡å®šçš„keyä¸å­˜åœ¨æ—¶ï¼Œä¸ºkeyè®¾ç½®æŒ‡å®šçš„å€¼ï¼Œå¦‚æœå­˜åœ¨ä¼šè¦†ç›–å¤±è´¥ï¼Œè¿”å›0ï¼ŒæˆåŠŸè¿”å›1ï¼Œè¿™ä¸ªå‘½ä»¤ç»å¸¸åœ¨åˆ†å¸ƒå¼é”ä¸­ç”¨åˆ°</p></blockquote><ul><li>å…ˆè®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼Œç„¶åå°è¯•ä½¿ç”¨setnxè¦†ç›–ï¼Œè§‚å¯Ÿç»“æœï¼Œå‘ç°è¿”å›0ï¼Œä¸”keyçš„å€¼è¿˜æ˜¯wuhu111</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142606.png" alt="image-20201011232537974"></p><h3 id="10ã€mset-é”®1-å€¼1-é”®2-å€¼2-â€¦"><a href="#10ã€mset-é”®1-å€¼1-é”®2-å€¼2-â€¦" class="headerlink" title="10ã€mset é”®1 å€¼1 é”®2 å€¼2 â€¦"></a>10ã€mset é”®1 å€¼1 é”®2 å€¼2 â€¦</h3><blockquote><p>ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¯ä»¥æ‰¹é‡æ·»åŠ é”®å€¼å¯¹</p></blockquote><ul><li>æ·»åŠ ä¸‰ä¸ªé”®å€¼å¯¹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142607.png" alt="image-20201011233358741"></p><h3 id="11ã€mget-é”®1-é”®2-â€¦"><a href="#11ã€mget-é”®1-é”®2-â€¦" class="headerlink" title="11ã€mget é”®1 é”®2 â€¦"></a>11ã€mget é”®1 é”®2 â€¦</h3><blockquote><p>æ‰¹é‡å–å¾—å€¼</p></blockquote><ul><li>å–å¾—ä¸Šé¢æ·»åŠ çš„å€¼</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142608.png" alt="image-20201011233547127"></p><h3 id="12ã€msetnx-é”®1-å€¼1-â€¦"><a href="#12ã€msetnx-é”®1-å€¼1-â€¦" class="headerlink" title="12ã€msetnx é”®1 å€¼1 â€¦"></a>12ã€msetnx é”®1 å€¼1 â€¦</h3><blockquote><p>åŒæ—¶æ’å…¥å¤šä¸ªé”®å€¼å¯¹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªé”®å·²ç»å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œæ’å…¥æ“ä½œï¼Œæ‰€æœ‰é”®éƒ½ä¸å­˜åœ¨æ—¶æ‰æ’å…¥</p></blockquote><h3 id="13ã€è®¾ç½®å¯¹è±¡"><a href="#13ã€è®¾ç½®å¯¹è±¡" class="headerlink" title="13ã€è®¾ç½®å¯¹è±¡"></a>13ã€è®¾ç½®å¯¹è±¡</h3><blockquote><p>set user : 1 {username : zhuo,age : 18}</p></blockquote><ul><li>ä½¿ç”¨msetå’Œmgetå­˜å‚¨å’Œè·å–å¯¹è±¡</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mset user:1:name hzx user:1:age 18</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget user:1:name user:1:age</span><br><span class="line">1) <span class="string">&quot;hzx&quot;</span></span><br><span class="line">2) <span class="string">&quot;18&quot;</span></span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142609.png" alt="image-20201011234455595"></p><h3 id="14ã€getset-å…ˆå–åèµ‹å€¼"><a href="#14ã€getset-å…ˆå–åèµ‹å€¼" class="headerlink" title="14ã€getset å…ˆå–åèµ‹å€¼"></a>14ã€getset å…ˆå–åèµ‹å€¼</h3><blockquote><p>ç”±äºæ˜¯å…ˆgetåsetï¼Œæ‰€ä»¥æ³¨æ„ç»“æœæ˜¯ä¸Šæ¬¡çš„å€¼ï¼Œå…ˆè¿”å›å½“å‰å€¼ï¼Œåè®¾ç½®æ–°å€¼</p></blockquote><ul><li>è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹k1-v1ï¼Œç„¶åä½¿ç”¨getsetå°†å€¼å˜ä¸ºvalue1ï¼Œè§‚å¯Ÿ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210204142610.png" alt="image-20201011235025047"></p><h3 id="15ã€Stringåº”ç”¨åœºæ™¯ï¼š"><a href="#15ã€Stringåº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="15ã€Stringåº”ç”¨åœºæ™¯ï¼š"></a>15ã€Stringåº”ç”¨åœºæ™¯ï¼š</h3><ul><li>ç”±äºredisä¸­æ²¡æœ‰æ•°å€¼ç±»å‹ï¼Œæ‰€ä»¥æ•°å­—ä¹Ÿæ˜¯ç”¨stringå­˜å‚¨</li><li>å¯ä»¥ç”¨ä½œè®¡æ•°å™¨</li><li>ç»Ÿè®¡æ•°é‡</li><li>å¯¹è±¡ç¼“å­˜å­˜å‚¨</li></ul><h2 id="3-3ã€List"><a href="#3-3ã€List" class="headerlink" title="3.3ã€List"></a>3.3ã€List</h2><ul><li>åœ¨redisä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®è§„åˆ™æ¥ä½¿listæˆä¸ºä¸€ä¸ªæ ˆæˆ–é˜Ÿåˆ—</li><li>æ‰€æœ‰listå‘½ä»¤å¤§éƒ¨åˆ†ä»¥lå¼€å¤´</li></ul><h3 id="1ã€LPUSH-é›†åˆå-å€¼"><a href="#1ã€LPUSH-é›†åˆå-å€¼" class="headerlink" title="1ã€LPUSH é›†åˆå å€¼"></a>1ã€LPUSH é›†åˆå å€¼</h3><blockquote><p>å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ä»å·¦è¾¹æ’è¿›åˆ—è¡¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LPUSH list one <span class="comment"># åœ¨åˆ—è¡¨å·¦è¾¹æ’å…¥å€¼</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; LPUSH list two three <span class="comment"># åœ¨åˆ—è¡¨ä¸­æ’å…¥å¤šä¸ªå€¼</span></span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1  <span class="comment"># è·å–åˆ—è¡¨ä¸­æ‰€æœ‰çš„å€¼</span></span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; Lrange list 0 1 <span class="comment">#è·å–åˆ—è¡¨ä¸­ä¸‹æ ‡åœ¨[0,1]çš„å€¼</span></span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2ã€RPUSH-é›†åˆå-å€¼"><a href="#2ã€RPUSH-é›†åˆå-å€¼" class="headerlink" title="2ã€RPUSH é›†åˆå å€¼"></a>2ã€RPUSH é›†åˆå å€¼</h3><blockquote><p>å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ä»å³è¾¹æ’è¿›åˆ—è¡¨</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Rpush list right</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; rpush list right1 right2</span><br><span class="line">(<span class="built_in">integer</span>) 6</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;three&quot;</span></span><br><span class="line">2) <span class="string">&quot;two&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;right&quot;</span></span><br><span class="line">5) <span class="string">&quot;right1&quot;</span></span><br><span class="line">6) <span class="string">&quot;right2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€LPOP-åˆ—è¡¨å"><a href="#3ã€LPOP-åˆ—è¡¨å" class="headerlink" title="3ã€LPOP åˆ—è¡¨å"></a>3ã€LPOP åˆ—è¡¨å</h3><blockquote><p>ä»å·¦è¾¹å¼¹å‡ºï¼ˆç§»å‡ºï¼‰ä¸€ä¸ªå…ƒç´ </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LPOP list </span><br><span class="line"><span class="string">&quot;three&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;right&quot;</span></span><br><span class="line">4) <span class="string">&quot;right1&quot;</span></span><br><span class="line">5) <span class="string">&quot;right2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4ã€RPOP-åˆ—è¡¨å"><a href="#4ã€RPOP-åˆ—è¡¨å" class="headerlink" title="4ã€RPOP åˆ—è¡¨å"></a>4ã€RPOP åˆ—è¡¨å</h3><blockquote><p>ä»å³è¾¹å¼¹å‡ºä¸€ä¸ªå…ƒç´ </p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; RPOP list</span><br><span class="line"><span class="string">&quot;right2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;right&quot;</span></span><br><span class="line">4) <span class="string">&quot;right1&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5ã€LINDEX-åˆ—è¡¨å-ä¸‹æ ‡"><a href="#5ã€LINDEX-åˆ—è¡¨å-ä¸‹æ ‡" class="headerlink" title="5ã€LINDEX åˆ—è¡¨å ä¸‹æ ‡"></a>5ã€LINDEX åˆ—è¡¨å ä¸‹æ ‡</h3><blockquote><p>é€šè¿‡ä¸‹æ ‡è·å–å€¼</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LINDEX list 0</span><br><span class="line"><span class="string">&quot;two&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; LINDEX list 3</span><br><span class="line"><span class="string">&quot;right1&quot;</span></span><br></pre></td></tr></table></figure><h3 id="6ã€Llen-åˆ—è¡¨å"><a href="#6ã€Llen-åˆ—è¡¨å" class="headerlink" title="6ã€Llen åˆ—è¡¨å"></a>6ã€Llen åˆ—è¡¨å</h3><blockquote><p>è·å–åˆ—è¡¨é•¿åº¦</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) <span class="string">&quot;two&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;right&quot;</span></span><br><span class="line">4) <span class="string">&quot;right1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; Llen list</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7ã€Lrem-åˆ—è¡¨å-ç§»é™¤ä¸ªæ•°-ç²¾ç¡®å€¼"><a href="#7ã€Lrem-åˆ—è¡¨å-ç§»é™¤ä¸ªæ•°-ç²¾ç¡®å€¼" class="headerlink" title="7ã€Lrem  åˆ—è¡¨å  ç§»é™¤ä¸ªæ•°  ç²¾ç¡®å€¼"></a>7ã€Lrem  åˆ—è¡¨å  ç§»é™¤ä¸ªæ•°  ç²¾ç¡®å€¼</h3><blockquote><p>ç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œç²¾ç¡®åŒ¹é…</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;one&quot;</span></span><br><span class="line">5) <span class="string">&quot;two&quot;</span></span><br><span class="line">6) <span class="string">&quot;one&quot;</span></span><br><span class="line">7) <span class="string">&quot;right&quot;</span></span><br><span class="line">8) <span class="string">&quot;right1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrem list 1 two</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;one&quot;</span></span><br><span class="line">2) <span class="string">&quot;one&quot;</span></span><br><span class="line">3) <span class="string">&quot;one&quot;</span></span><br><span class="line">4) <span class="string">&quot;one&quot;</span></span><br><span class="line">5) <span class="string">&quot;one&quot;</span></span><br><span class="line">6) <span class="string">&quot;right&quot;</span></span><br><span class="line">7) <span class="string">&quot;right1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lrem list 5 one</span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;right&quot;</span></span><br><span class="line">2) <span class="string">&quot;right1&quot;</span></span><br></pre></td></tr></table></figure><h3 id="8ã€ltrim-åˆ—è¡¨å-èµ·å§‹åæ ‡-ç»“æŸåæ ‡"><a href="#8ã€ltrim-åˆ—è¡¨å-èµ·å§‹åæ ‡-ç»“æŸåæ ‡" class="headerlink" title="8ã€ltrim  åˆ—è¡¨å  èµ·å§‹åæ ‡  ç»“æŸåæ ‡"></a>8ã€ltrim  åˆ—è¡¨å  èµ·å§‹åæ ‡  ç»“æŸåæ ‡</h3><blockquote><p>æˆªæ–­åˆ—è¡¨ï¼Œåˆ—è¡¨å…ƒç´ å˜ä¸º[start ,end]</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;hello1&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello2&quot;</span></span><br><span class="line">3) <span class="string">&quot;hello3&quot;</span></span><br><span class="line">4) <span class="string">&quot;hello4&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; ltrim list 1 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;hello2&quot;</span></span><br><span class="line">2) <span class="string">&quot;hello3&quot;</span></span><br></pre></td></tr></table></figure><h3 id="9ã€exists-åˆ—è¡¨å"><a href="#9ã€exists-åˆ—è¡¨å" class="headerlink" title="9ã€exists åˆ—è¡¨å"></a>9ã€exists åˆ—è¡¨å</h3><blockquote><p>åˆ¤æ–­åˆ—è¡¨ä¸­æœ‰å‡ ä¸ªå€¼</p></blockquote><h3 id="10ã€LSET-åˆ—è¡¨å-ä¸‹æ ‡-å€¼"><a href="#10ã€LSET-åˆ—è¡¨å-ä¸‹æ ‡-å€¼" class="headerlink" title="10ã€LSET åˆ—è¡¨å  ä¸‹æ ‡  å€¼"></a>10ã€LSET åˆ—è¡¨å  ä¸‹æ ‡  å€¼</h3><blockquote><p>æ›¿æ¢åˆ—è¡¨æŒ‡å®šä¸‹æ ‡çš„å€¼ï¼Œå¦‚æœå½“å‰åˆ—è¡¨ä¸­ä¸å­˜åœ¨æŒ‡å®šä¸‹æ ‡æ‰€å¯¹åº”çš„å€¼ï¼Œå°±æŠ¥é”™</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;value3&quot;</span></span><br><span class="line">2) <span class="string">&quot;value2&quot;</span></span><br><span class="line">3) <span class="string">&quot;value1&quot;</span></span><br><span class="line">4) <span class="string">&quot;hello2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; lset list 0 item</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;item&quot;</span></span><br><span class="line">2) <span class="string">&quot;value2&quot;</span></span><br><span class="line">3) <span class="string">&quot;value1&quot;</span></span><br><span class="line">4) <span class="string">&quot;hello2&quot;</span></span><br></pre></td></tr></table></figure><h3 id="11ã€LINSERT-åˆ—è¡¨å-å‰-å-è¦æ’å…¥çš„ä½ç½®-è¦æ’å…¥çš„å€¼"><a href="#11ã€LINSERT-åˆ—è¡¨å-å‰-å-è¦æ’å…¥çš„ä½ç½®-è¦æ’å…¥çš„å€¼" class="headerlink" title="11ã€LINSERT   åˆ—è¡¨å   å‰|å   è¦æ’å…¥çš„ä½ç½®    è¦æ’å…¥çš„å€¼"></a>11ã€LINSERT   åˆ—è¡¨å   å‰|å   è¦æ’å…¥çš„ä½ç½®    è¦æ’å…¥çš„å€¼</h3><blockquote><p>åœ¨åˆ—è¡¨çš„æŸä¸ªå€¼å‰|åæ’å…¥ä¸€ä¸ªå€¼</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; rpush list hello</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush list world</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;world&quot;</span></span><br><span class="line"><span class="comment"># åœ¨worldå•è¯å‰æ’å…¥ä¸€ä¸ªå€¼ï¼šother</span></span><br><span class="line">127.0.0.1:6379&gt; linsert list before <span class="string">&quot;world&quot;</span> other</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;other&quot;</span></span><br><span class="line">3) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure><ul><li>å¾€ä¸Šé¢listçš„otherå…ƒç´ åæ’å…¥ä¸€ä¸ªå€¼wuhu</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; linsert list after <span class="string">&quot;other&quot;</span> wuhu</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 -1</span><br><span class="line">1) <span class="string">&quot;hello&quot;</span></span><br><span class="line">2) <span class="string">&quot;other&quot;</span></span><br><span class="line">3) <span class="string">&quot;wuhu&quot;</span></span><br><span class="line">4) <span class="string">&quot;world&quot;</span></span><br></pre></td></tr></table></figure><h3 id="12ã€å°ç»“ï¼š"><a href="#12ã€å°ç»“ï¼š" class="headerlink" title="12ã€å°ç»“ï¼š"></a>12ã€å°ç»“ï¼š</h3><ul><li><p>listå®é™…ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ‰€ä»¥å¯ä»¥åœ¨èŠ‚ç‚¹å‰åæ’å…¥èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥åœ¨æœ€å·¦ç«¯ã€æœ€å³ç«¯æ’å…¥å…ƒç´ </p></li><li><p>å¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„é“¾è¡¨</p></li><li><p>å¦‚æœkeyå­˜åœ¨ï¼Œæ–°å¢å†…å®¹</p></li><li><p>å¦‚æœç§»é™¤äº†keyï¼Œé‚£ä¹ˆé“¾è¡¨è¢«ç§»é™¤</p></li><li><p>åœ¨ä¸¤è¾¹æ’å…¥æˆ–æ”¹åŠ¨å€¼æ•ˆç‡æœ€é«˜ï¼æ“ä½œä¸­é—´å€¼æ•ˆç‡ä¼šé™ä½</p></li><li><p>å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿæ ˆï¼ˆLPUSHã€LPOPï¼‰ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆLPUSHRã€RPOPï¼‰</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆä¸€ï¼‰-ä½¿ç”¨MPçš„QueryWrapperè¿›è¡Œè‡ªå®šä¹‰sqlä¸æå‡åµŒå¥—æŸ¥è¯¢æ•ˆç‡ã€‚</title>
      <link href="posts/2126557972.html"/>
      <url>posts/2126557972.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€ä½¿ç”¨æ¡ä»¶æ„é€ å™¨è‡ªå®šä¹‰SQL"><a href="#ä¸€ã€ä½¿ç”¨æ¡ä»¶æ„é€ å™¨è‡ªå®šä¹‰SQL" class="headerlink" title="ä¸€ã€ä½¿ç”¨æ¡ä»¶æ„é€ å™¨è‡ªå®šä¹‰SQL"></a>ä¸€ã€ä½¿ç”¨æ¡ä»¶æ„é€ å™¨è‡ªå®šä¹‰SQL</h1><blockquote><p>åœ¨åœ¨çº¿æ•™è‚²é¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€ä¸ªéœ€è¦å±•ç¤ºè¯¾ç¨‹è¯¦ç»†ä¿¡æ¯çš„éœ€æ±‚ï¼Œè¿™ä¸ªè¯¾ç¨‹ä¿¡æ¯é¡µé¢éœ€è¦å±•ç¤ºè¯¾ç¨‹titleã€è¯¾ç¨‹ä¸€çº§ç±»åˆ«ã€äºŒçº§ç±»åˆ«ã€è®²å¸ˆå§“åã€è¯¾æ—¶æ•°ã€è¯¾ç¨‹ä»·æ ¼ã€è¯¾ç¨‹å°é¢ã€è¯¾ç¨‹è´­ä¹°é‡ã€æµè§ˆé‡ã€è¯¾ç¨‹çŠ¶æ€ï¼ˆå·²å‘å¸ƒã€æœªå‘å¸ƒï¼‰å’Œè¯¾ç¨‹åˆ›å»ºæ—¶é—´ã€‚</p></blockquote><h2 id="1-1ã€æ‰€éœ€ä¾èµ–"><a href="#1-1ã€æ‰€éœ€ä¾èµ–" class="headerlink" title="1.1ã€æ‰€éœ€ä¾èµ–"></a>1.1ã€æ‰€éœ€ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-models<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--lombokç”¨æ¥ç®€åŒ–å®ä½“ç±»ï¼šéœ€è¦å®‰è£…lombokæ’ä»¶--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- org.apache.commons.lang3.StringUtils --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-2ã€å®ä½“ç±»"><a href="#1-2ã€å®ä½“ç±»" class="headerlink" title="1.2ã€å®ä½“ç±»"></a>1.2ã€å®ä½“ç±»</h2><blockquote><p>è¯¥ä¸šåŠ¡æ‰€æ¶‰åŠçš„å®ä½“ç±»å¦‚ä¸‹æ‰€ç¤º</p></blockquote><h3 id="1ã€BaseEntity"><a href="#1ã€BaseEntity" class="headerlink" title="1ã€BaseEntity"></a>1ã€BaseEntity</h3><blockquote><p>è¿™ä¸ªå®ä½“ç±»å®šä¹‰äº†å®ä½“ç±»çš„<strong>å…±åŒå±æ€§</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = false)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseEntity</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è®²å¸ˆID&quot;)</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;id&quot;, type = IdType.ASSIGN_ID)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;åˆ›å»ºæ—¶é—´&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtCreate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æ›´æ–°æ—¶é—´&quot;)</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date gmtModified;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€Course"><a href="#2ã€Course" class="headerlink" title="2ã€Course"></a>2ã€Course</h3><blockquote><p>è¯¾ç¨‹å®ä½“ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@TableName(&quot;edu_course&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(value=&quot;Courseå¯¹è±¡&quot;, description=&quot;è¯¾ç¨‹&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Course</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">1L</span>;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * è¯¾ç¨‹æœªå‘å¸ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COURSE_DRAFT = <span class="string">&quot;Draft&quot;</span>;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * è¯¾ç¨‹å·²å‘å¸ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String COURSE_NORMAL = <span class="string">&quot;Normal&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¯¾ç¨‹è®²å¸ˆID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¯¾ç¨‹ä¸“ä¸šID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¯¾ç¨‹ä¸“ä¸šçˆ¶çº§ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String subjectParentId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¯¾ç¨‹æ ‡é¢˜&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¯¾ç¨‹é”€å”®ä»·æ ¼ï¼Œè®¾ç½®ä¸º0åˆ™å¯å…è´¹è§‚çœ‹&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æ€»è¯¾æ—¶&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¯¾ç¨‹å°é¢å›¾ç‰‡è·¯å¾„&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;é”€å”®æ•°é‡&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long buyCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æµè§ˆæ•°é‡&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;ä¹è§‚é”&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long version;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è¯¾ç¨‹çŠ¶æ€ Draftæœªå‘å¸ƒ  Normalå·²å‘å¸ƒ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€Teacher"><a href="#3ã€Teacher" class="headerlink" title="3ã€Teacher"></a>3ã€Teacher</h3><blockquote><p>æ•™å¸ˆå®ä½“ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@TableName(&quot;edu_teacher&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(value=&quot;Teacherå¯¹è±¡&quot;, description=&quot;è®²å¸ˆ&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è®²å¸ˆå§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è®²å¸ˆç®€ä»‹&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String intro;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è®²å¸ˆèµ„å†,ä¸€å¥è¯è¯´æ˜è®²å¸ˆ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String career;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;å¤´è¡” 1é«˜çº§è®²å¸ˆ 2é¦–å¸­è®²å¸ˆ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;è®²å¸ˆå¤´åƒ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æ’åº&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;å…¥é©»æ—¶é—´&quot;)</span></span><br><span class="line">    <span class="meta">@JsonFormat(timezone = &quot;GMT+8&quot;, pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date joinDate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;é€»è¾‘åˆ é™¤ 1ï¼ˆtrueï¼‰å·²åˆ é™¤ï¼Œ 0ï¼ˆfalseï¼‰æœªåˆ é™¤&quot;)</span></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€Subject"><a href="#4ã€Subject" class="headerlink" title="4ã€Subject"></a>4ã€Subject</h3><blockquote><p><strong>è¯¾ç¨‹åˆ†ç±»å®ä½“ç±»</strong></p><p>ä¸€çº§åˆ†ç±»å’ŒäºŒçº§åˆ†ç±»å…±ç”¨ä¸€ä¸ªå®ä½“ç±»ï¼Œå¦‚æœåˆ†ç±»å¯¹è±¡çš„parentIdä¸º0ï¼Œè¯æ˜å…¶æ˜¯ä¸€çº§åˆ†ç±»ï¼Œå¦‚æœä¸ä¸º0ï¼Œè¯æ˜ä¸ºäºŒçº§åˆ†ç±»ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@TableName(&quot;edu_subject&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(value=&quot;Subjectå¯¹è±¡&quot;, description=&quot;è¯¾ç¨‹ç§‘ç›®&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> <span class="keyword">extends</span> <span class="title">BaseEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID=<span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;ç±»åˆ«åç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;çˆ¶ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String parentId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;æ’åºå­—æ®µ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€CourseVo"><a href="#5ã€CourseVo" class="headerlink" title="5ã€CourseVo"></a>5ã€CourseVo</h3><blockquote><p>è¿™ä¸ªVoç±»ç”¨äºå®šä¹‰éœ€è¦å±•ç¤ºåœ¨è¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„å±æ€§</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹æ ‡é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹ä¸€çº§åˆ†ç±»</span></span><br><span class="line">    <span class="keyword">private</span> String subjectParentTitle;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹äºŒçº§åˆ†ç±»</span></span><br><span class="line">    <span class="keyword">private</span> String subjectTitle;</span><br><span class="line">    <span class="comment">// è®²å¸ˆå§“å</span></span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹è¯¾æ—¶æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹ä»·æ ¼</span></span><br><span class="line">    <span class="keyword">private</span> String price;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹å°é¢</span></span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹è´­ä¹°æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Long buyCount;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹æµè§ˆé‡</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">// è¯¾ç¨‹åˆ›å»ºæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String gmtCreate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€CourseQueryVo"><a href="#6ã€CourseQueryVo" class="headerlink" title="6ã€CourseQueryVo"></a>6ã€CourseQueryVo</h3><blockquote><p>è¯¥ä¸šåŠ¡è¿˜éœ€è¦ç”¨åˆ°åˆ†é¡µæŸ¥è¯¢ä¸æ¡ä»¶æŸ¥è¯¢ï¼Œæ‰€ä»¥å¼•å…¥ä¸€ä¸ªç”¨äºæ„é€ æ¡ä»¶æŸ¥è¯¢çš„æŸ¥è¯¢å®ä½“ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseQueryVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line">    <span class="keyword">private</span> String subjectParentId;</span><br><span class="line">    <span class="keyword">private</span> String subjectId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-3ã€Controllerå±‚"><a href="#1-3ã€Controllerå±‚" class="headerlink" title="1.3ã€Controllerå±‚"></a>1.3ã€Controllerå±‚</h2><blockquote><p>å®šä¹‰ä¸€ä¸ªCourseListPageæ¥å£ï¼Œéœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>pageï¼šå½“å‰é¡µç </li><li>limitï¼šæ¯é¡µè®°å½•æ•°</li><li>courseQueryVoï¼šç”±æŸ¥è¯¢æ¡ä»¶å°è£…æˆçš„æŸ¥è¯¢å¯¹è±¡</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;è¯¾ç¨‹ç®¡ç†æ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/edu/course&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CourseService courseService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(&quot;è¯¾ç¨‹åˆ†é¡µåˆ—è¡¨&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;list/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">courseListPage</span><span class="params">(<span class="meta">@ApiParam(value = &quot;å½“å‰é¡µç &quot;,required = true)</span> <span class="meta">@PathVariable</span> Long page,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="meta">@ApiParam(value = &quot;æ¯é¡µè®°å½•æ•°&quot;,required = true)</span> <span class="meta">@PathVariable</span> Long limit,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="meta">@ApiParam(value = &quot;è¯¾ç¨‹åˆ—è¡¨æŸ¥è¯¢å¯¹è±¡&quot;)</span>CourseQueryVo courseQueryVo)</span> </span>&#123;</span><br><span class="line">        IPage&lt;CourseVo&gt; pageModel = courseService.selectPage(page, limit, courseQueryVo);</span><br><span class="line">        List&lt;CourseVo&gt; records = pageModel.getRecords();</span><br><span class="line">        <span class="keyword">long</span> total = pageModel.getTotal();</span><br><span class="line">        <span class="keyword">return</span>  R.ok().data(<span class="string">&quot;total&quot;</span>, total).data(<span class="string">&quot;rows&quot;</span>, records);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-4ã€Serviceå®ç°ç±»"><a href="#1-4ã€Serviceå®ç°ç±»" class="headerlink" title="1.4ã€Serviceå®ç°ç±»"></a>1.4ã€Serviceå®ç°ç±»</h2><blockquote><p>ä½¿ç”¨QueryWrapperç»„è£…sqlçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>åˆ†åˆ«å–å‡ºæŸ¥è¯¢å¯¹è±¡ä¸­çš„æŸ¥è¯¢å±æ€§å¹¶åˆ¤æ–­æ˜¯å¦ä¸ºç©º</li><li>è‹¥ä¸ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨æ¡ä»¶æ„é€ å™¨æ ¹æ®å±æ€§ç±»å‹æ„é€ æŸ¥è¯¢æ¡ä»¶</li><li>åœ¨ä½¿ç”¨æ¡ä»¶æ„é€ å™¨æ„é€ æŸ¥è¯¢æ¡ä»¶æ—¶éœ€è¦ä½¿ç”¨<strong>è¡¨åˆ«å.å±æ€§å</strong>çš„å½¢å¼æ„é€ æ¡ä»¶</li><li>å°†ç»„è£…å¥½çš„æ¡ä»¶æ„é€ å™¨ä¼ å…¥Mapperå±‚</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CourseServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CourseMapper</span>, <span class="title">Course</span>&gt; <span class="keyword">implements</span> <span class="title">CourseService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> VideoMapper videoMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ChapterMapper chapterMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CommentMapper commentMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CourseCollectMapper courseCollectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CourseMapper courseMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IPage&lt;CourseVo&gt; <span class="title">selectPage</span><span class="params">(Long page, Long limit, CourseQueryVo courseQueryVo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ç»„è£…æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line">        QueryWrapper&lt;CourseVo&gt; courseVoQueryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        courseVoQueryWrapper.orderByDesc(<span class="string">&quot;c.gmt_create&quot;</span>);</span><br><span class="line">        <span class="comment">//å››ä¸ªæŸ¥è¯¢æ¡ä»¶å¦‚ä¸‹</span></span><br><span class="line">        String title = courseQueryVo.getTitle();</span><br><span class="line">        String teacherId = courseQueryVo.getTeacherId();</span><br><span class="line">        String subjectParentId = courseQueryVo.getSubjectParentId();</span><br><span class="line">        String subjectId = courseQueryVo.getSubjectId();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(title)) &#123;</span><br><span class="line">            courseVoQueryWrapper.like(<span class="string">&quot;c.title&quot;</span>, title);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(teacherId)) &#123;</span><br><span class="line">            courseVoQueryWrapper.eq(<span class="string">&quot;c.teacher_id&quot;</span>, teacherId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(subjectParentId)) &#123;</span><br><span class="line">            courseVoQueryWrapper.eq(<span class="string">&quot;c.subject_parent_id&quot;</span>, subjectParentId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(subjectId)) &#123;</span><br><span class="line">            courseVoQueryWrapper.eq(<span class="string">&quot;c.subject_id&quot;</span>, subjectId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»„è£…åˆ†é¡µ</span></span><br><span class="line">        Page&lt;CourseVo&gt; pageParam = <span class="keyword">new</span> Page&lt;&gt;(page, limit);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰§è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        List&lt;CourseVo&gt; courseVoList = courseMapper.selectPageByQueryVo(pageParam, courseVoQueryWrapper);</span><br><span class="line">        pageParam.setRecords(courseVoList);</span><br><span class="line">        <span class="keyword">return</span> pageParam;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1-5ã€Mapperå±‚"><a href="#1-5ã€Mapperå±‚" class="headerlink" title="1.5ã€Mapperå±‚"></a>1.5ã€Mapperå±‚</h2><h3 id="1ã€Mapperæ¥å£"><a href="#1ã€Mapperæ¥å£" class="headerlink" title="1ã€Mapperæ¥å£"></a>1ã€Mapperæ¥å£</h3><blockquote><p>å¯¹äºServiceå±‚ä¸­ä¼ å…¥çš„æ¡ä»¶æ„é€ å™¨ï¼Œéœ€è¦ä½¿Mybatis-plusèƒ½å¤Ÿè¯†åˆ«ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦åœ¨Mapperå±‚ä¸­çš„æ¡ä»¶æ„é€ å™¨å¯¹è±¡å‰æ·»åŠ **@Param(Constants.WRAPPER)**æ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CourseMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Course</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">List&lt;CourseVo&gt; <span class="title">selectPageByQueryVo</span><span class="params">(Page&lt;CourseVo&gt; pageParam,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="meta">@Param(Constants.WRAPPER)</span> QueryWrapper&lt;CourseVo&gt; courseVoQueryWrapper)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€Mapper-xmlæ–‡ä»¶"><a href="#2ã€Mapper-xmlæ–‡ä»¶" class="headerlink" title="2ã€Mapper.xmlæ–‡ä»¶"></a>2ã€Mapper.xmlæ–‡ä»¶</h3><blockquote><p>é™¤å»Mapperæ¥å£æ·»åŠ çš„**@Param(Constants.WRAPPER)<strong>æ³¨è§£å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨è‡ªå®šä¹‰çš„sqlè¯­å¥åæ·»åŠ </strong>${ew.customSqlSegment}**</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.hzx.grain.service.edu.mapper.CourseMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectPageByQueryVo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.hzx.grain.service.edu.entity.vo.CourseVo&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;courseVoColumns&quot;</span>/&gt;</span></span><br><span class="line">        FROM</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;tables&quot;</span>/&gt;</span></span><br><span class="line">        $&#123;ew.customSqlSegment&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŠ½å–sqlç‰‡æ®µ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;courseVoColumns&quot;</span>&gt;</span></span><br><span class="line">           c.id,</span><br><span class="line">           c.title,</span><br><span class="line">           c.lesson_num AS lessonNum,</span><br><span class="line">           c.price,</span><br><span class="line">           c.cover,</span><br><span class="line">           c.buy_count AS buyCount,</span><br><span class="line">           c.view_count AS viewCount,</span><br><span class="line">           c.status,</span><br><span class="line">           c.gmt_create AS gmtCreate,</span><br><span class="line">           t.name AS teacherName,</span><br><span class="line">           s1.title AS subjectParentTitle,</span><br><span class="line">           s2.title AS subjectTitle</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æŠ½å–sqlç‰‡æ®µï¼šä¸courseè¡¨è¿æ¥çš„å…¶ä½™è¡¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;tables&quot;</span>&gt;</span></span><br><span class="line">            guli_edu.edu_course c</span><br><span class="line">        LEFT JOIN guli_edu.edu_teacher t ON c.teacher_id = t.id</span><br><span class="line">        LEFT JOIN guli_edu.edu_subject s1 ON c.subject_parent_id = s1.id</span><br><span class="line">        LEFT JOIN guli_edu.edu_subject s2 ON c.subject_id = s2.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€æ³¨æ„äº‹é¡¹"><a href="#3ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="3ã€æ³¨æ„äº‹é¡¹"></a>3ã€æ³¨æ„äº‹é¡¹</h3><blockquote><p>éœ€è¦<code>mybatis-plus</code>ç‰ˆæœ¬ &gt;= <code>3.0.7</code></p></blockquote><h2 id="1-6ã€æµ‹è¯•"><a href="#1-6ã€æµ‹è¯•" class="headerlink" title="1.6ã€æµ‹è¯•"></a>1.6ã€æµ‹è¯•</h2><blockquote><p>æ‰“å¼€Swaggerè¿›è¡Œæµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210203201739.png"></p><h3 id="1ã€ç»“æœ"><a href="#1ã€ç»“æœ" class="headerlink" title="1ã€ç»“æœ"></a>1ã€ç»“æœ</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;success&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;code&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">  <span class="attr">&quot;message&quot;</span>: <span class="string">&quot;æˆåŠŸ&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">&quot;rows&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;1353316219423391746&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Spring Bootæ¡†æ¶å…¥é—¨æ•™ç¨‹&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;subjectParentTitle&quot;</span>: <span class="string">&quot;åç«¯å¼€å‘&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;subjectTitle&quot;</span>: <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;teacherName&quot;</span>: <span class="string">&quot;åˆ˜å¾·å&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;lessonNum&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;price&quot;</span>: <span class="string">&quot;0.00&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cover&quot;</span>: <span class="string">&quot;https://edu-system-1010.oss-cn-shenzhen.aliyuncs.com/cover/2021/01/24/2afcb3fd-da73-40d1-ba41-4d6cf74c7e7a.jpg&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;buyCount&quot;</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="attr">&quot;viewCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;Normal&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gmtCreate&quot;</span>: <span class="string">&quot;2021-01-24 20:18:25&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;1353313325668200450&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Mybatis-Plusæ¡†æ¶å…¥é—¨æ•™ç¨‹&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;subjectParentTitle&quot;</span>: <span class="string">&quot;åç«¯å¼€å‘&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;subjectTitle&quot;</span>: <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;teacherName&quot;</span>: <span class="string">&quot;åˆ˜å¾·å&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;lessonNum&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;price&quot;</span>: <span class="string">&quot;1.00&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cover&quot;</span>: <span class="string">&quot;https://edu-system-1010.oss-cn-shenzhen.aliyuncs.com/cover/2021/01/24/804b29e5-4ca7-4819-9bac-eb34f65068ca.jpg&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;buyCount&quot;</span>: <span class="number">9</span>,</span><br><span class="line">        <span class="attr">&quot;viewCount&quot;</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;Normal&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gmtCreate&quot;</span>: <span class="string">&quot;2021-01-24 20:06:55&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;1353310049325309953&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;java--ä»å…¥é—¨åˆ°å…¥åœŸ&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;subjectParentTitle&quot;</span>: <span class="string">&quot;åç«¯å¼€å‘&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;subjectTitle&quot;</span>: <span class="string">&quot;Java&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;teacherName&quot;</span>: <span class="string">&quot;åˆ˜å¾·å&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;lessonNum&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;price&quot;</span>: <span class="string">&quot;6.00&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cover&quot;</span>: <span class="string">&quot;https://edu-system-1010.oss-cn-shenzhen.aliyuncs.com/cover/2021/01/24/d7c25aaa-5c09-4b46-a56d-5000f9265bc7.jpg&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;buyCount&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">&quot;viewCount&quot;</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;Normal&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;gmtCreate&quot;</span>: <span class="string">&quot;2021-01-24 19:53:54&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€æ‰§è¡Œçš„sqlè¯­å¥"><a href="#2ã€æ‰§è¡Œçš„sqlè¯­å¥" class="headerlink" title="2ã€æ‰§è¡Œçš„sqlè¯­å¥"></a>2ã€æ‰§è¡Œçš„sqlè¯­å¥</h3><blockquote><p>ä½¿ç”¨Ideaçš„Mybatisæ’ä»¶æŸ¥çœ‹æ‰§è¡Œçš„sqlè¯­å¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">c.id, </span><br><span class="line">c.title, </span><br><span class="line">c.lesson_num AS lessonNum, </span><br><span class="line">c.price, </span><br><span class="line">c.cover, </span><br><span class="line">c.buy_count AS buyCount, </span><br><span class="line">c.view_count AS viewCount, </span><br><span class="line">c.status, </span><br><span class="line">c.gmt_create AS gmtCreate, </span><br><span class="line">t.name AS teacherName, </span><br><span class="line">s1.title AS subjectParentTitle, </span><br><span class="line">s2.title AS subjectTitle</span><br><span class="line">FROM guli_edu.edu_course c</span><br><span class="line">LEFT JOIN guli_edu.edu_teacher t ON c.teacher_id &#x3D; t.id</span><br><span class="line">LEFT JOIN guli_edu.edu_subject s1 ON c.subject_parent_id &#x3D; s1.id</span><br><span class="line">LEFT JOIN guli_edu.edu_subject s2 ON c.subject_id &#x3D; s2.id</span><br><span class="line">WHERE c.title LIKE &#39;%å…¥é—¨%&#39;</span><br><span class="line">AND c.teacher_id &#x3D; &#39;1&#39;</span><br><span class="line">AND c.subject_parent_id &#x3D; &#39;1352924754100617218&#39;</span><br><span class="line">AND c.subject_id &#x3D; &#39;1352924754167726082&#39;</span><br><span class="line">ORDER BY c.gmt_create DESC</span><br><span class="line">LIMIT 0, 3;</span><br></pre></td></tr></table></figure><h1 id="äºŒã€æ€»ç»“åµŒå¥—æŸ¥è¯¢"><a href="#äºŒã€æ€»ç»“åµŒå¥—æŸ¥è¯¢" class="headerlink" title="äºŒã€æ€»ç»“åµŒå¥—æŸ¥è¯¢"></a>äºŒã€æ€»ç»“åµŒå¥—æŸ¥è¯¢</h1><h2 id="2-1ã€ä½¿ç”¨å­æŸ¥è¯¢"><a href="#2-1ã€ä½¿ç”¨å­æŸ¥è¯¢" class="headerlink" title="2.1ã€ä½¿ç”¨å­æŸ¥è¯¢"></a>2.1ã€ä½¿ç”¨å­æŸ¥è¯¢</h2><h3 id="1ã€Controllerå±‚"><a href="#1ã€Controllerå±‚" class="headerlink" title="1ã€Controllerå±‚"></a>1ã€Controllerå±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;nested&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;åµŒå¥—åˆ†ç±»æ•°æ®åˆ—è¡¨&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">nestedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è¿”å›åˆ†ç±»VOåˆ—è¡¨</span></span><br><span class="line">    List&lt;SubjectVo&gt; subjectVoList = subjectService.nestedList();</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;items&quot;</span>,subjectVoList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€Serviceå®ç°ç±»"><a href="#2ã€Serviceå®ç°ç±»" class="headerlink" title="2ã€Serviceå®ç°ç±»"></a>2ã€Serviceå®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;SubjectVo&gt; <span class="title">nestedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> subjectMapper.selectNestedListByParentId(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€Mapper-xmlæ–‡ä»¶"><a href="#3ã€Mapper-xmlæ–‡ä»¶" class="headerlink" title="3ã€Mapper.xmlæ–‡ä»¶"></a>3ã€Mapper.xmlæ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨ResultMapè¿›è¡Œæ˜ å°„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;subjectVoMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.hzx.grain.service.edu.entity.vo.SubjectVo&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å°†è¡¨ä¸­å­—æ®µä¸ç±»ä¸­å±æ€§ä¸€ä¸€æ˜ å°„ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;sort&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sort&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è¿™é‡Œæ ¹æ®åŸæ¥çš„æ–¹æ³•è¿›è¡ŒåµŒå¥—æŸ¥è¯¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;children&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;selectNestedListByParentId&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">ofType</span>=<span class="string">&quot;com.hzx.grain.service.edu.entity.vo.SubjectVo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- åµŒå¥—æŸ¥è¯¢ä¸€çº§åˆ†ç±»ä¸äºŒçº§åˆ†ç±»å¹¶ç»„è£…ä¸ºSubjectVoåˆ—è¡¨çš„sqlè¯­å¥ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectNestedListByParentId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;subjectVoMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">     `id`,</span><br><span class="line">     `sort`,</span><br><span class="line">     `title`</span><br><span class="line">    FROM</span><br><span class="line">     guli_edu.edu_subject</span><br><span class="line">    WHERE</span><br><span class="line">     `parent_id` = #&#123;parentId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4ã€SubjectVoå®ä½“ç±»"><a href="#4ã€SubjectVoå®ä½“ç±»" class="headerlink" title="4ã€SubjectVoå®ä½“ç±»"></a>4ã€SubjectVoå®ä½“ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubjectVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">    <span class="keyword">private</span> List&lt;SubjectVo&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€æ€»ç»“"><a href="#5ã€æ€»ç»“" class="headerlink" title="5ã€æ€»ç»“"></a>5ã€æ€»ç»“</h3><blockquote><p>è¿™ç§ä½¿ç”¨å­æŸ¥è¯¢çš„åµŒå¥—æŸ¥è¯¢å®ç°ç®€å•ï¼Œä½†æŸ¥è¯¢æ•ˆç‡ä¼šéšç€æ•°æ®é‡å¢å¤§è€Œé™ä½ã€‚</p></blockquote><h2 id="2-2ã€ä¸‰å±‚åµŒå¥—æŸ¥è¯¢ä¸­ä½¿ç”¨å†—ä½™å­—æ®µæé«˜æŸ¥è¯¢æ•ˆç‡"><a href="#2-2ã€ä¸‰å±‚åµŒå¥—æŸ¥è¯¢ä¸­ä½¿ç”¨å†—ä½™å­—æ®µæé«˜æŸ¥è¯¢æ•ˆç‡" class="headerlink" title="2.2ã€ä¸‰å±‚åµŒå¥—æŸ¥è¯¢ä¸­ä½¿ç”¨å†—ä½™å­—æ®µæé«˜æŸ¥è¯¢æ•ˆç‡"></a>2.2ã€ä¸‰å±‚åµŒå¥—æŸ¥è¯¢ä¸­ä½¿ç”¨å†—ä½™å­—æ®µæé«˜æŸ¥è¯¢æ•ˆç‡</h2><blockquote><p>è¯¥ä¸šåŠ¡éœ€æ±‚æ˜¯ï¼šæ ¹æ®è¯¾ç¨‹IdæŸ¥è¯¢è¯¾ç¨‹è¯¦æƒ…ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯¾ç¨‹ä¿¡æ¯ã€åµŒå¥—ç« èŠ‚è¯¾æ—¶åˆ—è¡¨</p><p>å³ä¸€ä¸ªè¯¾ç¨‹ä¸‹æœ‰å¤šä¸ªç« èŠ‚ï¼Œè€Œä¸€ä¸ªç« èŠ‚ä¸‹åˆæœ‰å¤šä¸ªå°èŠ‚</p></blockquote><h3 id="1ã€CourseVo"><a href="#1ã€CourseVo" class="headerlink" title="1ã€CourseVo"></a>1ã€CourseVo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebCourseVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer lessonNum;</span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="keyword">private</span> Long buyCount;</span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> String teacherId;</span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line">    <span class="keyword">private</span> String intro;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="keyword">private</span> String subjectLevelOneId;</span><br><span class="line">    <span class="keyword">private</span> String subjectLevelOne;</span><br><span class="line">    <span class="keyword">private</span> String subjectLevelTwoId;</span><br><span class="line">    <span class="keyword">private</span> String subjectLevelTwo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ChapterVo"><a href="#2ã€ChapterVo" class="headerlink" title="2ã€ChapterVo"></a>2ã€ChapterVo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChapterVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">    <span class="keyword">private</span> List&lt;VideoVo&gt; children = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€VideoVo"><a href="#3ã€VideoVo" class="headerlink" title="3ã€VideoVo"></a>3ã€VideoVo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> Boolean free;</span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String videoSourceId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€æ§åˆ¶å™¨å±‚"><a href="#4ã€æ§åˆ¶å™¨å±‚" class="headerlink" title="4ã€æ§åˆ¶å™¨å±‚"></a>4ã€æ§åˆ¶å™¨å±‚</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;get/&#123;courseId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;æ ¹æ®courseIdæŸ¥è¯¢è¯¾ç¨‹è¯¦ç»†ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">getById</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@ApiParam(value = &quot;è¯¾ç¨‹id&quot;,required = true)</span></span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@PathVariable</span> String courseId)</span> </span>&#123;</span><br><span class="line">    WebCourseVo courseVo = courseService.selectWebCourseVoById(courseId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å½“å‰è¯¾ç¨‹çš„åµŒå¥—ç« èŠ‚å’Œè¯¾æ—¶ä¿¡æ¯</span></span><br><span class="line">    List&lt;ChapterVo&gt; chapterVoList = chapterService.nestedList(courseId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;course&quot;</span>,courseVo).data(<span class="string">&quot;chapterVoList&quot;</span>,chapterVoList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€serviceå±‚"><a href="#5ã€serviceå±‚" class="headerlink" title="5ã€serviceå±‚"></a>5ã€serviceå±‚</h3><blockquote><p>CourseServiceImpl</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebCourseVo <span class="title">selectWebCourseVoById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ›´æ–°è¯¾ç¨‹æµè§ˆæ•°</span></span><br><span class="line">    Course course = baseMapper.selectById(id);</span><br><span class="line">    course.setViewCount(course.getViewCount() + <span class="number">1</span>);</span><br><span class="line">    baseMapper.updateById(course);</span><br><span class="line">    <span class="comment">//è·å–è¯¾ç¨‹ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> baseMapper.selectWebCourseVoById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ChapterServiceImpl</p><p>ç”±äºå‰é¢ä½¿ç”¨å­æŸ¥è¯¢å¯¼è‡´æŸ¥è¯¢é€Ÿç‡ä½ä¸‹ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œä½¿ç”¨videoè¡¨å†—ä½™çš„CourseIdå­—æ®µæ¥æé«˜æŸ¥è¯¢é€Ÿç‡ï¼Œæ­¥éª¤å¦‚ä¸‹</p><ul><li>é€šè¿‡Chapterç±»çš„courseIdè·å–è¯¥è¯¾ç¨‹ä¸‹çš„æ‰€æœ‰ç« èŠ‚å¯¹è±¡</li><li>é€šè¿‡Videoç±»å†—ä½™çš„courseIdè·å–è¯¥è¯¾ç¨‹ä¸‹çš„æ‰€æœ‰å°èŠ‚å¯¹è±¡</li><li>å¾ªç¯éå†è¯¥è¯¾ç¨‹ä¸‹çš„ç« èŠ‚å¯¹è±¡åˆ—è¡¨ï¼Œé€šè¿‡Chapterå¯¹è±¡çš„idå’ŒVideoå¯¹è±¡çš„chapterIdå­—æ®µæ¥å»ºç«‹è”ç³»ï¼Œç»„è£…Chapterå¯¹è±¡çš„Videoåˆ—è¡¨</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;ChapterVo&gt; <span class="title">nestedList</span><span class="params">(String courseId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1 é€šè¿‡courseIdè·å–ç« èŠ‚åˆ—è¡¨ä¿¡æ¯ï¼šList&lt;Chapter&gt;</span></span><br><span class="line">    QueryWrapper&lt;Chapter&gt; chapterQueryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    chapterQueryWrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId);</span><br><span class="line">    List&lt;Chapter&gt; chapterList = chapterMapper.selectList(chapterQueryWrapper);</span><br><span class="line">    <span class="comment">//2 é€šè¿‡edu_videoè¡¨ä¸­å†—ä½™çš„course_idè·å–å±äºè¿™ä¸ªè¯¾ç¨‹çš„æ‰€æœ‰Videoåˆ—è¡¨ï¼šList&lt;Video&gt;</span></span><br><span class="line">    QueryWrapper&lt;Video&gt; videoQueryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    videoQueryWrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId);</span><br><span class="line">    List&lt;Video&gt; videoList = videoMapper.selectList(videoQueryWrapper);</span><br><span class="line">    <span class="comment">//3 å…ˆè·å–ç« èŠ‚ä¿¡æ¯ChapterVoåˆ—è¡¨ï¼Œå†è·å–VideoVoåˆ—è¡¨</span></span><br><span class="line">    List&lt;ChapterVo&gt; chapterVoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    chapterList.forEach(chapter -&gt; &#123;</span><br><span class="line">        ChapterVo chapterVo = <span class="keyword">new</span> ChapterVo();</span><br><span class="line">        BeanUtils.copyProperties(chapter,chapterVo);</span><br><span class="line">        chapterVoList.add(chapterVo);</span><br><span class="line">        List&lt;VideoVo&gt; videoVoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//4 å¾ªç¯ç»„è£…ç« èŠ‚ä¿¡æ¯åˆ—è¡¨</span></span><br><span class="line">        videoList.forEach(video -&gt; &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœå½“å‰chapterçš„idçš„å€¼ç­‰äºvideoçš„chapterIdå€¼</span></span><br><span class="line">            <span class="comment">//è¯æ˜å½“å‰videoå¯¹è±¡å±äºè¯¥Chapterå¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span>(StringUtils.equals(chapter.getId(),video.getChapterId())) &#123;</span><br><span class="line">                VideoVo videoVo = <span class="keyword">new</span> VideoVo();</span><br><span class="line">                BeanUtils.copyProperties(video,videoVo);</span><br><span class="line">                videoVoList.add(videoVo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        chapterVo.setChildren(videoVoList);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> chapterVoList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›®æ€»ç»“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ’Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸‰ï¼‰-SSMæ¡†æ¶æ•´åˆåŠåŸºæœ¬ä½¿ç”¨</title>
      <link href="posts/3009255528.html"/>
      <url>posts/3009255528.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><blockquote><p>SSMæ¡†æ¶å¤šç§æ•´åˆæ–¹å¼ï¼Œè¿™é‡Œä½¿ç”¨æ³¨è§£+XMLæ–‡ä»¶çš„æ–¹å¼æ¥è¿›è¡Œæ•´åˆå¼€å‘</p></blockquote><h1 id="ä¸€ã€å‰æœŸå‡†å¤‡"><a href="#ä¸€ã€å‰æœŸå‡†å¤‡" class="headerlink" title="ä¸€ã€å‰æœŸå‡†å¤‡"></a>ä¸€ã€å‰æœŸå‡†å¤‡</h1><h2 id="1-1ã€åˆ›å»ºæ•°æ®åº“ä¸è¡¨"><a href="#1-1ã€åˆ›å»ºæ•°æ®åº“ä¸è¡¨" class="headerlink" title="1.1ã€åˆ›å»ºæ•°æ®åº“ä¸è¡¨"></a>1.1ã€åˆ›å»ºæ•°æ®åº“ä¸è¡¨</h2><blockquote><p>æ‰“å¼€æ•°æ®åº“å¯è§†åŒ–å·¥å…·ï¼Œæ‰§è¡Œä»¥ä¸‹sqlè¯­å¥</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE ssm;</span><br><span class="line"></span><br><span class="line">USE ssm;</span><br><span class="line"></span><br><span class="line">CREATE TABLE &#96;student&#96;(</span><br><span class="line">    id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    &#96;name&#96; VARCHAR(32),</span><br><span class="line">    score DOUBLE</span><br><span class="line">);</span><br><span class="line">INSERT INTO &#96;student&#96; VALUES (1, &#39;A&#39;, 80);</span><br><span class="line">INSERT INTO &#96;student&#96; VALUES (2, &#39;B&#39;, 95);</span><br><span class="line">INSERT INTO &#96;student&#96; VALUES (3, &#39;C&#39;, 90);</span><br><span class="line">INSERT INTO &#96;student&#96; VALUES (4, &#39;D&#39;, 100);</span><br></pre></td></tr></table></figure><h2 id="1-2ã€åˆ›å»ºmavené¡¹ç›®"><a href="#1-2ã€åˆ›å»ºmavené¡¹ç›®" class="headerlink" title="1.2ã€åˆ›å»ºmavené¡¹ç›®"></a>1.2ã€åˆ›å»ºmavené¡¹ç›®</h2><blockquote><p>æ³¨ï¼šè¿™é‡Œéœ€è¦ä»¥maven-archetype-webappä¸ºéª¨æ¶æ„å»ºé¡¹ç›®</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131125931.png" alt="image-20210131125931386"></p><blockquote><p>è®¾ç½®é¡¹ç›®è·¯å¾„ä¸åæ ‡åï¼Œç‚¹å‡»next</p></blockquote><blockquote><p>é€‰æ‹©é¡¹ç›®ä½¿ç”¨çš„mavenç‰ˆæœ¬åŠsettings.xmlæ–‡ä»¶ï¼Œ<strong>åœ¨å±æ€§ä¸­æ·»åŠ ä¸€é”®å€¼å¯¹</strong>ï¼š**(archetypeCatalog:internal)**ï¼Œè¿™ä¸ªé”®å€¼å¯¹å¯ä»¥è§£å†³mavené¡¹ç›®æ„å»ºé€Ÿåº¦è¿‡æ…¢çš„é—®é¢˜ã€‚</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131130358.png" alt="image-20210131130358733"></p><h2 id="1-3ã€ç¼–è¾‘pom-xml"><a href="#1-3ã€ç¼–è¾‘pom-xml" class="headerlink" title="1.3ã€ç¼–è¾‘pom.xml"></a>1.3ã€ç¼–è¾‘pom.xml</h2><blockquote><p>åœ¨pom.xmlæ–‡ä»¶ä¸­<strong>å¼•å…¥é¡¹ç›®ä¾èµ–</strong>ä¸<strong>ç‰ˆæœ¬é”å®š</strong></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.6<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- spring --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- aopç›¸å…³çš„æŠ€æœ¯ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- aop --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- contextå®¹å™¨ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- web --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- webmvc --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- springæµ‹è¯• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- äº‹åŠ¡ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- jdbcæ¨¡æ¿æŠ€æœ¯ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å•å…ƒæµ‹è¯• --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- mysqlè¿æ¥ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- servlet --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- jsp --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- EL JL TLè¡¨è¾¾å¼ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- log start --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- log end --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- mybatisç›¸å…³ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- druid è¿æ¥æ±  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-4ã€å®Œå–„ç›®å½•ç»“æ„"><a href="#1-4ã€å®Œå–„ç›®å½•ç»“æ„" class="headerlink" title="1.4ã€å®Œå–„ç›®å½•ç»“æ„"></a>1.4ã€å®Œå–„ç›®å½•ç»“æ„</h2><ul><li>åœ¨src/mainç›®å½•ä¸‹åˆ›å»ºjavaæ–‡ä»¶å¤¹ä¸resourceæ–‡ä»¶å¤¹ã€‚</li><li>åœ¨ä¸Šä¸€æ­¥åˆ›å»ºçš„javaç›®å½•ä¸‹åˆ›å»ºcom.hzx.entityã€com.hzx.daoã€com.hzx.controllerã€com.hzx.serviceå’Œcom.hzx.teståŒ…</li></ul><blockquote><p>å®Œå–„åçš„ç›®å½•å¦‚ä¸‹ï¼š</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131131024.png" alt="image-20210131131024222"></p><h2 id="1-5ã€åˆ›å»ºåŸºæœ¬ç±»"><a href="#1-5ã€åˆ›å»ºåŸºæœ¬ç±»" class="headerlink" title="1.5ã€åˆ›å»ºåŸºæœ¬ç±»"></a>1.5ã€åˆ›å»ºåŸºæœ¬ç±»</h2><blockquote><p>æ ¹æ®æ•°æ®åº“çš„è¡¨ç»“æ„åˆ›å»ºå®ä½“ç±»ï¼Œè¿™é‡Œä½¿ç”¨äº†<strong>Lombok</strong>ç®€åŒ–å¼€å‘</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hzx.entity;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨serviceåŒ…ä¸‹åˆ›å»ºä¸€ä¸ªStudentServiceæ¥å£ï¼Œå†åˆ›å»ºä¸€ä¸ªimplåŒ…ï¼Œç„¶ååœ¨implåŒ…ä¸‹æ–°å»ºä¸€ä¸ªStudentServiceImplå®ç°ç±»ï¼Œè¿™ä¸ªç±»å®ç°StudentServiceæ¥å£ã€‚</p></blockquote><ul><li>æ¥å£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hzx.service;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®ç°ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hzx.service.impl;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨mapperåŒ…ä¸‹åˆ›å»ºStudentMapperæ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hzx.mapper;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨controlleråŒ…ä¸‹åˆ›å»ºä¸€ä¸ªStudentControlleræ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hzx.controller;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="äºŒã€Springç›¸å…³ç¯å¢ƒé…ç½®"><a href="#äºŒã€Springç›¸å…³ç¯å¢ƒé…ç½®" class="headerlink" title="äºŒã€Springç›¸å…³ç¯å¢ƒé…ç½®"></a>äºŒã€Springç›¸å…³ç¯å¢ƒé…ç½®</h1><h2 id="2-1ã€ç¼–å†™Springæ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#2-1ã€ç¼–å†™Springæ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="2.1ã€ç¼–å†™Springæ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>2.1ã€ç¼–å†™Springæ ¸å¿ƒé…ç½®æ–‡ä»¶</h2><blockquote><p>åœ¨resourceç›®å½•ä¸‹åˆ›å»ºSpringæ ¸å¿ƒé…ç½®æ–‡ä»¶â€“applicationContext.xml</p><p>åœ¨è¿™ä¸ªæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦</p></blockquote><ul><li>å¼€å¯ç»„ä»¶æ‰«æï¼Œæ‰«æcom.hzxåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶</li><li>ç”±äºcontrolleråŒ…ä¸‹çš„æ§åˆ¶å™¨ç»„ä»¶å±äºSpringMVCï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶æ‰«æä¸­æ’é™¤com.hzxåŒ…ä¸‹æ‰€æœ‰æ·»åŠ äº†@Controlleræ³¨è§£çš„ç»„ä»¶ã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯æ³¨è§£æ‰«æï¼Œå¤„ç†serviceå’Œdaoï¼Œä½†æ˜¯ä¸éœ€è¦å¤„ç† controller --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hzx&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®å“ªäº›æ³¨è§£ä¸æ‰«æ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-2ã€æµ‹è¯•"><a href="#2-2ã€æµ‹è¯•" class="headerlink" title="2.2ã€æµ‹è¯•"></a>2.2ã€æµ‹è¯•</h2><blockquote><p>åœ¨StudentServiceImplä¸Šæ·»åŠ @Serviceæ³¨è§£ï¼ŒåŒæ—¶æ·»åŠ ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getAllStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚çš„getAllæ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨Mapperå±‚ä¸æ•°æ®åº“äº¤äº’.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨com.hzx.teståŒ…ä¸‹åˆ›å»ºä¸€ä¸ªTestSpringç±»ï¼Œç¼–å†™æ–¹æ³•ä½¿ç”¨junitè¿›è¡Œæµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSpring</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext ioc = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        StudentService studentService = ioc.getBean(StudentServiceImpl.class);</span><br><span class="line">        studentService.getAllStudent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131133141.png" alt="image-20210131133141706"></p><blockquote><p>å‡ºç°ä»¥ä¸Šç»“æœè¯æ˜SpringåŸºæœ¬ç¯å¢ƒå·²ç»æ­å»ºå®Œæˆï¼Œä¸‹é¢é…ç½®SpringMVC</p></blockquote><h1 id="ä¸‰ã€SpringMVCç›¸å…³ç¯å¢ƒé…ç½®"><a href="#ä¸‰ã€SpringMVCç›¸å…³ç¯å¢ƒé…ç½®" class="headerlink" title="ä¸‰ã€SpringMVCç›¸å…³ç¯å¢ƒé…ç½®"></a>ä¸‰ã€SpringMVCç›¸å…³ç¯å¢ƒé…ç½®</h1><h2 id="3-1ã€é…ç½®web-xml"><a href="#3-1ã€é…ç½®web-xml" class="headerlink" title="3,1ã€é…ç½®web.xml"></a>3,1ã€é…ç½®web.xml</h2><blockquote><p>é…ç½®SpringMVCçš„æ ¸å¿ƒå‰ç«¯æ§åˆ¶å™¨ï¼š<strong>DispatcherServlet</strong></p><p>web.xmlæ–‡ä»¶ä½ç½®å¦‚ä¸‹</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131133440.png" alt="image-20210131133440460"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®å‰ç«¯æ§åˆ¶å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--åŠ è½½springmvc.xmlé…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--å¯åŠ¨æœåŠ¡å™¨ï¼Œåˆ›å»ºè¯¥servlet--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>é…ç½®å‰ç«¯æ§åˆ¶å™¨çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šspringmvcçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä½ç½®ï¼Œåœ¨resourceç›®å½•ä¸‹åˆ›å»ºspringmvcæ ¸å¿ƒé…ç½®æ–‡ä»¶â€“<strong>springmvc.xml</strong></p></li><li><p>ä½¿ç”¨è¯¥å‰ç«¯æ§åˆ¶å™¨æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œåœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶åˆ›å»ºè¯¥servlet</p></li></ul><blockquote><p>é…ç½®å­—ç¬¦ç¼–ç è¿‡æ»¤å™¨ï¼Œç”¨äºè§£å†³ä¸­æ–‡ä¹±ç </p><p>æ³¨ï¼š<strong>å¦‚æœé…ç½®äº†å¤šä¸ªè¿‡æ»¤å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ç¼–ç è¿‡æ»¤å™¨å¿…é¡»æ”¾åœ¨æœ€å‰</strong></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®è¿‡æ»¤å™¨ï¼Œè§£å†³ä¸­æ–‡ä¹±ç --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¯é€‰ï¼šå¦‚æœä½ åœ¨SSMæ¡†æ¶ä¸­æƒ³ä½¿ç”¨RESTé£æ ¼çš„APIï¼Œé‚£ä¹ˆéœ€è¦é…ç½®ä¸€ä¸ª<strong>HiddenHttpMethodFilter</strong></p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®ä½¿ç”¨Resté£æ ¼çš„URL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-2ã€é…ç½®springmvc-xml"><a href="#3-2ã€é…ç½®springmvc-xml" class="headerlink" title="3.2ã€é…ç½®springmvc.xml"></a>3.2ã€é…ç½®springmvc.xml</h2><blockquote><p>åœ¨resourceç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªspringmvc.xmlé…ç½®æ–‡ä»¶</p></blockquote><ul><li><p>åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œå¼•å…¥å‘½åç©ºé—´</p></li><li><p>å¼€å¯ç»„ä»¶æ‰«æï¼Œç”±äºSpringæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å·²ç»æ‰«æé™¤<strong>æ§åˆ¶å™¨</strong>ä¹‹å¤–çš„ç»„ä»¶ï¼Œæ‰€ä»¥åœ¨springmvcæ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­åªéœ€è¦æ‰«ææ§åˆ¶å™¨å³å¯ã€‚</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1  å¼€å¯åªå¯¹controllerçš„æ‰«æ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hzx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é…ç½®è§†å›¾è§£æå™¨ï¼Œåœ¨WEB-INFæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªpagesæ–‡ä»¶å¤¹</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--2 é…ç½®è§†å›¾è§£æå™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;org&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--JSP ç›®å½•--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ–‡ä»¶åç¼€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åœ¨webappç›®å½•ä¸‹åˆ›å»ºä¸‰ä¸ªç”¨äºå­˜æ”¾é™æ€èµ„æºçš„æ–‡ä»¶å¤¹ï¼ˆcssã€imagesã€jsï¼‰ï¼Œå¹¶æ”¾è¡Œé™æ€èµ„æº</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--3 ä¸è¿‡æ»¤é™æ€èµ„æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/css/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/images/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/images/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å¼€å¯æ³¨è§£æ”¯æŒ</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--4 å¼€å¯æ³¨è§£æ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>springmvc.xmlé…ç½®å¦‚ä¸‹ï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--1  å¼€å¯åªå¯¹controllerçš„æ‰«æ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hzx&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2 é…ç½®è§†å›¾è§£æå™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;org&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--JSP ç›®å½•--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ–‡ä»¶åç¼€--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--3 ä¸è¿‡æ»¤é™æ€èµ„æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/css/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/images/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/images/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--4 å¼€å¯æ³¨è§£æ”¯æŒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-3ã€ç¼–å†™é¡µé¢"><a href="#3-3ã€ç¼–å†™é¡µé¢" class="headerlink" title="3.3ã€ç¼–å†™é¡µé¢"></a>3.3ã€ç¼–å†™é¡µé¢</h2><blockquote><p>ä¿®æ”¹index.jsp</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ä¸»é¡µ&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;a href=&quot;student/getAll&quot;&gt;æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨WEB-INF/pagesç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªlist.jsp</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;æŸ¥è¯¢æ‰€æœ‰é¡µé¢&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;è¿™æ˜¯å­¦ç”Ÿåˆ—è¡¨&lt;/h3&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2 id="3-4ã€æµ‹è¯•"><a href="#3-4ã€æµ‹è¯•" class="headerlink" title="3.4ã€æµ‹è¯•"></a>3.4ã€æµ‹è¯•</h2><blockquote><p>åœ¨StudentControlleræ·»åŠ ä¸€æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨äºè·³è½¬åˆ°list.jspé¡µé¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.setViewName(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®tomcat</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131140153.png" alt="image-20210131140153219"></p><blockquote><p>ç‚¹å‡»è¶…é“¾æ¥åè·³è½¬æˆåŠŸï¼Œè¯æ˜SpringmvcåŸºæœ¬é…ç½®å®Œæˆ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131140235.png" alt="image-20210131140235530"></p><h1 id="å››ã€Springæ•´åˆSpring-MVC"><a href="#å››ã€Springæ•´åˆSpring-MVC" class="headerlink" title="å››ã€Springæ•´åˆSpring MVC"></a>å››ã€Springæ•´åˆSpring MVC</h1><h2 id="4-1ã€é…ç½®ç›‘å¬å™¨"><a href="#4-1ã€é…ç½®ç›‘å¬å™¨" class="headerlink" title="4.1ã€é…ç½®ç›‘å¬å™¨"></a>4.1ã€é…ç½®ç›‘å¬å™¨</h2><blockquote><p>é€šè¿‡å¯¹ Spring MVC çš„ä»£ç ç¼–å†™ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™å°±å›å»åŠ è½½ springmvc.xml è¿™ä¸ªé…ç½®ï¼Œç°åœ¨æˆ‘ä»¬å°±éœ€è¦ç»§ç»­åœ¨ web.xml ä¸­é…ç½®ï¼Œä½¿å¾—åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œå°±å»åŠ è½½applicationContext.xmlçš„é…ç½®æ–‡ä»¶</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ <strong>web.xml</strong> ä¸­ï¼Œ<strong>é…ç½®springæ ¸å¿ƒç›‘å¬å™¨</strong>ï¼Œå®ƒé»˜è®¤ä¼šä»¥ /WEB-INF/applicationContext.xmlä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„web.xmlæ–‡ä»¶ä¸­å„ä¸ªç»„ä»¶çš„å­˜æ”¾ä½ç½®</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½® Spring çš„ç›‘å¬å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-2ã€ä½¿ç”¨controllerè°ƒç”¨service"><a href="#4-2ã€ä½¿ç”¨controllerè°ƒç”¨service" class="headerlink" title="4.2ã€ä½¿ç”¨controllerè°ƒç”¨service"></a>4.2ã€ä½¿ç”¨controllerè°ƒç”¨service</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentService studentService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ§åˆ¶å±‚çš„getAllæ–¹æ³•...&quot;</span>);</span><br><span class="line">        studentService.getAllStudent();</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.setViewName(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3ã€é‡æ–°å¯åŠ¨tomcatï¼Œæµ‹è¯•"><a href="#4-3ã€é‡æ–°å¯åŠ¨tomcatï¼Œæµ‹è¯•" class="headerlink" title="4.3ã€é‡æ–°å¯åŠ¨tomcatï¼Œæµ‹è¯•"></a>4.3ã€é‡æ–°å¯åŠ¨tomcatï¼Œæµ‹è¯•</h2><blockquote><p>åœ¨tomcatçš„VM optionsä¸­å¡«å…¥ï¼š-Dfile.encoding=UTF-8ï¼Œç”¨äºè§£å†³IDEAçš„æ§åˆ¶å°ä¹±ç é—®é¢˜</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131141119.png" alt="image-20210131141119573"></p><h1 id="äº”ã€ä½¿ç”¨Springæ•´åˆMybatis"><a href="#äº”ã€ä½¿ç”¨Springæ•´åˆMybatis" class="headerlink" title="äº”ã€ä½¿ç”¨Springæ•´åˆMybatis"></a>äº”ã€ä½¿ç”¨Springæ•´åˆMybatis</h1><h2 id="5-1ã€ç¼–å†™Mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#5-1ã€ç¼–å†™Mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="5.1ã€ç¼–å†™Mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>5.1ã€ç¼–å†™Mybatisæ ¸å¿ƒé…ç½®æ–‡ä»¶</h2><blockquote><p>åœ¨resourceç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªSqlMapConfig.xmlï¼Œè¿™ä¸ªæ–‡ä»¶å…¶å®å¯ä»¥çœç•¥ï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯ç”¨å®ƒæ¥ç¼–å†™ç±»åç®€åŒ–é…ç½®ã€‚</p></blockquote><ul><li>åˆ›å»ºSqlMapConfig.xmlé…ç½®æ–‡ä»¶</li><li>æ‰«æcom.hzxåŒ…ï¼Œä¸ºåŒ…ä¸‹çš„å®ä½“ç±»èµ·ä¸€ä¸ªåˆ«åï¼Œå¹¶åœ¨æ§åˆ¶å°è¾“å‡ºæ‰§è¡Œçš„sql</li><li>ä¸æ•°æ®åº“è¿æ¥ç›¸å…³çš„é…ç½®æˆ‘ä»¬æ”¾åœ¨Springçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ‰“å°æŸ¥è¯¢è¯­å¥ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.hzx&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-2ã€ç¼–å†™StudentMapperæ¥å£"><a href="#5-2ã€ç¼–å†™StudentMapperæ¥å£" class="headerlink" title="5.2ã€ç¼–å†™StudentMapperæ¥å£"></a>5.2ã€ç¼–å†™StudentMapperæ¥å£</h2><blockquote><p>ä½¿ç”¨æ³¨è§£å½¢å¼ç¼–å†™sqlè¯­å¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨xmlé…ç½®æ–‡ä»¶çš„æ–¹å¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from `ssm`.`student`&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Student&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * å‘æ•°æ®åº“ä¸­æ’å…¥ä¸€ä¸ªå­¦ç”Ÿ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> student</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into `ssm`.`student`(name,score) values(#&#123;name&#125;,#&#123;score&#125;)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">addStudent</span><span class="params">(Student student)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-3ã€ç¼–å†™é“¾æ¥æ•°æ®åº“çš„é…ç½®æ–‡ä»¶"><a href="#5-3ã€ç¼–å†™é“¾æ¥æ•°æ®åº“çš„é…ç½®æ–‡ä»¶" class="headerlink" title="5.3ã€ç¼–å†™é“¾æ¥æ•°æ®åº“çš„é…ç½®æ–‡ä»¶"></a>5.3ã€ç¼–å†™é“¾æ¥æ•°æ®åº“çš„é…ç½®æ–‡ä»¶</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/ssm?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;nullCatalogMeansCurrent=true&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">tianxin1230.</span></span><br></pre></td></tr></table></figure><h2 id="5-4ã€ä¿®æ”¹Springæ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#5-4ã€ä¿®æ”¹Springæ ¸å¿ƒé…ç½®æ–‡ä»¶" class="headerlink" title="5.4ã€ä¿®æ”¹Springæ ¸å¿ƒé…ç½®æ–‡ä»¶"></a>5.4ã€ä¿®æ”¹Springæ ¸å¿ƒé…ç½®æ–‡ä»¶</h2><blockquote><p>åœ¨Springæ ¸å¿ƒé…ç½®æ–‡ä»¶é…ç½®æ•°æ®åº“è¿æ¥æ± ï¼Œå¼•å…¥propertiesæ–‡ä»¶</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span> <span class="attr">ignore-unresolvable</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®æ•°æ®åº“è¿æ¥æ± --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ•°æ®åº“åŸºæœ¬ä¿¡æ¯é…ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®SqlSessionFactoryå·¥å‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®StudentMapperæ¥å£æ‰€åœ¨åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mapperScanner&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.hzx.mapper&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-5ã€ä¿®æ”¹serviceå®ç°ç±»å’Œcontrollerå±‚"><a href="#5-5ã€ä¿®æ”¹serviceå®ç°ç±»å’Œcontrollerå±‚" class="headerlink" title="5.5ã€ä¿®æ”¹serviceå®ç°ç±»å’Œcontrollerå±‚"></a>5.5ã€ä¿®æ”¹serviceå®ç°ç±»å’Œcontrollerå±‚</h2><blockquote><p>serviceå®ç°ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentMapper studentMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getAllStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚çš„getAllæ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨Mapperå±‚ä¸æ•°æ®åº“äº¤äº’.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> studentMapper.getAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addStudent</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚çš„addStudentæ–¹æ³•ï¼Œéœ€è¦è°ƒç”¨Mapperå±‚ä¸æ•°æ®åº“äº¤äº’.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> studentMapper.addStudent(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>controllerå±‚</p><p>ä¿®æ”¹getAllæ–¹æ³•ï¼Œå¹¶æ·»åŠ addæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StudentService studentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ§åˆ¶å±‚çš„getAllæ–¹æ³•...&quot;</span>);</span><br><span class="line">        List&lt;Student&gt; students = studentService.getAllStudent();</span><br><span class="line">        ModelAndView mv = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">        mv.addObject(<span class="string">&quot;students&quot;</span>,students);</span><br><span class="line">        mv.setViewName(<span class="string">&quot;list&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Student student, HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException, IOException </span>&#123;</span><br><span class="line">        studentService.addStudent(student);</span><br><span class="line">        response.sendRedirect(request.getContextPath()+<span class="string">&quot;/student/getAll&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-6ã€ä¿®æ”¹index-jspå’Œ"><a href="#5-6ã€ä¿®æ”¹index-jspå’Œ" class="headerlink" title="5.6ã€ä¿®æ”¹index.jspå’Œ"></a>5.6ã€ä¿®æ”¹index.jspå’Œ</h2><blockquote><p>index.jsp</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ä¸»é¡µ&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;a href=&quot;student/getAll&quot;&gt;æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ&lt;/a&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;student/add&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        å­¦ç”Ÿå§“å:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">        å­¦ç§‘æˆç»©:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;score&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;æ·»åŠ &quot;</span>/&gt;&lt;br/&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>list.jsp</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> isELIgnored=<span class="string">&quot;false&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;å­¦ç”Ÿåˆ—è¡¨&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h3&gt;å­¦ç”Ÿåˆ—è¡¨&lt;/h3&gt;</span><br><span class="line">    &lt;c:forEach items=<span class="string">&quot;$&#123;students&#125;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;student&quot;</span>&gt;</span><br><span class="line">        $&#123;student.name&#125; çš„æˆç»©ä¸º: $&#123;student.score&#125;</span><br><span class="line">    &lt;/c:forEach&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿæ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131143231.png" alt="image-20210131143231582"></p><blockquote><p>æµ‹è¯•æ·»åŠ æ‰€æœ‰å­¦ç”Ÿæ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131143459.png" alt="image-20210131143459450"></p><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210131144430.png" alt="image-20210131144429826"></p><h2 id="5-7ã€æ·»åŠ äº‹åŠ¡æ§åˆ¶"><a href="#5-7ã€æ·»åŠ äº‹åŠ¡æ§åˆ¶" class="headerlink" title="5.7ã€æ·»åŠ äº‹åŠ¡æ§åˆ¶"></a>5.7ã€æ·»åŠ äº‹åŠ¡æ§åˆ¶</h2><blockquote><p>ä¿®æ”¹springæ ¸å¿ƒé…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®Springæ¡†æ¶å£°æ˜å¼äº‹åŠ¡ç®¡ç†--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--é…ç½®äº‹åŠ¡ç®¡ç†å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é…ç½®äº‹åŠ¡é€šçŸ¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">isolation</span>=<span class="string">&quot;DEFAULT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é…ç½®AOPå¢å¼º--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* cn.ideal.service.impl.*ServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¡†æ¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ’Mybatis </tag>
            
            <tag> ğŸƒSpring </tag>
            
            <tag> ğŸƒSpring MVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåº”ç”¨å­¦ä¹ ï¼ˆäºŒï¼‰-Springbootæ•´åˆswagger/swagger-Bootstrap-UIä½¿ç”¨</title>
      <link href="posts/2938255980.html"/>
      <url>posts/2938255980.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€SwaggeråŠSwagger-Bootstrap-UIç®€ä»‹"><a href="#ä¸€ã€SwaggeråŠSwagger-Bootstrap-UIç®€ä»‹" class="headerlink" title="ä¸€ã€SwaggeråŠSwagger-Bootstrap-UIç®€ä»‹"></a>ä¸€ã€SwaggeråŠSwagger-Bootstrap-UIç®€ä»‹</h1><h2 id="1-1ã€swaggerç®€ä»‹"><a href="#1-1ã€swaggerç®€ä»‹" class="headerlink" title="1.1ã€swaggerç®€ä»‹"></a>1.1ã€swaggerç®€ä»‹</h2><blockquote><p><a href="https://swagger.io/">Swagger</a> æ˜¯ä¸€æ¬¾RESTFULæ¥å£çš„ã€åŸºäºYAMLã€JSONè¯­è¨€çš„æ–‡æ¡£åœ¨çº¿è‡ªåŠ¨ç”Ÿæˆã€ä»£ç è‡ªåŠ¨ç”Ÿæˆçš„å·¥å…·ã€‚æ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡ã€‚</p><p>æ€»ä½“ç›®æ ‡æ˜¯ä½¿å®¢æˆ·ç«¯å’Œæ–‡ä»¶ç³»ç»Ÿä½œä¸ºæœåŠ¡å™¨ä»¥åŒæ ·çš„é€Ÿåº¦æ¥æ›´æ–°ã€‚æ–‡ä»¶çš„æ–¹æ³•ã€å‚æ•°å’Œæ¨¡å‹ç´§å¯†é›†æˆåˆ°æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼Œå…è®¸ API æ¥å§‹ç»ˆä¿æŒåŒæ­¥ã€‚Swagger è®©éƒ¨ç½²ç®¡ç†å’Œä½¿ç”¨åŠŸèƒ½å¼ºå¤§çš„ API ä»æœªå¦‚æ­¤ç®€å•ã€‚</p></blockquote><h2 id="1-2ã€å…³äºSwagger-Bootstrap-UI"><a href="#1-2ã€å…³äºSwagger-Bootstrap-UI" class="headerlink" title="1.2ã€å…³äºSwagger-Bootstrap-UI"></a>1.2ã€å…³äºSwagger-Bootstrap-UI</h2><h3 id="1-2-1ã€ç®€ä»‹"><a href="#1-2-1ã€ç®€ä»‹" class="headerlink" title="1.2.1ã€ç®€ä»‹"></a>1.2.1ã€ç®€ä»‹</h3><blockquote><p><a href="https://gitee.com/xiaoym/swagger-bootstrap-ui">swagger-bootstrap-ui</a>æ˜¯springfox-swaggerçš„å¢å¼ºUIå®ç°ï¼Œä¸ºJavaå¼€å‘è€…åœ¨ä½¿ç”¨Swaggerçš„æ—¶å€™ï¼Œèƒ½æ‹¥æœ‰ä¸€ä»½ç®€æ´ã€å¼ºå¤§çš„æ¥å£æ–‡æ¡£ä½“éªŒã€‚</p></blockquote><h3 id="1-2-2ã€æ ¸å¿ƒåŠŸèƒ½"><a href="#1-2-2ã€æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="1.2.2ã€æ ¸å¿ƒåŠŸèƒ½"></a>1.2.2ã€æ ¸å¿ƒåŠŸèƒ½</h3><blockquote><p>è¯¥UIå¢å¼ºåŒ…ä¸»è¦åŒ…æ‹¬ä¸¤å¤§æ ¸å¿ƒåŠŸèƒ½ï¼š<strong>æ–‡æ¡£è¯´æ˜</strong> å’Œ <strong>åœ¨çº¿è°ƒè¯•</strong></p><ul><li><p><strong>æ–‡æ¡£è¯´æ˜</strong>ï¼šæ ¹æ®Swaggerçš„è§„èŒƒè¯´æ˜ï¼Œè¯¦ç»†åˆ—å‡ºæ¥å£æ–‡æ¡£çš„è¯´æ˜ï¼ŒåŒ…æ‹¬æ¥å£åœ°å€ã€ç±»å‹ã€è¯·æ±‚ç¤ºä¾‹ã€è¯·æ±‚å‚æ•°ã€å“åº”ç¤ºä¾‹ã€å“åº”å‚æ•°ã€å“åº”ç ç­‰ä¿¡æ¯ï¼Œä½¿ç”¨swagger-bootstrap-uièƒ½æ ¹æ®è¯¥æ–‡æ¡£è¯´æ˜ï¼Œå¯¹è¯¥æ¥å£çš„ä½¿ç”¨æƒ…å†µä¸€ç›®äº†ç„¶ã€‚</p></li><li><p><strong>åœ¨çº¿è°ƒè¯•</strong>ï¼šæä¾›åœ¨çº¿æ¥å£è”è°ƒçš„å¼ºå¤§åŠŸèƒ½ï¼Œè‡ªåŠ¨è§£æå½“å‰æ¥å£å‚æ•°,åŒæ—¶åŒ…å«è¡¨å•éªŒè¯ï¼Œè°ƒç”¨å‚æ•°å¯è¿”å›æ¥å£å“åº”å†…å®¹ã€headersã€Curlè¯·æ±‚å‘½ä»¤å®ä¾‹ã€å“åº”æ—¶é—´ã€å“åº”çŠ¶æ€ç ç­‰ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨çº¿è°ƒè¯•ï¼Œè€Œä¸å¿…é€šè¿‡å…¶ä»–æµ‹è¯•å·¥å…·æµ‹è¯•æ¥å£æ˜¯å¦æ­£ç¡®,ç®€ä»‹ã€å¼ºå¤§ã€‚</p></li></ul></blockquote><h3 id="1-2-3ã€UIå¢å¼º"><a href="#1-2-3ã€UIå¢å¼º" class="headerlink" title="1.2.3ã€UIå¢å¼º"></a>1.2.3ã€UIå¢å¼º</h3><blockquote><p>åŒæ—¶ï¼Œswagger-bootstrap-uiåœ¨æ»¡è¶³ä»¥ä¸ŠåŠŸèƒ½çš„åŒæ—¶ï¼Œè¿˜æä¾›äº†æ–‡æ¡£çš„å¢å¼ºåŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½æ˜¯å®˜æ–¹swagger-uiæ‰€æ²¡æœ‰çš„ï¼Œæ¯ä¸€ä¸ªå¢å¼ºçš„åŠŸèƒ½éƒ½æ˜¯è´´åˆå®é™…,è€ƒè™‘åˆ°å¼€å‘è€…çš„å®é™…å¼€å‘éœ€è¦,æ˜¯æ¯”ä¸å¯å°‘çš„åŠŸèƒ½ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li><p><strong>ä¸ªæ€§åŒ–é…ç½®</strong>ï¼šé€šè¿‡ä¸ªæ€§åŒ–uié…ç½®é¡¹ï¼Œå¯è‡ªå®šä¹‰UIçš„ç›¸å…³æ˜¾ç¤ºä¿¡æ¯</p></li><li><p><strong>ç¦»çº¿æ–‡æ¡£</strong>ï¼šæ ¹æ®æ ‡å‡†è§„èŒƒï¼Œç”Ÿæˆçš„åœ¨çº¿markdownç¦»çº¿æ–‡æ¡£ï¼Œå¼€å‘è€…å¯ä»¥è¿›è¡Œæ‹·è´ç”Ÿæˆmarkdownæ¥å£æ–‡æ¡£ï¼Œé€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹markdownè½¬æ¢å·¥å…·è½¬æ¢æˆhtmlæˆ–pdfï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æ”¾å¼ƒswagger2markdownç»„ä»¶</p></li><li><p><strong>æ¥å£æ’åº</strong>ï¼šè‡ª1.8.5åï¼Œuiæ”¯æŒäº†æ¥å£æ’åºåŠŸèƒ½ï¼Œä¾‹å¦‚ä¸€ä¸ªæ³¨å†ŒåŠŸèƒ½ä¸»è¦åŒ…å«äº†å¤šä¸ªæ­¥éª¤,å¯ä»¥æ ¹æ®swagger-bootstrap-uiæä¾›çš„æ¥å£æ’åºè§„åˆ™å®ç°æ¥å£çš„æ’åºï¼ŒstepåŒ–æ¥å£æ“ä½œï¼Œæ–¹ä¾¿å…¶ä»–å¼€å‘è€…è¿›è¡Œæ¥å£å¯¹æ¥</p></li></ul></blockquote><h3 id="1-2-4ã€UIç‰¹ç‚¹"><a href="#1-2-4ã€UIç‰¹ç‚¹" class="headerlink" title="1.2.4ã€UIç‰¹ç‚¹"></a>1.2.4ã€UIç‰¹ç‚¹</h3><blockquote><ul><li>ä»¥markdownå½¢å¼å±•ç¤ºæ–‡æ¡£,å°†æ–‡æ¡£çš„è¯·æ±‚åœ°å€ã€ç±»å‹ã€è¯·æ±‚å‚æ•°ã€ç¤ºä¾‹ã€å“åº”å‚æ•°åˆ†å±‚æ¬¡ä¾æ¬¡å±•ç¤º,æ¥å£æ–‡æ¡£ä¸€ç›®äº†ç„¶,æ–¹ä¾¿å¼€å‘è€…å¯¹æ¥</li><li>åœ¨çº¿è°ƒè¯•æ é™¤äº†è‡ªåŠ¨è§£æå‚æ•°å¤–,é’ˆå¯¹å¿…å¡«é¡¹ç€é¢œè‰²åŒºåˆ†,åŒæ—¶æ”¯æŒtabé”®å¿«é€Ÿè¾“å…¥ä¸Šä¸‹åˆ‡æ¢.è°ƒè¯•æ—¶å¯è‡ªå®šä¹‰Content-Typeè¯·æ±‚å¤´ç±»å‹</li><li>ä¸ªæ€§åŒ–é…ç½®é¡¹,æ”¯æŒæ¥å£åœ°å€ã€æ¥å£descriptionå±æ€§ã€UIå¢å¼ºç­‰ä¸ªæ€§åŒ–é…ç½®åŠŸèƒ½</li><li>æ¥å£æ’åº,æ”¯æŒåˆ†ç»„åŠæ¥å£çš„æ’åºåŠŸèƒ½</li><li>æ”¯æŒmarkdownæ–‡æ¡£ç¦»çº¿æ–‡æ¡£å¯¼å‡º,ä¹Ÿå¯åœ¨çº¿æŸ¥çœ‹ç¦»çº¿æ–‡æ¡£</li><li>è°ƒè¯•ä¿¡æ¯å…¨å±€ç¼“å­˜,é¡µé¢åˆ·æ–°åä¾ç„¶å­˜åœ¨,æ–¹ä¾¿å¼€å‘è€…è°ƒè¯•</li><li>ä»¥æ›´äººæ€§åŒ–çš„treetableç»„ä»¶å±•ç¤ºSwagger ModelsåŠŸèƒ½</li><li>å“åº”å†…å®¹å¯å…¨å±æŸ¥çœ‹,é’ˆå¯¹å“åº”å†…å®¹å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œå…¨å±æŸ¥çœ‹ï¼Œæ–¹ä¾¿è°ƒè¯•ã€å¤åˆ¶</li><li>æ–‡æ¡£ä»¥å¤štabæ–¹å¼å¯æ˜¾ç¤ºå¤šä¸ªæ¥å£æ–‡æ¡£</li><li>è¯·æ±‚å‚æ•°æ è¯·æ±‚ç±»å‹ã€æ˜¯å¦å¿…å¡«ç€é¢œè‰²åŒºåˆ†</li><li>ä¸»é¡µä¸­ç²—ç•¥ç»Ÿè®¡æ¥å£ä¸åŒç±»å‹æ•°é‡</li><li>æ”¯æŒæ¥å£åœ¨çº¿æœç´¢åŠŸèƒ½</li><li>å·¦å³èœå•å’Œå†…å®¹é¡µå¯è‡ªç”±æ‹–åŠ¨å®½åº¦</li><li>æ”¯æŒè‡ªå®šä¹‰å…¨å±€å‚æ•°åŠŸèƒ½ï¼Œä¸»é¡µåŒ…æ‹¬headeråŠqueryä¸¤ç§ç±»å‹</li><li>i18nå›½é™…åŒ–æ”¯æŒ,ç›®å‰æ”¯æŒï¼šä¸­æ–‡ç®€ä½“ã€ä¸­æ–‡ç¹ä½“ã€è‹±æ–‡</li><li>JSR-303 annotations æ³¨è§£çš„æ”¯æŒ</li></ul></blockquote><h1 id="äºŒã€Spring-bootæ•´åˆSwagger-Bootstrap-UI"><a href="#äºŒã€Spring-bootæ•´åˆSwagger-Bootstrap-UI" class="headerlink" title="äºŒã€Spring-bootæ•´åˆSwagger-Bootstrap-UI"></a>äºŒã€Spring-bootæ•´åˆSwagger-Bootstrap-UI</h1><blockquote><p>ä½¿ç”¨ä¸Šæ¬¡å¤ä¹ Mybatis-Plusæ—¶å»ºç«‹çš„é¡¹ç›®ï¼Œåœ¨è¯¥é¡¹ç›®çš„åŸºç¡€ä¸Šå¯¹Swagger-Bootstrap-uiè¿›è¡Œåˆæ­¥å­¦ä¹ ã€‚</p></blockquote><h2 id="2-1ã€å¼•å…¥ä¾èµ–ã€ç¼–å†™é…ç½®ç±»"><a href="#2-1ã€å¼•å…¥ä¾èµ–ã€ç¼–å†™é…ç½®ç±»" class="headerlink" title="2.1ã€å¼•å…¥ä¾èµ–ã€ç¼–å†™é…ç½®ç±»"></a>2.1ã€å¼•å…¥ä¾èµ–ã€ç¼–å†™é…ç½®ç±»</h2><blockquote><p>å¦‚æœä½¿ç”¨åŸæœ‰çš„swaggerï¼Œé‚£ä¹ˆéœ€è¦å¼•å…¥çš„ä¾èµ–æœ‰</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.swagger<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä½¿ç”¨swagger-bootstrap-uiï¼Œé‚£ä¹ˆåªéœ€è¦å¼•å…¥ä¸‹é¢ä¸¤ä¸ªä¾èµ–å³å¯</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨configåŒ…ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®ç±»</p><p>ä¸æ™®é€šswaggerçš„é…ç½®ç±»ç›¸æ¯”ï¼Œswagger-bootstap-uiçš„é…ç½®ç±»å¤šäº†ä¸€ä¸ª@EnableSwaggerBootstrapUIæ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableSwaggerBootstrapUI</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">webApiConfig</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/admin/.*&quot;</span>)))</span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">webApiInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;æµ‹è¯•API&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;æœ¬æ–‡æ¡£æè¿°äº†è¯¾ç¨‹ä¸­å¿ƒå¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;è”¡å¤§å¤´&quot;</span>, <span class="string">&quot;http://wuhuqifei.com&quot;</span>, <span class="string">&quot;763882220@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2ã€ç¼–å†™Controllerå¹¶ä½¿ç”¨æ³¨è§£æ¥æ·»åŠ ä¿¡æ¯"><a href="#2-2ã€ç¼–å†™Controllerå¹¶ä½¿ç”¨æ³¨è§£æ¥æ·»åŠ ä¿¡æ¯" class="headerlink" title="2.2ã€ç¼–å†™Controllerå¹¶ä½¿ç”¨æ³¨è§£æ¥æ·»åŠ ä¿¡æ¯"></a>2.2ã€ç¼–å†™Controllerå¹¶ä½¿ç”¨æ³¨è§£æ¥æ·»åŠ ä¿¡æ¯</h2><h3 id="2-2-1ã€UserController"><a href="#2-2-1ã€UserController" class="headerlink" title="2.2.1ã€UserController"></a>2.2.1ã€UserController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;ç”¨æˆ·ç®¡ç†æ§åˆ¶å™¨&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®ç”¨æˆ·idè·å–ç”¨æˆ·ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addUser&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ·»åŠ ç”¨æˆ·å¯¹è±¡&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.saveOrUpdate(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;æ ¹æ®idåˆ é™¤ç”¨æˆ·&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;findAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.list();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-2ã€å¸¸ç”¨æ³¨è§£è¯´æ˜"><a href="#2-2-2ã€å¸¸ç”¨æ³¨è§£è¯´æ˜" class="headerlink" title="2.2.2ã€å¸¸ç”¨æ³¨è§£è¯´æ˜"></a>2.2.2ã€å¸¸ç”¨æ³¨è§£è¯´æ˜</h3><blockquote><p>swaggeråŠswagger-bootstrap-uiçš„å¸¸ç”¨æ³¨è§£æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«ä¸º@Apiä¸@ApiOperation</p></blockquote><ul><li>@Api</li></ul><blockquote><p>è¿™ä¸ªæ³¨è§£ç”¨äºControllerç±»ä¸Šï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ³¨è§£çš„tagså±æ€§æ¥ä¸ºæ§åˆ¶å™¨æ·»åŠ å¤‡æ³¨</p></blockquote><ul><li>@ApiOperation</li></ul><blockquote><p>è¿™ä¸ªæ³¨è§£ç”¨äºæ§åˆ¶å™¨çš„æ–¹æ³•ä¸Šï¼Œç”¨äºç»™æ§åˆ¶å™¨çš„å…·ä½“æ–¹æ³•æ·»åŠ æ³¨è§£</p></blockquote><h2 id="2-3ã€ä½¿ç”¨"><a href="#2-3ã€ä½¿ç”¨" class="headerlink" title="2.3ã€ä½¿ç”¨"></a>2.3ã€ä½¿ç”¨</h2><h3 id="2-3-1ã€åœ¨ä¸»å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£ï¼Œå°†swaggeré…ç½®ç±»çº³å…¥è¢«æ‰«æèŒƒå›´"><a href="#2-3-1ã€åœ¨ä¸»å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£ï¼Œå°†swaggeré…ç½®ç±»çº³å…¥è¢«æ‰«æèŒƒå›´" class="headerlink" title="2.3.1ã€åœ¨ä¸»å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£ï¼Œå°†swaggeré…ç½®ç±»çº³å…¥è¢«æ‰«æèŒƒå›´"></a>2.3.1ã€åœ¨ä¸»å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£ï¼Œå°†swaggeré…ç½®ç±»çº³å…¥è¢«æ‰«æèŒƒå›´</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.hzx.mpblog.mapper&quot;)</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.hzx.mpblog&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MpApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MpApplication.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost:8848/doc.html&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;http://localhost:8848/swagger-ui.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ä¸»å¯åŠ¨ç±»çš„ä¸¤ä¸ªè¾“å‡ºè¯­å¥ä¸­ï¼Œ<a href="http://localhost:8848/doc.html%E6%98%AFswagger-bootstrap-ui%E7%9A%84%E8%AE%BF%E9%97%AE%E5%9C%B0%E5%9D%80%E3%80%82">http://localhost:8848/doc.htmlæ˜¯swagger-bootstrap-uiçš„è®¿é—®åœ°å€ã€‚</a></p><p><a href="http://localhost:8848/swagger-ui.html%E6%98%AFswagger%E7%9A%84%E8%AE%BF%E9%97%AE%E5%9C%B0%E5%9D%80%E3%80%82">http://localhost:8848/swagger-ui.htmlæ˜¯swaggerçš„è®¿é—®åœ°å€ã€‚</a></p></blockquote><h3 id="2-3-2ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»"><a href="#2-3-2ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»" class="headerlink" title="2.3.2ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»"></a>2.3.2ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»</h3><blockquote><p>åˆ†åˆ«è¿›å…¥ä¸¤ä¸ªé“¾æ¥ä¸­æŸ¥çœ‹æ•ˆæœ</p></blockquote><ul><li>swagger</li></ul><blockquote><p>ä¸»é¡µé¢è¯´æ˜</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153717308.png" alt="image-20210129153717308"></p><blockquote><p>ç‚¹å‡»æ–¹æ³•è¿›å…¥æ–¹æ³•è¯´æ˜åŠæµ‹è¯•ç•Œé¢ï¼Œç‚¹å‡»try it out</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153734979.png" alt="image-20210129153734979"></p><blockquote><p>åœ¨å‚æ•°è¾“å…¥æ¡†ä¸­è¾“å…¥å‚æ•°ï¼Œç‚¹å‡»executeæ‰§è¡Œæ–¹æ³•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153751549.png" alt="image-20210129153751549"></p><blockquote><p>æµ‹è¯•ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153803544.png" alt="image-20210129153803544"></p><ul><li>swagger-bootstrap-ui</li></ul><blockquote><p>ä¸»é¡µé¢è¯´æ˜</p><p>swagger-bootstrap-uiå°†æµ‹è¯•é¡µé¢ä¸æ–¹æ³•è¯´æ˜é¡µé¢åˆ†å¼€ï¼Œåœ¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153813279.png" alt="image-20210129153813279"></p><blockquote><p>æ–¹æ³•è¯´æ˜</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153821304.png" alt="image-20210129153821304"></p><blockquote><p>æ–¹æ³•æµ‹è¯•</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153830894.png" alt="image-20210129153830894"></p><blockquote><p>æµ‹è¯•ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153838469.png" alt="image-20210129153838469"></p>]]></content>
      
      
      <categories>
          
          <category> æ¡†æ¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸€ï¼‰-Mybatis-plusæ¡†æ¶</title>
      <link href="posts/2091692756.html"/>
      <url>posts/2091692756.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="ä¸€ã€MPç®€ä»‹"><a href="#ä¸€ã€MPç®€ä»‹" class="headerlink" title="ä¸€ã€MPç®€ä»‹"></a>ä¸€ã€MPç®€ä»‹</h1><blockquote><p><a href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus</a>ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª <a href="http://www.mybatis.org/mybatis-3/">MyBatis</a> çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p></blockquote><h2 id="1-1ã€ç‰¹æ€§"><a href="#1-1ã€ç‰¹æ€§" class="headerlink" title="1.1ã€ç‰¹æ€§"></a>1.1ã€ç‰¹æ€§</h2><ul><li><strong>æ— ä¾µå…¥</strong>ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘</li><li><strong>æŸè€—å°</strong>ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ</li><li><strong>å¼ºå¤§çš„ CRUD æ“ä½œ</strong>ï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚</li><li><strong>æ”¯æŒ Lambda å½¢å¼è°ƒç”¨</strong>ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™</li><li><strong>æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆ</strong>ï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜</li><li><strong>æ”¯æŒ ActiveRecord æ¨¡å¼</strong>ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ</li><li><strong>æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œ</strong>ï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰</li><li><strong>å†…ç½®ä»£ç ç”Ÿæˆå™¨</strong>ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨</li><li><strong>å†…ç½®åˆ†é¡µæ’ä»¶</strong>ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢</li><li><strong>åˆ†é¡µæ’ä»¶æ”¯æŒå¤šç§æ•°æ®åº“</strong>ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer ç­‰å¤šç§æ•°æ®åº“</li><li><strong>å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶</strong>ï¼šå¯è¾“å‡º Sql è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢</li><li><strong>å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶</strong>ï¼šæä¾›å…¨è¡¨ delete ã€ update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ</li></ul><h2 id="1-2ã€æ”¯æŒçš„æ•°æ®åº“"><a href="#1-2ã€æ”¯æŒçš„æ•°æ®åº“" class="headerlink" title="1.2ã€æ”¯æŒçš„æ•°æ®åº“"></a>1.2ã€æ”¯æŒçš„æ•°æ®åº“</h2><blockquote><p>ä»»ä½•èƒ½ä½¿ç”¨ mybatis è¿›è¡Œ crud, å¹¶ä¸”æ”¯æŒæ ‡å‡† sql çš„æ•°æ®åº“</p></blockquote><h1 id="äºŒã€å¿«é€Ÿå…¥é—¨"><a href="#äºŒã€å¿«é€Ÿå…¥é—¨" class="headerlink" title="äºŒã€å¿«é€Ÿå…¥é—¨"></a>äºŒã€å¿«é€Ÿå…¥é—¨</h1><blockquote><p>ä½¿ç”¨ä¸€ä¸ªspringbooté¡¹ç›®æ¥ä½“éªŒMPçš„å¼ºå¤§ä¹‹å¤„ã€‚</p></blockquote><h2 id="2-1ã€å»ºç«‹å…¥é—¨é¡¹ç›®çš„æ•°æ®åº“ä¸é¡¹ç›®"><a href="#2-1ã€å»ºç«‹å…¥é—¨é¡¹ç›®çš„æ•°æ®åº“ä¸é¡¹ç›®" class="headerlink" title="2.1ã€å»ºç«‹å…¥é—¨é¡¹ç›®çš„æ•°æ®åº“ä¸é¡¹ç›®"></a>2.1ã€å»ºç«‹å…¥é—¨é¡¹ç›®çš„æ•°æ®åº“ä¸é¡¹ç›®</h2><blockquote><p>å»ºè¡¨</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">create database mp;</span><br><span class="line">use mp;</span><br><span class="line"></span><br><span class="line">create table user(</span><br><span class="line">    id bigint(20) primary key auto_increment,</span><br><span class="line">    name varchar(50),</span><br><span class="line">    email varchar(50),</span><br><span class="line">    age int</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into</span><br><span class="line">    user(name, email, age)</span><br><span class="line">VALUES</span><br><span class="line">       (&#39;A&#39;,&#39;a@qq.com&#39;,18),</span><br><span class="line">       (&#39;B&#39;,&#39;b@qq.com&#39;,19),</span><br><span class="line">       (&#39;C&#39;,&#39;c@qq.com&#39;,12),</span><br><span class="line">       (&#39;D&#39;,&#39;d@qq.com&#39;,11),</span><br><span class="line">       (&#39;E&#39;,&#39;e@qq.com&#39;,111);</span><br></pre></td></tr></table></figure><blockquote><p>å»ºç«‹spring-booté¡¹ç›®ï¼Œå¼•å…¥ä¾èµ–</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>é¡¹ç›®çš„application.ymlé…ç½®æ–‡ä»¶å¦‚ä¸‹</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mp?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;nullCatalogMeansCurrent=true&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">tianxin1230.</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™ä¸»å¯åŠ¨ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.hzx.mpblog.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MpApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(MpApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ ¹æ®æ•°æ®åº“è¡¨å»ºç«‹å¯¹åº”entityå®ä½“ç±»ï¼Œè¿™é‡Œä½¿ç”¨Lombokæ’ä»¶å¹¶å¼€å¯é“¾å¼ç¼–ç¨‹æ¥ç®€åŒ–å¼€å‘</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¼–å†™UserMapperæ¥å£ï¼Œè¯¥æ¥å£éœ€è¦ç»§æ‰¿BaseMapper&lt; T &gt;ï¼Œå…¶ä¸­Tä¸ºè¦æ“ä½œçš„æ•°æ®åº“è¡¨å¯¹åº”çš„å®ä½“ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-2ã€ç¼–å†™æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•"><a href="#2-2ã€ç¼–å†™æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•" class="headerlink" title="2.2ã€ç¼–å†™æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•"></a>2.2ã€ç¼–å†™æµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•</h2><blockquote><p>ç¼–å†™æµ‹è¯•ç±»ï¼Œæµ‹è¯•mybatis-plusä¸ºæˆ‘ä»¬æä¾›çš„æŸ¥è¯¢æ‰€æœ‰æ–¹æ³•</p></blockquote><ul><li>åœ¨selectListä¸­ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªQueryWrapperæŸ¥è¯¢æ¡ä»¶æ„é€ å™¨å¯¹è±¡ï¼Œä½†ç”±äºè¿™é‡Œéœ€è¦æŸ¥è¯¢æ‰€æœ‰å¯¹è±¡ï¼Œæ‰€ä»¥ä¸åŠ æ¡ä»¶ç­›é€‰ï¼Œä¼ å…¥null</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MpApplicationTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">        userList.forEach(user -&gt;</span><br><span class="line">            System.out.println(user)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153047772.png" alt="image-20210129153047772"></p><h2 id="2-3ã€æ·»åŠ é…ç½®è¾“å‡ºsqlè¯­å¥"><a href="#2-3ã€æ·»åŠ é…ç½®è¾“å‡ºsqlè¯­å¥" class="headerlink" title="2.3ã€æ·»åŠ é…ç½®è¾“å‡ºsqlè¯­å¥"></a>2.3ã€æ·»åŠ é…ç½®è¾“å‡ºsqlè¯­å¥</h2><blockquote><p>æˆ‘ä»¬å¯ä»¥åœ¨application.ymlä¸­æ·»åŠ é…ç½®ï¼Œè®©mybatis-plusåœ¨æ‰§è¡Œæ—¶è¾“å‡ºçš„sqlè¯­å¥</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‰“å°sqlè¯­å¥</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡æ–°å¯åŠ¨ï¼Œæµ‹è¯•ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153056405.png" alt="image-20210129153056405"></p><h1 id="ä¸‰ã€CRUDæ‰©å±•"><a href="#ä¸‰ã€CRUDæ‰©å±•" class="headerlink" title="ä¸‰ã€CRUDæ‰©å±•"></a>ä¸‰ã€CRUDæ‰©å±•</h1><h2 id="3-1ã€insertæµ‹è¯•æ’å…¥æ•°æ®"><a href="#3-1ã€insertæµ‹è¯•æ’å…¥æ•°æ®" class="headerlink" title="3.1ã€insertæµ‹è¯•æ’å…¥æ•°æ®"></a>3.1ã€insertæµ‹è¯•æ’å…¥æ•°æ®</h2><blockquote><p>ä½¿ç”¨Mybatis-plusè‡ªå¸¦çš„æ’å…¥æ–¹æ³•è¿›è¡Œæµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;å°æ˜&quot;</span>)</span><br><span class="line">            .setAge(<span class="number">18</span>)</span><br><span class="line">            .setEmail(<span class="string">&quot;xiaoming@qq.com&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.insert(user);</span><br><span class="line">    System.out.println(result == <span class="number">1</span> ? <span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span> : <span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹testInsert()çš„æ‰§è¡Œç»“æœå¹¶å†æ¬¡å¯åŠ¨testFindAll()æ–¹æ³•</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153116620.png" alt="image-20210129153116620"></p><blockquote><p>åœ¨è¿™æ¬¡æ’å…¥æ“ä½œä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šæ’å…¥æ•°æ®åº“å¯¹è±¡çš„idï¼Œè¿™ä¸ªå±æ€§æ˜¯Mybatis-plusä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ï¼ŒMybatis-plusæä¾›çš„ä¸»é”®ç”Ÿæˆç­–ç•¥åœ¨æšä¸¾ç±»IdTypeä¸­.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">IdType</span> </span>&#123;</span><br><span class="line">    AUTO(<span class="number">0</span>),</span><br><span class="line">    NONE(<span class="number">1</span>),</span><br><span class="line">    INPUT(<span class="number">2</span>),</span><br><span class="line">    ID_WORKER(<span class="number">3</span>),</span><br><span class="line">    UUID(<span class="number">4</span>),</span><br><span class="line">    ID_WORKER_STR(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-1-1ã€é›ªèŠ±ç®—æ³•"><a href="#3-1-1ã€é›ªèŠ±ç®—æ³•" class="headerlink" title="3.1.1ã€é›ªèŠ±ç®—æ³•"></a>3.1.1ã€é›ªèŠ±ç®—æ³•</h3><blockquote><ul><li>é›ªèŠ±ç®—æ³•æ˜¯æ¨ç‰¹å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongå‹çš„IDã€‚</li><li>æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šä½¿ç”¨41bitä½œä¸ºæ¯«ç§’æ•°ï¼Œ10bitä½œä¸ºåŠå…¶çš„IDï¼ˆ5ä¸ªbitæ˜¯æ•°æ®ä¸­å¿ƒï¼Œ5ä¸ªbitçš„åŠå…¶IDï¼‰ï¼Œ12bitä½œä¸ºæ¯«ç§’çš„æµæ°´å·ï¼ˆæ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯ç§’å¯ä»¥äº§ç”Ÿ4096ä¸ªIdï¼‰ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ªç¬¦å·ä½æ°¸è¿œæ˜¯0</li></ul></blockquote><h3 id="3-1-2ã€ä¸»é”®è‡ªå¢"><a href="#3-1-2ã€ä¸»é”®è‡ªå¢" class="headerlink" title="3.1.2ã€ä¸»é”®è‡ªå¢"></a>3.1.2ã€ä¸»é”®è‡ªå¢</h3><blockquote><p>é…ç½®ä¸»é”®è‡ªå¢</p><ul><li>åœ¨å®ä½“ç±»å­—æ®µä¸Šä½¿ç”¨@TableId(type = IdType.AUTO)</li><li>è¦æ±‚æ•°æ®åº“å­—æ®µä¸€å®šæ˜¯è‡ªå¢çš„ï¼Œå¦åˆ™ä¼šæŠ¥é”™</li></ul></blockquote><h3 id="3-1-3ã€å…¶ä½™ä¸»é”®ç±»å‹"><a href="#3-1-3ã€å…¶ä½™ä¸»é”®ç±»å‹" class="headerlink" title="3.1.3ã€å…¶ä½™ä¸»é”®ç±»å‹"></a>3.1.3ã€å…¶ä½™ä¸»é”®ç±»å‹</h3><blockquote><p>AUTO(0)ï¼šè‡ªå¢<br>NONE(1)ï¼šä¸ä½¿ç”¨<br>INPUT(2)ï¼šæ‰‹åŠ¨è¾“å…¥<br>ID_WORKER(3)ï¼šé»˜è®¤å”¯ä¸€å…¨å±€id<br>UUID(4)ï¼šuuid<br>ID_WORKER_STR(5)ï¼šé»˜è®¤å”¯ä¸€å…¨å±€idå­—ç¬¦ä¸²å½¢å¼</p></blockquote><h2 id="3-2ã€updateæ›´æ–°æ“ä½œ"><a href="#3-2ã€updateæ›´æ–°æ“ä½œ" class="headerlink" title="3.2ã€updateæ›´æ–°æ“ä½œ"></a>3.2ã€updateæ›´æ–°æ“ä½œ</h2><blockquote><p>ä½¿ç”¨mybatis-plusæä¾›çš„updateByIdæ–¹æ³•å¯ä»¥å¿«é€Ÿä¿®æ”¹è¡¨ä¸­æ•°æ®ï¼Œæ›´æ–°Idä¸º2Lçš„å¯¹è±¡ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(<span class="number">2L</span>)</span><br><span class="line">        .setName(<span class="string">&quot;èŠœæ¹–&quot;</span>)</span><br><span class="line">        .setEmail(<span class="string">&quot;wuhu@qq.com&quot;</span>)</span><br><span class="line">        .setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.updateById(user);</span><br><span class="line">    System.out.println(result == <span class="number">1</span> ? <span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span> : <span class="string">&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153136022.png" alt="image-20210129153136022"></p><h2 id="3-3ã€Mybatis-plusçš„è‡ªåŠ¨å¡«å……åŠŸèƒ½"><a href="#3-3ã€Mybatis-plusçš„è‡ªåŠ¨å¡«å……åŠŸèƒ½" class="headerlink" title="3.3ã€Mybatis-plusçš„è‡ªåŠ¨å¡«å……åŠŸèƒ½"></a>3.3ã€Mybatis-plusçš„è‡ªåŠ¨å¡«å……åŠŸèƒ½</h2><blockquote><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ•°æ®åº“å¾€å¾€æœ‰create_timeå’Œupdate_timeä¸¤ä¸ªå­—æ®µï¼Œå¯¹äºè¿™ä¸¤ä¸ªå­—æ®µï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ‰‹åŠ¨å¡«å……ï¼Œè€Œå¸Œæœ›ç¨‹åºæˆ–è€…æ•°æ®åº“è‡ªåŠ¨å¡«å……ï¼Œmpæä¾›äº†è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>åœ¨æ•°æ®åº“ä¸­æ·»åŠ create_timeå’Œupdate_timeä¸¤ä¸ªå±æ€§ï¼Œå¹¶åœ¨å®ä½“ç±»ä¸­æ·»åŠ å¯¹äºå­—æ®µã€‚</p></blockquote><h3 id="3-3-1ã€æ•°æ®åº“çº§åˆ«å¡«å……"><a href="#3-3-1ã€æ•°æ®åº“çº§åˆ«å¡«å……" class="headerlink" title="3.3.1ã€æ•°æ®åº“çº§åˆ«å¡«å……"></a>3.3.1ã€æ•°æ®åº“çº§åˆ«å¡«å……</h3><blockquote><p>åœ¨æ–°å»ºçš„ä¸¤ä¸ªå±æ€§ä¸‹é¢å‹¾é€‰æ ¹æ®æ—¶é—´æˆ³è‡ªåŠ¨æ›´æ–°å³å¯ï¼Œè¿™ç§æ–¹å¼ä¸æ¨èä½¿ç”¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153147791.png" alt="image-20210129153147791"></p><h3 id="3-3-2ã€ä»£ç çº§åˆ«è‡ªåŠ¨å¡«å……"><a href="#3-3-2ã€ä»£ç çº§åˆ«è‡ªåŠ¨å¡«å……" class="headerlink" title="3.3.2ã€ä»£ç çº§åˆ«è‡ªåŠ¨å¡«å……"></a>3.3.2ã€ä»£ç çº§åˆ«è‡ªåŠ¨å¡«å……</h3><ul><li>åœ¨å®ä½“ç±»çš„createTimeå’ŒupdateTimeå­—æ®µä¸Šæ·»åŠ æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * å­—æ®µæ·»åŠ æ—¶å¡«å……å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * å­—æ®µæ·»åŠ /æ›´æ–°æ—¶å¡«å……å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™ä¸€ä¸ªå¤„ç†å™¨ç”¨äºå¤„ç†è¿™ä¸¤ä¸ªæ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æ’å…¥æ—¶çš„å¡«å……ç­–ç•¥</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ›´æ–°æ—¶çš„å¡«å……ç­–ç•¥</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>,<span class="keyword">new</span> Date(),metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸»å¯åŠ¨ç±»ä¸­æ·»åŠ ç»„ä»¶æ‰«ææ³¨è§£</li><li>æµ‹è¯•æ’å…¥ï¼ŒæŸ¥çœ‹æ˜¯å¦è‡ªåŠ¨å¡«å……</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;å°æ˜111&quot;</span>)</span><br><span class="line">            .setAge(<span class="number">18</span>)</span><br><span class="line">            .setEmail(<span class="string">&quot;xiaoming@qq.com&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.insert(user);</span><br><span class="line">    System.out.println(result == <span class="number">1</span> ? <span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span> : <span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(<span class="number">2L</span>)</span><br><span class="line">        .setName(<span class="string">&quot;èŠœæ¹–222&quot;</span>)</span><br><span class="line">        .setEmail(<span class="string">&quot;wuhu@qq.com&quot;</span>)</span><br><span class="line">        .setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.updateById(user);</span><br><span class="line">    System.out.println(result == <span class="number">1</span> ? <span class="string">&quot;ä¿®æ”¹æˆåŠŸï¼&quot;</span> : <span class="string">&quot;ä¿®æ”¹å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨testFindAllæ–¹æ³•æŸ¥çœ‹ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153158628.png" alt="image-20210129153158628"></p><ul><li>è‡ªåŠ¨å¡«å……ä½¿ç”¨æˆåŠŸã€‚</li></ul><h2 id="3-4ã€ä¹è§‚é”å’Œæ‚²è§‚é”"><a href="#3-4ã€ä¹è§‚é”å’Œæ‚²è§‚é”" class="headerlink" title="3.4ã€ä¹è§‚é”å’Œæ‚²è§‚é”"></a>3.4ã€ä¹è§‚é”å’Œæ‚²è§‚é”</h2><blockquote><p>æ‚²è§‚é”ååˆ†æ‚²è§‚ï¼Œä»–æ€»æ˜¯è®¤ä¸ºä¼šå‡ºç°é—®é¢˜ï¼Œæ— è®ºå¹²ä»€ä¹ˆéƒ½ä¼šä¸Šé”ï¼</p><p>è€Œä¹è§‚é”ååˆ†ä¹è§‚ï¼Œä»–æ€»æ˜¯è®¤ä¸ºä¸ä¼šå‡ºç°é—®é¢˜ï¼Œæ— è®ºå¹²ä»€ä¹ˆéƒ½ä¸å»ä¸Šé”ï¼å¦‚æœå‡ºç°äº†é—®é¢˜ï¼Œå†æ¬¡æ›´æ–°å€¼æµ‹è¯•ã€‚</p><p>ä¸‹é¢ä»‹ç»Mybatis-plusä¸­ä¹è§‚é”çš„å®ç°æ–¹æ³•</p></blockquote><h3 id="3-4-1ã€ä¹è§‚é”çš„å®ç°æ–¹å¼"><a href="#3-4-1ã€ä¹è§‚é”çš„å®ç°æ–¹å¼" class="headerlink" title="3.4.1ã€ä¹è§‚é”çš„å®ç°æ–¹å¼"></a>3.4.1ã€ä¹è§‚é”çš„å®ç°æ–¹å¼</h3><blockquote><p>å–å‡ºè®°å½•æ—¶ï¼Œè·å–å½“å‰version</p><p>æ›´æ–°æ—¶å¸¦ä¸Šè¿™ä¸ªversion</p><p>æ‰§è¡Œæ›´æ–°æ—¶ï¼Œset version = newVersion where version = oldVersion</p><p>å¦‚æœversionä¸å¯¹ï¼Œå°±æ›´æ–°å¤±è´¥</p></blockquote><ul><li>ä¾‹å­</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ä¹è§‚é”ï¼š</span><br><span class="line"># 1 å…ˆæŸ¥è¯¢ï¼Œè·å¾—ç‰ˆæœ¬å·version &#x3D; 1</span><br><span class="line"># å‡è®¾ç°æœ‰ABä¸¤ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œè¿™æ¡updateè¯­å¥ï¼Œå½“Aæœªæ‰§è¡Œå®Œæˆæ—¶ï¼ŒBæŠ¢å…ˆå®Œæˆè¿™æ¬¡æ›´æ–°ï¼Œé‚£ä¹ˆæ­¤æ—¶ç”±äºç‰ˆæœ¬å·versionå·²ç»ä¸º2ï¼Œæ‰€ä»¥Açº¿ç¨‹çš„æ›´æ–°å·¥ä½œä¸ä¼šæˆåŠŸï¼Œæ­¤æ—¶å°±ä¿è¯äº†çº¿ç¨‹é—´çš„é€šè®¯å®‰å…¨</span><br><span class="line"></span><br><span class="line">update user set name &#x3D; &quot;èŠœæ¹–&quot;,version &#x3D; version + 1 where id &#x3D; 2 and version &#x3D; 1;</span><br></pre></td></tr></table></figure><blockquote><p>ç»™æ•°æ®åº“è¡¨ä¸­æ·»åŠ ä¸€ä¸ªversionå±æ€§</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153213565.png" alt="image-20210129153213565"></p><blockquote><p>ç»™å®ä½“ç±»ä¸­æ·»åŠ ä¸€ä¸ªversionå­—æ®µï¼ŒåŒæ—¶åœ¨ä¸Šé¢æ·»åŠ ä¸€ä¸ª@Versionæ³¨è§£ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªä¹è§‚é”</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨é…ç½®ç±»ä¸­æ³¨å†Œä¹è§‚é”ç»„ä»¶</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusConfig</span>  </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œä¹è§‚é”æ’ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OptimisticLockerInterceptor <span class="title">optimisticLockerInterceptor</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OptimisticLockerInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-5ã€selectæŸ¥è¯¢æ“ä½œ"><a href="#3-5ã€selectæŸ¥è¯¢æ“ä½œ" class="headerlink" title="3.5ã€selectæŸ¥è¯¢æ“ä½œ"></a>3.5ã€selectæŸ¥è¯¢æ“ä½œ</h2><h3 id="3-5-1ã€æ ¹æ®idæŸ¥è¯¢æ•°æ®"><a href="#3-5-1ã€æ ¹æ®idæŸ¥è¯¢æ•°æ®" class="headerlink" title="3.5.1ã€æ ¹æ®idæŸ¥è¯¢æ•°æ®"></a>3.5.1ã€æ ¹æ®idæŸ¥è¯¢æ•°æ®</h3><blockquote><p>æ ¹æ®ä¼ å…¥çš„ä¸»é”®å€¼æŸ¥è¯¢æ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = userMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153228587.png" alt="image-20210129153228587"></p><h3 id="3-5-2ã€æ ¹æ®é›†åˆå¯¹è±¡æŸ¥è¯¢æ•°æ®"><a href="#3-5-2ã€æ ¹æ®é›†åˆå¯¹è±¡æŸ¥è¯¢æ•°æ®" class="headerlink" title="3.5.2ã€æ ¹æ®é›†åˆå¯¹è±¡æŸ¥è¯¢æ•°æ®"></a>3.5.2ã€æ ¹æ®é›†åˆå¯¹è±¡æŸ¥è¯¢æ•°æ®</h3><blockquote><p>ä¼ å…¥ä¸€ä¸ªä¸»é”®é›†åˆï¼Œæ ¹æ®ä¼ å…¥çš„å¤šä¸ªä¸»é”®å€¼æŸ¥è¯¢å¤šæ¡æ•°æ®ï¼Œä½¿ç”¨selectBatchIdsæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®é™…ä¸Šä½¿ç”¨mysqlä¸­çš„inå…³é”®å­—</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectByIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectBatchIds(Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">5L</span>));</span><br><span class="line">    users.forEach(user -&gt;</span><br><span class="line">        System.out.println(user)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153239557.png" alt="image-20210129153239557"></p><h3 id="3-5-3ã€æ ¹æ®Mapå¯¹è±¡æŸ¥è¯¢æ•°æ®"><a href="#3-5-3ã€æ ¹æ®Mapå¯¹è±¡æŸ¥è¯¢æ•°æ®" class="headerlink" title="3.5.3ã€æ ¹æ®Mapå¯¹è±¡æŸ¥è¯¢æ•°æ®"></a>3.5.3ã€æ ¹æ®Mapå¯¹è±¡æŸ¥è¯¢æ•°æ®</h3><blockquote><p>ä¼ å…¥ä¸€ä¸ªmapï¼Œmpå°†ä¼šä»¥é”®ä¸ºå­—æ®µï¼Œå€¼ä¸ºå­—æ®µå€¼è¿›è¡Œæ‹¼æ¥å¹¶æŸ¥è¯¢ï¼Œå¦‚æœmapä¸­æœ‰å¤šä¸ªé”®å€¼å¯¹ï¼Œé‚£ä¹ˆä¼šä»¥andå…³é”®è¯æ‹¼æ¥</p></blockquote><ul><li>å½“mapä¸­åªæœ‰ä¸€ä¸ªé”®å€¼å¯¹æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectByMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;id&quot;</span>,<span class="number">1L</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectByMap(map);</span><br><span class="line">    users.forEach(user -&gt; System.out.println(user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153248616.png" alt="image-20210129153248616"></p><ul><li>å½“mapä¸­åŒ…å«å¤šä¸ªé”®å€¼å¯¹æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectByMaps</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;id&quot;</span>,<span class="number">2L</span>);</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;èŠœæ¹–222&quot;</span>);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectByMap(map);</span><br><span class="line">    users.forEach(user -&gt; System.out.println(user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153259081.png" alt="image-20210129153259081"></p><h3 id="3-5-4ã€åˆ†é¡µæŸ¥è¯¢"><a href="#3-5-4ã€åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="3.5.4ã€åˆ†é¡µæŸ¥è¯¢"></a>3.5.4ã€åˆ†é¡µæŸ¥è¯¢</h3><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†é¡µæŸ¥è¯¢çš„å®ç°æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼</p><ul><li>ä½¿ç”¨limitå…³é”®å­—è¿›è¡Œåˆ†é¡µ</li><li>ä½¿ç”¨PageHelperå’ŒPageInfoç­‰ç¬¬ä¸‰æ–¹æ’ä»¶è¿›è¡Œåˆ†é¡µ</li><li>ä½¿ç”¨Mybatis-plusè‡ªå¸¦çš„åˆ†é¡µæ’ä»¶è¿›è¡Œåˆ†é¡µ</li></ul><p>ä¸‹é¢ä»‹ç»mpçš„åˆ†é¡µæ’ä»¶</p></blockquote><ul><li>åœ¨mybatis-plusé…ç½®ç±»ä¸­é…ç½®æ‹¦æˆªå™¨ç»„ä»¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå½“å‰é¡µ</span></span><br><span class="line"><span class="comment">     * ç¬¬äºŒä¸ªå‚æ•°ï¼šæ¯é¡µæ•°æ®æ¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;User&gt; page = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//ä½¿ç”¨Mybatis-plusæä¾›çš„selectPageæ–¹æ³•ï¼Œä¼ å…¥åˆ†é¡µå¯¹è±¡page</span></span><br><span class="line">    IPage&lt;User&gt; userIPage = userMapper.selectPage(page, <span class="keyword">null</span>);</span><br><span class="line">    <span class="comment">//å¾—åˆ°çš„Pageå¯¹è±¡ä¸­ï¼Œrecordså±æ€§å°±æ˜¯éœ€è¦çš„é›†åˆï¼Œè¯¥é›†åˆä¸­åŒ…å«äº†æŸ¥è¯¢çš„ç»“æœ</span></span><br><span class="line">    List&lt;User&gt; records = userIPage.getRecords();</span><br><span class="line">    records.forEach(user -&gt; System.out.println(user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153308347.png" alt="image-20210129153308347"></p><h3 id="3-5-5ã€åˆ†é¡µæ’ä»¶Pageå±æ€§ç®€ä»‹"><a href="#3-5-5ã€åˆ†é¡µæ’ä»¶Pageå±æ€§ç®€ä»‹" class="headerlink" title="3.5.5ã€åˆ†é¡µæ’ä»¶Pageå±æ€§ç®€ä»‹"></a>3.5.5ã€åˆ†é¡µæ’ä»¶Pageå±æ€§ç®€ä»‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Page</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IPage</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; records;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> total;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> current;</span><br><span class="line">    <span class="keyword">private</span> String[] ascs;</span><br><span class="line">    <span class="keyword">private</span> String[] descs;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> optimizeCountSql;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isSearchCount;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><blockquote><ul><li>List<T> recordsâ€“ç”¨æ¥å­˜æ”¾æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®</li><li>long totalâ€“è¿”å›è®°å½•çš„æ€»æ•°</li><li>long sizeâ€“æ¯é¡µæ˜¾ç¤ºæ¡æ•°ï¼Œé»˜è®¤ 10</li><li>long currentâ€“å½“å‰é¡µ,é»˜è®¤1</li><li>String[] ascsâ€“å‡åºå­—æ®µé›†åˆ</li><li>String[] descsâ€“é™åºå­—æ®µé›†åˆ</li><li>boolean optimizeCountSqlâ€“è‡ªåŠ¨ä¼˜åŒ–count  sqlï¼Œé»˜è®¤ä¸ºtrue</li><li>boolean isSearchCountâ€“æ˜¯å¦è¿›è¡ŒcountæŸ¥è¯¢ï¼Œé»˜è®¤ä¸ºtrue</li></ul></blockquote><h2 id="3-6ã€deleteåˆ é™¤æ“ä½œ"><a href="#3-6ã€deleteåˆ é™¤æ“ä½œ" class="headerlink" title="3.6ã€deleteåˆ é™¤æ“ä½œ"></a>3.6ã€deleteåˆ é™¤æ“ä½œ</h2><h3 id="3-6-1ã€æ ¹æ®idåˆ é™¤è®°å½•"><a href="#3-6-1ã€æ ¹æ®idåˆ é™¤è®°å½•" class="headerlink" title="3.6.1ã€æ ¹æ®idåˆ é™¤è®°å½•"></a>3.6.1ã€æ ¹æ®idåˆ é™¤è®°å½•</h3><blockquote><p>ä½¿ç”¨mpæä¾›çš„deleteByIdæ–¹æ³•ï¼Œè¿”å›å€¼ä¸ºæ•°æ®åº“è¡¨ä¸­å—å½±å“æ•°æ®æ¡æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.deleteById(<span class="number">1L</span>);</span><br><span class="line">    System.out.println(result == <span class="number">1</span> ? <span class="string">&quot;åˆ é™¤æˆåŠŸï¼&quot;</span> : <span class="string">&quot;åˆ é™¤å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153320211.png" alt="image-20210129153320211"></p><h3 id="3-6-2ã€é€šè¿‡ä¼ å…¥çš„é›†åˆå¯¹è±¡è¿›è¡Œæ‰¹é‡åˆ é™¤"><a href="#3-6-2ã€é€šè¿‡ä¼ å…¥çš„é›†åˆå¯¹è±¡è¿›è¡Œæ‰¹é‡åˆ é™¤" class="headerlink" title="3.6.2ã€é€šè¿‡ä¼ å…¥çš„é›†åˆå¯¹è±¡è¿›è¡Œæ‰¹é‡åˆ é™¤"></a>3.6.2ã€é€šè¿‡ä¼ å…¥çš„é›†åˆå¯¹è±¡è¿›è¡Œæ‰¹é‡åˆ é™¤</h3><blockquote><p>ä½¿ç”¨mpæä¾›çš„deleteBatchIdsæ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteByIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.deleteBatchIds(Arrays.asList(<span class="number">2L</span>,<span class="number">3L</span>,<span class="number">1L</span>));</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœï¼šç”±äºæ•°æ®åº“ä¸­idä¸º1Lçš„æ•°æ®ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å½±å“çš„æ•°æ®æ¡æ•°åªæœ‰ä¸¤æ¡ï¼Œä¸æ‰¹é‡æ’å…¥ä¸€æ ·ï¼Œä½¿ç”¨äº†mysqlä¸­çš„Inå…³é”®å­—</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153331310.png" alt="image-20210129153331310"></p><h3 id="3-6-3ã€é€šè¿‡ä¼ å…¥çš„mapè¿›è¡Œåˆ é™¤"><a href="#3-6-3ã€é€šè¿‡ä¼ å…¥çš„mapè¿›è¡Œåˆ é™¤" class="headerlink" title="3.6.3ã€é€šè¿‡ä¼ å…¥çš„mapè¿›è¡Œåˆ é™¤"></a>3.6.3ã€é€šè¿‡ä¼ å…¥çš„mapè¿›è¡Œåˆ é™¤</h3><blockquote><p>ä¸é€šè¿‡mapè¿›è¡ŒæŸ¥è¯¢ç±»ä¼¼ï¼Œå½“æœ‰å¤šä¸ªé”®å€¼å¯¹æ—¶ï¼Œä½¿ç”¨andæ‹¼æ¥</p></blockquote><ul><li>åªæœ‰ä¸€ä¸ªé”®å€¼å¯¹æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteByMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;E&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.deleteByMap(map);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153341026.png" alt="image-20210129153341026"></p><ul><li>ä¼ å…¥å¤šä¸ªé”®å€¼å¯¹æ—¶</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteByMaps</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap();</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>,<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.deleteByMap(map);</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153354773.png" alt="image-20210129153354773"></p><h2 id="3-7ã€é…ç½®é€»è¾‘åˆ é™¤"><a href="#3-7ã€é…ç½®é€»è¾‘åˆ é™¤" class="headerlink" title="3.7ã€é…ç½®é€»è¾‘åˆ é™¤"></a>3.7ã€é…ç½®é€»è¾‘åˆ é™¤</h2><blockquote><p>é€»è¾‘åˆ é™¤ï¼šåœ¨æ•°æ®åº“ä¸­æ²¡æœ‰è¢«ç§»é™¤ï¼Œåªæ˜¯ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥ä½¿è¿™ä¸€æ¡è®°å½•å¤±æ•ˆ</p><p>ç‰©ç†åˆ é™¤ï¼šä»æ•°æ®åº“ä¸­ç›´æ¥ç§»é™¤</p><p>ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹è¢«åˆ é™¤çš„è®°å½•ï¼Œç±»ä¼¼äºå›æ”¶ç«™</p></blockquote><h3 id="3-7-1ã€é…ç½®æ­¥éª¤"><a href="#3-7-1ã€é…ç½®æ­¥éª¤" class="headerlink" title="3.7.1ã€é…ç½®æ­¥éª¤"></a>3.7.1ã€é…ç½®æ­¥éª¤</h3><blockquote><p>åœ¨è¡¨ä¸­æ·»åŠ ä¸€ä¸ªdeletedå­—æ®µï¼Œ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153422780.png" alt="image-20210129153422780"></p><blockquote><p>åœ¨å®ä½“ç±»ä¸­æ·»åŠ ä¸€ä¸ªdeletedå­—æ®µï¼Œå¹¶æ·»åŠ æ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * é€»è¾‘åˆ é™¤å­—æ®µ</span></span><br><span class="line"><span class="comment"> * æ·»åŠ ä¸€ä¸ªé€»è¾‘åˆ é™¤æ³¨è§£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®é€»è¾‘åˆ é™¤ç»„ä»¶</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é…ç½®é€»è¾‘åˆ é™¤ç»„ä»¶</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ISqlInjector <span class="title">sqlInjector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LogicSqlInjector();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨application.ymlæ–‡ä»¶ä¸­é…ç½®</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><ul><li>å½“deletedå€¼ä¸º1æ—¶ï¼Œè¯æ˜è¯¥æ•°æ®è¢«é€»è¾‘åˆ é™¤</li><li>å½“deletedå€¼ä¸º0æ—¶ï¼Œè¯æ˜è¯¥æ•°æ®æ²¡æœ‰è¢«é€»è¾‘åˆ é™¤</li></ul><h3 id="3-7-2ã€æµ‹è¯•é€»è¾‘åˆ é™¤"><a href="#3-7-2ã€æµ‹è¯•é€»è¾‘åˆ é™¤" class="headerlink" title="3.7.2ã€æµ‹è¯•é€»è¾‘åˆ é™¤"></a>3.7.2ã€æµ‹è¯•é€»è¾‘åˆ é™¤</h3><blockquote><p>å…ˆåœ¨æ•°æ®åº“ä¸­æ–°æ’å…¥å‡ æ¡æ•°æ®ï¼Œä»¥ä¾¿åé¢çš„æµ‹è¯•</p></blockquote><ul><li>é€»è¾‘åˆ é™¤idä¸º3Lçš„æ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoginDeleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.deleteById(<span class="number">3L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœï¼šä½¿ç”¨äº†updateè¯­å¥</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153433435.png" alt="image-20210129153433435"></p><h1 id="å››ã€æ€§èƒ½åˆ†ææ’ä»¶"><a href="#å››ã€æ€§èƒ½åˆ†ææ’ä»¶" class="headerlink" title="å››ã€æ€§èƒ½åˆ†ææ’ä»¶"></a>å››ã€æ€§èƒ½åˆ†ææ’ä»¶</h1><blockquote><p>æˆ‘ä»¬åœ¨å¹³æ—¶å¼€å‘ä¸­ï¼Œä¼šé‡åˆ°ä¸€äº›æ…¢sqlï¼Œmpæä¾›äº†ä¸€ä¸ªæ€§èƒ½åˆ†ææ’ä»¶ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šæ—¶é—´ï¼Œå°±åœæ­¢è¿è¡Œ</p></blockquote><h2 id="4-1ã€ä½œç”¨"><a href="#4-1ã€ä½œç”¨" class="headerlink" title="4.1ã€ä½œç”¨"></a>4.1ã€ä½œç”¨</h2><blockquote><p>æ€§èƒ½åˆ†ææ‹¦æˆªå™¨ï¼Œç”¨äºè¾“å‡ºæ¯æ¡sqlè¯­å¥åŠå…¶æ‰§è¡Œæ—¶é—´</p></blockquote><h2 id="4-2ã€ä½¿ç”¨"><a href="#4-2ã€ä½¿ç”¨" class="headerlink" title="4.2ã€ä½¿ç”¨"></a>4.2ã€ä½¿ç”¨</h2><blockquote><p>åœ¨application.ymlä¸­é…ç½®å¼€å‘ç¯å¢ƒï¼Œå°†å½“å‰ç¯å¢ƒè®¾ç½®ä¸ºdev</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨é…ç½®ç±»ä¸­é…ç½®sqlæ‰§è¡Œæ•ˆç‡åˆ†ææ’ä»¶</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * sqlæ‰§è¡Œæ•ˆç‡åˆ†ææ’ä»¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Profile</span>(&#123;&quot;dev&quot;,&quot;test&quot;&#125;)è¡¨ç¤ºæ­¤æ’ä»¶åªåœ¨ç”Ÿäº§å’Œæµ‹è¯•ç¯å¢ƒä¸‹ä½¿ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&#123;&quot;dev&quot;,&quot;test&quot;&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PerformanceInterceptor <span class="title">performanceInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PerformanceInterceptor performanceInterceptor = <span class="keyword">new</span> PerformanceInterceptor();</span><br><span class="line">    <span class="comment">//è®¾ç½®sqlæ‰§è¡Œçš„æœ€å¤§æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´å°±ä¸æ‰§è¡Œ</span></span><br><span class="line">    performanceInterceptor.setMaxTime(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®æ ¼å¼åŒ–SQLè¯­å¥ï¼ˆç¾åŒ–ï¼‰</span></span><br><span class="line">    performanceInterceptor.setFormat(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> performanceInterceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3ã€æµ‹è¯•"><a href="#4-3ã€æµ‹è¯•" class="headerlink" title="4.3ã€æµ‹è¯•"></a>4.3ã€æµ‹è¯•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateAndSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(<span class="number">1L</span>);</span><br><span class="line">    user.setName(<span class="string">&quot;èŠœæ¹–&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;wuhu@qq.com&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">1222</span>);</span><br><span class="line">    <span class="keyword">int</span> result = userMapper.updateById(user);</span><br><span class="line"></span><br><span class="line">    System.out.println(result);</span><br><span class="line">    List&lt;User&gt; userList = userMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">    userList.forEach(System.out :: println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœâ€“æŠ¥å‘Šè¯¥sqlè¶…æ—¶</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153444986.png" alt="image-20210129153444986"></p><blockquote><p>å°†æœ€å¤§æ—¶é—´è®¾ç½®ä¸º100msï¼Œå†æ¬¡æµ‹è¯•ï¼Œä¿®æ”¹       performanceInterceptor.setMaxTime(100);</p></blockquote><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153458241.png" alt="image-20210129153458241"></p><h1 id="äº”ã€æ¡ä»¶æ„é€ å™¨Wrapper"><a href="#äº”ã€æ¡ä»¶æ„é€ å™¨Wrapper" class="headerlink" title="äº”ã€æ¡ä»¶æ„é€ å™¨Wrapper"></a>äº”ã€æ¡ä»¶æ„é€ å™¨Wrapper</h1><blockquote><p>Wrapperæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬ä½¿ç”¨Wrapperçš„å®ç°ç±»ï¼šQueryWrapperæ¥å®ç°æ¡ä»¶æ„é€ </p></blockquote><h2 id="5-1ã€QueryWrapperçš„ä¸€äº›æ–¹æ³•"><a href="#5-1ã€QueryWrapperçš„ä¸€äº›æ–¹æ³•" class="headerlink" title="5.1ã€QueryWrapperçš„ä¸€äº›æ–¹æ³•"></a>5.1ã€QueryWrapperçš„ä¸€äº›æ–¹æ³•</h2><h3 id="5-1-1ã€isNotNull-â€œåˆ—åâ€"><a href="#5-1-1ã€isNotNull-â€œåˆ—åâ€" class="headerlink" title="5.1.1ã€isNotNull(â€œåˆ—åâ€)"></a>5.1.1ã€isNotNull(â€œåˆ—åâ€)</h3><blockquote><p>è¿™ä¸ªå­—æ®µçš„å€¼ä¸ä¸ºç©º</p></blockquote><h3 id="5-1-2ã€ge-eq-ne-le-gt-lt-â€œåˆ—åâ€-å€¼"><a href="#5-1-2ã€ge-eq-ne-le-gt-lt-â€œåˆ—åâ€-å€¼" class="headerlink" title="5.1.2ã€ge/eq/ne/le/gt/lt(â€œåˆ—åâ€,å€¼)"></a>5.1.2ã€ge/eq/ne/le/gt/lt(â€œåˆ—åâ€,å€¼)</h3><blockquote><p>è¿™ä¸ªå­—æ®µçš„å€¼å¿…é¡»å¤§äºç­‰äº/ç­‰äº/ä¸ç­‰äº/å°äºç­‰äº/ä¸¥æ ¼å¤§äº/ä¸¥æ ¼å°äºä¼ å…¥çš„å€¼</p></blockquote><h3 id="5-1-3ã€between-â€œåˆ—åâ€-å·¦è¾¹å€¼-å³è¾¹å€¼"><a href="#5-1-3ã€between-â€œåˆ—åâ€-å·¦è¾¹å€¼-å³è¾¹å€¼" class="headerlink" title="5.1.3ã€between(â€œåˆ—åâ€,å·¦è¾¹å€¼,å³è¾¹å€¼)"></a>5.1.3ã€between(â€œåˆ—åâ€,å·¦è¾¹å€¼,å³è¾¹å€¼)</h3><blockquote><p>è¿™ä¸ªå±æ€§çš„å€¼å¿…é¡»åœ¨å·¦è¾¹å€¼å’Œå³è¾¹å€¼ä¹‹é—´</p></blockquote><h3 id="5-1-4ã€notLike-â€œåˆ—åâ€-å€¼"><a href="#5-1-4ã€notLike-â€œåˆ—åâ€-å€¼" class="headerlink" title="5.1.4ã€notLike(â€œåˆ—åâ€,å€¼)"></a>5.1.4ã€notLike(â€œåˆ—åâ€,å€¼)</h3><blockquote><p>å­—æ®µå€¼ not like â€œ%å€¼%â€</p></blockquote><h3 id="5-1-5ã€likeLeft-likeRight-â€œåˆ—åâ€-å€¼"><a href="#5-1-5ã€likeLeft-likeRight-â€œåˆ—åâ€-å€¼" class="headerlink" title="5.1.5ã€likeLeft/likeRight(â€œåˆ—åâ€,å€¼)"></a>5.1.5ã€likeLeft/likeRight(â€œåˆ—åâ€,å€¼)</h3><blockquote><p>å­—æ®µ like â€œ%å€¼â€/â€œå€¼%â€</p></blockquote><h3 id="5-1-6ã€in-notIn-â€œåˆ—åâ€-Object-â€¦values"><a href="#5-1-6ã€in-notIn-â€œåˆ—åâ€-Object-â€¦values" class="headerlink" title="5.1.6ã€in/notIn(â€œåˆ—åâ€,Object â€¦values)"></a>5.1.6ã€in/notIn(â€œåˆ—åâ€,Object â€¦values)</h3><blockquote><p>å­—æ®µ  in/notIn(v0,v1â€¦vn)</p></blockquote><h3 id="5-1-7ã€inSql-noInSql-â€œåˆ—åâ€-sqlè¯­å¥"><a href="#5-1-7ã€inSql-noInSql-â€œåˆ—åâ€-sqlè¯­å¥" class="headerlink" title="5.1.7ã€inSql/noInSql(â€œåˆ—åâ€,sqlè¯­å¥)"></a>5.1.7ã€inSql/noInSql(â€œåˆ—åâ€,sqlè¯­å¥)</h3><blockquote><p>å­—æ®µ in/notIn (sqlè¯­å¥)ï¼Œä¾‹å¦‚ inSql/notInSql(â€œidâ€,select * from user where id &lt; 3)</p><p>ç­‰ä»·äºid in/notIn (select * from user where id &lt; 3)</p></blockquote><h3 id="5-1-8ã€åˆ†ç»„æ’åº"><a href="#5-1-8ã€åˆ†ç»„æ’åº" class="headerlink" title="5.1.8ã€åˆ†ç»„æ’åº"></a>5.1.8ã€åˆ†ç»„æ’åº</h3><blockquote><ul><li>groupBy(Râ€¦ columns); // ç­‰ä»·äº GROUP BY å­—æ®µ, â€¦ï¼Œ ä¾‹: groupBy(â€œidâ€, â€œnameâ€) â€”&gt; group by id,name</li><li>orderByAsc(Râ€¦ columns); // ç­‰ä»·äº ORDER BY å­—æ®µ, â€¦ ASCï¼Œ ä¾‹: orderByAsc(â€œidâ€, â€œnameâ€) â€”&gt; order by id ASC,name ASC</li><li>orderByDesc(Râ€¦ columns); // ç­‰ä»·äº ORDER BY å­—æ®µ, â€¦ DESCï¼Œ ä¾‹: orderByDesc(â€œidâ€, â€œnameâ€) â€”&gt; order by id DESC,name DESC</li><li>having(String sqlHaving, Objectâ€¦ params); // ç­‰ä»·äº HAVING ( sqlè¯­å¥ )ï¼Œ ä¾‹: having(â€œsum(age) &gt; {0}â€, 11) â€”&gt; having sum(age) &gt; 11</li></ul></blockquote><h2 id="5-2ã€æŸ¥è¯¢ç¤ºä¾‹"><a href="#5-2ã€æŸ¥è¯¢ç¤ºä¾‹" class="headerlink" title="5.2ã€æŸ¥è¯¢ç¤ºä¾‹"></a>5.2ã€æŸ¥è¯¢ç¤ºä¾‹</h2><blockquote><p>æŸ¥è¯¢nameã€emailä¸ä¸ºç©ºï¼Œä¸”å¹´é¾„å¤§äºç­‰äº12å²çš„ç”¨æˆ·(.isNotNull()ã€.ge())</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢nameã€emailä¸ä¸ºç©ºï¼Œä¸”å¹´é¾„å¤§äºç­‰äº12å²çš„ç”¨æˆ·(.isNotNull()ã€.ge())</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuestion01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper();</span><br><span class="line">    wrapper.isNotNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">    wrapper.isNotNull(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    wrapper.ge(<span class="string">&quot;age&quot;</span>,<span class="number">12</span>);</span><br><span class="line">    List users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(user -&gt; System.out.println(user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>ç»“æœ</p></li><li><p>sqlè¯­å¥ä¸ºï¼š</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt;  Preparing: SELECT id,name,age,email,create_time,update_time,version,deleted FROM user WHERE deleted&#x3D;0 AND email IS NOT NULL AND name IS NOT NULL AND age &gt;&#x3D; ? </span><br><span class="line">&#x3D;&#x3D;&gt; Parameters: 12(Integer)</span><br></pre></td></tr></table></figure><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153512076.png" alt="image-20210129153512076"></p><blockquote><p>æŸ¥è¯¢nameå±æ€§ç­‰äºâ€å°æ˜â€çš„ç”¨æˆ·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢nameå±æ€§ç­‰äº&quot;å°æ˜&quot;çš„ç”¨æˆ·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuestion02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">    List users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(user -&gt; System.out.println(user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153519861.png" alt="image-20210129153519861"></p><blockquote><p>æŸ¥è¯¢å¹´é¾„åœ¨10-30ä¹‹é—´çš„<strong>ç”¨æˆ·ä¸ªæ•°</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢å¹´é¾„åœ¨10-30ä¹‹é—´çš„ç”¨æˆ·ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuestion03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper();</span><br><span class="line">    wrapper.between(<span class="string">&quot;age&quot;</span>,<span class="number">10</span>,<span class="number">30</span>);</span><br><span class="line">    <span class="keyword">int</span> count = userMapper.selectCount(wrapper);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153527524.png" alt="image-20210129153527524"></p><blockquote><p>æŸ¥è¯¢idå°äºç­‰äº4ä¸”æ²¡è¢«é€»è¾‘åˆ é™¤çš„ç”¨æˆ·</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢idå°äºç­‰äº4ä¸”æ²¡è¢«é€»è¾‘åˆ é™¤çš„ç”¨æˆ·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuestion04</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper();</span><br><span class="line">    String inSql = <span class="string">&quot;select id from user where id &lt;= 4&quot;</span>;</span><br><span class="line">    wrapper.inSql(<span class="string">&quot;id&quot;</span>,inSql);</span><br><span class="line">    List users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(user -&gt; System.out.println(user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>sqlè¯­å¥ä¸ºï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,name,age,email,create_time,update_time,version,deleted FROM user WHERE deleted&#x3D;0 AND id IN (select id from user where id &lt;&#x3D; 4)</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153535669.png" alt="image-20210129153535669"></p><blockquote><p>é€šè¿‡idè¿›è¡Œé™åºæ’åº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ï¼Œå¹¶æ ¹æ®idè¿›è¡Œé™åºæ’åº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuestion05</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueryWrapper wrapper = <span class="keyword">new</span> QueryWrapper();</span><br><span class="line">    wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    List users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(user -&gt; System.out.println(user));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153544738.png" alt="image-20210129153544738"></p><h1 id="å…­ã€ä»£ç ç”Ÿæˆå™¨"><a href="#å…­ã€ä»£ç ç”Ÿæˆå™¨" class="headerlink" title="å…­ã€ä»£ç ç”Ÿæˆå™¨"></a>å…­ã€ä»£ç ç”Ÿæˆå™¨</h1><h2 id="6-1ã€ä»‹ç»"><a href="#6-1ã€ä»‹ç»" class="headerlink" title="6.1ã€ä»‹ç»"></a>6.1ã€ä»‹ç»</h2><blockquote><p>AutoGenerator æ˜¯ MyBatis-Plus çš„ä»£ç ç”Ÿæˆå™¨ï¼Œé€šè¿‡ AutoGenerator å¯ä»¥å¿«é€Ÿç”Ÿæˆ Entityã€Mapperã€Mapper XMLã€Serviceã€Controller ç­‰å„ä¸ªæ¨¡å—çš„ä»£ç ï¼Œæå¤§çš„æå‡äº†å¼€å‘æ•ˆç‡ã€‚</p></blockquote><h2 id="6-2ã€ä½¿ç”¨"><a href="#6-2ã€ä½¿ç”¨" class="headerlink" title="6.2ã€ä½¿ç”¨"></a>6.2ã€ä½¿ç”¨</h2><h3 id="6-2-1ã€å¼•å…¥ä¾èµ–"><a href="#6-2-1ã€å¼•å…¥ä¾èµ–" class="headerlink" title="6.2.1ã€å¼•å…¥ä¾èµ–"></a>6.2.1ã€å¼•å…¥ä¾èµ–</h3><blockquote><p>ä»£ç ç”Ÿæˆå™¨éœ€è¦ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼Œè¿™é‡Œä½¿ç”¨velocityæ¨¡æ¿å¼•æ“</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®éœ€è¦ç”Ÿæˆå¯¹äºåå°çš„æ•°æ®åº“ï¼Œè¿™é‡Œä»¥leyou_shopæ•°æ®åº“çš„userè¡¨ä¸ºä¾‹ï¼Œç”Ÿæˆåå°ä»£ç </p></blockquote><h3 id="6-2-2ã€ç¼–å†™ä»£ç è‡ªåŠ¨ç”Ÿæˆå™¨CodeAutoCreatorç±»"><a href="#6-2-2ã€ç¼–å†™ä»£ç è‡ªåŠ¨ç”Ÿæˆå™¨CodeAutoCreatorç±»" class="headerlink" title="6.2.2ã€ç¼–å†™ä»£ç è‡ªåŠ¨ç”Ÿæˆå™¨CodeAutoCreatorç±»"></a>6.2.2ã€ç¼–å†™ä»£ç è‡ªåŠ¨ç”Ÿæˆå™¨CodeAutoCreatorç±»</h3><blockquote><p>è¿™é‡Œä»¥leyou_shopåº“çš„spuè¡¨ä¸ºä¾‹</p></blockquote><ul><li>è¡¨ç»“æ„å¦‚ä¸‹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153552969.png" alt="image-20210129153552969"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è”¡å¤§å¤´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@title</span>: CodeAutoGenerator</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span> mybatis-plus-blog</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/12/1016:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeAutoGenerator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€åˆ›å»ºä»£ç ç”Ÿæˆå™¨</span></span><br><span class="line">        AutoGenerator mpg = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line">        <span class="comment">// 2ã€å…¨å±€é…ç½®</span></span><br><span class="line">        GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">        String projectPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;E:\\java\\blog\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;è”¡å¤§å¤´&quot;</span>);</span><br><span class="line">        gc.setOpen(<span class="keyword">false</span>); <span class="comment">//ç”Ÿæˆåæ˜¯å¦æ‰“å¼€èµ„æºç®¡ç†å™¨</span></span><br><span class="line">        gc.setFileOverride(<span class="keyword">false</span>); <span class="comment">//é‡æ–°ç”Ÿæˆæ—¶æ–‡ä»¶æ˜¯å¦è¦†ç›–</span></span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);<span class="comment">//å»æ‰Serviceæ¥å£çš„é¦–å­—æ¯I</span></span><br><span class="line">        gc.setIdType(IdType.AUTO); <span class="comment">//ä¸»é”®ç­–ç•¥</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);<span class="comment">//å®šä¹‰ç”Ÿæˆçš„å®ä½“ç±»ä¸­æ—¥æœŸç±»å‹</span></span><br><span class="line">        gc.setSwagger2(<span class="keyword">true</span>);<span class="comment">//å¼€å¯Swagger2æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3ã€æ•°æ®æºé…ç½®</span></span><br><span class="line">        DataSourceConfig dsc = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/leyou_shop?serverTimezone=UTC&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;tianxin1230.&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4ã€åŒ…é…ç½®</span></span><br><span class="line">        PackageConfig pc = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">        pc.setParent(<span class="string">&quot;com.hzx&quot;</span>);</span><br><span class="line">        pc.setModuleName(<span class="string">&quot;mpblog&quot;</span>); <span class="comment">//æ¨¡å—å</span></span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5ã€ç­–ç•¥é…ç½®</span></span><br><span class="line">        StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;spu&quot;</span>);</span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);<span class="comment">//æ•°æ®åº“è¡¨æ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span></span><br><span class="line">        strategy.setTablePrefix(pc.getModuleName() + <span class="string">&quot;_&quot;</span>); <span class="comment">//ç”Ÿæˆå®ä½“æ—¶å»æ‰è¡¨å‰ç¼€</span></span><br><span class="line"></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);<span class="comment">//æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„åˆ°å®ä½“çš„å‘½åç­–ç•¥</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="keyword">true</span>); <span class="comment">// lombok æ¨¡å‹ @Accessors(chain = true) setteré“¾å¼æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">        strategy.setRestControllerStyle(<span class="keyword">true</span>); <span class="comment">//restful apié£æ ¼æ§åˆ¶å™¨</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>); <span class="comment">//urlä¸­é©¼å³°è½¬è¿å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line">        <span class="comment">// 6ã€æ‰§è¡Œ</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-3ã€æµ‹è¯•åŠè¯´æ˜"><a href="#6-3ã€æµ‹è¯•åŠè¯´æ˜" class="headerlink" title="6.3ã€æµ‹è¯•åŠè¯´æ˜"></a>6.3ã€æµ‹è¯•åŠè¯´æ˜</h2><blockquote><p>ç”Ÿæˆè·¯å¾„ã€ä¸»é”®ç­–ç•¥</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153604973.png" alt="image-20210129153604973"></p><blockquote><p>è®¾ç½®åŒ…åå’Œæ¨¡å—å</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153612043.png" alt="image-20210129153612043"></p><blockquote><p>è®¾ç½®è¦ç”Ÿæˆçš„è¡¨</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153620219.png" alt="image-20210129153620219"></p><blockquote><p>å¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153637898.png" alt="image-20210129153637898"></p><blockquote><p>Mybatis-plusåªå¯¹mybatisåšå¢å¼ºï¼Œä¸åšä¿®æ”¹ï¼Œæ‰€ä»¥Mybatisæœ‰çš„åŠŸèƒ½ï¼ŒMPå‡èƒ½å®ç°ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨å†™xmlæ–‡ä»¶çš„æ–¹å¼æ¥å®Œæˆã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ¡†æ¶å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
            <tag> ğŸ‘¢Spring Boot </tag>
            
            <tag> ğŸ’Mybatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼å­¦ä¹ æ€»ç»“ï¼ˆä¸€ï¼‰-å•ä¾‹æ¨¡å¼</title>
      <link href="posts/1986796058.html"/>
      <url>posts/1986796058.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€å•ä¾‹æ¨¡å¼ä»‹ç»"><a href="#1ã€å•ä¾‹æ¨¡å¼ä»‹ç»" class="headerlink" title="1ã€å•ä¾‹æ¨¡å¼ä»‹ç»"></a>1ã€å•ä¾‹æ¨¡å¼ä»‹ç»</h2><blockquote><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ Java ä¸­æœ€ç®€å•çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚</p><p>è¿™ç§æ¨¡å¼æ¶‰åŠåˆ°ä¸€ä¸ªå•ä¸€çš„ç±»ï¼Œè¯¥ç±»è´Ÿè´£åˆ›å»ºè‡ªå·±çš„å¯¹è±¡ï¼ŒåŒæ—¶ç¡®ä¿åªæœ‰å•ä¸ªå¯¹è±¡è¢«åˆ›å»ºã€‚è¿™ä¸ªç±»æä¾›äº†ä¸€ç§è®¿é—®å…¶å”¯ä¸€çš„å¯¹è±¡çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ã€‚</p><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>1ã€å•ä¾‹ç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ã€‚</li><li>2ã€å•ä¾‹ç±»å¿…é¡»è‡ªå·±åˆ›å»ºè‡ªå·±çš„å”¯ä¸€å®ä¾‹ã€‚</li><li>3ã€å•ä¾‹ç±»å¿…é¡»ç»™æ‰€æœ‰å…¶ä»–å¯¹è±¡æä¾›è¿™ä¸€å®ä¾‹ã€‚</li></ul><p>ä¸‹é¢ä»‹ç»å‡ ç§å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹æ³•</p></blockquote><h2 id="2ã€é¥¿æ±‰å¼"><a href="#2ã€é¥¿æ±‰å¼" class="headerlink" title="2ã€é¥¿æ±‰å¼"></a>2ã€é¥¿æ±‰å¼</h2><blockquote><p>è¿™ç§å•ä¾‹æ¨¡å¼å®ç°ç®€å•ï¼Œä¸”åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¿è¯äº†å¹¶å‘å…¨ï¼Œä½†ç¼ºç‚¹æ˜¯æ— æ³•å®ç°æ‡’åŠ è½½ï¼Œæ–¹æ³•å•ä¾‹åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šè¢«åˆ›å»ºï¼Œå¯èƒ½ä¼šé€ æˆç©ºé—´æµªè´¹ï¼Œè¿™ç§å•ä¾‹æ¨¡å¼ä¼šè¢«åå°„å’Œåºåˆ—åŒ–å·¥å…·ç ´åã€‚</p></blockquote><blockquote><p>å®ç°æ€è·¯</p></blockquote><ul><li>åœ¨ç±»ä¸­new ä¸€ä¸ªé™æ€ç±»å¯¹è±¡instance</li><li>ç§æœ‰åŒ–æ„é€ æ–¹æ³•</li><li>ç¼–å†™ä¸€ä¸ªé™æ€æ–¹æ³•ç”¨äºè¿”å›ç¬¬ä¸€æ­¥newçš„instanceå¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton01</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton01 instance = <span class="keyword">new</span> Singleton01();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton01</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton01 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªå®ç°æ–¹æ³•åœ¨é«˜å¹¶å‘ä¸‹çº¿ç¨‹å®‰å…¨ï¼Œä½†å¯ä»¥è¢«åå°„å’Œåºåˆ—åŒ–å·¥å…·ç ´åï¼Œä¸‹é¢ä¸€ä¸€è¿›è¡Œæµ‹è¯•</p></blockquote><h3 id="2-1ã€ä½¿ç”¨åå°„ç ´å"><a href="#2-1ã€ä½¿ç”¨åå°„ç ´å" class="headerlink" title="2.1ã€ä½¿ç”¨åå°„ç ´å"></a>2.1ã€ä½¿ç”¨åå°„ç ´å</h3><ul><li>æµ‹è¯•ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Singleton01.class;</span><br><span class="line">Constructor constructor = clazz.getDeclaredConstructor();</span><br><span class="line">constructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//ä½¿ç”¨åå°„è·å–çš„æ„é€ å™¨æ–°å»ºçš„å¯¹è±¡</span></span><br><span class="line">Singleton01 singleton01 = (Singleton01) constructor.newInstance();</span><br><span class="line"><span class="comment">//ä½¿ç”¨å•ä¾‹ç±»æ–¹æ³•è·å–çš„å¯¹è±¡</span></span><br><span class="line">Singleton01 instance = getInstance();</span><br><span class="line"><span class="comment">//æ¯”è¾ƒåœ°å€</span></span><br><span class="line">System.out.println(singleton01 == instance);</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152932524.png" alt="image-20210129152932524"></p><h3 id="2-2ã€ä½¿ç”¨åºåˆ—åŒ–å·¥å…·è¿›è¡Œç ´åï¼Œä¸‹é¢ç»™å‡ºåºåˆ—åŒ–å·¥å…·åŠæ¼”ç¤ºä»£ç "><a href="#2-2ã€ä½¿ç”¨åºåˆ—åŒ–å·¥å…·è¿›è¡Œç ´åï¼Œä¸‹é¢ç»™å‡ºåºåˆ—åŒ–å·¥å…·åŠæ¼”ç¤ºä»£ç " class="headerlink" title="2.2ã€ä½¿ç”¨åºåˆ—åŒ–å·¥å…·è¿›è¡Œç ´åï¼Œä¸‹é¢ç»™å‡ºåºåˆ—åŒ–å·¥å…·åŠæ¼”ç¤ºä»£ç "></a>2.2ã€ä½¿ç”¨åºåˆ—åŒ–å·¥å…·è¿›è¡Œç ´åï¼Œä¸‹é¢ç»™å‡ºåºåˆ—åŒ–å·¥å…·åŠæ¼”ç¤ºä»£ç </h3><ul><li>åºåˆ—åŒ–å·¥å…·ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializationUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] serialize(Object obj) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == obj) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                ByteArrayOutputStream byteArrayOutputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">                ObjectOutputStream out = <span class="keyword">new</span> ObjectOutputStream(byteArrayOutputStream);</span><br><span class="line">        ) &#123;</span><br><span class="line"></span><br><span class="line">            out.writeObject(obj);</span><br><span class="line">            <span class="keyword">return</span> byteArrayOutputStream.toByteArray();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ååºåˆ—åŒ–</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes å¯¹è±¡åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ååºåˆ—åŒ–åçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == bytes) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                ByteArrayInputStream byteArrayInputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">                ObjectInputStream in = <span class="keyword">new</span> ObjectInputStream(byteArrayInputStream);</span><br><span class="line">        ) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> in.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–å•ä¾‹å¯¹è±¡å¹¶è¿›è¡Œåºåˆ—åŒ–</span></span><br><span class="line">Singleton01 instance = getInstance();</span><br><span class="line"><span class="keyword">byte</span>[] bytes = SerializationUtils.serialize(instance);</span><br><span class="line"><span class="comment">//è¿›è¡Œååºåˆ—åŒ–ï¼Œè·å–instanceå¯¹è±¡</span></span><br><span class="line">Singleton01 deserializeInstance = (Singleton01)SerializationUtils.deserialize(bytes);</span><br><span class="line"><span class="comment">//æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„åœ°å€</span></span><br><span class="line">System.out.println(instance);</span><br><span class="line">System.out.println(deserializeInstance);</span><br><span class="line">System.out.println(instance == deserializeInstance);</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152944497.png" alt="image-20210129152944497"></p><h3 id="2-3ã€é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#2-3ã€é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2.3ã€é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>2.3ã€é—®é¢˜è§£å†³æ–¹æ¡ˆ</h3><blockquote><p>å¯¹äºåå°„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç§æœ‰çš„æ„é€ å‡½æ•°ä¸­åšä¸€äº›å¤„ç†ï¼Œå½“ç”¨æˆ·è¿›å…¥é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ„é€ æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å½“å‰é™æ€å¯¹è±¡instanceæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œç›´æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè®©å…¶ä»–äººä¸èƒ½ç”¨åå°„æ¥ç ´åå•ä¾‹æ¨¡å¼ã€‚</p></blockquote><ul><li>ä»£ç å®ç°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Singleton01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(instance != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å†æ¬¡æ‰§è¡Œä¸Šé¢çš„æµ‹è¯•ä»£ç ï¼Œç»“æœä¸º</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://raw.githubusercontent.com/tianxin763882220/images/master/blog/20201208151900.png" alt="image-20201208151900669"></p><blockquote><p>ç”±äºç±»çš„é™æ€æˆå‘˜çš„åºåˆ—åŒ–é—®é¢˜ï¼Œæ‰€ä»¥æ¯æ¬¡ååºåˆ—åŒ–éƒ½ä¼šnewä¸€ä¸ªç±»å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªreadResloveæ–¹æ³•æ¥æ—¶å…¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªinstanceå¯¹è±¡ã€‚</p></blockquote><ul><li>ä»£ç å®ç°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152958851.png" alt="image-20210129152958851"></p><h2 id="3ã€é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ”¹è¿›â€“ç™»è®°å¼"><a href="#3ã€é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ”¹è¿›â€“ç™»è®°å¼" class="headerlink" title="3ã€é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ”¹è¿›â€“ç™»è®°å¼"></a>3ã€é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼çš„æ”¹è¿›â€“ç™»è®°å¼</h2><blockquote><p>ç™»è®°å¼å•ä¾‹æ¨¡å¼é‡‡ç”¨äº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»æ¥æŒæœ‰è¯¥ç±»çš„å•å®ä¾‹å¯¹è±¡ï¼Œåœ¨å¤–éƒ¨ç±»è¢«åŠ è½½æ—¶ï¼Œé™æ€å†…éƒ¨ç±»ä¸ä¼šè¢«åŠ è½½ï¼Œå³ç±»çš„å•ä¾‹å¯¹è±¡ä¸ä¼šè¢«åˆ›å»ºï¼Œå½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ä½¿ç”¨ç±»çš„getInstanceæ–¹æ³•æ—¶ï¼Œç±»çš„å•å®ä¾‹æ‰ä¼šè¢«åŠ è½½ï¼Œè¿™æ ·æ—¢ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆèµ·åˆ°äº†æ‡’åŠ è½½çš„æ•ˆæœã€‚</p></blockquote><h3 id="3-1ã€ç™»è®°å¼å®ç°æ€è·¯"><a href="#3-1ã€ç™»è®°å¼å®ç°æ€è·¯" class="headerlink" title="3.1ã€ç™»è®°å¼å®ç°æ€è·¯"></a>3.1ã€ç™»è®°å¼å®ç°æ€è·¯</h3><ul><li>åœ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªé™æ€å†…éƒ¨ç±»SingtonHolderï¼Œç±»ä¸­å­˜æ”¾å¤–éƒ¨ç±»çš„å”¯ä¸€å®ä¾‹instance</li><li>ç§æœ‰åŒ–æ„é€ å™¨ï¼Œåœ¨æ„é€ å™¨ä¸­é€šè¿‡åˆ¤æ–­é™æ€å†…éƒ¨ç±»ä¸­instanceå®ä¾‹æ˜¯å¦ä¸ºç©ºæ¥å†³å®šè¦ä¸è¦æŠ›å‡ºå¼‚å¸¸ã€‚</li><li>åœ¨å¤–éƒ¨ç±»ä¸­æ„å»ºä¸€ä¸ªé™æ€æ–¹æ³•getInstanceæ¥è¿”å›ç±»çš„å•å®ä¾‹ã€‚</li><li>å†™ä¸€ä¸ªreadResloveæ–¹æ³•æ¥é˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹ã€‚</li></ul><h3 id="3-2ã€ä»£ç å®ç°"><a href="#3-2ã€ä»£ç å®ç°" class="headerlink" title="3.2ã€ä»£ç å®ç°"></a>3.2ã€ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton02</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Singleton02 instance = <span class="keyword">new</span> Singleton02();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(SingletonHolder.instance != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton02 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é™æ€å†…éƒ¨ç±»çš„åŠ è½½æ—¶æœºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Sington2çš„æ„é€ å‡½æ•°ä¸­è¾“å‡ºä¸€æ®µè¯­å¥æ¥åˆ¤æ–­é™æ€å†…éƒ¨ç±»çš„åŠ è½½æ—¶é—´ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class clazz = Class.forName(<span class="string">&quot;singleton.Singleton02&quot;</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;-----------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">Singleton02 instance = getInstance();</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153010304.png" alt="image-20210129153010304"></p><ul><li>ç»“è®ºï¼šé™æ€å†…éƒ¨ç±»åœ¨å¤–éƒ¨ç±»åŠ è½½æ—¶ä¸ä¼šè¢«åŠ è½½ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨getInstanceæ–¹æ³•æ—¶æ‰åŠ è½½ã€‚</li></ul><blockquote><p>å°ç»“ï¼šå¯¹äºé¥¿æ±‰å¼ï¼Œæ¨èä½¿ç”¨ç™»è®°å¼ã€‚</p></blockquote><h2 id="4ã€æ‡’æ±‰å¼å’ŒåŒæ£€é”"><a href="#4ã€æ‡’æ±‰å¼å’ŒåŒæ£€é”" class="headerlink" title="4ã€æ‡’æ±‰å¼å’ŒåŒæ£€é”"></a>4ã€æ‡’æ±‰å¼å’ŒåŒæ£€é”</h2><blockquote><p>æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼æ„å‘³ç€åœ¨ç±»åŠ è½½æ—¶ä¸åˆ›å»ºç±»çš„å•å®ä¾‹å¯¹è±¡ï¼Œè€Œæ˜¯å½“ç”¨æˆ·éœ€è¦å®ä¾‹æ—¶æ‰å»åˆ›å»ºå¯¹è±¡ï¼Œè¿™ç§æ–¹æ³•å®ç°äº†æ‡’åŠ è½½ï¼Œä¸”å®ç°ç®€å•ï¼Œä½†ä¸èƒ½ä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å•ä¾‹å”¯ä¸€æ€§ã€‚</p></blockquote><h3 id="4-1ã€ä»£ç å®ç°"><a href="#4-1ã€ä»£ç å®ç°" class="headerlink" title="4.1ã€ä»£ç å®ç°"></a>4.1ã€ä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton03</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton03 instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton03</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton03 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton03();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ç§å•ä¾‹æ¨¡å¼å­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œé™¤äº†å‰é¢æåˆ°çš„å¯ä»¥ç”¨åå°„å’Œåºåˆ—åŒ–å·¥å…·ç ´åå¤–ï¼Œè¿™ç§å•ä¾‹æ¨¡å¼åœ¨å¤šçº¿ç¨‹å¹¶å‘ç¯å¢ƒä¸‹ä¸èƒ½ä¿è¯å•ä¾‹çš„å”¯ä¸€æ€§ï¼Œç»™å‡ºæµ‹è¯•ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(getInstance());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ç»“æœï¼šå¯ä»¥çœ‹åˆ°å‡ºç°äº†ä¸¤ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦å¯¹è¿™ç§æ¨¡å¼è¿›è¡Œæ”¹è¿›</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129153022773.png" alt="image-20210129153022773"></p><h3 id="4-2ã€è§£å†³æ‡’æ±‰å¼åœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#4-2ã€è§£å†³æ‡’æ±‰å¼åœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="4.2ã€è§£å†³æ‡’æ±‰å¼åœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>4.2ã€è§£å†³æ‡’æ±‰å¼åœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><blockquote><p>åœ¨getInstanceæ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªsynchronizdå—é”å®šä»£ç ï¼Œå°±å¯ä»¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸‹é¢ç»™å‡ºä»£ç å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton04 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (Singleton04.class) &#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton04();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿™æ ·å°±å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ä¸‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†è¿™ç§ç›´æ¥åŠ åŒæ­¥å—çš„ä»£ç ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•è¿›åŒæ£€é”æ¨¡å¼çš„æ–¹æ³•åœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‰æä¸‹å°½å¯èƒ½åœ°ä¿è¯æ€§èƒ½ã€‚</p></blockquote><h3 id="4-3ã€åŒæ£€é”"><a href="#4-3ã€åŒæ£€é”" class="headerlink" title="4.3ã€åŒæ£€é”"></a>4.3ã€åŒæ£€é”</h3><blockquote><p>åŒæ ·å¯¹getInstanceæ–¹æ³•è¿›è¡Œæ”¹é€ ï¼Œåœ¨åŒæ­¥å—å¤–å†æ¬¡æ·»åŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œå³å•ä¾‹å¯¹è±¡ä¸ºç©ºæ—¶ï¼Œæ‰è¿›å…¥åŒæ­¥å—åŠä»¥åä»£ç ï¼Œä»£ç å®ç°å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DoubleCheckLock <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (DoubleCheckLock.class) &#123;</span><br><span class="line">            <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                instance = <span class="keyword">new</span> DoubleCheckLock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å‡è®¾ABåŒæ—¶è¿›å…¥ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œç”±äºsynchronizedå—çš„å­˜åœ¨ï¼ŒABæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šè¿›å…¥åŒæ­¥å—ä¸­ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ï¼Œè¿›å…¥åŒæ­¥å—çš„çº¿ç¨‹åˆ¤æ–­å½“å‰å•å®ä¾‹å¯¹è±¡ä¸ºç©ºï¼Œäºæ˜¯ä¼šåˆå§‹åŒ–å¯¹è±¡ï¼Œç„¶åé€€å‡ºsynchronizedå—ï¼Œæ­¤æ—¶å¦å¤–çš„çº¿ç¨‹è¿›å…¥ä»£ç å—æ—¶ï¼Œç”±äºinstanceå·²ç»è¢«åˆå§‹åŒ–ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¿”å›å·²ç»åˆå§‹åŒ–çš„instanceã€‚ä¹‹åçš„çº¿ç¨‹åœ¨è¿›å…¥synchronizedå—æ—¶ä¼šå…ˆè¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œæ­¤æ—¶çš„instanceå·²ç»ä¸ä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥è¿”å›instanceã€‚</p></blockquote><ul><li>å¯èƒ½é‡åˆ°çš„é—®é¢˜</li></ul><blockquote><p>ç”±äºJVMæœºå­˜åœ¨æŒ‡ä»¤é‡æ’ï¼ŒåŒæ—¶åˆå§‹åŒ–instanceå¯¹è±¡ï¼ˆinstance = new DoubleCheckLock()ï¼‰æ‰§è¡Œçš„æ“ä½œå¦‚ä¸‹</p><p>1 åˆ†é…å¯¹è±¡å†…å­˜ç©ºé—´</p><p>2 åˆå§‹åŒ–å¯¹è±¡</p><p>3 instanceæŒ‡å‘1åˆ†é…çš„ç©ºé—´</p><p>å‡ºç°æŒ‡ä»¤é‡æ’åï¼Œæ‰§è¡Œçš„æ“ä½œå¦‚ä¸‹</p><p>1 åˆ†é…å¯¹è±¡å†…å­˜ç©ºé—´</p><p>2 instanceæŒ‡å‘1åˆ†é…çš„ç©ºé—´</p><p>3 åˆå§‹åŒ–å¯¹è±¡</p><p>å¦‚æœæ­¤æ—¶å…¶ä»–çº¿ç¨‹åœ¨æŒ‡ä»¤é‡æ’çš„ç¬¬2æ­¥å°±å¯¹instanceè¿›è¡Œåˆ¤æ–­ï¼Œé‚£ä¹ˆå¯èƒ½æ‹¿åˆ°ä¸€ä¸ªç©ºçš„instanceå¯¹è±¡ï¼Œå› ä¸ºåœ¨æŒ‡ä»¤æ’åºçš„ç¬¬2æ­¥æ“ä½œåï¼ŒinstanceæŒ‡å‘çš„åœ°å€å·²ç»ä¸ä¸ºç©ºã€‚</p></blockquote><ul><li>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨<strong>volatile</strong>å…³é”®å­—ä¿®é¥°instanceå˜é‡</li></ul><blockquote><p>åŒæ£€é”çš„å®Œæ•´å®ç°ä»£ç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleCheckLock</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> DoubleCheckLock instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * åœ¨æ„é€ æ–¹æ³•ä¸­é˜²æ­¢åå°„ç ´åå•ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DoubleCheckLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DoubleCheckLock <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleCheckLock.class) &#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> DoubleCheckLock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * ç¼–å†™ä¸€ä¸ªreadResolveæ–¹æ³•é˜²æ­¢åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å½“å‰ç±»çš„å•å®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆäºŒï¼‰-å­—ç¬¦ä¸²ç›¸å…³é—®é¢˜</title>
      <link href="posts/4173931752.html"/>
      <url>posts/4173931752.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€Stringã€StringBufferä¸StringBuilderçš„åŒºåˆ«"><a href="#1ã€Stringã€StringBufferä¸StringBuilderçš„åŒºåˆ«" class="headerlink" title="1ã€Stringã€StringBufferä¸StringBuilderçš„åŒºåˆ«"></a>1ã€Stringã€StringBufferä¸StringBuilderçš„åŒºåˆ«</h2><h3 id="1-1ã€Stringç±»"><a href="#1-1ã€Stringç±»" class="headerlink" title="1.1ã€Stringç±»"></a>1.1ã€Stringç±»</h3><blockquote><p>åˆ†ææºç å¯çŸ¥ï¼ŒStringå¯¹è±¡çš„å†…å®¹æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªcharæ•°ç»„ä¸­ï¼Œä¸”è¿™ä¸ªæ•°ç»„ä½¿ç”¨finalä¿®é¥°ï¼Œè¿™ä¹Ÿæ˜¯Stringå¯¹è±¡ä¸å¯å˜çš„åŸå› ã€‚å½“è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œè™šæ‹Ÿæœºä¼šæ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡èµ‹å€¼ç»™åŸæ¥çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯çœŸçš„ä¿®æ”¹äº†åŸæ¥å­—ç¬¦ä¸²å¯¹è±¡çš„å€¼ã€‚</p><p>å­—ç¬¦ä¸²é‡å†™äº†Objectçˆ¶ç±»çš„equalsæ–¹æ³•ã€‚</p></blockquote><h3 id="1-2ã€StringBufferç±»å’ŒStringBuilderç±»"><a href="#1-2ã€StringBufferç±»å’ŒStringBuilderç±»" class="headerlink" title="1.2ã€StringBufferç±»å’ŒStringBuilderç±»"></a>1.2ã€StringBufferç±»å’ŒStringBuilderç±»</h3><blockquote><p>è¿™ä¸¤ä¸ªç±»å‡ç»§æ‰¿äºAbstractStringBuilderç±»ï¼Œä½†åˆ†ææºç å¯çŸ¥StringBufferçš„æ–¹æ³•éƒ½æ·»åŠ äº†synchronizedå…³é”®è¯è¿›è¡Œä¿®é¥°ï¼Œæ‰€ä»¥StringBufferæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨synchronizedä¿®é¥°æ–¹æ³•çš„StringBuilderæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä½†StringBuilderçš„é€Ÿåº¦è¦è¿œè¿œé«˜äºStringBufferï¼Œæ‰€ä»¥åœ¨èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ï¼ŒStringBuilderçš„ä¼˜å…ˆçº§è¦é«˜äºStringBufferã€‚</p></blockquote><h3 id="1-3ã€æ€»ç»“"><a href="#1-3ã€æ€»ç»“" class="headerlink" title="1.3ã€æ€»ç»“"></a>1.3ã€æ€»ç»“</h3><ul><li>Stringæ˜¯ä¸€ä¸ªfinalä¿®é¥°çš„ç±»ï¼Œæ‰€æœ‰çš„å±æ€§ä¹Ÿæ˜¯finalçš„ï¼Œæ‰€ä»¥Stringå…·æœ‰ä¸å¯å˜æ€§ï¼Œä¹Ÿå°±æ˜¯å¯¹å­—ç¬¦ä¸²çš„æ“ä½œï¼Œå¦‚æ‹¼æ¥ã€å‰ªåˆ‡éƒ½ä¼šäº§ç”Ÿæ–°çš„Stringå¯¹è±¡ã€‚</li><li>StringBufferæœ¬è´¨æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å¯ä¿®æ”¹å­—ç¬¦ä¸²åºåˆ—ã€‚å› ä¸ºä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥ä¼šå¸¦æ¥é¢å¤–çš„æ€§èƒ½æ¶ˆè€—ã€‚</li><li>StringBuilderæœ¬è´¨ä¸Šå’ŒStringBufferæ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯StringBuilderå»æ‰äº†çº¿ç¨‹å®‰å…¨éƒ¨åˆ†æé«˜äº†æ“ä½œæ•ˆç‡ï¼Œæ˜¯ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹å­—ç¬¦ä¸²æ‹¼æ¥çš„é¦–é€‰ã€‚</li><li>å¦‚æœç¡®å®šæ‹¼æ¥å­—ç¬¦ä¸²ä¼šå‘ç”Ÿå¤šæ¬¡ï¼Œå¹¶ä¸”é•¿åº¦å¯é¢„è®¡ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å¼€å§‹çš„æ—¶å€™æŒ‡å®šåˆé€‚çš„å¤§å°ï¼Œé¿å…æ•°ç»„æ‰©å®¹é€ æˆçš„å¼€é”€ã€‚</li></ul><h2 id="2ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­å‡ºç°æœ€å¤šæ¬¡çš„å­—ç¬¦å’Œå‡ºç°çš„æ¬¡æ•°"><a href="#2ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­å‡ºç°æœ€å¤šæ¬¡çš„å­—ç¬¦å’Œå‡ºç°çš„æ¬¡æ•°" class="headerlink" title="2ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­å‡ºç°æœ€å¤šæ¬¡çš„å­—ç¬¦å’Œå‡ºç°çš„æ¬¡æ•°"></a>2ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­å‡ºç°æœ€å¤šæ¬¡çš„å­—ç¬¦å’Œå‡ºç°çš„æ¬¡æ•°</h2><blockquote><p>éå†å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªHashMapæ¥å­˜å‚¨å‡ºç°å­—ç¬¦åŠå‡ºç°çš„æ¬¡æ•°ï¼Œä»¥å­—ç¬¦ä¸ºkeyï¼Œæ¬¡æ•°ä¸ºvalueã€‚è§£é¢˜æ€è·¯å¦‚ä¸‹</p></blockquote><ul><li><p>å‡å®šå­—ç¬¦ä¸²ä¸­å‡ºç°æœ€å¤šçš„å­—ç¬¦maxCodeä¸ºå½“å‰å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå‡ºç°æ¬¡æ•°maxCountåˆå§‹åŒ–ä¸º0</p></li><li><p>éå†å­—ç¬¦ä¸²ï¼Œåˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯å¦åœ¨hashmapçš„keyä¸­ï¼Œå¦‚æœåŒ…å«ï¼Œä»¤æ¬¡æ•°+1ï¼Œå¦åˆ™å°†è¯¥å­—ç¬¦ä¸ºkeyï¼Œ1ä¸ºvalueæ”¾å…¥hashmapä¸­</p></li><li><p>åˆ¤æ–­maxCountå’Œå½“å‰å­—ç¬¦å‡ºç°æ¬¡æ•°çš„å…³ç³»ï¼Œå¦‚æœmaxCountå°äºå½“å‰å­—ç¬¦å‡ºç°æ¬¡æ•°ï¼Œå°±ä»¤maxCode = å½“å‰å­—ç¬¦ï¼Œç„¶åæ›´æ–°maxCodeï¼Œæœ€åè¿”å›maxCodeå’ŒmaxCountå³å¯ã€‚</p></li></ul><blockquote><p>ä»£ç å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­å‡ºç°æœ€å¤šæ¬¡çš„å­—ç¬¦å’Œå‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> str ç›®æ ‡å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ä»¥maxCodeä¸ºé”®ã€maxCountä¸ºå€¼çš„map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;Character, Integer&gt; <span class="title">findMostCodeAndCount</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> maxCode = str.charAt(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">int</span> maxCount = <span class="number">0</span>;</span><br><span class="line">    Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">        Character currentCode = str.charAt(i);</span><br><span class="line">        Integer count = map.get(currentCode);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="keyword">null</span>) &#123;</span><br><span class="line">            count = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(currentCode, count);</span><br><span class="line">        <span class="keyword">if</span>(maxCount &lt; count) &#123;</span><br><span class="line">            maxCode = currentCode;</span><br><span class="line">            maxCount = count;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Character, Integer&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    result.put(maxCode,maxCount);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ä»£ç åŠç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">&quot;abcacba&quot;</span>;</span><br><span class="line">Map result = findMostCodeAndCount(str);</span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152842664.png" alt="image-20210129152842664"></p><h2 id="3ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡é‡å¤å‡ºç°çš„å­—ç¬¦"><a href="#3ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡é‡å¤å‡ºç°çš„å­—ç¬¦" class="headerlink" title="3ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡é‡å¤å‡ºç°çš„å­—ç¬¦"></a>3ã€æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡é‡å¤å‡ºç°çš„å­—ç¬¦</h2><blockquote><p>ä½¿ç”¨ä¸€ä¸ªHashSetæ¥è§£å†³é—®é¢˜ï¼Œç”±äºSetæœ‰ä¸å…è®¸å…ƒç´ é‡å¤çš„æ€§è´¨ï¼ŒSetçš„addæ–¹æ³•åœ¨æ·»åŠ é‡å¤å€¼æ˜¯ä¼šè¿”å›falseï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ€§è´¨æ¥åˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤ã€‚</p></blockquote><blockquote><p>ä»£ç å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡é‡å¤å‡ºç°çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> str ç›®æ ‡å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›ç¬¬ä¸€æ¬¡é‡å¤çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Character <span class="title">getFirstRepeat</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    Character result = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">        Character currentCode = str.charAt(i);</span><br><span class="line">        <span class="keyword">if</span>(!set.add(currentCode)) &#123;</span><br><span class="line">            result = currentCode;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ä»£ç å’Œç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">&quot;abcacba&quot;</span>;</span><br><span class="line">Character result = getFirstRepeat(str);</span><br><span class="line">System.out.println(result);</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152855053.png" alt="image-20210129152855053"></p><h2 id="4ã€ä¸¤ä¸ªå¤§æ•°ä¹‹å’Œ"><a href="#4ã€ä¸¤ä¸ªå¤§æ•°ä¹‹å’Œ" class="headerlink" title="4ã€ä¸¤ä¸ªå¤§æ•°ä¹‹å’Œ"></a>4ã€ä¸¤ä¸ªå¤§æ•°ä¹‹å’Œ</h2><blockquote><p>é¢˜ç›®æè¿°ï¼šç°åœ¨æœ‰ä¸¤ä¸ªæ•°ï¼Œä½æ•°å‡è¶…è¿‡1000ä½ï¼Œä¾‹å¦‚</p><ul><li><p>String a = â€œ123343432â€¦â€</p></li><li><p>String b = â€œ3974928374928â€¦â€</p></li></ul><p>è¿™ä¸¤ä¸ªå¤§æ•°æ— æ³•è½¬æ¢ä¸ºIntegerè®¡ç®—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„æ¥å­˜å‚¨è¿™ä¸¤ä¸ªæ•°ï¼Œç„¶åè¿›è¡Œè®¡ç®—ã€‚</p><p>è§£é¢˜æ€è·¯å¦‚ä¸‹</p></blockquote><ul><li>è®¾è¿™ä¸¤ä¸ªæ•°ä¸­å¤§çš„æ•°çš„ä½æ•°ä½mï¼Œåˆ™ç»“æœçš„æœ€å¤§ä½æ•°ä½m+1</li><li>ç”¨ä¸€ä¸ªintæ•°ç»„æ¥å­˜å‚¨ç»“æœ</li></ul><blockquote><p>ä»£ç å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * ç¼–ç¨‹ä¸¤ä¸ªå¤§æ•°ä¹‹å’Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> num1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> num2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sumOfBigNum</span><span class="params">(String num1,String num2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>[] largeArray = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">char</span>[] smallArray = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(num1.length() &gt;= num2.length()) &#123;</span><br><span class="line">        largeArray = num1.toCharArray();</span><br><span class="line">        smallArray = num2.toCharArray();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        largeArray = num2.toCharArray();</span><br><span class="line">        smallArray = num1.toCharArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span>[] res = <span class="keyword">new</span> <span class="keyword">int</span>[largeArray.length + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; largeArray.length; i++) &#123;</span><br><span class="line">        res[i] = largeArray[largeArray.length - i - <span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; smallArray.length; i++) &#123;</span><br><span class="line">        res[i] += smallArray[smallArray.length - i - <span class="number">1</span>] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; res.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(res[i] &gt; <span class="number">9</span>) &#123;</span><br><span class="line">            res[i + <span class="number">1</span>] += res[i] / <span class="number">10</span>;</span><br><span class="line">            res[i] %= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = res.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        stringBuilder.append(res[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String result = stringBuilder.toString();</span><br><span class="line">    <span class="keyword">if</span>(result.startsWith(<span class="string">&quot;0&quot;</span>)) &#123;</span><br><span class="line">        result = result.substring(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ä»£ç å’Œç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String num1 = <span class="string">&quot;12345&quot;</span>;</span><br><span class="line">String num2 = <span class="string">&quot;56756&quot;</span>;</span><br><span class="line">Integer n1 = Integer.valueOf(num1);</span><br><span class="line">Integer n2 = Integer.valueOf(num2);</span><br><span class="line">Integer sum = n1 + n2;</span><br><span class="line">System.out.println(<span class="string">&quot;è®¡ç®—æœºè®¡ç®—ç»“æœä¸ºï¼š&quot;</span> + sum);</span><br><span class="line">System.out.println(<span class="string">&quot;å‡½æ•°è®¡ç®—ç»“æœä½ï¼š&quot;</span> + sumOfBigNum(num1,num2));</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152910086.png" alt="image-20210129152910086"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆä¸€ï¼‰--å•é“¾è¡¨ç›¸å…³ç®—æ³•</title>
      <link href="posts/3227196086.html"/>
      <url>posts/3227196086.html</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1ã€ä½¿ç”¨javaå®ç°å•é“¾è¡¨"><a href="#1ã€ä½¿ç”¨javaå®ç°å•é“¾è¡¨" class="headerlink" title="1ã€ä½¿ç”¨javaå®ç°å•é“¾è¡¨"></a>1ã€ä½¿ç”¨javaå®ç°å•é“¾è¡¨</h2><blockquote><p>å»ºç«‹NodeèŠ‚ç‚¹ç±»çš„ä»£ç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    Integer data;</span><br><span class="line">    Node next;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Integer data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Node&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;data=&quot;</span> + data +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å»ºç«‹é“¾è¡¨ç±»å¹¶ç¼–å†™é“¾è¡¨ç±»çš„æ·»åŠ èŠ‚ç‚¹å’Œéå†æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span> </span>&#123;</span><br><span class="line">    Node head;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * æ·»åŠ èŠ‚ç‚¹çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node å¾…æ·»åŠ èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNode</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœå½“å‰å¤´èŠ‚ç‚¹ä¸ºç©ºï¼Œé‚£ä¹ˆå°†ä¼ å…¥çš„èŠ‚ç‚¹ä½œä¸ºå¤´èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">this</span>.head = node;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç”±äºå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ä¸å¯ç§»åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶æŒ‡é’ˆæ¥è¾…åŠ©æˆ‘ä»¬æ·»åŠ èŠ‚ç‚¹ã€‚</span></span><br><span class="line">        Node temp = head;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(temp.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€€å‡ºå¾ªç¯æ—¶ï¼ŒtempèŠ‚ç‚¹æŒ‡å‘é“¾è¡¨æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ­¤æ—¶å°†ä¼ å…¥èŠ‚ç‚¹æŒ‚åœ¨tempä¹‹åå³å¯</span></span><br><span class="line">        temp.next = node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * éå†é“¾è¡¨çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©ºï¼Œæ— æ³•éå†ï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node temp = head;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(temp == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(temp);</span><br><span class="line">            temp = temp.next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2ã€ç¼–å†™ä»£ç å®ç°å•é“¾è¡¨çš„åè½¬"><a href="#2ã€ç¼–å†™ä»£ç å®ç°å•é“¾è¡¨çš„åè½¬" class="headerlink" title="2ã€ç¼–å†™ä»£ç å®ç°å•é“¾è¡¨çš„åè½¬"></a>2ã€ç¼–å†™ä»£ç å®ç°å•é“¾è¡¨çš„åè½¬</h2><blockquote><p>è¿™é‡Œä½¿ç”¨<strong>é€’å½’</strong>æ¥å®Œæˆå•é“¾è¡¨çš„åè½¬ï¼Œè¿™ä¸ªç®—æ³•çš„æ€è·¯å¤§ä½“å¦‚ä¸‹</p></blockquote><ul><li>å‡è®¾ç°åœ¨æœ‰ä¸€æ¡å•é“¾è¡¨ï¼š1-2-3-4-NULLï¼Œåœ¨æ¯æ¬¡è¿›å…¥å€’ç½®å‡½æ•°reverseä¹‹å‰ï¼Œéœ€è¦å¯¹ä¼ å…¥çš„èŠ‚ç‚¹è¿›è¡Œåˆ¤æ–­ï¼Œå½“ä¼ å…¥çš„èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…ä¼ å…¥èŠ‚ç‚¹çš„nextæŒ‡é’ˆåŸŸä¸ºç©ºæ—¶ï¼Œè¯æ˜è¯¥é“¾è¡¨ä¸éœ€è¦åè½¬ï¼Œç›´æ¥è¿”å›è¯¥èŠ‚ç‚¹ã€‚</li><li>å½“ä¼ å…¥èŠ‚ç‚¹çš„æŒ‡é’ˆåŸŸä¸ä¸ºç©ºæ—¶ï¼Œå°†è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„nextåŸŸæŒ‡å‘è‡ªå·±ï¼ŒåŒæ—¶å°†è¯¥èŠ‚ç‚¹çš„nextæŒ‡é’ˆåŸŸç½®ä¸ºç©ºï¼Œè¿™æ ·å°±å½¢æˆäº†å±€éƒ¨æ„ä¹‰ä¸Šçš„é“¾è¡¨èŠ‚ç‚¹åè½¬ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨äº†é€’å½’ï¼Œå¹¶è®¾ç½®äº†é€’å½’é€€å‡ºæ¡ä»¶ï¼ˆå½“å‰ä¼ å…¥èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…å½“å‰ä¼ å…¥èŠ‚ç‚¹çš„nextæŒ‡é’ˆåŸŸä¸ºç©ºï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ€è·¯ï¼Œå®Œæˆå¯¹é“¾è¡¨çš„åè½¬</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152444803.png" alt="image-20210129152444803"></p><blockquote><p>å®ç°ä»£ç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">reverse</span><span class="params">(Node head)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(head == <span class="keyword">null</span> || head.next == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœè¿›å…¥è¿™ä¸ªifå—ä¸­ï¼Œè¯æ˜å½“å‰headä¸å…¶ä¹‹åç»“ç‚¹å½¢æˆçš„é“¾è¡¨ä¸éœ€è¦åè½¬</span></span><br><span class="line">        <span class="comment">//ä¾‹å¦‚1-2-3-4ä¸­çš„4ä¸éœ€è¦åè½¬ï¼Œç›´æ¥è¿”å›è¯¥èŠ‚ç‚¹å³å¯</span></span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¦‚æœé“¾è¡¨é•¿åº¦å¤§äºç­‰äº2ï¼Œè¿›è¡Œé€’å½’</span></span><br><span class="line">    Node reverseNode = reverse(head.next);</span><br><span class="line">    <span class="comment">//å°†å½“å‰èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„nextæŒ‡é’ˆåŸŸæŒ‡å‘è‡ªå·±</span></span><br><span class="line">    head.next.next = head;</span><br><span class="line">    <span class="comment">//å°†å½“å‰èŠ‚ç‚¹çš„nextæŒ‡é’ˆåŸŸç½®ç©º</span></span><br><span class="line">    head.next = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">return</span> reverseNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åˆ›å»ºä¸€ä¸ªé“¾è¡¨ï¼š1-2-3-4-5ï¼Œæµ‹è¯•ä»£ç ä¸ç»“æœå¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LinkedList linkedList = <span class="keyword">new</span> LinkedList();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    linkedList.addNode(<span class="keyword">new</span> Node(i + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;åè½¬å‰:&quot;</span>);</span><br><span class="line">linkedList.list();</span><br><span class="line">LinkedList reverseList = <span class="keyword">new</span> LinkedList(reverse(linkedList.head));</span><br><span class="line">System.out.println(<span class="string">&quot;åè½¬å:&quot;</span>);</span><br><span class="line">reverseList.list();</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152457748.png" alt="image-20210129152457748"></p><h2 id="3ã€å°†ä¸¤ä¸ªæœ‰åºå•é“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæœ‰åºå•é“¾è¡¨"><a href="#3ã€å°†ä¸¤ä¸ªæœ‰åºå•é“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæœ‰åºå•é“¾è¡¨" class="headerlink" title="3ã€å°†ä¸¤ä¸ªæœ‰åºå•é“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæœ‰åºå•é“¾è¡¨"></a>3ã€å°†ä¸¤ä¸ªæœ‰åºå•é“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæœ‰åºå•é“¾è¡¨</h2><blockquote><p>å°†Aé“¾è¡¨ï¼š1-2-3-nullä¸Bé“¾è¡¨2-3-6-nullåˆå¹¶ä¸ºä¸€å¼ æœ‰åºé“¾è¡¨ï¼Œè§£é¢˜æ€è·¯å¦‚ä¸‹</p></blockquote><ul><li>æ–°å»ºä¸€ä¸ªé“¾è¡¨tempï¼Œç„¶åä½¿ç”¨æŒ‡é’ˆéå†ABé“¾è¡¨ï¼Œå¯¹æ¯ä¸€æ¬¡éå†å‡ºæ¥çš„èŠ‚ç‚¹çš„dataå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå°†dataå€¼è¾ƒå°çš„èŠ‚ç‚¹ä»åŸé“¾è¡¨ä¸­æ‘˜é™¤ï¼Œç„¶ååŠ åˆ°tempé“¾è¡¨ä¸­ï¼Œç›´åˆ°æœ‰ä¸€æ¡é“¾è¡¨è¢«æ‘˜ç©ºã€‚</li><li>æ­¤æ—¶å¦‚æœAé“¾è¡¨è¢«æ‘˜ç©ºï¼Œé‚£ä¹ˆå°†Bé“¾è¡¨å‰©ä½™çš„èŠ‚ç‚¹æŒ‚åœ¨tempèŠ‚ç‚¹çš„æœ€åé¢ï¼Œç”±äºBé“¾è¡¨å’Œtempé“¾è¡¨æœ¬æ¥å°±æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¾—å‡ºçš„ç»“æœä»ç„¶æ˜¯ä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼Œåä¹‹äº¦ç„¶ã€‚</li></ul><blockquote><p>ä»£ç å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list1 é“¾è¡¨1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list2 é“¾è¡¨2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LinkedList <span class="title">mergeTwoList</span><span class="params">(LinkedList list1,LinkedList list2)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ª</span></span><br><span class="line">    LinkedList temp = <span class="keyword">new</span> LinkedList(<span class="keyword">new</span> Node(Integer.MIN_VALUE));</span><br><span class="line">    Node cur = temp.head;</span><br><span class="line">    <span class="keyword">while</span>(list1.head != <span class="keyword">null</span> &amp;&amp; list2.head != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(list1.head.data &lt; list2.head.data) &#123;</span><br><span class="line">            cur.next = list1.head;</span><br><span class="line">            list1.head = list1.head.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cur.next = list2.head;</span><br><span class="line">            list2.head = list2.head.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ¯ä¸€æ¬¡å¾ªç¯åéƒ½éœ€è¦å°†curåç§»</span></span><br><span class="line">        cur = cur.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é€€å‡ºå¾ªç¯æ—¶ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªé“¾è¡¨ä¸ºç©º</span></span><br><span class="line">    <span class="comment">//å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªé“¾è¡¨ä¸ºç©ºï¼Œé‚£ä¹ˆå°†cur.nextæŒ‡å‘ç¬¬äºŒä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œç”±äºç¬¬äºŒä¸ªé“¾è¡¨æœ¬èº«å°±æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥åˆå¹¶åä»ç„¶æœ‰åº</span></span><br><span class="line">    <span class="keyword">if</span>(list1.head == <span class="keyword">null</span>) &#123;</span><br><span class="line">        cur.next = list2.head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(list2.head == <span class="keyword">null</span>) &#123;</span><br><span class="line">        cur.next = list1.head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç”±äºtempçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸ºMIN_VALUEï¼Œä¸ºæ— æ•ˆèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿”å›ä¸‹ä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LinkedList(temp.head.next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ä»£ç åŠç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">LinkedList list1 = <span class="keyword">new</span> LinkedList();</span><br><span class="line">list1.addNode(<span class="keyword">new</span> Node(<span class="number">1</span>));</span><br><span class="line">list1.addNode(<span class="keyword">new</span> Node(<span class="number">2</span>));</span><br><span class="line">list1.addNode(<span class="keyword">new</span> Node(<span class="number">4</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨1ä¸º:&quot;</span>);</span><br><span class="line">list1.list();</span><br><span class="line"></span><br><span class="line">LinkedList list2 = <span class="keyword">new</span> LinkedList();</span><br><span class="line">list2.addNode(<span class="keyword">new</span> Node(<span class="number">1</span>));</span><br><span class="line">list2.addNode(<span class="keyword">new</span> Node(<span class="number">3</span>));</span><br><span class="line">list2.addNode(<span class="keyword">new</span> Node(<span class="number">4</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨2ä¸º:&quot;</span>);</span><br><span class="line">list2.list();</span><br><span class="line"></span><br><span class="line">LinkedList result = mergeTwoList(list1,list2);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå¹¶ç»“æœä¸º:&quot;</span>);</span><br><span class="line">result.list();</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152513991.png" alt="image-20210129152513991"></p><h2 id="4ã€è¿”å›é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹"><a href="#4ã€è¿”å›é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹" class="headerlink" title="4ã€è¿”å›é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹"></a>4ã€è¿”å›é“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªç»“ç‚¹</h2><blockquote><p>è¿”å›é“¾è¡¨å€’æ•°ç¬¬Kä¸ªç»“ç‚¹ï¼Œç»“é¢˜æ€è·¯å¦‚ä¸‹</p></blockquote><ul><li>åˆ›å»ºä¸¤ä¸ªæŒ‡é’ˆbeforeå’Œafterï¼Œå¹¶å°†å…¶æŒ‡å‘é“¾è¡¨å¤´èŠ‚ç‚¹head</li><li>å…ˆè®©afterç»“ç‚¹å‰è¿›kæ­¥ï¼Œå¦‚æœåœ¨æ­¤è¿‡ç¨‹ä¸­afterç»“ç‚¹å·²ç»èµ°å‡ºé“¾è¡¨çš„èŒƒå›´ï¼ˆå³ç§»åŠ¨è¿‡ç¨‹ä¸­afterå·²ä¸ºç©ºï¼‰ï¼Œé‚£ä¹ˆè¯æ˜è¾“å…¥çš„kä¸åˆæ³•ï¼Œæ­¤æ—¶è¿”å›nullã€‚</li><li>å®Œæˆä¸Šä¸€æ­¥çš„æ“ä½œåï¼Œè¿›è¡Œå¾ªç¯å¹¶ä½¿beforeå’ŒafteråŒæ—¶è¿›è¡Œç§»åŠ¨ï¼Œç›´åˆ°afterä¸ºç©ºæ—¶é€€å‡ºå¾ªç¯ï¼Œæ­¤æ—¶beforeæŒ‡å‘çš„å…ƒç´ å³ä¸ºé“¾è¡¨çš„å€’æ•°ç¬¬kä¸ªç»“ç‚¹ã€‚</li></ul><blockquote><p>ä»£ç å®ç°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * è·å–é“¾è¡¨çš„å€’æ•°ç¬¬kä¸ªç»“ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> list é“¾è¡¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> k</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">getKthFromEnd</span><span class="params">(LinkedList list,<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(list.head == <span class="keyword">null</span> || list == <span class="keyword">null</span> || k &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node before = list.head;</span><br><span class="line">    Node after = list.head;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; k;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(after == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        after = after.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(after != <span class="keyword">null</span>) &#123;</span><br><span class="line">        before = before.next;</span><br><span class="line">        after = after.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> before;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æµ‹è¯•ä»£ç ä»¥åŠç»“æœï¼Œè¿™é‡Œçš„é“¾è¡¨ä½¿ç”¨ä¸Šé¢åˆå¹¶é“¾è¡¨çš„ç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LinkedList result = mergeTwoList(list1,list2);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆå¹¶ç»“æœä¸º:&quot;</span>);</span><br><span class="line">result.list();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;å€’æ•°ç¬¬3ä¸ªç»“ç‚¹å€¼ä¸º:&quot;</span> + getKthFromEnd(result,<span class="number">2</span>));</span><br></pre></td></tr></table></figure><ul><li>ç»“æœ</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/image-20210129152527059.png" alt="image-20210129152527059"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> â˜•Java </tag>
            
            <tag> ğŸ’»åç«¯å­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
