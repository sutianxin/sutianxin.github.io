<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MyBatisæºç å­¦ä¹ ï¼ˆä¸€ï¼‰-æ‰§è¡Œå™¨åŠç¼“å­˜ä»‹ç» | Arno</title><meta name="keywords" content="â˜•Java,ğŸ’Mybatis"><meta name="author" content="å¤©æ˜•"><meta name="copyright" content="å¤©æ˜•"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æœ€è¿‘æ‰“ç®—çœ‹çœ‹Javaæ¡†æ¶çš„æºç ï¼Œå…ˆä»æœ€åŸºç¡€çš„ MyBatis çœ‹èµ·ï¼Œæ‰“ç®—æ‹¥æœ‰ä¸€å®šç§¯ç´¯åå†å»çœ‹ Spring çš„æºç ã€‚"><meta property="og:type" content="article"><meta property="og:title" content="MyBatisæºç å­¦ä¹ ï¼ˆä¸€ï¼‰-æ‰§è¡Œå™¨åŠç¼“å­˜ä»‹ç»"><meta property="og:url" content="https://sutianxin.top/posts/3708531193.html"><meta property="og:site_name" content="Arno"><meta property="og:description" content="æœ€è¿‘æ‰“ç®—çœ‹çœ‹Javaæ¡†æ¶çš„æºç ï¼Œå…ˆä»æœ€åŸºç¡€çš„ MyBatis çœ‹èµ·ï¼Œæ‰“ç®—æ‹¥æœ‰ä¸€å®šç§¯ç´¯åå†å»çœ‹ Spring çš„æºç ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/sutianxin/blogImage/raw/master/20210711221628.jpg"><meta property="article:published_time" content="2021-07-11T14:13:26.000Z"><meta property="article:modified_time" content="2021-07-11T14:21:54.106Z"><meta property="article:author" content="å¤©æ˜•"><meta property="article:tag" content="â˜•Java"><meta property="article:tag" content="ğŸ’Mybatis"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://gitee.com/sutianxin/blogImage/raw/master/20210711221628.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://sutianxin.top/posts/3708531193"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"å¤©",date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"mediumZoom",Snackbar:{chs_to_cht:"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“",cht_to_chs:"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“",day_to_night:"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#49b1f5",bgDark:"#121212",position:"top-right"},source:{jQuery:"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-07-11 22:21:54"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,a={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(a)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme");"dark"===e?activateDarkMode():"light"===e&&activateLightMode();e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"))})(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_1.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/hidescrollbar/hidescrollbar.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_2.css"><link rel="stylesheet" href="/css/cover.css"><link rel="stylesheet" href="/css/copyright.css"><link href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/flipcountdown.css"><link rel="stylesheet" href="/css/year.css"><link rel="stylesheet" href="/css/Lete.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/PaddyLin-xum/wenjian@master/css/fontanimation.css"><link href="https://cdn.bootcdn.net/ajax/libs/botui/0.3.9/botui-theme-default.css" rel="stylesheet"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/twikoo.css"><style>#article-container.post-content h1:before,h2:before,h3:before,h4:before,h5:before,h6:before{-webkit-animation:avatar_turn_around 1s linear infinite;-moz-animation:avatar_turn_around 1s linear infinite;-o-animation:avatar_turn_around 1s linear infinite;-ms-animation:avatar_turn_around 1s linear infinite;animation:avatar_turn_around 1s linear infinite}</style><link rel="stylesheet" href="/css/font.css" media="defer" onload='this.media="all"'><meta name="generator" content="Hexo 5.4.0"></head><body><a href="javascript:void(0);" onclick="preloader.endLoading()" title="ç‚¹å‡»è·³è¿‡åŠ¨ç”»"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div></a><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">69</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">12</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gucheng"></use></svg><span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu1"></use></svg><span>æ–‡ç« </span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu"></use></svg><span>å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guwan"></use></svg><span>æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gujianzhu-01"></use></svg><span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofengwenfangsibaoyantaimoyan_huaban_huaban"></use></svg><span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-red_envelope"></use></svg><span>æ‹“å±•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/random/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingbaozhu"></use></svg><span>éšæœºæ–‡ç« </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/adjust/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingguadeng"></use></svg><span>æ›´æ¢èƒŒæ™¯</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/statistics/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingjiutan"></use></svg><span>æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://sutianxin.gitee.io"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhongguojie"></use></svg><span>å›½å†…é•œåƒ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhuzi"></use></svg><span>å¯¼èˆªæ </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bb/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxinghulu"></use></svg><span>å“”å“”</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingshanzi"></use></svg><span>éŸ³ä¹</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaiqiwujiuqijue_huaban_huaban"></use></svg><span>ç¤¾äº¤</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqixun_huaban_huaban_huaban"></use></svg><span>å‹é“¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqibianzhong_huaban_huaban_huaban_huaban"></use></svg><span>æœ‹å‹åœˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guqin"></use></svg><span>å…³äºæˆ‘</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://gitee.com/sutianxin/blogImage/raw/master/20210711221628.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Arno</a></span><span id="weather-v2-plugin-simple"></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gucheng"></use></svg><span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu1"></use></svg><span>æ–‡ç« </span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu"></use></svg><span>å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guwan"></use></svg><span>æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gujianzhu-01"></use></svg><span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofengwenfangsibaoyantaimoyan_huaban_huaban"></use></svg><span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-red_envelope"></use></svg><span>æ‹“å±•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/random/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingbaozhu"></use></svg><span>éšæœºæ–‡ç« </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/adjust/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingguadeng"></use></svg><span>æ›´æ¢èƒŒæ™¯</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/statistics/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingjiutan"></use></svg><span>æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://sutianxin.gitee.io"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhongguojie"></use></svg><span>å›½å†…é•œåƒ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhuzi"></use></svg><span>å¯¼èˆªæ </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bb/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxinghulu"></use></svg><span>å“”å“”</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingshanzi"></use></svg><span>éŸ³ä¹</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaiqiwujiuqijue_huaban_huaban"></use></svg><span>ç¤¾äº¤</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqixun_huaban_huaban_huaban"></use></svg><span>å‹é“¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqibianzhong_huaban_huaban_huaban_huaban"></use></svg><span>æœ‹å‹åœˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guqin"></use></svg><span>å…³äºæˆ‘</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MyBatisæºç å­¦ä¹ ï¼ˆä¸€ï¼‰-æ‰§è¡Œå™¨åŠç¼“å­˜ä»‹ç»</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-07-11T14:13:26.000Z" title="å‘è¡¨äº 2021-07-11 22:13:26">2021-07-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-07-11T14:21:54.106Z" title="æ›´æ–°äº 2021-07-11 22:21:54">2021-07-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">æ¡†æ¶å­¦ä¹ </a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">5.5k</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ä¸€ã€MyBatis-æ‰§è¡Œå™¨"><a href="#ä¸€ã€MyBatis-æ‰§è¡Œå™¨" class="headerlink" title="ä¸€ã€MyBatis æ‰§è¡Œå™¨"></a>ä¸€ã€MyBatis æ‰§è¡Œå™¨</h1><h2 id="1-1ã€JDBC-æ‰§è¡Œè¿‡ç¨‹"><a href="#1-1ã€JDBC-æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="1.1ã€JDBC æ‰§è¡Œè¿‡ç¨‹"></a>1.1ã€JDBC æ‰§è¡Œè¿‡ç¨‹</h2><h3 id="1ã€æ‰§è¡Œæµç¨‹"><a href="#1ã€æ‰§è¡Œæµç¨‹" class="headerlink" title="1ã€æ‰§è¡Œæµç¨‹"></a>1ã€æ‰§è¡Œæµç¨‹</h3><blockquote><p>JDBC çš„æ‰§è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹å›¾</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710141150.png" alt="image-20210710140614956"></p><ul><li>è·å–è¿æ¥ï¼ˆConnectionï¼‰</li></ul><blockquote><p>åŸºäºäº‹åŠ¡æ¥è·å–è¿æ¥</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ç¬¬ä¸€æ­¥ï¼š è·å–è¿æ¥ */</span></span><br><span class="line">Connection connection = DriverManager</span><br><span class="line">                .getConnection(JDBC.URL, JDBC.USERNAME, JDBC.PASSWORD);</span><br></pre></td></tr></table></figure><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710141144.png" alt="image-20210710141144502"></p><ul><li>æ„å»º Statement å¯¹è±¡</li></ul><blockquote><p>é€šè¿‡è¿æ¥ Connection å¯¹è±¡æ¥æ„é€  Statement å¯¹è±¡</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710141251.png" alt="image-20210710141251476"></p><ul><li>è®¾ç½®å‚æ•°</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710141314.png" alt="image-20210710141314253"></p><ul><li>æ‰§è¡Œä¿®æ”¹</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710141345.png" alt="image-20210710141345565"></p><h3 id="2ã€JDBC-ä¸­çš„-Statement"><a href="#2ã€JDBC-ä¸­çš„-Statement" class="headerlink" title="2ã€JDBC ä¸­çš„ Statement"></a>2ã€JDBC ä¸­çš„ Statement</h3><blockquote><p>JDBC æœ‰ä¸‰ç§æ‰§è¡Œå™¨ï¼Œåˆ†åˆ«æ˜¯</p></blockquote><ul><li><strong>Statementï¼ˆç®€å•æ‰§è¡Œå™¨ï¼‰</strong></li></ul><blockquote><p>æ‰§è¡Œé™æ€SQL</p></blockquote><ul><li><strong>PreparedStatementï¼ˆé¢„å¤„ç†æ‰§è¡Œå™¨ï¼‰</strong></li></ul><blockquote><p>è®¾ç½®é¢„ç¼–è¯‘ï¼Œé˜²æ­¢SQLæ³¨å…¥</p></blockquote><ul><li><strong>CallableStatementï¼ˆå­˜å‚¨è¿‡ç¨‹æ‰§è¡Œå™¨ï¼‰</strong></li></ul><blockquote><p>è®¾ç½®å‡ºå‚ã€è¯»å–å‚æ•°ï¼ˆç”¨äºæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼‰</p></blockquote><ul><li>ä¸‰è€…ç»§æ‰¿å…³ç³»</li></ul><blockquote><p>CallableStatement ç»§æ‰¿è‡ª PreparedStatement ï¼Œè€Œ PreparedStatement åˆå‘ä¸Šç»§æ‰¿ Statement</p></blockquote><h2 id="1-2ã€MyBatis-æ ¸å¿ƒç»„ä»¶ï¼ˆSqlSession-ä¸-Executorï¼‰"><a href="#1-2ã€MyBatis-æ ¸å¿ƒç»„ä»¶ï¼ˆSqlSession-ä¸-Executorï¼‰" class="headerlink" title="1.2ã€MyBatis æ ¸å¿ƒç»„ä»¶ï¼ˆSqlSession ä¸ Executorï¼‰"></a>1.2ã€MyBatis æ ¸å¿ƒç»„ä»¶ï¼ˆSqlSession ä¸ Executorï¼‰</h2><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710141948.png" alt="image-20210710141948414"></p><blockquote><p>MyBatis åœ¨æ‰§è¡Œæ—¶å…³ç³»åˆ°å››ä¸ªé‡è¦æ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ <strong>åŠ¨æ€ä»£ç†ï¼ˆMapperProxyï¼‰</strong> ï¼Œ<strong>SQL ä¼šè¯ï¼ˆSqlSessionï¼‰</strong> ï¼Œ<strong>æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰</strong> å’Œ <strong>JDBC å¤„ç†å™¨ï¼ˆStatementHandlerï¼‰</strong></p></blockquote><h3 id="1ã€MyBatis-æ‰§è¡Œè¿‡ç¨‹-â€“-SQL-ä¼šè¯ï¼ˆSqlSessionï¼‰"><a href="#1ã€MyBatis-æ‰§è¡Œè¿‡ç¨‹-â€“-SQL-ä¼šè¯ï¼ˆSqlSessionï¼‰" class="headerlink" title="1ã€MyBatis æ‰§è¡Œè¿‡ç¨‹ â€“ SQL ä¼šè¯ï¼ˆSqlSessionï¼‰"></a>1ã€MyBatis æ‰§è¡Œè¿‡ç¨‹ â€“ SQL ä¼šè¯ï¼ˆSqlSessionï¼‰</h3><blockquote><p>MyBatis çš„ SQL ä¼šè¯ï¼ˆSqlSessionï¼‰é‡‡ç”¨<strong>é—¨é¢æ¨¡å¼</strong>è®¾è®¡ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç»Ÿä¸€çš„é—¨é¢æ¥å£ API ï¼Œä½¿å¾—ç³»ç»Ÿ<strong>æ›´å®¹æ˜“ä½¿ç”¨</strong></p><p>SqlSession ä¸­çš„ API åŒ…æ‹¬å¢ã€åˆ ã€æ”¹ã€æŸ¥ï¼ˆåŸºæœ¬ API ï¼‰ä»¥åŠæäº¤ã€å…³é—­ï¼ˆè¾…åŠ© API ï¼‰ç­‰ã€‚å…¶è‡ªèº«æ˜¯æ²¡æœ‰èƒ½åŠ›å¤„ç†è¿™äº›è¯·æ±‚çš„ï¼Œæ‰€ä»¥å†…éƒ¨ä¼šåŒ…å«ä¸€ä¸ªå”¯ä¸€çš„æ‰§è¡Œå™¨ Executorï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™æ‰§è¡Œå™¨æ¥å¤„ç†ã€‚</p><p>å¦‚ä¸‹å›¾ä¸­SqlSessionæ¥æ”¶ç”¨æˆ·â€œä¿®æ”¹â€è¯·æ±‚ï¼Œç„¶åè½¬äº¤ç»™Executor</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710142131.png" alt="image-20210710142131413"></p><blockquote><p>SqlSession å¦‚ä½•å°†è¯·æ±‚äº¤ç»™æ‰§è¡Œå™¨ï¼ŸSqlSession å†…éƒ¨ä¼šå­˜åœ¨ä¸€ä¸ª executor å±æ€§ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘çœŸå®çš„æ‰§è¡Œå™¨å¯¹è±¡ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ CRUD æ—¶ï¼Œå¯¹åº”çš„æ–¹æ³•ä¼šè½¬äº¤ç»™å®é™…çš„æ‰§è¡Œå™¨å¯¹è±¡</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710142202.png" alt="image-20210710142202596"></p><blockquote><p>æ‰§è¡Œå™¨å®é™…ä¸Šåªæœ‰æ”¹æŸ¥ä¸¤ä¸ªåŸºæœ¬åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>è¿™æ˜¯å› ä¸º JDBC æä¾›çš„ æ ‡å‡†API ä¸­åªæœ‰ executeUpdateï¼ˆæ”¹ï¼‰ä¸ executeQueryï¼ˆæŸ¥ï¼‰ä¸¤ä¸ªåŠŸèƒ½ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710144049.png" alt="image-20210709162116151"></p><h3 id="2ã€MyBatis-æ‰§è¡Œè¿‡ç¨‹-â€“-æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰"><a href="#2ã€MyBatis-æ‰§è¡Œè¿‡ç¨‹-â€“-æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰" class="headerlink" title="2ã€MyBatis æ‰§è¡Œè¿‡ç¨‹ â€“ æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰"></a>2ã€MyBatis æ‰§è¡Œè¿‡ç¨‹ â€“ æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰</h3><blockquote><p>Executoræ˜¯ä¸€ä¸ªå¤§ç®¡å®¶ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š<strong>ç¼“å­˜ç»´æŠ¤</strong>ã€<strong>è·å–åŠ¨æ€SQL</strong>ã€<strong>è·å–è¿æ¥</strong>ã€ä»¥åŠ<strong>æœ€ç»ˆçš„JDBCè°ƒç”¨</strong>ç­‰ã€‚åœ¨å›¾ä¸­æ‰€æœ‰è“è‰²èŠ‚ç‚¹å…¨éƒ¨éƒ½æ˜¯åœ¨Executorä¸­å®Œæˆã€‚</p><p>Executor çš„å‡ºç°æ˜¯ä¸ºäº†å¤„ç†æŸäº›å…±æ€§åŠŸèƒ½ï¼Œå¦‚ç¼“å­˜ã€è·å–è¿æ¥ç­‰</p></blockquote><p>è¿™ä¹ˆå¤šäº‹æƒ…æ— æ³•å…¨éƒ¨äº²åŠ›äº²ä¸ºï¼Œå°±éœ€è¦æŠŠä»»åŠ¡åˆ†æ´¾ä¸‹å»ã€‚æ‰€ä»¥Executorå†…éƒ¨è¿˜ä¼šåŒ…å«è‹¥å¹²ä¸ªç»„ä»¶ï¼š</p><ol><li>ç¼“å­˜ç»´æŠ¤ï¼šcache</li><li>è·å–è¿æ¥ï¼šTransaction</li><li>è·å–åŠ¨æ€sqlï¼šSqlSource</li><li>è°ƒç”¨jdbcï¼šStatementHandler</li></ol><blockquote><p>ä¸Šè¿°ç»„ä»¶ä¸­å‰ä¸‰ä¸ªå’ŒExecutoræ˜¯1å¯¹1å…³ç³»ï¼Œåªæœ‰StatementHandleræ˜¯1å¯¹å¤šã€‚æ¯æ‰§è¡Œä¸€æ¬¡SQL å°±ä¼šæ„é€ ä¸€ä¸ªæ–°çš„StatementHandlerã€‚</p></blockquote><h3 id="3ã€æ‰§è¡Œå™¨å®ç°-â€“-ç®€å•æ‰§è¡Œå™¨-SimpleExecutor"><a href="#3ã€æ‰§è¡Œå™¨å®ç°-â€“-ç®€å•æ‰§è¡Œå™¨-SimpleExecutor" class="headerlink" title="3ã€æ‰§è¡Œå™¨å®ç° â€“ ç®€å•æ‰§è¡Œå™¨ SimpleExecutor"></a>3ã€æ‰§è¡Œå™¨å®ç° â€“ ç®€å•æ‰§è¡Œå™¨ SimpleExecutor</h3><blockquote><p>ç®€å•æ‰§è¡Œå™¨åŸºæœ¬å®ç°äº†æ‰§è¡Œå™¨çš„æ‰€æœ‰ Api ï¼Œæ— è®ºæ‰§è¡Œçš„ SQL æ˜¯å¦ä¸€æ ·ï¼Œç®€å•æ‰§è¡Œå™¨åœ¨æ¯æ¬¡æ‰§è¡Œä¹‹å‰éƒ½ä¼šè¿›è¡Œä¸€æ¬¡é¢„å¤„ç†ï¼Œæ•ˆç‡ä¸é«˜ã€‚</p><p>æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é¢„å¤„ç†å™¨ï¼Œå³ PrepareStatement å¯¹è±¡</p></blockquote><h3 id="4ã€æ‰§è¡Œå™¨å®ç°-â€“-å¯é‡ç”¨æ‰§è¡Œå™¨-ReuseExecutor"><a href="#4ã€æ‰§è¡Œå™¨å®ç°-â€“-å¯é‡ç”¨æ‰§è¡Œå™¨-ReuseExecutor" class="headerlink" title="4ã€æ‰§è¡Œå™¨å®ç° â€“ å¯é‡ç”¨æ‰§è¡Œå™¨ ReuseExecutor"></a>4ã€æ‰§è¡Œå™¨å®ç° â€“ å¯é‡ç”¨æ‰§è¡Œå™¨ ReuseExecutor</h3><blockquote><p>å¯¹äºç›¸åŒçš„ SQL è¯­å¥ï¼ŒReuseExecutor åªä¼šé¢„ç¼–è¯‘ä¸€æ¬¡ã€‚</p><p>å¯¹äºç›¸åŒçš„ SQL ï¼Œä¸ä¼šè¿›è¡Œé‡å¤çš„é¢„å¤„ç†</p></blockquote><h3 id="5ã€æ‰§è¡Œå™¨å®ç°-â€“-æ‰¹å¤„ç†æ‰§è¡Œå™¨-BatchExecutor"><a href="#5ã€æ‰§è¡Œå™¨å®ç°-â€“-æ‰¹å¤„ç†æ‰§è¡Œå™¨-BatchExecutor" class="headerlink" title="5ã€æ‰§è¡Œå™¨å®ç° â€“ æ‰¹å¤„ç†æ‰§è¡Œå™¨ BatchExecutor"></a>5ã€æ‰§è¡Œå™¨å®ç° â€“ æ‰¹å¤„ç†æ‰§è¡Œå™¨ BatchExecutor</h3><blockquote><p>æ‰¹å¤„ç†åªé’ˆå¯¹å¢åˆ æ”¹ï¼Œå³å¯¹äºä¸€æ¬¡æäº¤çš„å¤šæ¬¡å¢åˆ æ”¹æ“ä½œï¼Œåªä¼šè¿›è¡Œä¸€æ¬¡é¢„å¤„ç†ã€‚</p><p>åœ¨ä½¿ç”¨ BatchExecutor æ—¶ï¼Œéœ€è¦è¿›è¡Œæ‰‹åŠ¨æäº¤ï¼Œå°†æ‰¹å¤„ç†æäº¤çš„æ•°æ®ä¸€æ¬¡åˆ·æ–°åˆ°æ•°æ®åº“ä¸­ã€‚</p></blockquote><h3 id="6ã€æ‰§è¡Œå™¨æŠ½è±¡ç±»-â€“-BaseExecutor"><a href="#6ã€æ‰§è¡Œå™¨æŠ½è±¡ç±»-â€“-BaseExecutor" class="headerlink" title="6ã€æ‰§è¡Œå™¨æŠ½è±¡ç±» â€“ BaseExecutor"></a>6ã€æ‰§è¡Œå™¨æŠ½è±¡ç±» â€“ BaseExecutor</h3><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710150330.png" alt="image-20210710150330500"></p><blockquote><p>åŸºç¡€æ‰§è¡Œå™¨æ˜¯ä¸Šé¢ä¸‰ä¸ªæ‰§è¡Œå™¨çš„çˆ¶ç±»ï¼Œå®ç°äº†ä¸‰ä¸ªæ‰§è¡Œå™¨å®ç°ç±»çš„ä¸€äº›é‡å¤æ“ä½œï¼ŒåŒ…æ‹¬<strong>ä¸€çº§ç¼“å­˜</strong>ï¼Œ<strong>è·å–è¿æ¥</strong></p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710150045.png" alt="image-20210710150045376"></p><blockquote><p>åœ¨ BaseExecutor ä¸­å­˜åœ¨ç€ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯æ‰§è¡Œå¢åˆ æ”¹çš„ doUpdate æ–¹æ³•å’Œæ‰§è¡ŒæŸ¥è¯¢çš„ doQuery æ–¹æ³•ï¼Œå®ƒçš„ä¸‰ä¸ªå®ç°å­ç±»åœ¨å„è‡ªçš„ç±»ä¸­åˆ†åˆ«å®ç°è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œä»¥æ­¤è¾¾åˆ°æ‰§è¡Œä¸åŒçš„æ“ä½œ</p></blockquote><ul><li>BaseExecutor ä¸­çš„ doUpdate æŠ½è±¡æ–¹æ³•</li></ul><blockquote><p>å®ç°ç±»åœ¨è‡ªå·±çš„ doUpdate æ–¹æ³•ä¸­ç¼–å†™æ¸…ç†ç¼“å­˜çš„é€»è¾‘ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">doUpdate</span><span class="params">(MappedStatement ms, </span></span></span><br><span class="line"><span class="function"><span class="params">                                Object parameter)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> SQLException</span>;</span><br></pre></td></tr></table></figure><ul><li>BaseExecutor ä¸­çš„ doQuery æŠ½è±¡æ–¹æ³•</li></ul><blockquote><p>å®ç°ç±»åœ¨è‡ªå·±çš„ doQuery æ–¹æ³•ä¸­ç¼–å†™ä½¿ç”¨ç¼“å­˜çš„é€»è¾‘ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">doQuery</span><span class="params">(MappedStatement ms, </span></span></span><br><span class="line"><span class="function"><span class="params">                                       Object parameter, </span></span></span><br><span class="line"><span class="function"><span class="params">                                       RowBounds rowBounds, 		 </span></span></span><br><span class="line"><span class="function"><span class="params">                                       ResultHandler resultHandler, </span></span></span><br><span class="line"><span class="function"><span class="params">                                       BoundSql boundSql)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> SQLException</span>;</span><br></pre></td></tr></table></figure><ul><li>BaseExecutor ä¸­çš„ query æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, </span></span></span><br><span class="line"><span class="function"><span class="params">                          Object parameter, </span></span></span><br><span class="line"><span class="function"><span class="params">                          RowBounds rowBounds, </span></span></span><br><span class="line"><span class="function"><span class="params">                          ResultHandler resultHandler)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">   <span class="comment">// è·å–åŠ¨æ€ SQL  </span></span><br><span class="line">   BoundSql boundSql = ms.getBoundSql(parameter);</span><br><span class="line">   <span class="comment">// åˆ›å»ºç¼“å­˜çš„ key</span></span><br><span class="line">   CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql);</span><br><span class="line">   <span class="comment">// è°ƒç”¨é‡è½½çš„ query æ–¹æ³•</span></span><br><span class="line">   <span class="keyword">return</span> query(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é‡è½½çš„ query æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  ErrorContext.instance().resource(ms.getResource()).activity(<span class="string">&quot;executing a query&quot;</span>).object(ms.getId());</span><br><span class="line">  <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">&quot;Executor was closed.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (queryStack == <span class="number">0</span> &amp;&amp; ms.isFlushCacheRequired()) &#123;</span><br><span class="line">    clearLocalCache();</span><br><span class="line">  &#125;</span><br><span class="line">  List&lt;E&gt; list;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    queryStack++;</span><br><span class="line">    <span class="comment">// è·å–æœ¬åœ°ç¼“å­˜  </span></span><br><span class="line">    list = resultHandler == <span class="keyword">null</span> ? (List&lt;E&gt;) localCache.getObject(key) : <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (list != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œé‚£ä¹ˆä¸èµ°æ•°æ®åº“ï¼Œç›´æ¥æ‰§è¡Œç›¸å…³é€»è¾‘  </span></span><br><span class="line">      handleLocallyCachedOutputParameters(ms, key, parameter, boundSql);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœç¼“å­˜ä¸­çš„æ•°æ®ä¸ºç©ºï¼Œé‚£ä¹ˆæŸ¥è¯¢æ•°æ®åº“  </span></span><br><span class="line">      list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    queryStack--;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (queryStack == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (DeferredLoad deferredLoad : deferredLoads) &#123;</span><br><span class="line">      deferredLoad.load();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// issue #601</span></span><br><span class="line">    deferredLoads.clear();</span><br><span class="line">    <span class="keyword">if</span> (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) &#123;</span><br><span class="line">      <span class="comment">// issue #482</span></span><br><span class="line">      clearLocalCache();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>queryFromDatabase æ–¹æ³•</li></ul><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ queryFromDatabase æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶å­ç±»å®ç°çš„ doQuery æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">queryFromDatabase</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  List&lt;E&gt; list;</span><br><span class="line">  localCache.putObject(key, EXECUTION_PLACEHOLDER);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    list = doQuery(ms, parameter, rowBounds, resultHandler, boundSql);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    localCache.removeObject(key);</span><br><span class="line">  &#125;</span><br><span class="line">  localCache.putObject(key, list);</span><br><span class="line">  <span class="keyword">if</span> (ms.getStatementType() == StatementType.CALLABLE) &#123;</span><br><span class="line">    localOutputParameterCache.putObject(key, parameter);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7ã€MyBatis-å®ç°äºŒçº§ç¼“å­˜-â€“-CachingExecutor"><a href="#7ã€MyBatis-å®ç°äºŒçº§ç¼“å­˜-â€“-CachingExecutor" class="headerlink" title="7ã€MyBatis å®ç°äºŒçº§ç¼“å­˜ â€“ CachingExecutor"></a>7ã€MyBatis å®ç°äºŒçº§ç¼“å­˜ â€“ CachingExecutor</h3><blockquote><p>MyBatis æ²¡æœ‰åœ¨ BaseExecutor ä¸­åŠ å…¥ä¸äºŒçº§ç¼“å­˜ç›¸å…³çš„åŠŸèƒ½ï¼Œå› ä¸ºäºŒçº§ç¼“å­˜æ˜¯éœ€è¦æ‰‹åŠ¨å¼€å¯çš„ï¼›å¯¹äºäºŒçº§ç¼“å­˜ï¼ŒMyBatis ä½¿ç”¨å¦ä¸€ä¸ª CachingExecutor ç±»æ¥å®ç° Executor æ¥å£ï¼Œ<strong>è¿™ä¸ªç±»ä¸æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»</strong></p><p>CachingExecutor åªä¸“æ³¨äºå®ç°äºŒçº§ç¼“å­˜ï¼Œå®ƒå®é™…ä¸Šæ²¡æœ‰ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„åŠŸèƒ½ï¼Œä½†å®ƒç±»ä¸­å£°æ˜äº†ä¸€ä¸ª Executor çš„å±æ€§ delegate ï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘ä¸€ä¸ª BaseExecutor å¯¹è±¡ï¼Œdelegate å±æ€§å°±æ˜¯è¢«è£…é¥°çš„å¯¹è±¡ã€‚</p><p>æ‰€ä»¥è¯´ï¼ŒCachingExecutor å¯¹è±¡ä¸­ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„åŠŸèƒ½æ˜¯ç”± BaseExecutor å¯¹è±¡æä¾›çš„ã€‚</p><p>è¿™æ˜¯ <strong>è£…é¥°è€…æ¨¡å¼</strong> çš„å…·ä½“å®ç°ï¼Œåœ¨ä¸æ”¹å˜åŸæœ‰ç±»ç»“æ„å’Œç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡<strong>åŒ…è£…æºå¯¹è±¡</strong>å»æ‰©å±•ä¸€ä¸ªæ–°åŠŸèƒ½ã€‚</p><p>ç›¸å½“äºä¸º BaseExecutor è£…é¥°äº†ä¸€å±‚äºŒçº§ç¼“å­˜çš„åŠŸèƒ½ï¼Œä¿è¯äº†ç±»çš„å•ä¸€èŒè´£ã€‚</p><p><strong>å…ˆèµ°äºŒçº§ç¼“å­˜ï¼Œåèµ°ä¸€çº§ç¼“å­˜</strong></p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710152457.png" alt="image-20210710152457486"></p><ul><li>CachingExecutor ä¸­çš„ update æ–¹æ³•</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710152924.png" alt="image-20210710152924276"></p><ul><li>CachingExecutor ä¸­çš„ query æ–¹æ³•</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710153057.jpg" alt="2021-07-10_152957 (2)"></p><blockquote><p>åœ¨å¼€å¯äºŒçº§ç¼“å­˜çš„æ¡ä»¶ä¸‹ï¼Œæ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶çš„æ“ä½œæ­¥éª¤å¦‚ä¸‹</p></blockquote><ol><li><p>è°ƒç”¨ SqlSession çš„ API ï¼ŒSqlSession å°†è¯·æ±‚åŠå‚æ•°äº¤ç»™å…¶ç±»ä¸­çš„ Executor å±æ€§æ‰§è¡Œï¼Œæ³¨æ„ï¼Œæ­¤æ—¶<strong>è¿™ä¸ª Executor æŒ‡å‘çš„åº”è¯¥æ˜¯ä¸€ä¸ª CachingExecutor å¯¹è±¡</strong>ã€‚</p></li><li><p>å…ˆæŸ¥è¯¢äºŒçº§ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰äºŒçº§ç¼“å­˜ï¼Œé‚£ä¹ˆè°ƒç”¨ CachingExecutor ä¸­çš„ deltegate å±æ€§è®¿é—®æ•°æ®åº“ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›äºŒçº§ç¼“å­˜ï¼Œè¿™é‡Œçš„ delegate æ˜¯ä¸€ä¸ª BaseExecutor å¯¹è±¡ï¼Œå…¶ä¼šè°ƒç”¨å®ç°å­ç±»çš„æ–¹æ³•è®¿é—®ä¸€çº§ç¼“å­˜æˆ–è€…ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’</p></li></ol><h1 id="äºŒã€MyBatis-çš„ç¼“å­˜"><a href="#äºŒã€MyBatis-çš„ç¼“å­˜" class="headerlink" title="äºŒã€MyBatis çš„ç¼“å­˜"></a>äºŒã€MyBatis çš„ç¼“å­˜</h1><blockquote><p>MyBatis çš„ç¼“å­˜åˆ†ä¸ºä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œå…¶ä¸­äºŒçº§ç¼“å­˜åœ¨ CachingExecutor ä¸­å®ç°ï¼Œä¸€çº§ç¼“å­˜åœ¨ BaseExecutor ä¸­å®ç°</p></blockquote><h2 id="2-1ã€ä¸€çº§ç¼“å­˜"><a href="#2-1ã€ä¸€çº§ç¼“å­˜" class="headerlink" title="2.1ã€ä¸€çº§ç¼“å­˜"></a>2.1ã€ä¸€çº§ç¼“å­˜</h2><h3 id="1ã€è¯´æ˜"><a href="#1ã€è¯´æ˜" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h3><blockquote><p>ä¸€çº§ç¼“å­˜ä¹Ÿç§°ä¸º<strong>ä¼šè¯çº§ç¼“å­˜</strong>ï¼ŒæŒ‡çš„æ˜¯åœ¨åŒä¸€ä¼šè¯å†…å¦‚æœæœ‰ä¸¤æ¬¡ç›¸åŒçš„æŸ¥è¯¢ï¼ˆSqlå’Œå‚æ•°å‡ç›¸åŒï¼‰ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡å°±ä¼šå‘½ä¸­ç¼“å­˜ã€‚ä¸€çº§ç¼“å­˜é€šè¿‡ä¼šè¯è¿›è¡Œå­˜å‚¨ï¼Œå½“ä¼šè¯å…³é—­ï¼Œç¼“å­˜ä¹Ÿå°±æ²¡æœ‰äº†ã€‚æ­¤å¤–å¦‚æœä¼šè¯è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå¢åˆ æ”¹ï¼‰ æ“ä½œï¼Œç¼“å­˜ä¹Ÿä¼šè¢«æ¸…ç©ºã€‚</p><p>æ³¨æ„ï¼Œå¦‚æœæ‰§è¡Œçš„ SQL å’Œå‚æ•°å‡ç›¸åŒï¼Œä½† Statement Id ä¸åŒï¼Œé‚£ä¹ˆä¸€çº§ç¼“å­˜ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œè¿™é‡Œçš„ Statement Id ä¸º ï¼ˆMapper æ¥å£å…¨ç±»å + æ–¹æ³•ï¼‰ã€‚</p><p><strong>ä¸€çº§ç¼“å­˜é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œè€Œä¸”ä¸èƒ½å…³é—­</strong>ã€‚</p></blockquote><ul><li>ä¸ºä»€ä¹ˆä¸€çº§ç¼“å­˜æ— æ³•å…³é—­ï¼Ÿ</li></ul><blockquote><p>å› ä¸º MyBatis çš„ä¸€äº›å…³é”®ç‰¹æ€§ï¼Œå¦‚é€šè¿‡ <strong><association>å’Œ<collection>å»ºç«‹çº§è”æ˜ å°„</collection></association></strong>ã€é¿å…å¾ªç¯å¼•ç”¨ï¼ˆcircular referencesï¼‰ã€åŠ é€Ÿé‡å¤åµŒå¥—æŸ¥è¯¢ç­‰ éƒ½æ˜¯åŸºäº MyBatis çš„ä¸€çº§ç¼“å­˜å®ç°çš„ï¼Œ<strong>è€Œä¸” MyBatis ç»“æœé›†æ˜ å°„ç›¸å…³ä»£ç é‡åº¦ä¾èµ– CacheKey</strong>ï¼Œæ‰€ä»¥ç›®å‰MyBatisä¸æ”¯æŒå…³é—­ä¸€çº§ç¼“å­˜ã€‚</p></blockquote><h3 id="2ã€MyBatis-ä¸­ä¸€çº§ç¼“å­˜çš„çº§åˆ«"><a href="#2ã€MyBatis-ä¸­ä¸€çº§ç¼“å­˜çš„çº§åˆ«" class="headerlink" title="2ã€MyBatis ä¸­ä¸€çº§ç¼“å­˜çš„çº§åˆ«"></a>2ã€MyBatis ä¸­ä¸€çº§ç¼“å­˜çš„çº§åˆ«</h3><blockquote><p>MyBatis æä¾›äº†ä¸€ä¸ªé…ç½®å‚æ•° <strong>localCacheScope</strong>ï¼Œç”¨äºæ§åˆ¶ä¸€çº§ç¼“å­˜çš„çº§åˆ«ï¼Œè¯¥å‚æ•°çš„å–å€¼ä¸º SESSIONã€STATEMENT</p></blockquote><ul><li>å½“æŒ‡å®š localCacheScope å‚æ•°å€¼ä¸º SESSION æ—¶ï¼Œç¼“å­˜å¯¹æ•´ä¸ª SqlSession æœ‰æ•ˆï¼Œåªæœ‰æ‰§è¡Œ DML è¯­å¥ï¼ˆæ›´æ–°è¯­å¥ï¼‰æ—¶ï¼Œç¼“å­˜æ‰ä¼šè¢«æ¸…é™¤ã€‚</li><li>å½“ localCacheScope å€¼ä¸º STATEMENT æ—¶ï¼Œç¼“å­˜ä»…å¯¹å½“å‰æ‰§è¡Œçš„è¯­å¥æœ‰æ•ˆï¼Œå½“è¯­å¥æ‰§è¡Œå®Œæ¯•åï¼Œç¼“å­˜å°±ä¼šè¢«æ¸…ç©ºã€‚</li></ul><h3 id="3ã€æºç è§£æ"><a href="#3ã€æºç è§£æ" class="headerlink" title="3ã€æºç è§£æ"></a>3ã€æºç è§£æ</h3><blockquote><p>ä¸€çº§ç¼“å­˜åº•å±‚ä½¿ç”¨ä¸€ä¸ª HashMap å®ç°ï¼Œå­˜å‚¨ç»“æ„ä¸º key-value ç»“æ„</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710172443.png" alt="image-20210710172443663"></p><blockquote><p>åœ¨ä¸Šå›¾ä¸­ï¼Œå¦‚æœä¸å­˜åœ¨ä¸€çº§ç¼“å­˜ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œ BaseExecutor å­ç±»çš„ doQuery æ–¹æ³•è®¿é—®æ•°æ®åº“ï¼Œåœ¨ä»æ•°æ®åº“æŸ¥è¯¢åˆ°æ•°æ®åï¼Œå°†æ•°æ®å¡«å……åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710172736.png" alt="image-20210710172736928"></p><ul><li>æŸ¥çœ‹ BaseExecutor ä¸­çš„ query æ–¹æ³•æºç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  List&lt;E&gt; list;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    queryStack++;</span><br><span class="line">    list = resultHandler == <span class="keyword">null</span> ? (List&lt;E&gt;) localCache.getObject(key) : <span class="keyword">null</span>;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»ä¸Šé¢çš„æºç å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ query æ–¹æ³•ä¸­ä½¿ç”¨ localCache å±æ€§çš„ getObject æ–¹æ³•è·å–ç¼“å­˜ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª CacheKey å¯¹è±¡ï¼Œè¿™ä¸ª localCache åœ¨ç±»ä¸­çš„å£°æ˜å¦‚ä¸‹</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710173313.png" alt="image-20210710173313187"></p><blockquote><p>å¯ä»¥çœ‹åˆ° localCache æ˜¯ä¸€ä¸ª PerpetualCache ç±»å‹çš„å±æ€§ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥æ¥æŸ¥çœ‹ PerpetualCache çš„æºç </p></blockquote><ul><li>PerpetualCache çš„æºç </li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710173557.png" alt="image-20210710173557417"></p><blockquote><p>åŒæ—¶ï¼ŒPerpetualCache ç±»ä¸­çš„ getObject æ–¹æ³•åº•å±‚è°ƒç”¨äº† HashMap çš„ get æ–¹æ³•</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710173732.png" alt="image-20210710173732639"></p><h3 id="4ã€CacheKey"><a href="#4ã€CacheKey" class="headerlink" title="4ã€CacheKey"></a>4ã€CacheKey</h3><blockquote><p>MyBatis é€šè¿‡ CacheKey å¯¹è±¡æ¥æè¿°ç¼“å­˜çš„ Key å€¼ã€‚<br>åœ¨è¿›è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œé¦–å…ˆåˆ›å»º CacheKey å¯¹è±¡ï¼ˆ CacheKey å¯¹è±¡å†³å®šäº†ç¼“å­˜çš„ Key ä¸å“ªäº›å› ç´ æœ‰å…³ç³»ï¼‰ã€‚<br>å¦‚æœä¸¤æ¬¡æŸ¥è¯¢æ“ä½œ CacheKey å¯¹è±¡ç›¸åŒï¼Œå°±è®¤ä¸ºè¿™ä¸¤æ¬¡æŸ¥è¯¢æ‰§è¡Œçš„æ˜¯ç›¸åŒçš„SQLè¯­å¥ã€‚</p><p>CacheKey å¯¹è±¡é€šè¿‡ BaseExecutor ç±»çš„ createCacheKey() æ–¹æ³•åˆ›å»ºï¼Œä»£ç å¦‚ä¸‹ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheKey <span class="title">createCacheKey</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">&quot;Executor was closed.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  CacheKey cacheKey = <span class="keyword">new</span> CacheKey();</span><br><span class="line">  <span class="comment">// è·å– StatementId  </span></span><br><span class="line">  cacheKey.update(ms.getId());</span><br><span class="line">  <span class="comment">// è·å–åˆ†é¡µä¿¡æ¯ -- åç§»é‡ </span></span><br><span class="line">  cacheKey.update(rowBounds.getOffset());</span><br><span class="line">  <span class="comment">// è·å–åˆ†é¡µä¿¡æ¯ -- æŸ¥è¯¢è®°å½•æ•°  </span></span><br><span class="line">  cacheKey.update(rowBounds.getLimit());</span><br><span class="line">  <span class="comment">// è·å–æ‰§è¡Œçš„ SQL  </span></span><br><span class="line">  cacheKey.update(boundSql.getSql());</span><br><span class="line">  List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class="line">  TypeHandlerRegistry typeHandlerRegistry = ms.getConfiguration().getTypeHandlerRegistry();</span><br><span class="line">  <span class="comment">// è·å–å‚æ•°</span></span><br><span class="line">  <span class="keyword">for</span> (ParameterMapping parameterMapping : parameterMappings) &#123;</span><br><span class="line">    <span class="keyword">if</span> (parameterMapping.getMode() != ParameterMode.OUT) &#123;</span><br><span class="line">      Object value;</span><br><span class="line">      String propertyName = parameterMapping.getProperty();</span><br><span class="line">      <span class="keyword">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</span><br><span class="line">        value = boundSql.getAdditionalParameter(propertyName);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parameterObject == <span class="keyword">null</span>) &#123;</span><br><span class="line">        value = <span class="keyword">null</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</span><br><span class="line">        value = parameterObject;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        MetaObject metaObject = configuration.newMetaObject(parameterObject);</span><br><span class="line">        value = metaObject.getValue(propertyName);</span><br><span class="line">      &#125;</span><br><span class="line">      cacheKey.update(value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è·å–ç¯å¢ƒå˜é‡  </span></span><br><span class="line">  <span class="keyword">if</span> (configuration.getEnvironment() != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// issue #176</span></span><br><span class="line">    cacheKey.update(configuration.getEnvironment().getId());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¿”å› cacheKey å¯¹è±¡  </span></span><br><span class="line">  <span class="keyword">return</span> cacheKey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>CacheKey ç±»ä¸­çš„ç»“æ„å¦‚ä¸‹</p></blockquote><ul><li>multiplier</li></ul><blockquote><p><em>è®¡ç®—hashcodeçš„ä¹˜ç§¯æ•°</em>ï¼Œé»˜è®¤ä¸º 37</p></blockquote><ul><li>hashCode</li></ul><blockquote><p>é»˜è®¤ä¸º17</p></blockquote><ul><li>updateList</li></ul><blockquote><p>ç”¨äºå†³å®šæ˜¯å¦å‘½ä¸­ç¼“å­˜çš„å˜é‡ï¼Œè¿™æ˜¯ä¸€ä¸ª Object å¯¹è±¡åˆ—è¡¨ï¼Œé‡Œé¢é€šå¸¸å¡«å……å…­ä¸ªå€¼</p></blockquote><ol><li>Statement Id ï¼š åŒºåˆ† Mapper æ¥å£æ–¹æ³•çš„å”¯ä¸€æŒ‡å®šå€¼ï¼Œä¸º Mapper æ¥å£ + æ–¹æ³•åç»„æˆ</li><li>offset ï¼š åˆ†é¡µåç§»é‡ï¼Œé»˜è®¤ä¸º 0</li><li>limit ï¼š æŸ¥è¯¢æ•°æ®æ¡æ•°ï¼Œé»˜è®¤ä¸º Integer.MAX_VALUEï¼Œè¿™ä¸ªå±æ€§ä¸ä¸Šé¢çš„å±æ€§æ„æˆåˆ†é¡µæ¡ä»¶</li><li>SQL ï¼šæŸ¥è¯¢çš„ SQL è¯­å¥</li><li>parameterValue ï¼š æŸ¥è¯¢å‚æ•°çš„å€¼</li><li>environmentId ï¼š ç¯å¢ƒå˜é‡ï¼Œåœ¨é…ç½®mybatisç¯å¢ƒçš„æ—¶å€™æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼ˆenvironmentï¼‰ ï¼Œä»–æœ‰ä¸€ä¸ªå±æ€§idï¼›environmentIdçš„å°±æ˜¯è¿™ä¸ªidçš„å€¼ï¼›</li></ol><blockquote><p>åœ¨å¤šæ¬¡æŸ¥è¯¢ä¸­ï¼Œåªæœ‰ updateList ä¸­çš„å…­ä¸ªå˜é‡å…¨éƒ¨å»åˆï¼Œé‚£ä¹ˆæ‰èƒ½å‘½ä¸­ä¸€çº§ç¼“å­˜ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheKey</span> <span class="keyword">implements</span> <span class="title">Cloneable</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1146682552656046210L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> CacheKey NULL_CACHE_KEY = <span class="keyword">new</span> NullCacheKey();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_MULTIPLYER = <span class="number">37</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_HASHCODE = <span class="number">17</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> multiplier;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> hashcode;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> checksum;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line">  <span class="comment">// 8/21/2017 - Sonarlint flags this as needing to be marked transient.  While true if content is not serializable, this is not always true and thus should not be marked transient.</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Object&gt; updateList;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CacheKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hashcode = DEFAULT_HASHCODE;</span><br><span class="line">    <span class="keyword">this</span>.multiplier = DEFAULT_MULTIPLYER;</span><br><span class="line">    <span class="keyword">this</span>.count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.updateList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><blockquote><p>æ–­ç‚¹è¿½è¸ª</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710175408.png" alt="image-20210710175408692"></p><h3 id="5ã€å†™å…¥ä¸€çº§ç¼“å­˜"><a href="#5ã€å†™å…¥ä¸€çº§ç¼“å­˜" class="headerlink" title="5ã€å†™å…¥ä¸€çº§ç¼“å­˜"></a>5ã€å†™å…¥ä¸€çº§ç¼“å­˜</h3><blockquote><p>åœ¨ BaseExecutor çš„ queryFromDataBase æ–¹æ³•ä¸­ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œåœ¨ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°æ•°æ®åï¼Œä¼šè°ƒç”¨ localCache çš„ putObject æ–¹æ³•å°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ”¾å…¥æ•°æ®åº“ä¸­ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710180304.png" alt="image-20210710180304002"></p><h3 id="6ã€æ¸…ç©ºä¸€çº§ç¼“å­˜"><a href="#6ã€æ¸…ç©ºä¸€çº§ç¼“å­˜" class="headerlink" title="6ã€æ¸…ç©ºä¸€çº§ç¼“å­˜"></a>6ã€æ¸…ç©ºä¸€çº§ç¼“å­˜</h3><blockquote><p>MyBatis ä½¿ç”¨ clearLocalCache æ–¹æ³•æ¥æ¸…ç©ºä¸€çº§ç¼“å­˜</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710180723.png" alt="image-20210710180723202"></p><ul><li>æ‰§è¡Œ update æ—¶ä¼šè°ƒç”¨ clearLocalCache æ–¹æ³•æ¸…ç©ºä¸€çº§ç¼“å­˜</li></ul><blockquote><p>BaseExecutor ç±»ä¸­çš„ update æ–¹æ³•æºç å¦‚ä¸‹</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710180910.png" alt="image-20210710180910115"></p><ul><li>åœ¨æŸ¥è¯¢ä¹‹å‰å¦‚æœé…ç½® <strong>flushCache = true</strong> ï¼Œé‚£ä¹ˆä¹Ÿä¼šæ¸…ç©ºç¼“å­˜</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710181117.png" alt="image-20210710181117425"></p><ul><li>å¦‚æœç¼“å­˜çš„ä½œç”¨åŸŸæ˜¯ STATEMENT ï¼Œé‚£ä¹ˆæ¯æ¬¡æŸ¥è¯¢å‰ä¹Ÿä¼šæ¸…ç©ºä¸€çº§ç¼“å­˜</li></ul><blockquote><p>æ³¨æ„ï¼Œæ¸…ç©ºç¼“å­˜ä¸èƒ½å‘ç”Ÿåœ¨å­æŸ¥è¯¢ä¸­ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (queryStack == <span class="number">0</span>) &#123;</span><br><span class="line">    ...  </span><br><span class="line">    <span class="keyword">if</span> (configuration.getLocalCacheScope() == LocalCacheScope.STATEMENT) &#123;</span><br><span class="line">      <span class="comment">// issue #482</span></span><br><span class="line">      clearLocalCache();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰§è¡Œ rollback å’Œ commit éƒ½ä¼šæ¸…ç©ºç¼“å­˜</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commit</span><span class="params">(<span class="keyword">boolean</span> required)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">...</span><br><span class="line">   clearLocalCache();</span><br><span class="line">   flushStatements();</span><br><span class="line">   <span class="keyword">if</span> (required) &#123;</span><br><span class="line">     transaction.commit();</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rollback</span><span class="params">(<span class="keyword">boolean</span> required)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (!closed) &#123;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       clearLocalCache();</span><br><span class="line">       flushStatements(<span class="keyword">true</span>);</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (required) &#123;</span><br><span class="line">         transaction.rollback();</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="7ã€ä¸€çº§ç¼“å­˜å¤±æ•ˆ"><a href="#7ã€ä¸€çº§ç¼“å­˜å¤±æ•ˆ" class="headerlink" title="7ã€ä¸€çº§ç¼“å­˜å¤±æ•ˆ"></a>7ã€ä¸€çº§ç¼“å­˜å¤±æ•ˆ</h3><ul><li>Spring æ•´åˆ MyBatis åï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µã€‚</li></ul><blockquote><p>è¿™æ˜¯ç”±äºåœ¨<strong>æœªå¼€å¯äº‹åŠ¡çš„æƒ…å†µ</strong>ä¸‹ï¼Œæ¯æ¬¡æŸ¥è¯¢ï¼Œ<strong>Spring éƒ½ä¼šå…³é—­æ—§çš„ SqlSession å¯¹è±¡ç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ SqlSession å¯¹è±¡</strong>ï¼Œç”±äºä¸€çº§ç¼“å­˜æ˜¯ä¼šè¯çº§ç¼“å­˜ï¼Œæ‰€ä»¥ä¸åŒä¼šè¯çš„æŸ¥è¯¢ä¹‹é—´è‡ªç„¶æ— æ³•ä½¿ç”¨ä¸€çº§ç¼“å­˜ã€‚</p><p>åœ¨<strong>å¼€å¯äº‹åŠ¡</strong>åï¼Œ<strong>Spring ä¼šä½¿ç”¨ ThreadLocal è·å–å½“å‰èµ„æºç»‘å®šåŒä¸€ä¸ª SqlSession å¯¹è±¡</strong>ï¼Œå› ä¸ºä¸€çº§ç¼“å­˜æ˜¯æœ‰æ•ˆçš„ã€‚</p></blockquote><ul><li>è§£å†³æ–¹æ³•</li></ul><blockquote><p>æ·»åŠ äº‹åŠ¡å³å¯ã€‚</p></blockquote><h2 id="2-2ã€äºŒçº§ç¼“å­˜"><a href="#2-2ã€äºŒçº§ç¼“å­˜" class="headerlink" title="2.2ã€äºŒçº§ç¼“å­˜"></a>2.2ã€äºŒçº§ç¼“å­˜</h2><h3 id="1ã€è¯´æ˜-1"><a href="#1ã€è¯´æ˜-1" class="headerlink" title="1ã€è¯´æ˜"></a>1ã€è¯´æ˜</h3><blockquote><p>äºŒçº§ç¼“å­˜ä¹Ÿç§°ä¸ºåº”ç”¨çº§ç¼“å­˜ï¼Œä¸ä¸€çº§ç¼“å­˜ä¸åŒï¼Œå®ƒçš„ä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªåº”ç”¨ï¼Œå¹¶ä¸”å¯ä»¥è·¨çº¿ç¨‹ä½¿ç”¨ã€‚</p><p>æ‰€ä»¥äºŒçº§ç¼“å­˜æ‹¥æœ‰æ›´é«˜çš„å‘½ä¸­ç‡ï¼Œé€‚åˆç¼“å­˜ä¸€äº›ä¿®æ”¹è¾ƒå°‘çš„æ•°æ®ã€‚</p><p><strong>ç”±äºç”Ÿå‘½å‘¨æœŸé•¿ï¼Œè·¨ä¼šè¯è®¿é—®çš„å› ç´ æ‰€ä»¥äºŒçº§åœ¨ä½¿ç”¨ä¸Šè¦æ›´è°¨æ…ï¼Œå¦‚æœç”¨çš„ä¸å¥½å°±ä¼šé€ æˆè„è¯»</strong>ã€‚</p></blockquote><h3 id="2ã€è®¾ç½®æ–¹æ³•"><a href="#2ã€è®¾ç½®æ–¹æ³•" class="headerlink" title="2ã€è®¾ç½®æ–¹æ³•"></a>2ã€è®¾ç½®æ–¹æ³•</h3><ul><li><p>éœ€è¦åœ¨ MyBatis çš„ä¸»é…ç½®æ–‡ä»¶ä¸­çš„ settings æ ‡ç­¾ä¸­è®¾ç½® cacheEnable = true=</p></li><li><p>ç„¶ååœ¨ Mapper æ–‡ä»¶ä¸­é…ç½®ç¼“å­˜ç­–ç•¥ã€åˆ·æ–°é¢‘ç‡å’Œç¼“å­˜å®¹é‡ç­‰ä¿¡æ¯ã€‚</p></li></ul><h3 id="3ã€äºŒçº§ç¼“å­˜æ‰©å±•æ€§éœ€æ±‚"><a href="#3ã€äºŒçº§ç¼“å­˜æ‰©å±•æ€§éœ€æ±‚" class="headerlink" title="3ã€äºŒçº§ç¼“å­˜æ‰©å±•æ€§éœ€æ±‚"></a>3ã€äºŒçº§ç¼“å­˜æ‰©å±•æ€§éœ€æ±‚</h3><ul><li>å­˜å‚¨</li></ul><blockquote><p>ä¸€çº§ç¼“å­˜åº•å±‚ä½¿ç”¨ HashMap æ¥å®ç°ç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†äºŒçº§ç¼“å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨<strong>å†…å­˜ï¼ˆé€Ÿåº¦å¿«ä½†æ–­ç”µå³å¤±ï¼‰</strong>ã€ç¡¬ç›˜æˆ–è€…æ˜¯ç¬¬ä¸‰æ–¹ç¼“å­˜ä¸­ï¼ˆ<code>Redis</code>ï¼‰</p><p>äºŒçº§ç¼“å­˜åº•å±‚çš„å­˜å‚¨æ ¼å¼è¿˜æ˜¯ <code>key:value</code></p></blockquote><ul><li>ç¼“å­˜æ·˜æ±°ç­–ç•¥</li></ul><blockquote><p>ç”±äºäºŒçº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æ·˜æ±°ç­–ç•¥åœ¨ç©ºé—´ä¸è¶³æ—¶å¯¹ä¸€äº›ç¼“å­˜è¿›è¡Œæ·˜æ±°ï¼Œå¸¸è§çš„æœ‰ <code>FIFO</code> ï¼Œå³<strong>å…ˆè¿›å…ˆå‡º</strong>çš„æ·˜æ±°ç­–ç•¥ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ LRU ï¼Œå³æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å­˜ã€‚</p></blockquote><ul><li><p>è¿‡æœŸæ¸…ç†</p></li><li><p>çº¿ç¨‹å®‰å…¨</p></li><li><p>å‘½ä¸­ç‡ç»Ÿè®¡</p></li><li><p>åºåˆ—åŒ–</p></li><li><p>â€¦</p></li></ul><h3 id="3ã€è´£ä»»é“¾è®¾è®¡æ¨¡å¼"><a href="#3ã€è´£ä»»é“¾è®¾è®¡æ¨¡å¼" class="headerlink" title="3ã€è´£ä»»é“¾è®¾è®¡æ¨¡å¼"></a>3ã€è´£ä»»é“¾è®¾è®¡æ¨¡å¼</h3><blockquote><p>è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰ä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾ã€‚è®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰å¯èƒ½æ¥æ”¶è¯·æ±‚ï¼Œå°†è¿™äº›å¯¹è±¡è¿æ¥æˆä¸€æ¡é“¾ï¼Œå¹¶ä¸”æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚</p><p><strong>æ‹¦æˆªçš„ç±»éœ€è¦å®ç°ç»Ÿä¸€æ¥å£</strong>ï¼Œç”±äºåœ¨å®ç°ç¼“å­˜ä¸­éœ€è¦è®¾è®¡å¤§é‡æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¤šä¸ªæ‹¥æœ‰ä¸åŒèŒè´£çš„ç±»æ¥æ¥æ”¶è¯·æ±‚ï¼Œè¿™äº›ç±»å®ç°äº†ç»Ÿä¸€æ¥å£å¹¶ä½¿ç”¨è£…é¥°è€…æ¨¡å¼è¿›è¡Œä¾èµ–ï¼Œå½“ä¸€ä¸ªç±»å¯¹è±¡å¤„ç†å®Œè¯·æ±‚çš„éƒ¨åˆ†åŠŸèƒ½ï¼ˆå¦‚åºåˆ—åŒ–ã€ç¼“å­˜å‘½ä¸­è®¡ç®—ï¼‰åï¼Œå†å°†è‡ªå·±å¤„ç†ä¸äº†çš„éœ€æ±‚é€šè¿‡ delegate å±æ€§ä¼ é€’ä¸‹å»ï¼Œäº¤ç»™å…¶ä»–ç±»è¿›è¡Œå¤„ç†ã€‚</p></blockquote><h3 id="4ã€MyBatis-å®ç°äºŒçº§ç¼“å­˜"><a href="#4ã€MyBatis-å®ç°äºŒçº§ç¼“å­˜" class="headerlink" title="4ã€MyBatis å®ç°äºŒçº§ç¼“å­˜"></a>4ã€MyBatis å®ç°äºŒçº§ç¼“å­˜</h3><blockquote><p>MyBatis æä¾›äº† Cache æ¥å£æ¥å®ç°äºŒçº§ç¼“å­˜ï¼Œå½“æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰äºŒçº§ç¼“å­˜æ—¶ï¼Œå¯ä»¥é€šè¿‡å®ç° Cache æ¥å£æ¥å®ç°ã€‚</p><p>æŸ¥çœ‹ Cache æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Cache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç”¨äºè¿”å›æ­¤ç¼“å­˜çš„æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">String <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * ç”¨äºè®¾ç½®ç¼“å­˜</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">putObject</span><span class="params">(Object key, Object value)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é€šè¿‡keyè·å–ç¼“å­˜</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">Object <span class="title">getObject</span><span class="params">(Object key)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * é€šè¿‡keyç§»é™¤ç¼“å­˜</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">Object <span class="title">removeObject</span><span class="params">(Object key)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * æ¸…é™¤ç¼“å­˜</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è·å–ç¼“å­˜å¤§å°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * è·å–è¯»å†™é”</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function">ReadWriteLock <span class="title">getReadWriteLock</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®ç°äºŒçº§ç¼“å­˜çš„è¿‡ç¨‹ä¸­ï¼Œ MyBatis ä½¿ç”¨äº†è£…é¥°å™¨ + è´£ä»»é“¾æ¨¡å¼ï¼Œæå‡äº†ç¨‹åºçš„æ‰©å±•æ€§å’Œé€»è¾‘æ€§</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710210426.png" alt="image-20210710210426406"></p><blockquote><p>è¿½è¸ªæºç å¯ä»¥çœ‹åˆ°ï¼ŒSynchronizedCache ä¸­å­˜åœ¨ç€ä¸€ä¸ª delegate å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ª LoggingCache å¯¹è±¡ï¼ŒåŒæ—¶ LoggingCache ä¸­åˆæœ‰ä¸€ä¸ª SerializedCache ç±»å‹çš„å±æ€§ delegateâ€¦</p><p>æ¯ä¸ª Cache å¯¹è±¡å¤„ç†å®Œè‡ªå·±çš„å·¥ä½œåï¼Œå°†å¤„ç†ä¸äº†çš„åŠŸèƒ½ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚</p><p>ä½¿ç”¨äº†è´£ä»»é“¾ + è£…é¥°å™¨æ¨¡å¼</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710212027.png" alt="image-20210710212027494"></p><ul><li>ä¸åŒçš„åŠŸèƒ½ç”±ä¸åŒçš„ç¼“å­˜è£…é¥°å™¨å®ç°ï¼Œä¸‹æ ‡æ˜¯è£…é¥°å™¨ç±»ä¸å¯¹åº”åŠŸèƒ½</li></ul><table><thead><tr><th align="center"><strong>è£…é¥°å™¨</strong></th><th align="center"><strong>æè¿°</strong></th></tr></thead><tbody><tr><td align="center">SynchronizedCache</td><td align="center">åŒæ­¥é”ï¼Œç”¨äºä¿è¯å¯¹æŒ‡å®šç¼“å­˜åŒºçš„æ“ä½œéƒ½æ˜¯åŒæ­¥çš„</td></tr><tr><td align="center">LoggingCache</td><td align="center">ç»Ÿè®¡å™¨ï¼Œè®°å½•ç¼“å­˜å‘½ä¸­ç‡</td></tr><tr><td align="center">BlockingCache</td><td align="center">é˜»å¡å™¨ï¼ŒåŸºäºkeyåŠ é”ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€</td></tr><tr><td align="center">ScheduledCache</td><td align="center">æ—¶æ•ˆæ£€æŸ¥ï¼Œç”¨äºéªŒè¯ç¼“å­˜æœ‰æ•ˆå™¨ï¼Œå¹¶æ¸…é™¤æ— æ•ˆæ•°æ®</td></tr><tr><td align="center">LruCache</td><td align="center">æº¢å‡ºç®—æ³•ï¼Œæ·˜æ±°é—²ç½®æœ€ä¹…çš„ç¼“å­˜ã€‚</td></tr><tr><td align="center">FifoCache</td><td align="center">æº¢å‡ºç®—æ³•ï¼Œæ·˜æ±°åŠ å…¥æ—¶é—´æœ€ä¹…çš„ç¼“å­˜</td></tr><tr><td align="center">WeakCache</td><td align="center">æº¢å‡ºç®—æ³•ï¼ŒåŸºäºjavaå¼±å¼•ç”¨è§„åˆ™æ·˜æ±°ç¼“å­˜</td></tr><tr><td align="center">SoftCache</td><td align="center">æº¢å‡ºç®—æ³•ï¼ŒåŸºäºjavaè½¯å¼•ç”¨è§„åˆ™æ·˜æ±°ç¼“å­˜</td></tr><tr><td align="center">PerpetualCache</td><td align="center">å®é™…å­˜å‚¨ï¼Œå†…éƒ¨é‡‡ç”¨HashMapè¿›è¡Œå­˜å‚¨ã€‚</td></tr></tbody></table><h3 id="5ã€ç¼“å­˜å‘½ä¸­æ¡ä»¶"><a href="#5ã€ç¼“å­˜å‘½ä¸­æ¡ä»¶" class="headerlink" title="5ã€ç¼“å­˜å‘½ä¸­æ¡ä»¶"></a>5ã€ç¼“å­˜å‘½ä¸­æ¡ä»¶</h3><blockquote><p>MyBatisä¸€äºŒçº§ç¼“å­˜çš„CacheKeyæ˜¯ä¸€è‡´çš„ï¼Œå¿…é¡»æ»¡è¶³ä»¥æ¡ä»¶æ‰å¯ä»¥å‘½ä¸­ç¼“å­˜</p></blockquote><ol><li>ç›¸åŒçš„statement id</li><li>ç›¸åŒçš„Sqlä¸å‚æ•°</li><li>è¿”å›è¡ŒèŒƒå›´ç›¸åŒ</li><li>æ²¡æœ‰ä½¿ç”¨ResultHandleræ¥è‡ªå®šä¹‰è¿”å›æ•°æ®</li><li>æ²¡æœ‰é…ç½®UseCache=false æ¥å…³é—­ç¼“å­˜</li><li>æ²¡æœ‰é…ç½®FlushCache=true æ¥æ¸…ç©ºç¼“å­˜</li><li>åœ¨è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ä¸­ä¸èƒ½ä½¿ç”¨å‡ºå‚ï¼Œå³Parameterä¸­mode=out|inout</li></ol><h3 id="6ã€äºŒçº§ç¼“å­˜å†™å…¥"><a href="#6ã€äºŒçº§ç¼“å­˜å†™å…¥" class="headerlink" title="6ã€äºŒçº§ç¼“å­˜å†™å…¥"></a>6ã€äºŒçº§ç¼“å­˜å†™å…¥</h3><blockquote><p>ä¸ä¸€çº§ç¼“å­˜çš„å®æ—¶å†™å…¥ä¸åŒï¼Œ<strong>äºŒçº§ç¼“å­˜æ˜¯åœ¨äº‹åŠ¡æäº¤æˆ–ä¼šè¯å…³é—­ä¹‹åæ‰ä¼šè§¦å‘ç¼“å­˜å†™å…¥</strong>ã€‚</p><p>è¿™ä¹ˆåšå…¶å®ä¹Ÿå¥½ç†è§£ï¼Œå› ä¸ºäºŒçº§ç¼“å­˜æ˜¯è·¨ä¼šè¯çš„ï¼Œå¦‚æœæ²¡æœ‰æäº¤å°±å†™å…¥ï¼Œå¦‚æœäº‹åŠ¡æœ€åå›æ»šï¼Œè‚¯å®šå¯¼è‡´åˆ«çš„ä¼šè¯è„è¯»ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710221301.png" alt="image-20210710221301358"></p><blockquote><p>æ¯ä¸€ä¸ªä¼šè¯éƒ½æœ‰è‡ªå·±å¯¹åº”çš„ä¸€å—äº‹åŠ¡ç¼“å­˜ç®¡ç†å™¨ï¼Œç®¡ç†å™¨ä¸­æ‹¥æœ‰è®¸è®¸å¤šå¤šæš‚å­˜åŒºï¼Œåœ¨æŸ¥è¯¢åï¼Œä¼šå…ˆå°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ”¾å…¥æš‚å­˜åŒºä¸­ï¼Œå¦‚æœäº‹åŠ¡æäº¤ï¼Œé‚£ä¹ˆå°†æš‚å­˜åŒºä¸­çš„æ•°æ®æ”¾å…¥å¯¹åº”çš„ç¼“å­˜åŒºä¸­ï¼Œå¦åˆ™å°±ä¸æ”¾å…¥ç¼“å­˜åŒºä¸­ã€‚</p><p>æš‚å­˜åŒº ï¼ˆTransactionalCacheï¼‰ç”¨äºæš‚æ—¶å­˜æ”¾å¾…ç¼“å­˜çš„æ•°æ®åŒºåŸŸï¼Œå’Œç¼“å­˜åŒºæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚å¦‚æœä¼šè¯ä¼šæ¶‰åŠå¤šä¸ªäºŒçº§ç¼“å­˜çš„è®¿é—®ï¼Œé‚£ä¹ˆå¯¹åº”æš‚å­˜åŒºä¹Ÿä¼šæœ‰å¤šä¸ªã€‚æš‚å­˜åŒºç”Ÿå‘½å‘¨æœŸä¸ä¼šè¯ä¿æŒä¸€è‡´ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210710221550.png" alt="image-20210710221550016"></p><h3 id="7ã€äºŒçº§ç¼“å­˜çš„å­˜å–æµç¨‹"><a href="#7ã€äºŒçº§ç¼“å­˜çš„å­˜å–æµç¨‹" class="headerlink" title="7ã€äºŒçº§ç¼“å­˜çš„å­˜å–æµç¨‹"></a>7ã€äºŒçº§ç¼“å­˜çš„å­˜å–æµç¨‹</h3><ul><li>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ MyBatis ä¸­ Executor çš„ä½“ç³»ç»“æ„å›¾</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210711135823.png" alt="image-20210711135816143"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œ CachingExecutor åœ¨ BaseExecutor ä¹‹å‰ï¼Œæ•… MyBatis æ˜¯å…ˆè®¿é—®äºŒçº§ç¼“å­˜ï¼Œåè®¿é—®ä¸€çº§ç¼“å­˜ã€‚</p></blockquote><ul><li>äºŒçº§ç¼“å­˜çš„å­˜å–è¿‡ç¨‹å¦‚ä¸‹å›¾</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210711141426.png" alt="image-20210711141426196"></p><ul><li>æŸ¥è¯¢</li></ul><blockquote><p>å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨äºŒçº§ç¼“å­˜ï¼Œå¦‚æœå­˜åœ¨äºŒçº§ç¼“å­˜ï¼Œé‚£ä¹ˆä»äºŒçº§ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œå¦‚æœä¸å­˜åœ¨äºŒçº§ç¼“å­˜ï¼Œé‚£ä¹ˆ<strong>è°ƒç”¨ BaseExecutor åŠå…¶å­ç±»æŸ¥è¯¢æ•°æ®åº“</strong>ï¼ŒåŒæ—¶<strong>å°†æŸ¥è¯¢åˆ°çš„æ•°æ®å¡«å……åˆ°å¯¹åº”çš„æš‚å­˜åŒºä¸­</strong>ã€‚</p></blockquote><ul><li>ä¿®æ”¹</li></ul><blockquote><p>åœ¨æ‰§è¡Œä¿®æ”¹æ“ä½œæ—¶ï¼Œä¼šé»˜è®¤è°ƒç”¨ <code>flushCacheIfRequired</code> æ–¹æ³•æ¸…ç©ºç¼“å­˜ï¼Œæ³¨æ„ï¼Œè¿™é‡Œæ¸…ç©ºçš„åªæ˜¯æš‚å­˜åŒºï¼Œè€Œä¸æ˜¯çœŸæ­£çš„æ¸…ç©ºäºŒçº§ç¼“å­˜</p><p>çœŸæ­£çš„æ¸…ç©ºå‘ç”Ÿåœ¨äº‹åŠ¡æäº¤åï¼Œæœªæäº¤å‰åªæ˜¯ä»¤äºŒçº§ç¼“å­˜å¤±æ•ˆï¼ŒMyBatis æä¾›äº†ä¸€ä¸ª clearOnCommit æ ‡è®°ï¼Œå½“è¿™ä¸ªå€¼ä¸º true æ—¶ï¼Œæ ‡è®°äºŒçº§ç¼“å­˜æ˜¯å¦å¤±æ•ˆï¼Œå½“è¿™ä¸ªå€¼ä¸º true æ—¶ï¼Œå³ä½¿äºŒçº§ç¼“å­˜ä¸­æœ‰å€¼ï¼Œé‚£ä¹ˆä¹Ÿåªä¼šè¿”å› null</p><p>ä¸‹é¢æ˜¯äºŒçº§ç¼“å­˜ç©ºé—´ç±» TransactionalCache ä¸­çš„ getObject æ–¹æ³•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// issue #116</span></span><br><span class="line">  Object object = delegate.getObject(key);</span><br><span class="line">  <span class="keyword">if</span> (object == <span class="keyword">null</span>) &#123;</span><br><span class="line">    entriesMissedInCache.add(key);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// issue #146  </span></span><br><span class="line">  <span class="keyword">if</span> (clearOnCommit) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœclearOnCommitä¸ºtrueï¼Œç›´æ¥è¿”å› null  </span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æäº¤</li></ul><blockquote><p>åœ¨æäº¤äº‹åŠ¡æ—¶ï¼Œä¼šå°†æš‚å­˜åŒºä¸­çš„ç¼“å­˜ä¿å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­</p></blockquote><h3 id="8ã€æºç åˆ†æ"><a href="#8ã€æºç åˆ†æ" class="headerlink" title="8ã€æºç åˆ†æ"></a>8ã€æºç åˆ†æ</h3><ul><li>CachingExecutor ä¸­çš„ query æ–¹æ³•</li></ul><ol><li>äº‹åŠ¡ç®¡ç†å™¨çš„ getObject æ–¹æ³•éœ€è¦ä¼ å…¥ç¼“å­˜ç©ºé—´å’Œ key</li><li>å¦‚æœä»ç¼“å­˜ä¸­è·å–åˆ°çš„å¯¹è±¡ä¸ºç©ºï¼Œé‚£ä¹ˆè°ƒç”¨ <code>BaseExecutor</code> çš„ query æ–¹æ³•æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ”¾å…¥æš‚å­˜åŒºä¸­</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; <span class="function">List&lt;E&gt; <span class="title">query</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">  Cache cache = ms.getCache();</span><br><span class="line">  <span class="keyword">if</span> (cache != <span class="keyword">null</span>) &#123;</span><br><span class="line">    flushCacheIfRequired(ms);</span><br><span class="line">    <span class="keyword">if</span> (ms.isUseCache() &amp;&amp; resultHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">      ensureNoOutParams(ms, boundSql);</span><br><span class="line">      <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">      <span class="comment">// ä»äº‹åŠ¡ç®¡ç†å™¨ä¸­è·å–ç¼“å­˜ï¼Œè¿™é‡Œéœ€è¦ä¼ å…¥ç¼“å­˜ç©ºé—´ Cache å’Œ ç¼“å­˜å¯¹åº”çš„ key</span></span><br><span class="line">      List&lt;E&gt; list = (List&lt;E&gt;) tcm.getObject(cache, key);</span><br><span class="line">      <span class="keyword">if</span> (list == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä»ç¼“å­˜ä¸­è·å–åˆ°çš„å¯¹è±¡ä¸ºç©ºï¼Œé‚£ä¹ˆè°ƒç”¨ BaseExecutor çš„ query æ–¹æ³•æŸ¥è¯¢æ•°æ®åº“  </span></span><br><span class="line">        list = delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">        <span class="comment">// å°†æŸ¥è¯¢åˆ°çš„æ•°æ®æ”¾å…¥æš‚å­˜åŒºä¸­</span></span><br><span class="line">        tcm.putObject(cache, key, list); <span class="comment">// issue #578 and #116</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœcacheä¸ºç©ºï¼Œé‚£ä¹ˆç›´æ¥æŸ¥è¯¢æ•°æ®åº“  </span></span><br><span class="line">  <span class="keyword">return</span> delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹äº‹åŠ¡ç®¡ç†å™¨ä¸­çš„æºç </li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210711143328.png" alt="image-20210711143328276"></p><blockquote><p>å¯ä»¥çœ‹åˆ°äº‹åŠ¡ç®¡ç†å™¨ä¸­ç»´æŠ¤äº†ä¸€ä¸ª Map ï¼Œè¿™ä¸ª Map ä»¥ Cache å¯¹è±¡ï¼Œå³æš‚å­˜åŒºå¯¹è±¡ä¸ºé”®ï¼ŒäºŒçº§ç¼“å­˜ç©ºé—´ä¸ºå€¼</p><p>è¿™æ ·å¯ä»¥é€šè¿‡æš‚å­˜åŒºå”¯ä¸€æ‰¾åˆ°ä¸€å—äºŒçº§ç¼“å­˜ç©ºé—´</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210711143510.png" alt="image-20210711143510428"></p><ul><li>è¿™å°±æ˜¯å‰é¢æ‰€è®²çš„ï¼Œæ¯ä¸ªæš‚å­˜åŒºå¯¹åº”äºŒçº§ç¼“å­˜ç©ºé—´ä¸­çš„ä¸€å—æŒ‡å®šç©ºé—´ï¼Œåœ¨è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æš‚å­˜åŒºè·å–äºŒçº§ç¼“å­˜ä¸­çš„æŒ‡å®šç©ºé—´</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210711143820.png" alt="image-20210711143820708"></p><h1 id="ä¸‰ã€MyBatis-æ‰§è¡Œæµç¨‹å›é¡¾"><a href="#ä¸‰ã€MyBatis-æ‰§è¡Œæµç¨‹å›é¡¾" class="headerlink" title="ä¸‰ã€MyBatis æ‰§è¡Œæµç¨‹å›é¡¾"></a>ä¸‰ã€MyBatis æ‰§è¡Œæµç¨‹å›é¡¾</h1><blockquote><p>å½“æŸ¥è¯¢ç¼“å­˜æ—¶ï¼Œé‚£ä¹ˆä¸ä¼šä¸ StatementHandler æ‰“äº¤é“</p><p>StatementHandler ç”¨äºä¸ JDBC è¿›è¡Œäº¤äº’ï¼Œå¦‚å£°æ˜ Statement ä¸å¡«å……å‚æ•°ç­‰</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210711150954.png" alt="image-20210711150954577"></p><blockquote><p>ç¬”è®°å‚è€ƒæ¥æºå¦‚ä¸‹ï¼š</p></blockquote><ul><li><p>[1] <a target="_blank" rel="noopener" href="http://coderead.cn/p/mybatis/doc/index.md">æºç é˜…è¯»ç½‘</a></p></li><li><p>[2] <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Tp4y1X7FM?p=19&spm_id_from=pageDriver">MyBatisæºç è§£æå¤§åˆé›†</a></p></li></ul></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>MyBatisæºç å­¦ä¹ ï¼ˆä¸€ï¼‰-æ‰§è¡Œå™¨åŠç¼“å­˜ä»‹ç»</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://sutianxin.top/posts/3708531193.html">https://sutianxin.top/posts/3708531193.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="display:inline-block;width:120px"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>å¤©æ˜•</h></div></div><div class="post-copyright-c" style="display:inline-block;width:120px"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2021-07-11</h></div></div><div class="post-copyright-u" style="display:inline-block;width:120px"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2021-07-11</h></div></div><div class="post-copyright-c" style="display:inline-block;width:120px"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E2%98%95Java/">â˜•Java</a><a class="post-meta__tags" href="/tags/%F0%9F%92%8EMybatis/">ğŸ’Mybatis</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/sutianxin/blogImage/raw/master/20210711221628.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2964295409.html"><img class="prev-cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210715214521.jpg" onerror='onerror=null,src="https://gitee.com/sutianxin/blogImage/raw/master/20210430103138.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">MyBatisæºç å­¦ä¹ ï¼ˆäºŒï¼‰</div></div></a></div><div class="next-post pull-right"><a href="/posts/4204051751.html"><img class="next-cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210615235519.jpg" onerror='onerror=null,src="https://gitee.com/sutianxin/blogImage/raw/master/20210430103138.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">FastDFSçš„å­¦ä¹ ä¸ä½¿ç”¨</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/1128227004.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸ƒï¼‰-å›é¡¾Mybatiså’ŒSpring MVC"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210430102830.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-27</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸ƒï¼‰-å›é¡¾Mybatiså’ŒSpring MVC</div></div></a></div><div><a href="/posts/2091692756.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸€ï¼‰-Mybatis-plusæ¡†æ¶"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210208120043.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-09</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸€ï¼‰-Mybatis-plusæ¡†æ¶</div></div></a></div><div><a href="/posts/3009255528.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸‰ï¼‰-SSMæ¡†æ¶æ•´åˆåŠåŸºæœ¬ä½¿ç”¨"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210208120131.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-31</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆä¸‰ï¼‰-SSMæ¡†æ¶æ•´åˆåŠåŸºæœ¬ä½¿ç”¨</div></div></a></div><div><a href="/posts/2126557972.html" title="åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆä¸€ï¼‰-ä½¿ç”¨MPçš„QueryWrapperè¿›è¡Œè‡ªå®šä¹‰sqlä¸æå‡åµŒå¥—æŸ¥è¯¢æ•ˆç‡ã€‚"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210208115506.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-03</div><div class="title">åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆä¸€ï¼‰-ä½¿ç”¨MPçš„QueryWrapperè¿›è¡Œè‡ªå®šä¹‰sqlä¸æå‡åµŒå¥—æŸ¥è¯¢æ•ˆç‡ã€‚</div></div></a></div><div><a href="/posts/718443640.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆå››ï¼‰-Mybatisæ¡†æ¶å®ç°ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤š"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320145039.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-20</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆå››ï¼‰-Mybatisæ¡†æ¶å®ç°ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤š</div></div></a></div><div><a href="/posts/2964295409.html" title="MyBatisæºç å­¦ä¹ ï¼ˆäºŒï¼‰"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210715214521.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-15</div><div class="title">MyBatisæºç å­¦ä¹ ï¼ˆäºŒï¼‰</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81MyBatis-%E6%89%A7%E8%A1%8C%E5%99%A8"><span class="toc-text">ä¸€ã€MyBatis æ‰§è¡Œå™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E3%80%81JDBC-%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-text">1.1ã€JDBC æ‰§è¡Œè¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-text">1ã€æ‰§è¡Œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81JDBC-%E4%B8%AD%E7%9A%84-Statement"><span class="toc-text">2ã€JDBC ä¸­çš„ Statement</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E3%80%81MyBatis-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%EF%BC%88SqlSession-%E4%B8%8E-Executor%EF%BC%89"><span class="toc-text">1.2ã€MyBatis æ ¸å¿ƒç»„ä»¶ï¼ˆSqlSession ä¸ Executorï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81MyBatis-%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B-%E2%80%93-SQL-%E4%BC%9A%E8%AF%9D%EF%BC%88SqlSession%EF%BC%89"><span class="toc-text">1ã€MyBatis æ‰§è¡Œè¿‡ç¨‹ â€“ SQL ä¼šè¯ï¼ˆSqlSessionï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81MyBatis-%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B-%E2%80%93-%E6%89%A7%E8%A1%8C%E5%99%A8%EF%BC%88Executor%EF%BC%89"><span class="toc-text">2ã€MyBatis æ‰§è¡Œè¿‡ç¨‹ â€“ æ‰§è¡Œå™¨ï¼ˆExecutorï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%89%A7%E8%A1%8C%E5%99%A8%E5%AE%9E%E7%8E%B0-%E2%80%93-%E7%AE%80%E5%8D%95%E6%89%A7%E8%A1%8C%E5%99%A8-SimpleExecutor"><span class="toc-text">3ã€æ‰§è¡Œå™¨å®ç° â€“ ç®€å•æ‰§è¡Œå™¨ SimpleExecutor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%89%A7%E8%A1%8C%E5%99%A8%E5%AE%9E%E7%8E%B0-%E2%80%93-%E5%8F%AF%E9%87%8D%E7%94%A8%E6%89%A7%E8%A1%8C%E5%99%A8-ReuseExecutor"><span class="toc-text">4ã€æ‰§è¡Œå™¨å®ç° â€“ å¯é‡ç”¨æ‰§è¡Œå™¨ ReuseExecutor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%89%A7%E8%A1%8C%E5%99%A8%E5%AE%9E%E7%8E%B0-%E2%80%93-%E6%89%B9%E5%A4%84%E7%90%86%E6%89%A7%E8%A1%8C%E5%99%A8-BatchExecutor"><span class="toc-text">5ã€æ‰§è¡Œå™¨å®ç° â€“ æ‰¹å¤„ç†æ‰§è¡Œå™¨ BatchExecutor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%89%A7%E8%A1%8C%E5%99%A8%E6%8A%BD%E8%B1%A1%E7%B1%BB-%E2%80%93-BaseExecutor"><span class="toc-text">6ã€æ‰§è¡Œå™¨æŠ½è±¡ç±» â€“ BaseExecutor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81MyBatis-%E5%AE%9E%E7%8E%B0%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98-%E2%80%93-CachingExecutor"><span class="toc-text">7ã€MyBatis å®ç°äºŒçº§ç¼“å­˜ â€“ CachingExecutor</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81MyBatis-%E7%9A%84%E7%BC%93%E5%AD%98"><span class="toc-text">äºŒã€MyBatis çš„ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E3%80%81%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">2.1ã€ä¸€çº§ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%AF%B4%E6%98%8E"><span class="toc-text">1ã€è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81MyBatis-%E4%B8%AD%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E7%9A%84%E7%BA%A7%E5%88%AB"><span class="toc-text">2ã€MyBatis ä¸­ä¸€çº§ç¼“å­˜çš„çº§åˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-text">3ã€æºç è§£æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81CacheKey"><span class="toc-text">4ã€CacheKey</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%86%99%E5%85%A5%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">5ã€å†™å…¥ä¸€çº§ç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%B8%85%E7%A9%BA%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">6ã€æ¸…ç©ºä¸€çº§ç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88"><span class="toc-text">7ã€ä¸€çº§ç¼“å­˜å¤±æ•ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E3%80%81%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">2.2ã€äºŒçº§ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%AF%B4%E6%98%8E-1"><span class="toc-text">1ã€è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%AE%BE%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="toc-text">2ã€è®¾ç½®æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E6%89%A9%E5%B1%95%E6%80%A7%E9%9C%80%E6%B1%82"><span class="toc-text">3ã€äºŒçº§ç¼“å­˜æ‰©å±•æ€§éœ€æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%B4%A3%E4%BB%BB%E9%93%BE%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">3ã€è´£ä»»é“¾è®¾è®¡æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81MyBatis-%E5%AE%9E%E7%8E%B0%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">4ã€MyBatis å®ç°äºŒçº§ç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E7%BC%93%E5%AD%98%E5%91%BD%E4%B8%AD%E6%9D%A1%E4%BB%B6"><span class="toc-text">5ã€ç¼“å­˜å‘½ä¸­æ¡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%86%99%E5%85%A5"><span class="toc-text">6ã€äºŒçº§ç¼“å­˜å†™å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E7%9A%84%E5%AD%98%E5%8F%96%E6%B5%81%E7%A8%8B"><span class="toc-text">7ã€äºŒçº§ç¼“å­˜çš„å­˜å–æµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">8ã€æºç åˆ†æ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81MyBatis-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%9E%E9%A1%BE"><span class="toc-text">ä¸‰ã€MyBatis æ‰§è¡Œæµç¨‹å›é¡¾</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 <i style="color:#ff6a6a;animation:announ_animation .8s linear infinite" class="fa fa-heartbeat"></i> å¤©æ˜•</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢!<span id="runtime"></span><br></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo"></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender"></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr"></a><a class="github-badge" target="_blank" href="https://gitee.com/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Picture-Gitee-0cedbe?style=flat&amp;logo=Gitee"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris"></a></p><div id="workboard"></div><script async src="/js/runtime.js"></script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç°¡</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><script defer src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const t=document.getElementById("twikoo-count"),o=()=>{twikoo.init({el:"#twikoo-wrap",envId:"blogcomments-2gseqioe1aa55c8c",region:"ap-shanghai"})},e=()=>{twikoo.getCommentsCount({envId:"blogcomments-2gseqioe1aa55c8c",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then(function(o){t.innerText=o[0].count}).catch(function(o){console.error(o)})};var n;n=!0,"object"==typeof twikoo?(o(),n&&t&&setTimeout(e,0)):getScript("https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(()=>{o(),n&&t&&setTimeout(e,0)})})()</script></div><div class="aplayer no-destroy" data-id="6588965546" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" data-lrctype="0" muted></div><script defer src="/live2d-widget/autoload.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/flipcountdown.js"></script><script data-pjax src="/js/runtime.js"></script><script async src="//at.alicdn.com/t/font_2398185_yegv7kt2bj.js"></script><script src="https://apip.weatherdt.com/simple/static/js/weather-simple-common.js?v=2.0"></script><script src="/js/weather.js"></script><script src="/js/custom/runtime.js"></script><script src="https://cdn.jsdelivr.net/gh/weilain/cdn-photo/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/hidescrollbar/hidescrollbar.js"></script><script async src="//at.alicdn.com/t/font_2398185_lld84dtfbb.js"></script><script src="https://www.luckyclover.top/rain.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/shuoshuo/"]):not([href="/bb/"]):not([href="/contact/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:complete",function(){window.refreshFn(),document.querySelectorAll("script[data-pjax], .pjax-reload script").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()}),document.addEventListener("pjax:send",function(){if("object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")}),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script></div><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.10/hexo_githubcalendar.js"></script><script data-pjax>function GithubCalendarConfig(){var e=document.getElementById("recent-posts");e&&e.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_container"></div></div>'),GithubCalendar("https://python-github-calendar-api.vercel.app/api?sutianxin",["#ebedf0","#f1f8ff","#dbedff","#c8e1ff","#79b8ff","#2188ff","#0366d6","#005cc5","#044289","#032f62","#05264c"],"sutianxin")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:120px}}</style></body></html>