<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Javaåº”ç”¨å­¦ä¹ ï¼ˆåä¸€ï¼‰-Kafka å­¦ä¹ ç¬”è®°äºŒ | Arno</title><meta name="keywords" content="ğŸ“«æ¶ˆæ¯é˜Ÿåˆ—"><meta name="author" content="å¤©æ˜•"><meta name="copyright" content="å¤©æ˜•"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å››ã€Kafka çš„ Java å®¢æˆ·ç«¯4.1ã€ç”Ÿäº§è€…1ã€å¼•å…¥ä¾èµ– kafka-clients çš„ç‰ˆæœ¬å°½é‡ä¸ Linux ä¸Šå®‰è£…çš„ç‰ˆæœ¬ä¸€è‡´  12345&lt;dependency&gt;    &lt;groupId&gt;org.apache.kafka&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;kafka-clients&lt;&#x2F;artifactId&gt;"><meta property="og:type" content="article"><meta property="og:title" content="Javaåº”ç”¨å­¦ä¹ ï¼ˆåä¸€ï¼‰-Kafka å­¦ä¹ ç¬”è®°äºŒ"><meta property="og:url" content="https://sutianxin.top/posts/2701940507.html"><meta property="og:site_name" content="Arno"><meta property="og:description" content="å››ã€Kafka çš„ Java å®¢æˆ·ç«¯4.1ã€ç”Ÿäº§è€…1ã€å¼•å…¥ä¾èµ– kafka-clients çš„ç‰ˆæœ¬å°½é‡ä¸ Linux ä¸Šå®‰è£…çš„ç‰ˆæœ¬ä¸€è‡´  12345&lt;dependency&gt;    &lt;groupId&gt;org.apache.kafka&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;kafka-clients&lt;&#x2F;artifactId&gt;"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012235444.jpg"><meta property="article:published_time" content="2021-10-12T15:45:23.000Z"><meta property="article:modified_time" content="2021-10-12T15:57:38.459Z"><meta property="article:author" content="å¤©æ˜•"><meta property="article:tag" content="ğŸ“«æ¶ˆæ¯é˜Ÿåˆ—"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012235444.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://sutianxin.top/posts/2701940507"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"å¤©",date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"mediumZoom",Snackbar:{chs_to_cht:"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“",cht_to_chs:"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“",day_to_night:"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#49b1f5",bgDark:"#121212",position:"top-right"},source:{jQuery:"https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-10-12 23:57:38"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,a={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(a)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme");"dark"===e?activateDarkMode():"light"===e&&activateLightMode();e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"))})(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_1.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/hidescrollbar/hidescrollbar.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_2.css"><link rel="stylesheet" href="/css/cover.css"><link rel="stylesheet" href="/css/copyright.css"><link href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/flipcountdown.css"><link rel="stylesheet" href="/css/year.css"><link rel="stylesheet" href="/css/Lete.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/PaddyLin-xum/wenjian@master/css/fontanimation.css"><link href="https://cdn.bootcdn.net/ajax/libs/botui/0.3.9/botui-theme-default.css" rel="stylesheet"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/twikoo.css"><style>#article-container.post-content h1:before,h2:before,h3:before,h4:before,h5:before,h6:before{-webkit-animation:avatar_turn_around 1s linear infinite;-moz-animation:avatar_turn_around 1s linear infinite;-o-animation:avatar_turn_around 1s linear infinite;-ms-animation:avatar_turn_around 1s linear infinite;animation:avatar_turn_around 1s linear infinite}</style><link rel="stylesheet" href="/css/font.css" media="defer" onload='this.media="all"'><meta name="generator" content="Hexo 5.4.0"></head><body><a href="javascript:void(0);" onclick="preloader.endLoading()" title="ç‚¹å‡»è·³è¿‡åŠ¨ç”»"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div></a><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">85</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">12</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gucheng"></use></svg><span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu1"></use></svg><span>æ–‡ç« </span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu"></use></svg><span>å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guwan"></use></svg><span>æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gujianzhu-01"></use></svg><span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofengwenfangsibaoyantaimoyan_huaban_huaban"></use></svg><span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-red_envelope"></use></svg><span>æ‹“å±•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/random/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingbaozhu"></use></svg><span>éšæœºæ–‡ç« </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/adjust/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingguadeng"></use></svg><span>æ›´æ¢èƒŒæ™¯</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/statistics/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingjiutan"></use></svg><span>æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://sutianxin.gitee.io"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhongguojie"></use></svg><span>å›½å†…é•œåƒ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhuzi"></use></svg><span>å¯¼èˆªæ </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bb/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxinghulu"></use></svg><span>å“”å“”</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingshanzi"></use></svg><span>éŸ³ä¹</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaiqiwujiuqijue_huaban_huaban"></use></svg><span>ç¤¾äº¤</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqixun_huaban_huaban_huaban"></use></svg><span>å‹é“¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqibianzhong_huaban_huaban_huaban_huaban"></use></svg><span>æœ‹å‹åœˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guqin"></use></svg><span>å…³äºæˆ‘</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://gitee.com/sutianxin/blogImage/raw/master/img/20211012235444.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Arno</a></span><span id="weather-v2-plugin-simple"></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gucheng"></use></svg><span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu1"></use></svg><span>æ–‡ç« </span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gushu"></use></svg><span>å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guwan"></use></svg><span>æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gujianzhu-01"></use></svg><span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofengwenfangsibaoyantaimoyan_huaban_huaban"></use></svg><span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-red_envelope"></use></svg><span>æ‹“å±•</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/random/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingbaozhu"></use></svg><span>éšæœºæ–‡ç« </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/adjust/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingguadeng"></use></svg><span>æ›´æ¢èƒŒæ™¯</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/statistics/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingjiutan"></use></svg><span>æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://sutianxin.gitee.io"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhongguojie"></use></svg><span>å›½å†…é•œåƒ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingzhuzi"></use></svg><span>å¯¼èˆªæ </span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bb/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxinghulu"></use></svg><span>å“”å“”</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xianxingshanzi"></use></svg><span>éŸ³ä¹</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaiqiwujiuqijue_huaban_huaban"></use></svg><span>ç¤¾äº¤</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqixun_huaban_huaban_huaban"></use></svg><span>å‹é“¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-gufengwujianzhongguofenggudaileqibianzhong_huaban_huaban_huaban_huaban"></use></svg><span>æœ‹å‹åœˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guqin"></use></svg><span>å…³äºæˆ‘</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Javaåº”ç”¨å­¦ä¹ ï¼ˆåä¸€ï¼‰-Kafka å­¦ä¹ ç¬”è®°äºŒ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-10-12T15:45:23.000Z" title="å‘è¡¨äº 2021-10-12 23:45:23">2021-10-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-10-12T15:57:38.459Z" title="æ›´æ–°äº 2021-10-12 23:57:38">2021-10-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/">æ¡†æ¶å­¦ä¹ </a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">12k</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="å››ã€Kafka-çš„-Java-å®¢æˆ·ç«¯"><a href="#å››ã€Kafka-çš„-Java-å®¢æˆ·ç«¯" class="headerlink" title="å››ã€Kafka çš„ Java å®¢æˆ·ç«¯"></a>å››ã€Kafka çš„ Java å®¢æˆ·ç«¯</h1><h2 id="4-1ã€ç”Ÿäº§è€…"><a href="#4-1ã€ç”Ÿäº§è€…" class="headerlink" title="4.1ã€ç”Ÿäº§è€…"></a>4.1ã€ç”Ÿäº§è€…</h2><h3 id="1ã€å¼•å…¥ä¾èµ–"><a href="#1ã€å¼•å…¥ä¾èµ–" class="headerlink" title="1ã€å¼•å…¥ä¾èµ–"></a>1ã€å¼•å…¥ä¾èµ–</h3><blockquote><p>kafka-clients çš„ç‰ˆæœ¬å°½é‡ä¸ Linux ä¸Šå®‰è£…çš„ç‰ˆæœ¬ä¸€è‡´</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;$&#123;kafka.version&#125;&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h3 id="2ã€åŸºæœ¬å®ç°"><a href="#2ã€åŸºæœ¬å®ç°" class="headerlink" title="2ã€åŸºæœ¬å®ç°"></a>2ã€åŸºæœ¬å®ç°</h3><ul><li>åˆ›å»ºä¸€ä¸ªé™æ€å¸¸é‡ï¼Œç”¨äºæŒ‡å®šä¸»é¢˜åç§°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»é¢˜åç§°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">&quot;my-replicated-topic&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰ä¸€ä¸ª Order ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> orderId;</span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ª Properties å¯¹è±¡ï¼Œåœ¨å…¶ä¸­è®¾ç½®é…ç½®å±æ€§çš„å€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1 åˆ›å»ºä¸€ä¸ª Properties å¯¹è±¡ï¼Œè®¾ç½®å±æ€§å€¼</span></span><br><span class="line">Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line"><span class="comment">//2 è®¾ç½® Kafka Server çš„ IP åœ°å€å’Œç«¯å£å·</span></span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯ Kafka é›†ç¾¤ï¼Œé‚£ä¹ˆå¤šä¸ª IP:port ä¹‹é—´ä½¿ç”¨ &quot;,&quot; åˆ†å¼€</span></span><br><span class="line">properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">&quot;120.78.198.32:9092&quot;</span>);</span><br><span class="line"><span class="comment">//3 å°†å¾…å‘é€çš„ key ä»å­—ç¬¦ä¸²åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line"><span class="comment">//4 æŠŠå‘é€æ¶ˆæ¯ value ä»å­—ç¬¦ä¸²åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œéœ€è¦ä¼ å…¥ä¸Šé¢å®šä¹‰çš„ Properties å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5 åˆ›å»ºä¸€ä¸ª Producer å¯¹è±¡ï¼Œä¼ å…¥ä¸Šé¢å®šä¹‰çš„ Properties å¯¹è±¡</span></span><br><span class="line">Producer&lt;String, String&gt; producer = <span class="keyword">new</span> KafkaProducer&lt;&gt;(properties);</span><br></pre></td></tr></table></figure><ul><li>å®šä¹‰ä¸€æ¡æ¶ˆæ¯å¯¹è±¡</li></ul><blockquote><p>åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥ä¸ä¼ å…¥ key ï¼Œå‘å‡ºçš„æ¶ˆæ¯æ˜¯ order å¯¹è±¡çš„å­—ç¬¦ä¸²å½¢å¼ï¼Œè€Œkey çš„ä½œç”¨æ˜¯ç”¨æ¥å‘Šè¯‰ Kafka å¾€å“ªä¸ªåˆ†åŒºä¸Šå‘é€æ¶ˆæ¯ï¼Œå…·ä½“å‘é€åˆ†åŒºçš„è®¡ç®—å…¬å¼æ˜¯ï¼šhash(key) % åˆ†åŒºæ•°ç›®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//6 åˆ›å»ºä¸€ä¸ª Order å¯¹è±¡</span></span><br><span class="line">Order order = <span class="keyword">new</span> Order(<span class="number">1</span>, <span class="string">&quot;å•†å“å...&quot;</span>);</span><br><span class="line"><span class="comment">//7 æ„é€ ä¸€ä¸ª ProducerRecord å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æˆ‘ä»¬è¦å‘é€çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">// key çš„ä½œç”¨æ˜¯ç”¨æ¥å‘Šè¯‰ Kafka å¾€å“ªä¸ªåˆ†åŒºä¸Šå‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">// å…·ä½“å‘é€åˆ†åŒºçš„è®¡ç®—å…¬å¼æ˜¯ï¼šhash(key) % åˆ†åŒºæ•°ç›®</span></span><br><span class="line">ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(TOPIC_NAME, order.getOrderId() + <span class="string">&quot;&quot;</span>, JSON.toJSONString(order));</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨åŒæ­¥é˜»å¡çš„æ–¹å¼å‘é€æ¶ˆæ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8 ä½¿ç”¨ Producer çš„ send æ–¹æ³•å‘é€æ•°æ®</span></span><br><span class="line"><span class="comment">// ç­‰å¾…æ¶ˆæ¯å‘é€æˆåŠŸçš„åŒæ­¥é˜»å¡æ–¹æ³•</span></span><br><span class="line">RecordMetadata recordMetadata = producer.send(record).get();</span><br></pre></td></tr></table></figure><ul><li>æ‰“å°ç»“æœ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;åŒæ­¥æ–¹å¼å‘é€æ¶ˆæ¯ç»“æœ: topic-&quot;</span> + recordMetadata.topic() + <span class="string">&quot;|partition-&quot;</span> + recordMetadata.partition() + <span class="string">&quot;|offset-&quot;</span> + recordMetadata.offset());</span><br></pre></td></tr></table></figure><blockquote><p>å…¨éƒ¨ä»£ç å¦‚ä¸‹</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»é¢˜åç§°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">&quot;my-replicated-topic&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//1 åˆ›å»ºä¸€ä¸ª Properties å¯¹è±¡ï¼Œè®¾ç½®å±æ€§å€¼</span></span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    <span class="comment">//2 è®¾ç½® Kafka Server çš„ IP åœ°å€å’Œç«¯å£å·</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ Kafka é›†ç¾¤ï¼Œé‚£ä¹ˆå¤šä¸ª IP:port ä¹‹é—´ä½¿ç”¨ &quot;,&quot; åˆ†å¼€</span></span><br><span class="line">    properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">&quot;120.78.198.32:9092&quot;</span>);</span><br><span class="line">    <span class="comment">//3 å°†å¾…å‘é€çš„ key ä»å­—ç¬¦ä¸²åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">    <span class="comment">//4 æŠŠå‘é€æ¶ˆæ¯ value ä»å­—ç¬¦ä¸²åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">    <span class="comment">//5 åˆ›å»ºä¸€ä¸ª Producer å¯¹è±¡ï¼Œä¼ å…¥ä¸Šé¢å®šä¹‰çš„ Properties å¯¹è±¡</span></span><br><span class="line">    Producer&lt;String, String&gt; producer = <span class="keyword">new</span> KafkaProducer&lt;&gt;(properties);</span><br><span class="line">    <span class="comment">//6 åˆ›å»ºä¸€ä¸ª Order å¯¹è±¡</span></span><br><span class="line">    Order order = <span class="keyword">new</span> Order(<span class="number">1</span>, <span class="string">&quot;å•†å“å...&quot;</span>);</span><br><span class="line">    <span class="comment">//7 æ„é€ ä¸€ä¸ª ProducerRecord å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æˆ‘ä»¬è¦å‘é€çš„æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// key çš„ä½œç”¨æ˜¯ç”¨æ¥å‘Šè¯‰ Kafka å¾€å“ªä¸ªåˆ†åŒºä¸Šå‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// å…·ä½“å‘é€åˆ†åŒºçš„è®¡ç®—å…¬å¼æ˜¯ï¼šhash(key) % åˆ†åŒºæ•°ç›®</span></span><br><span class="line">    ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(TOPIC_NAME, order.getOrderId() + <span class="string">&quot;&quot;</span>, JSON.toJSONString(order));</span><br><span class="line">    <span class="comment">//8 ä½¿ç”¨ Producer çš„ send æ–¹æ³•å‘é€æ•°æ®</span></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ¶ˆæ¯å‘é€æˆåŠŸçš„åŒæ­¥é˜»å¡æ–¹æ³•</span></span><br><span class="line">    RecordMetadata recordMetadata = producer.send(record).get();</span><br><span class="line">    System.out.println(<span class="string">&quot;åŒæ­¥æ–¹å¼å‘é€æ¶ˆæ¯ç»“æœ: topic-&quot;</span> + recordMetadata.topic() + <span class="string">&quot;|partition-&quot;</span> + recordMetadata.partition() + <span class="string">&quot;|offset-&quot;</span> + recordMetadata.offset());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šåˆ†åŒºä¸Š"><a href="#3ã€å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šåˆ†åŒºä¸Š" class="headerlink" title="3ã€å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šåˆ†åŒºä¸Š"></a>3ã€å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šåˆ†åŒºä¸Š</h3><blockquote><p>åœ¨åˆ›å»º ProducerRecord å¯¹è±¡æ—¶ï¼Œå¾€æ„é€ æ–¹æ³•ä¸­ä¼ å…¥è¦å‘é€çš„åˆ†åŒºä¸Š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProducerRecord&lt;String, String&gt; record = <span class="keyword">new</span> ProducerRecord&lt;&gt;(TOPIC_NAME, <span class="number">0</span>,order.getOrderId() + <span class="string">&quot;&quot;</span>, JSON.toJSONString(order));</span><br></pre></td></tr></table></figure><h3 id="4ã€åŒæ­¥å‘é€"><a href="#4ã€åŒæ­¥å‘é€" class="headerlink" title="4ã€åŒæ­¥å‘é€"></a>4ã€åŒæ­¥å‘é€</h3><blockquote><p>â½£äº§è€…åŒæ­¥å‘æ¶ˆæ¯ï¼Œåœ¨æ”¶åˆ° kafka çš„ ack å‘ŠçŸ¥å‘é€æˆåŠŸä¹‹å‰â¼€ç›´å¤„äºé˜»å¡çŠ¶æ€</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//8 ä½¿ç”¨ Producer çš„ send æ–¹æ³•å‘é€æ•°æ®</span></span><br><span class="line"><span class="comment">// ç­‰å¾…æ¶ˆæ¯å‘é€æˆåŠŸçš„åŒæ­¥é˜»å¡æ–¹æ³•</span></span><br><span class="line">RecordMetadata recordMetadata = producer.send(record).get();</span><br><span class="line">System.out.println(<span class="string">&quot;åŒæ­¥æ–¹å¼å‘é€æ¶ˆæ¯ç»“æœ: topic-&quot;</span> + recordMetadata.topic() + <span class="string">&quot;|partition-&quot;</span> + recordMetadata.partition() + <span class="string">&quot;|offset-&quot;</span> + recordMetadata.offset());</span><br></pre></td></tr></table></figure><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211010222633.png" alt="image-20211010222633539"></p><h3 id="5ã€å¼‚æ­¥å‘æ¶ˆæ¯"><a href="#5ã€å¼‚æ­¥å‘æ¶ˆæ¯" class="headerlink" title="5ã€å¼‚æ­¥å‘æ¶ˆæ¯"></a>5ã€å¼‚æ­¥å‘æ¶ˆæ¯</h3><blockquote><p>â½£äº§è€…å‘æ¶ˆæ¯ï¼Œå‘é€å®Œåä¸â½¤ç­‰å¾… broker ç»™å›å¤ï¼Œç›´æ¥æ‰§â¾ä¸‹â¾¯çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p>å¯ä»¥æä¾› <code>callback</code> ï¼Œè®© broker å¼‚æ­¥çš„è°ƒâ½¤ callbackï¼Œå‘ŠçŸ¥â½£äº§è€…ï¼Œæ¶ˆæ¯å‘é€çš„ç»“æœ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//9 å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line">producer.send(record, <span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompletion</span><span class="params">(RecordMetadata recordMetadata, Exception e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å¤±è´¥:&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (recordMetadata != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å¼‚æ­¥â½…å¼å‘é€æ¶ˆæ¯ç»“æœï¼š&quot;</span>+<span class="string">&quot;topic-&quot;</span>+ recordMetadata.topic()+<span class="string">&quot;|partition-&quot;</span>+recordMetadata.partition()+<span class="string">&quot;|offset-&quot;</span>+recordMetadata.offset());            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="6ã€å…³äºç”Ÿäº§è€…çš„-ACK-å‚æ•°é…ç½®"><a href="#6ã€å…³äºç”Ÿäº§è€…çš„-ACK-å‚æ•°é…ç½®" class="headerlink" title="6ã€å…³äºç”Ÿäº§è€…çš„ ACK å‚æ•°é…ç½®"></a>6ã€å…³äºç”Ÿäº§è€…çš„ ACK å‚æ•°é…ç½®</h3><blockquote><p>åœ¨åŒæ­¥å‘æ¶ˆæ¯çš„åœºæ™¯ä¸‹ï¼šâ½£äº§è€…å‘åŠ¨ broker ä¸Šåï¼Œack ä¼šæœ‰3ç§ä¸åŒçš„é€‰æ‹©ï¼š</p></blockquote><ul><li><code>acks = 0</code></li></ul><blockquote><p>è¡¨ç¤º producer ä¸éœ€è¦ç­‰å¾…ä»»ä½• broker ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯çš„å›å¤ï¼Œå°±å¯ä»¥ç»§ç»­å‘é€ä¸‹â¼€æ¡æ¶ˆæ¯ã€‚æ€§èƒ½æœ€â¾¼ï¼Œä½†æ˜¯æœ€å®¹æ˜“ä¸¢æ¶ˆæ¯ã€‚</p></blockquote><ul><li><code>acks = 1</code>ï¼ˆé»˜è®¤ï¼‰</li></ul><blockquote><p>â¾„å°‘è¦ç­‰å¾… <code>leader</code> å·²ç»æˆåŠŸå°†æ•°æ®å†™â¼Šæœ¬åœ° logï¼Œä½†æ˜¯ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰ <code>follower</code> æ˜¯å¦æˆåŠŸå†™â¼Šã€‚å°±å¯ä»¥ç»§ç»­å‘é€ä¸‹â¼€æ¡æ¶ˆæ¯ã€‚</p><p><strong>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ <code>follower</code> æ²¡æœ‰æˆåŠŸå¤‡ä»½æ•°æ®ï¼Œâ½½æ­¤æ—¶ <code>leader</code> â¼œæŒ‚æ‰ï¼Œåˆ™æ¶ˆæ¯ä¼šä¸¢å¤±</strong>ã€‚</p></blockquote><ul><li><code>acks = -1</code> æˆ– <code>all</code></li></ul><blockquote><p>éœ€è¦ç­‰å¾… <code>min.insync.replicas</code> (é»˜è®¤ä¸º1ï¼Œæ¨èé…ç½®â¼¤äºç­‰äº2)è¿™ä¸ªå‚æ•°é…ç½®çš„å‰¯æœ¬ä¸ªæ•°éƒ½æˆåŠŸå†™â¼Šâ½‡å¿—ï¼Œ<strong>è¿™ç§ç­–ç•¥ä¼šä¿è¯åªè¦æœ‰â¼€ä¸ªå¤‡ä»½å­˜æ´»å°±ä¸ä¼šä¸¢å¤±æ•°æ®</strong>ã€‚</p></blockquote><ol><li><strong>è¿™æ˜¯æœ€å¼ºçš„æ•°æ®ä¿è¯</strong>ã€‚</li><li>â¼€èˆ¬é™¤â¾®æ˜¯â¾¦èçº§åˆ«ï¼Œæˆ–è·Ÿé’±æ‰“äº¤é“çš„åœºæ™¯æ‰ä¼šä½¿â½¤è¿™ç§é…ç½®ã€‚</li></ol><ul><li>å¦‚ä½•è®¾ç½®ï¼Ÿ</li></ul><blockquote><p>åœ¨ Properties å¯¹è±¡ä¸­æŒ‡å®šé…ç½®çš„å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.put(ProducerConfig.ACKS_CONFIG,<span class="string">&quot;1&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="9ã€å…¶ä»–ç»†èŠ‚"><a href="#9ã€å…¶ä»–ç»†èŠ‚" class="headerlink" title="9ã€å…¶ä»–ç»†èŠ‚"></a>9ã€å…¶ä»–ç»†èŠ‚</h3><ul><li>å‘é€ä¼šé»˜è®¤ä¼šé‡è¯• 3 æ¬¡ï¼Œæ¯æ¬¡é—´éš” 100ms</li><li><strong>å‘é€çš„æ¶ˆæ¯ä¼šå…ˆè¿›â¼Šåˆ°æœ¬åœ°ç¼“å†²åŒºï¼ˆ32mbï¼‰ï¼Œkakfa ä¼šè·‘â¼€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å»ç¼“å†²åŒºä¸­<br>å– 16k çš„æ•°æ®ï¼Œå‘é€åˆ°kafkaï¼Œå¦‚æœåˆ°10æ¯«ç§’æ•°æ®æ²¡å–æ»¡16kï¼Œä¹Ÿä¼šå‘é€â¼€æ¬¡</strong>ã€‚</li></ul><blockquote><p>å‘é€æ¶ˆæ¯æ—¶ä¸æ˜¯ä¸€æ¡æ¶ˆæ¯å»ºç«‹ä¸€æ¬¡è¿æ¥ã€å‘é€ä¸€æ¬¡ï¼Œè€Œæ˜¯å…ˆå­˜åœ¨ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼Œç„¶åå¦èµ·ä¸€ä¸ªçº¿ç¨‹å»å‘é€æ¶ˆæ¯ï¼ˆä¸€æ¬¡å‘é€ 16k ï¼‰</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211010234216.png" alt="image-20211010234216403"></p><ul><li>è¿™ä¸¤ä¸ªé…ç½®å¯ä»¥åœ¨ç”Ÿäº§è€…ä¸­é…ç½®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é…ç½®ç”Ÿäº§è€…æœ¬åœ°ç¼“å†²åŒºå¤§å°,33554432 å³ 32 M</span></span><br><span class="line">properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG, <span class="number">33554432</span>);</span><br><span class="line"><span class="comment">//é…ç½®ç”Ÿäº§è€…æ‰¹é‡å‘é€æ¶ˆæ¯çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 16 kï¼Œå³ 16384</span></span><br><span class="line">properties.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="number">16384</span>);</span><br></pre></td></tr></table></figure><h2 id="4-2ã€æ¶ˆè´¹è€…"><a href="#4-2ã€æ¶ˆè´¹è€…" class="headerlink" title="4.2ã€æ¶ˆè´¹è€…"></a>4.2ã€æ¶ˆè´¹è€…</h2><h3 id="1ã€åŸºæœ¬å®ç°"><a href="#1ã€åŸºæœ¬å®ç°" class="headerlink" title="1ã€åŸºæœ¬å®ç°"></a>1ã€åŸºæœ¬å®ç°</h3><ul><li>åˆ›å»ºä¸¤ä¸ªå¸¸é‡ï¼Œç”¨äºæŒ‡å®šä¸»é¢˜åå’Œæ¶ˆè´¹ç»„å</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»é¢˜åç§°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">&quot;my-replicated-topic&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…ç»„å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONSUMER_GROUP_NAME = <span class="string">&quot;testGroup&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ª Properties å¯¹è±¡ï¼Œè®¾ç½®é…ç½®å€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">&quot;&quot;</span>);</span><br><span class="line">properties.put(ConsumerConfig.GROUP_ID_CONFIG, CONSUMER_GROUP_NAME);</span><br><span class="line"><span class="comment">// é…ç½®é”®å’Œå€¼çš„åºåˆ—å·å™¨</span></span><br><span class="line">properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ª KafkaConsumer æ¶ˆè´¹è€…å¯¹è±¡ï¼Œä¼ å…¥ä¸Šé¢å®šä¹‰çš„ Properties å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…å¯¹è±¡ï¼Œä¼ å…¥ Properties å¯¹è±¡</span></span><br><span class="line">KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(properties);</span><br></pre></td></tr></table></figure><ul><li>ä»¤æ¶ˆè´¹è€…å¯¹è±¡è®¢é˜…ä¸»é¢˜åˆ—è¡¨</li></ul><blockquote><p>ä¸€ä¸ªæ¶ˆè´¹è€…å…¶å®å¯ä»¥æ¶ˆè´¹å¤šä¸ªä¸»é¢˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¶ˆè´¹è€…å¯¹è±¡è®¢é˜…ä¸»é¢˜åˆ—è¡¨</span></span><br><span class="line">consumer.subscribe(Collections.singletonList(TOPIC_NAME));</span><br></pre></td></tr></table></figure><ul><li>è¿›è¡Œæ¶ˆæ¯æ‹‰å–</li></ul><blockquote><p>ä½¿ç”¨æ¶ˆè´¹è€…çš„ poll() æ–¹æ³•å¯¹æ¶ˆæ¯è¿›è¡Œé•¿è½®è¯¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * poll() API æ˜¯æ‹‰å–æ¶ˆæ¯çš„é•¿è½®è¯¢</span></span><br><span class="line"><span class="comment">     * åœ¨ 1000 ms å†…æ‹‰å–è¿‡æ¥çš„æ¶ˆæ¯éƒ½ä¼šæ”¾åœ¨ ConsumerRecords åˆ—è¡¨ä¸­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1000</span>));</span><br><span class="line">    <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼špartition = %d,offset = %d, key = %s, value = %s%n&quot;</span>, record.partition(),</span><br><span class="line">        record.offset(), record.key(), record.value());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ‰€æœ‰ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸»é¢˜åç§°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">&quot;my-replicated-topic&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¶ˆè´¹è€…ç»„å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONSUMER_GROUP_NAME = <span class="string">&quot;testGroup&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    properties.put(ConsumerConfig.GROUP_ID_CONFIG, CONSUMER_GROUP_NAME);</span><br><span class="line">    <span class="comment">// é…ç½®é”®å’Œå€¼çš„åºåˆ—å·å™¨</span></span><br><span class="line">    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…å¯¹è±¡ï¼Œä¼ å…¥ Properties å¯¹è±¡</span></span><br><span class="line">    KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> KafkaConsumer&lt;&gt;(properties);</span><br><span class="line">    <span class="comment">// æ¶ˆè´¹è€…å¯¹è±¡è®¢é˜…ä¸»é¢˜åˆ—è¡¨</span></span><br><span class="line">    consumer.subscribe(Collections.singletonList(TOPIC_NAME));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * poll() API æ˜¯æ‹‰å–æ¶ˆæ¯çš„é•¿è½®è¯¢</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1000</span>));</span><br><span class="line">        <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;æ”¶åˆ°æ¶ˆæ¯ï¼špartition = %d,offset = %d, key = %s, value = %s%n&quot;</span>, record.partition(),</span><br><span class="line">            record.offset(), record.key(), record.value());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€Kafka-æ¶ˆè´¹è€…-offset-çš„è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤"><a href="#2ã€Kafka-æ¶ˆè´¹è€…-offset-çš„è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤" class="headerlink" title="2ã€Kafka æ¶ˆè´¹è€… offset çš„è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤"></a>2ã€Kafka æ¶ˆè´¹è€… offset çš„è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤</h3><blockquote><p>åœ¨æ¶ˆè´¹è€…å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹æ—¶ï¼Œéœ€è¦å‘ Kafka æäº¤ offset ï¼Œæœ‰è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤ä¸¤ç§æ¨¡å¼</p><p>æ— è®ºæ˜¯è‡ªåŠ¨æäº¤è¿˜æ˜¯æ‰‹åŠ¨æäº¤ï¼Œéƒ½éœ€è¦æŠŠæ‰€å±çš„æ¶ˆè´¹ç»„ + æ¶ˆè´¹çš„æŸä¸ªä¸»é¢˜ + æ¶ˆè´¹çš„æŸä¸ªåˆ†åŒºåŠæ¶ˆè´¹çš„åç§»é‡ï¼Œè¿™æ ·çš„ä¿¡æ¯æäº¤åˆ°é›†ç¾¤çš„ <code>_comsumer_offsets</code> ä¸»é¢˜ä¸­</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211011225954.png" alt="image-20211011103251825"></p><ul><li>offset çš„è‡ªåŠ¨æäº¤ï¼ˆé»˜è®¤ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ˜¯å¦â¾ƒåŠ¨æäº¤offsetï¼Œé»˜è®¤å°±æ˜¯true</span></span><br><span class="line">props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"><span class="comment">// â¾ƒåŠ¨æäº¤offsetçš„é—´éš”æ—¶é—´</span></span><br><span class="line">props.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, <span class="string">&quot;1000&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>æ¶ˆè´¹è€… poll åˆ°æ¶ˆæ¯åï¼Œä¼šè‡ªåŠ¨å‘ Broker çš„ <code>_comsumer_offsets</code> ä¸»é¢˜æäº¤å½“å‰ä¸»é¢˜ - åˆ†åŒºæ¶ˆè´¹çš„åç§»é‡ã€‚</p><p><strong>è‡ªåŠ¨æäº¤å¯èƒ½å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±</strong>ï¼Œå› ä¸ºæ¶ˆè´¹è€…å¯èƒ½ä¸€æ¬¡æ€§ poll ä¸‹æ¥å¤šæ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…è¿˜æ²¡æ¶ˆè´¹ poll ä¸‹æ¥çš„æ¶ˆæ¯å°±è‡ªåŠ¨æäº¤äº†åç§»é‡ï¼Œ<strong>å¦‚æœæ¶ˆè´¹è€…åœ¨æ²¡æœ‰å®Œå…¨æ¶ˆè´¹ poll ä¸‹æ¥çš„æ¶ˆæ¯å‰å°±æŒ‚äº†ï¼Œé‚£ä¹ˆé‚£ä¸€éƒ¨åˆ†å·²ç» poll ä¸‹æ¥ä½†è¿˜æ²¡æœ‰æ¶ˆè´¹å®Œçš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±</strong>ï¼Œä¸‹ä¸€ä¸ªæ¶ˆè´¹è€…ä¼šä»å·²æäº¤çš„ offset çš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹æ¶ˆè´¹æ¶ˆæ¯ã€‚</p></blockquote><ul><li>offset çš„æ‰‹åŠ¨æäº¤</li></ul><blockquote><p>åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ / åå†æäº¤ offset</p></blockquote><ol><li>è®¾ç½®æ‰‹åŠ¨æäº¤å‚æ•°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="string">&quot;false&quot;</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨æ¶ˆè´¹å®Œæ¶ˆæ¯åè¿›è¡Œæ‰‹åŠ¨æäº¤ï¼ˆæ‰‹åŠ¨æäº¤ offset åˆåˆ†ä¸ºæ‰‹åŠ¨åŒæ­¥æäº¤å’Œæ‰‹åŠ¨å¼‚æ­¥æäº¤ï¼‰</li></ol><blockquote><p>æ‰‹åŠ¨åŒæ­¥æäº¤</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (records.count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨åŒæ­¥æäº¤ offset ï¼Œå½“å‰çº¿ç¨‹ä¼šé˜»å¡ç›´åˆ° offset æäº¤æˆåŠŸ</span></span><br><span class="line">    <span class="comment">// ä¸€èˆ¬ä½¿ç”¨åŒæ­¥æäº¤ï¼Œå› ä¸ºæäº¤ä¹‹åä¸€èˆ¬ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé€»è¾‘ä»£ç äº†</span></span><br><span class="line">    consumer.commitSync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰‹åŠ¨å¼‚æ­¥æäº¤ï¼Œå®šä¹‰ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œ Kafka é›†ç¾¤ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•é€šçŸ¥æ‰‹åŠ¨æäº¤æ˜¯å¦æˆåŠŸ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (records.count() &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// â¼¿åŠ¨å¼‚æ­¥æäº¤offsetï¼Œå½“å‰çº¿ç¨‹æäº¤offsetä¸ä¼šé˜»å¡ï¼Œå¯ä»¥ç»§ç»­å¤„ç†åâ¾¯çš„ç¨‹åºé€»è¾‘</span></span><br><span class="line">    consumer.commitAsync((offsets, exception) -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (exception != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Commit failed for &quot;</span> + offsets);</span><br><span class="line">            System.err.println(<span class="string">&quot;Commit failed exception: &quot;</span> + exception.getStackTrace());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€æ¶ˆè´¹è€…-poll-æ¶ˆæ¯çš„è¿‡ç¨‹"><a href="#3ã€æ¶ˆè´¹è€…-poll-æ¶ˆæ¯çš„è¿‡ç¨‹" class="headerlink" title="3ã€æ¶ˆè´¹è€… poll æ¶ˆæ¯çš„è¿‡ç¨‹"></a>3ã€æ¶ˆè´¹è€… poll æ¶ˆæ¯çš„è¿‡ç¨‹</h3><ul><li>æ¶ˆè´¹è€…å»ºç«‹ä¸ Broker ä¹‹é—´çš„è”ç³»ï¼Œå¼€å§‹ poll æ¶ˆæ¯</li><li>é»˜è®¤ä¸€æ¬¡æ€§ poll 500æ¡æ¶ˆæ¯</li></ul><blockquote><p>å¯ä»¥æ ¹æ®æ¶ˆè´¹é€Ÿåº¦çš„å¿«æ…¢æ¥è®¾ç½®ï¼Œ<strong>å› ä¸ºå¦‚æœä¸¤æ¬¡ poll çš„æ—¶é—´å¦‚æœè¶…å‡ºäº† 30s çš„æ—¶é—´é—´éš”ï¼Œkafka ä¼šè®¤ä¸ºå…¶æ¶ˆè´¹èƒ½â¼’è¿‡å¼±ï¼Œå°†å…¶è¸¢å‡ºæ¶ˆè´¹ç»„ã€‚å°†åˆ†åŒºåˆ†é…ç»™å…¶ä»–æ¶ˆè´¹è€…</strong>ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, <span class="number">500</span>);</span><br></pre></td></tr></table></figure><ul><li>è®¾ç½®æ¶ˆè´¹è€…ä¸¤æ¬¡ poll ä¹‹é—´çš„æ—¶é—´é—´éš”</li></ul><blockquote><p>æ¶ˆè´¹è€…åœ¨è¢«å‰”é™¤æ¶ˆè´¹ç»„åï¼Œä¼šè§¦å‘ rebalance æœºåˆ¶ï¼Œ rebalance æœºåˆ¶ä¼šé€ æˆæ€§èƒ½å¼€é”€</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">props.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, <span class="number">30</span> * <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><ul><li>ä»£ç ä¸­é…ç½®äº†é•¿è½®è¯¢ poll çš„æ—¶é—´ï¼Œå¦‚æœæ¯éš” 1s å†…æ²¡æœ‰ poll åˆ°ä»»ä½•æ¶ˆæ¯ï¼Œåˆ™ç»§ç»­å» poll æ¶ˆæ¯ï¼Œå¾ªç¯å¾€å¤ï¼Œç›´åˆ° poll åˆ°æ¶ˆæ¯ã€‚<strong>å¦‚æœè¶…å‡ºäº† 1sï¼Œåˆ™æ­¤æ¬¡â»“è½®è¯¢ç»“æŸ</strong>ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(<span class="number">1000</span>));</span><br></pre></td></tr></table></figure><ol><li>å¦‚æœä¸€æ¬¡ poll åˆ°çš„æ¶ˆæ¯çš„æ¡æ•°ä¸ºé…ç½®ä¸­ <code>ConsumerConfig.MAX_POLL_RECORDS_CONFIG</code> é…ç½®çš„æ¡æ•°ï¼Œé‚£ä¹ˆç›´æ¥æ‰§è¡Œä¸‹é¢çš„é€»è¾‘</li><li>å¦‚æœä¸€æ¬¡ poll åˆ°çš„æ¶ˆæ¯æ²¡æœ‰è¾¾åˆ°é…ç½®ä¸­ <code>ConsumerConfig.MAX_POLL_RECORDS_CONFIG</code> é…ç½®çš„æ¡æ•°ï¼Œä¸”æ—¶é—´åœ¨ poll æ–¹æ³•é…ç½®çš„æ—¶é—´ <code>Duration.ofMillis(1000)</code> å†…ï¼Œé‚£ä¹ˆé•¿è½®è¯¢ä¼šç»§ç»­ poll ï¼Œç›´åˆ° poll åˆ°çš„æ¶ˆæ¯æ¡æ•°è¾¾åˆ°é…ç½®çš„æ¡æ•°æˆ–è€…æ—¶é—´è¾¾åˆ°é…ç½®æ—¶é—´ã€‚</li><li>å¦‚æœå¤šæ¬¡ poll éƒ½æ²¡æœ‰è¾¾åˆ°é…ç½®ä¸­ <code>ConsumerConfig.MAX_POLL_RECORDS_CONFIG</code> é…ç½®çš„æ¡æ•°ï¼Œä¸”æ—¶é—´å·²ç»è¶…è¿‡ poll æ–¹æ³•é…ç½®çš„æ—¶é—´ <code>Duration.ofMillis(1000)</code> ï¼Œé‚£ä¹ˆç›´æ¥æ‰§è¡Œä¸‹é¢çš„é€»è¾‘</li></ol><ul><li>æ¶ˆè´¹è€…ç»™ Kafka å‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”</li></ul><blockquote><p>Kafka ä½¿ç”¨ Zookeeper æ¥ç»´æŒå¿ƒè·³</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">props.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><ul><li>Kafka å¦‚æœè¶…è¿‡ 10 ç§’æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„â¼¼è·³ï¼Œåˆ™ä¼šæŠŠæ¶ˆè´¹è€…è¸¢å‡ºæ¶ˆè´¹ç»„ï¼Œè¿›â¾ rebalanceï¼ŒæŠŠåˆ†åŒºåˆ†é…ç»™å…¶ä»–æ¶ˆè´¹è€…ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">props.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, <span class="number">10</span> * <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h3 id="4ã€æ¶ˆè´¹è€…æŒ‡å®šä¸»é¢˜çš„åˆ†åŒºè¿›è¡Œæ¶ˆè´¹"><a href="#4ã€æ¶ˆè´¹è€…æŒ‡å®šä¸»é¢˜çš„åˆ†åŒºè¿›è¡Œæ¶ˆè´¹" class="headerlink" title="4ã€æ¶ˆè´¹è€…æŒ‡å®šä¸»é¢˜çš„åˆ†åŒºè¿›è¡Œæ¶ˆè´¹"></a>4ã€æ¶ˆè´¹è€…æŒ‡å®šä¸»é¢˜çš„åˆ†åŒºè¿›è¡Œæ¶ˆè´¹</h3><ul><li>å¯ä»¥é€šè¿‡æ¶ˆè´¹è€…å¯¹è±¡çš„ assign æ–¹æ³•æ¥æŒ‡å®šåˆ†åŒº</li></ul><blockquote><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œä¸ºå½“å‰æ¶ˆè´¹è€…æŒ‡å®šæ¶ˆè´¹ <code>my-replicated-topic</code> ä¸»é¢˜ä¸­çš„ç¬¬ 0 ä¸ªåˆ†åŒºã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consumer.assign(Collections.singletonList(<span class="keyword">new</span> TopicPartition(TOPIC_NAME, <span class="number">0</span>)));</span><br></pre></td></tr></table></figure><h3 id="5ã€æ¶ˆæ¯çš„å›æº¯æ¶ˆè´¹"><a href="#5ã€æ¶ˆæ¯çš„å›æº¯æ¶ˆè´¹" class="headerlink" title="5ã€æ¶ˆæ¯çš„å›æº¯æ¶ˆè´¹"></a>5ã€æ¶ˆæ¯çš„å›æº¯æ¶ˆè´¹</h3><blockquote><p>Kafka æ”¯æŒä¸¤ç§å›æº¯æ–¹å¼å›æº¯æ¶ˆæ¯ï¼Œä¸€ç§æ˜¯åŸºäºæ¶ˆæ¯åç§»é‡ offset å›æº¯ï¼Œä¸€ç§æ˜¯åŸºäºæ—¶é—´ç‚¹å›æº¯ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯ä»å¤´æ¶ˆè´¹</p></blockquote><ul><li>ä»å¤´æ¶ˆè´¹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šæ¶ˆè´¹è¯¥ä¸»é¢˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒº</span></span><br><span class="line">consumer.assign(Collections.singletonList(<span class="keyword">new</span> TopicPartition(TOPIC_NAME, <span class="number">0</span>)));</span><br><span class="line"><span class="comment">// ä»å¤´å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">consumer.seekToBeginning(Collections.singletonList(<span class="keyword">new</span> TopicPartition(TOPIC_NAME, <span class="number">0</span>)));</span><br></pre></td></tr></table></figure><ul><li>åŸºäºæ¶ˆæ¯åç§»é‡ï¼ˆoffsetï¼‰å›æº¯</li></ul><blockquote><p>åœ¨ Kafka çš„æ¯ä¸ªåˆ†åŒºä¸­ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ª offset å€¼ï¼Œè¿™ä¸ªå€¼ç”¨äºè¡¨ç¤ºè¿™æ¡æ¶ˆæ¯åœ¨è¯¥åˆ†åŒºä¸­çš„ä½ç½®ï¼Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹å®Œè¿™æ¡æ¶ˆæ¯åï¼Œä¼šå°†è¿™æ¡æ¶ˆæ¯çš„ offset æäº¤åˆ° Broker ï¼Œä¸‹æ¡æ¶ˆæ¯ä»è¿™ä¸ªä½ç½®åå¼€å§‹æ¶ˆè´¹ã€‚</p><p><strong>åŸºäºæ¶ˆæ¯åç§»é‡å›æº¯å¾ˆç®€å•ï¼Œåªéœ€è¦é‡ç½® offset ï¼Œç„¶åæ¶ˆè´¹è€…ä¼šä»è¯¥ offset ä¹‹åå¼€å§‹æ¶ˆè´¹</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šæ¶ˆè´¹è¯¥ä¸»é¢˜çš„ç¬¬ä¸€ä¸ªåˆ†åŒº</span></span><br><span class="line">consumer.assign(Collections.singletonList(<span class="keyword">new</span> TopicPartition(TOPIC_NAME, <span class="number">0</span>)));</span><br><span class="line"><span class="comment">// æŒ‡å®š offset æ¶ˆè´¹</span></span><br><span class="line">consumer.seek(Collections.singletonList(<span class="keyword">new</span> TopicPartition(TOPIC_NAME, <span class="number">0</span>)),<span class="number">10</span>);</span><br></pre></td></tr></table></figure><ul><li>åŸºäºæ—¶é—´ç‚¹å›æº¯</li></ul><blockquote><p>æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ Kafka å­˜å‚¨æ¶ˆæ¯çš„æ–‡ä»¶æ ¼å¼ï¼ŒKafka å­˜å‚¨æ¶ˆæ¯æ˜¯ä»¥æ—¥å¿—çš„å½¢å¼å­˜å‚¨çš„ï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªæ—¥å¿—ï¼Œä½†æ—¥å¿—ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯ç”±å¤šä¸ªæ–‡ä»¶ç»„æˆçš„ã€‚</p><p>æ—¥å¿—æ–‡ä»¶éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæ–‡ä»¶å¤¹æ ¼å¼ä¸º topic-0ã€‚</p></blockquote><ol><li>topic ä¸º kafka å¯¹åº”çš„ä¸»é¢˜åç§°ï¼Œ0 æ˜¯åˆ†åŒºæ‰€åœ¨çš„åˆ†åŒºå·ã€‚</li><li>æ–‡ä»¶å¤¹ä¸­å­˜å‚¨ç€ 4 ä¸ªæ—¥å¿—ï¼Œåˆ†åˆ«ä¸º<strong>æ—¥å¿—åˆ†æ®µæ–‡ä»¶</strong>ã€<strong>åç§»é‡ç´¢å¼•æ–‡ä»¶</strong>ã€<strong>æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶</strong> å’Œ <strong>å…¶ä»–æ–‡ä»¶</strong></li></ol><blockquote><p>é‚£ä¹ˆæ˜¯æ€ä¹ˆé€šè¿‡æ—¶é—´æˆ³å›æº¯çš„å‘¢ï¼Ÿ</p></blockquote><ol><li><p>å°†è¦å›æº¯çš„æ—¶é—´æ¢ç®—ä¸ºæ—¶é—´æˆ³ <code>timestamp</code> ï¼ˆyyyy-MM-dd HH:mm:ss â€“&gt; longï¼‰</p></li><li><p>æ ¹æ®æ—¶é—´æˆ³ <code>timestamp</code> åœ¨æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸å¤§äºè¿™ä¸ªæ—¶é—´æˆ³ <code>timestamp</code> çš„æœ€å¤§åç§»é‡</p></li><li><p>æ‰¾åˆ°åç§»é‡åï¼Œæ‰¾åˆ°å¯¹åº”æ¶ˆæ¯çš„ä½ç½® position ï¼ˆæŸ¥æ‰¾è¿‡ç¨‹åé¢è¡¥å……ï¼‰</p></li><li><p>é€šè¿‡ position å®šä½æ¶ˆæ¯ï¼Œè·å–è¯¥æ¶ˆæ¯çš„ç”Ÿæˆæ—¶é—´ï¼Œå°†è¿™ä¸ªæ—¶é—´ä¸ <code>timestamp</code> è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åæŒ‰é¡ºåºé€æ¸å’Œåé¢çš„æ¶ˆæ¯è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœå‰ä¸€ä¸ªæ¶ˆæ¯çš„ç”Ÿæˆæ—¶é—´å°äº <code>timestamp</code> ä¸”åä¸€ä¸ªæ¶ˆæ¯çš„ç”Ÿæˆæ—¶é—´å¤§äº <code>timestamp</code> ï¼Œé‚£ä¹ˆå½“å‰è¿™ä¸ªä½ç½®å°±æ˜¯è¦å›æº¯çš„ç‚¹ï¼Œè·å–æ¶ˆæ¯çš„ offset ï¼Œå¯¹æ¶ˆè´¹è€…æ¶ˆè´¹è®°å½•çš„ offset è¿›è¡Œé‡ç½®ï¼Œå›æº¯å®Œæˆ</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">   List&lt;PartitionInfo&gt; topicPartitions = consumer.partitionsFor(TOPIC_NAME);</span><br><span class="line"><span class="comment">//ä»1â¼©æ—¶å‰å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">   <span class="keyword">long</span> fetchDataTime = <span class="keyword">new</span> Date().getTime() - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>;</span><br><span class="line">   Map&lt;TopicPartition, Long&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">   <span class="keyword">for</span> (PartitionInfo par : topicPartitions) &#123;</span><br><span class="line">       map.put(<span class="keyword">new</span> TopicPartition(TOPIC_NAME, par.partition()), fetchDataTime);</span><br><span class="line">   &#125;</span><br><span class="line">   Map&lt;TopicPartition, OffsetAndTimestamp&gt; parMap = consumer.offsetsForTimes(map);</span><br><span class="line">   <span class="keyword">for</span> (Map.Entry&lt;TopicPartition, OffsetAndTimestamp&gt; entry : parMap.entrySet()) &#123;</span><br><span class="line">       TopicPartition key = entry.getKey();</span><br><span class="line">       OffsetAndTimestamp value = entry.getValue();</span><br><span class="line">       <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">continue</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">long</span> offset = value.offset();</span><br><span class="line">       System.out.println(<span class="string">&quot;partition-&quot;</span> + key.partition() + <span class="string">&quot;|offset-&quot;</span> + offset);</span><br><span class="line">       System.out.println();</span><br><span class="line">       <span class="comment">//æ ¹æ®æ¶ˆè´¹â¾¥çš„timestampç¡®å®šoffset</span></span><br><span class="line">       <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">           consumer.assign(Collections.singletonList(key));</span><br><span class="line">           consumer.seek(key, offset); 	</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€æŒ‡å®šæ–°æ¶ˆè´¹ç»„çš„æ¶ˆè´¹åç§»é‡"><a href="#6ã€æŒ‡å®šæ–°æ¶ˆè´¹ç»„çš„æ¶ˆè´¹åç§»é‡" class="headerlink" title="6ã€æŒ‡å®šæ–°æ¶ˆè´¹ç»„çš„æ¶ˆè´¹åç§»é‡"></a>6ã€æŒ‡å®šæ–°æ¶ˆè´¹ç»„çš„æ¶ˆè´¹åç§»é‡</h3><blockquote><p>å½“æ¶ˆè´¹ä¸»é¢˜çš„æ˜¯â¼€ä¸ªæ–°çš„æ¶ˆè´¹ç»„ï¼Œæˆ–è€…æŒ‡å®š offset çš„æ¶ˆè´¹â½…å¼ï¼Œoffset ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•æ¶ˆè´¹ï¼Ÿ</p></blockquote><ul><li><code>latest</code>ï¼ˆé»˜è®¤ï¼‰</li></ul><blockquote><p>åªæ¶ˆè´¹è‡ªå·±å¯åŠ¨åå‘é€åˆ°ä¸»é¢˜çš„æ¶ˆæ¯</p></blockquote><ul><li><code>earliest</code></li></ul><blockquote><p>ç¬¬ä¸€æ¬¡ä»å¤´å¼€å§‹æ¶ˆè´¹ï¼Œä»¥åæŒ‰ç…§æ¶ˆè´¹ offset çš„è®°å½•ç»§ç»­æ¶ˆè´¹ï¼Œè¿™ä¸ªéœ€è¦åŒºåˆ«äº <code>consumer.seekToBeginning</code> ï¼ˆæ¯æ¬¡éƒ½ä»å¤´å¼€å§‹æ¶ˆè´¹ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string">&quot;earliest&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="äº”ã€Spring-Boot-ä½¿ç”¨-Kafka"><a href="#äº”ã€Spring-Boot-ä½¿ç”¨-Kafka" class="headerlink" title="äº”ã€Spring Boot ä½¿ç”¨ Kafka"></a>äº”ã€Spring Boot ä½¿ç”¨ Kafka</h1><h2 id="5-1ã€å‰æœŸå‡†å¤‡"><a href="#5-1ã€å‰æœŸå‡†å¤‡" class="headerlink" title="5.1ã€å‰æœŸå‡†å¤‡"></a>5.1ã€å‰æœŸå‡†å¤‡</h2><ul><li>åˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œå¼•å…¥ç›¸å…³ä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.78<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªå®ä½“ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String productId;</span><br><span class="line">    <span class="keyword">private</span> String productName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-2ã€åˆ›å»ºé…ç½®æ–‡ä»¶"><a href="#5-2ã€åˆ›å»ºé…ç½®æ–‡ä»¶" class="headerlink" title="5.2ã€åˆ›å»ºé…ç½®æ–‡ä»¶"></a>5.2ã€åˆ›å»ºé…ç½®æ–‡ä»¶</h2><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªåº”ç”¨æœ€å¤šåªæ‰®æ¼”ç”Ÿäº§è€… / æ¶ˆè´¹è€…ä¹‹ä¸­çš„ä¸€ä¸ªè§’è‰²ï¼Œè¿™ä¸ªæ—¶å€™åªéœ€è¦æ·»åŠ å¯¹åº”è§’è‰²çš„é…ç½®å³å¯ã€‚</p></blockquote><h3 id="1ã€ç”Ÿäº§è€…ç›¸å…³é…ç½®"><a href="#1ã€ç”Ÿäº§è€…ç›¸å…³é…ç½®" class="headerlink" title="1ã€ç”Ÿäº§è€…ç›¸å…³é…ç½®"></a>1ã€ç”Ÿäº§è€…ç›¸å…³é…ç½®</h3><ul><li>é‡è¯•æ¬¡æ•°ï¼ˆretriesï¼‰</li></ul><blockquote><p>è®¾ç½®ä¸€ä¸ªå¤§äº 0 çš„å€¼ï¼Œé»˜è®¤ä¸º 3 ï¼Œå³ç”Ÿäº§è€…åœ¨å‘é€å¤±è´¥æ—¶ä¼šé»˜è®¤é‡å‘ä¸‰æ¬¡</p></blockquote><ul><li>æ‰¹é‡å‘ç»™ Kafka çš„æ•°æ®å¤§å°ï¼ˆbatch-sizeï¼‰</li><li>ç”Ÿäº§è€…æœ¬åœ°ç¼“å†²åŒºï¼ˆbuffer-memoryï¼‰</li></ul><blockquote><p>è¿™ä¸¤ä¸ªé…ç½®è”ç³»ååˆ†ç´§å¯†ï¼Œç”Ÿäº§è€…ä¸æ˜¯æ¯æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯å°±ç›´æ¥å‘ç»™ Kafka ï¼Œè€Œæ˜¯å…ˆå°†æ¶ˆæ¯å­˜å‚¨åœ¨æœ¬åœ°çš„ä¸€ä¸ªç¼“å†²åŒºä¸­ï¼Œè¿™ä¸ªç¼“å†²åŒºçš„å¤§å°ä¸º <code>buffer-memory</code> ï¼ŒåŒæ—¶åœ¨åå°å¦èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©è¿™ä¸ªçº¿ç¨‹æ¯æ¬¡ä»è¿™ä¸ªç¼“å†²åŒºä¸­æ‹¿å‡º <code>batch-size</code> å¤§å°çš„æ•°æ®å‘é€ç»™ Kafka ã€‚</p></blockquote><ul><li>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„ç¡®è®¤æ¨¡å¼ï¼ˆacksï¼‰</li></ul><blockquote><p>é»˜è®¤ä¸º 1 ï¼Œâ¾„å°‘è¦ç­‰å¾… leader å·²ç»æˆåŠŸå°†æ•°æ®å†™â¼Šæœ¬åœ° logï¼Œä½†æ˜¯ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰ follower æ˜¯å¦æˆåŠŸå†™â¼Šï¼Œå°±å¯ä»¥ç»§ç»­å‘é€ä¸‹â¼€æ¡æ¶ˆæ¯ã€‚</p><p>æ•ˆç‡ä¸å¯é æ€§æŠ˜ä¸­çš„ä¸€ç§é€‰æ‹©</p></blockquote><ul><li>é”®å’Œæ¶ˆæ¯è®°å½•çš„ç¼–è§£ç æ–¹å¼ï¼ˆkey-serializer / value-serializerï¼‰</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="comment"># ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="comment"># è®¾ç½®ä¸€ä¸ªå¤§äº 0 çš„å€¼ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šå°†å‘é€å¤±è´¥çš„è®°å½•é‡æ–°å‘é€</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">      <span class="comment"># ç”Ÿäº§è€…ä¸€æ¬¡ä»æœ¬åœ°ç¼“å†²åŒºä¸­å–å‡º batch-size å¤§å°çš„æ•°æ®å‘é€ç»™ Kafka</span></span><br><span class="line">      <span class="attr">batch-size:</span> <span class="number">16384</span></span><br><span class="line">      <span class="comment"># è®¾ç½® acks ä¸º 1ï¼Œ â¾„å°‘è¦ç­‰å¾… leader å·²ç»æˆåŠŸå°†æ•°æ®å†™â¼Šæœ¬åœ° logï¼Œä½†æ˜¯ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰ follower æ˜¯å¦æˆåŠŸå†™â¼Šã€‚å°±å¯ä»¥ç»§ç»­å‘é€ä¸‹â¼€æ¡æ¶ˆæ¯ã€‚</span></span><br><span class="line">      <span class="attr">acks:</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># æŒ‡å®šæ¶ˆæ¯ key ä¸æ¶ˆæ¯ä½“çš„ç¼–è§£ç æ–¹å¼</span></span><br><span class="line">      <span class="attr">key-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line">      <span class="attr">value-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line">      <span class="comment"># ç”Ÿäº§è€…æœ¬åœ°ç¼“å†²åŒºï¼Œé»˜è®¤ä¸º 32m</span></span><br><span class="line">      <span class="attr">buffer-memory:</span> <span class="number">33554432</span></span><br></pre></td></tr></table></figure><h3 id="2ã€æ¶ˆè´¹è€…ç›¸å…³é…ç½®"><a href="#2ã€æ¶ˆè´¹è€…ç›¸å…³é…ç½®" class="headerlink" title="2ã€æ¶ˆè´¹è€…ç›¸å…³é…ç½®"></a>2ã€æ¶ˆè´¹è€…ç›¸å…³é…ç½®</h3><ul><li><p>æ¶ˆè´¹è€…çš„æ¶ˆè´¹ç»„ id ï¼ˆgroup-idï¼‰</p></li><li><p>æ˜¯å¦å¯ç”¨è‡ªåŠ¨æäº¤ï¼ˆenable-auto-commitï¼‰</p></li><li><p>æ–°æ¶ˆè´¹ç»„çš„æ¶ˆè´¹åç§»é‡é€‰å–ç­–ç•¥ï¼ˆauto-offset-resetï¼‰</p></li><li><p>ä¸€æ¬¡é•¿è½®è¯¢ä¸­ä» Broker ä¸­æ‹‰å–çš„æ¶ˆæ¯æ¡æ•°çš„æœ€å¤§å€¼ï¼ˆmax-poll-recordsï¼‰</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="comment"># æŒ‡å®šæ¶ˆè´¹ç»„ id</span></span><br><span class="line">      <span class="attr">group-id:</span> <span class="string">default-group</span></span><br><span class="line">      <span class="comment"># å…³é—­è‡ªåŠ¨æäº¤</span></span><br><span class="line">      <span class="attr">enable-auto-commit:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># å½“å‡ºç°ä¸€ä¸ªæ–°çš„æ¶ˆè´¹ç»„æˆ–è€…éœ€è¦ä¼ å…¥ offset ä½† offset ä¸ºç©ºæ—¶ï¼ŒæŒ‡å®šå…¶ä»å¤´å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">      <span class="comment"># ä½†ä¸æ˜¯æ¯æ¬¡éƒ½æ˜¯ä»å¤´å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">      <span class="attr">auto-offset-reset:</span> <span class="string">earliest</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="comment"># æ¶ˆè´¹è€…ä¸€æ¬¡ä» Broker æœ€å¤šæ‹‰å– 500 æ¡æ¶ˆæ¯</span></span><br><span class="line">      <span class="attr">max-poll-records:</span> <span class="number">500</span></span><br></pre></td></tr></table></figure><h3 id="3ã€é¢å¤–é…ç½®"><a href="#3ã€é¢å¤–é…ç½®" class="headerlink" title="3ã€é¢å¤–é…ç½®"></a>3ã€é¢å¤–é…ç½®</h3><ul><li>Kafka-Server çš„åœ°å€ï¼ˆbootstrap-serversï¼‰</li></ul><blockquote><p>å¦‚æœæ˜¯ Kafka é›†ç¾¤ï¼Œé‚£ä¹ˆåœ¨å¤šä¸ª IP:port ä¹‹é—´ä½¿ç”¨ <code>,</code> éš”å¼€</p></blockquote><ul><li>Kafka æ¶ˆè´¹è€…çš„æ¶ˆè´¹æ¨¡å¼</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="comment"># kafka-server çš„åœ°å€ï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œé‚£ä¹ˆ ip:port ä¹‹é—´ä½¿ç”¨ &quot;,&quot; éš”å¼€</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">120.78</span><span class="number">.198</span><span class="number">.32</span><span class="string">:9092</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="comment"># å½“æ¯ä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†åæ‰æäº¤(record)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åæäº¤(batch)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè·ç¦»ä¸Šæ¬¡æäº¤æ—¶é—´â¼¤äº TIME æ—¶æäº¤(time)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè¢«å¤„ç† record æ•°é‡â¼¤äºç­‰äºCOUNTæ—¶æäº¤(count)</span></span><br><span class="line">      <span class="comment"># TIME |	COUNT	æœ‰â¼€ä¸ªæ¡ä»¶æ»¡â¾œæ—¶æäº¤(count_time)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹å, â¼¿åŠ¨è°ƒâ½¤ Acknowledgment.acknowledge() åæäº¤(manual)</span></span><br><span class="line">      <span class="comment"># â¼¿åŠ¨è°ƒâ½¤ Acknowledgment.acknowledge() åâ½´å³æäº¤ï¼Œâ¼€èˆ¬ä½¿â½¤è¿™ç§(manual_immediate)</span></span><br><span class="line">      <span class="attr">ack-mode:</span> <span class="string">manual_immediate</span></span><br></pre></td></tr></table></figure><h3 id="4ã€å®Œæ•´é…ç½®"><a href="#4ã€å®Œæ•´é…ç½®" class="headerlink" title="4ã€å®Œæ•´é…ç½®"></a>4ã€å®Œæ•´é…ç½®</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="comment"># kafka-server çš„åœ°å€ï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œé‚£ä¹ˆ ip:port ä¹‹é—´ä½¿ç”¨ &quot;,&quot; éš”å¼€</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">120.78</span><span class="number">.198</span><span class="number">.32</span><span class="string">:9092</span></span><br><span class="line">    <span class="comment"># ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="comment"># è®¾ç½®ä¸€ä¸ªå¤§äº 0 çš„å€¼ï¼Œåˆ™å®¢æˆ·ç«¯ä¼šå°†å‘é€å¤±è´¥çš„è®°å½•é‡æ–°å‘é€</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">3</span></span><br><span class="line">      <span class="comment"># ç”Ÿäº§è€…ä¸€æ¬¡ä»æœ¬åœ°ç¼“å†²åŒºä¸­å–å‡º batch-size å¤§å°çš„æ•°æ®å‘é€ç»™ Kafka</span></span><br><span class="line">      <span class="attr">batch-size:</span> <span class="number">16384</span></span><br><span class="line">      <span class="comment"># è®¾ç½® acks ä¸º 1ï¼Œ â¾„å°‘è¦ç­‰å¾… leader å·²ç»æˆåŠŸå°†æ•°æ®å†™â¼Šæœ¬åœ° logï¼Œä½†æ˜¯ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰ follower æ˜¯å¦æˆåŠŸå†™â¼Šã€‚å°±å¯ä»¥ç»§ç»­å‘é€ä¸‹â¼€æ¡æ¶ˆæ¯ã€‚</span></span><br><span class="line">      <span class="attr">acks:</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># æŒ‡å®šæ¶ˆæ¯ key ä¸æ¶ˆæ¯ä½“çš„ç¼–è§£ç æ–¹å¼</span></span><br><span class="line">      <span class="attr">key-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line">      <span class="attr">value-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line">      <span class="comment"># ç”Ÿäº§è€…æœ¬åœ°ç¼“å†²åŒºï¼Œé»˜è®¤ä¸º 32m</span></span><br><span class="line">      <span class="attr">buffer-memory:</span> <span class="number">33554432</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="comment"># æŒ‡å®šæ¶ˆè´¹ç»„ id</span></span><br><span class="line">      <span class="attr">group-id:</span> <span class="string">default-group</span></span><br><span class="line">      <span class="comment"># å…³é—­è‡ªåŠ¨æäº¤</span></span><br><span class="line">      <span class="attr">enable-auto-commit:</span> <span class="literal">false</span></span><br><span class="line">      <span class="comment"># å½“å‡ºç°ä¸€ä¸ªæ–°çš„æ¶ˆè´¹ç»„æˆ–è€…éœ€è¦ä¼ å…¥ offset ä½† offset ä¸ºç©ºæ—¶ï¼ŒæŒ‡å®šå…¶ä»å¤´å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">      <span class="comment"># ä½†ä¸æ˜¯æ¯æ¬¡éƒ½æ˜¯ä»å¤´å¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">      <span class="attr">auto-offset-reset:</span> <span class="string">earliest</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="comment"># æ¶ˆè´¹è€…ä¸€æ¬¡ä» Broker æœ€å¤šæ‹‰å– 500 æ¡æ¶ˆæ¯</span></span><br><span class="line">      <span class="attr">max-poll-records:</span> <span class="number">500</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="comment"># å½“æ¯ä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†åæ‰æäº¤(record)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åæäº¤(batch)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè·ç¦»ä¸Šæ¬¡æäº¤æ—¶é—´â¼¤äº TIME æ—¶æäº¤(time)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè¢«å¤„ç† record æ•°é‡â¼¤äºç­‰äºCOUNTæ—¶æäº¤(count)</span></span><br><span class="line">      <span class="comment"># TIME |	COUNT	æœ‰â¼€ä¸ªæ¡ä»¶æ»¡â¾œæ—¶æäº¤(count_time)</span></span><br><span class="line">      <span class="comment"># å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹å, â¼¿åŠ¨è°ƒâ½¤ Acknowledgment.acknowledge() åæäº¤(manual)</span></span><br><span class="line">      <span class="comment"># â¼¿åŠ¨è°ƒâ½¤ Acknowledgment.acknowledge() åâ½´å³æäº¤ï¼Œâ¼€èˆ¬ä½¿â½¤è¿™ç§(manual_immediate)</span></span><br><span class="line">      <span class="attr">ack-mode:</span> <span class="string">manual_immediate</span></span><br></pre></td></tr></table></figure><h3 id="5ã€Kafka-æ¶ˆè´¹æ¨¡å¼ä»‹ç»"><a href="#5ã€Kafka-æ¶ˆè´¹æ¨¡å¼ä»‹ç»" class="headerlink" title="5ã€Kafka æ¶ˆè´¹æ¨¡å¼ä»‹ç»"></a>5ã€Kafka æ¶ˆè´¹æ¨¡å¼ä»‹ç»</h3><blockquote><p>Kafka æ”¯æŒå¤šç§æ¶ˆè´¹æ¨¡å¼ï¼Œæ¶ˆè´¹æ¨¡å¼åœ¨ <code>org.springframework.kafka.listener.ContainerProperties.AckMode</code> æšä¸¾ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨æšä¸¾ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è¿™ä¸ªç±»ä¸­çš„è¯¦ç»†ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The offset commit behavior enumeration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">AckMode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Commit after each record is processed by the listener.</span></span><br><span class="line"><span class="comment">     * å½“æ¯ä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†åæ‰æäº¤(record)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    RECORD,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Commit whatever has already been processed before the next poll.</span></span><br><span class="line"><span class="comment">     * å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åæäº¤(batch)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BATCH,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Commit pending updates after</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> ContainerProperties#setAckTime(long) ackTime&#125; has elapsed.</span></span><br><span class="line"><span class="comment">     * å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè·ç¦»ä¸Šæ¬¡æäº¤æ—¶é—´â¼¤äº TIME æ—¶æäº¤(time)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TIME,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Commit pending updates after</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> ContainerProperties#setAckCount(int) ackCount&#125; has been</span></span><br><span class="line"><span class="comment">     * exceeded.</span></span><br><span class="line"><span class="comment">     * å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹åï¼Œè¢«å¤„ç† record æ•°é‡â¼¤äºç­‰äºCOUNTæ—¶æäº¤(count)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    COUNT,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Commit pending updates after</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> ContainerProperties#setAckCount(int) ackCount&#125; has been</span></span><br><span class="line"><span class="comment">     * exceeded or after &#123;<span class="doctag">@link</span> ContainerProperties#setAckTime(long)</span></span><br><span class="line"><span class="comment">     * ackTime&#125; has elapsed.</span></span><br><span class="line"><span class="comment">     * TIME |	COUNT	æœ‰â¼€ä¸ªæ¡ä»¶æ»¡â¾œæ—¶æäº¤(count_time)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    COUNT_TIME,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * User takes responsibility for acks using an</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> AcknowledgingMessageListener&#125;.</span></span><br><span class="line"><span class="comment">     * å½“æ¯â¼€æ‰¹ poll() çš„æ•°æ®è¢«æ¶ˆè´¹è€…ç›‘å¬å™¨ï¼ˆListenerConsumerï¼‰å¤„ç†ä¹‹å, â¼¿åŠ¨è°ƒâ½¤ Acknowledgment.acknowledge() åæäº¤(manual)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    MANUAL,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * User takes responsibility for acks using an</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> AcknowledgingMessageListener&#125;. The consumer</span></span><br><span class="line"><span class="comment">     * immediately processes the commit.</span></span><br><span class="line"><span class="comment">     * â¼¿åŠ¨è°ƒâ½¤ Acknowledgment.acknowledge() åâ½´å³æäº¤ï¼Œâ¼€èˆ¬ä½¿â½¤è¿™ç§(manual_immediate)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    MANUAL_IMMEDIATE,</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>MANUAL</code> å’Œ <code>MANUAL_IMMEDIATE</code> çš„åŒºåˆ«</p></blockquote><ul><li>MANUALï¼šåªæœ‰å½“ poll ä¸‹æ¥çš„æ¶ˆæ¯å…¨éƒ¨å¤„ç†å®Œåï¼Œå†è°ƒç”¨ Acknowledgment.acknowledge() è¿›è¡Œæ‰¹é‡æäº¤</li><li>MANUAL_IMMEDIATEï¼šå½“è°ƒç”¨ Acknowledgment.acknowledge() åç«‹å³æäº¤ï¼Œå¤„ç†ä¸€æ¡æäº¤ä¸€æ¡</li></ul><h2 id="5-3ã€æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#5-3ã€æ¶ˆæ¯ç”Ÿäº§è€…" class="headerlink" title="5.3ã€æ¶ˆæ¯ç”Ÿäº§è€…"></a>5.3ã€æ¶ˆæ¯ç”Ÿäº§è€…</h2><ul><li>æŒ‡å®šè¦å‘é€çš„åˆ†åŒº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">&quot;my-replicated-topic&quot;</span>;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ç”Ÿäº§è€…ä¸­æ³¨å…¥ KafkaTemplate å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span><br></pre></td></tr></table></figure><ul><li><p>åˆ›å»ºæ¶ˆæ¯ï¼Œå¹¶è°ƒç”¨ KafkaTemplate å¯¹è±¡çš„ send æ–¹æ³•å‘é€æ¶ˆæ¯</p></li><li><p>å…¨éƒ¨ä»£ç </p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;message&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaProducerController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_NAME = <span class="string">&quot;my-replicated-topic&quot;</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;send&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Product product = <span class="keyword">new</span> Product(<span class="string">&quot;100&quot;</span>, <span class="string">&quot;æµ‹è¯•å•†å“-100&quot;</span>);</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œè¿›è¡Œæ¶ˆæ¯å‘é€ï¼ŒæŒ‡å®šä¸»é¢˜ã€åˆ†åŒºã€keyå’Œæ¶ˆæ¯è®°å½•</span></span><br><span class="line">        kafkaTemplate.send(TOPIC_NAME, <span class="number">0</span>, product.getProductId(), JSON.toJSONString(product));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;send success!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-4ã€æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#5-4ã€æ¶ˆæ¯æ¶ˆè´¹è€…" class="headerlink" title="5.4ã€æ¶ˆæ¯æ¶ˆè´¹è€…"></a>5.4ã€æ¶ˆæ¯æ¶ˆè´¹è€…</h2><ul><li>åˆ›å»ºä¸€ä¸ª Consumer ç±»ï¼Œéœ€è¦å°†è¿™ä¸ªç±»äº¤ç»™ Spring å®¹å™¨ç®¡ç†ï¼Œåœ¨ç±»ä¸Šæ·»åŠ  <code>@Component</code> æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaConsumer</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ  <code>@KafkaListener</code> æ³¨è§£ï¼Œåœ¨æ³¨è§£ä¸­æŒ‡å®šç›‘å¬çš„ä¸»é¢˜å’Œæ¶ˆè´¹ç»„</li></ul><blockquote><p>å¦‚æœåœ¨å¤„ç†æ¶ˆæ¯åæ²¡æœ‰è¿›è¡Œæäº¤ï¼Œé‚£ä¹ˆè¿™æ¡æ¶ˆæ¯ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Œå½“è‡ªåŠ¨æäº¤å…³é—­æ—¶ï¼Œéœ€è¦æˆ‘ä»¬ä½¿ç”¨ <code>ack.acknowledge();</code> è¿›è¡Œæ‰‹åŠ¨æäº¤</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@KafkaListener(topics = KafkaProducerController.TOPIC_NAME, groupId = GROUP_ID)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenGroup</span> <span class="params">(ConsumerRecord&lt;String, String&gt; record, Acknowledgment ack)</span> </span>&#123;</span><br><span class="line">    String value = record.value();</span><br><span class="line">    System.out.println(value);</span><br><span class="line">    System.out.println(record);</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨æäº¤ offset </span></span><br><span class="line">    ack.acknowledge();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å…¨éƒ¨ä»£ç </li></ul><blockquote><p>å®é™…ä¸Šæ‹¿åˆ°çš„æ˜¯å¤šæ¡è®°å½•ï¼Œä½†æ¯æ¬¡åªå¯¹ä¸€æ¡è®°å½•è¿›è¡Œå¤„ç†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GROUP_ID = <span class="string">&quot;MyGroup&quot;</span>;</span><br><span class="line">    <span class="meta">@KafkaListener(topics = KafkaProducerController.TOPIC_NAME, groupId = GROUP_ID)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenGroup</span> <span class="params">(ConsumerRecord&lt;String, String&gt; record, Acknowledgment ack)</span> </span>&#123;</span><br><span class="line">        String value = record.value();</span><br><span class="line">        System.out.println(value);</span><br><span class="line">        System.out.println(record);</span><br><span class="line">        <span class="comment">// æ‰‹åŠ¨æäº¤ offset</span></span><br><span class="line">        ack.acknowledge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå¯ä»¥å¯¹å¤šæ¡è®°å½•è¿›è¡Œå¤„ç†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@KafkaListener(topics = KafkaProducerController.TOPIC_NAME, groupId = GROUP_ID)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenGroups</span> <span class="params">(ConsumerRecords&lt;String, String&gt; records, Acknowledgment ack)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¤„ç†é€»è¾‘</span></span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨æäº¤ offset</span></span><br><span class="line">    ack.acknowledge();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-5ã€æµ‹è¯•"><a href="#5-5ã€æµ‹è¯•" class="headerlink" title="5.5ã€æµ‹è¯•"></a>5.5ã€æµ‹è¯•</h2><blockquote><p>å¯åŠ¨é¡¹ç›®ï¼Œè®¿é—® <code>http://localhost:8080/message/send</code> æ¥å£ï¼ŒæŸ¥çœ‹ç»“æœ</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211011230130.png" alt="image-20211011162449160"></p><blockquote><p>æ§åˆ¶å°ä¸­è¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…æ”¶åˆ°äº†ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;productId&quot;:&quot;100&quot;,&quot;productName&quot;:&quot;æµ‹è¯•å•†å“-100&quot;&#125;</span><br><span class="line">ConsumerRecord(topic &#x3D; my-replicated-topic, partition &#x3D; 0, leaderEpoch &#x3D; 0, offset &#x3D; 0, CreateTime &#x3D; 1633940677717, serialized key size &#x3D; 3, serialized value size &#x3D; 52, headers &#x3D; RecordHeaders(headers &#x3D; [], isReadOnly &#x3D; false), key &#x3D; 100, value &#x3D; &#123;&quot;productId&quot;:&quot;100&quot;,&quot;productName&quot;:&quot;æµ‹è¯•å•†å“-100&quot;&#125;)</span><br></pre></td></tr></table></figure><h2 id="5-6ã€æ¶ˆè´¹è€…çš„è¯¦ç»†é…ç½®"><a href="#5-6ã€æ¶ˆè´¹è€…çš„è¯¦ç»†é…ç½®" class="headerlink" title="5.6ã€æ¶ˆè´¹è€…çš„è¯¦ç»†é…ç½®"></a>5.6ã€æ¶ˆè´¹è€…çš„è¯¦ç»†é…ç½®</h2><blockquote><p>è®¾ç½®æ¶ˆè´¹ç»„ã€å¤š Topic ã€æŒ‡å®šåˆ†åŒºã€æŒ‡å®šåç§»é‡å’Œè®¾ç½®æ¶ˆè´¹è€…ä¸ªæ•°</p></blockquote><ul><li>concurrency å°±æ˜¯åŒç»„ä¸‹çš„æ¶ˆè´¹è€…çš„ä¸ªæ•°ï¼Œå°±æ˜¯å¹¶å‘æ¶ˆè´¹æ•°ï¼Œå»ºè®®å°äºç­‰äºåˆ†ç»„æ€»æ•°</li></ul><blockquote><p>å¯åŠ¨æ—¶ï¼Œ Kafka ä¼šå¸®ä½ åˆ›å»ºå‡º concurrency ä¸ªè¿™æ ·çš„æ¶ˆè´¹è€…ã€‚</p></blockquote><ul><li>topicPartitions ç”±å¤šä¸ª topicPartition ç»„æˆ</li></ul><blockquote><p>topicPartition ä¸­æŒ‡å®šäº†è¿™ä¸ªæ¶ˆè´¹è€…è¦æ¶ˆè´¹çš„ä¸»é¢˜å’Œä¸»é¢˜ä¸­å“ªå‡ ä¸ªåˆ†åŒº</p></blockquote><ol><li>å¯¹äº <code>@TopicPartition(topic = &quot;topic1&quot;, partitions = &#123;&quot;0&quot;, &quot;1&quot;&#125;)</code> ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸»é¢˜ <code>topic1</code> çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªåˆ†åŒº</li><li>å¯¹äº <code>@TopicPartition(topic = &quot;topic2&quot;, partitions = &quot;0&quot;,partitionOffsets = @PartitionOffset(partition = &quot;1&quot;, initialOffset = &quot;100&quot;))</code>ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ç¬¬ä¸€ä¸ªåˆ†åŒºå’Œç¬¬äºŒä¸ªåˆ†åŒºï¼ŒåŒæ—¶åœ¨æ¶ˆè´¹ç¬¬äºŒä¸ªåˆ†åŒºæ—¶ï¼Œåˆå§‹åç§»é‡ä¸º 100</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@KafkaListener(groupId = &quot;testGroup&quot;, topicPartitions = &#123;</span></span><br><span class="line"><span class="meta">        @TopicPartition(topic = &quot;topic1&quot;, partitions = &#123;&quot;0&quot;, &quot;1&quot;&#125;),</span></span><br><span class="line"><span class="meta">        @TopicPartition(topic = &quot;topic2&quot;, partitions = &quot;0&quot;, partitionOffsets = @PartitionOffset(partition = &quot;1&quot;, initialOffset = &quot;100&quot;))</span></span><br><span class="line"><span class="meta">&#125;, concurrency = &quot;3&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenGroupPro</span><span class="params">(ConsumerRecord&lt;String, String&gt; record, Acknowledgment ack)</span> </span>&#123;</span><br><span class="line">    String value = record.value();</span><br><span class="line">    System.out.println(value);</span><br><span class="line">    System.out.println(record);</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨æäº¤ offset</span></span><br><span class="line">    ack.acknowledge();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…­ã€Kafka-åŠé›†ç¾¤-Controller-ã€-Rebalance-å’Œ-HW"><a href="#å…­ã€Kafka-åŠé›†ç¾¤-Controller-ã€-Rebalance-å’Œ-HW" class="headerlink" title="å…­ã€Kafka åŠé›†ç¾¤ Controller ã€ Rebalance å’Œ HW"></a>å…­ã€Kafka åŠé›†ç¾¤ Controller ã€ Rebalance å’Œ HW</h1><h2 id="6-1ã€Controller"><a href="#6-1ã€Controller" class="headerlink" title="6.1ã€Controller"></a>6.1ã€Controller</h2><blockquote><p>å›åˆ°è¿™å¼ å›¾ï¼Œåœ¨ä¸‹é¢çš„ Kafka é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªåˆ†åŒºã€ä¸‰ä¸ªå‰¯æœ¬</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211011230151.png" alt="image-20211011171119093"></p><blockquote><p>åœ¨ä¼—å¤šå‰¯æœ¬ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªå‰¯æœ¬ä¼šä½œä¸º leader ï¼Œè¿™ä¸ªå‰¯æœ¬è´Ÿè´£æ•°æ®çš„è¯»å†™ä¸åŒæ­¥ï¼Œè€Œå…¶ä»–çš„å‰¯æœ¬ä½œä¸ºå…¶çš„ follower å­˜åœ¨ï¼Œåœ¨ leader æŒ‚æ‰åï¼Œæ–° leader ä¼šä»å¤„äº Isr åˆ—è¡¨ä¸­çš„å‰©ä¸‹ follower ä¹‹ä¸­é€‰ä¸¾äº§ç”Ÿã€‚</p><p>controller å°±è´Ÿè´£è¿™ä¸ªæ–° follower çš„é€‰ä¸¾å’Œäº§ç”Ÿã€‚</p></blockquote><h3 id="1ã€æ¦‚å¿µ"><a href="#1ã€æ¦‚å¿µ" class="headerlink" title="1ã€æ¦‚å¿µ"></a>1ã€æ¦‚å¿µ</h3><blockquote><p><strong>Kafka é›†ç¾¤ä¸­çš„ Broker ä¼šåœ¨ ZK ä¸­åˆ›å»ºä¸´æ—¶åºå·èŠ‚ç‚¹ï¼Œåºå·æœ€å°çš„èŠ‚ç‚¹ï¼ˆæœ€å…ˆåˆ›å»ºçš„èŠ‚ç‚¹ï¼‰å°†ä½œä¸º Kafka é›†ç¾¤ä¸­çš„ controller</strong> ï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ä¸­çš„æ‰€æœ‰åˆ†åŒºå’Œæ‰€æœ‰å‰¯æœ¬çš„çŠ¶æ€ã€‚</p></blockquote><h3 id="2ã€èŒè´£"><a href="#2ã€èŒè´£" class="headerlink" title="2ã€èŒè´£"></a>2ã€èŒè´£</h3><ul><li>å½“æŸä¸ªåˆ†åŒºçš„ Leader å‰¯æœ¬å‘ç”Ÿæ•…éšœæ—¶ï¼Œ<strong>ç”± controller è´Ÿè´£ä¸ºè¯¥åˆ†åŒºé€‰ä¸¾äº§ç”Ÿæ–°çš„ Leader å‰¯æœ¬</strong></li><li>å½“æ£€æµ‹åˆ°æŸä¸ªåˆ†åŒºçš„ ISR é›†åˆå‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<strong>ç”± controller è´Ÿè´£é€šçŸ¥æ‰€æœ‰çš„ broker æ›´æ–°å…¶å…ƒæ•°æ®ä¿¡æ¯</strong></li><li>å½“ä½¿â½¤ <code>kafka-topics.sh</code> è„šæœ¬ä¸ºæŸä¸ª <code>topic</code> å¢åŠ åˆ†åŒºæ•°é‡æ—¶ï¼ŒåŒæ ·è¿˜æ˜¯<strong>ç”± controller è´Ÿè´£è®©æ–°åˆ†åŒºè¢«å…¶ä»–èŠ‚ç‚¹æ„ŸçŸ¥åˆ°</strong></li></ul><h2 id="6-2ã€Rebalance-æœºåˆ¶"><a href="#6-2ã€Rebalance-æœºåˆ¶" class="headerlink" title="6.2ã€Rebalance æœºåˆ¶"></a>6.2ã€Rebalance æœºåˆ¶</h2><h3 id="1ã€è§¦å‘å‰æ"><a href="#1ã€è§¦å‘å‰æ" class="headerlink" title="1ã€è§¦å‘å‰æ"></a>1ã€è§¦å‘å‰æ</h3><blockquote><p><strong>æ¶ˆè´¹è€…æ²¡æœ‰æŒ‡æ˜åˆ†åŒºæ¶ˆè´¹</strong></p></blockquote><h3 id="2ã€æ˜¯ä»€ä¹ˆ"><a href="#2ã€æ˜¯ä»€ä¹ˆ" class="headerlink" title="2ã€æ˜¯ä»€ä¹ˆ?"></a>2ã€æ˜¯ä»€ä¹ˆ?</h3><blockquote><p>é‡å¹³è¡¡æ˜¯å…¶å®æ˜¯ä¸€ä¸ªåè®®ï¼Œ<strong>å®ƒè§„å®šäº†å¦‚ä½•è®©æ¶ˆè´¹è€…ç»„ä¸‹çš„æ‰€æœ‰æ¶ˆè´¹è€…æ¥åˆ†é… Topic ä¸­çš„æ¯ä¸€ä¸ªåˆ†åŒº</strong>ã€‚</p><p>æ¯”å¦‚è¯´ä¸€ä¸ª Topic ä¸­æœ‰ 100 ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­æœ‰ 20 ä¸ªæ¶ˆè´¹è€…ï¼Œåœ¨åè°ƒè€…ï¼ˆ<code>Group Coordinator</code>ï¼‰ä¸‹çš„æ§åˆ¶ä¸‹è®©ç»„å†…çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†é…åˆ° 5 ä¸ªåˆ†åŒºï¼Œè¿™ä¸ªåˆ†é…çš„è¿‡ç¨‹å°±æ˜¯é‡å¹³è¡¡ã€‚</p><p>å½“æ¶ˆè´¹ç»„ä¸­æ¶ˆè´¹è€…å’Œåˆ†åŒºçš„å…³ç³»å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ <code>rebalance</code> æœºåˆ¶ã€‚</p></blockquote><h3 id="3ã€è§¦å‘æ¡ä»¶"><a href="#3ã€è§¦å‘æ¡ä»¶" class="headerlink" title="3ã€è§¦å‘æ¡ä»¶"></a>3ã€è§¦å‘æ¡ä»¶</h3><blockquote><p>é‡å¹³è¡¡çš„è§¦å‘æ¡ä»¶ä¸»è¦æœ‰ä¸‰ä¸ªï¼š</p></blockquote><ul><li><strong>æ¶ˆè´¹è€…ç»„å†…æˆå‘˜å‘ç”Ÿå˜æ›´ï¼Œè¿™ä¸ªå˜æ›´åŒ…æ‹¬äº†å¢åŠ å’Œå‡å°‘æ¶ˆè´¹è€…</strong></li></ul><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œçš„å‡å°‘å¾ˆå¤§å¯èƒ½æ˜¯è¢«åŠ¨çš„ï¼Œå³æ¶ˆè´¹è€…å´©æºƒé€€å‡ºï¼Œè¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„æƒ…å†µ</p></blockquote><ul><li>ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜åŒ–ï¼ŒKafka ç›®å‰åªæ”¯æŒå¢åŠ åˆ†åŒºï¼Œå½“å¢åŠ åˆ†åŒºæ—¶ä¼šè§¦å‘é‡å¹³è¡¡</li><li>è®¢é˜…çš„ä¸»é¢˜æ•°å‘ç”Ÿå˜åŒ–</li></ul><blockquote><p>å½“æ¶ˆè´¹è€…ç»„ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è®¢é˜…ä¸»é¢˜æ—¶ï¼Œæ­¤æ—¶å¯èƒ½æ–°å»ºçš„ä¸»é¢˜ç¬¦åˆæ­£åˆ™è§„åˆ™ï¼Œé‚£ä¹ˆåˆä¼šè§¦å‘é‡å¹³è¡¡ã€‚</p></blockquote><h3 id="4ã€-Rebalance-æœºåˆ¶å¸¦æ¥çš„é—®é¢˜"><a href="#4ã€-Rebalance-æœºåˆ¶å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="4ã€ Rebalance æœºåˆ¶å¸¦æ¥çš„é—®é¢˜"></a>4ã€ Rebalance æœºåˆ¶å¸¦æ¥çš„é—®é¢˜</h3><blockquote><p>åœ¨ Rebalance è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…æ— æ³•ä» Kafka ä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¿™å¯¹ Kafka çš„ TPS å½±å“æå¤§ï¼Œä¸” Rebalance çš„æ—¶é—´ä¼šéšç€ Kafka é›†ç¾¤èŠ‚ç‚¹çš„å¢å¤šè€Œå˜é•¿ï¼Œåœ¨ Rebalance æ—¶é—´å†… Kafka å‡ ä¹å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</p><p>æ‰€ä»¥åœ¨å®é™…ç¯å¢ƒä¸­åº”è¯¥å°½é‡é¿å… Rebalance çš„å‘ç”Ÿã€‚</p></blockquote><h3 id="5ã€æ¶ˆè´¹è€…æ¶ˆè´¹åˆ†åŒºçš„ä¸‰ç§ç­–ç•¥"><a href="#5ã€æ¶ˆè´¹è€…æ¶ˆè´¹åˆ†åŒºçš„ä¸‰ç§ç­–ç•¥" class="headerlink" title="5ã€æ¶ˆè´¹è€…æ¶ˆè´¹åˆ†åŒºçš„ä¸‰ç§ç­–ç•¥"></a>5ã€æ¶ˆè´¹è€…æ¶ˆè´¹åˆ†åŒºçš„ä¸‰ç§ç­–ç•¥</h3><blockquote><p>åœ¨è§¦å‘ Rebalance æœºåˆ¶ä¹‹å‰ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹å“ªä¸ªåˆ†åŒºæœ‰ä¸‰ç§ç­–ç•¥</p></blockquote><ul><li><p><code>range</code> ï¼š é€šè¿‡å…¬å¼æ¥è®¡ç®—æŸä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹å“ªä¸ªåˆ†åŒº</p></li><li><p><code>è½®è¯¢</code> ï¼šæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…è½®æµæ¶ˆè´¹</p></li><li><p><code>sticky</code> ï¼š åœ¨è§¦å‘ rebalance åï¼Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹çš„åŸåˆ†åŒºä¸å˜çš„åŸºç¡€ä¸Šè¿›è¡Œè°ƒæ•´</p></li></ul><blockquote><p>å¦‚æœè¿™ä¸ªç­–ç•¥æ²¡æœ‰å¼€å¯ï¼Œé‚£ä¹ˆå°±è¦è¿›è¡Œæ‰€æœ‰åˆ†åŒºçš„é‡æ–°åˆ†é…ï¼Œå»ºè®®å¼€å¯ã€‚</p></blockquote><h2 id="6-3ã€HW-ä¸-LEO"><a href="#6-3ã€HW-ä¸-LEO" class="headerlink" title="6.3ã€HW ä¸ LEO"></a>6.3ã€HW ä¸ LEO</h2><h3 id="1ã€åŸºæœ¬æ¦‚å¿µ"><a href="#1ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1ã€åŸºæœ¬æ¦‚å¿µ"></a>1ã€åŸºæœ¬æ¦‚å¿µ</h3><ul><li>Base Offset</li></ul><blockquote><p><strong>èµ·å§‹åç§»é‡ï¼Œå³å‰¯æœ¬ä¸­ç¬¬ä¸€æ¡æ¶ˆæ¯çš„åç§»é‡</strong>ï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™é‡Œçš„èµ·å§‹ä½ç§»æ˜¯ 0ï¼Œå¦‚æœä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å†™æ»¡ 1G åï¼ˆé»˜è®¤ 1G åä¼š log rollingï¼‰ï¼Œè¿™ä¸ªèµ·å§‹ä½ç§»å°±ä¸æ˜¯ 0 å¼€å§‹äº†ã€‚</p></blockquote><ul><li>HWï¼ˆ<code>high watermark</code>ï¼‰</li></ul><blockquote><p>å‰¯æœ¬çš„é«˜æ°´ä½å€¼ï¼Œreplica ä¸­ Leader å‰¯æœ¬å’Œ Follower å‰¯æœ¬éƒ½ä¼šæœ‰è¿™ä¸ªå€¼ï¼Œé€šè¿‡å®ƒå¯ä»¥å¾—çŸ¥å‰¯æœ¬ä¸­å·²æäº¤æˆ–è€…å·²å¤‡ä»½æ¶ˆæ¯çš„èŒƒå›´ï¼Œ Leader å‰¯æœ¬ä¸­çš„ HW ï¼Œå†³å®šäº†æ¶ˆè´¹è€…èƒ½æ¶ˆè´¹çš„æœ€æ–°æ¶ˆæ¯èƒ½åˆ°å“ªä¸ª offset ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒHW å€¼ä¸º 8 ï¼Œä»£è¡¨ offset ä¸º [0,8] çš„ 9 æ¡æ¶ˆæ¯éƒ½èƒ½è¢«æ¶ˆè´¹åˆ°ï¼Œå®ƒä»¬æ˜¯å¯¹æ¶ˆè´¹è€…å¯è§çš„ï¼Œè€Œ [9,12] è¿™å››æ¡æ¶ˆæ¯ç”±äºæœªæäº¤ï¼Œæ‰€ä»¥å¯¹æ¶ˆè´¹è€…ä¸å¯è§ã€‚</p></blockquote><ul><li>LEO ï¼ˆ<code>log end offset</code>ï¼‰</li></ul><blockquote><p><strong>æ—¥å¿—æœ«ç«¯ä½ç§»ï¼Œä»£è¡¨æ—¥å¿—æ–‡ä»¶ä¸­ä¸‹ä¸€æ¡å¾…å†™å…¥æ¶ˆæ¯çš„ offset ï¼Œè¿™ä¸ª offset å®é™…ä¸Šæ˜¯æ²¡æœ‰æ¶ˆæ¯çš„</strong></p><p>ä¸ç®¡æ˜¯ Leader å‰¯æœ¬è¿˜æ˜¯ Follower å‰¯æœ¬éƒ½æœ‰ LEO ï¼Œå½“ Leader å‰¯æœ¬æ”¶åˆ°ç”Ÿäº§è€…çš„ä¸€æ¡æ¶ˆæ¯æ—¶ï¼ŒLEO é€šå¸¸ä¼šè‡ªå¢ 1 ï¼Œè€Œ Follower å‰¯æœ¬éœ€è¦ä» Leader å‰¯æœ¬åŒæ­¥åˆ°æ•°æ®åï¼Œæ‰èƒ½å¢åŠ å®ƒçš„ LEO ã€‚</p><p>æœ€å Leader å‰¯æœ¬ä¼šæ¯”è¾ƒè‡ªå·±çš„ LEO å’Œæ»¡è¶³æ¡ä»¶çš„ Follower å‰¯æœ¬ä¸Šçš„ LEO ï¼Œç„¶åé€‰å–ä¸¤è€…ä¸­è¾ƒå°å€¼ä½œä¸ºæ–°çš„ HW ï¼Œæ¥æ›´æ–°è‡ªå·±çš„ HW å€¼ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211011230226.png" alt="image-20211011194242472"></p><h3 id="2ã€ä¸ºä»€ä¹ˆå¯¹äºæ–°å†™å…¥çš„æ¶ˆæ¯ä¸èƒ½ç«‹å³æ¶ˆè´¹ï¼Ÿ"><a href="#2ã€ä¸ºä»€ä¹ˆå¯¹äºæ–°å†™å…¥çš„æ¶ˆæ¯ä¸èƒ½ç«‹å³æ¶ˆè´¹ï¼Ÿ" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆå¯¹äºæ–°å†™å…¥çš„æ¶ˆæ¯ä¸èƒ½ç«‹å³æ¶ˆè´¹ï¼Ÿ"></a>2ã€ä¸ºä»€ä¹ˆå¯¹äºæ–°å†™å…¥çš„æ¶ˆæ¯ä¸èƒ½ç«‹å³æ¶ˆè´¹ï¼Ÿ</h3><blockquote><p>å¯¹äºæ–°å†™å…¥åˆ° Leader å‰¯æœ¬çš„æ¶ˆæ¯ï¼Œä¸èƒ½ç›´æ¥äº¤ç»™ Consumer è¿›è¡Œæ¶ˆè´¹ï¼Œ<strong>Leader ä¼šç­‰å¾…è¯¥æ¶ˆæ¯è¢«æ‰€æœ‰ Isr åˆ—è¡¨ä¸­çš„å‰¯æœ¬åŒæ­¥åï¼Œå†æ›´æ–° HW ï¼Œæ­¤æ—¶æ¶ˆæ¯æ‰èƒ½è¢« Consumer è¿›è¡Œæ¶ˆè´¹ã€‚</strong></p><p><strong>è¿™æ ·å°±ä¿è¯äº†å¦‚æœ Leader æ‰€åœ¨çš„ Broker æŒ‚æ‰ï¼Œè¯¥æ¶ˆæ¯ä»ç„¶å¯ä»¥ä»æ–°é€‰ä¸¾çš„ Leader ä¸­è·å–</strong>ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ã€‚</p></blockquote><h1 id="ä¸ƒã€Kafka-ç›¸å…³é—®é¢˜"><a href="#ä¸ƒã€Kafka-ç›¸å…³é—®é¢˜" class="headerlink" title="ä¸ƒã€Kafka ç›¸å…³é—®é¢˜"></a>ä¸ƒã€Kafka ç›¸å…³é—®é¢˜</h1><h2 id="7-1ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±"><a href="#7-1ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±" class="headerlink" title="7.1ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±"></a>7.1ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±</h2><h3 id="1ã€ç”Ÿäº§è€…"><a href="#1ã€ç”Ÿäº§è€…" class="headerlink" title="1ã€ç”Ÿäº§è€…"></a>1ã€ç”Ÿäº§è€…</h3><ul><li>å°† <code>acks</code> è®¾ç½® <code>1</code> æˆ–è€… <code>-1 / all</code> å¯ä»¥æœ‰æ•ˆé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±</li><li>å¦‚æœè¦åšåˆ° <code>99.9999%</code> ï¼Œé‚£ä¹ˆå¯ä»¥å°† <code>acks</code> è®¾ç½®ä¸º all ï¼Œç„¶åå°† <code>min.insync.replicas</code> è®¾ç½®ä¸ºåˆ†åŒºå¤‡ä»½æ•°</li></ul><blockquote><p>è¿™æ ·åšï¼Œåªæœ‰ç­‰å¾…ä¸Šä¸€æ¡æ¶ˆæ¯è¢«æ‰€æœ‰å‰¯æœ¬åŒæ­¥å®Œåï¼Œæ‰èƒ½å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚</p></blockquote><h3 id="2ã€æ¶ˆè´¹è€…"><a href="#2ã€æ¶ˆè´¹è€…" class="headerlink" title="2ã€æ¶ˆè´¹è€…"></a>2ã€æ¶ˆè´¹è€…</h3><blockquote><p>å°†è‡ªåŠ¨æäº¤æ”¹ä¸ºæ‰‹åŠ¨æäº¤</p></blockquote><h2 id="7-2ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹"><a href="#7-2ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹" class="headerlink" title="7.2ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹"></a>7.2ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹</h2><blockquote><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹æƒ…å†µ</p></blockquote><ol><li>ç”Ÿäº§è€…å‘ Kafka é›†ç¾¤ä¸­æŠ•é€’æ¶ˆæ¯ï¼ŒKafka å·²ç»æ¥æ”¶åˆ°äº†è¿™æ¡æ¶ˆæ¯ï¼Œå¹¶è¿”å›ç»™å‘é€è€…ä¸€ä¸ª ack</li><li>æ­¤æ—¶å› ä¸ºç½‘ç»œåŠ¨è¡ï¼Œå¯¼è‡´ç”Ÿäº§è€…æ²¡æœ‰æ”¶åˆ°è¿™ä¸ª ack ï¼Œæ‰€ä»¥ç”Ÿäº§è€…å¯åŠ¨äº†é‡å‘æœºåˆ¶ï¼Œå†æ¬¡å‘é€ä¸€æ¡æ¶ˆæ¯åˆ° Kafka ä¸­ï¼Œè¿™æ ·å°±å¯¼è‡´äº† Kafka æ”¶åˆ°äº†ä¸¤æ¡ä¸€æ¨¡ä¸€æ ·çš„æ¶ˆæ¯</li></ol><blockquote><p>å¦‚æœä¸ºäº†æ¶ˆæ¯çš„ä¸é‡å¤æ¶ˆè´¹ï¼Œâ½½æŠŠâ½£äº§ç«¯çš„é‡è¯•æœºåˆ¶å…³é—­ã€æ¶ˆè´¹ç«¯çš„â¼¿åŠ¨æäº¤æ”¹æˆâ¾ƒåŠ¨æäº¤ï¼Œè¿™æ ·åâ½½ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±ï¼Œé‚£ä¹ˆ<strong>å¯ä»¥ç›´æ¥åœ¨é˜²æ²»æ¶ˆæ¯ä¸¢å¤±çš„â¼¿æ®µä¸Šå†åŠ ä¸Šæ¶ˆè´¹æ¶ˆæ¯æ—¶çš„å¹‚ç­‰æ€§ä¿è¯ï¼Œå°±èƒ½è§£å†³æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹é—®é¢˜</strong>ã€‚</p></blockquote><ul><li>ä½¿ç”¨ MySQL æ’å…¥ä¸šåŠ¡ id ä½œä¸ºä¸»é”®ï¼Œä¸»é”®æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸€æ¬¡åªèƒ½æ’å…¥ä¸€æ¡</li><li>ä½¿ç”¨ Redis æˆ–è€… Zookeeper çš„åˆ†å¸ƒå¼é”ï¼Œä»¥ä¸šåŠ¡ id ä¸ºé”ï¼Œä¿è¯åªæœ‰ä¸€æ¡è®°å½•èƒ½å¤Ÿåˆ›å»ºæˆåŠŸ</li><li>æ„å»ºå¹‚ç­‰è¡¨ä¿è¯å¹‚ç­‰æ€§</li></ul><h2 id="7-3ã€å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹"><a href="#7-3ã€å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹" class="headerlink" title="7.3ã€å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹"></a>7.3ã€å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹</h2><h3 id="1ã€ç”Ÿäº§è€…-1"><a href="#1ã€ç”Ÿäº§è€…-1" class="headerlink" title="1ã€ç”Ÿäº§è€…"></a>1ã€ç”Ÿäº§è€…</h3><blockquote><p>åœ¨å‘é€æ—¶ä¸èƒ½å°† <code>ack</code> è®¾ç½®ä¸º 0 ï¼ŒåŒæ—¶éœ€è¦å…³é—­é‡è¯•ï¼Œå¹¶ä½¿ç”¨åŒæ­¥å‘é€ï¼Œç­‰åˆ°å‘é€æˆåŠŸåå†å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œ<strong>ç¡®ä¿æ¶ˆæ¯æ˜¯é¡ºåºå‘é€çš„ã€‚</strong></p></blockquote><h3 id="2ã€æ¶ˆè´¹è€…-1"><a href="#2ã€æ¶ˆè´¹è€…-1" class="headerlink" title="2ã€æ¶ˆè´¹è€…"></a>2ã€æ¶ˆè´¹è€…</h3><blockquote><p><strong>æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªåˆ†åŒºä¸­ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹ç»„é‡Œçš„æ¶ˆè´¹è€…æ¥æ¥æ”¶æ¶ˆæ¯</strong>ï¼Œå› æ­¤ï¼ŒKafka çš„é¡ºåºæ¶ˆè´¹ä¼šç‰ºç‰²æ‰ä¸€éƒ¨åˆ†æ€§èƒ½ã€‚</p></blockquote><h2 id="7-4ã€å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹é—®é¢˜"><a href="#7-4ã€å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹é—®é¢˜" class="headerlink" title="7.4ã€å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹é—®é¢˜"></a>7.4ã€å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹é—®é¢˜</h2><h3 id="1ã€é—®é¢˜è¯´æ˜"><a href="#1ã€é—®é¢˜è¯´æ˜" class="headerlink" title="1ã€é—®é¢˜è¯´æ˜"></a>1ã€é—®é¢˜è¯´æ˜</h3><blockquote><p>æ¶ˆæ¯çš„æ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦è¿œè¿œèµ¶ä¸ä¸Šç”Ÿäº§è€…çš„ç”Ÿäº§æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œå¯¼è‡´ <code>Kafka</code> ä¸­æœ‰å¤§é‡çš„æ•°æ®æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œéšç€æ²¡æœ‰è¢«æ¶ˆè´¹çš„æ•°æ®å †ç§¯è¶Šæ¥è¶Šå¤šï¼Œæ¶ˆè´¹è€…å¯»å€çš„æ€§èƒ½ä¼šè¶Šæ¥è¶Šå·®ï¼Œæœ€åå¯¼è‡´æ•´ä¸ª <code>Kafka</code> å¯¹å¤–æä¾›æœåŠ¡çš„æ€§èƒ½è¶Šæ¥è¶Šå·®ï¼Œä»è€Œæ‹–å®å…¶ä»–æœåŠ¡ï¼Œé€ æˆæœåŠ¡é›ªå´©</p></blockquote><h3 id="2ã€è§£å†³æ–¹æ¡ˆ"><a href="#2ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h3><blockquote><p>æ¶ˆæ¯ç§¯å‹ä¼šå¯¼è‡´å¾ˆå¤šé—®é¢˜ï¼Œâ½å¦‚ç£ç›˜è¢«æ‰“æ»¡ã€â½£äº§ç«¯å‘æ¶ˆæ¯å¯¼è‡´ <code>Kafka</code> æ€§èƒ½è¿‡æ…¢ï¼Œå°±å®¹æ˜“å‡ºç°æœåŠ¡é›ªå´©ï¼Œå°±éœ€è¦æœ‰ç›¸åº”çš„â¼¿æ®µï¼š</p></blockquote><ul><li>â½…æ¡ˆâ¼€ï¼šåœ¨â¼€ä¸ªæ¶ˆè´¹è€…ä¸­å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œè®©å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹ï¼ˆæå‡â¼€ä¸ªæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½â¼’ï¼‰ï¼Œå……åˆ†åˆ©ç”¨æœºå™¨çš„æ€§èƒ½ã€‚</li><li>â½…æ¡ˆâ¼†ï¼šå¦‚æœâ½…æ¡ˆâ¼€è¿˜ä¸å¤Ÿçš„è¯ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚å…¶å®å¤šä¸ªæ¶ˆè´¹è€…éƒ¨ç½²åœ¨åŒâ¼€æœåŠ¡å™¨ä¸Šä¹Ÿå¯ä»¥æâ¾¼æ¶ˆè´¹èƒ½â¼’ï¼ˆå……åˆ†åˆ©â½¤æœåŠ¡å™¨çš„ <code>cpu</code> èµ„æºï¼‰ã€‚</li><li>â½…æ¡ˆä¸‰ï¼šè®©â¼€ä¸ªæ¶ˆè´¹è€…å»æŠŠæ”¶åˆ°çš„æ¶ˆæ¯å¾€å¦å¤–â¼€ä¸ª <code>topic</code> ä¸Šå‘ï¼Œå¦â¼€ä¸ª <code>topic</code> è®¾ç½®å¤šä¸ªåˆ†åŒºå’Œå¤šä¸ªæ¶ˆè´¹è€… ï¼Œè¿›â¾å…·ä½“çš„ä¸šåŠ¡æ¶ˆè´¹ã€‚</li></ul><h2 id="7-5ã€Kafka-ä¸ºä»€ä¹ˆå¿«ï¼Ÿ"><a href="#7-5ã€Kafka-ä¸ºä»€ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="7.5ã€Kafka ä¸ºä»€ä¹ˆå¿«ï¼Ÿ"></a>7.5ã€Kafka ä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h2><blockquote><p>Kafka ä¸»è¦åšäº† 4 ä¸ªä¼˜åŒ–</p></blockquote><ul><li>ç£ç›˜é¡ºåºè¯»å†™</li><li>é¡µç¼“å­˜</li><li>é›¶æ‹·è´</li><li>æ‰¹é‡æ“ä½œ</li></ul><h3 id="1ã€ç£ç›˜é¡ºåºè¯»å†™"><a href="#1ã€ç£ç›˜é¡ºåºè¯»å†™" class="headerlink" title="1ã€ç£ç›˜é¡ºåºè¯»å†™"></a>1ã€ç£ç›˜é¡ºåºè¯»å†™</h3><blockquote><p>Kafka è¿›è¡Œçš„ç¬¬ä¸€ä¸ªä¼˜åŒ–å°±æ˜¯<strong>ç£ç›˜é¡ºåºè¯»å†™</strong>ï¼Œåœ¨ä¼ ç»Ÿè®¤çŸ¥ä¸­ï¼Œç£ç›˜çš„è¯»å–æ•ˆç‡åº”è¯¥è¿œä½äºå†…å­˜ï¼Œä½† 2019 å¹´ <a target="_blank" rel="noopener" href="https://queue.acm.org/detail.cfm?id=1563874">ACM æœºæ„çš„è°ƒç ”</a>ä¸­è¡¨æ˜ï¼Œç£ç›˜é¡ºåºè¯»å†™çš„æ•ˆç‡è™½ç„¶è¿œä¸åŠå†…å­˜é¡ºåºè¯»å†™çš„æ•ˆç‡ï¼Œä½†å‰è€…çš„æ•ˆç‡æ˜¯è¦ç•¥é«˜äºå†…å­˜éšæœºè¯»å†™çš„æ•ˆç‡çš„ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211011230251.png" alt="image-20211011211150388"></p><blockquote><p>ä¸Šé¢çš„æ–‡ç« åœ¨ä¸€å®šç¨‹åº¦ä¸ŠæŒ‡å¯¼äº† Kafka åé¢çš„è®¾è®¡ï¼Œ<strong>Kafka åŸºäºé¡ºåºè¯»å†™å®ç°é«˜æ€§èƒ½</strong>ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211011230308.png" alt="image-20211011211432085"></p><blockquote><p>æ¯ä¸€ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªæ—¥å¿—ï¼Œæ–°æ¶ˆæ¯åˆ°æ¥ååœ¨æ—¥å¿—åé¢è¿›è¡Œé¡ºåºè¿½åŠ ï¼Œè€Œå¯¹äºå·²ç»æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ï¼ŒKafka å¹¶ä¸å¯¹å…¶è¿›è¡Œå®æ—¶åœ°æ•°æ®åˆ é™¤ï¼Œè€Œæ˜¯åŸºäºæŸäº›ç­–ç•¥ï¼ˆå­˜æ”¾æ—¶é—´ã€æ—¥å¿—å¤§å°ç­‰ï¼‰æ¥å¯¹è¿™äº›å·²ç»æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯è¿›è¡Œç»Ÿä¸€æ‰¹é‡åˆ é™¤ã€‚</p></blockquote><h3 id="2ã€é¡µç¼“å­˜"><a href="#2ã€é¡µç¼“å­˜" class="headerlink" title="2ã€é¡µç¼“å­˜"></a>2ã€é¡µç¼“å­˜</h3><blockquote><p>è™½ç„¶ Kafka æ˜¯åŸºäº Scala ç¼–å†™ï¼Œ<strong>å¿…é¡»ä¾èµ– JVM è¿è¡Œçš„åº”ç”¨</strong>ï¼Œä½† <strong>Kafka ä¸­çš„æ¶ˆæ¯åœ¨å¤„ç†æŠ•é€’è¿‡ç¨‹ä¸­å¹¶ä¸ç›´æ¥é€šè¿‡ JVM</strong> ï¼Œè€Œæ˜¯<strong>ç›´æ¥ä½¿ç”¨ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ç‰¹æ€§æ¥æé«˜å¤„ç†é€Ÿåº¦</strong>ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„æœ‰ä»€ä¹ˆ?</p></blockquote><ul><li>é¿å…äº† JVM GC å¸¦æ¥çš„æ€§èƒ½æŸè€—</li><li>Kafka é‡‡ç”¨å­—èŠ‚ç´§å¯†å­˜å‚¨ï¼Œé¿å…äº§ç”Ÿå¯¹è±¡ï¼Œè¿›ä¸€æ­¥æé«˜äº†ç©ºé—´åˆ©ç”¨ç‡</li></ul><h3 id="3ã€é›¶æ‹·è´"><a href="#3ã€é›¶æ‹·è´" class="headerlink" title="3ã€é›¶æ‹·è´"></a>3ã€é›¶æ‹·è´</h3><blockquote><p>åœ¨è¿›è¡Œæ•°æ®ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œä¸å†å‘ç”Ÿå†…æ ¸æ€ - ç”¨æˆ·æ€çš„è½¬å˜ï¼Œè€Œæ˜¯ç›´æ¥å°†é¡µç¼“å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ° Socket ç¼“å†²åŒºã€‚</p><p><strong>è¿™é‡Œçš„é›¶æ‹·è´ä¸æ˜¯è¯´ä¸å‘ç”Ÿå¤åˆ¶ï¼Œè€Œæ˜¯è¯´ä¸å†å‘ç”Ÿä¸ç”¨æˆ·æ€å‘ç”Ÿçš„æ•°æ®æ‹·è´</strong>ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211011230350.png" alt="image-20211011212557504"></p><h3 id="4ã€æ‰¹å¤„ç†"><a href="#4ã€æ‰¹å¤„ç†" class="headerlink" title="4ã€æ‰¹å¤„ç†"></a>4ã€æ‰¹å¤„ç†</h3><ul><li>Kafka åœ¨ç”Ÿäº§è€…ç«¯è®¾ç½®æœ‰æœ¬åœ°ç¼“å­˜ï¼ŒåŒæ—¶ä¼šé‡‡ç”¨çº¿ç¨‹å¼‚æ­¥å°†æ•°æ®æ‰¹é‡æäº¤åˆ° Broker çš„æ–¹å¼æé«˜æ€§èƒ½</li><li>Kafka æä¾›äº†è®¸å¤šæ‰¹å¤„ç†çš„ API ï¼Œå¯ä»¥è®©æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œç»Ÿä¸€çš„å‹ç¼©å’Œåˆå¹¶ï¼Œè®©æ•°æ®é€šè¿‡æ›´å°çš„æ•°æ®åŒ…æ¥è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œæé«˜äº†æ€§èƒ½</li></ul><h2 id="7-6ã€Kafka-çš„å¹‚ç­‰æ€§"><a href="#7-6ã€Kafka-çš„å¹‚ç­‰æ€§" class="headerlink" title="7.6ã€Kafka çš„å¹‚ç­‰æ€§"></a>7.6ã€Kafka çš„å¹‚ç­‰æ€§</h2><h3 id="1ã€Kafka-ç”Ÿäº§è€…å¹‚ç­‰æ€§"><a href="#1ã€Kafka-ç”Ÿäº§è€…å¹‚ç­‰æ€§" class="headerlink" title="1ã€Kafka ç”Ÿäº§è€…å¹‚ç­‰æ€§"></a>1ã€Kafka ç”Ÿäº§è€…å¹‚ç­‰æ€§</h3><blockquote><p>åœ¨ç”Ÿäº§è€…å‘ Kafka å‘é€æ¶ˆæ¯è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼ŒKafka é›†ç¾¤å·²ç»æ¥æ”¶åˆ°äº†è¿™æ¡æ¶ˆæ¯ï¼ŒåŒæ—¶å·²ç»å°†å…¶å†™å…¥æ—¥å¿—äº†ï¼Œä½†åœ¨å‘ç”Ÿäº§è€…è¿”å› <code>ack</code> çš„è¿‡ç¨‹ä¸­ç”±äºæŸäº›åŸå›  <code>ack</code> ä¸¢å¤±å¯¼è‡´ç”Ÿäº§è€…æ²¡æœ‰æ¥æ”¶åˆ° <code>ack</code>ï¼Œæ­¤æ—¶ç”Ÿäº§è€…ä¼šå¯åŠ¨é‡è¯•æœºåˆ¶ï¼Œå¦‚æœ Kafka æ— æ³•ä¿è¯å¹‚ç­‰æ€§ï¼Œé‚£ä¹ˆå¯èƒ½åœ¨ partition ä¸­ä¼šä¿å­˜å¤šæ¡ä¸€æ¨¡ä¸€æ ·çš„æ¶ˆæ¯ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233223.png" alt="image-20211012160455192"></p><h3 id="2ã€ç”Ÿäº§è€…é…ç½®å¹‚ç­‰æ€§"><a href="#2ã€ç”Ÿäº§è€…é…ç½®å¹‚ç­‰æ€§" class="headerlink" title="2ã€ç”Ÿäº§è€…é…ç½®å¹‚ç­‰æ€§"></a>2ã€ç”Ÿäº§è€…é…ç½®å¹‚ç­‰æ€§</h3><ul><li>åªéœ€è¦åœ¨ç”Ÿäº§è€…ç«¯æ·»åŠ ä¸€ä¸ªé…ç½®å³å¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.put(ENABLE_IDEMPOTENCE_CONFIG, <span class="keyword">true</span>)</span><br></pre></td></tr></table></figure><h3 id="3ã€Kafka-ä¿è¯å¹‚ç­‰æ€§çš„åŸç†"><a href="#3ã€Kafka-ä¿è¯å¹‚ç­‰æ€§çš„åŸç†" class="headerlink" title="3ã€Kafka ä¿è¯å¹‚ç­‰æ€§çš„åŸç†"></a>3ã€Kafka ä¿è¯å¹‚ç­‰æ€§çš„åŸç†</h3><blockquote><p>ä¸ºå®ç°ç”Ÿäº§è€…çš„å¹‚ç­‰æ€§ï¼Œ Kafka å¼•å…¥äº† Producer ID ï¼ˆPIDï¼‰å’Œ Sequence Number ä¸¤ä¸ªæ¦‚å¿µã€‚</p></blockquote><ul><li>PIDï¼š<strong>æ¯ä¸ª Producer åœ¨åˆå§‹åŒ–æ—¶ï¼Œéƒ½ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ PIDï¼Œè¿™ä¸ª PID å¯¹ç”¨æˆ·æ¥è¯´ï¼Œæ˜¯é€æ˜çš„</strong>ã€‚</li><li>Sequence Numberï¼šé’ˆå¯¹æ¯ä¸ªç”Ÿäº§è€…ï¼ˆå¯¹åº” PID ï¼‰å‘é€åˆ°æŒ‡å®šä¸»é¢˜åˆ†åŒºçš„æ¶ˆæ¯éƒ½å¯¹åº”ä¸€ä¸ªä» 0 å¼€å§‹é€’å¢çš„ Sequence Numberã€‚</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233242.png" alt="image-20211012161500813"></p><ul><li>åœ¨ç”Ÿäº§è€…å‘ Broker å‘é€æ¶ˆæ¯æ—¶ï¼Œ**ä¼šå°†è‡ªå·±çš„ PID å’Œæ­¤æ¡æ¶ˆæ¯çš„åºåˆ—å·ä¸€èµ·å‘é€ç»™ Broker **</li><li>Broker æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†æ¶ˆæ¯ã€ PID å’Œ åºåˆ—å·ä¸€èµ·ä¿å­˜</li><li>Broker å‘ç”Ÿäº§è€…è¿”å›ä¸€ä¸ªå‘é€æˆåŠŸçš„ ACK ï¼Œä½†è¿™ä¸ª ACK åœ¨è¿”å›è¿‡ç¨‹ä¸­å› ä¸ºæŸä¸ªåŸå› ä¸¢å¤±äº†ï¼Œæ²¡æœ‰é€åˆ°ç”Ÿäº§è€…æ‰‹ä¸Š</li><li>ç”Ÿäº§è€…æ”¶ä¸åˆ° ACK ï¼Œä»¥ä¸ºæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œæ‰€ä»¥å¯åŠ¨é‡è¯•æœºåˆ¶ï¼Œåœ¨å‘é€çš„æ¶ˆæ¯ä¸­åŒæ ·å¸¦ä¸Šè‡ªå·±çš„ PID å’Œæ¶ˆæ¯çš„åºåˆ—å·ï¼ˆPID: 250, seq: 0ï¼‰</li><li>Broker æ¥æ”¶åˆ°é‡å‘æ¶ˆæ¯åï¼Œæ£€æŸ¥è¿™æ¡æ¶ˆæ¯çš„ PID å’Œ seq ï¼Œå‘ç°è¿™æ¡æ¶ˆæ¯çš„ seq &lt;= åˆ†åŒºä¸­è¯¥ PID å¯¹åº”çš„ seq ï¼Œæ‰€ä»¥ä¸è¿›è¡Œä¿å­˜</li><li>Broker å‘ç”Ÿäº§è€…å‘é€ä¸€ä¸ª ACK</li></ul><h2 id="7-7ã€Kafka-çš„æ•°æ®å­˜å‚¨å½¢å¼"><a href="#7-7ã€Kafka-çš„æ•°æ®å­˜å‚¨å½¢å¼" class="headerlink" title="7.7ã€Kafka çš„æ•°æ®å­˜å‚¨å½¢å¼"></a>7.7ã€Kafka çš„æ•°æ®å­˜å‚¨å½¢å¼</h2><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233317.png" alt="image-20211012164238789"></p><ul><li>ä¸€ä¸ª <code>Topic</code> ç”±å¤šä¸ªåˆ†åŒºç»„æˆ</li><li>ä¸€ä¸ªåˆ†åŒºï¼ˆpartitionï¼‰ç”±å¤šä¸ª <code>segment</code> ï¼ˆæ®µï¼‰ç»„æˆ</li><li>ä¸€ä¸ª <code>segment</code>ï¼ˆæ®µï¼‰ç”±å¤šä¸ªæ–‡ä»¶ç»„æˆï¼ˆ<code>logã€indexã€timeindex</code>ï¼‰</li></ul><h3 id="1ã€å­˜å‚¨æ—¥å¿—"><a href="#1ã€å­˜å‚¨æ—¥å¿—" class="headerlink" title="1ã€å­˜å‚¨æ—¥å¿—"></a>1ã€å­˜å‚¨æ—¥å¿—</h3><blockquote><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Kafka ä¸­çš„æ•°æ®æ˜¯å¦‚ä½•åœ¨ç£ç›˜ä¸­è¿›è¡Œå­˜å‚¨çš„ï¼Œè¿›å…¥ Kafka å®‰è£…ç›®å½•ä¸‹çš„ <code>data/kafka-logs</code> æ–‡ä»¶å¤¹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‘½åçš„æ–‡ä»¶å¤¹ï¼Œè¿™äº›å°±æ˜¯ Kafka ä¸­çš„æ¶ˆæ¯åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œ<strong>æ–‡ä»¶å¤¹ä»¥ <code>ä¸»é¢˜å</code> - <code>åˆ†åŒº ID</code> çš„æ ¼å¼å‘½å</strong>ï¼Œä¸‹é¢å°±æ˜¯ Kafka ä¸­ <code>my-replicated-topic</code> ä¸»é¢˜ä¸‹ä¸¤ä¸ªåˆ†åŒºçš„ç‰©ç†å­˜å‚¨ç›®å½•ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233340.png" alt="image-20211012164657651"></p><blockquote><p>è¿›å…¥å…¶ä¸­ä¸€ä¸ªç›®å½•ï¼ŒæŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œä¸€ä¸€ä»‹ç»</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233354.png" alt="image-20211012164920515"></p><table><thead><tr><th align="center">æ–‡ä»¶å</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">00000000000000000000.index</td><td align="center">ç´¢å¼•æ–‡ä»¶ï¼Œæ ¹æ® offset æŸ¥æ‰¾æ•°æ®æ—¶å°±æ˜¯æ ¹æ®è¯¥ç´¢å¼•æ–‡ä»¶æ¥æ“ä½œçš„</td></tr><tr><td align="center">00000000000000000000.log</td><td align="center">æ—¥å¿—æ•°æ®æ–‡ä»¶ï¼ŒçœŸæ­£å­˜æ”¾æ¶ˆæ¯æ•°æ®çš„æ–‡ä»¶</td></tr><tr><td align="center">00000000000000000000.timeindex</td><td align="center">æ—¶é—´ç´¢å¼•æ–‡ä»¶</td></tr><tr><td align="center">00000000000000000001.snapshot</td><td align="center">å¿«ç…§æ–‡ä»¶</td></tr><tr><td align="center">leader-epoch-checkpoint</td><td align="center">æŒä¹…åŒ–æ¯ä¸ª partition leader çš„ LEO</td></tr></tbody></table><ul><li><strong>segment æ˜¯å‡ ä¸ªæ–‡ä»¶åä¸€è‡´çš„æ–‡ä»¶çš„é›†åˆ</strong>ã€‚åœ¨ä¸€ä¸ªåˆ†åŒºæ–‡ä»¶å¤¹ä¸‹ ï¼ˆ<code>my-replicated-topic-0</code> ï¼‰å¯èƒ½å¯ä»¥çœ‹åˆ°å‰ç¼€ä¸€æ ·ï¼Œä½†æ–‡ä»¶ç±»å‹çš„å‡ ä¸ªæ–‡ä»¶ï¼Œ**è¿™ç§å‰ç¼€ç›¸åŒï¼Œä½†æ–‡ä»¶ç±»å‹ä¸åŒçš„å‡ ä¸ªæ–‡ä»¶ç»„åˆèµ·æ¥ï¼Œå°±ç§°ä¹‹ä¸ºä¸€ä¸ª segment **</li></ul><blockquote><p>å‡è®¾è¯´ä¸€ä¸ªåˆ†åŒºæ–‡ä»¶å¤¹ä¸‹ï¼Œæœ‰ 6 ä¸ªè¿™æ ·çš„æ–‡ä»¶ï¼ˆç®€åŒ–å®ƒä»¬çš„æ–‡ä»¶åï¼‰ï¼Œåˆ†åˆ«ä¸ºï¼ˆa.indexã€a.logã€a.timeindexã€b.indexã€b.logã€b.timeindexï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªåˆ†åŒºä¸­æœ‰ä¸¤ä¸ª segment ï¼Œå³ a æ®µï¼ˆa.indexã€a.logã€a.timeindexï¼‰å’Œ b æ®µï¼ˆb.indexã€b.logã€b.timeindexï¼‰ã€‚</p></blockquote><ul><li>æ¯ä¸ª segment æ–‡ä»¶çš„æ–‡ä»¶åå›ºå®šæ˜¯ 20 ä½æ•°å­—ï¼Œé€šå¸¸ä¸º 0â€¦â€¦.xx.abc ï¼Œæ–‡ä»¶åä»£è¡¨è¿™ä¸ª segment çš„èµ·å§‹åç§»é‡ï¼Œå› ä¸ºæ¯ä¸ªåˆ†åŒºçš„èµ·å§‹åç§»é‡éƒ½æ˜¯ 0 ï¼Œæ‰€ä»¥åˆ†åŒºçš„æ—¥å¿—æ–‡ä»¶å›ºå®šä» <code>0000000000000000000.log</code> å¼€å§‹</li></ul><blockquote><p><code>00000000000000000097.log</code> ä»£è¡¨è¿™ä¸ª segment çš„ç¬¬ä¸€æ¡æ¶ˆæ¯çš„åç§»é‡ä¸º 97</p></blockquote><ul><li>é»˜è®¤çš„æ¯ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§ä¸ºã€Œlog.segment.bytes =1024 * 1024 * 1024ã€1G</li></ul><h3 id="2ã€å†™å…¥æ¶ˆæ¯"><a href="#2ã€å†™å…¥æ¶ˆæ¯" class="headerlink" title="2ã€å†™å…¥æ¶ˆæ¯"></a>2ã€å†™å…¥æ¶ˆæ¯</h3><ul><li>æ–°çš„æ¶ˆæ¯æ€»æ˜¯å†™å…¥åˆ°æœ€åä¸€ä¸ª segment çš„ log æ–‡ä»¶ä¸­</li><li>å¦‚æœè¯¥æ–‡ä»¶åˆ°è¾¾äº†æŒ‡å®šçš„å¤§å°ï¼ˆé»˜è®¤ä¸º 1 GBï¼‰ï¼Œé‚£ä¹ˆå°†æ»šåŠ¨åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ã€‚</li></ul><h3 id="3ã€è¯»å–æ¶ˆæ¯"><a href="#3ã€è¯»å–æ¶ˆæ¯" class="headerlink" title="3ã€è¯»å–æ¶ˆæ¯"></a>3ã€è¯»å–æ¶ˆæ¯</h3><blockquote><p>æ—¥å¿—æ®µ segment çš„å¼•å…¥æ–¹ä¾¿äº† Kafka æ•°æ®çš„æŸ¥è¯¢å’Œå®šä½ï¼ŒKafka ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥æŸ¥è¯¢æ¶ˆæ¯ã€‚</p><p>Kafka çš„æ—¥å¿—æ®µåˆåˆ†ä¸ºæ´»è·ƒæ—¥å¿—æ®µå’Œéæ´»è·ƒæ—¥å¿—æ®µï¼Œ<strong>ä¸€ä¸ªåˆ†åŒºåªèƒ½å­˜åœ¨ä¸€ä¸ªæ´»è·ƒæ—¥å¿—æ®µï¼Œè€Œåªæœ‰æ´»è·ƒæ—¥å¿—æ®µæ‰å¯ä»¥è¢«å†™å…¥å’Œè¯»å–ï¼Œéæ´»è·ƒæ—¥å¿—æ®µåªèƒ½è¢«è¯»å–</strong>ã€‚</p></blockquote><ul><li>ä½¿ç”¨ Offset æŸ¥æ‰¾æ¶ˆæ¯</li></ul><blockquote><p>åç§»é‡ç´¢å¼•æ–‡ä»¶ç”± 4 å­—èŠ‚çš„ç›¸å¯¹ä½ç§»ï¼ˆoffsetï¼‰å’Œ 4 å­—èŠ‚çš„ç‰©ç†åœ°å€ï¼ˆpositionï¼‰ç»„æˆã€‚</p><p>åœ¨æˆ‘ä»¬ä½¿ç”¨ kafka-run-class.sh æ¥æŸ¥çœ‹ .index æ–‡ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å†…å®¹</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-run-class.sh kafka.tools.DumpLogSegments --files /usr/local/kafka-2.5.1/data/kafka-logs/my-replicated-topic-0/00000000000000000000.index</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹åˆ°æ¯ä¸€è¡Œéƒ½æ˜¯ offset: xxx position: yyyy ï¼Œå…¶ä¸­ offset ä¸ºç›¸å¯¹åç§»é‡ï¼Œè€Œ position ä¸ºç‰©ç†åœ°å€</p><p>ç¬¬ä¸€è¡Œçš„ offset: 12 position: 4423 ä»£è¡¨ç›¸å¯¹åç§»é‡ä» 0 - 12 çš„æ¶ˆæ¯çš„ç‰©ç†åœ°å€åœ¨ 0 - 4423</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233420.png" alt="image-20211012171900217"></p><blockquote><p>æŒ‰ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚ä½•æ‰¾åˆ° offset ä¸º 60 çš„æ¶ˆæ¯ï¼Ÿ</p></blockquote><ol><li>å…ˆæ ¹æ® offset æ‰¾åˆ°å¯¹åº”çš„æ—¥å¿—æ®µï¼Œå³ segment ï¼Œè¿™é‡Œæˆ‘ä»¬æ‰¾åˆ° 00000000000000000000.index</li><li>é€šè¿‡äºŒåˆ†æ³•æ‰¾åˆ°ä¸å¤§äº offset çš„æœ€å¤§ç´¢å¼•é¡¹ï¼Œè¿™é‡Œæˆ‘ä»¬æ‰¾åˆ°ç¬¬äºŒè¡Œï¼ˆoffsetï¼š24 positionï¼š8773ï¼‰</li><li>åˆ° 00000000000000000000.log æ–‡ä»¶ä¸­ï¼Œä» position ä¸º 8773 çš„ä½ç½®å¼€å§‹é¡ºåºæ‰«æï¼Œç›´åˆ°æ‰¾åˆ° offset ä¸º 60 çš„æ¶ˆæ¯</li></ol><ul><li>ä½¿ç”¨ TimeStamp è¿›è¡Œæ¶ˆæ¯æŸ¥æ‰¾</li></ul><blockquote><p>æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶æ˜¯ç”± 8 å­—èŠ‚çš„æ—¶é—´æˆ³å’Œ 4 å­—èŠ‚çš„ç›¸å¯¹åç§»é‡ç»„æˆï¼Œdump ä¸‹æ¥çš„æ–‡ä»¶æ ¼å¼å¦‚ä¸‹</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233436.png" alt="image-20211012173318334"></p><ol><li>æŸ¥æ‰¾è¯¥æ—¶é—´æˆ³åº”è¯¥åœ¨å“ªä¸ª segment ä¸­ï¼Œå°†å¾…æŸ¥æ‰¾çš„æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ä¸å„ä¸ªæ—¥å¿—åˆ†æ®µä¸­çš„æœ€å¤§æ—¶é—´æˆ³ï¼ˆlargestTimeStampï¼‰é€ä¸€å¯¹æ¯”ï¼Œç›´åˆ°æ‰¾åˆ°ä¸å°äº timestamp æ‰€å¯¹åº”çš„æ—¥å¿—åˆ†æ®µã€‚</li><li>æŸ¥æ‰¾è¯¥æ—¥å¿—åˆ†æ®µçš„åç§»é‡ç´¢å¼•æ–‡ä»¶ï¼ŒæŸ¥æ‰¾è¯¥åç§»é‡å¯¹åº”çš„ position</li><li>åˆ° .log æ–‡ä»¶ä¸­ï¼Œä» position å¼€å§‹æ‰«æï¼Œç›´åˆ°æ‰¾åˆ°å¾…æŸ¥æ‰¾æ•°æ®</li></ol><h3 id="4ã€åˆ é™¤æ¶ˆæ¯"><a href="#4ã€åˆ é™¤æ¶ˆæ¯" class="headerlink" title="4ã€åˆ é™¤æ¶ˆæ¯"></a>4ã€åˆ é™¤æ¶ˆæ¯</h3><ul><li>åœ¨æ¶ˆæ¯è¢«æ¶ˆè´¹åï¼Œ<strong>Kafka ä¸ä¼šå®æ—¶åˆ é™¤å·²ç»è¢«æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ï¼Œè€Œæ˜¯å®šæœŸæ¸…ç†ï¼Œä¸€æ¬¡æ€§åˆ é™¤ä¸€ä¸ª segment çš„æ—¥å¿—æ–‡ä»¶</strong></li><li>Kafka çš„æ—¥å¿—ç®¡ç†å™¨ä¼šæ ¹æ® Kafka çš„é…ç½®ï¼Œæ¥å†³å®šå“ªäº›æ–‡ä»¶å¯ä»¥è¢«åˆ é™¤ã€‚</li></ul><h2 id="7-8ã€Kafka-ä¸­æ•°æ®æ¸…ç†ï¼ˆLog-Deletionï¼‰"><a href="#7-8ã€Kafka-ä¸­æ•°æ®æ¸…ç†ï¼ˆLog-Deletionï¼‰" class="headerlink" title="7.8ã€Kafka ä¸­æ•°æ®æ¸…ç†ï¼ˆLog Deletionï¼‰"></a>7.8ã€Kafka ä¸­æ•°æ®æ¸…ç†ï¼ˆLog Deletionï¼‰</h2><blockquote><p><code>Kafka</code> çš„<strong>æ¶ˆæ¯å­˜å‚¨åœ¨ç£ç›˜</strong>ä¸­ï¼Œä¸ºäº†<strong>æ§åˆ¶ç£ç›˜å ç”¨ç©ºé—´</strong>ï¼Œ<code>Kafka</code> <strong>éœ€è¦ä¸æ–­åœ°å¯¹è¿‡å»çš„ä¸€äº›æ¶ˆæ¯è¿›è¡Œæ¸…ç†å·¥ä½œ</strong>ã€‚</p><p>Kafka çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰å¾ˆå¤šçš„æ—¥å¿—æ–‡ä»¶ï¼Œè¿™æ ·ä¹Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿è¿›è¡Œæ—¥å¿—çš„æ¸…ç†ã€‚åœ¨Kafka ä¸­ï¼Œæä¾›ä¸¤ç§æ—¥å¿—æ¸…ç†æ–¹å¼ï¼š</p></blockquote><ul><li>æ—¥å¿—åˆ é™¤</li></ul><blockquote><p>æŒ‰ç…§æŒ‡å®šçš„ç­–ç•¥ç›´æ¥åˆ é™¤ä¸ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—</p></blockquote><ul><li>æ—¥å¿—å‹ç¼©</li></ul><blockquote><p>æŒ‰ç…§æ¶ˆæ¯çš„ Key è¿›è¡Œæ•´åˆï¼Œå¦‚æœé‡åˆ°æœ‰ç›¸åŒ Key ä½†æœ‰ä¸åŒ value çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆåªä¿ç•™æœ€åä¸€ä¸ªç‰ˆæœ¬</p></blockquote><h3 id="1ã€Kafka-æ•°æ®æ¸…ç†é…ç½®"><a href="#1ã€Kafka-æ•°æ®æ¸…ç†é…ç½®" class="headerlink" title="1ã€Kafka æ•°æ®æ¸…ç†é…ç½®"></a>1ã€Kafka æ•°æ®æ¸…ç†é…ç½®</h3><blockquote><p>åœ¨ Kafka çš„ Broker å’Œ Topic é…ç½®ä¸­</p></blockquote><table><thead><tr><th align="center">é…ç½®é¡¹</th><th align="center">é…ç½®å€¼</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">log.cleaner.enable</td><td align="center">trueï¼ˆé»˜è®¤ï¼‰</td><td align="center">æ˜¯å¦å¼€å¯æ—¥å¿—æ¸…ç†åŠŸèƒ½</td></tr><tr><td align="center">log.cleanup.policy</td><td align="center">deleteï¼ˆé»˜è®¤ï¼‰</td><td align="center">åˆ é™¤æ—¥å¿—</td></tr><tr><td align="center">log.cleanup.policy</td><td align="center">compaction</td><td align="center">å‹ç¼©æ—¥å¿—</td></tr><tr><td align="center">log.cleanup.policy</td><td align="center">delete,compact</td><td align="center">åŒæ—¶æ”¯æŒå‹ç¼©å’Œåˆ é™¤</td></tr></tbody></table><h3 id="2ã€æ—¥å¿—åˆ é™¤"><a href="#2ã€æ—¥å¿—åˆ é™¤" class="headerlink" title="2ã€æ—¥å¿—åˆ é™¤"></a>2ã€æ—¥å¿—åˆ é™¤</h3><blockquote><p><strong>æ—¥å¿—åˆ é™¤æ˜¯ä»¥æ®µä¸ºå•ä½è¿›è¡Œå®šæœŸæ¸…ç†</strong></p></blockquote><ul><li>å®šæ—¶æ—¥å¿—åˆ é™¤ä»»åŠ¡</li></ul><blockquote><p>Kafka æ—¥å¿—ç®¡ç†å™¨ä¸­ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„æ—¥å¿—åˆ é™¤ä»»åŠ¡æ¥å®šæœŸæ£€æµ‹å’Œåˆ é™¤ä¸ç¬¦åˆä¿ç•™æ¡ä»¶çš„æ—¥å¿—åˆ†æ®µæ–‡ä»¶ï¼Œè¿™ä¸ªå‘¨æœŸå¯ä»¥é€šè¿‡ <code>broker</code> ç«¯å‚æ•° <code>log.retention.check.interval.ms</code> æ¥é…ç½®ï¼Œé»˜è®¤å€¼ä¸º <code>300,000</code> ï¼Œå³5åˆ†é’Ÿã€‚å½“å‰æ—¥å¿—åˆ†æ®µçš„ä¿ç•™ç­–ç•¥æœ‰3ç§ï¼š</p></blockquote><ol><li>åŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥</li><li>åŸºäºæ—¥å¿—å¤§å°çš„ä¿ç•™ç­–ç•¥</li><li>åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡çš„ä¿ç•™ç­–ç•¥</li></ol><h3 id="3ã€åŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥"><a href="#3ã€åŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥" class="headerlink" title="3ã€åŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥"></a>3ã€åŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥</h3><blockquote><p>ä»¥ä¸‹ä¸‰ç§é…ç½®å¯ä»¥æŒ‡å®šå¦‚æœ Kafka ä¸­çš„æ¶ˆæ¯è¶…è¿‡æŒ‡å®šçš„é˜ˆå€¼ï¼Œå°±ä¼šå°†æ—¥å¿—è¿›è¡Œè‡ªåŠ¨æ¸…ç†ï¼š</p></blockquote><ul><li><p>log.retention.hours</p></li><li><p>log.retention.minutes</p></li><li><p>log.retention.ms</p></li></ul><blockquote><p>å…¶ä¸­ï¼Œä¼˜å…ˆçº§ <code>log.retention.ms &gt; log.retention.minutes &gt; log.retention.hours</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ broker ä¸­é…ç½®ä¸º <code>log.retention.hours = 168</code>ï¼Œå³æ—¥å¿—é»˜è®¤ä¿ç•™ 168 å°æ—¶ï¼Œç›¸å½“äºä¿ç•™ä¸ƒå¤©</p></blockquote><ul><li>åˆ é™¤æ—¥å¿—åˆ†æ®µæ—¶</li></ul><ol><li>ä»æ—¥å¿—æ–‡ä»¶å¯¹è±¡ä¸­æ‰€ç»´æŠ¤æ—¥å¿—åˆ†æ®µçš„è·³è·ƒè¡¨ä¸­ç§»é™¤å¾…åˆ é™¤çš„æ—¥å¿—åˆ†æ®µï¼Œä»¥ä¿è¯æ²¡æœ‰çº¿ç¨‹å¯¹è¿™äº›æ—¥å¿—åˆ†æ®µè¿›è¡Œè¯»å–æ“ä½œ</li><li>å°†æ—¥å¿—åˆ†æ®µæ–‡ä»¶æ·»åŠ ä¸Šâ€œ.deletedâ€çš„åç¼€ï¼ˆä¹ŸåŒ…æ‹¬æ—¥å¿—åˆ†æ®µå¯¹åº”çš„ç´¢å¼•æ–‡ä»¶ï¼‰</li><li>Kafka çš„åå°å®šæ—¶ä»»åŠ¡ä¼šå®šæœŸåˆ é™¤è¿™äº›â€œ.deletedâ€ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œè¿™ä¸ªä»»åŠ¡çš„å»¶è¿Ÿæ‰§è¡Œæ—¶é—´å¯ä»¥é€šè¿‡ <code>file.delete.delay.ms</code> å‚æ•°æ¥è®¾ç½®ï¼Œé»˜è®¤å€¼ä¸º60000ï¼Œå³1åˆ†é’Ÿã€‚</li></ol><h3 id="4ã€åŸºäºæ—¥å¿—å¤§å°çš„ä¿ç•™ç­–ç•¥"><a href="#4ã€åŸºäºæ—¥å¿—å¤§å°çš„ä¿ç•™ç­–ç•¥" class="headerlink" title="4ã€åŸºäºæ—¥å¿—å¤§å°çš„ä¿ç•™ç­–ç•¥"></a>4ã€åŸºäºæ—¥å¿—å¤§å°çš„ä¿ç•™ç­–ç•¥</h3><ul><li>æ—¥å¿—åˆ é™¤ä»»åŠ¡ä¼šæ£€æŸ¥å½“å‰æ—¥å¿—çš„å¤§å°æ˜¯å¦è¶…è¿‡è®¾å®šçš„é˜ˆå€¼æ¥å¯»æ‰¾å¯åˆ é™¤çš„æ—¥å¿—åˆ†æ®µçš„æ–‡ä»¶é›†åˆã€‚</li><li>å¯ä»¥é€šè¿‡ <code>broker</code> ç«¯å‚æ•° <code>log.retention.bytes</code> æ¥é…ç½®ï¼Œé»˜è®¤å€¼ä¸º <code>-1</code>ï¼Œè¡¨ç¤ºæ— ç©·å¤§ã€‚å¦‚æœè¶…è¿‡è¯¥å¤§å°ï¼Œä¼šè‡ªåŠ¨å°†è¶…å‡ºéƒ¨åˆ†åˆ é™¤ã€‚</li></ul><blockquote><p>æ³¨æ„ï¼š<code>log.retention.bytes</code> é…ç½®çš„æ˜¯æ—¥å¿—æ–‡ä»¶çš„æ€»å¤§å°ï¼Œè€Œä¸æ˜¯å•ä¸ªçš„æ—¥å¿—åˆ†æ®µçš„å¤§å°ï¼Œä¸€ä¸ªæ—¥å¿—æ–‡ä»¶åŒ…å«å¤šä¸ªæ—¥å¿—åˆ†æ®µã€‚</p></blockquote><h3 id="5ã€åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡ä¿ç•™ç­–ç•¥"><a href="#5ã€åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡ä¿ç•™ç­–ç•¥" class="headerlink" title="5ã€åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡ä¿ç•™ç­–ç•¥"></a>5ã€åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡ä¿ç•™ç­–ç•¥</h3><blockquote><p>æ¯ä¸ª <code>segment</code> æ—¥å¿—éƒ½æœ‰å®ƒçš„èµ·å§‹åç§»é‡ï¼Œå¦‚æœèµ·å§‹åç§»é‡å°äº logStartOffsetï¼Œé‚£ä¹ˆè¿™äº›æ—¥å¿—æ–‡ä»¶å°†ä¼šæ ‡è®°ä¸ºåˆ é™¤ã€‚</p></blockquote><h3 id="6ã€æ—¥å¿—å‹ç¼©"><a href="#6ã€æ—¥å¿—å‹ç¼©" class="headerlink" title="6ã€æ—¥å¿—å‹ç¼©"></a>6ã€æ—¥å¿—å‹ç¼©</h3><blockquote><p>Log Compaction æ˜¯é»˜è®¤çš„æ—¥å¿—åˆ é™¤ä¹‹å¤–çš„æ¸…ç†è¿‡æ—¶æ•°æ®çš„æ–¹å¼ã€‚å®ƒä¼šå°†ç›¸åŒçš„ key å¯¹åº”çš„æ•°æ®åªä¿ç•™ä¸€ä¸ªç‰ˆæœ¬ã€‚</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012233455.png" alt="image-20211012191155887"></p><ul><li><strong>Log Compactionæ‰§è¡Œåï¼Œoffsetå°†ä¸å†è¿ç»­ï¼Œä½†ä¾ç„¶å¯ä»¥æŸ¥è¯¢Segment</strong></li><li>Log Compactionæ‰§è¡Œå‰åï¼Œæ—¥å¿—åˆ†æ®µä¸­çš„æ¯æ¡æ¶ˆæ¯åç§»é‡ä¿æŒä¸å˜ã€‚Log Compactionä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Segmentæ–‡ä»¶</li><li>Log Compactionæ˜¯é’ˆå¯¹keyçš„ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™æ³¨æ„æ¯ä¸ªæ¶ˆæ¯çš„keyä¸ä¸ºç©º</li><li>åŸºäº Log Compaction å¯ä»¥ä¿ç•™keyçš„æœ€æ–°æ›´æ–°ï¼Œå¯ä»¥åŸºäºLog Compactionæ¥æ¢å¤æ¶ˆè´¹è€…çš„æœ€æ–°çŠ¶æ€</li></ul></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Javaåº”ç”¨å­¦ä¹ ï¼ˆåä¸€ï¼‰-Kafka å­¦ä¹ ç¬”è®°äºŒ</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://sutianxin.top/posts/2701940507.html">https://sutianxin.top/posts/2701940507.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="display:inline-block;width:120px"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>å¤©æ˜•</h></div></div><div class="post-copyright-c" style="display:inline-block;width:120px"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2021-10-12</h></div></div><div class="post-copyright-u" style="display:inline-block;width:120px"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2021-10-12</h></div></div><div class="post-copyright-c" style="display:inline-block;width:120px"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%F0%9F%93%AB%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">ğŸ“«æ¶ˆæ¯é˜Ÿåˆ—</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012235444.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/1637503980.html"><img class="prev-cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012234835.jpg" onerror='onerror=null,src="https://gitee.com/sutianxin/blogImage/raw/master/20210430103138.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Javaåº”ç”¨å­¦ä¹ ï¼ˆåï¼‰-Kafka å­¦ä¹ ç¬”è®°ä¸€</div></div></a></div><div class="next-post pull-right"><a href="/posts/3469350670.html"><img class="next-cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012234202.jpg" onerror='onerror=null,src="https://gitee.com/sutianxin/blogImage/raw/master/20210430103138.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆåå››ï¼‰</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/1637503980.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆåï¼‰-Kafka å­¦ä¹ ç¬”è®°ä¸€"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/img/20211012234835.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-12</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆåï¼‰-Kafka å­¦ä¹ ç¬”è®°ä¸€</div></div></a></div><div><a href="/posts/1158970579.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆäº”ï¼‰-RabbitMQå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210320231831.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-20</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆäº”ï¼‰-RabbitMQå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰</div></div></a></div><div><a href="/posts/1280028895.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆå…­ï¼‰-RabbitMQå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/blogImage/raw/master/20210504190053.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-23</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆå…­ï¼‰-RabbitMQå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Kafka-%E7%9A%84-Java-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">å››ã€Kafka çš„ Java å®¢æˆ·ç«¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E3%80%81%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">4.1ã€ç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1ã€å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0"><span class="toc-text">2ã€åŸºæœ¬å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%88%B0%E6%8C%87%E5%AE%9A%E5%88%86%E5%8C%BA%E4%B8%8A"><span class="toc-text">3ã€å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šåˆ†åŒºä¸Š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%90%8C%E6%AD%A5%E5%8F%91%E9%80%81"><span class="toc-text">4ã€åŒæ­¥å‘é€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%BC%82%E6%AD%A5%E5%8F%91%E6%B6%88%E6%81%AF"><span class="toc-text">5ã€å¼‚æ­¥å‘æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%85%B3%E4%BA%8E%E7%94%9F%E4%BA%A7%E8%80%85%E7%9A%84-ACK-%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-text">6ã€å…³äºç”Ÿäº§è€…çš„ ACK å‚æ•°é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82"><span class="toc-text">9ã€å…¶ä»–ç»†èŠ‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">4.2ã€æ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0"><span class="toc-text">1ã€åŸºæœ¬å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Kafka-%E6%B6%88%E8%B4%B9%E8%80%85-offset-%E7%9A%84%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4%E5%92%8C%E6%89%8B%E5%8A%A8%E6%8F%90%E4%BA%A4"><span class="toc-text">2ã€Kafka æ¶ˆè´¹è€… offset çš„è‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85-poll-%E6%B6%88%E6%81%AF%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-text">3ã€æ¶ˆè´¹è€… poll æ¶ˆæ¯çš„è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85%E6%8C%87%E5%AE%9A%E4%B8%BB%E9%A2%98%E7%9A%84%E5%88%86%E5%8C%BA%E8%BF%9B%E8%A1%8C%E6%B6%88%E8%B4%B9"><span class="toc-text">4ã€æ¶ˆè´¹è€…æŒ‡å®šä¸»é¢˜çš„åˆ†åŒºè¿›è¡Œæ¶ˆè´¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%B6%88%E6%81%AF%E7%9A%84%E5%9B%9E%E6%BA%AF%E6%B6%88%E8%B4%B9"><span class="toc-text">5ã€æ¶ˆæ¯çš„å›æº¯æ¶ˆè´¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%8C%87%E5%AE%9A%E6%96%B0%E6%B6%88%E8%B4%B9%E7%BB%84%E7%9A%84%E6%B6%88%E8%B4%B9%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="toc-text">6ã€æŒ‡å®šæ–°æ¶ˆè´¹ç»„çš„æ¶ˆè´¹åç§»é‡</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81Spring-Boot-%E4%BD%BF%E7%94%A8-Kafka"><span class="toc-text">äº”ã€Spring Boot ä½¿ç”¨ Kafka</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1%E3%80%81%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="toc-text">5.1ã€å‰æœŸå‡†å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2%E3%80%81%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">5.2ã€åˆ›å»ºé…ç½®æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%94%9F%E4%BA%A7%E8%80%85%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-text">1ã€ç”Ÿäº§è€…ç›¸å…³é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-text">2ã€æ¶ˆè´¹è€…ç›¸å…³é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%A2%9D%E5%A4%96%E9%85%8D%E7%BD%AE"><span class="toc-text">3ã€é¢å¤–é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%AE%8C%E6%95%B4%E9%85%8D%E7%BD%AE"><span class="toc-text">4ã€å®Œæ•´é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81Kafka-%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="toc-text">5ã€Kafka æ¶ˆè´¹æ¨¡å¼ä»‹ç»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3%E3%80%81%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">5.3ã€æ¶ˆæ¯ç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4%E3%80%81%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">5.4ã€æ¶ˆæ¯æ¶ˆè´¹è€…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">5.5ã€æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85%E7%9A%84%E8%AF%A6%E7%BB%86%E9%85%8D%E7%BD%AE"><span class="toc-text">5.6ã€æ¶ˆè´¹è€…çš„è¯¦ç»†é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81Kafka-%E5%8F%8A%E9%9B%86%E7%BE%A4-Controller-%E3%80%81-Rebalance-%E5%92%8C-HW"><span class="toc-text">å…­ã€Kafka åŠé›†ç¾¤ Controller ã€ Rebalance å’Œ HW</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1%E3%80%81Controller"><span class="toc-text">6.1ã€Controller</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%A6%82%E5%BF%B5"><span class="toc-text">1ã€æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%81%8C%E8%B4%A3"><span class="toc-text">2ã€èŒè´£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2%E3%80%81Rebalance-%E6%9C%BA%E5%88%B6"><span class="toc-text">6.2ã€Rebalance æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%A7%A6%E5%8F%91%E5%89%8D%E6%8F%90"><span class="toc-text">1ã€è§¦å‘å‰æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">2ã€æ˜¯ä»€ä¹ˆ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6"><span class="toc-text">3ã€è§¦å‘æ¡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81-Rebalance-%E6%9C%BA%E5%88%B6%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">4ã€ Rebalance æœºåˆ¶å¸¦æ¥çš„é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85%E6%B6%88%E8%B4%B9%E5%88%86%E5%8C%BA%E7%9A%84%E4%B8%89%E7%A7%8D%E7%AD%96%E7%95%A5"><span class="toc-text">5ã€æ¶ˆè´¹è€…æ¶ˆè´¹åˆ†åŒºçš„ä¸‰ç§ç­–ç•¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3%E3%80%81HW-%E4%B8%8E-LEO"><span class="toc-text">6.3ã€HW ä¸ LEO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">1ã€åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AF%B9%E4%BA%8E%E6%96%B0%E5%86%99%E5%85%A5%E7%9A%84%E6%B6%88%E6%81%AF%E4%B8%8D%E8%83%BD%E7%AB%8B%E5%8D%B3%E6%B6%88%E8%B4%B9%EF%BC%9F"><span class="toc-text">2ã€ä¸ºä»€ä¹ˆå¯¹äºæ–°å†™å…¥çš„æ¶ˆæ¯ä¸èƒ½ç«‹å³æ¶ˆè´¹ï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81Kafka-%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="toc-text">ä¸ƒã€Kafka ç›¸å…³é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1%E3%80%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1"><span class="toc-text">7.1ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">1ã€ç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">2ã€æ¶ˆè´¹è€…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2%E3%80%81%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E6%B6%88%E6%81%AF%E7%9A%84%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9"><span class="toc-text">7.2ã€å¦‚ä½•é˜²æ­¢æ¶ˆæ¯çš„é‡å¤æ¶ˆè´¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3%E3%80%81%E5%A6%82%E4%BD%95%E5%81%9A%E5%88%B0%E9%A1%BA%E5%BA%8F%E6%B6%88%E8%B4%B9"><span class="toc-text">7.3ã€å¦‚ä½•åšåˆ°é¡ºåºæ¶ˆè´¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%94%9F%E4%BA%A7%E8%80%85-1"><span class="toc-text">1ã€ç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%B6%88%E8%B4%B9%E8%80%85-1"><span class="toc-text">2ã€æ¶ˆè´¹è€…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4%E3%80%81%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B%E9%97%AE%E9%A2%98"><span class="toc-text">7.4ã€å¦‚ä½•è§£å†³æ¶ˆæ¯ç§¯å‹é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%97%AE%E9%A2%98%E8%AF%B4%E6%98%8E"><span class="toc-text">1ã€é—®é¢˜è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">2ã€è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5%E3%80%81Kafka-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB%EF%BC%9F"><span class="toc-text">7.5ã€Kafka ä¸ºä»€ä¹ˆå¿«ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%A3%81%E7%9B%98%E9%A1%BA%E5%BA%8F%E8%AF%BB%E5%86%99"><span class="toc-text">1ã€ç£ç›˜é¡ºåºè¯»å†™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%A1%B5%E7%BC%93%E5%AD%98"><span class="toc-text">2ã€é¡µç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%9B%B6%E6%8B%B7%E8%B4%9D"><span class="toc-text">3ã€é›¶æ‹·è´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%89%B9%E5%A4%84%E7%90%86"><span class="toc-text">4ã€æ‰¹å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-6%E3%80%81Kafka-%E7%9A%84%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-text">7.6ã€Kafka çš„å¹‚ç­‰æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Kafka-%E7%94%9F%E4%BA%A7%E8%80%85%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-text">1ã€Kafka ç”Ÿäº§è€…å¹‚ç­‰æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%94%9F%E4%BA%A7%E8%80%85%E9%85%8D%E7%BD%AE%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-text">2ã€ç”Ÿäº§è€…é…ç½®å¹‚ç­‰æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81Kafka-%E4%BF%9D%E8%AF%81%E5%B9%82%E7%AD%89%E6%80%A7%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">3ã€Kafka ä¿è¯å¹‚ç­‰æ€§çš„åŸç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-7%E3%80%81Kafka-%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%BD%A2%E5%BC%8F"><span class="toc-text">7.7ã€Kafka çš„æ•°æ®å­˜å‚¨å½¢å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AD%98%E5%82%A8%E6%97%A5%E5%BF%97"><span class="toc-text">1ã€å­˜å‚¨æ—¥å¿—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%86%99%E5%85%A5%E6%B6%88%E6%81%AF"><span class="toc-text">2ã€å†™å…¥æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%AF%BB%E5%8F%96%E6%B6%88%E6%81%AF"><span class="toc-text">3ã€è¯»å–æ¶ˆæ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%88%A0%E9%99%A4%E6%B6%88%E6%81%AF"><span class="toc-text">4ã€åˆ é™¤æ¶ˆæ¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-8%E3%80%81Kafka-%E4%B8%AD%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86%EF%BC%88Log-Deletion%EF%BC%89"><span class="toc-text">7.8ã€Kafka ä¸­æ•°æ®æ¸…ç†ï¼ˆLog Deletionï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Kafka-%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86%E9%85%8D%E7%BD%AE"><span class="toc-text">1ã€Kafka æ•°æ®æ¸…ç†é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%97%A5%E5%BF%97%E5%88%A0%E9%99%A4"><span class="toc-text">2ã€æ—¥å¿—åˆ é™¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%9F%BA%E4%BA%8E%E6%97%B6%E9%97%B4%E7%9A%84%E4%BF%9D%E7%95%99%E7%AD%96%E7%95%A5"><span class="toc-text">3ã€åŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%9F%BA%E4%BA%8E%E6%97%A5%E5%BF%97%E5%A4%A7%E5%B0%8F%E7%9A%84%E4%BF%9D%E7%95%99%E7%AD%96%E7%95%A5"><span class="toc-text">4ã€åŸºäºæ—¥å¿—å¤§å°çš„ä¿ç•™ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%9F%BA%E4%BA%8E%E6%97%A5%E5%BF%97%E8%B5%B7%E5%A7%8B%E5%81%8F%E7%A7%BB%E9%87%8F%E4%BF%9D%E7%95%99%E7%AD%96%E7%95%A5"><span class="toc-text">5ã€åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡ä¿ç•™ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%97%A5%E5%BF%97%E5%8E%8B%E7%BC%A9"><span class="toc-text">6ã€æ—¥å¿—å‹ç¼©</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 <i style="color:#ff6a6a;animation:announ_animation .8s linear infinite" class="fa fa-heartbeat"></i> å¤©æ˜•</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢!<span id="runtime"></span><br></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo"></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender"></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr"></a><a class="github-badge" target="_blank" href="https://gitee.com/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Picture-Gitee-0cedbe?style=flat&amp;logo=Gitee"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris"></a></p><div id="workboard"></div><script async src="/js/runtime.js"></script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç°¡</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><script defer src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{const t=document.getElementById("twikoo-count"),o=()=>{twikoo.init({el:"#twikoo-wrap",envId:"blogcomments-2gseqioe1aa55c8c",region:"ap-shanghai"})},e=()=>{twikoo.getCommentsCount({envId:"blogcomments-2gseqioe1aa55c8c",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then(function(o){t.innerText=o[0].count}).catch(function(o){console.error(o)})};var n;n=!0,"object"==typeof twikoo?(o(),n&&t&&setTimeout(e,0)):getScript("https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(()=>{o(),n&&t&&setTimeout(e,0)})})()</script></div><div class="aplayer no-destroy" data-id="6588965546" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" data-lrctype="0" muted></div><script defer src="/live2d-widget/autoload.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/flipcountdown.js"></script><script data-pjax src="/js/runtime.js"></script><script async src="//at.alicdn.com/t/font_2398185_yegv7kt2bj.js"></script><script src="https://apip.weatherdt.com/simple/static/js/weather-simple-common.js?v=2.0"></script><script src="/js/weather.js"></script><script src="/js/custom/runtime.js"></script><script src="https://cdn.jsdelivr.net/gh/weilain/cdn-photo/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/hidescrollbar/hidescrollbar.js"></script><script async src="//at.alicdn.com/t/font_2398185_lld84dtfbb.js"></script><script src="https://www.luckyclover.top/rain.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/shuoshuo/"]):not([href="/bb/"]):not([href="/contact/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:complete",function(){window.refreshFn(),document.querySelectorAll("script[data-pjax], .pjax-reload script").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()}),document.addEventListener("pjax:send",function(){if("object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")}),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script></div><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.10/hexo_githubcalendar.js"></script><script data-pjax>function GithubCalendarConfig(){var e=document.getElementById("recent-posts");e&&e.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_container"></div></div>'),GithubCalendar("https://python-github-calendar-api.vercel.app/api?sutianxin",["#ebedf0","#f1f8ff","#dbedff","#c8e1ff","#79b8ff","#2188ff","#0366d6","#005cc5","#044289","#032f62","#05264c"],"sutianxin")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:120px}}</style></body></html>