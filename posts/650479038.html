<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäºŒï¼‰-ç”¨æˆ·è®¤è¯ | Alexios</title><meta name="keywords" content="â˜•Java,ğŸ’»åç«¯å­¦ä¹ ,ğŸ‘¢Spring Boot,ğŸ†”JWT"><meta name="author" content="å¤©æ˜•"><meta name="copyright" content="å¤©æ˜•"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ä»‹ç»ä¸€ä¸‹Java WEBé˜¶æ®µå¸¸ç”¨çš„å‡ ç§ç™»å½•æ¨¡å¼ï¼Œæ‹ä¸€éjwtæ— çŠ¶æ€ç™»å½•çš„è¿‡ç¨‹å’Œæ€è·¯ã€‚"><meta property="og:type" content="article"><meta property="og:title" content="åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäºŒï¼‰-ç”¨æˆ·è®¤è¯"><meta property="og:url" content="https://sutianxin.top/posts/650479038.html"><meta property="og:site_name" content="Alexios"><meta property="og:description" content="ä»‹ç»ä¸€ä¸‹Java WEBé˜¶æ®µå¸¸ç”¨çš„å‡ ç§ç™»å½•æ¨¡å¼ï¼Œæ‹ä¸€éjwtæ— çŠ¶æ€ç™»å½•çš„è¿‡ç¨‹å’Œæ€è·¯ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205204706.jpg"><meta property="article:published_time" content="2021-02-05T12:43:02.000Z"><meta property="article:modified_time" content="2021-02-11T11:53:31.777Z"><meta property="article:author" content="å¤©æ˜•"><meta property="article:tag" content="â˜•Java"><meta property="article:tag" content="ğŸ’»åç«¯å­¦ä¹ "><meta property="article:tag" content="ğŸ‘¢Spring Boot"><meta property="article:tag" content="ğŸ†”JWT"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205204706.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://sutianxin.top/posts/650479038"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-02-11 19:53:31"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_1.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/zyoushuo/Blog@latest/hexo/css/loading_style_2.css"><link rel="stylesheet" href="/css/cover.css"><link rel="stylesheet" href="/css/copyright.css"><link href="https://cdn.jsdelivr.net/gh/sviptzk/StaticFile_HEXO@latest/butterfly/css/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/flipcountdown.css"><link rel="stylesheet" href="/css/year.css"><link rel="stylesheet" href="/css/Lete.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/PaddyLin-xum/wenjian@master/css/fontanimation.css"><link href="https://cdn.bootcdn.net/ajax/libs/botui/0.3.9/botui-theme-default.css" rel="stylesheet"><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/twikoo.css"><link rel="stylesheet" href="/css/translucent.css"><style>#article-container.post-content h1:before,h2:before,h3:before,h4:before,h5:before,h6:before{-webkit-animation:avatar_turn_around 1s linear infinite;-moz-animation:avatar_turn_around 1s linear infinite;-o-animation:avatar_turn_around 1s linear infinite;-ms-animation:avatar_turn_around 1s linear infinite;animation:avatar_turn_around 1s linear infinite}</style><meta name="generator" content="Hexo 5.3.0"></head><body><a href="javascript:void(0);" onclick="preloader.endLoading()" title="ç‚¹å‡»è·³è¿‡åŠ¨ç”»"><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div></a><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">34</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">15</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa fa-book"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw far fa-calendar-alt"></i><span> å½’æ¡£</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/random/"><i class="fa-fw fa fa-random"></i><span> éšæœºæ–‡ç« </span></a></li><li><a class="site-page" href="/adjust/"><i class="fa-fw fa fa-adjust"></i><span> æ›´æ¢èƒŒæ™¯</span></a></li><li><a class="site-page" href="/statistics/"><i class="fa-fw fa fa-cube"></i><span> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page" href="/bb/"><i class="fa-fw fa fa-mobile"></i><span> ç¢ç¢å¿µ</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-headphones"></i><span> éŸ³ä¹</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cubes"></i><span> ç¤¾äº¤</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></li><li><a class="site-page" href="/fcircle/"><i class="fa-fw fa fa-puzzle-piece"></i><span> æœ‹å‹åœˆ</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205204706.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Alexios</a></span><span id="weather-v2-plugin-simple"></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa fa-book"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw far fa-calendar-alt"></i><span> å½’æ¡£</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/random/"><i class="fa-fw fa fa-random"></i><span> éšæœºæ–‡ç« </span></a></li><li><a class="site-page" href="/adjust/"><i class="fa-fw fa fa-adjust"></i><span> æ›´æ¢èƒŒæ™¯</span></a></li><li><a class="site-page" href="/statistics/"><i class="fa-fw fa fa-cube"></i><span> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page" href="/bb/"><i class="fa-fw fa fa-mobile"></i><span> ç¢ç¢å¿µ</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-headphones"></i><span> éŸ³ä¹</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-cubes"></i><span> ç¤¾äº¤</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></li><li><a class="site-page" href="/fcircle/"><i class="fa-fw fa fa-puzzle-piece"></i><span> æœ‹å‹åœˆ</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäºŒï¼‰-ç”¨æˆ·è®¤è¯</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-02-05T12:43:02.000Z" title="å‘è¡¨äº 2021-02-05 20:43:02">2021-02-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-02-11T11:53:31.777Z" title="æ›´æ–°äº 2021-02-11 19:53:31">2021-02-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/">é¡¹ç›®æ€»ç»“</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">3.2k</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•"><a href="#ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•" class="headerlink" title="ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•"></a>ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•</h1><h2 id="1-1-ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ"><a href="#1-1-ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ" class="headerlink" title="1.1.ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ"></a>1.1.ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ</h2><blockquote><p>æœ‰çŠ¶æ€æœåŠ¡ï¼Œå³æœåŠ¡ç«¯éœ€è¦è®°å½•æ¯æ¬¡ä¼šè¯çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä»è€Œè¯†åˆ«å®¢æˆ·ç«¯èº«ä»½ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½è¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œå…¸å‹çš„è®¾è®¡å¦‚tomcatä¸­çš„sessionã€‚</p><p>ä¾‹å¦‚ç™»å½•ï¼šç”¨æˆ·ç™»å½•åï¼Œæˆ‘ä»¬æŠŠç™»å½•è€…çš„ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡ç«¯sessionä¸­ï¼Œå¹¶ä¸”ç»™ç”¨æˆ·ä¸€ä¸ªcookieå€¼ï¼Œè®°å½•å¯¹åº”çš„sessionã€‚ç„¶åä¸‹æ¬¡è¯·æ±‚ï¼Œç”¨æˆ·æºå¸¦cookieå€¼æ¥ï¼Œæˆ‘ä»¬å°±èƒ½è¯†åˆ«åˆ°å¯¹åº”sessionï¼Œä»è€Œæ‰¾åˆ°ç”¨æˆ·çš„ä¿¡æ¯ã€‚</p></blockquote><p>ç¼ºç‚¹ï¼š</p><ul><li>æœåŠ¡ç«¯ä¿å­˜å¤§é‡æ•°æ®ï¼Œå¢åŠ æœåŠ¡ç«¯å‹åŠ›</li><li>æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œæ— æ³•è¿›è¡Œæ°´å¹³æ‰©å±•</li><li>å®¢æˆ·ç«¯è¯·æ±‚ä¾èµ–æœåŠ¡ç«¯ï¼Œå¤šæ¬¡è¯·æ±‚å¿…é¡»è®¿é—®åŒä¸€å°æœåŠ¡å™¨</li></ul><h2 id="1-2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ"><a href="#1-2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ" class="headerlink" title="1.2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ"></a>1.2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ</h2><blockquote><p>æœåŠ¡å™¨ä¸ä¿å­˜ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼</p><p>å¾®æœåŠ¡é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡ï¼Œå¯¹å¤–æä¾›çš„éƒ½æ˜¯Resté£æ ¼çš„æ¥å£ã€‚è€ŒResté£æ ¼çš„ä¸€ä¸ªæœ€é‡è¦çš„è§„èŒƒå°±æ˜¯ï¼šæœåŠ¡çš„æ— çŠ¶æ€æ€§ï¼Œå³ï¼š</p><ul><li><strong>æœåŠ¡ç«¯ä¸ä¿å­˜ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚è€…ä¿¡æ¯</strong></li><li>å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å¿…é¡»å…·å¤‡è‡ªæè¿°ä¿¡æ¯ï¼ˆjwtï¼‰ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯è¯†åˆ«å®¢æˆ·ç«¯èº«ä»½</li></ul></blockquote><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ— çŠ¶æ€ï¼š tokenæ˜¯æ— çŠ¶æ€ï¼Œsessionæ˜¯æœ‰çŠ¶æ€çš„</li><li>åŸºäºæ ‡å‡†åŒ–ï¼šä½ çš„APIå¯ä»¥é‡‡ç”¨æ ‡å‡†åŒ–çš„ JSON Web Token (JWT)</li><li>å®¢æˆ·ç«¯è¯·æ±‚ä¸ä¾èµ–æœåŠ¡ç«¯çš„ä¿¡æ¯ï¼Œä»»ä½•å¤šæ¬¡è¯·æ±‚ä¸éœ€è¦å¿…é¡»è®¿é—®åˆ°åŒä¸€å°æœåŠ¡</li><li>æœåŠ¡ç«¯çš„é›†ç¾¤å’ŒçŠ¶æ€å¯¹å®¢æˆ·ç«¯é€æ˜</li><li>æœåŠ¡ç«¯å¯ä»¥ä»»æ„çš„è¿ç§»å’Œä¼¸ç¼©</li><li>å‡å°æœåŠ¡ç«¯å­˜å‚¨å‹åŠ›</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å ç”¨å¸¦å®½</li><li>æ— æ³•åœ¨æœåŠ¡å™¨ç«¯é”€æ¯</li></ul><h1 id="äºŒã€å¸¸è§ç™»å½•æ–¹å¼"><a href="#äºŒã€å¸¸è§ç™»å½•æ–¹å¼" class="headerlink" title="äºŒã€å¸¸è§ç™»å½•æ–¹å¼"></a>äºŒã€å¸¸è§ç™»å½•æ–¹å¼</h1><h2 id="2-1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼"><a href="#2-1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼" class="headerlink" title="2.1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼"></a>2.1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼</h2><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205210527.png" alt="image-20210205210527360"></p><p><strong>ä¸€èˆ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š</strong></p><ol><li>ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚</li><li>éªŒè¯æœåŠ¡å™¨åï¼Œç›¸å…³æ•°æ®ï¼ˆå¦‚ç”¨æˆ·åï¼Œç”¨æˆ·è§’è‰²ç­‰ï¼‰å°†ä¿å­˜åœ¨å½“å‰ä¼šè¯ï¼ˆsessionï¼‰ä¸­ã€‚</li><li>æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›session_idï¼Œsessionä¿¡æ¯éƒ½ä¼šå†™å…¥åˆ°ç”¨æˆ·çš„Cookieã€‚</li><li>ç”¨æˆ·çš„æ¯ä¸ªåç»­è¯·æ±‚éƒ½å°†é€šè¿‡åœ¨Cookieä¸­å–å‡ºsession_idä¼ ç»™æœåŠ¡å™¨ã€‚</li><li>æœåŠ¡å™¨æ”¶åˆ°session_idå¹¶å¯¹æ¯”ä¹‹å‰ä¿å­˜çš„æ•°æ®ï¼Œç¡®è®¤ç”¨æˆ·çš„èº«ä»½ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å•ç‚¹æ€§èƒ½å‹åŠ›ï¼Œæ— æ³•æ‰©å±•ã€‚</li><li>åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œéœ€è¦sessionå…±äº«æ–¹æ¡ˆï¼Œsessionå…±äº«æ–¹æ¡ˆå­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚</li></ul><h2 id="2-2ã€å•ç‚¹ç™»å½•ï¼ˆSingle-Sign-Onï¼‰"><a href="#2-2ã€å•ç‚¹ç™»å½•ï¼ˆSingle-Sign-Onï¼‰" class="headerlink" title="2.2ã€å•ç‚¹ç™»å½•ï¼ˆSingle  Sign  Onï¼‰"></a>2.2ã€å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰</h2><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205210648.png" alt="image-20210205210648124"></p><p>åˆ†å¸ƒå¼ï¼ŒSSO(single sign on)æ¨¡å¼ï¼šå•ç‚¹ç™»å½•è‹±æ–‡å…¨ç§°Single Sign Onï¼Œç®€ç§°å°±æ˜¯SSOã€‚å®ƒçš„è§£é‡Šæ˜¯ï¼šåœ¨å¤šä¸ªåº”ç”¨ç³»ç»Ÿä¸­ï¼Œåªéœ€è¦ç™»å½•ä¸€æ¬¡ï¼Œå°±å¯ä»¥è®¿é—®å…¶ä»–ç›¸äº’ä¿¡ä»»çš„åº”ç”¨ç³»ç»Ÿã€‚</p><ul><li>å¦‚å›¾æ‰€ç¤ºï¼Œå›¾ä¸­æœ‰3ä¸ªç³»ç»Ÿï¼Œåˆ†åˆ«æ˜¯ä¸šåŠ¡Aã€ä¸šåŠ¡Bã€å’ŒSSOã€‚</li><li>ä¸šåŠ¡Aã€ä¸šåŠ¡Bæ²¡æœ‰ç™»å½•æ¨¡å—ã€‚</li><li>è€ŒSSOåªæœ‰ç™»å½•æ¨¡å—ï¼Œæ²¡æœ‰å…¶ä»–çš„ä¸šåŠ¡æ¨¡å—ã€‚</li></ul><p><strong>ä¸€èˆ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š</strong></p><ol><li>å½“ä¸šåŠ¡Aã€ä¸šåŠ¡Béœ€è¦ç™»å½•æ—¶ï¼Œå°†è·³åˆ°SSOç³»ç»Ÿã€‚</li><li>SSOä»ç”¨æˆ·ä¿¡æ¯æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ä¿¡æ¯å¹¶æ ¡éªŒç”¨æˆ·ä¿¡æ¯ï¼ŒSSOç³»ç»Ÿå®Œæˆç™»å½•ã€‚</li><li>ç„¶åå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ç¼“å­˜ï¼ˆä¾‹å¦‚redisï¼‰ã€‚</li><li>å½“ç”¨æˆ·è®¿é—®ä¸šåŠ¡Aæˆ–ä¸šåŠ¡Bï¼Œéœ€è¦åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•æ—¶ï¼Œå°†è·³è½¬åˆ°SSOç³»ç»Ÿä¸­è¿›è¡Œç”¨æˆ·èº«ä»½éªŒè¯ï¼ŒSSOåˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚</li><li>è¿™æ ·ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªç³»ç»Ÿå®Œæˆç™»å½•ï¼Œå…¶ä»–çš„åº”ç”¨ç³»ç»Ÿä¹Ÿå°±éšä¹‹ç™»å½•äº†ã€‚è¿™å°±æ˜¯å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰çš„å®šä¹‰ã€‚</li></ol><p><strong>ä¼˜ç‚¹ ï¼š</strong></p><p>ç”¨æˆ·èº«ä»½ä¿¡æ¯ç‹¬ç«‹ç®¡ç†ï¼Œæ›´å¥½çš„åˆ†å¸ƒå¼ç®¡ç†ã€‚å¯ä»¥è‡ªå·±æ‰©å±•å®‰å…¨ç­–ç•¥</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p>è®¤è¯æœåŠ¡å™¨è®¿é—®å‹åŠ›è¾ƒå¤§ã€‚</p><h2 id="2-3ã€Tokenæ¨¡å¼"><a href="#2-3ã€Tokenæ¨¡å¼" class="headerlink" title="2.3ã€Tokenæ¨¡å¼"></a>2.3ã€Tokenæ¨¡å¼</h2><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205210734.png" alt="image-20210205210734269"></p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>æ— çŠ¶æ€ï¼š tokenæ˜¯æ— çŠ¶æ€ï¼Œsessionæ˜¯æœ‰çŠ¶æ€çš„</li><li>åŸºäºæ ‡å‡†åŒ–ï¼šä½ çš„APIå¯ä»¥é‡‡ç”¨æ ‡å‡†åŒ–çš„ JSON Web Token (JWT)</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>å ç”¨å¸¦å®½</li><li>æ— æ³•åœ¨æœåŠ¡å™¨ç«¯é”€æ¯</li></ul><blockquote><p>æ— çŠ¶æ€ç™»å½•çš„æµç¨‹ï¼š</p></blockquote><ul><li>å½“å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æœåŠ¡æ—¶ï¼ŒæœåŠ¡ç«¯å¯¹ç”¨æˆ·è¿›è¡Œä¿¡æ¯è®¤è¯ï¼ˆç™»å½•ï¼‰</li><li>è®¤è¯é€šè¿‡ï¼Œå°†ç”¨æˆ·ä¿¡æ¯è¿›è¡ŒåŠ å¯†å½¢æˆtokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä½œä¸ºç™»å½•å‡­è¯</li><li>ä»¥åæ¯æ¬¡è¯·æ±‚ï¼Œå®¢æˆ·ç«¯éƒ½æºå¸¦è®¤è¯çš„token</li><li>æœåŠ¡çš„å¯¹tokenè¿›è¡Œè§£å¯†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆã€‚</li></ul><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205211358.png" alt="image-20210205211358667"></p><p>æ•´ä¸ªç™»å½•è¿‡ç¨‹ä¸­ï¼Œæœ€å…³é”®çš„ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><strong>tokençš„å®‰å…¨æ€§</strong></p><h1 id="ä¸‰ã€JWT"><a href="#ä¸‰ã€JWT" class="headerlink" title="ä¸‰ã€JWT"></a>ä¸‰ã€JWT</h1><h2 id="3-1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ"><a href="#3-1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ" class="headerlink" title="3.1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ"></a>3.1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ</h2><blockquote><p>JWTæ˜¯JSON Web Tokençš„ç¼©å†™ï¼Œå³JSON Webä»¤ç‰Œï¼Œæ˜¯ä¸€ç§è‡ªåŒ…å«ä»¤ç‰Œã€‚</p></blockquote><h3 id="1ã€ä½¿ç”¨åœºæ™¯"><a href="#1ã€ä½¿ç”¨åœºæ™¯" class="headerlink" title="1ã€ä½¿ç”¨åœºæ™¯"></a>1ã€ä½¿ç”¨åœºæ™¯</h3><ul><li>ä¸€ç§æƒ…å†µæ˜¯webapiï¼Œç±»ä¼¼é˜¿é‡Œäº‘æ’­æ”¾å‡­è¯çš„åŠŸèƒ½ã€‚</li><li>å¦ä¸€ç§æƒ…å†µæ˜¯å¤šwebæœåŠ¡å™¨ä¸‹å®ç°æ— çŠ¶æ€åˆ†å¸ƒå¼èº«ä»½éªŒè¯ã€‚</li></ul><h3 id="2ã€äº¤äº’æµç¨‹"><a href="#2ã€äº¤äº’æµç¨‹" class="headerlink" title="2ã€äº¤äº’æµç¨‹"></a>2ã€äº¤äº’æµç¨‹</h3><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205211838.png" alt="image-20210205211838506"></p><p>æ­¥éª¤ç¿»è¯‘ï¼š</p><ul><li>1ã€ç”¨æˆ·ç™»å½•</li><li>2ã€æœåŠ¡çš„è®¤è¯ï¼Œé€šè¿‡åæ ¹æ®secretç”Ÿæˆtoken</li><li>3ã€å°†ç”Ÿæˆçš„tokenè¿”å›ç»™æµè§ˆå™¨</li><li>4ã€ç”¨æˆ·æ¯æ¬¡è¯·æ±‚æºå¸¦token</li><li>5ã€æœåŠ¡ç«¯åˆ©ç”¨å…¬é’¥è§£è¯»jwtç­¾åï¼Œåˆ¤æ–­ç­¾åæœ‰æ•ˆåï¼Œä»Payloadä¸­è·å–ç”¨æˆ·ä¿¡æ¯</li><li>6ã€å¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ç»“æœ</li></ul><p>å› ä¸ºJWTç­¾å‘çš„tokenä¸­å·²ç»åŒ…å«äº†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæºå¸¦ï¼Œè¿™æ ·æœåŠ¡çš„å°±æ— éœ€ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œç”šè‡³æ— éœ€å»æ•°æ®åº“æŸ¥è¯¢ï¼Œå®Œå…¨ç¬¦åˆäº†Restçš„æ— çŠ¶æ€è§„èŒƒã€‚</p><h3 id="3ã€ä½œç”¨"><a href="#3ã€ä½œç”¨" class="headerlink" title="3ã€ä½œç”¨"></a>3ã€ä½œç”¨</h3><blockquote><p>JWT æœ€é‡è¦çš„ä½œç”¨å°±æ˜¯å¯¹ tokenä¿¡æ¯çš„é˜²ä¼ªä½œç”¨</p></blockquote><h3 id="4ã€åŸç†"><a href="#4ã€åŸç†" class="headerlink" title="4ã€åŸç†"></a>4ã€åŸç†</h3><ul><li>ä¸€ä¸ªJWTç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šJWTå¤´ã€æœ‰æ•ˆè½½è·ã€ç­¾åå“ˆå¸Œ</li><li>æœ€åç”±è¿™ä¸‰è€…ç»„åˆè¿›è¡Œbase64ç¼–ç å¾—åˆ°JWT</li></ul><h2 id="3-2ã€JWTä»¤ç‰Œçš„ç»„æˆ"><a href="#3-2ã€JWTä»¤ç‰Œçš„ç»„æˆ" class="headerlink" title="3.2ã€JWTä»¤ç‰Œçš„ç»„æˆ"></a>3.2ã€JWTä»¤ç‰Œçš„ç»„æˆ</h2><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205212928.png" alt="image-20210205212928770"></p><p><strong>JWTå¤´</strong></p><p>JWTå¤´éƒ¨åˆ†æ˜¯ä¸€ä¸ªæè¿°JWTå…ƒæ•°æ®çš„JSONå¯¹è±¡ï¼Œé€šå¸¸å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œalgå±æ€§è¡¨ç¤ºç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œé»˜è®¤ä¸ºHMAC SHA256ï¼ˆå†™ä¸ºHS256ï¼‰ï¼›typå±æ€§è¡¨ç¤ºä»¤ç‰Œçš„ç±»å‹ï¼ŒJWTä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚æœ€åï¼Œä½¿ç”¨Base64 URLç®—æ³•å°†ä¸Šè¿°JSONå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¿å­˜ã€‚</p><p><strong>æœ‰æ•ˆè½½è·</strong></p><p>æœ‰æ•ˆè½½è·éƒ¨åˆ†ï¼Œæ˜¯JWTçš„ä¸»ä½“å†…å®¹éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼ŒåŒ…å«éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚ JWTæŒ‡å®šä¸ƒä¸ªé»˜è®¤å­—æ®µä¾›é€‰æ‹©ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iss: jwtç­¾å‘è€…</span><br><span class="line">sub: ä¸»é¢˜</span><br><span class="line">aud: æ¥æ”¶jwtçš„ä¸€æ–¹</span><br><span class="line">exp: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´</span><br><span class="line">nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.</span><br><span class="line">iat: jwtçš„ç­¾å‘æ—¶é—´</span><br><span class="line">jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚</span><br></pre></td></tr></table></figure><p>é™¤ä»¥ä¸Šé»˜è®¤å­—æ®µå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç§æœ‰å­—æ®µï¼Œå¦‚ä¸‹ä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;Helen&quot;,</span><br><span class="line">  &quot;admin&quot;: true,</span><br><span class="line">  &quot;avatar&quot;: &quot;helen.jpg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹JWTæ˜¯æœªåŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è§£è¯»å…¶å†…å®¹ï¼Œå› æ­¤ä¸è¦æ„å»ºéšç§ä¿¡æ¯å­—æ®µï¼Œå­˜æ”¾ä¿å¯†ä¿¡æ¯ï¼Œä»¥é˜²æ­¢ä¿¡æ¯æ³„éœ²ã€‚</p><p>JSONå¯¹è±¡ä¹Ÿä½¿ç”¨Base64 URLç®—æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä¿å­˜ã€‚</p><p><strong>ç­¾åå“ˆå¸Œ</strong></p><p>ç­¾åå“ˆå¸Œéƒ¨åˆ†æ˜¯å¯¹ä¸Šé¢ä¸¤éƒ¨åˆ†æ•°æ®ç­¾åï¼Œé€šè¿‡æŒ‡å®šçš„ç®—æ³•ç”Ÿæˆå“ˆå¸Œï¼Œä»¥ç¡®ä¿æ•°æ®ä¸ä¼šè¢«ç¯¡æ”¹ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†ç ï¼ˆsecretï¼‰ã€‚è¯¥å¯†ç ä»…ä»…ä¸ºä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä¸”ä¸èƒ½å‘ç”¨æˆ·å…¬å¼€ã€‚ç„¶åï¼Œä½¿ç”¨æ ‡å¤´ä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸ºHMAC SHA256ï¼‰æ ¹æ®ä»¥ä¸‹å…¬å¼ç”Ÿæˆç­¾åã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(claims), secret)</span><br></pre></td></tr></table></figure><p>åœ¨è®¡ç®—å‡ºç­¾åå“ˆå¸Œåï¼ŒJWTå¤´ï¼Œæœ‰æ•ˆè½½è·å’Œç­¾åå“ˆå¸Œçš„ä¸‰ä¸ªéƒ¨åˆ†ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”¨â€.â€åˆ†éš”ï¼Œå°±æ„æˆæ•´ä¸ªJWTå¯¹è±¡ã€‚</p><p><strong>Base64URLç®—æ³•</strong></p><p>å¦‚å‰æ‰€è¿°ï¼ŒJWTå¤´å’Œæœ‰æ•ˆè½½è·åºåˆ—åŒ–çš„ç®—æ³•éƒ½ç”¨åˆ°äº†Base64URLã€‚è¯¥ç®—æ³•å’Œå¸¸è§Base64ç®—æ³•ç±»ä¼¼ï¼Œç¨æœ‰å·®åˆ«ã€‚</p><p>ä½œä¸ºä»¤ç‰Œçš„JWTå¯ä»¥æ”¾åœ¨URLä¸­ï¼ˆä¾‹å¦‚api.example/?token=xxxï¼‰ã€‚ Base64ä¸­ç”¨çš„ä¸‰ä¸ªå­—ç¬¦æ˜¯â€+â€ï¼Œâ€/â€œå’Œâ€=â€ï¼Œç”±äºåœ¨URLä¸­æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå› æ­¤Base64URLä¸­å¯¹ä»–ä»¬åšäº†æ›¿æ¢ï¼šâ€=â€å»æ‰ï¼Œâ€+â€ç”¨â€-â€œæ›¿æ¢ï¼Œâ€/â€œç”¨â€_â€æ›¿æ¢ï¼Œè¿™å°±æ˜¯Base64URLç®—æ³•ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>base64ç¼–ç ï¼Œå¹¶ä¸æ˜¯åŠ å¯†ï¼Œåªæ˜¯æŠŠæ˜æ–‡ä¿¡æ¯å˜æˆäº†ä¸å¯è§çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯å…¶å®åªè¦ç”¨ä¸€äº›å·¥å…·å°±å¯ä»¥æŠŠbase64ç¼–ç è§£æˆæ˜æ–‡ï¼Œæ‰€ä»¥ä¸è¦åœ¨JWTä¸­æ”¾å…¥æ¶‰åŠç§å¯†çš„ä¿¡æ¯ã€‚</p><h2 id="3-3ã€JWTçš„ç”¨æ³•"><a href="#3-3ã€JWTçš„ç”¨æ³•" class="headerlink" title="3.3ã€JWTçš„ç”¨æ³•"></a>3.3ã€JWTçš„ç”¨æ³•</h2><blockquote><p>å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡å™¨è¿”å›çš„JWTï¼Œå°†å…¶å­˜å‚¨åœ¨Cookieæˆ–localStorageä¸­ã€‚</p><p>æ­¤åï¼Œå®¢æˆ·ç«¯å°†åœ¨ä¸æœåŠ¡å™¨äº¤äº’ä¸­éƒ½ä¼šå¸¦JWTã€‚å¦‚æœå°†å®ƒå­˜å‚¨åœ¨Cookieä¸­ï¼Œå°±å¯ä»¥è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯ä¸ä¼šè·¨åŸŸï¼Œå› æ­¤ä¸€èˆ¬æ˜¯å°†å®ƒæ”¾å…¥HTTPè¯·æ±‚çš„Header Authorizationå­—æ®µä¸­ã€‚</p><p>å½“è·¨åŸŸæ—¶ï¼Œä¹Ÿå¯ä»¥å°†JWTæ”¾ç½®äºPOSTè¯·æ±‚çš„æ•°æ®ä¸»ä½“ä¸­ã€‚</p></blockquote><h2 id="3-4ã€é—®é¢˜å’Œè¶‹åŠ¿"><a href="#3-4ã€é—®é¢˜å’Œè¶‹åŠ¿" class="headerlink" title="3.4ã€é—®é¢˜å’Œè¶‹åŠ¿"></a>3.4ã€é—®é¢˜å’Œè¶‹åŠ¿</h2><p>1ã€JWTé»˜è®¤ä¸åŠ å¯†ï¼Œä½†å¯ä»¥åŠ å¯†ã€‚ç”ŸæˆåŸå§‹ä»¤ç‰Œåï¼Œå¯ä»¥ä½¿ç”¨è¯¥ä»¤ç‰Œå†æ¬¡å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚</p><p>2ã€å½“JWTæœªåŠ å¯†æ—¶ï¼Œä¸€äº›ç§å¯†æ•°æ®æ— æ³•é€šè¿‡JWTä¼ è¾“ã€‚</p><p>3ã€JWTä¸ä»…å¯ç”¨äºè®¤è¯ï¼Œè¿˜å¯ç”¨äºä¿¡æ¯äº¤æ¢ã€‚å–„ç”¨JWTæœ‰åŠ©äºå‡å°‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®åº“çš„æ¬¡æ•°ã€‚</p><p>4ã€JWTçš„æœ€å¤§ç¼ºç‚¹æ˜¯æœåŠ¡å™¨ä¸ä¿å­˜ä¼šè¯çŠ¶æ€ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æœŸé—´ä¸å¯èƒ½å–æ¶ˆä»¤ç‰Œæˆ–æ›´æ”¹ä»¤ç‰Œçš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦JWTç­¾å‘ï¼Œåœ¨æœ‰æ•ˆæœŸå†…å°†ä¼šä¸€ç›´æœ‰æ•ˆã€‚</p><p>5ã€JWTæœ¬èº«åŒ…å«è®¤è¯ä¿¡æ¯ï¼Œå› æ­¤ä¸€æ—¦ä¿¡æ¯æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWTçš„æœ‰æ•ˆæœŸä¸å®œè®¾ç½®å¤ªé•¿ã€‚å¯¹äºæŸäº›é‡è¦æ“ä½œï¼Œç”¨æˆ·åœ¨ä½¿ç”¨æ—¶åº”è¯¥æ¯æ¬¡éƒ½è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p><p>6ã€ä¸ºäº†å‡å°‘ç›—ç”¨å’Œçªƒå–ï¼ŒJWTä¸å»ºè®®ä½¿ç”¨HTTPåè®®æ¥ä¼ è¾“ä»£ç ï¼Œè€Œæ˜¯ä½¿ç”¨åŠ å¯†çš„HTTPSåè®®è¿›è¡Œä¼ è¾“ã€‚</p><h1 id="å››ã€ç”¨æˆ·èº«ä»½è®¤è¯"><a href="#å››ã€ç”¨æˆ·èº«ä»½è®¤è¯" class="headerlink" title="å››ã€ç”¨æˆ·èº«ä»½è®¤è¯"></a>å››ã€ç”¨æˆ·èº«ä»½è®¤è¯</h1><h2 id="4-1ã€å¼•å…¥ä¾èµ–"><a href="#4-1ã€å¼•å…¥ä¾èµ–" class="headerlink" title="4.1ã€å¼•å…¥ä¾èµ–"></a>4.1ã€å¼•å…¥ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»"><a href="#4-2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»" class="headerlink" title="4.2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»"></a>4.2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»</h2><blockquote><p>JwtUtils.javaï¼Œç”¨äºæ ¹æ®<strong>ç”¨æˆ·ä¿¡æ¯</strong>ç”Ÿæˆ<strong>token</strong>ã€åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆçš„å·¥å…·ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_SECRET = <span class="string">&quot;ukc8BDbRigUDaY6pZFfWus2jZWLPHO&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Key <span class="title">getKeyInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = DatatypeConverter.parseBase64Binary(APP_SECRET);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SecretKeySpec(bytes,signatureAlgorithm.getJcaName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getJwtToken</span><span class="params">(JwtInfo jwtInfo, <span class="keyword">int</span> expire)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        String JwtToken = Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">                .setSubject(<span class="string">&quot;guli-user&quot;</span>)<span class="comment">//ä¸»é¢˜</span></span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> Date())<span class="comment">//é¢å‘æ—¶é—´</span></span><br><span class="line">                .setExpiration(DateTime.now().plusSeconds(expire).toDate())<span class="comment">//è¿‡æœŸæ—¶é—´</span></span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, jwtInfo.getId())<span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, jwtInfo.getNickname())<span class="comment">//ç”¨æˆ·æ˜µç§°</span></span><br><span class="line">                .claim(<span class="string">&quot;avatar&quot;</span>, jwtInfo.getAvatar())<span class="comment">//ç”¨æˆ·å¤´åƒ</span></span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, getKeyInstance())</span><br><span class="line">                .compact();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwtToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkJwtTToken</span><span class="params">(String jwtToken)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­tokenæ˜¯å¦å­˜åœ¨ä¸æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkJwtTToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®tokenè·å–ä¼šå‘˜id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JwtInfo <span class="title">getMemberIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        String jwtToken = request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(jwtToken)) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(getKeyInstance()).parseClaimsJws(jwtToken);</span><br><span class="line">        Claims claims = claimsJws.getBody();</span><br><span class="line">        JwtInfo jwtInfo = <span class="keyword">new</span> JwtInfo(claims.get(<span class="string">&quot;id&quot;</span>).toString(), claims.get(<span class="string">&quot;nickname&quot;</span>).toString(), claims.get(<span class="string">&quot;avatar&quot;</span>).toString());</span><br><span class="line">        <span class="keyword">return</span> jwtInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>JwtInfoï¼Œå­˜æ”¾ç”¨æˆ·çš„æœ‰æ•ˆä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtInfo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="comment">//æƒé™ã€è§’è‰²ç­‰</span></span><br><span class="line">    <span class="comment">//ä¸è¦å­˜æ•æ„Ÿä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3ã€å®šä¹‰LoginVo"><a href="#4-3ã€å®šä¹‰LoginVo" class="headerlink" title="4.3ã€å®šä¹‰LoginVo"></a>4.3ã€å®šä¹‰LoginVo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginVo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£"><a href="#4-4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£" class="headerlink" title="4.4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£"></a>4.4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£</h2><blockquote><p>è¯¥æ¥å£æ¥æ”¶Serviceå±‚ç”Ÿæˆçš„Tokenï¼Œç„¶åå°†tokenè¿”å›è‡³å‰ç«¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;ä¼šå‘˜ç™»å½•&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginVo loginVo)</span> </span>&#123;</span><br><span class="line">    String token = memberService.login(loginVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-5ã€å®šä¹‰Serviceå±‚"><a href="#4-5ã€å®šä¹‰Serviceå±‚" class="headerlink" title="4.5ã€å®šä¹‰Serviceå±‚"></a>4.5ã€å®šä¹‰Serviceå±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(LoginVo loginVo)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String mobile = loginVo.getMobile();</span><br><span class="line">    String password = loginVo.getPassword();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¡éªŒå‚æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(mobile)</span><br><span class="line">        || !FormUtils.isMobile(mobile)</span><br><span class="line">        || StringUtils.isEmpty(password)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.PARAM_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    QueryWrapper&lt;Member&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;mobile&quot;</span>, mobile);</span><br><span class="line">    Member member = baseMapper.selectOne(queryWrapper);</span><br><span class="line">    <span class="keyword">if</span>(member == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.LOGIN_MOBLE_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¡éªŒå¯†ç </span></span><br><span class="line">    <span class="keyword">if</span>(!MD5.encrypt(password).equals(member.getPassword()))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.LOGIN_PASSWORD_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ£€éªŒç”¨æˆ·æ˜¯å¦è¢«ç¦ç”¨</span></span><br><span class="line">    <span class="keyword">if</span>(member.getDisabled())&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuliException(ResultCodeEnum.LOGIN_DISABLED_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    JwtInfo jwtInfo = <span class="keyword">new</span> JwtInfo();</span><br><span class="line">    jwtInfo.setId(member.getId());</span><br><span class="line">    jwtInfo.setNickname(member.getNickname());</span><br><span class="line">    jwtInfo.setAvatar(member.getAvatar());</span><br><span class="line">    String jwtToken = JwtUtils.getJwtToken(jwtInfo, <span class="number">1800</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jwtToken;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-6ã€æµ‹è¯•"><a href="#4-6ã€æµ‹è¯•" class="headerlink" title="4.6ã€æµ‹è¯•"></a>4.6ã€æµ‹è¯•</h2><blockquote><p>å¾€æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æµ‹è¯•æ•°æ®ï¼Œmobileä¸º13711111111ï¼Œå¯†ç ä¸º123</p></blockquote><blockquote><p>æ‰“å¼€swaggerï¼Œè¿›è¡Œæµ‹è¯•</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215334.png" alt="image-20210205215334387"></p><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215350.png" alt="image-20210205215350880"></p><blockquote><p>å½“mobileå’Œå¯†ç å‡è¾“å…¥æ— è¯¯æ—¶ï¼Œåç«¯ä¼šè¿”å›ä¸€ä¸ªtoken</p></blockquote><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215435.png" alt="image-20210205215435940"></p><p><img src="/img/loading.gif" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205215449.png" alt="image-20210205215449715"></p></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäºŒï¼‰-ç”¨æˆ·è®¤è¯</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://sutianxin.top/posts/650479038.html">https://sutianxin.top/posts/650479038.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="display:inline-block;width:120px"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>å¤©æ˜•</h></div></div><div class="post-copyright-c" style="display:inline-block;width:120px"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2021-02-05</h></div></div><div class="post-copyright-u" style="display:inline-block;width:120px"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2021-02-11</h></div></div><div class="post-copyright-c" style="display:inline-block;width:120px"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E2%98%95Java/">â˜•Java</a><a class="post-meta__tags" href="/tags/%F0%9F%92%BB%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0/">ğŸ’»åç«¯å­¦ä¹ </a><a class="post-meta__tags" href="/tags/%F0%9F%91%A2Spring-Boot/">ğŸ‘¢Spring Boot</a><a class="post-meta__tags" href="/tags/%F0%9F%86%94JWT/">ğŸ†”JWT</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210205204706.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/765379126.html"><img class="prev-cover" data-lazy-src="https://gitee.com/sutianxin/photo/raw/master/20210228202020.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆä¸‰ï¼‰-EasyExcelçš„ä½¿ç”¨</div></div></a></div><div class="next-post pull-right"><a href="/posts/3310991137.html"><img class="next-cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210208115633.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æ•°æ®ç»“æ„ä¸ç®—æ³•å­¦ä¹ ï¼ˆä¸‰ï¼‰-äºŒå‰æ’åºæ ‘è¯¦è§£</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/1717741625.html" title="åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäº”ï¼‰-ç»Ÿä¸€è¿”å›ç»“æœã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢ã€è®¢å•æ“ä½œå’Œå®šæ—¶ä»»åŠ¡"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210212204545.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-12</div><div class="title">åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆäº”ï¼‰-ç»Ÿä¸€è¿”å›ç»“æœã€åˆ†é¡µæ¡ä»¶æŸ¥è¯¢ã€è®¢å•æ“ä½œå’Œå®šæ—¶ä»»åŠ¡</div></div></a></div><div><a href="/posts/2938255980.html" title="Javaåº”ç”¨å­¦ä¹ ï¼ˆäºŒï¼‰-Springbootæ•´åˆswagger/swagger-Bootstrap-UIä½¿ç”¨"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210208120213.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-12</div><div class="title">Javaåº”ç”¨å­¦ä¹ ï¼ˆäºŒï¼‰-Springbootæ•´åˆswagger/swagger-Bootstrap-UIä½¿ç”¨</div></div></a></div><div><a href="/posts/3873979871.html" title="Rediså­¦ä¹ æ‰‹å†Œï¼ˆä¸‰ï¼‰--é…ç½®æ–‡ä»¶ã€æŒä¹…åŒ–ä¸å­˜å‚¨éªŒè¯ç "><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210208115927.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-04</div><div class="title">Rediså­¦ä¹ æ‰‹å†Œï¼ˆä¸‰ï¼‰--é…ç½®æ–‡ä»¶ã€æŒä¹…åŒ–ä¸å­˜å‚¨éªŒè¯ç </div></div></a></div><div><a href="/posts/2863462089.html" title="Spring Cloudå­¦ä¹ ï¼ˆäºŒï¼‰-OpenFeignå¾®æœåŠ¡è°ƒç”¨"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210211212103.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-11</div><div class="title">Spring Cloudå­¦ä¹ ï¼ˆäºŒï¼‰-OpenFeignå¾®æœåŠ¡è°ƒç”¨</div></div></a></div><div><a href="/posts/995752607.html" title="Spring Cloudå­¦ä¹ ï¼ˆå››ï¼‰-EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210214225250.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-14</div><div class="title">Spring Cloudå­¦ä¹ ï¼ˆå››ï¼‰-EurekaæœåŠ¡æ³¨å†Œä¸­å¿ƒ</div></div></a></div><div><a href="/posts/4109687940.html" title="åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆå››ï¼‰-ä½¿ç”¨é€’å½’æŸ¥è¯¢åµŒå¥—åˆ—è¡¨å’Œåˆ é™¤åµŒå¥—åˆ—è¡¨"><img class="cover" data-lazy-src="https://gitee.com/sutianxin/my-hexo-blog-photo/raw/master/20210210223743.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-10</div><div class="title">åœ¨çº¿æ•™è‚²é¡¹ç›®æ€»ç»“ï¼ˆå››ï¼‰-ä½¿ç”¨é€’å½’æŸ¥è¯¢åµŒå¥—åˆ—è¡¨å’Œåˆ é™¤åµŒå¥—åˆ—è¡¨</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%9C%89%E7%8A%B6%E6%80%81%E7%99%BB%E5%BD%95%E5%92%8C%E6%97%A0%E7%8A%B6%E6%80%81%E7%99%BB%E5%BD%95"><span class="toc-text">ä¸€ã€æœ‰çŠ¶æ€ç™»å½•å’Œæ— çŠ¶æ€ç™»å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%9C%89%E7%8A%B6%E6%80%81%EF%BC%9F"><span class="toc-text">1.1.ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E7%8A%B6%E6%80%81%EF%BC%9F"><span class="toc-text">1.2ã€ä»€ä¹ˆæ˜¯æ— çŠ¶æ€ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%B8%B8%E8%A7%81%E7%99%BB%E5%BD%95%E6%96%B9%E5%BC%8F"><span class="toc-text">äºŒã€å¸¸è§ç™»å½•æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1%E3%80%81%E5%8D%95%E4%B8%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.1ã€å•ä¸€æœåŠ¡å™¨æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E3%80%81%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%EF%BC%88Single-Sign-On%EF%BC%89"><span class="toc-text">2.2ã€å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%E3%80%81Token%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.3ã€Tokenæ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81JWT"><span class="toc-text">ä¸‰ã€JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFJWT%E4%BB%A4%E7%89%8C"><span class="toc-text">3.1ã€ä»€ä¹ˆæ˜¯JWTä»¤ç‰Œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">1ã€ä½¿ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B"><span class="toc-text">2ã€äº¤äº’æµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BD%9C%E7%94%A8"><span class="toc-text">3ã€ä½œç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%8E%9F%E7%90%86"><span class="toc-text">4ã€åŸç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E3%80%81JWT%E4%BB%A4%E7%89%8C%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-text">3.2ã€JWTä»¤ç‰Œçš„ç»„æˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3%E3%80%81JWT%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-text">3.3ã€JWTçš„ç”¨æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4%E3%80%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%B6%8B%E5%8A%BF"><span class="toc-text">3.4ã€é—®é¢˜å’Œè¶‹åŠ¿</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-text">å››ã€ç”¨æˆ·èº«ä»½è®¤è¯</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">4.1ã€å¼•å…¥ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2%E3%80%81%E5%BC%95%E5%85%A5%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%92%8C%E7%94%A8%E6%88%B7%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%E7%B1%BB"><span class="toc-text">4.2ã€å¼•å…¥å·¥å…·ç±»å’Œç”¨æˆ·æœ‰æ•ˆè½½è·ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3%E3%80%81%E5%AE%9A%E4%B9%89LoginVo"><span class="toc-text">4.3ã€å®šä¹‰LoginVo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4%E3%80%81%E5%AE%9A%E4%B9%89%E6%8E%A7%E5%88%B6%E5%B1%82%E6%8E%A5%E5%8F%A3"><span class="toc-text">4.4ã€å®šä¹‰æ§åˆ¶å±‚æ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5%E3%80%81%E5%AE%9A%E4%B9%89Service%E5%B1%82"><span class="toc-text">4.5ã€å®šä¹‰Serviceå±‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">4.6ã€æµ‹è¯•</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 <i style="color:#ff6a6a;animation:announ_animation .8s linear infinite" class="fa fa-heartbeat"></i> å¤©æ˜•</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢!<span id="runtime"></span><br></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo"></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender"></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr"></a><a class="github-badge" target="_blank" href="https://gitee.com/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Picture-Gitee-0cedbe?style=flat&amp;logo=Gitee"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris"></a></p><div id="workboard"></div><script async src="/js/runtime.js"></script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç°¡</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><script defer src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    let initData = {
      el: '#twikoo-wrap',
      envId: 'blogcomments-2gseqioe1aa55c8c',
      region: 'ap-shanghai'
    }

    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    twikoo.init(initData)
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'blogcomments-2gseqioe1aa55c8c',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><div class="aplayer no-destroy" data-id="6588965546" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" muted></div><script defer src="/live2d-widget/autoload.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/flipcountdown.js"></script><script data-pjax src="/js/runtime.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><script data-pjax src="/js/Lete.js"></script><script src="https://apip.weatherdt.com/simple/static/js/weather-simple-common.js?v=2.0"></script><script src="/js/weather.js"></script><script src="/js/custom/runtime.js"></script><script src="https://cdn.jsdelivr.net/gh/weilain/cdn-photo/js/jquery.min.js"></script><script defer src="https://rmt.dogedoge.com/fetch/~/source/jsdelivr/npm/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="https://cdn.jsdelivr.net/gh/sirxemic/jquery.ripples/dist/jquery.ripples.js"></script><script defer data-pjax src="/js/ripples.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/shuoshuo/"]):not([href="/bb/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax], .pjax-reload script').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', '', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.10/hexo_githubcalendar.js"></script><script data-pjax>function GithubCalendarConfig(){var e=document.getElementById("recent-posts");e&&e.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_container"></div></div>'),GithubCalendar("https://python-github-calendar-api.vercel.app/api?sutianxin",["#ebedf0","#f1f8ff","#dbedff","#c8e1ff","#79b8ff","#2188ff","#0366d6","#005cc5","#044289","#032f62","#05264c"],"sutianxin")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:120px}}</style></body></html>